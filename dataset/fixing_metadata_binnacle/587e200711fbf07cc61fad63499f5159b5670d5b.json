{"seed":2298333569,"processedDockerfileHash":"a778a8a1c4033eb358ff6fe0cd31333d","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM gcr.io/google-appengine/debian9:latest AS plugins\nCOPY license-checksums /\nRUN set -eux ; apt-get update \\\n && apt-get install --no-install-recommends ca-certificates=20230311 wget=1.21.3-1ubuntu1 -y ; mkdir /plugins \\\n && cd /plugins ; readonly base_url='https://github.com/deadtrickster/prometheus_rabbitmq_exporter/releases/download/v3.7.2.5' ; wget \"${base_url}/accept-0.3.5.ez\" ; wget \"${base_url}/prometheus-4.2.2.ez\" ; wget \"${base_url}/prometheus_cowboy-0.1.7.ez\" ; wget \"${base_url}/prometheus_httpd-2.1.10.ez\" ; wget \"${base_url}/prometheus_rabbitmq_exporter-3.7.2.5.ez\" ; mkdir -p \"/licenses\" \\\n && cd \"/licenses\" ; readonly git_base='https://raw.githubusercontent.com/deadtrickster' ; mkdir accept \\\n && wget -O accept/LICENSE \"${git_base}/accept/master/LICENSE\" ; mkdir prometheus \\\n && wget -O prometheus/LICENSE \"${git_base}/prometheus.erl/master/LICENSE\" ; mkdir prometheus_cowboy \\\n && wget -O prometheus_cowboy/LICENSE \"${git_base}/prometheus-cowboy/master/LICENSE\" ; mkdir prometheus_httpd \\\n && wget -O prometheus_httpd/LICENSE \"${git_base}/prometheus-httpd/master/LICENSE\" ; mkdir prometheus_rabbitmq_exporter \\\n && wget -O prometheus_rabbitmq_exporter/LICENSE \"${git_base}/prometheus_rabbitmq_exporter/master/LICENSE\" ; sha256sum -c /license-checksums\nFROM gcr.io/google-appengine/debian9:latest\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends gnupg=2.2.40-1ubuntu2 dirmngr=2.2.40-1ubuntu2 -y ; rm -rf /var/lib/apt/lists/*\n#   add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\nRUN groupadd -r rabbitmq \\\n && useradd -r -d /var/lib/rabbitmq -m -g rabbitmq rabbitmq\n#   grab gosu for easy step-down from root\nENV GOSU_VERSION=\"1.10\"\nENV GOSU_GPG=\"B42F6819007F00F88E364FD4036A9C25BF357DD4\"\nRUN set -eux ; fetchDeps=' ca-certificates wget ' ; apt-get update ; apt-get install --no-install-recommends $fetchDeps -y ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; wget -O /usr/local/src/gosu.tar.gz \"https://github.com/tianon/gosu/archive/$GOSU_VERSION.tar.gz\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; found='' \\\n && for server in pool.sks-keyservers.net na.pool.sks-keyservers.net eu.pool.sks-keyservers.net oc.pool.sks-keyservers.net ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 hkp://keyserver.ubuntu.com:80 pgp.mit.edu; do gpg --no-tty --keyserver $server --recv-keys $GOSU_GPG \\\n && found=yes \\\n && break ; done ; test -n \"$found\" ; gpg --no-tty --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; chmod +x /usr/local/bin/gosu ; gosu nobody true ; apt-get purge -y --auto-remove $fetchDeps\n#   RabbitMQ 3.6.15+ requires Erlang 19.3+ (and Stretch only has 19.2); https://www.rabbitmq.com/which-erlang.html\n#   so we'll pull Erlang from Buster instead (not using Erlang Solutions since their multiarch support is extremely limited)\nRUN set -eux ; sed 's/stretch/buster/g' /etc/apt/sources.list | tee /etc/apt/sources.list.d/buster.list ; { echo 'Package: *' ;echo 'Pin: release n=buster*' ;echo 'Pin-Priority: 1' ;echo ;echo 'Package: erlang*' ;echo 'Pin: release n=buster*' ;echo 'Pin-Priority: 999' ;echo ;echo 'Package: erlang*' ;echo 'Pin: release n=stretch*' ;echo 'Pin-Priority: -10' ; } | tee /etc/apt/preferences.d/buster-erlang\nRUN echo 'deb http://http.us.debian.org/debian testing main' >> /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends testing openssl=3.0.8-1ubuntu1 -t -y\n#   install Erlang\nRUN set -eux ; apt-get update ; if apt-cache show erlang-base-hipe 2> /dev/null | grep -q 'Package: erlang-base-hipe' ; then apt-get install --no-install-recommends erlang-base-hipe -y ; fi ; apt-get install --no-install-recommends erlang-asn1=1:25.2.3+dfsg-1 erlang-crypto=1:25.2.3+dfsg-1 erlang-eldap=1:25.2.3+dfsg-1 erlang-inets=1:25.2.3+dfsg-1 erlang-mnesia=1:25.2.3+dfsg-1 erlang-nox=1:25.2.3+dfsg-1 erlang-os-mon=1:25.2.3+dfsg-1 erlang-public-key=1:25.2.3+dfsg-1 erlang-ssl=1:25.2.3+dfsg-1 erlang-xmerl=1:25.2.3+dfsg-1 -y ; rm -rf /var/lib/apt/lists/*\n#   get logs to stdout (thanks @dumbbell for pushing this upstream! :D)\nENV RABBITMQ_LOGS=\"-\" \\\n    RABBITMQ_SASL_LOGS=\"-\"\n#   https://github.com/rabbitmq/rabbitmq-server/commit/53af45bf9a162dec849407d114041aad3d84feaf\n#   /usr/sbin/rabbitmq-server has some irritating behavior, and only exists to \"su - rabbitmq /usr/lib/rabbitmq/bin/rabbitmq-server ...\"\nENV PATH=\"/usr/lib/rabbitmq/bin:$PATH\"\n#   gpg: key 6026DFCA: public key \"RabbitMQ Release Signing Key <info@rabbitmq.com>\" imported\nENV RABBITMQ_GPG_KEY=\"0A9AF2115F4687BD29803A206B73A36E6026DFCA\"\nENV RABBITMQ_VERSION=\"3.7.13\"\nENV RABBITMQ_GITHUB_TAG=\"v3.7.9\"\nENV RABBITMQ_DEBIAN_VERSION=\"3.7.9-1\"\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends ca-certificates=20230311 wget=1.21.3-1ubuntu1 -y ; wget -O rabbitmq-server.deb.asc \"https://github.com/rabbitmq/rabbitmq-server/releases/download/$RABBITMQ_GITHUB_TAG/rabbitmq-server_${RABBITMQ_DEBIAN_VERSION}_all.deb.asc\" ; wget -O rabbitmq-server.deb \"https://github.com/rabbitmq/rabbitmq-server/releases/download/$RABBITMQ_GITHUB_TAG/rabbitmq-server_${RABBITMQ_DEBIAN_VERSION}_all.deb\" ; apt-get purge -y --auto-remove ca-certificates wget ; export GNUPGHOME=\"$( mktemp -d ;)\" ; found='' \\\n && for server in pool.sks-keyservers.net na.pool.sks-keyservers.net eu.pool.sks-keyservers.net oc.pool.sks-keyservers.net ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 hkp://keyserver.ubuntu.com:80 pgp.mit.edu; do gpg --no-tty --keyserver $server --recv-keys $RABBITMQ_GPG_KEY \\\n && found=yes \\\n && break ; done ; test -n \"$found\" ; gpg --no-tty --batch --verify rabbitmq-server.deb.asc rabbitmq-server.deb ; rm -rf \"$GNUPGHOME\" ; apt-get install --no-install-recommends ./rabbitmq-server.deb -y ; dpkg -l | grep rabbitmq-server ; rm -f rabbitmq-server.deb* ; rm -rf /var/lib/apt/lists/*\n#   warning: the VM is running with native name encoding of latin1 which may cause Elixir to malfunction as it expects utf8. Please ensure your locale is set to UTF-8 (which can be verified by running \"locale\" in your shell)\nENV LANG=\"C.UTF-8\"\n#   set home so that any `--user` knows where to put the erlang cookie\nENV HOME=\"/var/lib/rabbitmq\"\nRUN mkdir -p /var/lib/rabbitmq /etc/rabbitmq \\\n && chown -R rabbitmq:rabbitmq /var/lib/rabbitmq /etc/rabbitmq \\\n && chmod -R 777 /var/lib/rabbitmq /etc/rabbitmq\nVOLUME /var/lib/rabbitmq\n#   add a symlink to the .erlang.cookie in /root so we can \"docker exec rabbitmqctl ...\" without gosu\nRUN ln -sf /var/lib/rabbitmq/.erlang.cookie /root/\nRUN ln -sf \"/usr/lib/rabbitmq/lib/rabbitmq_server-$RABBITMQ_VERSION/plugins\" /plugins\n#   Download RabbitMQ metrics plugins:\nRUN mkdir -p /usr/lib/rabbitmq/plugins ; mkdir /usr/share/doc/rabbitmq-plugins\nCOPY --from=plugins /plugins/* /usr/lib/rabbitmq/plugins/\nCOPY --from=plugins /licenses/* /usr/share/doc/rabbitmq-plugins/\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN ln -s usr/local/bin/docker-entrypoint.sh /\nENTRYPOINT [\"docker-entrypoint.sh\"]\nEXPOSE 4369/tcp 5671/tcp 5672/tcp 25672/tcp\nCMD [\"rabbitmq-server\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM gcr.io/google-appengine/debian9:latest AS plugins\nCOPY license-checksums /\nRUN set -eux ; apt-get update \\\n && apt-get install ca-certificates wget -y ; mkdir /plugins \\\n && cd /plugins ; readonly base_url='https://github.com/deadtrickster/prometheus_rabbitmq_exporter/releases/download/v3.7.2.5' ; wget \"${base_url}/accept-0.3.5.ez\" ; wget \"${base_url}/prometheus-4.2.2.ez\" ; wget \"${base_url}/prometheus_cowboy-0.1.7.ez\" ; wget \"${base_url}/prometheus_httpd-2.1.10.ez\" ; wget \"${base_url}/prometheus_rabbitmq_exporter-3.7.2.5.ez\" ; mkdir -p \"/licenses\" \\\n && cd \"/licenses\" ; readonly git_base='https://raw.githubusercontent.com/deadtrickster' ; mkdir accept \\\n && wget -O accept/LICENSE \"${git_base}/accept/master/LICENSE\" ; mkdir prometheus \\\n && wget -O prometheus/LICENSE \"${git_base}/prometheus.erl/master/LICENSE\" ; mkdir prometheus_cowboy \\\n && wget -O prometheus_cowboy/LICENSE \"${git_base}/prometheus-cowboy/master/LICENSE\" ; mkdir prometheus_httpd \\\n && wget -O prometheus_httpd/LICENSE \"${git_base}/prometheus-httpd/master/LICENSE\" ; mkdir prometheus_rabbitmq_exporter \\\n && wget -O prometheus_rabbitmq_exporter/LICENSE \"${git_base}/prometheus_rabbitmq_exporter/master/LICENSE\" ; sha256sum -c /license-checksums\nFROM gcr.io/google-appengine/debian9:latest\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends gnupg dirmngr -y ; rm -rf /var/lib/apt/lists/*\n#  add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\nRUN groupadd -r rabbitmq \\\n && useradd -r -d /var/lib/rabbitmq -m -g rabbitmq rabbitmq\n#  grab gosu for easy step-down from root\nENV GOSU_VERSION=\"1.10\"\nENV GOSU_GPG=\"B42F6819007F00F88E364FD4036A9C25BF357DD4\"\nRUN set -eux ; fetchDeps=' ca-certificates wget ' ; apt-get update ; apt-get install --no-install-recommends $fetchDeps -y ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; wget -O /usr/local/src/gosu.tar.gz \"https://github.com/tianon/gosu/archive/$GOSU_VERSION.tar.gz\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; found='' \\\n && for server in pool.sks-keyservers.net na.pool.sks-keyservers.net eu.pool.sks-keyservers.net oc.pool.sks-keyservers.net ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 hkp://keyserver.ubuntu.com:80 pgp.mit.edu; do gpg --no-tty --keyserver $server --recv-keys $GOSU_GPG \\\n && found=yes \\\n && break ; done ; test -n \"$found\" ; gpg --no-tty --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; chmod +x /usr/local/bin/gosu ; gosu nobody true ; apt-get purge -y --auto-remove $fetchDeps\n#  RabbitMQ 3.6.15+ requires Erlang 19.3+ (and Stretch only has 19.2); https://www.rabbitmq.com/which-erlang.html\n#  so we'll pull Erlang from Buster instead (not using Erlang Solutions since their multiarch support is extremely limited)\nRUN set -eux ; sed 's/stretch/buster/g' /etc/apt/sources.list | tee /etc/apt/sources.list.d/buster.list ; { echo 'Package: *' ;echo 'Pin: release n=buster*' ;echo 'Pin-Priority: 1' ;echo ;echo 'Package: erlang*' ;echo 'Pin: release n=buster*' ;echo 'Pin-Priority: 999' ;echo ;echo 'Package: erlang*' ;echo 'Pin: release n=stretch*' ;echo 'Pin-Priority: -10' ; } | tee /etc/apt/preferences.d/buster-erlang\nRUN echo 'deb http://http.us.debian.org/debian testing main' >> /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install testing openssl -t -y\n#  install Erlang\nRUN set -eux ; apt-get update ; if apt-cache show erlang-base-hipe 2> /dev/null | grep -q 'Package: erlang-base-hipe' ; then apt-get install --no-install-recommends erlang-base-hipe -y ; fi ; apt-get install --no-install-recommends erlang-asn1 erlang-crypto erlang-eldap erlang-inets erlang-mnesia erlang-nox erlang-os-mon erlang-public-key erlang-ssl erlang-xmerl -y ; rm -rf /var/lib/apt/lists/*\n#  get logs to stdout (thanks @dumbbell for pushing this upstream! :D)\nENV RABBITMQ_LOGS=\"-\" \\\n    RABBITMQ_SASL_LOGS=\"-\"\n#  https://github.com/rabbitmq/rabbitmq-server/commit/53af45bf9a162dec849407d114041aad3d84feaf\n#  /usr/sbin/rabbitmq-server has some irritating behavior, and only exists to \"su - rabbitmq /usr/lib/rabbitmq/bin/rabbitmq-server ...\"\nENV PATH=\"/usr/lib/rabbitmq/bin:$PATH\"\n#  gpg: key 6026DFCA: public key \"RabbitMQ Release Signing Key <info@rabbitmq.com>\" imported\nENV RABBITMQ_GPG_KEY=\"0A9AF2115F4687BD29803A206B73A36E6026DFCA\"\nENV RABBITMQ_VERSION=\"3.7.13\"\nENV RABBITMQ_GITHUB_TAG=\"v3.7.9\"\nENV RABBITMQ_DEBIAN_VERSION=\"3.7.9-1\"\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends ca-certificates wget -y ; wget -O rabbitmq-server.deb.asc \"https://github.com/rabbitmq/rabbitmq-server/releases/download/$RABBITMQ_GITHUB_TAG/rabbitmq-server_${RABBITMQ_DEBIAN_VERSION}_all.deb.asc\" ; wget -O rabbitmq-server.deb \"https://github.com/rabbitmq/rabbitmq-server/releases/download/$RABBITMQ_GITHUB_TAG/rabbitmq-server_${RABBITMQ_DEBIAN_VERSION}_all.deb\" ; apt-get purge -y --auto-remove ca-certificates wget ; export GNUPGHOME=\"$( mktemp -d ;)\" ; found='' \\\n && for server in pool.sks-keyservers.net na.pool.sks-keyservers.net eu.pool.sks-keyservers.net oc.pool.sks-keyservers.net ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 hkp://keyserver.ubuntu.com:80 pgp.mit.edu; do gpg --no-tty --keyserver $server --recv-keys $RABBITMQ_GPG_KEY \\\n && found=yes \\\n && break ; done ; test -n \"$found\" ; gpg --no-tty --batch --verify rabbitmq-server.deb.asc rabbitmq-server.deb ; rm -rf \"$GNUPGHOME\" ; apt-get install -y --no-install-recommends ./rabbitmq-server.deb ; dpkg -l | grep rabbitmq-server ; rm -f rabbitmq-server.deb* ; rm -rf /var/lib/apt/lists/*\n#  warning: the VM is running with native name encoding of latin1 which may cause Elixir to malfunction as it expects utf8. Please ensure your locale is set to UTF-8 (which can be verified by running \"locale\" in your shell)\nENV LANG=\"C.UTF-8\"\n#  set home so that any `--user` knows where to put the erlang cookie\nENV HOME=\"/var/lib/rabbitmq\"\nRUN mkdir -p /var/lib/rabbitmq /etc/rabbitmq \\\n && chown -R rabbitmq:rabbitmq /var/lib/rabbitmq /etc/rabbitmq \\\n && chmod -R 777 /var/lib/rabbitmq /etc/rabbitmq\nVOLUME /var/lib/rabbitmq\n#  add a symlink to the .erlang.cookie in /root so we can \"docker exec rabbitmqctl ...\" without gosu\nRUN ln -sf /var/lib/rabbitmq/.erlang.cookie /root/\nRUN ln -sf \"/usr/lib/rabbitmq/lib/rabbitmq_server-$RABBITMQ_VERSION/plugins\" /plugins\n#  Download RabbitMQ metrics plugins:\nRUN mkdir -p /usr/lib/rabbitmq/plugins ; mkdir /usr/share/doc/rabbitmq-plugins\nCOPY --from=plugins /plugins/* /usr/lib/rabbitmq/plugins/\nCOPY --from=plugins /licenses/* /usr/share/doc/rabbitmq-plugins/\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN ln -s usr/local/bin/docker-entrypoint.sh /\nENTRYPOINT [\"docker-entrypoint.sh\"]\nEXPOSE 4369/tcp 5671/tcp 5672/tcp 25672/tcp\nCMD [\"rabbitmq-server\"]\n","injectedSmells":[],"originalDockerfileHash":"6cd30a7d3f0f85fc23ac358488fdc981","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM gcr.io/google-appengine/debian9:latest AS plugins\nCOPY license-checksums /\nRUN set -eux ; apt-get update \\\n && apt-get install ca-certificates wget -y ; mkdir /plugins \\\n && cd /plugins ; readonly base_url='https://github.com/deadtrickster/prometheus_rabbitmq_exporter/releases/download/v3.7.2.5' ; wget \"${base_url}/accept-0.3.5.ez\" ; wget \"${base_url}/prometheus-4.2.2.ez\" ; wget \"${base_url}/prometheus_cowboy-0.1.7.ez\" ; wget \"${base_url}/prometheus_httpd-2.1.10.ez\" ; wget \"${base_url}/prometheus_rabbitmq_exporter-3.7.2.5.ez\" ; mkdir -p \"/licenses\" \\\n && cd \"/licenses\" ; readonly git_base='https://raw.githubusercontent.com/deadtrickster' ; mkdir accept \\\n && wget -O accept/LICENSE \"${git_base}/accept/master/LICENSE\" ; mkdir prometheus \\\n && wget -O prometheus/LICENSE \"${git_base}/prometheus.erl/master/LICENSE\" ; mkdir prometheus_cowboy \\\n && wget -O prometheus_cowboy/LICENSE \"${git_base}/prometheus-cowboy/master/LICENSE\" ; mkdir prometheus_httpd \\\n && wget -O prometheus_httpd/LICENSE \"${git_base}/prometheus-httpd/master/LICENSE\" ; mkdir prometheus_rabbitmq_exporter \\\n && wget -O prometheus_rabbitmq_exporter/LICENSE \"${git_base}/prometheus_rabbitmq_exporter/master/LICENSE\" ; sha256sum -c /license-checksums\nFROM gcr.io/google-appengine/debian9:latest\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends gnupg dirmngr -y ; rm -rf /var/lib/apt/lists/*\n#   add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\nRUN groupadd -r rabbitmq \\\n && useradd -r -d /var/lib/rabbitmq -m -g rabbitmq rabbitmq\n#   grab gosu for easy step-down from root\nENV GOSU_VERSION=\"1.10\"\nENV GOSU_GPG=\"B42F6819007F00F88E364FD4036A9C25BF357DD4\"\nRUN set -eux ; fetchDeps=' ca-certificates wget ' ; apt-get update ; apt-get install --no-install-recommends $fetchDeps -y ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; wget -O /usr/local/src/gosu.tar.gz \"https://github.com/tianon/gosu/archive/$GOSU_VERSION.tar.gz\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; found='' \\\n && for server in pool.sks-keyservers.net na.pool.sks-keyservers.net eu.pool.sks-keyservers.net oc.pool.sks-keyservers.net ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 hkp://keyserver.ubuntu.com:80 pgp.mit.edu; do gpg --no-tty --keyserver $server --recv-keys $GOSU_GPG \\\n && found=yes \\\n && break ; done ; test -n \"$found\" ; gpg --no-tty --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; chmod +x /usr/local/bin/gosu ; gosu nobody true ; apt-get purge -y --auto-remove $fetchDeps\n#   RabbitMQ 3.6.15+ requires Erlang 19.3+ (and Stretch only has 19.2); https://www.rabbitmq.com/which-erlang.html\n#   so we'll pull Erlang from Buster instead (not using Erlang Solutions since their multiarch support is extremely limited)\nRUN set -eux ; sed 's/stretch/buster/g' /etc/apt/sources.list | tee /etc/apt/sources.list.d/buster.list ; { echo 'Package: *' ;echo 'Pin: release n=buster*' ;echo 'Pin-Priority: 1' ;echo ;echo 'Package: erlang*' ;echo 'Pin: release n=buster*' ;echo 'Pin-Priority: 999' ;echo ;echo 'Package: erlang*' ;echo 'Pin: release n=stretch*' ;echo 'Pin-Priority: -10' ; } | tee /etc/apt/preferences.d/buster-erlang\nRUN echo 'deb http://http.us.debian.org/debian testing main' >> /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install testing openssl -t -y\n#   install Erlang\nRUN set -eux ; apt-get update ; if apt-cache show erlang-base-hipe 2> /dev/null | grep -q 'Package: erlang-base-hipe' ; then apt-get install --no-install-recommends erlang-base-hipe -y ; fi ; apt-get install --no-install-recommends erlang-asn1 erlang-crypto erlang-eldap erlang-inets erlang-mnesia erlang-nox erlang-os-mon erlang-public-key erlang-ssl erlang-xmerl -y ; rm -rf /var/lib/apt/lists/*\n#   get logs to stdout (thanks @dumbbell for pushing this upstream! :D)\nENV RABBITMQ_LOGS=\"-\" \\\n    RABBITMQ_SASL_LOGS=\"-\"\n#   https://github.com/rabbitmq/rabbitmq-server/commit/53af45bf9a162dec849407d114041aad3d84feaf\n#   /usr/sbin/rabbitmq-server has some irritating behavior, and only exists to \"su - rabbitmq /usr/lib/rabbitmq/bin/rabbitmq-server ...\"\nENV PATH=\"/usr/lib/rabbitmq/bin:$PATH\"\n#   gpg: key 6026DFCA: public key \"RabbitMQ Release Signing Key <info@rabbitmq.com>\" imported\nENV RABBITMQ_GPG_KEY=\"0A9AF2115F4687BD29803A206B73A36E6026DFCA\"\nENV RABBITMQ_VERSION=\"3.7.13\"\nENV RABBITMQ_GITHUB_TAG=\"v3.7.9\"\nENV RABBITMQ_DEBIAN_VERSION=\"3.7.9-1\"\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends ca-certificates wget -y ; wget -O rabbitmq-server.deb.asc \"https://github.com/rabbitmq/rabbitmq-server/releases/download/$RABBITMQ_GITHUB_TAG/rabbitmq-server_${RABBITMQ_DEBIAN_VERSION}_all.deb.asc\" ; wget -O rabbitmq-server.deb \"https://github.com/rabbitmq/rabbitmq-server/releases/download/$RABBITMQ_GITHUB_TAG/rabbitmq-server_${RABBITMQ_DEBIAN_VERSION}_all.deb\" ; apt-get purge -y --auto-remove ca-certificates wget ; export GNUPGHOME=\"$( mktemp -d ;)\" ; found='' \\\n && for server in pool.sks-keyservers.net na.pool.sks-keyservers.net eu.pool.sks-keyservers.net oc.pool.sks-keyservers.net ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 hkp://keyserver.ubuntu.com:80 pgp.mit.edu; do gpg --no-tty --keyserver $server --recv-keys $RABBITMQ_GPG_KEY \\\n && found=yes \\\n && break ; done ; test -n \"$found\" ; gpg --no-tty --batch --verify rabbitmq-server.deb.asc rabbitmq-server.deb ; rm -rf \"$GNUPGHOME\" ; apt-get install --no-install-recommends ./rabbitmq-server.deb -y ; dpkg -l | grep rabbitmq-server ; rm -f rabbitmq-server.deb* ; rm -rf /var/lib/apt/lists/*\n#   warning: the VM is running with native name encoding of latin1 which may cause Elixir to malfunction as it expects utf8. Please ensure your locale is set to UTF-8 (which can be verified by running \"locale\" in your shell)\nENV LANG=\"C.UTF-8\"\n#   set home so that any `--user` knows where to put the erlang cookie\nENV HOME=\"/var/lib/rabbitmq\"\nRUN mkdir -p /var/lib/rabbitmq /etc/rabbitmq \\\n && chown -R rabbitmq:rabbitmq /var/lib/rabbitmq /etc/rabbitmq \\\n && chmod -R 777 /var/lib/rabbitmq /etc/rabbitmq\nVOLUME /var/lib/rabbitmq\n#   add a symlink to the .erlang.cookie in /root so we can \"docker exec rabbitmqctl ...\" without gosu\nRUN ln -sf /var/lib/rabbitmq/.erlang.cookie /root/\nRUN ln -sf \"/usr/lib/rabbitmq/lib/rabbitmq_server-$RABBITMQ_VERSION/plugins\" /plugins\n#   Download RabbitMQ metrics plugins:\nRUN mkdir -p /usr/lib/rabbitmq/plugins ; mkdir /usr/share/doc/rabbitmq-plugins\nCOPY --from=plugins /plugins/* /usr/lib/rabbitmq/plugins/\nCOPY --from=plugins /licenses/* /usr/share/doc/rabbitmq-plugins/\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN ln -s usr/local/bin/docker-entrypoint.sh /\nENTRYPOINT [\"docker-entrypoint.sh\"]\nEXPOSE 4369/tcp 5671/tcp 5672/tcp 25672/tcp\nCMD [\"rabbitmq-server\"]\n","originalDockerfileUglifiedHash":"d92f14121e905c2c623f12cb87aa1019","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/587e200711fbf07cc61fad63499f5159b5670d5b.dockerfile"}