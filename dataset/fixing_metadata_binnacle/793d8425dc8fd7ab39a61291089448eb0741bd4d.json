{"seed":1817583487,"processedDockerfileHash":"b1596f600434e28d2c1550dcb5969d31","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM alpine:3.7\nARG S6_OVERLAY_VER=1.21.2.2\nARG OPENRESTY_VER=1.13.6.1\nARG NGINX_RTMP_VER=1.2.1\nARG LUAROCKS_VER=2.4.3\nARG MULTISTREAMER_VER=master\nARG SOCKEXEC_VER=2.0.3\nRUN apk add bash=4.4.19-r1 gcc=6.4.0-r5 make=4.2.1-r0 musl-dev=1.1.18-r4 linux-headers=4.4.6-r2 gd-dev=2.2.5-r3 geoip-dev=1.6.11-r0 libxml2-dev=2.9.8-r1 libxslt-dev=1.1.31-r2 libressl-dev=2.6.5-r0 paxmark=0.11-r0 pcre-dev=8.41-r1 yaml-dev=0.1.7-r0 yaml=0.1.7-r0 perl-dev=5.26.3-r0 pkgconf=1.3.10-r0 zlib-dev=1.2.11-r1 curl=7.61.1-r3 git=2.15.4-r0 unzip=6.0-r3 dnsmasq=2.78-r3 ffmpeg=3.4-r1 lua5.1-dev=5.1.5-r3 lua5.1=5.1.5-r3 pcre=8.41-r1 libressl2.6-libssl=2.6.5-r0 libressl2.6-libtls=2.6.5-r0 libressl2.6-libcrypto=2.6.5-r0 ca-certificates=20190108-r0 postgresql-client=10.10-r0 zlib=1.2.11-r1 --no-cache\nRUN mkdir /tmp/openresty-build \\\n && cd /tmp/openresty-build \\\n && curl -R -L -o s6-overlay-amd64.tar.gz https://github.com/just-containers/s6-overlay/releases/download/v$S6_OVERLAY_VER/s6-overlay-amd64.tar.gz \\\n && curl -R -L -o sockexec-x86_64-linux-musl.tar.gz https://github.com/jprjr/sockexec/releases/download/$SOCKEXEC_VER/sockexec-x86_64-linux-musl.tar.gz \\\n && curl -R -L -o openresty-$OPENRESTY_VER.tar.gz https://openresty.org/download/openresty-$OPENRESTY_VER.tar.gz \\\n && curl -R -L -o nginx-rtmp-module-$NGINX_RTMP_VER.tar.gz https://github.com/arut/nginx-rtmp-module/archive/v$NGINX_RTMP_VER.tar.gz \\\n && curl -R -L -o luarocks-$LUAROCKS_VER.tar.gz http://luarocks.github.io/luarocks/releases/luarocks-$LUAROCKS_VER.tar.gz \\\n && tar xzf openresty-$OPENRESTY_VER.tar.gz \\\n && tar xzf nginx-rtmp-module-$NGINX_RTMP_VER.tar.gz \\\n && tar xzf luarocks-$LUAROCKS_VER.tar.gz \\\n && tar xzf s6-overlay-amd64.tar.gz -C / \\\n && tar xzf sockexec-x86_64-linux-musl.tar.gz -C /usr \\\n && cd openresty-$OPENRESTY_VER \\\n && (./configure --prefix=/opt/openresty --with-threads --with-file-aio --with-ipv6 --with-http_ssl_module --with-pcre --with-pcre-jit --with-stream --with-stream_ssl_module --add-module=../nginx-rtmp-module-$NGINX_RTMP_VER \\\n && make \\\n && make install ) \\\n && cd /tmp/openresty-build/luarocks-$LUAROCKS_VER \\\n && ./configure --prefix=/opt/luarocks --with-lua-include=$( pkg-config --variable=includedir lua5.1 ;) \\\n && make \\\n && make build \\\n && make install \\\n && cd / \\\n && rm -rf /tmp/openresty-build\nRUN mkdir /etc/htpasswd-auth-server \\\n && mkdir /etc/redis-auth-server \\\n && adduser -h /home/redisauth -g redisauth -s /sbin/nologin -S -D redisauth \\\n && cd /home/redisauth \\\n && curl -R -L -o redis-auth-server-master.tar.gz https://github.com/jprjr/redis-auth-server/archive/master.tar.gz \\\n && tar xzf redis-auth-server-master.tar.gz \\\n && mv redis-auth-server-master/* . \\\n && rm -rf redis-auth-server-master \\\n && chown -R redisauth:nogroup . \\\n && ln -sf /home/multistreamer/lua_modules ./lua_modules \\\n && rm -rf ./etc \\\n && ln -sf /etc/redis-auth-server ./etc \\\n && adduser -h /home/htpasswdauth -g htpasswdauth -s /sbin/nologin -S -D htpasswdauth \\\n && cd /home/htpasswdauth \\\n && curl -R -L -o htpasswd-auth-server-master.tar.gz https://github.com/jprjr/htpasswd-auth-server/archive/master.tar.gz \\\n && tar xzf htpasswd-auth-server-master.tar.gz \\\n && mv htpasswd-auth-server-master/* . \\\n && rm -rf htpasswd-auth-server-master \\\n && chown -R htpasswdauth:nogroup . \\\n && ln -sf /home/multistreamer/lua_modules ./lua_modules \\\n && rm -rf ./etc \\\n && ln -sf /etc/htpasswd-auth-server ./etc\nRUN adduser -h /home/multistreamer -g multistreamer -s /sbin/nologin -S -D multistreamer \\\n && cd /home/multistreamer \\\n && rm -rf ./* \\\n && git clone https://github.com/jprjr/multistreamer.git . \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lua-resty-exec \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lua-resty-jit-uuid \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lua-resty-http \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lapis \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install etlua \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install luaposix \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install luafilesystem \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install whereami \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install luacrypto \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lyaml \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install redis-lua \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install md5 \\\n && chown -R multistreamer:nogroup . \\\n && mkdir /etc/multistreamer \\\n && mkdir -p /var/log/multistreamer \\\n && chown nobody:nogroup /var/log/multistreamer\nCOPY rootfs /\nENV S6_BEHAVIOUR_IF_STAGE2_FAILS=\"2\"\nENTRYPOINT [\"/init\"]\nEXPOSE 1935/tcp 6667/tcp 8081/tcp\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM alpine:3.7\nARG S6_OVERLAY_VER=1.21.2.2\nARG OPENRESTY_VER=1.13.6.1\nARG NGINX_RTMP_VER=1.2.1\nARG LUAROCKS_VER=2.4.3\nARG MULTISTREAMER_VER=master\nARG SOCKEXEC_VER=2.0.3\nRUN apk add --no-cache bash gcc make musl-dev linux-headers gd-dev geoip-dev libxml2-dev libxslt-dev libressl-dev paxmark pcre-dev yaml-dev yaml perl-dev pkgconf zlib-dev curl git unzip dnsmasq ffmpeg lua5.1-dev lua5.1 pcre libressl2.6-libssl libressl2.6-libtls libressl2.6-libcrypto ca-certificates postgresql-client zlib\nRUN mkdir /tmp/openresty-build \\\n && cd /tmp/openresty-build \\\n && curl -R -L -o s6-overlay-amd64.tar.gz https://github.com/just-containers/s6-overlay/releases/download/v$S6_OVERLAY_VER/s6-overlay-amd64.tar.gz \\\n && curl -R -L -o sockexec-x86_64-linux-musl.tar.gz https://github.com/jprjr/sockexec/releases/download/$SOCKEXEC_VER/sockexec-x86_64-linux-musl.tar.gz \\\n && curl -R -L -o openresty-$OPENRESTY_VER.tar.gz https://openresty.org/download/openresty-$OPENRESTY_VER.tar.gz \\\n && curl -R -L -o nginx-rtmp-module-$NGINX_RTMP_VER.tar.gz https://github.com/arut/nginx-rtmp-module/archive/v$NGINX_RTMP_VER.tar.gz \\\n && curl -R -L -o luarocks-$LUAROCKS_VER.tar.gz http://luarocks.github.io/luarocks/releases/luarocks-$LUAROCKS_VER.tar.gz \\\n && tar xzf openresty-$OPENRESTY_VER.tar.gz \\\n && tar xzf nginx-rtmp-module-$NGINX_RTMP_VER.tar.gz \\\n && tar xzf luarocks-$LUAROCKS_VER.tar.gz \\\n && tar xzf s6-overlay-amd64.tar.gz -C / \\\n && tar xzf sockexec-x86_64-linux-musl.tar.gz -C /usr \\\n && cd openresty-$OPENRESTY_VER \\\n && (./configure --prefix=/opt/openresty --with-threads --with-file-aio --with-ipv6 --with-http_ssl_module --with-pcre --with-pcre-jit --with-stream --with-stream_ssl_module --add-module=../nginx-rtmp-module-$NGINX_RTMP_VER \\\n && make \\\n && make install ) \\\n && cd /tmp/openresty-build/luarocks-$LUAROCKS_VER \\\n && ./configure --prefix=/opt/luarocks --with-lua-include=$( pkg-config --variable=includedir lua5.1 ;) \\\n && make \\\n && make build \\\n && make install \\\n && cd / \\\n && rm -rf /tmp/openresty-build\nRUN mkdir /etc/htpasswd-auth-server \\\n && mkdir /etc/redis-auth-server \\\n && adduser -h /home/redisauth -g redisauth -s /sbin/nologin -S -D redisauth \\\n && cd /home/redisauth \\\n && curl -R -L -o redis-auth-server-master.tar.gz https://github.com/jprjr/redis-auth-server/archive/master.tar.gz \\\n && tar xzf redis-auth-server-master.tar.gz \\\n && mv redis-auth-server-master/* . \\\n && rm -rf redis-auth-server-master \\\n && chown -R redisauth:nogroup . \\\n && ln -sf /home/multistreamer/lua_modules ./lua_modules \\\n && rm -rf ./etc \\\n && ln -sf /etc/redis-auth-server ./etc \\\n && adduser -h /home/htpasswdauth -g htpasswdauth -s /sbin/nologin -S -D htpasswdauth \\\n && cd /home/htpasswdauth \\\n && curl -R -L -o htpasswd-auth-server-master.tar.gz https://github.com/jprjr/htpasswd-auth-server/archive/master.tar.gz \\\n && tar xzf htpasswd-auth-server-master.tar.gz \\\n && mv htpasswd-auth-server-master/* . \\\n && rm -rf htpasswd-auth-server-master \\\n && chown -R htpasswdauth:nogroup . \\\n && ln -sf /home/multistreamer/lua_modules ./lua_modules \\\n && rm -rf ./etc \\\n && ln -sf /etc/htpasswd-auth-server ./etc\nRUN adduser -h /home/multistreamer -g multistreamer -s /sbin/nologin -S -D multistreamer \\\n && cd /home/multistreamer \\\n && rm -rf ./* \\\n && git clone https://github.com/jprjr/multistreamer.git . \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lua-resty-exec \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lua-resty-jit-uuid \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lua-resty-http \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lapis \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install etlua \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install luaposix \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install luafilesystem \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install whereami \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install luacrypto \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lyaml \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install redis-lua \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install md5 \\\n && chown -R multistreamer:nogroup . \\\n && mkdir /etc/multistreamer \\\n && mkdir -p /var/log/multistreamer \\\n && chown nobody:nogroup /var/log/multistreamer\nCOPY rootfs /\nENV S6_BEHAVIOUR_IF_STAGE2_FAILS=\"2\"\nENTRYPOINT [\"/init\"]\nEXPOSE 1935/tcp 6667/tcp 8081/tcp\n","injectedSmells":[],"originalDockerfileHash":"f1576a3b36815d2738d784ff6c561f7f","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM alpine:3.7\nARG S6_OVERLAY_VER=1.21.2.2\nARG OPENRESTY_VER=1.13.6.1\nARG NGINX_RTMP_VER=1.2.1\nARG LUAROCKS_VER=2.4.3\nARG MULTISTREAMER_VER=master\nARG SOCKEXEC_VER=2.0.3\nRUN apk add --no-cache bash gcc make musl-dev linux-headers gd-dev geoip-dev libxml2-dev libxslt-dev libressl-dev paxmark pcre-dev yaml-dev yaml perl-dev pkgconf zlib-dev curl git unzip dnsmasq ffmpeg lua5.1-dev lua5.1 pcre libressl2.6-libssl libressl2.6-libtls libressl2.6-libcrypto ca-certificates postgresql-client zlib\nRUN mkdir /tmp/openresty-build \\\n && cd /tmp/openresty-build \\\n && curl -R -L -o s6-overlay-amd64.tar.gz https://github.com/just-containers/s6-overlay/releases/download/v$S6_OVERLAY_VER/s6-overlay-amd64.tar.gz \\\n && curl -R -L -o sockexec-x86_64-linux-musl.tar.gz https://github.com/jprjr/sockexec/releases/download/$SOCKEXEC_VER/sockexec-x86_64-linux-musl.tar.gz \\\n && curl -R -L -o openresty-$OPENRESTY_VER.tar.gz https://openresty.org/download/openresty-$OPENRESTY_VER.tar.gz \\\n && curl -R -L -o nginx-rtmp-module-$NGINX_RTMP_VER.tar.gz https://github.com/arut/nginx-rtmp-module/archive/v$NGINX_RTMP_VER.tar.gz \\\n && curl -R -L -o luarocks-$LUAROCKS_VER.tar.gz http://luarocks.github.io/luarocks/releases/luarocks-$LUAROCKS_VER.tar.gz \\\n && tar xzf openresty-$OPENRESTY_VER.tar.gz \\\n && tar xzf nginx-rtmp-module-$NGINX_RTMP_VER.tar.gz \\\n && tar xzf luarocks-$LUAROCKS_VER.tar.gz \\\n && tar xzf s6-overlay-amd64.tar.gz -C / \\\n && tar xzf sockexec-x86_64-linux-musl.tar.gz -C /usr \\\n && cd openresty-$OPENRESTY_VER \\\n && (./configure --prefix=/opt/openresty --with-threads --with-file-aio --with-ipv6 --with-http_ssl_module --with-pcre --with-pcre-jit --with-stream --with-stream_ssl_module --add-module=../nginx-rtmp-module-$NGINX_RTMP_VER \\\n && make \\\n && make install ) \\\n && cd /tmp/openresty-build/luarocks-$LUAROCKS_VER \\\n && ./configure --prefix=/opt/luarocks --with-lua-include=$( pkg-config --variable=includedir lua5.1 ;) \\\n && make \\\n && make build \\\n && make install \\\n && cd / \\\n && rm -rf /tmp/openresty-build\nRUN mkdir /etc/htpasswd-auth-server \\\n && mkdir /etc/redis-auth-server \\\n && adduser -h /home/redisauth -g redisauth -s /sbin/nologin -S -D redisauth \\\n && cd /home/redisauth \\\n && curl -R -L -o redis-auth-server-master.tar.gz https://github.com/jprjr/redis-auth-server/archive/master.tar.gz \\\n && tar xzf redis-auth-server-master.tar.gz \\\n && mv redis-auth-server-master/* . \\\n && rm -rf redis-auth-server-master \\\n && chown -R redisauth:nogroup . \\\n && ln -sf /home/multistreamer/lua_modules ./lua_modules \\\n && rm -rf ./etc \\\n && ln -sf /etc/redis-auth-server ./etc \\\n && adduser -h /home/htpasswdauth -g htpasswdauth -s /sbin/nologin -S -D htpasswdauth \\\n && cd /home/htpasswdauth \\\n && curl -R -L -o htpasswd-auth-server-master.tar.gz https://github.com/jprjr/htpasswd-auth-server/archive/master.tar.gz \\\n && tar xzf htpasswd-auth-server-master.tar.gz \\\n && mv htpasswd-auth-server-master/* . \\\n && rm -rf htpasswd-auth-server-master \\\n && chown -R htpasswdauth:nogroup . \\\n && ln -sf /home/multistreamer/lua_modules ./lua_modules \\\n && rm -rf ./etc \\\n && ln -sf /etc/htpasswd-auth-server ./etc\nRUN adduser -h /home/multistreamer -g multistreamer -s /sbin/nologin -S -D multistreamer \\\n && cd /home/multistreamer \\\n && rm -rf ./* \\\n && git clone https://github.com/jprjr/multistreamer.git . \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lua-resty-exec \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lua-resty-jit-uuid \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lua-resty-http \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lapis \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install etlua \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install luaposix \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install luafilesystem \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install whereami \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install luacrypto \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install lyaml \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install redis-lua \\\n && /opt/luarocks/bin/luarocks --tree lua_modules install md5 \\\n && chown -R multistreamer:nogroup . \\\n && mkdir /etc/multistreamer \\\n && mkdir -p /var/log/multistreamer \\\n && chown nobody:nogroup /var/log/multistreamer\nCOPY rootfs /\nENV S6_BEHAVIOUR_IF_STAGE2_FAILS=\"2\"\nENTRYPOINT [\"/init\"]\nEXPOSE 1935/tcp 6667/tcp 8081/tcp\n","originalDockerfileUglifiedHash":"f1576a3b36815d2738d784ff6c561f7f","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/793d8425dc8fd7ab39a61291089448eb0741bd4d.dockerfile"}