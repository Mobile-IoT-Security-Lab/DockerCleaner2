{"seed":3908447994,"processedDockerfileHash":"0b1a7b12bbb622956b970261ecd5a807","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"#\n#   Dockerfile for Apache/PHP/MySQL\n#\nFROM alpine:3.6\nMAINTAINER Azure App Service Container Images <appsvc-images@microsoft.com>\n#   ========\n#   ENV vars\n#   ========\n#  apache httpd\nENV HTTPD_VERSION=\"\\\"2.4.33\\\"\"\nENV HTTPD_DOWNLOAD_URL=\"\\\"http://archive.apache.org/dist/httpd/httpd-\\\"$HTTPD_VERSION\\\".tar.gz\\\"\"\nENV HTTPD_SHA256=\"\\\"cd34636caf03c9a897ddfc928fc866c965f23d909b9612880563a7ad0d1a7e5b\\\"\"\nENV HTTPD_SOURCE=\"\\\"/usr/src/httpd\\\"\"\nENV HTTPD_HOME=\"\\\"/usr/local/httpd\\\"\"\nENV HTTPD_CONF_DIR=\"\\\"$HTTPD_HOME/conf\\\"\"\nENV HTTPD_CONF_FILE=\"\\\"$HTTPD_CONF_DIR/httpd.conf\\\"\"\nENV HTTPD_LOG_DIR=\"\\\"/home/LogFiles/httpd\\\"\"\nENV PATH=\"\\\"$HTTPD_HOME/bin\\\":$PATH\"\n#   mariadb\nENV MARIADB_DATA_DIR=\"\\\"/home/data/mysql\\\"\"\nENV MARIADB_LOG_DIR=\"\\\"/home/LogFiles/mysql\\\"\"\n#   supervisor\nENV SUPERVISOR_LOG_DIR=\"\\\"/home/LogFiles/supervisor\\\"\"\n#   php\nENV PHP_VERSION=\"\\\"7.2.4\\\"\"\nENV PHP_DOWNLOAD_URL=\"\\\"https://secure.php.net/get/php-\\\"$PHP_VERSION.tar.gz\\\"/from/this/mirror\\\"\"\nENV PHP_SHA256=\"\\\"58e28e978baea0fe9009432bcb436934eaacccfdcb5f5409c7526431a595857b\\\"\"\nENV PHP_SOURCE=\"\\\"/usr/src/php\\\"\"\nENV PHP_HOME=\"\\\"/usr/local/php\\\"\"\nENV PHP_CONF_DIR=\"$PHP_HOME\\\"/etc\\\"\"\nENV PHP_CONF_FILE=\"$PHP_CONF_DIR\\\"/php.ini\\\"\"\nENV PHP_CONF_DIR_SCAN=\"$PHP_CONF_DIR\\\"/conf.d\\\"\"\nENV PATH=\"\\\"$PHP_HOME/bin\\\":$PATH\"\n#   phpmyadmin\nENV PHPMYADMIN_VERSION=\"\\\"4.8.0\\\"\"\nENV PHPMYADMIN_DOWNLOAD_URL=\"\\\"https://files.phpmyadmin.net/phpMyAdmin/$PHPMYADMIN_VERSION/phpMyAdmin-$PHPMYADMIN_VERSION-all-languages.tar.gz\\\"\"\nENV PHPMYADMIN_SHA256=\"\\\"1e83d60627d8036261af71220eae9ffd8d3150778702720905bcfa85c40ce346\\\"\"\nENV PHPMYADMIN_SOURCE=\"\\\"/usr/src/phpmyadmin\\\"\"\nENV PHPMYADMIN_HOME=\"\\\"/home/phpmyadmin\\\"\"\n#   ssh\nENV SSH_PASSWD=\"\\\"root:Docker!\\\"\"\n#   app\nENV APP_HOME=\"\\\"/home/site/wwwroot\\\"\"\nENV PHPIZE_DEPS=\"\\\" autoconf  dpkg-dev dpkg  file  g++  gcc  libc-dev  make  pcre-dev  pkgconf  re2c\\\"\"\n#\nENV DOCKER_BUILD_HOME=\"\\\"/dockerbuild\\\"\"\n#   ---------------\n#   2. apache httpd\n#   ---------------\nRUN mkdir -p \"$DOCKER_BUILD_HOME\"\nWORKDIR $DOCKER_BUILD_HOME\nRUN set -x \\\n && addgroup -g 82 -S www-data \\\n && adduser -u 82 -D -S -G www-data www-data\n#   82 is the standard uid/gid for \"www-data\" in Alpine\n#   http://git.alpinelinux.org/cgit/aports/tree/main/apache2/apache2.pre-install?h=v3.3.2\n#   http://git.alpinelinux.org/cgit/aports/tree/main/lighttpd/lighttpd.pre-install?h=v3.3.2\n#   http://git.alpinelinux.org/cgit/aports/tree/main/nginx-initscripts/nginx-initscripts.pre-install?h=v3.3.2\n#\nRUN mkdir -p \"$HTTPD_HOME\" \\\n && chown www-data:www-data \"$HTTPD_HOME\" \\\n && mkdir -p \"$HTTPD_SOURCE\" \\\n && runDeps=' apr-dev apr-util-dev apr-util-ldap perl ' \\\n && apk add ca-certificates=20161130-r3 coreutils=8.27-r0 dpkg-dev=1.18.23-r2 dpkg=1.18.23-r2 gcc=6.3.0-r4 gnupg=2.1.20-r1 libc-dev=0.7.1-r0 libressl=2.5.5-r2 libressl-dev=2.5.5-r2 libxml2-dev=2.9.8-r1 lua-dev=5.1.5-r4 make=4.2.1-r0 nghttp2-dev=1.22.0-r0 pcre-dev=8.41-r0 tar=1.32-r0 zlib-dev=1.2.11-r0 $runDeps --no-cache --virtual .build-deps \\\n && cd $DOCKER_BUILD_HOME \\\n && wget -O httpd.tar.gz $HTTPD_DOWNLOAD_URL --no-check-certificate \\\n && echo \"$HTTPD_SHA256 *httpd.tar.gz\" | sha256sum -c - \\\n && tar -xf httpd.tar.gz -C $HTTPD_SOURCE --strip-components=1 \\\n && cd \"$HTTPD_SOURCE\" \\\n && ./configure --prefix=$HTTPD_HOME --with-mpm=prefork --enable-mods-shared=reallyall --enable-ssl --enable-so --enable-deflate \\\n && make -j \"$( nproc ;)\" \\\n && make install \\\n && make clean \\\n && rm -rf $HTTPD_SOURCE $HTTPD_HOME/man $HTTPD_HOME/manual \\\n && rm $DOCKER_BUILD_HOME/httpd.tar.gz \\\n && runDeps=\"$runDeps $( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" \\\n && apk add $runDeps --virtual .httpd-rundeps \\\n && apk del .build-deps \\\n && apk add mariadb=10.1.40-r0 mariadb-client=10.1.40-r0 --update \\\n && mkdir -p $PHP_SOURCE \\\n && mkdir -p $PHP_HOME \\\n && apk add ca-certificates=20161130-r3 curl=7.61.1-r2 tar=1.32-r0 xz=5.2.3-r0 libressl=2.5.5-r2 --no-cache --virtual .persistent-deps \\\n && mkdir -p $PHP_CONF_DIR_SCAN \\\n && cd $DOCKER_BUILD_HOME \\\n && wget -O php.tar.gz \"$PHP_DOWNLOAD_URL\" --no-check-certificate \\\n && echo \"$PHP_SHA256 *php.tar.gz\" | sha256sum -c - \\\n && tar -xf php.tar.gz -C $PHP_SOURCE --strip-components=1 \\\n && apk add coreutils=8.27-r0 curl-dev=7.61.1-r2 libedit-dev=20170329.3.1-r2 libressl-dev=2.5.5-r2 libxml2-dev=2.9.8-r1 sqlite-dev=3.25.3-r0 bzip2-dev=1.0.6-r5 libjpeg-turbo-dev=1.5.3-r2 libpng-dev=1.6.37-r0 gmp-dev=6.1.2-r0 icu-dev=58.2-r2 openldap-dev=2.4.44-r5 libmcrypt-dev=2.5.8-r7 libxslt-dev=1.1.29-r4 apr-dev=1.5.2-r1 apr-util-dev=1.5.4-r3 apr-util-ldap=1.5.4-r3 $PHPIZE_DEPS --no-cache --virtual .build-deps \\\n && cd $PHP_SOURCE \\\n && ./configure --prefix=$PHP_HOME --disable-cgi --enable-bcmath --enable-intl --enable-ftp --enable-mbstring --enable-soap --enable-zip --with-apxs2=$HTTPD_HOME/bin/apxs --with-bz2 --with-config-file-path=$PHP_CONF_DIR --with-config-file-scan-dir=$PHP_CONF_DIR_SCAN --with-curl --with-gd --with-jpeg-dir --with-png-dir --with-gmp --with-ldap --with-mcrypt --with-mhash --with-mysqli=mysqlnd --with-mysql=mysqlnd --with-libedit --with-pcre-regex=/usr --with-openssl --with-pdo-mysql=mysqlnd --with-xsl --with-zlib \\\n && make -j \"$( nproc ;)\" \\\n && make install \\\n && make clean \\\n && rm -rf $PHP_SOURCE \\\n && rm -rf $PHP_HOME/php/man \\\n && rm $DOCKER_BUILD_HOME/php.tar.gz \\\n && runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" \\\n && apk add $runDeps --no-cache --virtual .php-rundeps \\\n && pecl update-channels \\\n && pecl install xdebug-beta \\\n && apk del .build-deps \\\n && rm -rf /tmp/pear ~/.pearrc \\\n && mkdir -p $PHPMYADMIN_SOURCE \\\n && cd $PHPMYADMIN_SOURCE \\\n && wget -O phpmyadmin.tar.gz \"$PHPMYADMIN_DOWNLOAD_URL\" --no-check-certificate \\\n && echo \"$PHPMYADMIN_SHA256 *phpmyadmin.tar.gz\" | sha256sum -c - \\\n && apk add openssh-server=7.5_p1-r4 --update \\\n && echo \"$SSH_PASSWD\" | chpasswd \\\n && apk update \\\n && apk add openrc=0.24.1-r2 \\\n && sed -i 's/\"cgroup_add_service/\" # cgroup_add_service/g' /lib/rc/sh/openrc-run.sh \\\n && apk update \\\n && apk add supervisor=3.2.4-r0 \\\n && rm -rf /var/cache/apk/* /tmp/*\n#   =========\n#   Configure\n#   =========\n#\n#   httpd\nCOPY httpd.conf $HTTPD_CONF_DIR/\nCOPY httpd-modules.conf $HTTPD_CONF_DIR/\nCOPY httpd-php.conf $HTTPD_CONF_DIR/\n#   php\nCOPY php.ini $PHP_CONF_DIR/\nCOPY xdebug.ini $PHP_CONF_DIR_SCAN/\nCOPY php-opcache.ini $PHP_CONF_DIR_SCAN/\n#   phpmyadmin\nCOPY httpd-phpmyadmin.conf $HTTPD_CONF_DIR/\nCOPY phpmyadmin-config.inc.php $PHPMYADMIN_SOURCE/\nCOPY mariadb.cnf /etc/mysql/\n#   ssh\nCOPY sshd_config /etc/ssh/\nRUN set -ex \\\n && echo 'Include conf/httpd-php.conf' >> $HTTPD_CONF_FILE \\\n && test ! -d /var/lib/php/sessions \\\n && mkdir -p /var/lib/php/sessions \\\n && chown www-data:www-data /var/lib/php/sessions \\\n && test ! -d /var/www \\\n && mkdir -p /var/www \\\n && chown -R www-data:www-data /var/www \\\n && rm -rf /var/log/httpd \\\n && ln -s $HTTPD_LOG_DIR /var/log/httpd \\\n && rm -rf /var/log/mysql \\\n && ln -s $MARIADB_LOG_DIR /var/log/mysql \\\n && rm -rf /var/log/supervisor \\\n && ln -s $SUPERVISOR_LOG_DIR /var/log/supervisor \\\n && ln -s $PHPMYADMIN_HOME /var/www/phpmyadmin \\\n && ln -s $APP_HOME /var/www/wwwroot \\\n && rm -f /etc/supervisord.conf\n#\n#   =====\n#   final\n#   =====\nCOPY supervisord.conf /etc/\nCOPY entrypoint.sh /usr/local/bin/\nRUN chmod u+x /usr/local/bin/entrypoint.sh\nEXPOSE 2222/tcp 80/tcp\nENTRYPOINT [\"entrypoint.sh\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#\n#  Dockerfile for Apache/PHP/MySQL\n#\nFROM alpine:3.6\nMAINTAINER Azure App Service Container Images <appsvc-images@microsoft.com>\n#  ========\n#  ENV vars\n#  ========\n# apache httpd\nENV HTTPD_VERSION=\"\\\"2.4.33\\\"\"\nENV HTTPD_DOWNLOAD_URL=\"\\\"http://archive.apache.org/dist/httpd/httpd-\\\"$HTTPD_VERSION\\\".tar.gz\\\"\"\nENV HTTPD_SHA256=\"\\\"cd34636caf03c9a897ddfc928fc866c965f23d909b9612880563a7ad0d1a7e5b\\\"\"\nENV HTTPD_SOURCE=\"\\\"/usr/src/httpd\\\"\"\nENV HTTPD_HOME=\"\\\"/usr/local/httpd\\\"\"\nENV HTTPD_CONF_DIR=\"\\\"$HTTPD_HOME/conf\\\"\"\nENV HTTPD_CONF_FILE=\"\\\"$HTTPD_CONF_DIR/httpd.conf\\\"\"\nENV HTTPD_LOG_DIR=\"\\\"/home/LogFiles/httpd\\\"\"\nENV PATH=\"\\\"$HTTPD_HOME/bin\\\":$PATH\"\n#  mariadb\nENV MARIADB_DATA_DIR=\"\\\"/home/data/mysql\\\"\"\nENV MARIADB_LOG_DIR=\"\\\"/home/LogFiles/mysql\\\"\"\n#  supervisor\nENV SUPERVISOR_LOG_DIR=\"\\\"/home/LogFiles/supervisor\\\"\"\n#  php\nENV PHP_VERSION=\"\\\"7.2.4\\\"\"\nENV PHP_DOWNLOAD_URL=\"\\\"https://secure.php.net/get/php-\\\"$PHP_VERSION.tar.gz\\\"/from/this/mirror\\\"\"\nENV PHP_SHA256=\"\\\"58e28e978baea0fe9009432bcb436934eaacccfdcb5f5409c7526431a595857b\\\"\"\nENV PHP_SOURCE=\"\\\"/usr/src/php\\\"\"\nENV PHP_HOME=\"\\\"/usr/local/php\\\"\"\nENV PHP_CONF_DIR=\"$PHP_HOME\\\"/etc\\\"\"\nENV PHP_CONF_FILE=\"$PHP_CONF_DIR\\\"/php.ini\\\"\"\nENV PHP_CONF_DIR_SCAN=\"$PHP_CONF_DIR\\\"/conf.d\\\"\"\nENV PATH=\"\\\"$PHP_HOME/bin\\\":$PATH\"\n#  phpmyadmin\nENV PHPMYADMIN_VERSION=\"\\\"4.8.0\\\"\"\nENV PHPMYADMIN_DOWNLOAD_URL=\"\\\"https://files.phpmyadmin.net/phpMyAdmin/$PHPMYADMIN_VERSION/phpMyAdmin-$PHPMYADMIN_VERSION-all-languages.tar.gz\\\"\"\nENV PHPMYADMIN_SHA256=\"\\\"1e83d60627d8036261af71220eae9ffd8d3150778702720905bcfa85c40ce346\\\"\"\nENV PHPMYADMIN_SOURCE=\"\\\"/usr/src/phpmyadmin\\\"\"\nENV PHPMYADMIN_HOME=\"\\\"/home/phpmyadmin\\\"\"\n#  ssh\nENV SSH_PASSWD=\"\\\"root:Docker!\\\"\"\n#  app\nENV APP_HOME=\"\\\"/home/site/wwwroot\\\"\"\nENV PHPIZE_DEPS=\"\\\" autoconf  dpkg-dev dpkg  file  g++  gcc  libc-dev  make  pcre-dev  pkgconf  re2c\\\"\"\n#\nENV DOCKER_BUILD_HOME=\"\\\"/dockerbuild\\\"\"\n#  ---------------\n#  2. apache httpd\n#  ---------------\nRUN mkdir -p \"$DOCKER_BUILD_HOME\"\nWORKDIR $DOCKER_BUILD_HOME\nRUN set -x \\\n && addgroup -g 82 -S www-data \\\n && adduser -u 82 -D -S -G www-data www-data\n#  82 is the standard uid/gid for \"www-data\" in Alpine\n#  http://git.alpinelinux.org/cgit/aports/tree/main/apache2/apache2.pre-install?h=v3.3.2\n#  http://git.alpinelinux.org/cgit/aports/tree/main/lighttpd/lighttpd.pre-install?h=v3.3.2\n#  http://git.alpinelinux.org/cgit/aports/tree/main/nginx-initscripts/nginx-initscripts.pre-install?h=v3.3.2\n#\nRUN mkdir -p \"$HTTPD_HOME\" \\\n && chown www-data:www-data \"$HTTPD_HOME\" \\\n && mkdir -p \"$HTTPD_SOURCE\" \\\n && runDeps=' apr-dev apr-util-dev apr-util-ldap perl ' \\\n && apk add --no-cache --virtual .build-deps $runDeps ca-certificates coreutils dpkg-dev dpkg gcc gnupg libc-dev libressl libressl-dev libxml2-dev lua-dev make nghttp2-dev pcre-dev tar zlib-dev \\\n && cd $DOCKER_BUILD_HOME \\\n && wget -O httpd.tar.gz $HTTPD_DOWNLOAD_URL --no-check-certificate \\\n && echo \"$HTTPD_SHA256 *httpd.tar.gz\" | sha256sum -c - \\\n && tar -xf httpd.tar.gz -C $HTTPD_SOURCE --strip-components=1 \\\n && cd \"$HTTPD_SOURCE\" \\\n && ./configure --prefix=$HTTPD_HOME --with-mpm=prefork --enable-mods-shared=reallyall --enable-ssl --enable-so --enable-deflate \\\n && make -j \"$( nproc ;)\" \\\n && make install \\\n && make clean \\\n && rm -rf $HTTPD_SOURCE $HTTPD_HOME/man $HTTPD_HOME/manual \\\n && rm $DOCKER_BUILD_HOME/httpd.tar.gz \\\n && runDeps=\"$runDeps $( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" \\\n && apk add --virtual .httpd-rundeps $runDeps \\\n && apk del .build-deps \\\n && apk add --update mariadb mariadb-client \\\n && mkdir -p $PHP_SOURCE \\\n && mkdir -p $PHP_HOME \\\n && apk add --no-cache --virtual .persistent-deps ca-certificates curl tar xz libressl \\\n && mkdir -p $PHP_CONF_DIR_SCAN \\\n && cd $DOCKER_BUILD_HOME \\\n && wget -O php.tar.gz \"$PHP_DOWNLOAD_URL\" --no-check-certificate \\\n && echo \"$PHP_SHA256 *php.tar.gz\" | sha256sum -c - \\\n && tar -xf php.tar.gz -C $PHP_SOURCE --strip-components=1 \\\n && apk add --no-cache --virtual .build-deps $PHPIZE_DEPS coreutils curl-dev libedit-dev libressl-dev libxml2-dev sqlite-dev bzip2-dev libjpeg-turbo-dev libpng-dev gmp-dev icu-dev openldap-dev libmcrypt-dev libxslt-dev apr-dev apr-util-dev apr-util-ldap \\\n && cd $PHP_SOURCE \\\n && ./configure --prefix=$PHP_HOME --disable-cgi --enable-bcmath --enable-intl --enable-ftp --enable-mbstring --enable-soap --enable-zip --with-apxs2=$HTTPD_HOME/bin/apxs --with-bz2 --with-config-file-path=$PHP_CONF_DIR --with-config-file-scan-dir=$PHP_CONF_DIR_SCAN --with-curl --with-gd --with-jpeg-dir --with-png-dir --with-gmp --with-ldap --with-mcrypt --with-mhash --with-mysqli=mysqlnd --with-mysql=mysqlnd --with-libedit --with-pcre-regex=/usr --with-openssl --with-pdo-mysql=mysqlnd --with-xsl --with-zlib \\\n && make -j \"$( nproc ;)\" \\\n && make install \\\n && make clean \\\n && rm -rf $PHP_SOURCE \\\n && rm -rf $PHP_HOME/php/man \\\n && rm $DOCKER_BUILD_HOME/php.tar.gz \\\n && runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" \\\n && apk add --no-cache --virtual .php-rundeps $runDeps \\\n && pecl update-channels \\\n && pecl install xdebug-beta \\\n && apk del .build-deps \\\n && rm -rf /tmp/pear ~/.pearrc \\\n && mkdir -p $PHPMYADMIN_SOURCE \\\n && cd $PHPMYADMIN_SOURCE \\\n && wget -O phpmyadmin.tar.gz \"$PHPMYADMIN_DOWNLOAD_URL\" --no-check-certificate \\\n && echo \"$PHPMYADMIN_SHA256 *phpmyadmin.tar.gz\" | sha256sum -c - \\\n && apk add --update openssh-server \\\n && echo \"$SSH_PASSWD\" | chpasswd \\\n && apk update \\\n && apk add openrc \\\n && sed -i 's/\"cgroup_add_service/\" # cgroup_add_service/g' /lib/rc/sh/openrc-run.sh \\\n && apk update \\\n && apk add supervisor \\\n && rm -rf /var/cache/apk/* /tmp/*\n#  =========\n#  Configure\n#  =========\n#\n#  httpd\nCOPY httpd.conf $HTTPD_CONF_DIR/\nCOPY httpd-modules.conf $HTTPD_CONF_DIR/\nCOPY httpd-php.conf $HTTPD_CONF_DIR/\n#  php\nCOPY php.ini $PHP_CONF_DIR/\nCOPY xdebug.ini $PHP_CONF_DIR_SCAN/\nCOPY php-opcache.ini $PHP_CONF_DIR_SCAN/\n#  phpmyadmin\nCOPY httpd-phpmyadmin.conf $HTTPD_CONF_DIR/\nCOPY phpmyadmin-config.inc.php $PHPMYADMIN_SOURCE/\nCOPY mariadb.cnf /etc/mysql/\n#  ssh\nCOPY sshd_config /etc/ssh/\nRUN set -ex \\\n && echo 'Include conf/httpd-php.conf' >> $HTTPD_CONF_FILE \\\n && test ! -d /var/lib/php/sessions \\\n && mkdir -p /var/lib/php/sessions \\\n && chown www-data:www-data /var/lib/php/sessions \\\n && test ! -d /var/www \\\n && mkdir -p /var/www \\\n && chown -R www-data:www-data /var/www \\\n && rm -rf /var/log/httpd \\\n && ln -s $HTTPD_LOG_DIR /var/log/httpd \\\n && rm -rf /var/log/mysql \\\n && ln -s $MARIADB_LOG_DIR /var/log/mysql \\\n && rm -rf /var/log/supervisor \\\n && ln -s $SUPERVISOR_LOG_DIR /var/log/supervisor \\\n && ln -s $PHPMYADMIN_HOME /var/www/phpmyadmin \\\n && ln -s $APP_HOME /var/www/wwwroot \\\n && rm -f /etc/supervisord.conf\n#\n#  =====\n#  final\n#  =====\nCOPY supervisord.conf /etc/\nCOPY entrypoint.sh /usr/local/bin/\nRUN chmod u+x /usr/local/bin/entrypoint.sh\nEXPOSE 2222/tcp 80/tcp\nENTRYPOINT [\"entrypoint.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"11d92ed05a5ce092c607e10de8f62efa","successfullyInjectedSmells":[],"originalDockerfileUglified":"#\n#   Dockerfile for Apache/PHP/MySQL\n#\nFROM alpine:3.6\nMAINTAINER Azure App Service Container Images <appsvc-images@microsoft.com>\n#   ========\n#   ENV vars\n#   ========\n#  apache httpd\nENV HTTPD_VERSION=\"\\\"2.4.33\\\"\"\nENV HTTPD_DOWNLOAD_URL=\"\\\"http://archive.apache.org/dist/httpd/httpd-\\\"$HTTPD_VERSION\\\".tar.gz\\\"\"\nENV HTTPD_SHA256=\"\\\"cd34636caf03c9a897ddfc928fc866c965f23d909b9612880563a7ad0d1a7e5b\\\"\"\nENV HTTPD_SOURCE=\"\\\"/usr/src/httpd\\\"\"\nENV HTTPD_HOME=\"\\\"/usr/local/httpd\\\"\"\nENV HTTPD_CONF_DIR=\"\\\"$HTTPD_HOME/conf\\\"\"\nENV HTTPD_CONF_FILE=\"\\\"$HTTPD_CONF_DIR/httpd.conf\\\"\"\nENV HTTPD_LOG_DIR=\"\\\"/home/LogFiles/httpd\\\"\"\nENV PATH=\"\\\"$HTTPD_HOME/bin\\\":$PATH\"\n#   mariadb\nENV MARIADB_DATA_DIR=\"\\\"/home/data/mysql\\\"\"\nENV MARIADB_LOG_DIR=\"\\\"/home/LogFiles/mysql\\\"\"\n#   supervisor\nENV SUPERVISOR_LOG_DIR=\"\\\"/home/LogFiles/supervisor\\\"\"\n#   php\nENV PHP_VERSION=\"\\\"7.2.4\\\"\"\nENV PHP_DOWNLOAD_URL=\"\\\"https://secure.php.net/get/php-\\\"$PHP_VERSION.tar.gz\\\"/from/this/mirror\\\"\"\nENV PHP_SHA256=\"\\\"58e28e978baea0fe9009432bcb436934eaacccfdcb5f5409c7526431a595857b\\\"\"\nENV PHP_SOURCE=\"\\\"/usr/src/php\\\"\"\nENV PHP_HOME=\"\\\"/usr/local/php\\\"\"\nENV PHP_CONF_DIR=\"$PHP_HOME\\\"/etc\\\"\"\nENV PHP_CONF_FILE=\"$PHP_CONF_DIR\\\"/php.ini\\\"\"\nENV PHP_CONF_DIR_SCAN=\"$PHP_CONF_DIR\\\"/conf.d\\\"\"\nENV PATH=\"\\\"$PHP_HOME/bin\\\":$PATH\"\n#   phpmyadmin\nENV PHPMYADMIN_VERSION=\"\\\"4.8.0\\\"\"\nENV PHPMYADMIN_DOWNLOAD_URL=\"\\\"https://files.phpmyadmin.net/phpMyAdmin/$PHPMYADMIN_VERSION/phpMyAdmin-$PHPMYADMIN_VERSION-all-languages.tar.gz\\\"\"\nENV PHPMYADMIN_SHA256=\"\\\"1e83d60627d8036261af71220eae9ffd8d3150778702720905bcfa85c40ce346\\\"\"\nENV PHPMYADMIN_SOURCE=\"\\\"/usr/src/phpmyadmin\\\"\"\nENV PHPMYADMIN_HOME=\"\\\"/home/phpmyadmin\\\"\"\n#   ssh\nENV SSH_PASSWD=\"\\\"root:Docker!\\\"\"\n#   app\nENV APP_HOME=\"\\\"/home/site/wwwroot\\\"\"\nENV PHPIZE_DEPS=\"\\\" autoconf  dpkg-dev dpkg  file  g++  gcc  libc-dev  make  pcre-dev  pkgconf  re2c\\\"\"\n#\nENV DOCKER_BUILD_HOME=\"\\\"/dockerbuild\\\"\"\n#   ---------------\n#   2. apache httpd\n#   ---------------\nRUN mkdir -p \"$DOCKER_BUILD_HOME\"\nWORKDIR $DOCKER_BUILD_HOME\nRUN set -x \\\n && addgroup -g 82 -S www-data \\\n && adduser -u 82 -D -S -G www-data www-data\n#   82 is the standard uid/gid for \"www-data\" in Alpine\n#   http://git.alpinelinux.org/cgit/aports/tree/main/apache2/apache2.pre-install?h=v3.3.2\n#   http://git.alpinelinux.org/cgit/aports/tree/main/lighttpd/lighttpd.pre-install?h=v3.3.2\n#   http://git.alpinelinux.org/cgit/aports/tree/main/nginx-initscripts/nginx-initscripts.pre-install?h=v3.3.2\n#\nRUN mkdir -p \"$HTTPD_HOME\" \\\n && chown www-data:www-data \"$HTTPD_HOME\" \\\n && mkdir -p \"$HTTPD_SOURCE\" \\\n && runDeps=' apr-dev apr-util-dev apr-util-ldap perl ' \\\n && apk add --no-cache --virtual .build-deps $runDeps ca-certificates coreutils dpkg-dev dpkg gcc gnupg libc-dev libressl libressl-dev libxml2-dev lua-dev make nghttp2-dev pcre-dev tar zlib-dev \\\n && cd $DOCKER_BUILD_HOME \\\n && wget -O httpd.tar.gz $HTTPD_DOWNLOAD_URL --no-check-certificate \\\n && echo \"$HTTPD_SHA256 *httpd.tar.gz\" | sha256sum -c - \\\n && tar -xf httpd.tar.gz -C $HTTPD_SOURCE --strip-components=1 \\\n && cd \"$HTTPD_SOURCE\" \\\n && ./configure --prefix=$HTTPD_HOME --with-mpm=prefork --enable-mods-shared=reallyall --enable-ssl --enable-so --enable-deflate \\\n && make -j \"$( nproc ;)\" \\\n && make install \\\n && make clean \\\n && rm -rf $HTTPD_SOURCE $HTTPD_HOME/man $HTTPD_HOME/manual \\\n && rm $DOCKER_BUILD_HOME/httpd.tar.gz \\\n && runDeps=\"$runDeps $( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" \\\n && apk add --virtual .httpd-rundeps $runDeps \\\n && apk del .build-deps \\\n && apk add --update mariadb mariadb-client \\\n && mkdir -p $PHP_SOURCE \\\n && mkdir -p $PHP_HOME \\\n && apk add --no-cache --virtual .persistent-deps ca-certificates curl tar xz libressl \\\n && mkdir -p $PHP_CONF_DIR_SCAN \\\n && cd $DOCKER_BUILD_HOME \\\n && wget -O php.tar.gz \"$PHP_DOWNLOAD_URL\" --no-check-certificate \\\n && echo \"$PHP_SHA256 *php.tar.gz\" | sha256sum -c - \\\n && tar -xf php.tar.gz -C $PHP_SOURCE --strip-components=1 \\\n && apk add --no-cache --virtual .build-deps $PHPIZE_DEPS coreutils curl-dev libedit-dev libressl-dev libxml2-dev sqlite-dev bzip2-dev libjpeg-turbo-dev libpng-dev gmp-dev icu-dev openldap-dev libmcrypt-dev libxslt-dev apr-dev apr-util-dev apr-util-ldap \\\n && cd $PHP_SOURCE \\\n && ./configure --prefix=$PHP_HOME --disable-cgi --enable-bcmath --enable-intl --enable-ftp --enable-mbstring --enable-soap --enable-zip --with-apxs2=$HTTPD_HOME/bin/apxs --with-bz2 --with-config-file-path=$PHP_CONF_DIR --with-config-file-scan-dir=$PHP_CONF_DIR_SCAN --with-curl --with-gd --with-jpeg-dir --with-png-dir --with-gmp --with-ldap --with-mcrypt --with-mhash --with-mysqli=mysqlnd --with-mysql=mysqlnd --with-libedit --with-pcre-regex=/usr --with-openssl --with-pdo-mysql=mysqlnd --with-xsl --with-zlib \\\n && make -j \"$( nproc ;)\" \\\n && make install \\\n && make clean \\\n && rm -rf $PHP_SOURCE \\\n && rm -rf $PHP_HOME/php/man \\\n && rm $DOCKER_BUILD_HOME/php.tar.gz \\\n && runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" \\\n && apk add --no-cache --virtual .php-rundeps $runDeps \\\n && pecl update-channels \\\n && pecl install xdebug-beta \\\n && apk del .build-deps \\\n && rm -rf /tmp/pear ~/.pearrc \\\n && mkdir -p $PHPMYADMIN_SOURCE \\\n && cd $PHPMYADMIN_SOURCE \\\n && wget -O phpmyadmin.tar.gz \"$PHPMYADMIN_DOWNLOAD_URL\" --no-check-certificate \\\n && echo \"$PHPMYADMIN_SHA256 *phpmyadmin.tar.gz\" | sha256sum -c - \\\n && apk add --update openssh-server \\\n && echo \"$SSH_PASSWD\" | chpasswd \\\n && apk update \\\n && apk add openrc \\\n && sed -i 's/\"cgroup_add_service/\" # cgroup_add_service/g' /lib/rc/sh/openrc-run.sh \\\n && apk update \\\n && apk add supervisor \\\n && rm -rf /var/cache/apk/* /tmp/*\n#   =========\n#   Configure\n#   =========\n#\n#   httpd\nCOPY httpd.conf $HTTPD_CONF_DIR/\nCOPY httpd-modules.conf $HTTPD_CONF_DIR/\nCOPY httpd-php.conf $HTTPD_CONF_DIR/\n#   php\nCOPY php.ini $PHP_CONF_DIR/\nCOPY xdebug.ini $PHP_CONF_DIR_SCAN/\nCOPY php-opcache.ini $PHP_CONF_DIR_SCAN/\n#   phpmyadmin\nCOPY httpd-phpmyadmin.conf $HTTPD_CONF_DIR/\nCOPY phpmyadmin-config.inc.php $PHPMYADMIN_SOURCE/\nCOPY mariadb.cnf /etc/mysql/\n#   ssh\nCOPY sshd_config /etc/ssh/\nRUN set -ex \\\n && echo 'Include conf/httpd-php.conf' >> $HTTPD_CONF_FILE \\\n && test ! -d /var/lib/php/sessions \\\n && mkdir -p /var/lib/php/sessions \\\n && chown www-data:www-data /var/lib/php/sessions \\\n && test ! -d /var/www \\\n && mkdir -p /var/www \\\n && chown -R www-data:www-data /var/www \\\n && rm -rf /var/log/httpd \\\n && ln -s $HTTPD_LOG_DIR /var/log/httpd \\\n && rm -rf /var/log/mysql \\\n && ln -s $MARIADB_LOG_DIR /var/log/mysql \\\n && rm -rf /var/log/supervisor \\\n && ln -s $SUPERVISOR_LOG_DIR /var/log/supervisor \\\n && ln -s $PHPMYADMIN_HOME /var/www/phpmyadmin \\\n && ln -s $APP_HOME /var/www/wwwroot \\\n && rm -f /etc/supervisord.conf\n#\n#   =====\n#   final\n#   =====\nCOPY supervisord.conf /etc/\nCOPY entrypoint.sh /usr/local/bin/\nRUN chmod u+x /usr/local/bin/entrypoint.sh\nEXPOSE 2222/tcp 80/tcp\nENTRYPOINT [\"entrypoint.sh\"]\n","originalDockerfileUglifiedHash":"3bd59dbe7f162a40447d1644d3191e84","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/290f633841c0b16388f735d5be1669c8cb0bc1f4.dockerfile"}