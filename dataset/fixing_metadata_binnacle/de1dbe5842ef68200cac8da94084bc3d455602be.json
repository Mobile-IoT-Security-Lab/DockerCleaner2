{"seed":1107378907,"processedDockerfileHash":"0fea557956cd6e980a1e4dddcc519697","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["do-not-use-apt-get-update-alone","pin-package-manager-versions-pip","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"#\n#   Based on\n#  \thttps://github.com/cazcade/docker-grafana-graphite\n#\nFROM debian:wheezy\nMAINTAINER Brian Scully <scullduggery@gmail.com>\nRUN echo 'deb http://http.debian.net/debian wheezy-backports main' >> /etc/apt/sources.list.d/wheezy-backports.list\n#   RUN echo 'deb http://us.archive.ubuntu.com/ubuntu/ trusty universe' >> /etc/apt/sources.list\n#   Logstash\nRUN echo 'deb http://packages.elasticsearch.org/logstash/1.4/debian stable main' >> /etc/apt/sources.list.d/logstash.list\nRUN : \\\n && apt-get -y upgrade\n#   Prerequisites\nRUN (apt-get update ;apt-get install --no-install-recommends python python-colorama python-simplejson python-memcache python-ldap python-cairo libffi-dev python-pysqlite2 python-support python-pip gunicorn python-dev libpq-dev build-essential supervisor nginx-light git wget curl -y )\n#   Node\nRUN (apt-get update ;apt-get install --no-install-recommends software-properties-common -y )\nRUN apt-get -y --no-install-recommends -t wheezy-backports install nodejs\n#   Elasticsearch\nRUN (apt-get update ;apt-get install --no-install-recommends openjdk-7-jre adduser -y )\n#   Install Elasticsearch\nRUN groupadd -f -g 101 elasticsearch \\\n && useradd -u 1001 -g elasticsearch elasticsearch \\\n && mkdir -p /home/elasticsearch \\\n && chown -R elasticsearch:elasticsearch /home/elasticsearch \\\n && cd ~ \\\n && wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.4.0.deb \\\n && dpkg -i elasticsearch-1.4.0.deb \\\n && rm elasticsearch-1.4.0.deb\n#   Install Redis, Logstash\nRUN (wget -O - http://packages.elasticsearch.org/GPG-KEY-elasticsearch | apt-key add - ) \\\n && :\nRUN (apt-get update ;apt-get install --no-install-recommends redis-server logstash -y )\n#   Install StatsD\nRUN mkdir /src \\\n && git clone https://github.com/etsy/statsd.git /src/statsd\n#   Install Whisper, Carbon and Graphite-Web\nRUN pip install pip==23.1 --index-url=https://pypi.python.org/simple/ --upgrade\nRUN pip install Twisted==11.1.0 Django==1.5 whisper==0.9.14 'django-tagging<0.4'\nRUN pip install carbon==0.9.14 --install-option=\"--prefix=/var/lib/graphite\" --install-option=\"--install-lib=/var/lib/graphite/lib\" \\\n && pip install graphite-web==0.9.14 --install-option=\"--prefix=/var/lib/graphite\" --install-option=\"--install-lib=/var/lib/graphite/webapp\"\n#   Install Grafana\nRUN mkdir /src/grafana \\\n && cd /src/grafana \\\n && wget http://grafanarel.s3.amazonaws.com/grafana-1.8.1.tar.gz \\\n && tar xzvf grafana-1.8.1.tar.gz --strip-components=1 \\\n && rm grafana-1.8.1.tar.gz\n#   Install Kibana\nRUN mkdir /src/kibana \\\n && cd /src/kibana \\\n && wget https://download.elasticsearch.org/kibana/kibana/kibana-3.1.2.tar.gz \\\n && tar xzvf kibana-3.1.2.tar.gz --strip-components=1 \\\n && rm kibana-3.1.2.tar.gz\n#   Configure Elasticsearch\nCOPY ./elasticsearch/run /usr/local/bin/run_elasticsearch\nRUN chmod +x /usr/local/bin/run_elasticsearch \\\n && mkdir -p /logs/elasticsearch \\\n && chown elasticsearch:elasticsearch /logs/elasticsearch \\\n && mkdir -p /data/elasticsearch \\\n && chown elasticsearch:elasticsearch /data/elasticsearch \\\n && mkdir -p /tmp/elasticsearch \\\n && chown elasticsearch:elasticsearch /tmp/elasticsearch\n#   Configure Logstash\nCOPY ./logstash/001-redis-input.conf /etc/logstash/conf.d/001-redis-input.conf\nCOPY ./logstash/002-tcp-json-input.conf /etc/logstash/conf.d/002-tcp-json-input.conf\nCOPY ./logstash/999-elasticsearch-output.conf /etc/logstash/conf.d/999-elasticsearch-output.conf\n#   Confiure StatsD\nCOPY ./statsd/config.js /src/statsd/config.js\n#   Configure Whisper, Carbon and Graphite-Web\nCOPY ./graphite/initial_data.json /var/lib/graphite/webapp/graphite/initial_data.json\nCOPY ./graphite/local_settings.py /var/lib/graphite/webapp/graphite/local_settings.py\nCOPY ./graphite/carbon.conf /var/lib/graphite/conf/carbon.conf\nCOPY ./graphite/storage-schemas.conf /var/lib/graphite/conf/storage-schemas.conf\nCOPY ./graphite/storage-aggregation.conf /var/lib/graphite/conf/storage-aggregation.conf\nRUN mkdir -p /var/lib/graphite \\\n && chown -R www-data:www-data /var/lib/graphite \\\n && mkdir -p /data/graphite \\\n && chown www-data:www-data /data/graphite \\\n && rm -rf /var/lib/graphite/storage/whisper \\\n && ln -s /data/graphite /var/lib/graphite/storage/whisper\nRUN cd /var/lib/graphite/webapp/graphite \\\n && python manage.py syncdb --noinput \\\n && chown -R www-data:www-data /var/lib/graphite\n#   Configure Grafana\nCOPY ./grafana/config.js /src/grafana/config.js\n#   Configure Kibana\nCOPY ./kibana/config.js /src/kibana/config.js\n#   Configure nginx and supervisord\nCOPY ./nginx/nginx.conf /etc/nginx/nginx.conf\nCOPY ./supervisord.conf /etc/supervisor/conf.d/supervisord.conf\nRUN mkdir -p /logs/supervisor \\\n && touch /logs/supervisor/supervisord.log \\\n && mkdir -p /logs/nginx \\\n && chown www-data:www-data /logs/nginx\n#   Grafana\nEXPOSE 80/tcp\n#   Kibana\nEXPOSE 81/tcp\n#   Logstash TCP\nEXPOSE 4560/tcp\n#   Graphite (Carbon)\nEXPOSE 2003/tcp\n#   Graphite web-ui\nEXPOSE 8000/tcp\n#   Redis\nEXPOSE 6379/tcp\n#   Elasticserach\nEXPOSE 9200/tcp\n#   StatsD\nEXPOSE 8125/udp\nEXPOSE 8126/tcp\nVOLUME [\"/data/graphite\",\"/data/elasticsearch\"]\nVOLUME [\"/logs/elasticsearch\",\"/logs/supervisor\",\"/logs/nginx\"]\nCMD [\"/usr/bin/supervisord\", \"-c\", \"/etc/supervisor/supervisord.conf\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#\n#  Based on\n# \thttps://github.com/cazcade/docker-grafana-graphite\n#\nFROM debian:wheezy\nMAINTAINER Brian Scully <scullduggery@gmail.com>\nRUN echo 'deb http://http.debian.net/debian wheezy-backports main' >> /etc/apt/sources.list.d/wheezy-backports.list\n#  RUN echo 'deb http://us.archive.ubuntu.com/ubuntu/ trusty universe' >> /etc/apt/sources.list\n#  Logstash\nRUN echo 'deb http://packages.elasticsearch.org/logstash/1.4/debian stable main' >> /etc/apt/sources.list.d/logstash.list\nRUN apt-get update -y \\\n && apt-get -y upgrade\n#  Prerequisites\nRUN apt-get install --no-install-recommends python python-colorama python-simplejson python-memcache python-ldap python-cairo libffi-dev python-pysqlite2 python-support python-pip gunicorn python-dev libpq-dev build-essential supervisor nginx-light git wget curl -y\n#  Node\nRUN apt-get install --no-install-recommends software-properties-common -y\nRUN apt-get -y --no-install-recommends -t wheezy-backports install nodejs\n#  Elasticsearch\nRUN apt-get install --no-install-recommends openjdk-7-jre adduser -y\n#  Install Elasticsearch\nRUN groupadd -f -g 101 elasticsearch \\\n && useradd -u 1001 -g elasticsearch elasticsearch \\\n && mkdir -p /home/elasticsearch \\\n && chown -R elasticsearch:elasticsearch /home/elasticsearch \\\n && cd ~ \\\n && wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.4.0.deb \\\n && dpkg -i elasticsearch-1.4.0.deb \\\n && rm elasticsearch-1.4.0.deb\n#  Install Redis, Logstash\nRUN (wget -O - http://packages.elasticsearch.org/GPG-KEY-elasticsearch | apt-key add - ) \\\n && apt-get update -y\nRUN apt-get install --no-install-recommends redis-server logstash -y\n#  Install StatsD\nRUN mkdir /src \\\n && git clone https://github.com/etsy/statsd.git /src/statsd\n#  Install Whisper, Carbon and Graphite-Web\nRUN pip install pip --index-url=https://pypi.python.org/simple/ --upgrade\nRUN pip install Twisted==11.1.0 Django==1.5 whisper==0.9.14 'django-tagging<0.4'\nRUN pip install carbon==0.9.14 --install-option=\"--prefix=/var/lib/graphite\" --install-option=\"--install-lib=/var/lib/graphite/lib\" \\\n && pip install graphite-web==0.9.14 --install-option=\"--prefix=/var/lib/graphite\" --install-option=\"--install-lib=/var/lib/graphite/webapp\"\n#  Install Grafana\nRUN mkdir /src/grafana \\\n && cd /src/grafana \\\n && wget http://grafanarel.s3.amazonaws.com/grafana-1.8.1.tar.gz \\\n && tar xzvf grafana-1.8.1.tar.gz --strip-components=1 \\\n && rm grafana-1.8.1.tar.gz\n#  Install Kibana\nRUN mkdir /src/kibana \\\n && cd /src/kibana \\\n && wget https://download.elasticsearch.org/kibana/kibana/kibana-3.1.2.tar.gz \\\n && tar xzvf kibana-3.1.2.tar.gz --strip-components=1 \\\n && rm kibana-3.1.2.tar.gz\n#  Configure Elasticsearch\nADD ./elasticsearch/run /usr/local/bin/run_elasticsearch\nRUN chmod +x /usr/local/bin/run_elasticsearch \\\n && mkdir -p /logs/elasticsearch \\\n && chown elasticsearch:elasticsearch /logs/elasticsearch \\\n && mkdir -p /data/elasticsearch \\\n && chown elasticsearch:elasticsearch /data/elasticsearch \\\n && mkdir -p /tmp/elasticsearch \\\n && chown elasticsearch:elasticsearch /tmp/elasticsearch\n#  Configure Logstash\nADD ./logstash/001-redis-input.conf /etc/logstash/conf.d/001-redis-input.conf\nADD ./logstash/002-tcp-json-input.conf /etc/logstash/conf.d/002-tcp-json-input.conf\nADD ./logstash/999-elasticsearch-output.conf /etc/logstash/conf.d/999-elasticsearch-output.conf\n#  Confiure StatsD\nADD ./statsd/config.js /src/statsd/config.js\n#  Configure Whisper, Carbon and Graphite-Web\nADD ./graphite/initial_data.json /var/lib/graphite/webapp/graphite/initial_data.json\nADD ./graphite/local_settings.py /var/lib/graphite/webapp/graphite/local_settings.py\nADD ./graphite/carbon.conf /var/lib/graphite/conf/carbon.conf\nADD ./graphite/storage-schemas.conf /var/lib/graphite/conf/storage-schemas.conf\nADD ./graphite/storage-aggregation.conf /var/lib/graphite/conf/storage-aggregation.conf\nRUN mkdir -p /var/lib/graphite \\\n && chown -R www-data:www-data /var/lib/graphite \\\n && mkdir -p /data/graphite \\\n && chown www-data:www-data /data/graphite \\\n && rm -rf /var/lib/graphite/storage/whisper \\\n && ln -s /data/graphite /var/lib/graphite/storage/whisper\nRUN cd /var/lib/graphite/webapp/graphite \\\n && python manage.py syncdb --noinput \\\n && chown -R www-data:www-data /var/lib/graphite\n#  Configure Grafana\nADD ./grafana/config.js /src/grafana/config.js\n#  Configure Kibana\nADD ./kibana/config.js /src/kibana/config.js\n#  Configure nginx and supervisord\nADD ./nginx/nginx.conf /etc/nginx/nginx.conf\nADD ./supervisord.conf /etc/supervisor/conf.d/supervisord.conf\nRUN mkdir -p /logs/supervisor \\\n && touch /logs/supervisor/supervisord.log \\\n && mkdir -p /logs/nginx \\\n && chown www-data:www-data /logs/nginx\n#  Grafana\nEXPOSE 80/tcp\n#  Kibana\nEXPOSE 81/tcp\n#  Logstash TCP\nEXPOSE 4560/tcp\n#  Graphite (Carbon)\nEXPOSE 2003/tcp\n#  Graphite web-ui\nEXPOSE 8000/tcp\n#  Redis\nEXPOSE 6379/tcp\n#  Elasticserach\nEXPOSE 9200/tcp\n#  StatsD\nEXPOSE 8125/udp\nEXPOSE 8126/tcp\nVOLUME [\"/data/graphite\",\"/data/elasticsearch\"]\nVOLUME [\"/logs/elasticsearch\",\"/logs/supervisor\",\"/logs/nginx\"]\nCMD [\"/usr/bin/supervisord\", \"-c\", \"/etc/supervisor/supervisord.conf\"]\n","injectedSmells":[],"originalDockerfileHash":"1ce314a0a08eec7f39b6b4ac420142db","successfullyInjectedSmells":[],"originalDockerfileUglified":"#\n#   Based on\n#  \thttps://github.com/cazcade/docker-grafana-graphite\n#\nFROM debian:wheezy\nMAINTAINER Brian Scully <scullduggery@gmail.com>\nRUN echo 'deb http://http.debian.net/debian wheezy-backports main' >> /etc/apt/sources.list.d/wheezy-backports.list\n#   RUN echo 'deb http://us.archive.ubuntu.com/ubuntu/ trusty universe' >> /etc/apt/sources.list\n#   Logstash\nRUN echo 'deb http://packages.elasticsearch.org/logstash/1.4/debian stable main' >> /etc/apt/sources.list.d/logstash.list\nRUN apt-get update -y \\\n && apt-get -y upgrade\n#   Prerequisites\nRUN apt-get install --no-install-recommends python python-colorama python-simplejson python-memcache python-ldap python-cairo libffi-dev python-pysqlite2 python-support python-pip gunicorn python-dev libpq-dev build-essential supervisor nginx-light git wget curl -y\n#   Node\nRUN apt-get install --no-install-recommends software-properties-common -y\nRUN apt-get -y --no-install-recommends -t wheezy-backports install nodejs\n#   Elasticsearch\nRUN apt-get install --no-install-recommends openjdk-7-jre adduser -y\n#   Install Elasticsearch\nRUN groupadd -f -g 101 elasticsearch \\\n && useradd -u 1001 -g elasticsearch elasticsearch \\\n && mkdir -p /home/elasticsearch \\\n && chown -R elasticsearch:elasticsearch /home/elasticsearch \\\n && cd ~ \\\n && wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.4.0.deb \\\n && dpkg -i elasticsearch-1.4.0.deb \\\n && rm elasticsearch-1.4.0.deb\n#   Install Redis, Logstash\nRUN (wget -O - http://packages.elasticsearch.org/GPG-KEY-elasticsearch | apt-key add - ) \\\n && apt-get update -y\nRUN apt-get install --no-install-recommends redis-server logstash -y\n#   Install StatsD\nRUN mkdir /src \\\n && git clone https://github.com/etsy/statsd.git /src/statsd\n#   Install Whisper, Carbon and Graphite-Web\nRUN pip install pip --index-url=https://pypi.python.org/simple/ --upgrade\nRUN pip install Twisted==11.1.0 Django==1.5 whisper==0.9.14 'django-tagging<0.4'\nRUN pip install carbon==0.9.14 --install-option=\"--prefix=/var/lib/graphite\" --install-option=\"--install-lib=/var/lib/graphite/lib\" \\\n && pip install graphite-web==0.9.14 --install-option=\"--prefix=/var/lib/graphite\" --install-option=\"--install-lib=/var/lib/graphite/webapp\"\n#   Install Grafana\nRUN mkdir /src/grafana \\\n && cd /src/grafana \\\n && wget http://grafanarel.s3.amazonaws.com/grafana-1.8.1.tar.gz \\\n && tar xzvf grafana-1.8.1.tar.gz --strip-components=1 \\\n && rm grafana-1.8.1.tar.gz\n#   Install Kibana\nRUN mkdir /src/kibana \\\n && cd /src/kibana \\\n && wget https://download.elasticsearch.org/kibana/kibana/kibana-3.1.2.tar.gz \\\n && tar xzvf kibana-3.1.2.tar.gz --strip-components=1 \\\n && rm kibana-3.1.2.tar.gz\n#   Configure Elasticsearch\nADD ./elasticsearch/run /usr/local/bin/run_elasticsearch\nRUN chmod +x /usr/local/bin/run_elasticsearch \\\n && mkdir -p /logs/elasticsearch \\\n && chown elasticsearch:elasticsearch /logs/elasticsearch \\\n && mkdir -p /data/elasticsearch \\\n && chown elasticsearch:elasticsearch /data/elasticsearch \\\n && mkdir -p /tmp/elasticsearch \\\n && chown elasticsearch:elasticsearch /tmp/elasticsearch\n#   Configure Logstash\nADD ./logstash/001-redis-input.conf /etc/logstash/conf.d/001-redis-input.conf\nADD ./logstash/002-tcp-json-input.conf /etc/logstash/conf.d/002-tcp-json-input.conf\nADD ./logstash/999-elasticsearch-output.conf /etc/logstash/conf.d/999-elasticsearch-output.conf\n#   Confiure StatsD\nADD ./statsd/config.js /src/statsd/config.js\n#   Configure Whisper, Carbon and Graphite-Web\nADD ./graphite/initial_data.json /var/lib/graphite/webapp/graphite/initial_data.json\nADD ./graphite/local_settings.py /var/lib/graphite/webapp/graphite/local_settings.py\nADD ./graphite/carbon.conf /var/lib/graphite/conf/carbon.conf\nADD ./graphite/storage-schemas.conf /var/lib/graphite/conf/storage-schemas.conf\nADD ./graphite/storage-aggregation.conf /var/lib/graphite/conf/storage-aggregation.conf\nRUN mkdir -p /var/lib/graphite \\\n && chown -R www-data:www-data /var/lib/graphite \\\n && mkdir -p /data/graphite \\\n && chown www-data:www-data /data/graphite \\\n && rm -rf /var/lib/graphite/storage/whisper \\\n && ln -s /data/graphite /var/lib/graphite/storage/whisper\nRUN cd /var/lib/graphite/webapp/graphite \\\n && python manage.py syncdb --noinput \\\n && chown -R www-data:www-data /var/lib/graphite\n#   Configure Grafana\nADD ./grafana/config.js /src/grafana/config.js\n#   Configure Kibana\nADD ./kibana/config.js /src/kibana/config.js\n#   Configure nginx and supervisord\nADD ./nginx/nginx.conf /etc/nginx/nginx.conf\nADD ./supervisord.conf /etc/supervisor/conf.d/supervisord.conf\nRUN mkdir -p /logs/supervisor \\\n && touch /logs/supervisor/supervisord.log \\\n && mkdir -p /logs/nginx \\\n && chown www-data:www-data /logs/nginx\n#   Grafana\nEXPOSE 80/tcp\n#   Kibana\nEXPOSE 81/tcp\n#   Logstash TCP\nEXPOSE 4560/tcp\n#   Graphite (Carbon)\nEXPOSE 2003/tcp\n#   Graphite web-ui\nEXPOSE 8000/tcp\n#   Redis\nEXPOSE 6379/tcp\n#   Elasticserach\nEXPOSE 9200/tcp\n#   StatsD\nEXPOSE 8125/udp\nEXPOSE 8126/tcp\nVOLUME [\"/data/graphite\",\"/data/elasticsearch\"]\nVOLUME [\"/logs/elasticsearch\",\"/logs/supervisor\",\"/logs/nginx\"]\nCMD [\"/usr/bin/supervisord\", \"-c\", \"/etc/supervisor/supervisord.conf\"]\n","originalDockerfileUglifiedHash":"cbc0e6061f95d68151aaac5682dfd09e","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/de1dbe5842ef68200cac8da94084bc3d455602be.dockerfile"}