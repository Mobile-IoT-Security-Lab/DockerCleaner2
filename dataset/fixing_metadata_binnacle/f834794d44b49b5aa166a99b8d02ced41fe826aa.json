{"seed":3491546171,"processedDockerfileHash":"a56edce6dad68133c7961815ad9ddb6e","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","use-copy-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM ubuntu:xenial\n#   Lovingly borrowed and modified from https://github.com/StackStorm/st2-dockerfiles/blob/master/base/Dockerfile\nARG DEBIAN_FRONTEND=noninteractive\nARG ST2_VERSION=2.10.1\nRUN : \"${ST2_VERSION:?Docker build argument needs to be set and non-empty.}\"\nENV container=\"docker\"\nENV ENV=\"/etc/skel/.profile\"\nENV TERM=\"xterm\"\n#   Generate and set locale to UTF-8\nRUN apt-get update -qq \\\n && (apt-get update ;apt-get install --no-install-recommends curl=7.47.0-1ubuntu2.19 locales=2.23-0ubuntu11.3 -y ) \\\n && rm -rf /var/lib/apt/lists/* \\\n && locale-gen en_US.UTF-8 \\\n && update-locale LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8\n#   The LC_ALL variable must be defined after executing update-local\nENV LANG=\"en_US.UTF-8\" \\\n    LANGUAGE=\"en_US:en\" \\\n    LC_ALL=\"en_US.UTF-8\"\n#  ####################################################################################################\n#  # External Deps               \n#  ####################################################################################################\nRUN mkdir -p /data/db\nRUN :\nRUN (apt-get update ;apt-get install --no-install-recommends gnupg-curl=1.4.20-1ubuntu3.3 -y )\nRUN (apt-get update ;apt-get install --no-install-recommends curl=7.47.0-1ubuntu2.19 wget=1.17.1-1ubuntu1.5 -y )\n#   Add key and repo for the latest stable MongoDB (3.4)\nRUN wget -qO - https://www.mongodb.org/static/pgp/server-3.4.asc | apt-key add -\nRUN echo \"deb http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 multiverse\" > /etc/apt/sources.list.d/mongodb-org-3.4.list\nRUN :\nRUN (apt-get update ;apt-get install --no-install-recommends crudini=0.7-1 -y )\nRUN (apt-get update ;apt-get install --no-install-recommends mongodb-org -y )\nRUN (apt-get update ;apt-get install --no-install-recommends rabbitmq-server=3.5.7-1ubuntu0.16.04.4 -y )\n#  ####################################################################################################\n#  # Install StackStorm                 \n#  ####################################################################################################\n# A secret has been removed here. Please do not provide secrets from the Dockerfile as these will leak into the metadata of the resulting docker image. To provide secrets the --secret flag of the docker build command can be used (https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information).\n#   Install StackStorm, but without UI\nRUN curl -sf https://packagecloud.io/install/repositories/StackStorm/stable/script.deb.sh | bash \\\n && (apt-get update ;apt-get install --no-install-recommends st2=${ST2_VERSION}-* -y ) \\\n && rm -f /etc/apt/sources.list.d/StackStorm_*.list\nCOPY htpasswd /etc/st2/htpasswd\nRUN echo \"stanley:stanley\" | chpasswd\nCOPY start_st2_services.sh /\n#  ####################################################################################################\n#  # Additional installations / configuration             \n#  ####################################################################################################\nRUN apt-get update \\\n && (apt-get update ;apt-get install --no-install-recommends openssh-server=1:7.2p2-4ubuntu2.10 python=2.7.12-1~16.04 git=1:2.7.4-0ubuntu1.10 vim=2:7.4.1689-3ubuntu1.5 screen=4.3.1-2ubuntu0.1 -y )\nCOPY napalm.yaml /opt/stackstorm/configs\nRUN cp -r /usr/share/doc/st2/examples/ /opt/stackstorm/packs/\nARG CACHEBUST=1\nRUN screen -d -m /start_st2_services.sh \\\n && sleep 15 \\\n && st2ctl reload --register-all \\\n && st2 run packs.setup_virtualenv packs=examples \\\n && st2 pack remove napalm \\\n && st2 pack install https://github.com/nre-learning/stackstorm-napalm.git\nRUN /opt/stackstorm/virtualenvs/napalm/bin/pip install ncclient==0.6.0\nARG CACHEBUST=0\n#  ####################################################################################################\n#  # Security options (copied from Utility)      \n#  ####################################################################################################\nRUN mkdir /var/run/sshd\n#   Antidote user\nRUN mkdir -p /home/antidote\nRUN useradd antidote -p antidotepassword\nRUN mkdir -p /home/antidote/.st2/\nCOPY st2config /home/antidote/.st2/config\nRUN chown antidote:antidote /home/antidote /home/antidote/.st2 /home/antidote/.st2/config\nRUN chsh antidote --shell=/bin/bash\nRUN echo 'antidote:antidotepassword' | chpasswd\nRUN echo 'root:$(uuidgen)' | chpasswd\n#   Adjust MOTD\nRUN rm -f /etc/update-motd.d/*\nRUN rm -f /etc/legal\nCOPY .welcome.sh /etc/update-motd.d/00-antidote-motd\nRUN chmod +x /etc/update-motd.d/00-antidote-motd\n#   Disable root Login\nRUN sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin no/' /etc/ssh/sshd_config\nRUN sed -i 's/PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config\n#   SSH login fix. Otherwise user is kicked off after login\nRUN sed 's@session\\s*required\\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd\n#   Disable su for everyone not in the wheel group (no one is in the wheel group)\nRUN echo \"auth required pam_wheel.so use_uid\" >> /etc/pam.d/su\nENV NOTVISIBLE=\"\\\"in users profile\\\"\"\nRUN echo \"export VISIBLE=now\" >> /etc/profile\nCMD /start_st2_services.sh\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ubuntu:xenial\n#  Lovingly borrowed and modified from https://github.com/StackStorm/st2-dockerfiles/blob/master/base/Dockerfile\nARG DEBIAN_FRONTEND=noninteractive\nARG ST2_VERSION=2.10.1\nRUN : \"${ST2_VERSION:?Docker build argument needs to be set and non-empty.}\"\nENV container=\"docker\"\nENV ENV=\"/etc/skel/.profile\"\nENV TERM=\"xterm\"\n#  Generate and set locale to UTF-8\nRUN apt-get update -qq \\\n && apt-get install curl locales -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && locale-gen en_US.UTF-8 \\\n && update-locale LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8\n#  The LC_ALL variable must be defined after executing update-local\nENV LANG=\"en_US.UTF-8\" \\\n    LANGUAGE=\"en_US:en\" \\\n    LC_ALL=\"en_US.UTF-8\"\n# ####################################################################################################\n# # External Deps               \n# ####################################################################################################\nRUN mkdir -p /data/db\nRUN apt-get update\nRUN apt-get install gnupg-curl -y\nRUN apt-get install curl wget -y\n#  Add key and repo for the latest stable MongoDB (3.4)\nRUN wget -qO - https://www.mongodb.org/static/pgp/server-3.4.asc | apt-key add -\nRUN echo \"deb http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 multiverse\" > /etc/apt/sources.list.d/mongodb-org-3.4.list\nRUN apt-get update\nRUN apt-get install crudini -y\nRUN apt-get install mongodb-org -y\nRUN apt-get install rabbitmq-server -y\n# ####################################################################################################\n# # Install StackStorm                 \n# ####################################################################################################\nENV ST2_PASSWORD=\"antidotepassword\"\n#  Install StackStorm, but without UI\nRUN curl -sf https://packagecloud.io/install/repositories/StackStorm/stable/script.deb.sh | bash \\\n && apt-get install st2=${ST2_VERSION}-* -y \\\n && rm -f /etc/apt/sources.list.d/StackStorm_*.list\nADD htpasswd /etc/st2/htpasswd\nRUN echo \"stanley:stanley\" | chpasswd\nADD start_st2_services.sh /\n# ####################################################################################################\n# # Additional installations / configuration             \n# ####################################################################################################\nRUN apt-get update \\\n && apt-get install openssh-server python git vim screen -y\nADD napalm.yaml /opt/stackstorm/configs\nRUN cp -r /usr/share/doc/st2/examples/ /opt/stackstorm/packs/\nARG CACHEBUST=1\nRUN screen -d -m /start_st2_services.sh \\\n && sleep 15 \\\n && st2ctl reload --register-all \\\n && st2 run packs.setup_virtualenv packs=examples \\\n && st2 pack remove napalm \\\n && st2 pack install https://github.com/nre-learning/stackstorm-napalm.git\nRUN /opt/stackstorm/virtualenvs/napalm/bin/pip install ncclient==0.6.0\nARG CACHEBUST=0\n# ####################################################################################################\n# # Security options (copied from Utility)      \n# ####################################################################################################\nRUN mkdir /var/run/sshd\n#  Antidote user\nRUN mkdir -p /home/antidote\nRUN useradd antidote -p antidotepassword\nRUN mkdir -p /home/antidote/.st2/\nADD st2config /home/antidote/.st2/config\nRUN chown antidote:antidote /home/antidote /home/antidote/.st2 /home/antidote/.st2/config\nRUN chsh antidote --shell=/bin/bash\nRUN echo 'antidote:antidotepassword' | chpasswd\nRUN echo 'root:$(uuidgen)' | chpasswd\n#  Adjust MOTD\nRUN rm -f /etc/update-motd.d/*\nRUN rm -f /etc/legal\nADD .welcome.sh /etc/update-motd.d/00-antidote-motd\nRUN chmod +x /etc/update-motd.d/00-antidote-motd\n#  Disable root Login\nRUN sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin no/' /etc/ssh/sshd_config\nRUN sed -i 's/PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config\n#  SSH login fix. Otherwise user is kicked off after login\nRUN sed 's@session\\s*required\\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd\n#  Disable su for everyone not in the wheel group (no one is in the wheel group)\nRUN echo \"auth required pam_wheel.so use_uid\" >> /etc/pam.d/su\nENV NOTVISIBLE=\"\\\"in users profile\\\"\"\nRUN echo \"export VISIBLE=now\" >> /etc/profile\nCMD /start_st2_services.sh\n","injectedSmells":[],"originalDockerfileHash":"bb68ff925b09ba90f1c7a7f6d01cc43b","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:xenial\n#   Lovingly borrowed and modified from https://github.com/StackStorm/st2-dockerfiles/blob/master/base/Dockerfile\nARG DEBIAN_FRONTEND=noninteractive\nARG ST2_VERSION=2.10.1\nRUN : \"${ST2_VERSION:?Docker build argument needs to be set and non-empty.}\"\nENV container=\"docker\"\nENV ENV=\"/etc/skel/.profile\"\nENV TERM=\"xterm\"\n#   Generate and set locale to UTF-8\nRUN apt-get update -qq \\\n && apt-get install curl locales -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && locale-gen en_US.UTF-8 \\\n && update-locale LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8\n#   The LC_ALL variable must be defined after executing update-local\nENV LANG=\"en_US.UTF-8\" \\\n    LANGUAGE=\"en_US:en\" \\\n    LC_ALL=\"en_US.UTF-8\"\n#  ####################################################################################################\n#  # External Deps               \n#  ####################################################################################################\nRUN mkdir -p /data/db\nRUN apt-get update\nRUN apt-get install gnupg-curl -y\nRUN apt-get install curl wget -y\n#   Add key and repo for the latest stable MongoDB (3.4)\nRUN wget -qO - https://www.mongodb.org/static/pgp/server-3.4.asc | apt-key add -\nRUN echo \"deb http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 multiverse\" > /etc/apt/sources.list.d/mongodb-org-3.4.list\nRUN apt-get update\nRUN apt-get install crudini -y\nRUN apt-get install mongodb-org -y\nRUN apt-get install rabbitmq-server -y\n#  ####################################################################################################\n#  # Install StackStorm                 \n#  ####################################################################################################\nENV ST2_PASSWORD=\"antidotepassword\"\n#   Install StackStorm, but without UI\nRUN curl -sf https://packagecloud.io/install/repositories/StackStorm/stable/script.deb.sh | bash \\\n && apt-get install st2=${ST2_VERSION}-* -y \\\n && rm -f /etc/apt/sources.list.d/StackStorm_*.list\nADD htpasswd /etc/st2/htpasswd\nRUN echo \"stanley:stanley\" | chpasswd\nADD start_st2_services.sh /\n#  ####################################################################################################\n#  # Additional installations / configuration             \n#  ####################################################################################################\nRUN apt-get update \\\n && apt-get install openssh-server python git vim screen -y\nADD napalm.yaml /opt/stackstorm/configs\nRUN cp -r /usr/share/doc/st2/examples/ /opt/stackstorm/packs/\nARG CACHEBUST=1\nRUN screen -d -m /start_st2_services.sh \\\n && sleep 15 \\\n && st2ctl reload --register-all \\\n && st2 run packs.setup_virtualenv packs=examples \\\n && st2 pack remove napalm \\\n && st2 pack install https://github.com/nre-learning/stackstorm-napalm.git\nRUN /opt/stackstorm/virtualenvs/napalm/bin/pip install ncclient==0.6.0\nARG CACHEBUST=0\n#  ####################################################################################################\n#  # Security options (copied from Utility)      \n#  ####################################################################################################\nRUN mkdir /var/run/sshd\n#   Antidote user\nRUN mkdir -p /home/antidote\nRUN useradd antidote -p antidotepassword\nRUN mkdir -p /home/antidote/.st2/\nADD st2config /home/antidote/.st2/config\nRUN chown antidote:antidote /home/antidote /home/antidote/.st2 /home/antidote/.st2/config\nRUN chsh antidote --shell=/bin/bash\nRUN echo 'antidote:antidotepassword' | chpasswd\nRUN echo 'root:$(uuidgen)' | chpasswd\n#   Adjust MOTD\nRUN rm -f /etc/update-motd.d/*\nRUN rm -f /etc/legal\nADD .welcome.sh /etc/update-motd.d/00-antidote-motd\nRUN chmod +x /etc/update-motd.d/00-antidote-motd\n#   Disable root Login\nRUN sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin no/' /etc/ssh/sshd_config\nRUN sed -i 's/PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config\n#   SSH login fix. Otherwise user is kicked off after login\nRUN sed 's@session\\s*required\\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd\n#   Disable su for everyone not in the wheel group (no one is in the wheel group)\nRUN echo \"auth required pam_wheel.so use_uid\" >> /etc/pam.d/su\nENV NOTVISIBLE=\"\\\"in users profile\\\"\"\nRUN echo \"export VISIBLE=now\" >> /etc/profile\nCMD /start_st2_services.sh\n","originalDockerfileUglifiedHash":"535e71748e09d26e85d5f2633d61f6cf","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/f834794d44b49b5aa166a99b8d02ced41fe826aa.dockerfile"}