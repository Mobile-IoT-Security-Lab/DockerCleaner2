{"seed":3491970607,"processedDockerfileHash":"0450bdefda036bf79969807b6c652ffc","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"#\n#   Dockerfile for moodle\n#\nFROM appsvcorg/nginx-fpm:php7.2.13\nLABEL maintainer=\"=\\\"Azure App Service Container Images <appsvc-images@microsoft.com>\\\"\"\n#   ========\n#   ENV vars\n#   ========\n#   ssh\nENV SSH_PASSWD=\"\\\"root:Docker!\\\"\"\n#  nginx\nENV NGINX_VERSION=\"1.14.0\"\nENV NGINX_LOG_DIR=\"\\\"/home/LogFiles/nginx\\\"\"\n#  php\nENV PHP_HOME=\"\\\"/usr/local/etc/php\\\"\"\nENV PHP_CONF_DIR=\"$PHP_HOME\"\nENV PHP_CONF_FILE=\"$PHP_CONF_DIR\\\"/php.ini\\\"\"\n#   mariadb\nENV MARIADB_DATA_DIR=\"\\\"/home/data/mysql\\\"\"\nENV MARIADB_LOG_DIR=\"\\\"/home/LogFiles/mysql\\\"\"\n#   phpmyadmin\nENV PHPMYADMIN_SOURCE=\"\\\"/usr/src/phpmyadmin\\\"\"\nENV PHPMYADMIN_HOME=\"\\\"/home/phpmyadmin\\\"\"\n#   moodle\nENV MOODLE_HOME=\"\\\"/home/site/wwwroot\\\"\"\nENV MOODLE_SOURCE=\"\\\"/usr/src/moodle\\\"\"\n#   redis\nENV PHPREDIS_VERSION=\"3.1.2\"\n#   memcached\nENV MEMCACHED_VERSION=\"1.5.12\"\nENV MEMCACHED_SHA1=\"f67096ba64b0c47668bcad5b680010c4f8987d4c\"\n#\nENV DOCKER_BUILD_HOME=\"\\\"/dockerbuild\\\"\"\n#   ====================\n#   Download and Install\n#   ~. tools\n#   1. redis\n#   2. moodle\n#   ====================\nWORKDIR $DOCKER_BUILD_HOME\nRUN set -ex \\\n && apk update \\\n && apk add redis --no-cache \\\n && docker-php-source extract \\\n && curl -L -o /tmp/redis.tar.gz https://github.com/phpredis/phpredis/archive/$PHPREDIS_VERSION.tar.gz \\\n && tar xfz /tmp/redis.tar.gz \\\n && rm -r /tmp/redis.tar.gz \\\n && mv phpredis-$PHPREDIS_VERSION /usr/src/php/ext/redis \\\n && apk add zlib-dev cyrus-sasl-dev git autoconf g++ libtool make pcre-dev tini libintl icu icu-dev libxml2-dev postgresql-dev freetype-dev libjpeg-turbo-dev libpng-dev gmp gmp-dev libmemcached-dev imagemagick-dev libssh2 libssh2-dev libxslt-dev libmemcached-libs zlib $PHPIZE_DEPS --no-cache --virtual .build-dependencies \\\n && pecl install igbinary \\\n && (pecl install --nobuild memcached \\\n && cd \"$( pecl config-get temp_dir ;)/memcached\" \\\n && phpize \\\n && ./configure --enable-memcached-igbinary \\\n && make -j$( nproc ;) \\\n && make install \\\n && cd /tmp/ ) \\\n && docker-php-ext-enable igbinary memcached \\\n && docker-php-ext-configure gd --with-png-dir=/usr --with-jpeg-dir=/usr \\\n && docker-php-ext-install -j \"$( nproc ;)\" gd zip redis xmlrpc soap intl \\\n && find /usr/local/lib/php/extensions -name '*.a' -delete \\\n && find /usr/local/lib/php/extensions -name '*.so' -exec strip --strip-all '{}'\n#   =========\n#   Configure\n#   =========\n#   nginx\nCOPY nginx_conf/. /etc/nginx/conf.d/\nCOPY nginx.conf /etc/nginx/nginx.conf\n#   =====\n#   final\n#   =====\nCOPY moodle_src/. $MOODLE_SOURCE/\n#   php\nCOPY opcache-recommended.ini /usr/local/etc/php/conf.d/opcache-recommended.ini\nCOPY php.ini /usr/local/etc/php/php.ini\nCOPY www.conf /usr/local/etc/php/conf.d/\nCOPY zz-docker.conf /usr/local/etc/php-fpm.d/zz-docker.conf\n#   mariadb\nCOPY my.cnf /etc/mysql/my.cnf\n#   phpmyadmin\nCOPY phpmyadmin-default.conf $PHPMYADMIN_SOURCE/\n#\nCOPY entrypoint.sh /usr/local/bin/\nRUN chmod +x /usr/local/bin/entrypoint.sh\nEXPOSE 2222/tcp 80/tcp\nENTRYPOINT [\"entrypoint.sh\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#\n#  Dockerfile for moodle\n#\nFROM appsvcorg/nginx-fpm:php7.2.13\nLABEL maintainer=\"=\\\"Azure App Service Container Images <appsvc-images@microsoft.com>\\\"\"\n#  ========\n#  ENV vars\n#  ========\n#  ssh\nENV SSH_PASSWD=\"\\\"root:Docker!\\\"\"\n# nginx\nENV NGINX_VERSION=\"1.14.0\"\nENV NGINX_LOG_DIR=\"\\\"/home/LogFiles/nginx\\\"\"\n# php\nENV PHP_HOME=\"\\\"/usr/local/etc/php\\\"\"\nENV PHP_CONF_DIR=\"$PHP_HOME\"\nENV PHP_CONF_FILE=\"$PHP_CONF_DIR\\\"/php.ini\\\"\"\n#  mariadb\nENV MARIADB_DATA_DIR=\"\\\"/home/data/mysql\\\"\"\nENV MARIADB_LOG_DIR=\"\\\"/home/LogFiles/mysql\\\"\"\n#  phpmyadmin\nENV PHPMYADMIN_SOURCE=\"\\\"/usr/src/phpmyadmin\\\"\"\nENV PHPMYADMIN_HOME=\"\\\"/home/phpmyadmin\\\"\"\n#  moodle\nENV MOODLE_HOME=\"\\\"/home/site/wwwroot\\\"\"\nENV MOODLE_SOURCE=\"\\\"/usr/src/moodle\\\"\"\n#  redis\nENV PHPREDIS_VERSION=\"3.1.2\"\n#  memcached\nENV MEMCACHED_VERSION=\"1.5.12\"\nENV MEMCACHED_SHA1=\"f67096ba64b0c47668bcad5b680010c4f8987d4c\"\n#\nENV DOCKER_BUILD_HOME=\"\\\"/dockerbuild\\\"\"\n#  ====================\n#  Download and Install\n#  ~. tools\n#  1. redis\n#  2. moodle\n#  ====================\nWORKDIR $DOCKER_BUILD_HOME\nRUN set -ex \\\n && apk update \\\n && apk add --no-cache redis \\\n && docker-php-source extract \\\n && curl -L -o /tmp/redis.tar.gz https://github.com/phpredis/phpredis/archive/$PHPREDIS_VERSION.tar.gz \\\n && tar xfz /tmp/redis.tar.gz \\\n && rm -r /tmp/redis.tar.gz \\\n && mv phpredis-$PHPREDIS_VERSION /usr/src/php/ext/redis \\\n && apk add --no-cache --virtual .build-dependencies $PHPIZE_DEPS zlib-dev cyrus-sasl-dev git autoconf g++ libtool make pcre-dev tini libintl icu icu-dev libxml2-dev postgresql-dev freetype-dev libjpeg-turbo-dev libpng-dev gmp gmp-dev libmemcached-dev imagemagick-dev libssh2 libssh2-dev libxslt-dev libmemcached-libs zlib \\\n && pecl install igbinary \\\n && (pecl install --nobuild memcached \\\n && cd \"$( pecl config-get temp_dir ;)/memcached\" \\\n && phpize \\\n && ./configure --enable-memcached-igbinary \\\n && make -j$( nproc ;) \\\n && make install \\\n && cd /tmp/ ) \\\n && docker-php-ext-enable igbinary memcached \\\n && docker-php-ext-configure gd --with-png-dir=/usr --with-jpeg-dir=/usr \\\n && docker-php-ext-install -j \"$( nproc ;)\" gd zip redis xmlrpc soap intl \\\n && find /usr/local/lib/php/extensions -name '*.a' -delete \\\n && find /usr/local/lib/php/extensions -name '*.so' -exec strip --strip-all '{}' ; \\\n && runDeps=\"$( scanelf --needed --nobanner --recursive /usr/local/lib/php/extensions | awk '{ gsub(/,/, \"\\nso:\", $2); print \"so:\" $2 }' | sort -u | xargs -r apk info --installed | sort -u ;)\" \\\n && apk add --virtual .phpext-rundeps $runDeps \\\n && apk del .build-dependencies \\\n && docker-php-source delete \\\n && mkdir -p /usr/local/php/tmp \\\n && chmod 777 /usr/local/php/tmp \\\n && addgroup -g 11211 memcache \\\n && adduser -D -u 11211 -G memcache memcache \\\n && apk add --no-cache --virtual .build-deps ca-certificates coreutils cyrus-sasl-dev dpkg-dev dpkg gcc libc-dev libevent-dev libressl linux-headers make perl perl-utils tar wget \\\n && wget -O memcached.tar.gz \"https://memcached.org/files/memcached-$MEMCACHED_VERSION.tar.gz\" \\\n && echo \"$MEMCACHED_SHA1 memcached.tar.gz\" | sha1sum -c - \\\n && mkdir -p /usr/src/memcached \\\n && tar -xzf memcached.tar.gz -C /usr/src/memcached --strip-components=1 \\\n && rm memcached.tar.gz \\\n && cd /usr/src/memcached \\\n && gnuArch=\"$( dpkg-architecture --query DEB_BUILD_GNU_TYPE ;)\" \\\n && enableExtstore=\"$( case \"$gnuArch\" in (s390x-*) ;;(*) echo '--enable-extstore' ;; esac ;)\" \\\n && ./configure --build=\"$gnuArch\" --enable-sasl $enableExtstore \\\n && make -j \"$( nproc ;)\" \\\n && make test \\\n && make install \\\n && cd / \\\n && rm -rf /usr/src/memcached \\\n && runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" \\\n && apk add --virtual .memcached-rundeps $runDeps \\\n && apk del .build-deps \\\n && memcached -V \\\n && mkdir -p $MOODLE_SOURCE \\\n && apk update \\\n && apk upgrade \\\n && rm -rf /var/cache/apk/* \\\n && rm -rf /tmp/*\n#  =========\n#  Configure\n#  =========\n#  nginx\nCOPY nginx_conf/. /etc/nginx/conf.d/\nCOPY nginx.conf /etc/nginx/nginx.conf\n#  =====\n#  final\n#  =====\nCOPY moodle_src/. $MOODLE_SOURCE/\n#  php\nCOPY opcache-recommended.ini /usr/local/etc/php/conf.d/opcache-recommended.ini\nCOPY php.ini /usr/local/etc/php/php.ini\nCOPY www.conf /usr/local/etc/php/conf.d/\nCOPY zz-docker.conf /usr/local/etc/php-fpm.d/zz-docker.conf\n#  mariadb\nCOPY my.cnf /etc/mysql/my.cnf\n#  phpmyadmin\nCOPY phpmyadmin-default.conf $PHPMYADMIN_SOURCE/\n#\nCOPY entrypoint.sh /usr/local/bin/\nRUN chmod +x /usr/local/bin/entrypoint.sh\nEXPOSE 2222/tcp 80/tcp\nENTRYPOINT [\"entrypoint.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"3021ab766f10115063df6992d0233e2f","successfullyInjectedSmells":[],"originalDockerfileUglified":"#\n#   Dockerfile for moodle\n#\nFROM appsvcorg/nginx-fpm:php7.2.13\nLABEL maintainer=\"=\\\"Azure App Service Container Images <appsvc-images@microsoft.com>\\\"\"\n#   ========\n#   ENV vars\n#   ========\n#   ssh\nENV SSH_PASSWD=\"\\\"root:Docker!\\\"\"\n#  nginx\nENV NGINX_VERSION=\"1.14.0\"\nENV NGINX_LOG_DIR=\"\\\"/home/LogFiles/nginx\\\"\"\n#  php\nENV PHP_HOME=\"\\\"/usr/local/etc/php\\\"\"\nENV PHP_CONF_DIR=\"$PHP_HOME\"\nENV PHP_CONF_FILE=\"$PHP_CONF_DIR\\\"/php.ini\\\"\"\n#   mariadb\nENV MARIADB_DATA_DIR=\"\\\"/home/data/mysql\\\"\"\nENV MARIADB_LOG_DIR=\"\\\"/home/LogFiles/mysql\\\"\"\n#   phpmyadmin\nENV PHPMYADMIN_SOURCE=\"\\\"/usr/src/phpmyadmin\\\"\"\nENV PHPMYADMIN_HOME=\"\\\"/home/phpmyadmin\\\"\"\n#   moodle\nENV MOODLE_HOME=\"\\\"/home/site/wwwroot\\\"\"\nENV MOODLE_SOURCE=\"\\\"/usr/src/moodle\\\"\"\n#   redis\nENV PHPREDIS_VERSION=\"3.1.2\"\n#   memcached\nENV MEMCACHED_VERSION=\"1.5.12\"\nENV MEMCACHED_SHA1=\"f67096ba64b0c47668bcad5b680010c4f8987d4c\"\n#\nENV DOCKER_BUILD_HOME=\"\\\"/dockerbuild\\\"\"\n#   ====================\n#   Download and Install\n#   ~. tools\n#   1. redis\n#   2. moodle\n#   ====================\nWORKDIR $DOCKER_BUILD_HOME\nRUN set -ex \\\n && apk update \\\n && apk add --no-cache redis \\\n && docker-php-source extract \\\n && curl -L -o /tmp/redis.tar.gz https://github.com/phpredis/phpredis/archive/$PHPREDIS_VERSION.tar.gz \\\n && tar xfz /tmp/redis.tar.gz \\\n && rm -r /tmp/redis.tar.gz \\\n && mv phpredis-$PHPREDIS_VERSION /usr/src/php/ext/redis \\\n && apk add --no-cache --virtual .build-dependencies $PHPIZE_DEPS zlib-dev cyrus-sasl-dev git autoconf g++ libtool make pcre-dev tini libintl icu icu-dev libxml2-dev postgresql-dev freetype-dev libjpeg-turbo-dev libpng-dev gmp gmp-dev libmemcached-dev imagemagick-dev libssh2 libssh2-dev libxslt-dev libmemcached-libs zlib \\\n && pecl install igbinary \\\n && (pecl install --nobuild memcached \\\n && cd \"$( pecl config-get temp_dir ;)/memcached\" \\\n && phpize \\\n && ./configure --enable-memcached-igbinary \\\n && make -j$( nproc ;) \\\n && make install \\\n && cd /tmp/ ) \\\n && docker-php-ext-enable igbinary memcached \\\n && docker-php-ext-configure gd --with-png-dir=/usr --with-jpeg-dir=/usr \\\n && docker-php-ext-install -j \"$( nproc ;)\" gd zip redis xmlrpc soap intl \\\n && find /usr/local/lib/php/extensions -name '*.a' -delete \\\n && find /usr/local/lib/php/extensions -name '*.so' -exec strip --strip-all '{}'\n#   =========\n#   Configure\n#   =========\n#   nginx\nCOPY nginx_conf/. /etc/nginx/conf.d/\nCOPY nginx.conf /etc/nginx/nginx.conf\n#   =====\n#   final\n#   =====\nCOPY moodle_src/. $MOODLE_SOURCE/\n#   php\nCOPY opcache-recommended.ini /usr/local/etc/php/conf.d/opcache-recommended.ini\nCOPY php.ini /usr/local/etc/php/php.ini\nCOPY www.conf /usr/local/etc/php/conf.d/\nCOPY zz-docker.conf /usr/local/etc/php-fpm.d/zz-docker.conf\n#   mariadb\nCOPY my.cnf /etc/mysql/my.cnf\n#   phpmyadmin\nCOPY phpmyadmin-default.conf $PHPMYADMIN_SOURCE/\n#\nCOPY entrypoint.sh /usr/local/bin/\nRUN chmod +x /usr/local/bin/entrypoint.sh\nEXPOSE 2222/tcp 80/tcp\nENTRYPOINT [\"entrypoint.sh\"]\n","originalDockerfileUglifiedHash":"08f36239e26b9adf4269b1a8421f28b1","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/e1a9f3c14e4e0e0bbcb4a7b8d8082d36dca6ab5d.dockerfile"}