{"seed":313112300,"processedDockerfileHash":"43a33cc2a56a46f6f5dc95e85b3e5c9f","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-gem","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   ntodd/video-transcoding:0.21.1\nFROM ntodd/ruby-xenial:2.4.0\nLABEL maintainer=\"Nate Todd <nate@pixelauthorityllc.com>\"\nENV GEM_VERSION=\"0.25.2\"\nENV NASM_VERSION=\"2.13.01\"\nENV FDKAAC_VERSION=\"0.1.6\"\nENV LIBX265_VERSION=\"2.9\"\nENV HANDBRAKE_VERSION=\"1.1.2\"\nENV FFMPEG_VERSION=\"4.1\"\n#   install build dependencies to compile ffmpeg from master\nRUN set -ex \\\n && buildDeps=' autoconf automake build-essential git libass-dev libbz2-dev libfontconfig1-dev libfreetype6-dev libfribidi-dev libharfbuzz-dev libjansson-dev libogg-dev libsamplerate-dev libtheora-dev libtool libvorbis-dev libxml2-dev m4 make patch pkg-config python tar libtool-bin texinfo wget zlib1g-dev yasm cmake cmake-curses-gui mercurial libmp3lame-dev libopus-dev libvpx-dev libx264-dev unzip mkvtoolnix mp4v2-utils mpv ' \\\n && apt-get update \\\n && apt-get install --no-install-recommends $buildDeps -y \\\n && mkdir -p /usr/src/ffmpeg/bin \\\n && mkdir -p /usr/src/ffmpeg/build \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" \\\n && cd /usr/src/ffmpeg \\\n && wget http://www.nasm.us/pub/nasm/releasebuilds/$NASM_VERSION/nasm-$NASM_VERSION.tar.bz2 \\\n && tar xjvf nasm-*.tar.bz2 \\\n && cd nasm-* \\\n && ./autogen.sh \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" ./configure --prefix=\"/usr/src/ffmpeg/build\" --bindir=\"/usr/src/ffmpeg/bin\" \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" make -j\"$( nproc ;)\" \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf nasm-* \\\n && git clone -b stable http://git.videolan.org/git/x264.git x264 \\\n && cd x264 \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" ./configure --prefix=\"/usr/src/ffmpeg/build\" --bindir=\"/usr/src/ffmpeg/bin\" --enable-static --disable-opencl \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" make -j\"$( nproc ;)\" \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf x264-snapshot* \\\n && git clone https://github.com/mstorsjo/fdk-aac.git \\\n && cd fdk-aac \\\n && git checkout tags/v$FDKAAC_VERSION \\\n && autoreconf -fiv \\\n && ./configure --prefix=\"/usr/src/ffmpeg/build\" --disable-shared \\\n && make -j\"$( nproc ;)\" \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf mstorsjo-fdk-aac* \\\n && wget -O x265.tar.gz https://bitbucket.org/multicoreware/x265/downloads/x265_$LIBX265_VERSION.tar.gz \\\n && tar xzvf x265.tar.gz \\\n && cd x265_*/build/linux \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" cmake -G \"Unix Makefiles\" -DCMAKE_INSTALL_PREFIX=\"/usr/src/ffmpeg/build\" -DENABLE_SHARED:bool=off ../../source \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" make -j\"$( nproc ;)\" \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf x265 \\\n && git clone https://github.com/HandBrake/HandBrake.git \\\n && cd HandBrake \\\n && git checkout tags/$HANDBRAKE_VERSION \\\n && ./configure --launch-jobs=$( nproc ;) --disable-gtk --launch \\\n && cd build \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf HandBrake \\\n && wget -O ffmpeg.zip https://github.com/FFmpeg/FFmpeg/archive/n$FFMPEG_VERSION.zip \\\n && unzip ffmpeg.zip \\\n && mv FFmpeg* ffmpeg_src \\\n && cd ffmpeg_src \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" PKG_CONFIG_PATH=\"/usr/src/ffmpeg/build/lib/pkgconfig\" ./configure --prefix=\"/usr/src/ffmpeg/build\" --pkg-config-flags=\"--static\" --extra-cflags=\"-I/usr/src/ffmpeg/build/include\" --extra-ldflags=\"-L/usr/src/ffmpeg/build/lib\" --bindir=\"/usr/src/ffmpeg/bin\" --extra-libs=-lpthread --enable-gpl --enable-libass --enable-libfdk-aac --enable-libfreetype --enable-libmp3lame --enable-libopus --enable-libtheora --enable-libvorbis --enable-libvpx --enable-libx264 --enable-libx265 --enable-nonfree \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" make -j\"$( nproc ;)\" \\\n && make install \\\n && hash -r \\\n && cd / \\\n && mv /usr/src/ffmpeg/bin/ff* /usr/local/bin \\\n && rm -rf /usr/src/ffmpeg\nRUN set -ex \\\n && apt-get purge -y --auto-remove $buildDeps \\\n && rm -rf /var/lib/apt/lists/* \\\n && gem install video_transcoding --version 0.25.3 \\\n && mkdir /data\nWORKDIR /data\nCMD [\"/bin/bash\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  ntodd/video-transcoding:0.21.1\nFROM ntodd/ruby-xenial:2.4.0\nLABEL maintainer=\"Nate Todd <nate@pixelauthorityllc.com>\"\nENV GEM_VERSION=\"0.25.2\"\nENV NASM_VERSION=\"2.13.01\"\nENV FDKAAC_VERSION=\"0.1.6\"\nENV LIBX265_VERSION=\"2.9\"\nENV HANDBRAKE_VERSION=\"1.1.2\"\nENV FFMPEG_VERSION=\"4.1\"\n#  install build dependencies to compile ffmpeg from master\nRUN set -ex \\\n && buildDeps=' autoconf automake build-essential git libass-dev libbz2-dev libfontconfig1-dev libfreetype6-dev libfribidi-dev libharfbuzz-dev libjansson-dev libogg-dev libsamplerate-dev libtheora-dev libtool libvorbis-dev libxml2-dev m4 make patch pkg-config python tar libtool-bin texinfo wget zlib1g-dev yasm cmake cmake-curses-gui mercurial libmp3lame-dev libopus-dev libvpx-dev libx264-dev unzip mkvtoolnix mp4v2-utils mpv ' \\\n && apt-get update \\\n && apt-get install --no-install-recommends $buildDeps -y \\\n && mkdir -p /usr/src/ffmpeg/bin \\\n && mkdir -p /usr/src/ffmpeg/build \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" \\\n && cd /usr/src/ffmpeg \\\n && wget http://www.nasm.us/pub/nasm/releasebuilds/$NASM_VERSION/nasm-$NASM_VERSION.tar.bz2 \\\n && tar xjvf nasm-*.tar.bz2 \\\n && cd nasm-* \\\n && ./autogen.sh \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" ./configure --prefix=\"/usr/src/ffmpeg/build\" --bindir=\"/usr/src/ffmpeg/bin\" \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" make -j\"$( nproc ;)\" \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf nasm-* \\\n && git clone -b stable http://git.videolan.org/git/x264.git x264 \\\n && cd x264 \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" ./configure --prefix=\"/usr/src/ffmpeg/build\" --bindir=\"/usr/src/ffmpeg/bin\" --enable-static --disable-opencl \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" make -j\"$( nproc ;)\" \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf x264-snapshot* \\\n && git clone https://github.com/mstorsjo/fdk-aac.git \\\n && cd fdk-aac \\\n && git checkout tags/v$FDKAAC_VERSION \\\n && autoreconf -fiv \\\n && ./configure --prefix=\"/usr/src/ffmpeg/build\" --disable-shared \\\n && make -j\"$( nproc ;)\" \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf mstorsjo-fdk-aac* \\\n && wget -O x265.tar.gz https://bitbucket.org/multicoreware/x265/downloads/x265_$LIBX265_VERSION.tar.gz \\\n && tar xzvf x265.tar.gz \\\n && cd x265_*/build/linux \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" cmake -G \"Unix Makefiles\" -DCMAKE_INSTALL_PREFIX=\"/usr/src/ffmpeg/build\" -DENABLE_SHARED:bool=off ../../source \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" make -j\"$( nproc ;)\" \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf x265 \\\n && git clone https://github.com/HandBrake/HandBrake.git \\\n && cd HandBrake \\\n && git checkout tags/$HANDBRAKE_VERSION \\\n && ./configure --launch-jobs=$( nproc ;) --disable-gtk --launch \\\n && cd build \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf HandBrake \\\n && wget -O ffmpeg.zip https://github.com/FFmpeg/FFmpeg/archive/n$FFMPEG_VERSION.zip \\\n && unzip ffmpeg.zip \\\n && mv FFmpeg* ffmpeg_src \\\n && cd ffmpeg_src \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" PKG_CONFIG_PATH=\"/usr/src/ffmpeg/build/lib/pkgconfig\" ./configure --prefix=\"/usr/src/ffmpeg/build\" --pkg-config-flags=\"--static\" --extra-cflags=\"-I/usr/src/ffmpeg/build/include\" --extra-ldflags=\"-L/usr/src/ffmpeg/build/lib\" --bindir=\"/usr/src/ffmpeg/bin\" --extra-libs=-lpthread --enable-gpl --enable-libass --enable-libfdk-aac --enable-libfreetype --enable-libmp3lame --enable-libopus --enable-libtheora --enable-libvorbis --enable-libvpx --enable-libx264 --enable-libx265 --enable-nonfree \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" make -j\"$( nproc ;)\" \\\n && make install \\\n && hash -r \\\n && cd / \\\n && mv /usr/src/ffmpeg/bin/ff* /usr/local/bin \\\n && rm -rf /usr/src/ffmpeg\nRUN set -ex \\\n && apt-get purge -y --auto-remove $buildDeps \\\n && rm -rf /var/lib/apt/lists/* \\\n && gem install video_transcoding \\\n && mkdir /data\nWORKDIR /data\nCMD [\"/bin/bash\"]\n","injectedSmells":[],"originalDockerfileHash":"edd6480dcfb9a080295b73d012a9b6ec","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   ntodd/video-transcoding:0.21.1\nFROM ntodd/ruby-xenial:2.4.0\nLABEL maintainer=\"Nate Todd <nate@pixelauthorityllc.com>\"\nENV GEM_VERSION=\"0.25.2\"\nENV NASM_VERSION=\"2.13.01\"\nENV FDKAAC_VERSION=\"0.1.6\"\nENV LIBX265_VERSION=\"2.9\"\nENV HANDBRAKE_VERSION=\"1.1.2\"\nENV FFMPEG_VERSION=\"4.1\"\n#   install build dependencies to compile ffmpeg from master\nRUN set -ex \\\n && buildDeps=' autoconf automake build-essential git libass-dev libbz2-dev libfontconfig1-dev libfreetype6-dev libfribidi-dev libharfbuzz-dev libjansson-dev libogg-dev libsamplerate-dev libtheora-dev libtool libvorbis-dev libxml2-dev m4 make patch pkg-config python tar libtool-bin texinfo wget zlib1g-dev yasm cmake cmake-curses-gui mercurial libmp3lame-dev libopus-dev libvpx-dev libx264-dev unzip mkvtoolnix mp4v2-utils mpv ' \\\n && apt-get update \\\n && apt-get install --no-install-recommends $buildDeps -y \\\n && mkdir -p /usr/src/ffmpeg/bin \\\n && mkdir -p /usr/src/ffmpeg/build \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" \\\n && cd /usr/src/ffmpeg \\\n && wget http://www.nasm.us/pub/nasm/releasebuilds/$NASM_VERSION/nasm-$NASM_VERSION.tar.bz2 \\\n && tar xjvf nasm-*.tar.bz2 \\\n && cd nasm-* \\\n && ./autogen.sh \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" ./configure --prefix=\"/usr/src/ffmpeg/build\" --bindir=\"/usr/src/ffmpeg/bin\" \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" make -j\"$( nproc ;)\" \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf nasm-* \\\n && git clone -b stable http://git.videolan.org/git/x264.git x264 \\\n && cd x264 \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" ./configure --prefix=\"/usr/src/ffmpeg/build\" --bindir=\"/usr/src/ffmpeg/bin\" --enable-static --disable-opencl \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" make -j\"$( nproc ;)\" \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf x264-snapshot* \\\n && git clone https://github.com/mstorsjo/fdk-aac.git \\\n && cd fdk-aac \\\n && git checkout tags/v$FDKAAC_VERSION \\\n && autoreconf -fiv \\\n && ./configure --prefix=\"/usr/src/ffmpeg/build\" --disable-shared \\\n && make -j\"$( nproc ;)\" \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf mstorsjo-fdk-aac* \\\n && wget -O x265.tar.gz https://bitbucket.org/multicoreware/x265/downloads/x265_$LIBX265_VERSION.tar.gz \\\n && tar xzvf x265.tar.gz \\\n && cd x265_*/build/linux \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" cmake -G \"Unix Makefiles\" -DCMAKE_INSTALL_PREFIX=\"/usr/src/ffmpeg/build\" -DENABLE_SHARED:bool=off ../../source \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" make -j\"$( nproc ;)\" \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf x265 \\\n && git clone https://github.com/HandBrake/HandBrake.git \\\n && cd HandBrake \\\n && git checkout tags/$HANDBRAKE_VERSION \\\n && ./configure --launch-jobs=$( nproc ;) --disable-gtk --launch \\\n && cd build \\\n && make install \\\n && cd /usr/src/ffmpeg \\\n && rm -rf HandBrake \\\n && wget -O ffmpeg.zip https://github.com/FFmpeg/FFmpeg/archive/n$FFMPEG_VERSION.zip \\\n && unzip ffmpeg.zip \\\n && mv FFmpeg* ffmpeg_src \\\n && cd ffmpeg_src \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" PKG_CONFIG_PATH=\"/usr/src/ffmpeg/build/lib/pkgconfig\" ./configure --prefix=\"/usr/src/ffmpeg/build\" --pkg-config-flags=\"--static\" --extra-cflags=\"-I/usr/src/ffmpeg/build/include\" --extra-ldflags=\"-L/usr/src/ffmpeg/build/lib\" --bindir=\"/usr/src/ffmpeg/bin\" --extra-libs=-lpthread --enable-gpl --enable-libass --enable-libfdk-aac --enable-libfreetype --enable-libmp3lame --enable-libopus --enable-libtheora --enable-libvorbis --enable-libvpx --enable-libx264 --enable-libx265 --enable-nonfree \\\n && PATH=\"/usr/src/ffmpeg/bin:$PATH\" make -j\"$( nproc ;)\" \\\n && make install \\\n && hash -r \\\n && cd / \\\n && mv /usr/src/ffmpeg/bin/ff* /usr/local/bin \\\n && rm -rf /usr/src/ffmpeg\nRUN set -ex \\\n && apt-get purge -y --auto-remove $buildDeps \\\n && rm -rf /var/lib/apt/lists/* \\\n && gem install video_transcoding \\\n && mkdir /data\nWORKDIR /data\nCMD [\"/bin/bash\"]\n","originalDockerfileUglifiedHash":"e38c7b5b0ee31a239a389d682dbdeadc","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/bd0ecd4d8e95be6a7d5a692910eafaeb6be64f21.dockerfile"}