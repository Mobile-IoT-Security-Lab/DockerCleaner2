{"seed":743397577,"processedDockerfileHash":"185053c34a6b82191cf3fa3b633bbc03","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM alpine:3.3\nENV LUA_SUFFIX=\"jit-2.1.0-beta1\" \\\n    LUAJIT_VERSION=\"2.1\" \\\n    NGINX_PREFIX=\"/opt/openresty/nginx\" \\\n    OPENRESTY_PREFIX=\"/opt/openresty\" \\\n    OPENRESTY_SRC_SHA1=\"1a2029e1c854b6ac788b4d734dd6b5c53a3987ff\" \\\n    OPENRESTY_VERSION=\"1.9.7.3\" \\\n    VAR_PREFIX=\"/var/nginx\" \\\n    LOR_VERSION=\"V0.0.9\" \\\n    LOR_PREFIX=\"/usr/local/lor\" \\\n    PYTHON_VERSION=\"2.7.11-r3\" \\\n    PY_PIP_VERSION=\"7.1.2-r0\" \\\n    SUPERVISOR_VERSION=\"3.2.0\"\nRUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/' /etc/apk/repositories\n#  # install openresty with luajit \nRUN set -ex \\\n && apk add curl=7.55.0-r2 make=4.1-r0 musl-dev=1.1.12-r8 gcc=5.3.0-r0 ncurses-dev=6.0_p20170701-r0 openssl-dev=1.0.2q-r0 pcre-dev=8.38-r1 perl=5.22.3-r0 readline-dev=6.3.008-r4 zlib-dev=1.2.11-r0 --no-cache --virtual .openresty-build-dependencies \\\n && curl -fsSL http://openresty.org/download/openresty-${OPENRESTY_VERSION}.tar.gz -o /tmp/openresty.tar.gz \\\n && cd /tmp \\\n && echo \"${OPENRESTY_SRC_SHA1} *openresty.tar.gz\" | sha1sum -c - \\\n && tar -xzf openresty.tar.gz \\\n && cd openresty-* \\\n && readonly NPROC=$( grep -c ^processor /proc/cpuinfo 2> /dev/null || 1 ;) \\\n && ./configure --prefix=${OPENRESTY_PREFIX} --http-client-body-temp-path=${VAR_PREFIX}/client_body_temp --http-proxy-temp-path=${VAR_PREFIX}/proxy_temp --http-log-path=${VAR_PREFIX}/access.log --error-log-path=${VAR_PREFIX}/error.log --pid-path=${VAR_PREFIX}/nginx.pid --lock-path=${VAR_PREFIX}/nginx.lock --with-luajit --with-pcre-jit --with-ipv6 --with-http_ssl_module --without-http_ssi_module --with-http_realip_module --without-http_scgi_module --without-http_uwsgi_module --without-http_userid_module -j${NPROC} \\\n && make -j${NPROC} \\\n && make install \\\n && rm -rf /tmp/openresty* \\\n && apk del .openresty-build-dependencies\nRUN ln -sf ${NGINX_PREFIX}/sbin/nginx /usr/local/bin/nginx \\\n && ln -sf ${NGINX_PREFIX}/sbin/nginx /usr/local/bin/openresty \\\n && ln -sf ${OPENRESTY_PREFIX}/bin/resty /usr/local/bin/resty \\\n && ln -sf ${OPENRESTY_PREFIX}/luajit/bin/luajit-* ${OPENRESTY_PREFIX}/luajit/bin/lua \\\n && ln -sf ${OPENRESTY_PREFIX}/luajit/bin/luajit-* /usr/local/bin/lua \\\n && ln -sf /opt/openresty/luajit/bin/luajit /usr/bin/luajit\nRUN apk add libgcc=5.3.0-r0 libpcrecpp=8.38-r1 libpcre16=8.38-r1 libpcre32=8.38-r1 libssl1.0=1.0.2q-r0 libstdc++=5.3.0-r0 openssl=1.0.2q-r0 pcre=8.38-r1 --no-cache\nRUN apk update \\\n && apk add python=$PYTHON_VERSION py-pip=$PY_PIP_VERSION -u\nRUN pip install supervisor==$SUPERVISOR_VERSION\nRUN apk update \\\n && apk add git=2.8.6-r0 --virtual .lor-build-deps \\\n && cd /tmp \\\n && git clone https://github.com/sumory/lor \\\n && cd lor \\\n && sh install.sh \\\n && rm -rf /tmp/lor \\\n && adduser -D -g '' -u 1000 nginx\nRUN apk add libuuid=2.27.1-r0 --update \\\n && rm -f /var/cache/apk/* \\\n && ln -s /usr/lib/libuuid.so $OPENRESTY_PREFIX/lualib\nCOPY ./supervisord.conf /etc/\nRUN mkdir -p /var/log/supervisor\nWORKDIR /tmp\nEXPOSE 8888/tcp\nCMD [\"/usr/bin/supervisord\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM alpine:3.3\nENV LUA_SUFFIX=\"jit-2.1.0-beta1\" \\\n    LUAJIT_VERSION=\"2.1\" \\\n    NGINX_PREFIX=\"/opt/openresty/nginx\" \\\n    OPENRESTY_PREFIX=\"/opt/openresty\" \\\n    OPENRESTY_SRC_SHA1=\"1a2029e1c854b6ac788b4d734dd6b5c53a3987ff\" \\\n    OPENRESTY_VERSION=\"1.9.7.3\" \\\n    VAR_PREFIX=\"/var/nginx\" \\\n    LOR_VERSION=\"V0.0.9\" \\\n    LOR_PREFIX=\"/usr/local/lor\" \\\n    PYTHON_VERSION=\"2.7.11-r3\" \\\n    PY_PIP_VERSION=\"7.1.2-r0\" \\\n    SUPERVISOR_VERSION=\"3.2.0\"\nRUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/' /etc/apk/repositories\n# # install openresty with luajit \nRUN set -ex \\\n && apk --no-cache add --virtual .openresty-build-dependencies curl make musl-dev gcc ncurses-dev openssl-dev pcre-dev perl readline-dev zlib-dev \\\n && curl -fsSL http://openresty.org/download/openresty-${OPENRESTY_VERSION}.tar.gz -o /tmp/openresty.tar.gz \\\n && cd /tmp \\\n && echo \"${OPENRESTY_SRC_SHA1} *openresty.tar.gz\" | sha1sum -c - \\\n && tar -xzf openresty.tar.gz \\\n && cd openresty-* \\\n && readonly NPROC=$( grep -c ^processor /proc/cpuinfo 2> /dev/null || 1 ;) \\\n && ./configure --prefix=${OPENRESTY_PREFIX} --http-client-body-temp-path=${VAR_PREFIX}/client_body_temp --http-proxy-temp-path=${VAR_PREFIX}/proxy_temp --http-log-path=${VAR_PREFIX}/access.log --error-log-path=${VAR_PREFIX}/error.log --pid-path=${VAR_PREFIX}/nginx.pid --lock-path=${VAR_PREFIX}/nginx.lock --with-luajit --with-pcre-jit --with-ipv6 --with-http_ssl_module --without-http_ssi_module --with-http_realip_module --without-http_scgi_module --without-http_uwsgi_module --without-http_userid_module -j${NPROC} \\\n && make -j${NPROC} \\\n && make install \\\n && rm -rf /tmp/openresty* \\\n && apk del .openresty-build-dependencies\nRUN ln -sf ${NGINX_PREFIX}/sbin/nginx /usr/local/bin/nginx \\\n && ln -sf ${NGINX_PREFIX}/sbin/nginx /usr/local/bin/openresty \\\n && ln -sf ${OPENRESTY_PREFIX}/bin/resty /usr/local/bin/resty \\\n && ln -sf ${OPENRESTY_PREFIX}/luajit/bin/luajit-* ${OPENRESTY_PREFIX}/luajit/bin/lua \\\n && ln -sf ${OPENRESTY_PREFIX}/luajit/bin/luajit-* /usr/local/bin/lua \\\n && ln -sf /opt/openresty/luajit/bin/luajit /usr/bin/luajit\nRUN apk --no-cache add libgcc libpcrecpp libpcre16 libpcre32 libssl1.0 libstdc++ openssl pcre\nRUN apk update \\\n && apk add -u python=$PYTHON_VERSION py-pip=$PY_PIP_VERSION\nRUN pip install supervisor==$SUPERVISOR_VERSION\nRUN apk update \\\n && apk add --virtual .lor-build-deps git \\\n && cd /tmp \\\n && git clone https://github.com/sumory/lor \\\n && cd lor \\\n && sh install.sh \\\n && rm -rf /tmp/lor \\\n && adduser -D -g '' -u 1000 nginx\nRUN apk --update add libuuid \\\n && rm -f /var/cache/apk/* \\\n && ln -s /usr/lib/libuuid.so $OPENRESTY_PREFIX/lualib\nADD ./supervisord.conf /etc/\nRUN mkdir -p /var/log/supervisor\nWORKDIR /tmp\nEXPOSE 8888/tcp\nCMD [\"/usr/bin/supervisord\"]\n","injectedSmells":[],"originalDockerfileHash":"5bf0d6b3afee20ad8987a6c22c4f58c9","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM alpine:3.3\nENV LUA_SUFFIX=\"jit-2.1.0-beta1\" \\\n    LUAJIT_VERSION=\"2.1\" \\\n    NGINX_PREFIX=\"/opt/openresty/nginx\" \\\n    OPENRESTY_PREFIX=\"/opt/openresty\" \\\n    OPENRESTY_SRC_SHA1=\"1a2029e1c854b6ac788b4d734dd6b5c53a3987ff\" \\\n    OPENRESTY_VERSION=\"1.9.7.3\" \\\n    VAR_PREFIX=\"/var/nginx\" \\\n    LOR_VERSION=\"V0.0.9\" \\\n    LOR_PREFIX=\"/usr/local/lor\" \\\n    PYTHON_VERSION=\"2.7.11-r3\" \\\n    PY_PIP_VERSION=\"7.1.2-r0\" \\\n    SUPERVISOR_VERSION=\"3.2.0\"\nRUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/' /etc/apk/repositories\n#  # install openresty with luajit \nRUN set -ex \\\n && apk --no-cache add --virtual .openresty-build-dependencies curl make musl-dev gcc ncurses-dev openssl-dev pcre-dev perl readline-dev zlib-dev \\\n && curl -fsSL http://openresty.org/download/openresty-${OPENRESTY_VERSION}.tar.gz -o /tmp/openresty.tar.gz \\\n && cd /tmp \\\n && echo \"${OPENRESTY_SRC_SHA1} *openresty.tar.gz\" | sha1sum -c - \\\n && tar -xzf openresty.tar.gz \\\n && cd openresty-* \\\n && readonly NPROC=$( grep -c ^processor /proc/cpuinfo 2> /dev/null || 1 ;) \\\n && ./configure --prefix=${OPENRESTY_PREFIX} --http-client-body-temp-path=${VAR_PREFIX}/client_body_temp --http-proxy-temp-path=${VAR_PREFIX}/proxy_temp --http-log-path=${VAR_PREFIX}/access.log --error-log-path=${VAR_PREFIX}/error.log --pid-path=${VAR_PREFIX}/nginx.pid --lock-path=${VAR_PREFIX}/nginx.lock --with-luajit --with-pcre-jit --with-ipv6 --with-http_ssl_module --without-http_ssi_module --with-http_realip_module --without-http_scgi_module --without-http_uwsgi_module --without-http_userid_module -j${NPROC} \\\n && make -j${NPROC} \\\n && make install \\\n && rm -rf /tmp/openresty* \\\n && apk del .openresty-build-dependencies\nRUN ln -sf ${NGINX_PREFIX}/sbin/nginx /usr/local/bin/nginx \\\n && ln -sf ${NGINX_PREFIX}/sbin/nginx /usr/local/bin/openresty \\\n && ln -sf ${OPENRESTY_PREFIX}/bin/resty /usr/local/bin/resty \\\n && ln -sf ${OPENRESTY_PREFIX}/luajit/bin/luajit-* ${OPENRESTY_PREFIX}/luajit/bin/lua \\\n && ln -sf ${OPENRESTY_PREFIX}/luajit/bin/luajit-* /usr/local/bin/lua \\\n && ln -sf /opt/openresty/luajit/bin/luajit /usr/bin/luajit\nRUN apk --no-cache add libgcc libpcrecpp libpcre16 libpcre32 libssl1.0 libstdc++ openssl pcre\nRUN apk update \\\n && apk add -u python=$PYTHON_VERSION py-pip=$PY_PIP_VERSION\nRUN pip install supervisor==$SUPERVISOR_VERSION\nRUN apk update \\\n && apk add --virtual .lor-build-deps git \\\n && cd /tmp \\\n && git clone https://github.com/sumory/lor \\\n && cd lor \\\n && sh install.sh \\\n && rm -rf /tmp/lor \\\n && adduser -D -g '' -u 1000 nginx\nRUN apk --update add libuuid \\\n && rm -f /var/cache/apk/* \\\n && ln -s /usr/lib/libuuid.so $OPENRESTY_PREFIX/lualib\nADD ./supervisord.conf /etc/\nRUN mkdir -p /var/log/supervisor\nWORKDIR /tmp\nEXPOSE 8888/tcp\nCMD [\"/usr/bin/supervisord\"]\n","originalDockerfileUglifiedHash":"8e187f9b0c7a2d033b1b35cc54470186","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/8c34e965c6396d63e4ce08dca7fd024e36d6e79d.dockerfile"}