{"seed":1770240578,"processedDockerfileHash":"1359973c61527369f7be2cc236b693d8","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apt-get","have-a-healthcheck"],"processedDockerfile":"FROM php:7.1.26-fpm-stretch\nLABEL maintainer=\"Bert Oost <hello@bertoost.com>\"\n#   Create docker PHP user.\nRUN adduser -u 1000 --system --shell /bin/bash --group --disabled-password php\nRUN mkdir -p /var/www/html \\\n && chown php:php /var/www/html\n#   Install modules\nRUN apt-get update \\\n && apt-get install --no-install-recommends wget build-essential libfreetype6-dev libjpeg62-turbo-dev libmcrypt-dev libpng-dev imagemagick git locales libssl-dev re2c libmcrypt-dev zip unzip libicu57 libmagickwand-6.q16-dev libicu-dev g++ ssmtp libyaml-dev gettext openssh-client pdftk apt-transport-https mysql-client -y \\\n && rm -rf /var/lib/apt/lists/*\nRUN docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n && docker-php-ext-install iconv mcrypt gd pdo pdo_mysql mysqli mbstring soap sysvmsg sysvshm sysvsem intl opcache pcntl shmop zip gettext sockets exif\nRUN echo 'en_US ISO-8859-1\\n en_US.ISO-8859-15 ISO-8859-15\\n en_US.UTF-8 UTF-8\\n nl_NL ISO-8859-1\\n nl_NL.UTF-8 UTF-8\\n nl_NL@euro ISO-8859-15\\n' >> /etc/locale.gen \\\n && /usr/sbin/locale-gen\nRUN ln -s /usr/lib/x86_64-linux-gnu/ImageMagick-6.8.9/bin-Q16/MagickWand-config /usr/bin/\nRUN wget https://download.libsodium.org/libsodium/releases/libsodium-1.0.16.tar.gz --output-document=/tmp/libsodium.tar.gz \\\n && cd /tmp \\\n && tar -xzvf libsodium.tar.gz \\\n && cd libsodium-1.0.16 \\\n && ./configure \\\n && make \\\n && make check \\\n && make install \\\n && rm -rf /tmp/libsodium*\nRUN pecl install yaml-2.0.0 imagick libsodium APCu\nRUN echo \"extension=yaml.so\" > /usr/local/etc/php/conf.d/pecl-yaml.ini \\\n && echo \"extension=imagick.so\" > /usr/local/etc/php/conf.d/pecl-imagck.ini \\\n && echo \"extension=apcu.so\" > /usr/local/etc/php/conf.d/pecl-apcu.ini \\\n && echo \"extension=sodium.so\" > /usr/local/etc/php/conf.d/pecl-sodium.ini\n#   Composer\nRUN curl -sS https://getcomposer.org/installer | php -d memory_limit=-1 -- --install-dir=/usr/local/bin --filename=composer \\\n && chmod +x /usr/local/bin/composer\n#   Remove temporary stuff\nRUN apt-get purge -y --auto-remove libicu-dev g++\n#   Add composer and php scripts for aliases.\nCOPY home/ /home/php/\nRUN chmod +x /home/php/composer.sh \\\n && chmod +x /home/php/php.sh \\\n && chown php:php /home/php/php.sh /home/php/composer.sh \\\n && echo \"alias php=/home/php/php.sh\" >> /home/php/.bashrc \\\n && echo \"alias composer=/home/php/composer.sh\" >> /home/php/.bashrc\n#   php.ini\nCOPY conf.d/php.ini /usr/local/etc/php/conf.d/00-php.ini\nCOPY conf.d/fpm-pool.conf /usr/local/etc/php-fpm.d/www.conf\n#   SSMTP config.\nCOPY conf.d/ssmtp.conf /etc/ssmtp/ssmtp.conf.placeholder\nRUN rm -rf /etc/ssmtp/ssmtp.conf \\\n && touch /etc/ssmtp/ssmtp.conf \\\n && chown php:php /etc/ssmtp/ssmtp.conf \\\n && chown php:php /etc/ssmtp/ssmtp.conf.placeholder\n#   Custom entrypoint\nCOPY scripts/entrypoint.sh /home/php/entrypoint.sh\nRUN chown php:php /home/php/entrypoint.sh \\\n && chmod +x /home/php/entrypoint.sh\n#   Run commands inside this container as the created PHP user.\nUSER php\nWORKDIR /var/www/html\nENTRYPOINT [\"/home/php/entrypoint.sh\"]\nCMD [\"php-fpm\"]\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n","originalDockerfile":"FROM php:7.1.26-fpm-stretch\nLABEL maintainer=\"Bert Oost <hello@bertoost.com>\"\n#  Create docker PHP user.\nRUN adduser -u 1000 --system --shell /bin/bash --group --disabled-password php\nRUN mkdir -p /var/www/html \\\n && chown php:php /var/www/html\n#  Install modules\nRUN apt-get update \\\n && apt-get install --no-install-recommends wget build-essential libfreetype6-dev libjpeg62-turbo-dev libmcrypt-dev libpng-dev imagemagick git locales libssl-dev re2c libmcrypt-dev zip unzip libicu57 libmagickwand-6.q16-dev libicu-dev g++ ssmtp libyaml-dev gettext openssh-client pdftk apt-transport-https mysql-client -y \\\n && rm -rf /var/lib/apt/lists/*\nRUN docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n && docker-php-ext-install iconv mcrypt gd pdo pdo_mysql mysqli mbstring soap sysvmsg sysvshm sysvsem intl opcache pcntl shmop zip gettext sockets exif\nRUN echo 'en_US ISO-8859-1\\n en_US.ISO-8859-15 ISO-8859-15\\n en_US.UTF-8 UTF-8\\n nl_NL ISO-8859-1\\n nl_NL.UTF-8 UTF-8\\n nl_NL@euro ISO-8859-15\\n' >> /etc/locale.gen \\\n && /usr/sbin/locale-gen\nRUN ln -s /usr/lib/x86_64-linux-gnu/ImageMagick-6.8.9/bin-Q16/MagickWand-config /usr/bin/\nRUN wget https://download.libsodium.org/libsodium/releases/libsodium-1.0.16.tar.gz --output-document=/tmp/libsodium.tar.gz \\\n && cd /tmp \\\n && tar -xzvf libsodium.tar.gz \\\n && cd libsodium-1.0.16 \\\n && ./configure \\\n && make \\\n && make check \\\n && make install \\\n && rm -rf /tmp/libsodium*\nRUN pecl install yaml-2.0.0 imagick libsodium APCu\nRUN echo \"extension=yaml.so\" > /usr/local/etc/php/conf.d/pecl-yaml.ini \\\n && echo \"extension=imagick.so\" > /usr/local/etc/php/conf.d/pecl-imagck.ini \\\n && echo \"extension=apcu.so\" > /usr/local/etc/php/conf.d/pecl-apcu.ini \\\n && echo \"extension=sodium.so\" > /usr/local/etc/php/conf.d/pecl-sodium.ini\n#  Composer\nRUN curl -sS https://getcomposer.org/installer | php -d memory_limit=-1 -- --install-dir=/usr/local/bin --filename=composer \\\n && chmod +x /usr/local/bin/composer\n#  Remove temporary stuff\nRUN apt-get purge -y --auto-remove libicu-dev g++\n#  Add composer and php scripts for aliases.\nCOPY home/ /home/php/\nRUN chmod +x /home/php/composer.sh \\\n && chmod +x /home/php/php.sh \\\n && chown php:php /home/php/php.sh /home/php/composer.sh \\\n && echo \"alias php=/home/php/php.sh\" >> /home/php/.bashrc \\\n && echo \"alias composer=/home/php/composer.sh\" >> /home/php/.bashrc\n#  php.ini\nCOPY conf.d/php.ini /usr/local/etc/php/conf.d/00-php.ini\nCOPY conf.d/fpm-pool.conf /usr/local/etc/php-fpm.d/www.conf\n#  SSMTP config.\nCOPY conf.d/ssmtp.conf /etc/ssmtp/ssmtp.conf.placeholder\nRUN rm -rf /etc/ssmtp/ssmtp.conf \\\n && touch /etc/ssmtp/ssmtp.conf \\\n && chown php:php /etc/ssmtp/ssmtp.conf \\\n && chown php:php /etc/ssmtp/ssmtp.conf.placeholder\n#  Custom entrypoint\nCOPY scripts/entrypoint.sh /home/php/entrypoint.sh\nRUN chown php:php /home/php/entrypoint.sh \\\n && chmod +x /home/php/entrypoint.sh\n#  Run commands inside this container as the created PHP user.\nUSER php\nWORKDIR /var/www/html\nENTRYPOINT [\"/home/php/entrypoint.sh\"]\nCMD [\"php-fpm\"]\n","injectedSmells":[],"originalDockerfileHash":"fbeea454758a664cdd05f3976983ba42","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM php:7.1.26-fpm-stretch\nLABEL maintainer=\"Bert Oost <hello@bertoost.com>\"\n#   Create docker PHP user.\nRUN adduser -u 1000 --system --shell /bin/bash --group --disabled-password php\nRUN mkdir -p /var/www/html \\\n && chown php:php /var/www/html\n#   Install modules\nRUN apt-get update \\\n && apt-get install --no-install-recommends wget build-essential libfreetype6-dev libjpeg62-turbo-dev libmcrypt-dev libpng-dev imagemagick git locales libssl-dev re2c libmcrypt-dev zip unzip libicu57 libmagickwand-6.q16-dev libicu-dev g++ ssmtp libyaml-dev gettext openssh-client pdftk apt-transport-https mysql-client -y \\\n && rm -rf /var/lib/apt/lists/*\nRUN docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n && docker-php-ext-install iconv mcrypt gd pdo pdo_mysql mysqli mbstring soap sysvmsg sysvshm sysvsem intl opcache pcntl shmop zip gettext sockets exif\nRUN echo 'en_US ISO-8859-1\\n en_US.ISO-8859-15 ISO-8859-15\\n en_US.UTF-8 UTF-8\\n nl_NL ISO-8859-1\\n nl_NL.UTF-8 UTF-8\\n nl_NL@euro ISO-8859-15\\n' >> /etc/locale.gen \\\n && /usr/sbin/locale-gen\nRUN ln -s /usr/lib/x86_64-linux-gnu/ImageMagick-6.8.9/bin-Q16/MagickWand-config /usr/bin/\nRUN wget https://download.libsodium.org/libsodium/releases/libsodium-1.0.16.tar.gz --output-document=/tmp/libsodium.tar.gz \\\n && cd /tmp \\\n && tar -xzvf libsodium.tar.gz \\\n && cd libsodium-1.0.16 \\\n && ./configure \\\n && make \\\n && make check \\\n && make install \\\n && rm -rf /tmp/libsodium*\nRUN pecl install yaml-2.0.0 imagick libsodium APCu\nRUN echo \"extension=yaml.so\" > /usr/local/etc/php/conf.d/pecl-yaml.ini \\\n && echo \"extension=imagick.so\" > /usr/local/etc/php/conf.d/pecl-imagck.ini \\\n && echo \"extension=apcu.so\" > /usr/local/etc/php/conf.d/pecl-apcu.ini \\\n && echo \"extension=sodium.so\" > /usr/local/etc/php/conf.d/pecl-sodium.ini\n#   Composer\nRUN curl -sS https://getcomposer.org/installer | php -d memory_limit=-1 -- --install-dir=/usr/local/bin --filename=composer \\\n && chmod +x /usr/local/bin/composer\n#   Remove temporary stuff\nRUN apt-get purge -y --auto-remove libicu-dev g++\n#   Add composer and php scripts for aliases.\nCOPY home/ /home/php/\nRUN chmod +x /home/php/composer.sh \\\n && chmod +x /home/php/php.sh \\\n && chown php:php /home/php/php.sh /home/php/composer.sh \\\n && echo \"alias php=/home/php/php.sh\" >> /home/php/.bashrc \\\n && echo \"alias composer=/home/php/composer.sh\" >> /home/php/.bashrc\n#   php.ini\nCOPY conf.d/php.ini /usr/local/etc/php/conf.d/00-php.ini\nCOPY conf.d/fpm-pool.conf /usr/local/etc/php-fpm.d/www.conf\n#   SSMTP config.\nCOPY conf.d/ssmtp.conf /etc/ssmtp/ssmtp.conf.placeholder\nRUN rm -rf /etc/ssmtp/ssmtp.conf \\\n && touch /etc/ssmtp/ssmtp.conf \\\n && chown php:php /etc/ssmtp/ssmtp.conf \\\n && chown php:php /etc/ssmtp/ssmtp.conf.placeholder\n#   Custom entrypoint\nCOPY scripts/entrypoint.sh /home/php/entrypoint.sh\nRUN chown php:php /home/php/entrypoint.sh \\\n && chmod +x /home/php/entrypoint.sh\n#   Run commands inside this container as the created PHP user.\nUSER php\nWORKDIR /var/www/html\nENTRYPOINT [\"/home/php/entrypoint.sh\"]\nCMD [\"php-fpm\"]\n","originalDockerfileUglifiedHash":"962c3251349c5eefc6542168fc507384","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/a635ad40c68288363cdaa9ab7f6d0aa5d0966f1c.dockerfile"}