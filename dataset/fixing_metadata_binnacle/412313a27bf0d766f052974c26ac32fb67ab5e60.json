{"seed":85545914,"processedDockerfileHash":"39f62ef7f9649d70ed81bee52a79adca","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-npm","use-copy-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM php:7-cli AS builder\nRUN :\nRUN (apt-get update ;apt-get install --no-install-recommends gnupg2=2.2.27-2+deb11u2 -y )\nRUN curl -sL https://deb.nodesource.com/setup_10.x | bash -\nRUN (apt-get update ;apt-get install --no-install-recommends nodejs=12.22.12~dfsg-1~deb11u3 -y )\nWORKDIR /app\nCOPY package.json .\nRUN npm install\nRUN npm install grunt-cli@1.4.3 -g\nCOPY .sandstorm/ .sandstorm/\nCOPY .tx/ .tx/\nCOPY docs/ docs/\nCOPY Jelastic/ Jelastic/\nCOPY build/ build/\nCOPY client/ client/\nCOPY restyaboard.conf .\nCOPY sql/ sql/\nCOPY api_explorer/ api_explorer/\nCOPY server/ server/\nCOPY media/ media/\nCOPY .codeclimate.yml .\nCOPY .htaccess .\nCOPY diagnose.php .\nCOPY ejabberd.yml .\nCOPY restyaboard.sh .\nCOPY restyaboard-ssl.conf .\nCOPY restyaboard_uninstall.sh .\nCOPY Gruntfile.js .\nRUN npm run docker:prebuild\n#   Result image\nFROM debian:stretch\n#   update & install package\nRUN : \\\n && echo \"postfix postfix/mailname string localhost\" | debconf-set-selections \\\n && echo \"postfix postfix/main_mailer_type string 'Internet Site'\" | debconf-set-selections \\\n && TERM=linux DEBIAN_FRONTEND=noninteractive apt-get install -y cron curl imagemagick jq libpq5 nginx postfix postgresql-client unzip wget\n#   Necessary steps for php7.2\nRUN (apt-get update ;apt-get install --no-install-recommends apt-transport-https=2.2.4 lsb-release=11.1.0 ca-certificates=20210119 -y ) \\\n && wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg \\\n && sh -c 'echo \"deb https://packages.sury.org/php/ $(lsb_release -sc) main\" > /etc/apt/sources.list.d/php.list' \\\n && apt-get update\nRUN (apt-get update ;apt-get install --no-install-recommends php7.2 php7.2-cli php7.2-common php7.2-curl php7.2-fpm php7.2-imagick php7.2-imap php7.2-ldap php7.2-mbstring php7.2-pgsql php7.2-xml -y )\n#   after initial setup of deps to improve rebuilding speed\n# A secret has been removed here. Please do not provide secrets from the Dockerfile as these will leak into the metadata of the resulting docker image. To provide secrets the --secret flag of the docker build command can be used (https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information).\nENV ROOT_DIR=\"/usr/share/nginx/html\" \\\n    CONF_FILE=\"/etc/nginx/conf.d/restyaboard.conf\" \\\n    SMTP_DOMAIN=\"localhost\" \\\n    SMTP_USERNAME=\"root\" \\\n    SMTP_SERVER=\"localhost\" \\\n    SMTP_PORT=\"465\" \\\n    TZ=\"Etc/UTC\"\n#   deploy app\nCOPY --from=builder /app/restyaboard-docker.zip /tmp/restyaboard.zip\nRUN unzip /tmp/restyaboard.zip -d ${ROOT_DIR} \\\n && rm /tmp/restyaboard.zip \\\n && chown -R www-data:www-data ${ROOT_DIR}\n#   install apps\nCOPY docker-scripts/install_apps.sh /tmp/\nRUN chmod +x /tmp/install_apps.sh\nRUN . /tmp/install_apps.sh \\\n && chown -R www-data:www-data ${ROOT_DIR}\n#   configure app\nWORKDIR ${ROOT_DIR}\nRUN rm /etc/nginx/sites-enabled/default \\\n && cp restyaboard.conf ${CONF_FILE} \\\n && sed -i \"s/server_name.*$/server_name \\\"localhost\\\";/\" ${CONF_FILE} \\\n && sed -i \"s|listen 80.*$|listen 80;|\" ${CONF_FILE} \\\n && sed -i \"s|root.*html|root ${ROOT_DIR}|\" ${CONF_FILE}\n#   cleanup\nRUN apt-get autoremove -y --purge \\\n && apt-get clean\n#   Default values. Can be changed during container start.\n# A secret has been removed here. Please do not provide secrets from the Dockerfile as these will leak into the metadata of the resulting docker image. To provide secrets the --secret flag of the docker build command can be used (https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information).\nENV POSTGRES_HOST=\"postgres\" \\\n    POSTGRES_PORT=\"5432\" \\\n    POSTGRES_USER=\"admin\" \\\n    POSTGRES_DB=\"restyaboard\"\n#   entrypoint\nCOPY docker-scripts/docker-entrypoint.sh /\nRUN chmod +x /docker-entrypoint.sh\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nCMD [\"start\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n","originalDockerfile":"FROM php:7-cli AS builder\nRUN apt-get update\nRUN apt-get install gnupg2 -y\nRUN curl -sL https://deb.nodesource.com/setup_10.x | bash -\nRUN apt-get install nodejs -y\nWORKDIR /app\nCOPY package.json .\nRUN npm install\nRUN npm install grunt-cli -g\nCOPY .sandstorm/ .sandstorm/\nCOPY .tx/ .tx/\nCOPY docs/ docs/\nCOPY Jelastic/ Jelastic/\nCOPY build/ build/\nCOPY client/ client/\nCOPY restyaboard.conf .\nCOPY sql/ sql/\nCOPY api_explorer/ api_explorer/\nCOPY server/ server/\nCOPY media/ media/\nCOPY .codeclimate.yml .\nCOPY .htaccess .\nCOPY diagnose.php .\nCOPY ejabberd.yml .\nCOPY restyaboard.sh .\nCOPY restyaboard-ssl.conf .\nCOPY restyaboard_uninstall.sh .\nCOPY Gruntfile.js .\nRUN npm run docker:prebuild\n#  Result image\nFROM debian:stretch\n#  update & install package\nRUN apt-get update \\\n && echo \"postfix postfix/mailname string localhost\" | debconf-set-selections \\\n && echo \"postfix postfix/main_mailer_type string 'Internet Site'\" | debconf-set-selections \\\n && TERM=linux DEBIAN_FRONTEND=noninteractive apt-get install -y cron curl imagemagick jq libpq5 nginx postfix postgresql-client unzip wget\n#  Necessary steps for php7.2\nRUN apt-get install -y apt-transport-https lsb-release ca-certificates \\\n && wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg \\\n && sh -c 'echo \"deb https://packages.sury.org/php/ $(lsb_release -sc) main\" > /etc/apt/sources.list.d/php.list' \\\n && apt-get update\nRUN apt-get install php7.2 php7.2-cli php7.2-common php7.2-curl php7.2-fpm php7.2-imagick php7.2-imap php7.2-ldap php7.2-mbstring php7.2-pgsql php7.2-xml -y\n#  after initial setup of deps to improve rebuilding speed\nENV ROOT_DIR=\"/usr/share/nginx/html\" \\\n    CONF_FILE=\"/etc/nginx/conf.d/restyaboard.conf\" \\\n    SMTP_DOMAIN=\"localhost\" \\\n    SMTP_USERNAME=\"root\" \\\n    SMTP_PASSWORD=\"root\" \\\n    SMTP_SERVER=\"localhost\" \\\n    SMTP_PORT=\"465\" \\\n    TZ=\"Etc/UTC\"\n#  deploy app\nCOPY --from=builder /app/restyaboard-docker.zip /tmp/restyaboard.zip\nRUN unzip /tmp/restyaboard.zip -d ${ROOT_DIR} \\\n && rm /tmp/restyaboard.zip \\\n && chown -R www-data:www-data ${ROOT_DIR}\n#  install apps\nADD docker-scripts/install_apps.sh /tmp/\nRUN chmod +x /tmp/install_apps.sh\nRUN . /tmp/install_apps.sh \\\n && chown -R www-data:www-data ${ROOT_DIR}\n#  configure app\nWORKDIR ${ROOT_DIR}\nRUN rm /etc/nginx/sites-enabled/default \\\n && cp restyaboard.conf ${CONF_FILE} \\\n && sed -i \"s/server_name.*$/server_name \\\"localhost\\\";/\" ${CONF_FILE} \\\n && sed -i \"s|listen 80.*$|listen 80;|\" ${CONF_FILE} \\\n && sed -i \"s|root.*html|root ${ROOT_DIR}|\" ${CONF_FILE}\n#  cleanup\nRUN apt-get autoremove -y --purge \\\n && apt-get clean\n#  Default values. Can be changed during container start.\nENV POSTGRES_HOST=\"postgres\" \\\n    POSTGRES_PORT=\"5432\" \\\n    POSTGRES_USER=\"admin\" \\\n    POSTGRES_PASSWORD=\"admin\" \\\n    POSTGRES_DB=\"restyaboard\"\n#  entrypoint\nCOPY docker-scripts/docker-entrypoint.sh /\nRUN chmod +x /docker-entrypoint.sh\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nCMD [\"start\"]\n","injectedSmells":[],"originalDockerfileHash":"6d06ef5cebb94be878fc76b7051953ba","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM php:7-cli AS builder\nRUN apt-get update\nRUN apt-get install gnupg2 -y\nRUN curl -sL https://deb.nodesource.com/setup_10.x | bash -\nRUN apt-get install nodejs -y\nWORKDIR /app\nCOPY package.json .\nRUN npm install\nRUN npm install grunt-cli -g\nCOPY .sandstorm/ .sandstorm/\nCOPY .tx/ .tx/\nCOPY docs/ docs/\nCOPY Jelastic/ Jelastic/\nCOPY build/ build/\nCOPY client/ client/\nCOPY restyaboard.conf .\nCOPY sql/ sql/\nCOPY api_explorer/ api_explorer/\nCOPY server/ server/\nCOPY media/ media/\nCOPY .codeclimate.yml .\nCOPY .htaccess .\nCOPY diagnose.php .\nCOPY ejabberd.yml .\nCOPY restyaboard.sh .\nCOPY restyaboard-ssl.conf .\nCOPY restyaboard_uninstall.sh .\nCOPY Gruntfile.js .\nRUN npm run docker:prebuild\n#   Result image\nFROM debian:stretch\n#   update & install package\nRUN apt-get update \\\n && echo \"postfix postfix/mailname string localhost\" | debconf-set-selections \\\n && echo \"postfix postfix/main_mailer_type string 'Internet Site'\" | debconf-set-selections \\\n && TERM=linux DEBIAN_FRONTEND=noninteractive apt-get install -y cron curl imagemagick jq libpq5 nginx postfix postgresql-client unzip wget\n#   Necessary steps for php7.2\nRUN apt-get install apt-transport-https lsb-release ca-certificates -y \\\n && wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg \\\n && sh -c 'echo \"deb https://packages.sury.org/php/ $(lsb_release -sc) main\" > /etc/apt/sources.list.d/php.list' \\\n && apt-get update\nRUN apt-get install php7.2 php7.2-cli php7.2-common php7.2-curl php7.2-fpm php7.2-imagick php7.2-imap php7.2-ldap php7.2-mbstring php7.2-pgsql php7.2-xml -y\n#   after initial setup of deps to improve rebuilding speed\nENV ROOT_DIR=\"/usr/share/nginx/html\" \\\n    CONF_FILE=\"/etc/nginx/conf.d/restyaboard.conf\" \\\n    SMTP_DOMAIN=\"localhost\" \\\n    SMTP_USERNAME=\"root\" \\\n    SMTP_PASSWORD=\"root\" \\\n    SMTP_SERVER=\"localhost\" \\\n    SMTP_PORT=\"465\" \\\n    TZ=\"Etc/UTC\"\n#   deploy app\nCOPY --from=builder /app/restyaboard-docker.zip /tmp/restyaboard.zip\nRUN unzip /tmp/restyaboard.zip -d ${ROOT_DIR} \\\n && rm /tmp/restyaboard.zip \\\n && chown -R www-data:www-data ${ROOT_DIR}\n#   install apps\nADD docker-scripts/install_apps.sh /tmp/\nRUN chmod +x /tmp/install_apps.sh\nRUN . /tmp/install_apps.sh \\\n && chown -R www-data:www-data ${ROOT_DIR}\n#   configure app\nWORKDIR ${ROOT_DIR}\nRUN rm /etc/nginx/sites-enabled/default \\\n && cp restyaboard.conf ${CONF_FILE} \\\n && sed -i \"s/server_name.*$/server_name \\\"localhost\\\";/\" ${CONF_FILE} \\\n && sed -i \"s|listen 80.*$|listen 80;|\" ${CONF_FILE} \\\n && sed -i \"s|root.*html|root ${ROOT_DIR}|\" ${CONF_FILE}\n#   cleanup\nRUN apt-get autoremove -y --purge \\\n && apt-get clean\n#   Default values. Can be changed during container start.\nENV POSTGRES_HOST=\"postgres\" \\\n    POSTGRES_PORT=\"5432\" \\\n    POSTGRES_USER=\"admin\" \\\n    POSTGRES_PASSWORD=\"admin\" \\\n    POSTGRES_DB=\"restyaboard\"\n#   entrypoint\nCOPY docker-scripts/docker-entrypoint.sh /\nRUN chmod +x /docker-entrypoint.sh\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nCMD [\"start\"]\n","originalDockerfileUglifiedHash":"6dc586f5b0f0c670658638711a09d753","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/412313a27bf0d766f052974c26ac32fb67ab5e60.dockerfile"}