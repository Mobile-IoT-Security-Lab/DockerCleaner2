{"seed":3243451927,"processedDockerfileHash":"4d569b4cd9c42a0715c42cadf2109051","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM ubuntu:14.04\nMAINTAINER John Billings <billings@yelp.com>\n#   Need Python 3.6\nRUN apt-get update > /dev/null \\\n && apt-get install --no-install-recommends software-properties-common=0.92.37.8 -y \\\n && add-apt-repository ppa:deadsnakes/ppa\nRUN apt-get update \\\n && apt-get install --no-install-recommends libcurl3=7.35.0-1ubuntu2.20 iptables=1.4.21-1ubuntu1 python3.6 python-setuptools=3.3-1ubuntu2 python-pytest=2.5.1-1 python-pycurl=7.19.3-0ubuntu3 python-kazoo=1.2.1-1ubuntu4 python-zope.interface=4.0.5-1ubuntu4 ruby1.9.1=1.9.3.484-2ubuntu1.14 ruby1.9.1-dev=1.9.3.484-2ubuntu1.14 rubygems1.9.1 libxml2=2.9.1+dfsg1-3ubuntu4.13 libxml2-dev=2.9.1+dfsg1-3ubuntu4.13 libxslt-dev libssl-dev=1.0.1f-1ubuntu2.27 build-essential=11.6ubuntu6 zlib1g-dev=1:1.2.8.dfsg-1ubuntu1.1 -y\n#   Lua 5.3 for scripting with HAProxy\nWORKDIR /\nRUN which wget &> /dev/null || apt-get install --no-install-recommends wget=1.20.3 ; wget --no-verbose --output-document /lua-5.3.1.tar.gz http://www.lua.org/ftp/lua-5.3.1.tar.gz\nRUN tar -axvf /lua-5.3.1.tar.gz\nWORKDIR /lua-5.3.1\nRUN pwd\nRUN make generic\nRUN make install INSTALL_TOP=/usr/bin/lua\n#   Ubuntu trusty nginx and haproxy are ancient, grab newer ones\nWORKDIR /\nRUN which wget &> /dev/null || apt-get install --no-install-recommends wget=1.20.3 ; wget --no-verbose --output-document /haproxy.tar.gz http://www.haproxy.org/download/1.7/src/haproxy-1.7.8.tar.gz\nRUN tar -axvf /haproxy.tar.gz\nWORKDIR /haproxy-1.7.8\nRUN pwd\nRUN make TARGET=linux26 -j 4 USE_LUA=1 LUA_LIB=/usr/bin/lua/lib LUA_INC=/usr/bin/lua/include \\\n && mv haproxy /usr/bin/haproxy-synapse\n#   Nginx\nWORKDIR /\nRUN which wget &> /dev/null || apt-get install --no-install-recommends wget=1.20.3 ; wget --no-verbose --output-document /nginx.tar.gz https://nginx.org/download/nginx-1.11.10.tar.gz\nRUN tar -axvf /nginx.tar.gz\nWORKDIR /nginx-1.11.10\nRUN ./configure --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --user=nobody --group=nogroup --with-http_ssl_module --with-stream --without-http_rewrite_module --without-http_gzip_module\nRUN make -j 4\nRUN make install\n#   Pin for test reproducibility\nRUN gem install nokogiri --version 1.6.7.2 --no-ri --no-rdoc\nRUN gem install synapse --version 0.14.1 --no-ri --no-rdoc\nRUN gem install synapse-nginx --version 0.2.2 --no-ri --no-rdoc\nCOPY synapse.conf /etc/init/synapse.conf\nCOPY synapse.conf.json /etc/synapse/synapse.conf.json\nCOPY synapse-tools.conf.json /etc/synapse/synapse-tools.conf.json\nCOPY synapse-tools-both.conf.json /etc/synapse/synapse-tools-both.conf.json\nCOPY synapse-tools-nginx.conf.json /etc/synapse/synapse-tools-nginx.conf.json\n#   Zookeeper discovery\nRUN mkdir -p /nail/etc/zookeeper_discovery/infrastructure\nCOPY zookeeper_discovery/infrastructure/local.yaml.trusty /nail/etc/zookeeper_discovery/infrastructure/local.yaml\nCOPY yelpsoa-configs /nail/etc/services\nCOPY habitat /nail/etc/habitat\nCOPY ecosystem /nail/etc/ecosystem\nCOPY region /nail/etc/region\nCOPY itest.py /itest.py\nCOPY run_itest.sh /run_itest.sh\nCOPY rsyslog-configs/49-haproxy.conf /etc/rsyslog.d/49-haproxy.conf\nCOPY maps/ip_to_service.map /var/run/synapse/maps/ip_to_service.map\n#   configure_synapse tries to restart synapse.\n#   make it think it succeeded.\nRUN ln -sf /bin/true /usr/sbin/service\nCMD /bin/bash /run_itest.sh\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ubuntu:14.04\nMAINTAINER John Billings <billings@yelp.com>\n#  Need Python 3.6\nRUN apt-get update > /dev/null \\\n && apt-get install --no-install-recommends software-properties-common -y \\\n && add-apt-repository ppa:deadsnakes/ppa\nRUN apt-get update \\\n && apt-get install libcurl3 iptables python3.6 python-setuptools python-pytest python-pycurl python-kazoo python-zope.interface ruby1.9.1 ruby1.9.1-dev rubygems1.9.1 libxml2 libxml2-dev libxslt-dev libssl-dev build-essential zlib1g-dev -y\n#  Lua 5.3 for scripting with HAProxy\nWORKDIR /\nADD http://www.lua.org/ftp/lua-5.3.1.tar.gz /lua-5.3.1.tar.gz\nRUN tar -axvf /lua-5.3.1.tar.gz\nWORKDIR /lua-5.3.1\nRUN pwd\nRUN make generic\nRUN make install INSTALL_TOP=/usr/bin/lua\n#  Ubuntu trusty nginx and haproxy are ancient, grab newer ones\nWORKDIR /\nADD http://www.haproxy.org/download/1.7/src/haproxy-1.7.8.tar.gz /haproxy.tar.gz\nRUN tar -axvf /haproxy.tar.gz\nWORKDIR /haproxy-1.7.8\nRUN pwd\nRUN make TARGET=linux26 -j 4 USE_LUA=1 LUA_LIB=/usr/bin/lua/lib LUA_INC=/usr/bin/lua/include \\\n && mv haproxy /usr/bin/haproxy-synapse\n#  Nginx\nWORKDIR /\nADD https://nginx.org/download/nginx-1.11.10.tar.gz /nginx.tar.gz\nRUN tar -axvf /nginx.tar.gz\nWORKDIR /nginx-1.11.10\nRUN ./configure --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --user=nobody --group=nogroup --with-http_ssl_module --with-stream --without-http_rewrite_module --without-http_gzip_module\nRUN make -j 4\nRUN make install\n#  Pin for test reproducibility\nRUN gem install nokogiri --version 1.6.7.2 --no-ri --no-rdoc\nRUN gem install synapse --version 0.14.1 --no-ri --no-rdoc\nRUN gem install synapse-nginx --version 0.2.2 --no-ri --no-rdoc\nADD synapse.conf /etc/init/synapse.conf\nADD synapse.conf.json /etc/synapse/synapse.conf.json\nADD synapse-tools.conf.json /etc/synapse/synapse-tools.conf.json\nADD synapse-tools-both.conf.json /etc/synapse/synapse-tools-both.conf.json\nADD synapse-tools-nginx.conf.json /etc/synapse/synapse-tools-nginx.conf.json\n#  Zookeeper discovery\nRUN mkdir -p /nail/etc/zookeeper_discovery/infrastructure\nADD zookeeper_discovery/infrastructure/local.yaml.trusty /nail/etc/zookeeper_discovery/infrastructure/local.yaml\nADD yelpsoa-configs /nail/etc/services\nADD habitat /nail/etc/habitat\nADD ecosystem /nail/etc/ecosystem\nADD region /nail/etc/region\nADD itest.py /itest.py\nADD run_itest.sh /run_itest.sh\nADD rsyslog-configs/49-haproxy.conf /etc/rsyslog.d/49-haproxy.conf\nADD maps/ip_to_service.map /var/run/synapse/maps/ip_to_service.map\n#  configure_synapse tries to restart synapse.\n#  make it think it succeeded.\nRUN ln -sf /bin/true /usr/sbin/service\nCMD /bin/bash /run_itest.sh\n","injectedSmells":[],"originalDockerfileHash":"b2fced4cdf2c54443f966380c1532617","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:14.04\nMAINTAINER John Billings <billings@yelp.com>\n#   Need Python 3.6\nRUN apt-get update > /dev/null \\\n && apt-get install --no-install-recommends software-properties-common -y \\\n && add-apt-repository ppa:deadsnakes/ppa\nRUN apt-get update \\\n && apt-get install libcurl3 iptables python3.6 python-setuptools python-pytest python-pycurl python-kazoo python-zope.interface ruby1.9.1 ruby1.9.1-dev rubygems1.9.1 libxml2 libxml2-dev libxslt-dev libssl-dev build-essential zlib1g-dev -y\n#   Lua 5.3 for scripting with HAProxy\nWORKDIR /\nADD http://www.lua.org/ftp/lua-5.3.1.tar.gz /lua-5.3.1.tar.gz\nRUN tar -axvf /lua-5.3.1.tar.gz\nWORKDIR /lua-5.3.1\nRUN pwd\nRUN make generic\nRUN make install INSTALL_TOP=/usr/bin/lua\n#   Ubuntu trusty nginx and haproxy are ancient, grab newer ones\nWORKDIR /\nADD http://www.haproxy.org/download/1.7/src/haproxy-1.7.8.tar.gz /haproxy.tar.gz\nRUN tar -axvf /haproxy.tar.gz\nWORKDIR /haproxy-1.7.8\nRUN pwd\nRUN make TARGET=linux26 -j 4 USE_LUA=1 LUA_LIB=/usr/bin/lua/lib LUA_INC=/usr/bin/lua/include \\\n && mv haproxy /usr/bin/haproxy-synapse\n#   Nginx\nWORKDIR /\nADD https://nginx.org/download/nginx-1.11.10.tar.gz /nginx.tar.gz\nRUN tar -axvf /nginx.tar.gz\nWORKDIR /nginx-1.11.10\nRUN ./configure --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --user=nobody --group=nogroup --with-http_ssl_module --with-stream --without-http_rewrite_module --without-http_gzip_module\nRUN make -j 4\nRUN make install\n#   Pin for test reproducibility\nRUN gem install nokogiri --version 1.6.7.2 --no-ri --no-rdoc\nRUN gem install synapse --version 0.14.1 --no-ri --no-rdoc\nRUN gem install synapse-nginx --version 0.2.2 --no-ri --no-rdoc\nADD synapse.conf /etc/init/synapse.conf\nADD synapse.conf.json /etc/synapse/synapse.conf.json\nADD synapse-tools.conf.json /etc/synapse/synapse-tools.conf.json\nADD synapse-tools-both.conf.json /etc/synapse/synapse-tools-both.conf.json\nADD synapse-tools-nginx.conf.json /etc/synapse/synapse-tools-nginx.conf.json\n#   Zookeeper discovery\nRUN mkdir -p /nail/etc/zookeeper_discovery/infrastructure\nADD zookeeper_discovery/infrastructure/local.yaml.trusty /nail/etc/zookeeper_discovery/infrastructure/local.yaml\nADD yelpsoa-configs /nail/etc/services\nADD habitat /nail/etc/habitat\nADD ecosystem /nail/etc/ecosystem\nADD region /nail/etc/region\nADD itest.py /itest.py\nADD run_itest.sh /run_itest.sh\nADD rsyslog-configs/49-haproxy.conf /etc/rsyslog.d/49-haproxy.conf\nADD maps/ip_to_service.map /var/run/synapse/maps/ip_to_service.map\n#   configure_synapse tries to restart synapse.\n#   make it think it succeeded.\nRUN ln -sf /bin/true /usr/sbin/service\nCMD /bin/bash /run_itest.sh\n","originalDockerfileUglifiedHash":"c022052b68c0b39c215a4d578d8f55eb","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/8906d6bb0df79889da59a0e99c3185472e4d3d8c.dockerfile"}