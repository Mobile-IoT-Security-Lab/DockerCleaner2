{"seed":795518015,"processedDockerfileHash":"3264bb5cc8d6524f9a07619941e934ec","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM debian:wheezy-backports\nMAINTAINER Gabriele Facciolo <gfacciol@gmail.com>\n#   Following http://git.27o.de/dataserver/about/Installation-Instructions-for-Debian-Wheezy.md\n#   debian packages\nRUN apt-get update \\\n && apt-get install --no-install-recommends apache2 libapache2-mod-php5 mysql-server memcached zendframework php5-cli php5-memcached php5-mysql php5-curl apache2 uwsgi uwsgi-plugin-psgi libplack-perl libdigest-hmac-perl libjson-xs-perl libfile-util-perl libapache2-mod-uwsgi libswitch-perl git gnutls-bin runit wget curl net-tools vim build-essential -y\n#   Zotero\nRUN mkdir -p /srv/zotero/log/upload \\\n && mkdir -p /srv/zotero/log/download \\\n && mkdir -p /srv/zotero/log/error \\\n && mkdir -p /srv/zotero/log/api-errors \\\n && mkdir -p /srv/zotero/log/sync-errors \\\n && mkdir -p /srv/zotero/dataserver \\\n && mkdir -p /srv/zotero/zss \\\n && mkdir -p /var/log/httpd/sync-errors \\\n && mkdir -p /var/log/httpd/api-errors \\\n && chown www-data: /var/log/httpd/sync-errors \\\n && chown www-data: /var/log/httpd/api-errors\n#   Dataserver\nRUN git clone --depth=1 git://git.27o.de/dataserver /srv/zotero/dataserver \\\n && chown www-data:www-data /srv/zotero/dataserver/tmp\n#  RUN cd /srv/zotero/dataserver/include && rm -r Zend && ln -s /usr/share/php/libzend-framework-php/Zend\nRUN cd /srv/zotero/dataserver/include \\\n && rm -r Zend \\\n && ln -s /usr/share/php/Zend\n#  Apache2\n#  certtool -p --sec-param high --outfile /etc/apache2/zotero.key\n#  certtool -s --load-privkey /etc/apache2/zotero.key --outfile /etc/apache2/zotero.cert\nCOPY apache/zotero.key /etc/apache2/\nCOPY apache/zotero.cert /etc/apache2/\nCOPY apache/sites-zotero.conf /etc/apache2/sites-available/zotero\nCOPY apache/dot.htaccess /srv/zotero/dataserver/htdocs/\\.htaccess\nRUN a2enmod ssl \\\n && a2enmod rewrite \\\n && a2ensite zotero\n#  Mysql\nCOPY mysql/zotero.cnf /etc/mysql/conf.d/zotero.cnf\nCOPY mysql/setup_db /srv/zotero/dataserver/misc/setup_db\nRUN /etc/init.d/mysql start \\\n && mysqladmin -u root password password \\\n && cd /srv/zotero/dataserver/misc/ \\\n && ./setup_db\n#   Zotero Configuration\nCOPY dataserver/dbconnect.inc.php dataserver/config.inc.php /srv/zotero/dataserver/include/config/\nCOPY dataserver/sv/zotero-download /etc/sv/zotero-download\nCOPY dataserver/sv/zotero-upload /etc/sv/zotero-upload\nCOPY dataserver/sv/zotero-error /etc/sv/zotero-error\nRUN cd /etc/service \\\n && ln -s ../sv/zotero-download /etc/service/ \\\n && ln -s ../sv/zotero-upload /etc/service/ \\\n && ln -s ../sv/zotero-error /etc/service/\n#   ZSS\nRUN git clone --depth=1 git://git.27o.de/zss /srv/zotero/zss \\\n && mkdir /srv/zotero/storage \\\n && chown www-data:www-data /srv/zotero/storage\nCOPY zss/zss.yaml /etc/uwsgi/apps-available/\nCOPY zss/ZSS.pm /srv/zotero/zss/\nCOPY zss/zss.psgi /srv/zotero/zss/\nRUN ln -s /etc/uwsgi/apps-available/zss.yaml /etc/uwsgi/apps-enabled\n#   fix uwsgi init scipt (always fails)\nCOPY patches/uwsgi /etc/init.d/uwsgi\n#  # failed attempt to install Zotero Web-Library locally\n#  # not working\n#  RUN cd /srv/ && \\\n#      git clone --depth=1 --recursive https://github.com/zotero/web-library.git && \\\n#      curl -sL https://deb.nodesource.com/setup_4.x | bash - && apt-get install -y nodejs && \\\n#      cd /srv/web-library && \\\n#      npm install && \\\n#      npm install prompt\n#   replace custom /srv/zotero/dataserver/admin/add_user that allows to write the password\nCOPY patches/add_user /srv/zotero/dataserver/admin/add_user\n#   TEST ADD USER: test PASSWORD: test\nRUN service mysql start \\\n && service memcached start \\\n && cd /srv/zotero/dataserver/admin \\\n && ./add_user 101 test test \\\n && ./add_user 102 test2 test2 \\\n && ./add_group -o test -f members -r members -e members testgroup \\\n && ./add_groupuser testgroup test2 member\n#   docker server startup\nEXPOSE 80/tcp 443/tcp\nCMD service mysql start \\\n && service uwsgi start \\\n && service apache2 start \\\n && service memcached start \\\n && bash -c \"/usr/sbin/runsvdir-start&\" \\\n && /bin/bash\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM debian:wheezy-backports\nMAINTAINER Gabriele Facciolo <gfacciol@gmail.com>\n#  Following http://git.27o.de/dataserver/about/Installation-Instructions-for-Debian-Wheezy.md\n#  debian packages\nRUN apt-get update \\\n && apt-get install apache2 libapache2-mod-php5 mysql-server memcached zendframework php5-cli php5-memcached php5-mysql php5-curl apache2 uwsgi uwsgi-plugin-psgi libplack-perl libdigest-hmac-perl libjson-xs-perl libfile-util-perl libapache2-mod-uwsgi libswitch-perl git gnutls-bin runit wget curl net-tools vim build-essential -y\n#  Zotero\nRUN mkdir -p /srv/zotero/log/upload \\\n && mkdir -p /srv/zotero/log/download \\\n && mkdir -p /srv/zotero/log/error \\\n && mkdir -p /srv/zotero/log/api-errors \\\n && mkdir -p /srv/zotero/log/sync-errors \\\n && mkdir -p /srv/zotero/dataserver \\\n && mkdir -p /srv/zotero/zss \\\n && mkdir -p /var/log/httpd/sync-errors \\\n && mkdir -p /var/log/httpd/api-errors \\\n && chown www-data: /var/log/httpd/sync-errors \\\n && chown www-data: /var/log/httpd/api-errors\n#  Dataserver\nRUN git clone --depth=1 git://git.27o.de/dataserver /srv/zotero/dataserver \\\n && chown www-data:www-data /srv/zotero/dataserver/tmp\n# RUN cd /srv/zotero/dataserver/include && rm -r Zend && ln -s /usr/share/php/libzend-framework-php/Zend\nRUN cd /srv/zotero/dataserver/include \\\n && rm -r Zend \\\n && ln -s /usr/share/php/Zend\n# Apache2\n# certtool -p --sec-param high --outfile /etc/apache2/zotero.key\n# certtool -s --load-privkey /etc/apache2/zotero.key --outfile /etc/apache2/zotero.cert\nADD apache/zotero.key /etc/apache2/\nADD apache/zotero.cert /etc/apache2/\nADD apache/sites-zotero.conf /etc/apache2/sites-available/zotero\nADD apache/dot.htaccess /srv/zotero/dataserver/htdocs/\\.htaccess\nRUN a2enmod ssl \\\n && a2enmod rewrite \\\n && a2ensite zotero\n# Mysql\nADD mysql/zotero.cnf /etc/mysql/conf.d/zotero.cnf\nADD mysql/setup_db /srv/zotero/dataserver/misc/setup_db\nRUN /etc/init.d/mysql start \\\n && mysqladmin -u root password password \\\n && cd /srv/zotero/dataserver/misc/ \\\n && ./setup_db\n#  Zotero Configuration\nADD dataserver/dbconnect.inc.php dataserver/config.inc.php /srv/zotero/dataserver/include/config/\nADD dataserver/sv/zotero-download /etc/sv/zotero-download\nADD dataserver/sv/zotero-upload /etc/sv/zotero-upload\nADD dataserver/sv/zotero-error /etc/sv/zotero-error\nRUN cd /etc/service \\\n && ln -s ../sv/zotero-download /etc/service/ \\\n && ln -s ../sv/zotero-upload /etc/service/ \\\n && ln -s ../sv/zotero-error /etc/service/\n#  ZSS\nRUN git clone --depth=1 git://git.27o.de/zss /srv/zotero/zss \\\n && mkdir /srv/zotero/storage \\\n && chown www-data:www-data /srv/zotero/storage\nADD zss/zss.yaml /etc/uwsgi/apps-available/\nADD zss/ZSS.pm /srv/zotero/zss/\nADD zss/zss.psgi /srv/zotero/zss/\nRUN ln -s /etc/uwsgi/apps-available/zss.yaml /etc/uwsgi/apps-enabled\n#  fix uwsgi init scipt (always fails)\nADD patches/uwsgi /etc/init.d/uwsgi\n# # failed attempt to install Zotero Web-Library locally\n# # not working\n# RUN cd /srv/ && \\\n#     git clone --depth=1 --recursive https://github.com/zotero/web-library.git && \\\n#     curl -sL https://deb.nodesource.com/setup_4.x | bash - && apt-get install -y nodejs && \\\n#     cd /srv/web-library && \\\n#     npm install && \\\n#     npm install prompt\n#  replace custom /srv/zotero/dataserver/admin/add_user that allows to write the password\nADD patches/add_user /srv/zotero/dataserver/admin/add_user\n#  TEST ADD USER: test PASSWORD: test\nRUN service mysql start \\\n && service memcached start \\\n && cd /srv/zotero/dataserver/admin \\\n && ./add_user 101 test test \\\n && ./add_user 102 test2 test2 \\\n && ./add_group -o test -f members -r members -e members testgroup \\\n && ./add_groupuser testgroup test2 member\n#  docker server startup\nEXPOSE 80/tcp 443/tcp\nCMD service mysql start \\\n && service uwsgi start \\\n && service apache2 start \\\n && service memcached start \\\n && bash -c \"/usr/sbin/runsvdir-start&\" \\\n && /bin/bash\n","injectedSmells":[],"originalDockerfileHash":"1d4e8f957ab5065f6bc3d94d2f6aa43f","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM debian:wheezy-backports\nMAINTAINER Gabriele Facciolo <gfacciol@gmail.com>\n#   Following http://git.27o.de/dataserver/about/Installation-Instructions-for-Debian-Wheezy.md\n#   debian packages\nRUN apt-get update \\\n && apt-get install apache2 libapache2-mod-php5 mysql-server memcached zendframework php5-cli php5-memcached php5-mysql php5-curl apache2 uwsgi uwsgi-plugin-psgi libplack-perl libdigest-hmac-perl libjson-xs-perl libfile-util-perl libapache2-mod-uwsgi libswitch-perl git gnutls-bin runit wget curl net-tools vim build-essential -y\n#   Zotero\nRUN mkdir -p /srv/zotero/log/upload \\\n && mkdir -p /srv/zotero/log/download \\\n && mkdir -p /srv/zotero/log/error \\\n && mkdir -p /srv/zotero/log/api-errors \\\n && mkdir -p /srv/zotero/log/sync-errors \\\n && mkdir -p /srv/zotero/dataserver \\\n && mkdir -p /srv/zotero/zss \\\n && mkdir -p /var/log/httpd/sync-errors \\\n && mkdir -p /var/log/httpd/api-errors \\\n && chown www-data: /var/log/httpd/sync-errors \\\n && chown www-data: /var/log/httpd/api-errors\n#   Dataserver\nRUN git clone --depth=1 git://git.27o.de/dataserver /srv/zotero/dataserver \\\n && chown www-data:www-data /srv/zotero/dataserver/tmp\n#  RUN cd /srv/zotero/dataserver/include && rm -r Zend && ln -s /usr/share/php/libzend-framework-php/Zend\nRUN cd /srv/zotero/dataserver/include \\\n && rm -r Zend \\\n && ln -s /usr/share/php/Zend\n#  Apache2\n#  certtool -p --sec-param high --outfile /etc/apache2/zotero.key\n#  certtool -s --load-privkey /etc/apache2/zotero.key --outfile /etc/apache2/zotero.cert\nADD apache/zotero.key /etc/apache2/\nADD apache/zotero.cert /etc/apache2/\nADD apache/sites-zotero.conf /etc/apache2/sites-available/zotero\nADD apache/dot.htaccess /srv/zotero/dataserver/htdocs/\\.htaccess\nRUN a2enmod ssl \\\n && a2enmod rewrite \\\n && a2ensite zotero\n#  Mysql\nADD mysql/zotero.cnf /etc/mysql/conf.d/zotero.cnf\nADD mysql/setup_db /srv/zotero/dataserver/misc/setup_db\nRUN /etc/init.d/mysql start \\\n && mysqladmin -u root password password \\\n && cd /srv/zotero/dataserver/misc/ \\\n && ./setup_db\n#   Zotero Configuration\nADD dataserver/dbconnect.inc.php dataserver/config.inc.php /srv/zotero/dataserver/include/config/\nADD dataserver/sv/zotero-download /etc/sv/zotero-download\nADD dataserver/sv/zotero-upload /etc/sv/zotero-upload\nADD dataserver/sv/zotero-error /etc/sv/zotero-error\nRUN cd /etc/service \\\n && ln -s ../sv/zotero-download /etc/service/ \\\n && ln -s ../sv/zotero-upload /etc/service/ \\\n && ln -s ../sv/zotero-error /etc/service/\n#   ZSS\nRUN git clone --depth=1 git://git.27o.de/zss /srv/zotero/zss \\\n && mkdir /srv/zotero/storage \\\n && chown www-data:www-data /srv/zotero/storage\nADD zss/zss.yaml /etc/uwsgi/apps-available/\nADD zss/ZSS.pm /srv/zotero/zss/\nADD zss/zss.psgi /srv/zotero/zss/\nRUN ln -s /etc/uwsgi/apps-available/zss.yaml /etc/uwsgi/apps-enabled\n#   fix uwsgi init scipt (always fails)\nADD patches/uwsgi /etc/init.d/uwsgi\n#  # failed attempt to install Zotero Web-Library locally\n#  # not working\n#  RUN cd /srv/ && \\\n#      git clone --depth=1 --recursive https://github.com/zotero/web-library.git && \\\n#      curl -sL https://deb.nodesource.com/setup_4.x | bash - && apt-get install -y nodejs && \\\n#      cd /srv/web-library && \\\n#      npm install && \\\n#      npm install prompt\n#   replace custom /srv/zotero/dataserver/admin/add_user that allows to write the password\nADD patches/add_user /srv/zotero/dataserver/admin/add_user\n#   TEST ADD USER: test PASSWORD: test\nRUN service mysql start \\\n && service memcached start \\\n && cd /srv/zotero/dataserver/admin \\\n && ./add_user 101 test test \\\n && ./add_user 102 test2 test2 \\\n && ./add_group -o test -f members -r members -e members testgroup \\\n && ./add_groupuser testgroup test2 member\n#   docker server startup\nEXPOSE 80/tcp 443/tcp\nCMD service mysql start \\\n && service uwsgi start \\\n && service apache2 start \\\n && service memcached start \\\n && bash -c \"/usr/sbin/runsvdir-start&\" \\\n && /bin/bash\n","originalDockerfileUglifiedHash":"ef81599731144688a8438ae605099b0d","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/6cf6f371b7b8d23a621988a9ae676b8b289d944c.dockerfile"}