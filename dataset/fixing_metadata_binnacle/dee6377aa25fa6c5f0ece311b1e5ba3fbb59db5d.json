{"seed":4095449928,"processedDockerfileHash":"51ae6fe88e1816d679b54ef1570f4d62","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apt-get","have-a-healthcheck","have-a-user"],"processedDockerfile":"#\n#   Docker file for running Diladele Web Safety in one container\n#\nFROM phusion/baseimage:0.11\nMAINTAINER support@diladele.com\n#   set configuration variables\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV TERM=\"xterm\"\nENV DDWS_VER=\"7.0.0.7A5E\"\n#   install python libs and apache with modwsgi\nRUN apt-get update \\\n && apt-get install --no-install-recommends apt-utils apache2 libapache2-mod-wsgi-py3 python3-pip python3-dev python3-setuptools sudo curl gnupg sqlite htop mc libsasl2-dev libldap2-dev libssl-dev g++ krb5-user sqlite -y \\\n && a2dissite 000-default \\\n && curl http://packages.diladele.com/diladele_pub.asc -o diladele_pub.asc \\\n && apt-key add diladele_pub.asc \\\n && rm diladele_pub.asc \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\nRUN pip3 install wheel\nRUN pip3 install django==2.1.2 pytz requests pandas PyYAML pyOpenSSL\nRUN pip3 uninstall ldap ldap3 python-ldap || true\nRUN pip3 install python-ldap reportlab==3.4.0\nRUN echo \"deb http://squid46.diladele.com/ubuntu/ bionic main\" > /etc/apt/sources.list.d/squid46.diladele.com.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends libecap3 libecap3-dev squid-common squid squidclient -y \\\n && rm -rf /var/run/squid.pid \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\n#   get latest web safety and install it\nRUN curl http://packages.diladele.com/websafety/${DDWS_VER}/amd64/release/ubuntu18/websafety-${DDWS_VER}_amd64.deb -o websafety-${DDWS_VER}_amd64.deb \\\n && dpkg --install websafety-${DDWS_VER}_amd64.deb \\\n && rm -f websafety-${DDWS_VER}_amd64.deb \\\n && a2ensite websafety \\\n && mkdir -p /var/run/apache2 \\\n && mkdir -p /var/log/websafety \\\n && sudo -u websafety python3 /opt/websafety/var/console/generate.py\n#   too many hardlinks in phusion-basimage for crontab\nRUN touch /etc/crontab\n#   make runit service directories\nRUN mkdir /etc/service/squid /etc/service/apache2 /etc/service/wsicap /etc/service/wsmgr /etc/service/wsgsb /etc/service/wsytg /opt/websafety/var/reports\n#   copy required files\nCOPY contents/squid.conf /etc/squid/squid.conf\nCOPY contents/websafety_update /etc/cron.daily\nCOPY contents/wsicap /etc/service/wsicap/run\nCOPY contents/wsmgr /etc/service/wsmgr/run\nCOPY contents/wsgsb /etc/service/wsgsb/run\nCOPY contents/wsytg /etc/service/wsytg/run\nCOPY contents/squid /etc/service/squid/run\nCOPY contents/apache2 /etc/service/apache2/run\nCOPY contents/reload.sh /opt/websafety/bin/reload.sh\nCOPY contents/restart.sh /opt/websafety/bin/restart.sh\nCOPY contents/license.pem /opt/websafety/etc/license.pem\nCOPY contents/firstrun.sh /usr/local/bin/firstrun.sh\n#   reset owner of installation path\nRUN chown -R websafety:websafety /opt/websafety \\\n && chmod +x /opt/websafety/bin/* \\\n && chmod +x /usr/local/bin/firstrun.sh \\\n && chmod +x /etc/cron.daily/websafety_update \\\n && chmod u+s /opt/websafety/bin/* \\\n && chmod 755 /opt/websafety/bin/certmgr.py \\\n && chmod 755 /opt/websafety/bin/report \\\n && chmod +x /etc/service/squid/run /etc/service/wsmgr/run /etc/service/wsicap/run /etc/service/wsgsb/run /etc/service/wsytg/run /etc/service/apache2/run\n#   assign volumes\nVOLUME [\"/opt/websafety/etc\"]\nVOLUME [\"/opt/websafety/var/spool\"]\nVOLUME [\"/opt/websafety/var/console\"]\nVOLUME [\"/opt/websafety/var/db\"]\nVOLUME [\"/opt/websafety/var/log\"]\nVOLUME [\"/opt/websafety/var/reports\"]\nVOLUME [\"/etc/squid\"]\nVOLUME [\"/var/spool\"]\nVOLUME [\"/var/log/squid\"]\nCMD [\"/sbin/my_init\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#\n#  Docker file for running Diladele Web Safety in one container\n#\nFROM phusion/baseimage:0.11\nMAINTAINER support@diladele.com\n#  set configuration variables\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV TERM=\"xterm\"\nENV DDWS_VER=\"7.0.0.7A5E\"\n#  install python libs and apache with modwsgi\nRUN apt-get update \\\n && apt-get install --no-install-recommends apt-utils apache2 libapache2-mod-wsgi-py3 python3-pip python3-dev python3-setuptools sudo curl gnupg sqlite htop mc libsasl2-dev libldap2-dev libssl-dev g++ krb5-user sqlite -y \\\n && a2dissite 000-default \\\n && curl http://packages.diladele.com/diladele_pub.asc -o diladele_pub.asc \\\n && apt-key add diladele_pub.asc \\\n && rm diladele_pub.asc \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\nRUN pip3 install wheel\nRUN pip3 install django==2.1.2 pytz requests pandas PyYAML pyOpenSSL\nRUN pip3 uninstall ldap ldap3 python-ldap || true\nRUN pip3 install python-ldap reportlab==3.4.0\nRUN echo \"deb http://squid46.diladele.com/ubuntu/ bionic main\" > /etc/apt/sources.list.d/squid46.diladele.com.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends libecap3 libecap3-dev squid-common squid squidclient -y \\\n && rm -rf /var/run/squid.pid \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\n#  get latest web safety and install it\nRUN curl http://packages.diladele.com/websafety/${DDWS_VER}/amd64/release/ubuntu18/websafety-${DDWS_VER}_amd64.deb -o websafety-${DDWS_VER}_amd64.deb \\\n && dpkg --install websafety-${DDWS_VER}_amd64.deb \\\n && rm -f websafety-${DDWS_VER}_amd64.deb \\\n && a2ensite websafety \\\n && mkdir -p /var/run/apache2 \\\n && mkdir -p /var/log/websafety \\\n && sudo -u websafety python3 /opt/websafety/var/console/generate.py\n#  too many hardlinks in phusion-basimage for crontab\nRUN touch /etc/crontab\n#  make runit service directories\nRUN mkdir /etc/service/squid /etc/service/apache2 /etc/service/wsicap /etc/service/wsmgr /etc/service/wsgsb /etc/service/wsytg /opt/websafety/var/reports\n#  copy required files\nCOPY contents/squid.conf /etc/squid/squid.conf\nCOPY contents/websafety_update /etc/cron.daily\nCOPY contents/wsicap /etc/service/wsicap/run\nCOPY contents/wsmgr /etc/service/wsmgr/run\nCOPY contents/wsgsb /etc/service/wsgsb/run\nCOPY contents/wsytg /etc/service/wsytg/run\nCOPY contents/squid /etc/service/squid/run\nCOPY contents/apache2 /etc/service/apache2/run\nCOPY contents/reload.sh /opt/websafety/bin/reload.sh\nCOPY contents/restart.sh /opt/websafety/bin/restart.sh\nCOPY contents/license.pem /opt/websafety/etc/license.pem\nCOPY contents/firstrun.sh /usr/local/bin/firstrun.sh\n#  reset owner of installation path\nRUN chown -R websafety:websafety /opt/websafety \\\n && chmod +x /opt/websafety/bin/* \\\n && chmod +x /usr/local/bin/firstrun.sh \\\n && chmod +x /etc/cron.daily/websafety_update \\\n && chmod u+s /opt/websafety/bin/* \\\n && chmod 755 /opt/websafety/bin/certmgr.py \\\n && chmod 755 /opt/websafety/bin/report \\\n && chmod +x /etc/service/squid/run /etc/service/wsmgr/run /etc/service/wsicap/run /etc/service/wsgsb/run /etc/service/wsytg/run /etc/service/apache2/run\n#  assign volumes\nVOLUME [\"/opt/websafety/etc\"]\nVOLUME [\"/opt/websafety/var/spool\"]\nVOLUME [\"/opt/websafety/var/console\"]\nVOLUME [\"/opt/websafety/var/db\"]\nVOLUME [\"/opt/websafety/var/log\"]\nVOLUME [\"/opt/websafety/var/reports\"]\nVOLUME [\"/etc/squid\"]\nVOLUME [\"/var/spool\"]\nVOLUME [\"/var/log/squid\"]\nCMD [\"/sbin/my_init\"]\n","injectedSmells":[],"originalDockerfileHash":"4b8a7041d8f7bbc7c3791bf2f41b9b48","successfullyInjectedSmells":[],"originalDockerfileUglified":"#\n#   Docker file for running Diladele Web Safety in one container\n#\nFROM phusion/baseimage:0.11\nMAINTAINER support@diladele.com\n#   set configuration variables\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV TERM=\"xterm\"\nENV DDWS_VER=\"7.0.0.7A5E\"\n#   install python libs and apache with modwsgi\nRUN apt-get update \\\n && apt-get install --no-install-recommends apt-utils apache2 libapache2-mod-wsgi-py3 python3-pip python3-dev python3-setuptools sudo curl gnupg sqlite htop mc libsasl2-dev libldap2-dev libssl-dev g++ krb5-user sqlite -y \\\n && a2dissite 000-default \\\n && curl http://packages.diladele.com/diladele_pub.asc -o diladele_pub.asc \\\n && apt-key add diladele_pub.asc \\\n && rm diladele_pub.asc \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\nRUN pip3 install wheel\nRUN pip3 install django==2.1.2 pytz requests pandas PyYAML pyOpenSSL\nRUN pip3 uninstall ldap ldap3 python-ldap || true\nRUN pip3 install python-ldap reportlab==3.4.0\nRUN echo \"deb http://squid46.diladele.com/ubuntu/ bionic main\" > /etc/apt/sources.list.d/squid46.diladele.com.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends libecap3 libecap3-dev squid-common squid squidclient -y \\\n && rm -rf /var/run/squid.pid \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\n#   get latest web safety and install it\nRUN curl http://packages.diladele.com/websafety/${DDWS_VER}/amd64/release/ubuntu18/websafety-${DDWS_VER}_amd64.deb -o websafety-${DDWS_VER}_amd64.deb \\\n && dpkg --install websafety-${DDWS_VER}_amd64.deb \\\n && rm -f websafety-${DDWS_VER}_amd64.deb \\\n && a2ensite websafety \\\n && mkdir -p /var/run/apache2 \\\n && mkdir -p /var/log/websafety \\\n && sudo -u websafety python3 /opt/websafety/var/console/generate.py\n#   too many hardlinks in phusion-basimage for crontab\nRUN touch /etc/crontab\n#   make runit service directories\nRUN mkdir /etc/service/squid /etc/service/apache2 /etc/service/wsicap /etc/service/wsmgr /etc/service/wsgsb /etc/service/wsytg /opt/websafety/var/reports\n#   copy required files\nCOPY contents/squid.conf /etc/squid/squid.conf\nCOPY contents/websafety_update /etc/cron.daily\nCOPY contents/wsicap /etc/service/wsicap/run\nCOPY contents/wsmgr /etc/service/wsmgr/run\nCOPY contents/wsgsb /etc/service/wsgsb/run\nCOPY contents/wsytg /etc/service/wsytg/run\nCOPY contents/squid /etc/service/squid/run\nCOPY contents/apache2 /etc/service/apache2/run\nCOPY contents/reload.sh /opt/websafety/bin/reload.sh\nCOPY contents/restart.sh /opt/websafety/bin/restart.sh\nCOPY contents/license.pem /opt/websafety/etc/license.pem\nCOPY contents/firstrun.sh /usr/local/bin/firstrun.sh\n#   reset owner of installation path\nRUN chown -R websafety:websafety /opt/websafety \\\n && chmod +x /opt/websafety/bin/* \\\n && chmod +x /usr/local/bin/firstrun.sh \\\n && chmod +x /etc/cron.daily/websafety_update \\\n && chmod u+s /opt/websafety/bin/* \\\n && chmod 755 /opt/websafety/bin/certmgr.py \\\n && chmod 755 /opt/websafety/bin/report \\\n && chmod +x /etc/service/squid/run /etc/service/wsmgr/run /etc/service/wsicap/run /etc/service/wsgsb/run /etc/service/wsytg/run /etc/service/apache2/run\n#   assign volumes\nVOLUME [\"/opt/websafety/etc\"]\nVOLUME [\"/opt/websafety/var/spool\"]\nVOLUME [\"/opt/websafety/var/console\"]\nVOLUME [\"/opt/websafety/var/db\"]\nVOLUME [\"/opt/websafety/var/log\"]\nVOLUME [\"/opt/websafety/var/reports\"]\nVOLUME [\"/etc/squid\"]\nVOLUME [\"/var/spool\"]\nVOLUME [\"/var/log/squid\"]\nCMD [\"/sbin/my_init\"]\n","originalDockerfileUglifiedHash":"6a768dee72bfa920bd0c9ed87ba68385","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/dee6377aa25fa6c5f0ece311b1e5ba3fbb59db5d.dockerfile"}