{"seed":3159334278,"processedDockerfileHash":"e70332179c7f3b70ebeffe83bedd38e9","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-npm","have-a-healthcheck","have-a-user"],"processedDockerfile":"ARG NODE_VERSION=${NODE_VERSION}\nFROM phusion/baseimage:latest\n#   Set Environment Variables\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV LANGUAGE=\"en_US.UTF-8\"\nENV LC_ALL=\"en_US.UTF-8\"\nENV LC_CTYPE=\"en_US.UTF-8\"\nENV LANG=\"en_US.UTF-8\"\nENV TERM=\"xterm\"\n#   Start as root\nUSER root\n#  ##########################################################################\n#   Bootstrapping the image:\n#  ##########################################################################\nRUN locale-gen en_US.UTF-8\nRUN (apt-get update ;apt-get install --no-install-recommends software-properties-common=0.99.35 -y )\nRUN apt-get update \\\n && (apt-get update ;apt-get install --no-install-recommends build-essential=12.9ubuntu3 pkg-config=1.8.1-1ubuntu2 libcurl4-openssl-dev=7.88.1-7ubuntu1 libedit-dev=3.1-20221030-2 libssl-dev=3.0.8-1ubuntu1 libxml2-dev=2.9.14+dfsg-1.1build2 xz-utils=5.4.1-0.2 libsqlite3-dev=3.40.1-1 sqlite3=3.40.1-1 git=1:2.39.2-1ubuntu1 curl=7.88.1-7ubuntu1 vim=2:9.0.1000-4ubuntu2 nano=7.2-1 postgresql-client=15+248 -y --allow-downgrades --allow-remove-essential --allow-change-held-packages ) \\\n && apt-get clean\n#   Source the bash\nRUN . ~/.bashrc\n#  ##########################################################################\n#   Nodedock non-root user:\n#  ##########################################################################\n#   Add a non-root user to prevent files being created with root permissions on host machine.\nARG PUID=1000\nENV PUID=\"${PUID}\"\nARG PGID=1000\nENV PGID=\"${PGID}\"\n#   always run apt update when start and after add new source list, then clean up at end.\nRUN : \\\n && groupadd -g ${PGID} nodedock \\\n && useradd -u ${PUID} -g nodedock -m nodedock -G docker_env \\\n && usermod -p \"*\" nodedock\n#  ##########################################################################\n#   Set Timezone\n#  ##########################################################################\nARG TZ=UTC\nENV TZ=\"${TZ}\"\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime \\\n && echo $TZ > /etc/timezone\n#  ##########################################################################\n#   User Aliases\n#  ##########################################################################\nUSER root\nCOPY ./aliases.sh /root/aliases.sh\nCOPY ./aliases.sh /home/nodedock/aliases.sh\nRUN sed -i 's/\\r//' /root/aliases.sh \\\n && sed -i 's/\\r//' /home/nodedock/aliases.sh \\\n && chown nodedock:nodedock /home/nodedock/aliases.sh \\\n && echo \"\" >> ~/.bashrc \\\n && echo \"# Load Custom Aliases\" >> ~/.bashrc \\\n && echo \"source ~/aliases.sh\" >> ~/.bashrc \\\n && echo \"\" >> ~/.bashrc\nUSER nodedock\nRUN echo \"\" >> ~/.bashrc \\\n && echo \"# Load Custom Aliases\" >> ~/.bashrc \\\n && echo \"source ~/aliases.sh\" >> ~/.bashrc \\\n && echo \"\" >> ~/.bashrc\n#  ##########################################################################\n#   Crontab\n#  ##########################################################################\nUSER root\nCOPY ./crontab /etc/cron.d\nRUN chmod -R 644 /etc/cron.d\n#  ##########################################################################\n#   ssh:\n#  ##########################################################################\nARG INSTALL_WORKSPACE_SSH=false\nCOPY insecure_id_rsa /tmp/id_rsa\nCOPY insecure_id_rsa.pub /tmp/id_rsa.pub\nRUN if [ ${INSTALL_WORKSPACE_SSH} = true ] ; then rm -f /etc/service/sshd/down \\\n && cat /tmp/id_rsa.pub >> /root/.ssh/authorized_keys \\\n && cat /tmp/id_rsa.pub >> /root/.ssh/id_rsa.pub \\\n && cat /tmp/id_rsa >> /root/.ssh/id_rsa \\\n && rm -f /tmp/id_rsa* \\\n && chmod 644 /root/.ssh/authorized_keys /root/.ssh/id_rsa.pub \\\n && chmod 400 /root/.ssh/id_rsa \\\n && cp -rf /root/.ssh /home/nodedock \\\n && chown -R nodedock:nodedock /home/nodedock/.ssh ; fi\n#  ##########################################################################\n#   Libpng16 EXTENSION\n#  ##########################################################################\nARG INSTALL_LIBPNG=false\nRUN if [ ${INSTALL_LIBPNG} = true ] ; then apt update \\\n && (apt-get update ;apt-get install --no-install-recommends libpng16-16=1.6.39-2 ) ; fi\n#  ##########################################################################\n#   Node / NVM:\n#  ##########################################################################\nUSER nodedock\n#   Check if NVM needs to be installed\nARG NODE_VERSION=node\nENV NODE_VERSION=\"${NODE_VERSION}\"\nARG NODE_ENV=development\nENV NODE_ENV=\"${NODE_ENV}\"\nARG INSTALL_NODE=false\nARG INSTALL_NPM_GULP=false\nARG INSTALL_NPM_BOWER=false\nARG INSTALL_NPM_VUE_CLI=false\nARG INSTALL_NPM_ANGULAR_CLI=false\nARG NPM_REGISTRY\nENV NPM_REGISTRY=\"${NPM_REGISTRY}\"\nENV NVM_DIR=\"/home/nodedock/.nvm\"\nRUN if [ ${INSTALL_NODE} = true ] ; then curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash \\\n && . $NVM_DIR/nvm.sh \\\n && nvm install ${NODE_VERSION} \\\n && nvm use ${NODE_VERSION} \\\n && nvm alias ${NODE_VERSION} \\\n && if [ ${NPM_REGISTRY} ] ; then npm config set registry ${NPM_REGISTRY} ; fi \\\n && if [ ${INSTALL_NPM_GULP} = true ] ; then npm install gulp@4.0.2 -g ; fi \\\n && if [ ${INSTALL_NPM_BOWER} = true ] ; then npm install bower@1.8.14 -g ; fi \\\n && if [ ${INSTALL_NPM_VUE_CLI} = true ] ; then npm install @vue/cli -g ; fi \\\n && if [ ${INSTALL_NPM_ANGULAR_CLI} = true ] ; then npm install @angular/cli -g ; fi ; fi\n#   Wouldn't execute when added to the RUN statement in the above block\n#   Source NVM when loading bash since ~/.profile isn't loaded on non-login shell\nRUN if [ ${INSTALL_NODE} = true ] ; then echo \"\" >> ~/.bashrc \\\n && echo 'export NVM_DIR=\"$HOME/.nvm\"' >> ~/.bashrc \\\n && echo '[ -s \"$NVM_DIR/nvm.sh\" ] \\\n && . \"$NVM_DIR/nvm.sh\" # This loads nvm' >> ~/.bashrc; fi\n#   Add NVM binaries to root's .bashrc\nUSER root\nRUN if [ ${INSTALL_NODE} = true ] ; then echo \"\" >> ~/.bashrc \\\n && echo 'export NVM_DIR=\"/home/nodedock/.nvm\"' >> ~/.bashrc \\\n && echo '[ -s \"$NVM_DIR/nvm.sh\" ] \\\n && . \"$NVM_DIR/nvm.sh\" # This loads nvm' >> ~/.bashrc; fi\n#   Add PATH for node\nENV PATH=\"$PATH:$NVM_DIR/versions/node/v${NODE_VERSION}/bin\"\nRUN if [ ${NPM_REGISTRY} ] ; then . ~/.bashrc \\\n && npm config set registry ${NPM_REGISTRY} ; fi\n#  ##########################################################################\n#   YARN:\n#  ##########################################################################\nUSER nodedock\nARG INSTALL_YARN=false\nARG YARN_VERSION=latest\nENV YARN_VERSION=\"${YARN_VERSION}\"\nRUN if [ ${INSTALL_YARN} = true ] ; then [ -s \"$NVM_DIR/nvm.sh\" ] \\\n && . \"$NVM_DIR/nvm.sh\" \\\n && if [ ${YARN_VERSION} = \"latest\" ] ; then curl -o- -L https://yarnpkg.com/install.sh | bash ; else curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version ${YARN_VERSION} ; fi \\\n && echo \"\" >> ~/.bashrc \\\n && echo 'export PATH=\"$HOME/.yarn/bin:$PATH\"' >> ~/.bashrc; fi\n#   Add YARN binaries to root's .bashrc\nUSER root\nRUN if [ ${INSTALL_YARN} = true ] ; then echo \"\" >> ~/.bashrc \\\n && echo 'export YARN_DIR=\"/home/nodedock/.yarn\"' >> ~/.bashrc \\\n && echo 'export PATH=\"$YARN_DIR/bin:$PATH\"' >> ~/.bashrc; fi\n#  ##########################################################################\n#   Image optimizers:\n#  ##########################################################################\nUSER root\nARG INSTALL_IMAGE_OPTIMIZERS=false\nRUN if [ ${INSTALL_IMAGE_OPTIMIZERS} = true ] ; then (apt-get update ;apt-get install --no-install-recommends jpegoptim=1.4.7-1 optipng=0.7.7-2build1 pngquant=2.17.0-1 gifsicle=1.93-2 -y ) \\\n && if [ ${INSTALL_NODE} = true ] ; then exec bash \\\n && . ~/.bashrc \\\n && npm install svgo@3.0.2 -g ; fi ; fi\nUSER nodedock\n#  ##########################################################################\n#   PYTHON:\n#  ##########################################################################\nUSER root\nARG INSTALL_PYTHON=false\nRUN if [ ${INSTALL_PYTHON} = true ] ; then (apt-get update ;apt-get install --no-install-recommends python python-pip python-dev build-essential=12.9ubuntu3 -y ) \\\n && python -m pip install --upgrade pip \\\n && python -m pip install --upgrade virtualenv ; fi\n#  ##########################################################################\n#   ImageMagick:\n#  ##########################################################################\nUSER root\nARG INSTALL_IMAGEMAGICK=false\nRUN if [ ${INSTALL_IMAGEMAGICK} = true ] ; then (apt-get update ;apt-get install --no-install-recommends imagemagick=8:6.9.11.60+dfsg-1.6 -y ) ; fi\n#  ##########################################################################\n#   pgsql client\n#  ##########################################################################\nUSER root\nARG INSTALL_PG_CLIENT=false\nRUN if [ ${INSTALL_PG_CLIENT} = true ] ; then (apt-get update ;apt-get install --no-install-recommends wget=1.21.3-1ubuntu1 ) \\\n && add-apt-repository \"deb http://apt.postgresql.org/pub/repos/apt/ xenial-pgdg main\" \\\n && wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - \\\n && apt-get update \\\n && (apt-get update ;apt-get install --no-install-recommends postgresql-client-10 -y ) ; fi\n#\n#  --------------------------------------------------------------------------\n#   Final Touch\n#  --------------------------------------------------------------------------\n#\nUSER root\n#   Clean up\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* \\\n && rm /var/log/lastlog /var/log/faillog\n#   Set default work directory\nWORKDIR /var/www\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"ARG NODE_VERSION=${NODE_VERSION}\nFROM phusion/baseimage:latest\n#  Set Environment Variables\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV LANGUAGE=\"en_US.UTF-8\"\nENV LC_ALL=\"en_US.UTF-8\"\nENV LC_CTYPE=\"en_US.UTF-8\"\nENV LANG=\"en_US.UTF-8\"\nENV TERM=\"xterm\"\n#  Start as root\nUSER root\n# ##########################################################################\n#  Bootstrapping the image:\n# ##########################################################################\nRUN locale-gen en_US.UTF-8\nRUN apt-get install software-properties-common -y\nRUN apt-get update \\\n && apt-get install build-essential pkg-config libcurl4-openssl-dev libedit-dev libssl-dev libxml2-dev xz-utils libsqlite3-dev sqlite3 git curl vim nano postgresql-client -y --allow-downgrades --allow-remove-essential --allow-change-held-packages \\\n && apt-get clean\n#  Source the bash\nRUN . ~/.bashrc\n# ##########################################################################\n#  Nodedock non-root user:\n# ##########################################################################\n#  Add a non-root user to prevent files being created with root permissions on host machine.\nARG PUID=1000\nENV PUID=\"${PUID}\"\nARG PGID=1000\nENV PGID=\"${PGID}\"\n#  always run apt update when start and after add new source list, then clean up at end.\nRUN apt-get update -yqq \\\n && groupadd -g ${PGID} nodedock \\\n && useradd -u ${PUID} -g nodedock -m nodedock -G docker_env \\\n && usermod -p \"*\" nodedock\n# ##########################################################################\n#  Set Timezone\n# ##########################################################################\nARG TZ=UTC\nENV TZ=\"${TZ}\"\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime \\\n && echo $TZ > /etc/timezone\n# ##########################################################################\n#  User Aliases\n# ##########################################################################\nUSER root\nCOPY ./aliases.sh /root/aliases.sh\nCOPY ./aliases.sh /home/nodedock/aliases.sh\nRUN sed -i 's/\\r//' /root/aliases.sh \\\n && sed -i 's/\\r//' /home/nodedock/aliases.sh \\\n && chown nodedock:nodedock /home/nodedock/aliases.sh \\\n && echo \"\" >> ~/.bashrc \\\n && echo \"# Load Custom Aliases\" >> ~/.bashrc \\\n && echo \"source ~/aliases.sh\" >> ~/.bashrc \\\n && echo \"\" >> ~/.bashrc\nUSER nodedock\nRUN echo \"\" >> ~/.bashrc \\\n && echo \"# Load Custom Aliases\" >> ~/.bashrc \\\n && echo \"source ~/aliases.sh\" >> ~/.bashrc \\\n && echo \"\" >> ~/.bashrc\n# ##########################################################################\n#  Crontab\n# ##########################################################################\nUSER root\nCOPY ./crontab /etc/cron.d\nRUN chmod -R 644 /etc/cron.d\n# ##########################################################################\n#  ssh:\n# ##########################################################################\nARG INSTALL_WORKSPACE_SSH=false\nCOPY insecure_id_rsa /tmp/id_rsa\nCOPY insecure_id_rsa.pub /tmp/id_rsa.pub\nRUN if [ ${INSTALL_WORKSPACE_SSH} = true ] ; then rm -f /etc/service/sshd/down \\\n && cat /tmp/id_rsa.pub >> /root/.ssh/authorized_keys \\\n && cat /tmp/id_rsa.pub >> /root/.ssh/id_rsa.pub \\\n && cat /tmp/id_rsa >> /root/.ssh/id_rsa \\\n && rm -f /tmp/id_rsa* \\\n && chmod 644 /root/.ssh/authorized_keys /root/.ssh/id_rsa.pub \\\n && chmod 400 /root/.ssh/id_rsa \\\n && cp -rf /root/.ssh /home/nodedock \\\n && chown -R nodedock:nodedock /home/nodedock/.ssh ; fi\n# ##########################################################################\n#  Libpng16 EXTENSION\n# ##########################################################################\nARG INSTALL_LIBPNG=false\nRUN if [ ${INSTALL_LIBPNG} = true ] ; then apt update \\\n && apt-get install libpng16-16 ; fi\n# ##########################################################################\n#  Node / NVM:\n# ##########################################################################\nUSER nodedock\n#  Check if NVM needs to be installed\nARG NODE_VERSION=node\nENV NODE_VERSION=\"${NODE_VERSION}\"\nARG NODE_ENV=development\nENV NODE_ENV=\"${NODE_ENV}\"\nARG INSTALL_NODE=false\nARG INSTALL_NPM_GULP=false\nARG INSTALL_NPM_BOWER=false\nARG INSTALL_NPM_VUE_CLI=false\nARG INSTALL_NPM_ANGULAR_CLI=false\nARG NPM_REGISTRY\nENV NPM_REGISTRY=\"${NPM_REGISTRY}\"\nENV NVM_DIR=\"/home/nodedock/.nvm\"\nRUN if [ ${INSTALL_NODE} = true ] ; then curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash \\\n && . $NVM_DIR/nvm.sh \\\n && nvm install ${NODE_VERSION} \\\n && nvm use ${NODE_VERSION} \\\n && nvm alias ${NODE_VERSION} \\\n && if [ ${NPM_REGISTRY} ] ; then npm config set registry ${NPM_REGISTRY} ; fi \\\n && if [ ${INSTALL_NPM_GULP} = true ] ; then npm install gulp -g ; fi \\\n && if [ ${INSTALL_NPM_BOWER} = true ] ; then npm install bower -g ; fi \\\n && if [ ${INSTALL_NPM_VUE_CLI} = true ] ; then npm install @vue/cli -g ; fi \\\n && if [ ${INSTALL_NPM_ANGULAR_CLI} = true ] ; then npm install @angular/cli -g ; fi ; fi\n#  Wouldn't execute when added to the RUN statement in the above block\n#  Source NVM when loading bash since ~/.profile isn't loaded on non-login shell\nRUN if [ ${INSTALL_NODE} = true ] ; then echo \"\" >> ~/.bashrc \\\n && echo 'export NVM_DIR=\"$HOME/.nvm\"' >> ~/.bashrc \\\n && echo '[ -s \"$NVM_DIR/nvm.sh\" ] \\\n && . \"$NVM_DIR/nvm.sh\" # This loads nvm' >> ~/.bashrc; fi\n#  Add NVM binaries to root's .bashrc\nUSER root\nRUN if [ ${INSTALL_NODE} = true ] ; then echo \"\" >> ~/.bashrc \\\n && echo 'export NVM_DIR=\"/home/nodedock/.nvm\"' >> ~/.bashrc \\\n && echo '[ -s \"$NVM_DIR/nvm.sh\" ] \\\n && . \"$NVM_DIR/nvm.sh\" # This loads nvm' >> ~/.bashrc; fi\n#  Add PATH for node\nENV PATH=\"$PATH:$NVM_DIR/versions/node/v${NODE_VERSION}/bin\"\nRUN if [ ${NPM_REGISTRY} ] ; then . ~/.bashrc \\\n && npm config set registry ${NPM_REGISTRY} ; fi\n# ##########################################################################\n#  YARN:\n# ##########################################################################\nUSER nodedock\nARG INSTALL_YARN=false\nARG YARN_VERSION=latest\nENV YARN_VERSION=\"${YARN_VERSION}\"\nRUN if [ ${INSTALL_YARN} = true ] ; then [ -s \"$NVM_DIR/nvm.sh\" ] \\\n && . \"$NVM_DIR/nvm.sh\" \\\n && if [ ${YARN_VERSION} = \"latest\" ] ; then curl -o- -L https://yarnpkg.com/install.sh | bash ; else curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version ${YARN_VERSION} ; fi \\\n && echo \"\" >> ~/.bashrc \\\n && echo 'export PATH=\"$HOME/.yarn/bin:$PATH\"' >> ~/.bashrc; fi\n#  Add YARN binaries to root's .bashrc\nUSER root\nRUN if [ ${INSTALL_YARN} = true ] ; then echo \"\" >> ~/.bashrc \\\n && echo 'export YARN_DIR=\"/home/nodedock/.yarn\"' >> ~/.bashrc \\\n && echo 'export PATH=\"$YARN_DIR/bin:$PATH\"' >> ~/.bashrc; fi\n# ##########################################################################\n#  Image optimizers:\n# ##########################################################################\nUSER root\nARG INSTALL_IMAGE_OPTIMIZERS=false\nRUN if [ ${INSTALL_IMAGE_OPTIMIZERS} = true ] ; then apt-get install jpegoptim optipng pngquant gifsicle -y \\\n && if [ ${INSTALL_NODE} = true ] ; then exec bash \\\n && . ~/.bashrc \\\n && npm install svgo -g ; fi ; fi\nUSER nodedock\n# ##########################################################################\n#  PYTHON:\n# ##########################################################################\nUSER root\nARG INSTALL_PYTHON=false\nRUN if [ ${INSTALL_PYTHON} = true ] ; then apt-get install python python-pip python-dev build-essential -y \\\n && python -m pip install --upgrade pip \\\n && python -m pip install --upgrade virtualenv ; fi\n# ##########################################################################\n#  ImageMagick:\n# ##########################################################################\nUSER root\nARG INSTALL_IMAGEMAGICK=false\nRUN if [ ${INSTALL_IMAGEMAGICK} = true ] ; then apt-get install imagemagick -y ; fi\n# ##########################################################################\n#  pgsql client\n# ##########################################################################\nUSER root\nARG INSTALL_PG_CLIENT=false\nRUN if [ ${INSTALL_PG_CLIENT} = true ] ; then apt-get install wget \\\n && add-apt-repository \"deb http://apt.postgresql.org/pub/repos/apt/ xenial-pgdg main\" \\\n && wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - \\\n && apt-get update \\\n && apt-get install postgresql-client-10 -y ; fi\n#\n# --------------------------------------------------------------------------\n#  Final Touch\n# --------------------------------------------------------------------------\n#\nUSER root\n#  Clean up\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* \\\n && rm /var/log/lastlog /var/log/faillog\n#  Set default work directory\nWORKDIR /var/www\n","injectedSmells":[],"originalDockerfileHash":"5410b1d0545a4f3c445a1becbc4f9d86","successfullyInjectedSmells":[],"originalDockerfileUglified":"ARG NODE_VERSION=${NODE_VERSION}\nFROM phusion/baseimage:latest\n#   Set Environment Variables\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV LANGUAGE=\"en_US.UTF-8\"\nENV LC_ALL=\"en_US.UTF-8\"\nENV LC_CTYPE=\"en_US.UTF-8\"\nENV LANG=\"en_US.UTF-8\"\nENV TERM=\"xterm\"\n#   Start as root\nUSER root\n#  ##########################################################################\n#   Bootstrapping the image:\n#  ##########################################################################\nRUN locale-gen en_US.UTF-8\nRUN apt-get install software-properties-common -y\nRUN apt-get update \\\n && apt-get install build-essential pkg-config libcurl4-openssl-dev libedit-dev libssl-dev libxml2-dev xz-utils libsqlite3-dev sqlite3 git curl vim nano postgresql-client -y --allow-downgrades --allow-remove-essential --allow-change-held-packages \\\n && apt-get clean\n#   Source the bash\nRUN . ~/.bashrc\n#  ##########################################################################\n#   Nodedock non-root user:\n#  ##########################################################################\n#   Add a non-root user to prevent files being created with root permissions on host machine.\nARG PUID=1000\nENV PUID=\"${PUID}\"\nARG PGID=1000\nENV PGID=\"${PGID}\"\n#   always run apt update when start and after add new source list, then clean up at end.\nRUN apt-get update -yqq \\\n && groupadd -g ${PGID} nodedock \\\n && useradd -u ${PUID} -g nodedock -m nodedock -G docker_env \\\n && usermod -p \"*\" nodedock\n#  ##########################################################################\n#   Set Timezone\n#  ##########################################################################\nARG TZ=UTC\nENV TZ=\"${TZ}\"\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime \\\n && echo $TZ > /etc/timezone\n#  ##########################################################################\n#   User Aliases\n#  ##########################################################################\nUSER root\nCOPY ./aliases.sh /root/aliases.sh\nCOPY ./aliases.sh /home/nodedock/aliases.sh\nRUN sed -i 's/\\r//' /root/aliases.sh \\\n && sed -i 's/\\r//' /home/nodedock/aliases.sh \\\n && chown nodedock:nodedock /home/nodedock/aliases.sh \\\n && echo \"\" >> ~/.bashrc \\\n && echo \"# Load Custom Aliases\" >> ~/.bashrc \\\n && echo \"source ~/aliases.sh\" >> ~/.bashrc \\\n && echo \"\" >> ~/.bashrc\nUSER nodedock\nRUN echo \"\" >> ~/.bashrc \\\n && echo \"# Load Custom Aliases\" >> ~/.bashrc \\\n && echo \"source ~/aliases.sh\" >> ~/.bashrc \\\n && echo \"\" >> ~/.bashrc\n#  ##########################################################################\n#   Crontab\n#  ##########################################################################\nUSER root\nCOPY ./crontab /etc/cron.d\nRUN chmod -R 644 /etc/cron.d\n#  ##########################################################################\n#   ssh:\n#  ##########################################################################\nARG INSTALL_WORKSPACE_SSH=false\nCOPY insecure_id_rsa /tmp/id_rsa\nCOPY insecure_id_rsa.pub /tmp/id_rsa.pub\nRUN if [ ${INSTALL_WORKSPACE_SSH} = true ] ; then rm -f /etc/service/sshd/down \\\n && cat /tmp/id_rsa.pub >> /root/.ssh/authorized_keys \\\n && cat /tmp/id_rsa.pub >> /root/.ssh/id_rsa.pub \\\n && cat /tmp/id_rsa >> /root/.ssh/id_rsa \\\n && rm -f /tmp/id_rsa* \\\n && chmod 644 /root/.ssh/authorized_keys /root/.ssh/id_rsa.pub \\\n && chmod 400 /root/.ssh/id_rsa \\\n && cp -rf /root/.ssh /home/nodedock \\\n && chown -R nodedock:nodedock /home/nodedock/.ssh ; fi\n#  ##########################################################################\n#   Libpng16 EXTENSION\n#  ##########################################################################\nARG INSTALL_LIBPNG=false\nRUN if [ ${INSTALL_LIBPNG} = true ] ; then apt update \\\n && apt-get install libpng16-16 ; fi\n#  ##########################################################################\n#   Node / NVM:\n#  ##########################################################################\nUSER nodedock\n#   Check if NVM needs to be installed\nARG NODE_VERSION=node\nENV NODE_VERSION=\"${NODE_VERSION}\"\nARG NODE_ENV=development\nENV NODE_ENV=\"${NODE_ENV}\"\nARG INSTALL_NODE=false\nARG INSTALL_NPM_GULP=false\nARG INSTALL_NPM_BOWER=false\nARG INSTALL_NPM_VUE_CLI=false\nARG INSTALL_NPM_ANGULAR_CLI=false\nARG NPM_REGISTRY\nENV NPM_REGISTRY=\"${NPM_REGISTRY}\"\nENV NVM_DIR=\"/home/nodedock/.nvm\"\nRUN if [ ${INSTALL_NODE} = true ] ; then curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash \\\n && . $NVM_DIR/nvm.sh \\\n && nvm install ${NODE_VERSION} \\\n && nvm use ${NODE_VERSION} \\\n && nvm alias ${NODE_VERSION} \\\n && if [ ${NPM_REGISTRY} ] ; then npm config set registry ${NPM_REGISTRY} ; fi \\\n && if [ ${INSTALL_NPM_GULP} = true ] ; then npm install gulp -g ; fi \\\n && if [ ${INSTALL_NPM_BOWER} = true ] ; then npm install bower -g ; fi \\\n && if [ ${INSTALL_NPM_VUE_CLI} = true ] ; then npm install @vue/cli -g ; fi \\\n && if [ ${INSTALL_NPM_ANGULAR_CLI} = true ] ; then npm install @angular/cli -g ; fi ; fi\n#   Wouldn't execute when added to the RUN statement in the above block\n#   Source NVM when loading bash since ~/.profile isn't loaded on non-login shell\nRUN if [ ${INSTALL_NODE} = true ] ; then echo \"\" >> ~/.bashrc \\\n && echo 'export NVM_DIR=\"$HOME/.nvm\"' >> ~/.bashrc \\\n && echo '[ -s \"$NVM_DIR/nvm.sh\" ] \\\n && . \"$NVM_DIR/nvm.sh\" # This loads nvm' >> ~/.bashrc; fi\n#   Add NVM binaries to root's .bashrc\nUSER root\nRUN if [ ${INSTALL_NODE} = true ] ; then echo \"\" >> ~/.bashrc \\\n && echo 'export NVM_DIR=\"/home/nodedock/.nvm\"' >> ~/.bashrc \\\n && echo '[ -s \"$NVM_DIR/nvm.sh\" ] \\\n && . \"$NVM_DIR/nvm.sh\" # This loads nvm' >> ~/.bashrc; fi\n#   Add PATH for node\nENV PATH=\"$PATH:$NVM_DIR/versions/node/v${NODE_VERSION}/bin\"\nRUN if [ ${NPM_REGISTRY} ] ; then . ~/.bashrc \\\n && npm config set registry ${NPM_REGISTRY} ; fi\n#  ##########################################################################\n#   YARN:\n#  ##########################################################################\nUSER nodedock\nARG INSTALL_YARN=false\nARG YARN_VERSION=latest\nENV YARN_VERSION=\"${YARN_VERSION}\"\nRUN if [ ${INSTALL_YARN} = true ] ; then [ -s \"$NVM_DIR/nvm.sh\" ] \\\n && . \"$NVM_DIR/nvm.sh\" \\\n && if [ ${YARN_VERSION} = \"latest\" ] ; then curl -o- -L https://yarnpkg.com/install.sh | bash ; else curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version ${YARN_VERSION} ; fi \\\n && echo \"\" >> ~/.bashrc \\\n && echo 'export PATH=\"$HOME/.yarn/bin:$PATH\"' >> ~/.bashrc; fi\n#   Add YARN binaries to root's .bashrc\nUSER root\nRUN if [ ${INSTALL_YARN} = true ] ; then echo \"\" >> ~/.bashrc \\\n && echo 'export YARN_DIR=\"/home/nodedock/.yarn\"' >> ~/.bashrc \\\n && echo 'export PATH=\"$YARN_DIR/bin:$PATH\"' >> ~/.bashrc; fi\n#  ##########################################################################\n#   Image optimizers:\n#  ##########################################################################\nUSER root\nARG INSTALL_IMAGE_OPTIMIZERS=false\nRUN if [ ${INSTALL_IMAGE_OPTIMIZERS} = true ] ; then apt-get install jpegoptim optipng pngquant gifsicle -y \\\n && if [ ${INSTALL_NODE} = true ] ; then exec bash \\\n && . ~/.bashrc \\\n && npm install svgo -g ; fi ; fi\nUSER nodedock\n#  ##########################################################################\n#   PYTHON:\n#  ##########################################################################\nUSER root\nARG INSTALL_PYTHON=false\nRUN if [ ${INSTALL_PYTHON} = true ] ; then apt-get install python python-pip python-dev build-essential -y \\\n && python -m pip install --upgrade pip \\\n && python -m pip install --upgrade virtualenv ; fi\n#  ##########################################################################\n#   ImageMagick:\n#  ##########################################################################\nUSER root\nARG INSTALL_IMAGEMAGICK=false\nRUN if [ ${INSTALL_IMAGEMAGICK} = true ] ; then apt-get install imagemagick -y ; fi\n#  ##########################################################################\n#   pgsql client\n#  ##########################################################################\nUSER root\nARG INSTALL_PG_CLIENT=false\nRUN if [ ${INSTALL_PG_CLIENT} = true ] ; then apt-get install wget \\\n && add-apt-repository \"deb http://apt.postgresql.org/pub/repos/apt/ xenial-pgdg main\" \\\n && wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - \\\n && apt-get update \\\n && apt-get install postgresql-client-10 -y ; fi\n#\n#  --------------------------------------------------------------------------\n#   Final Touch\n#  --------------------------------------------------------------------------\n#\nUSER root\n#   Clean up\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* \\\n && rm /var/log/lastlog /var/log/faillog\n#   Set default work directory\nWORKDIR /var/www\n","originalDockerfileUglifiedHash":"82d0d314a3f2ea7fd7522b78c34e1906","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/9cb9527b5b8c8207e9fa313aec2ab20fd344b20e.dockerfile"}