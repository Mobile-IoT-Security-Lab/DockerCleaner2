{"seed":2902917947,"processedDockerfileHash":"9ae089e681a623f386517bd2ad3436ff","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apt-get","have-a-healthcheck","have-a-user"],"processedDockerfile":"#\n#   Cilium runtime base image\n#\nFROM docker.io/library/ubuntu:18.04 AS runtime-base\nRUN apt-get update \\\n && apt-get upgrade -y \\\n && apt-get install --no-install-recommends gpg=2.2.4-1ubuntu1.6 gpg-agent=2.2.4-1ubuntu1.6 libelf-dev=0.170-0.4ubuntu0.1 libmnl-dev=1.0.4-2 libc6-dev-i386=2.27-3ubuntu1.6 iptables=1.6.1-2ubuntu2 libgcc-5-dev=5.5.0-12ubuntu1 bash-completion=1:2.8-1ubuntu1 binutils=2.30-21ubuntu1~18.04.8 binutils-dev=2.30-21ubuntu1~18.04.8 ca-certificates=20211016ubuntu0.18.04.1 clang-7=1:7-3~ubuntu0.18.04.1 llvm-7=1:7-3~ubuntu0.18.04.1 kmod=24-1ubuntu3.5 -y \\\n && apt-get purge --auto-remove \\\n && apt-get clean \\\n && rm -fr /usr/lib/llvm-7/include/llvm-c \\\n && rm -fr /usr/lib/llvm-7/include/clang-c \\\n && rm -fr /usr/lib/llvm-7/include/c++ \\\n && rm -fr /usr/lib/llvm-7/include/polly \\\n && rm -fr /usr/lib/llvm-7/share \\\n && ls -d /usr/lib/llvm-7/lib/* | grep -vE clang$ | xargs rm -r \\\n && ls -d /usr/lib/llvm-7/bin/* | grep -vE \"clang$|clang-7$|llc$\" | xargs basename -a | awk '{ print \"/usr/bin/\"$1\"-7\" }' | xargs rm -r \\\n && ls -d /usr/lib/llvm-7/bin/* | grep -vE \"clang$|clang-7$|llc$\" | xargs rm -r \\\n && strip /usr/lib/llvm-7/bin/* \\\n && update-alternatives --install /usr/bin/clang clang /usr/lib/llvm-7/bin/clang 1000 \\\n && update-alternatives --install /usr/bin/llc llc /usr/lib/llvm-7/bin/llc 1000\n#\n#   Build Cilium runtime dependencies.\n#\nFROM runtime-base AS runtime-build\nWORKDIR /tmp\nRUN apt-get install --no-install-recommends make=4.1-9.1ubuntu1 git=1:2.17.1-1ubuntu0.17 curl=7.58.0-2ubuntu3.24 ca-certificates=20211016ubuntu0.18.04.1 xz-utils=5.2.2-1.3ubuntu0.1 gcc=4:7.4.0-1ubuntu2.3 git=1:2.17.1-1ubuntu0.17 pkg-config=0.29.1-0ubuntu2 bison=2:3.0.4.dfsg-1build1 flex=2.6.4-6 build-essential=12.4ubuntu1 -y \\\n && git clone --depth 1 -b static-data https://github.com/cilium/iproute2.git iproute2 \\\n && cd iproute2 \\\n && ./configure \\\n && make -j `getconf _NPROCESSORS_ONLN ` \\\n && strip tc/tc \\\n && strip ip/ip \\\n && cd .. \\\n && git clone --depth 1 -b master git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git \\\n && cd linux/tools/bpf/bpftool/ \\\n && make -j `getconf _NPROCESSORS_ONLN ` \\\n && strip bpftool \\\n && cd ../../../../ \\\n && curl -SsL https://github.com/cilium/bpf-map/releases/download/v1.0/bpf-map -o bpf-map \\\n && chmod +x bpf-map \\\n && strip bpf-map \\\n && curl -sS -L https://github.com/containernetworking/plugins/releases/download/v0.7.5/cni-plugins-amd64-v0.7.5.tgz -o cni.tar.gz \\\n && tar -xvf cni.tar.gz ./loopback \\\n && strip -s ./loopback \\\n && apt-get purge --auto-remove -y gpg gpg-agent gcc make bison flex git curl xz-utils ca-certificates \\\n && apt-get clean\n#\n#   Go-based tools we need at runtime\n#\nFROM docker.io/library/golang:1.12.5 AS runtime-gobuild\nWORKDIR /tmp\nRUN go get -d github.com/google/gops \\\n && cd /go/src/github.com/google/gops \\\n && git checkout -b v0.3.6 v0.3.6 \\\n && go install \\\n && strip /go/bin/gops\n#\n#   Stripped cilium runtime base image\n#\nFROM runtime-base\nLABEL maintainer=\"maintainer@cilium.io\"\nWORKDIR /bin\nCOPY --from=runtime-build /tmp/iproute2/tc/tc /tmp/iproute2/ip/ip ./\nCOPY --from=runtime-build /tmp/linux/tools/bpf/bpftool/bpftool ./\nCOPY --from=runtime-build /tmp/bpf-map ./\nCOPY --from=runtime-gobuild /go/bin/gops ./\nWORKDIR /cni\nCOPY --from=runtime-build /tmp/loopback ./\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#\n#  Cilium runtime base image\n#\nFROM docker.io/library/ubuntu:18.04 AS runtime-base\nRUN apt-get update \\\n && apt-get upgrade -y \\\n && apt-get install --no-install-recommends gpg gpg-agent libelf-dev libmnl-dev libc6-dev-i386 iptables libgcc-5-dev bash-completion binutils binutils-dev ca-certificates clang-7 llvm-7 kmod -y \\\n && apt-get purge --auto-remove \\\n && apt-get clean \\\n && rm -fr /usr/lib/llvm-7/include/llvm-c \\\n && rm -fr /usr/lib/llvm-7/include/clang-c \\\n && rm -fr /usr/lib/llvm-7/include/c++ \\\n && rm -fr /usr/lib/llvm-7/include/polly \\\n && rm -fr /usr/lib/llvm-7/share \\\n && ls -d /usr/lib/llvm-7/lib/* | grep -vE clang$ | xargs rm -r \\\n && ls -d /usr/lib/llvm-7/bin/* | grep -vE \"clang$|clang-7$|llc$\" | xargs basename -a | awk '{ print \"/usr/bin/\"$1\"-7\" }' | xargs rm -r \\\n && ls -d /usr/lib/llvm-7/bin/* | grep -vE \"clang$|clang-7$|llc$\" | xargs rm -r \\\n && strip /usr/lib/llvm-7/bin/* \\\n && update-alternatives --install /usr/bin/clang clang /usr/lib/llvm-7/bin/clang 1000 \\\n && update-alternatives --install /usr/bin/llc llc /usr/lib/llvm-7/bin/llc 1000\n#\n#  Build Cilium runtime dependencies.\n#\nFROM runtime-base AS runtime-build\nWORKDIR /tmp\nRUN apt-get install --no-install-recommends make git curl ca-certificates xz-utils gcc git pkg-config bison flex build-essential -y \\\n && git clone --depth 1 -b static-data https://github.com/cilium/iproute2.git iproute2 \\\n && cd iproute2 \\\n && ./configure \\\n && make -j `getconf _NPROCESSORS_ONLN ` \\\n && strip tc/tc \\\n && strip ip/ip \\\n && cd .. \\\n && git clone --depth 1 -b master git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git \\\n && cd linux/tools/bpf/bpftool/ \\\n && make -j `getconf _NPROCESSORS_ONLN ` \\\n && strip bpftool \\\n && cd ../../../../ \\\n && curl -SsL https://github.com/cilium/bpf-map/releases/download/v1.0/bpf-map -o bpf-map \\\n && chmod +x bpf-map \\\n && strip bpf-map \\\n && curl -sS -L https://github.com/containernetworking/plugins/releases/download/v0.7.5/cni-plugins-amd64-v0.7.5.tgz -o cni.tar.gz \\\n && tar -xvf cni.tar.gz ./loopback \\\n && strip -s ./loopback \\\n && apt-get purge --auto-remove -y gpg gpg-agent gcc make bison flex git curl xz-utils ca-certificates \\\n && apt-get clean\n#\n#  Go-based tools we need at runtime\n#\nFROM docker.io/library/golang:1.12.5 AS runtime-gobuild\nWORKDIR /tmp\nRUN go get -d github.com/google/gops \\\n && cd /go/src/github.com/google/gops \\\n && git checkout -b v0.3.6 v0.3.6 \\\n && go install \\\n && strip /go/bin/gops\n#\n#  Stripped cilium runtime base image\n#\nFROM runtime-base\nLABEL maintainer=\"maintainer@cilium.io\"\nWORKDIR /bin\nCOPY --from=runtime-build /tmp/iproute2/tc/tc /tmp/iproute2/ip/ip ./\nCOPY --from=runtime-build /tmp/linux/tools/bpf/bpftool/bpftool ./\nCOPY --from=runtime-build /tmp/bpf-map ./\nCOPY --from=runtime-gobuild /go/bin/gops ./\nWORKDIR /cni\nCOPY --from=runtime-build /tmp/loopback ./\n","injectedSmells":[],"originalDockerfileHash":"178fd27dae0b8e9aeca82fd8ad07033b","successfullyInjectedSmells":[],"originalDockerfileUglified":"#\n#   Cilium runtime base image\n#\nFROM docker.io/library/ubuntu:18.04 AS runtime-base\nRUN apt-get update \\\n && apt-get upgrade -y \\\n && apt-get install --no-install-recommends gpg gpg-agent libelf-dev libmnl-dev libc6-dev-i386 iptables libgcc-5-dev bash-completion binutils binutils-dev ca-certificates clang-7 llvm-7 kmod -y \\\n && apt-get purge --auto-remove \\\n && apt-get clean \\\n && rm -fr /usr/lib/llvm-7/include/llvm-c \\\n && rm -fr /usr/lib/llvm-7/include/clang-c \\\n && rm -fr /usr/lib/llvm-7/include/c++ \\\n && rm -fr /usr/lib/llvm-7/include/polly \\\n && rm -fr /usr/lib/llvm-7/share \\\n && ls -d /usr/lib/llvm-7/lib/* | grep -vE clang$ | xargs rm -r \\\n && ls -d /usr/lib/llvm-7/bin/* | grep -vE \"clang$|clang-7$|llc$\" | xargs basename -a | awk '{ print \"/usr/bin/\"$1\"-7\" }' | xargs rm -r \\\n && ls -d /usr/lib/llvm-7/bin/* | grep -vE \"clang$|clang-7$|llc$\" | xargs rm -r \\\n && strip /usr/lib/llvm-7/bin/* \\\n && update-alternatives --install /usr/bin/clang clang /usr/lib/llvm-7/bin/clang 1000 \\\n && update-alternatives --install /usr/bin/llc llc /usr/lib/llvm-7/bin/llc 1000\n#\n#   Build Cilium runtime dependencies.\n#\nFROM runtime-base AS runtime-build\nWORKDIR /tmp\nRUN apt-get install --no-install-recommends make git curl ca-certificates xz-utils gcc git pkg-config bison flex build-essential -y \\\n && git clone --depth 1 -b static-data https://github.com/cilium/iproute2.git iproute2 \\\n && cd iproute2 \\\n && ./configure \\\n && make -j `getconf _NPROCESSORS_ONLN ` \\\n && strip tc/tc \\\n && strip ip/ip \\\n && cd .. \\\n && git clone --depth 1 -b master git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git \\\n && cd linux/tools/bpf/bpftool/ \\\n && make -j `getconf _NPROCESSORS_ONLN ` \\\n && strip bpftool \\\n && cd ../../../../ \\\n && curl -SsL https://github.com/cilium/bpf-map/releases/download/v1.0/bpf-map -o bpf-map \\\n && chmod +x bpf-map \\\n && strip bpf-map \\\n && curl -sS -L https://github.com/containernetworking/plugins/releases/download/v0.7.5/cni-plugins-amd64-v0.7.5.tgz -o cni.tar.gz \\\n && tar -xvf cni.tar.gz ./loopback \\\n && strip -s ./loopback \\\n && apt-get purge --auto-remove -y gpg gpg-agent gcc make bison flex git curl xz-utils ca-certificates \\\n && apt-get clean\n#\n#   Go-based tools we need at runtime\n#\nFROM docker.io/library/golang:1.12.5 AS runtime-gobuild\nWORKDIR /tmp\nRUN go get -d github.com/google/gops \\\n && cd /go/src/github.com/google/gops \\\n && git checkout -b v0.3.6 v0.3.6 \\\n && go install \\\n && strip /go/bin/gops\n#\n#   Stripped cilium runtime base image\n#\nFROM runtime-base\nLABEL maintainer=\"maintainer@cilium.io\"\nWORKDIR /bin\nCOPY --from=runtime-build /tmp/iproute2/tc/tc /tmp/iproute2/ip/ip ./\nCOPY --from=runtime-build /tmp/linux/tools/bpf/bpftool/bpftool ./\nCOPY --from=runtime-build /tmp/bpf-map ./\nCOPY --from=runtime-gobuild /go/bin/gops ./\nWORKDIR /cni\nCOPY --from=runtime-build /tmp/loopback ./\n","originalDockerfileUglifiedHash":"7e8747fd0f008dd09fdc1e2d926af078","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/cb91c6758cb2e312c7b7221c5642b0a8a882c0d1.dockerfile"}