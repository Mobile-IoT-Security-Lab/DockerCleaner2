{"seed":1840619829,"processedDockerfileHash":"dfa3e00307fe90536beb60a2111522be","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM behance/docker-nginx:8.5\nMAINTAINER Bryan Latten <latten@adobe.com>\n#   Set TERM to suppress warning messages.\nENV CONF_PHPFPM=\"/etc/php/7.0/fpm/php-fpm.conf\" \\\n    CONF_PHPMODS=\"/etc/php/7.0/mods-available\" \\\n    CONF_FPMPOOL=\"/etc/php/7.0/fpm/pool.d/www.conf\" \\\n    CONF_FPMOVERRIDES=\"/etc/php/7.0/fpm/conf.d/overrides.user.ini\" \\\n    APP_ROOT=\"/app\" \\\n    SERVER_WORKER_CONNECTIONS=\"3072\" \\\n    SERVER_CLIENT_BODY_BUFFER_SIZE=\"128k\" \\\n    SERVER_CLIENT_HEADER_BUFFER_SIZE=\"1k\" \\\n    SERVER_CLIENT_BODY_BUFFER_SIZE=\"128k\" \\\n    SERVER_LARGE_CLIENT_HEADER_BUFFERS=\"4 256k\" \\\n    PHP_FPM_MAX_CHILDREN=\"4096\" \\\n    PHP_FPM_START_SERVERS=\"20\" \\\n    PHP_FPM_MAX_REQUESTS=\"1024\" \\\n    PHP_FPM_MIN_SPARE_SERVERS=\"5\" \\\n    PHP_FPM_MAX_SPARE_SERVERS=\"128\" \\\n    PHP_FPM_MEMORY_LIMIT=\"256M\" \\\n    PHP_FPM_MAX_EXECUTION_TIME=\"60\" \\\n    PHP_FPM_UPLOAD_MAX_FILESIZE=\"1M\" \\\n    PHP_OPCACHE_MEMORY_CONSUMPTION=\"128\" \\\n    PHP_OPCACHE_INTERNED_STRINGS_BUFFER=\"16\" \\\n    PHP_OPCACHE_MAX_WASTED_PERCENTAGE=\"5\" \\\n    CFG_APP_DEBUG=\"1\"\n#   - Update security packages, only\nRUN /bin/bash -e /security_updates.sh \\\n && apt-get install --no-install-recommends gpg-agent git curl wget software-properties-common locales -yqq \\\n && locale-gen en_US.UTF-8 \\\n && export LANG=en_US.UTF-8 \\\n && add-apt-repository ppa:ondrej/php -y \\\n && echo 'deb http://apt.newrelic.com/debian/ newrelic non-free' | tee /etc/apt/sources.list.d/newrelic.list \\\n && wget -O- https://download.newrelic.com/548C16BF.gpg | apt-key add - \\\n && echo newrelic-php5 newrelic-php5/application-name string \"REPLACE_NEWRELIC_APP\" | debconf-set-selections \\\n && echo newrelic-php5 newrelic-php5/license-key string \"REPLACE_NEWRELIC_LICENSE\" | debconf-set-selections \\\n && apt-get remove --purge -yq patch software-properties-common locales wget \\\n && /bin/bash /clean.sh\n#   Add PHP and support packages \\\nRUN apt-get update -q \\\n && apt-mark hold php5.6-cli php5.6-common php5.6-json php7.1-cli php7.1-common php7.1-json php7.2-cli php7.2-common php7.2-json php7.3-cli php7.3-common php7.3-json \\\n && apt-get install --no-install-recommends php7.0 php7.0-apcu php7.0-bcmath php7.0-bz2 php7.0-curl php7.0-dev php7.0-fpm php7.0-gd php7.0-igbinary php7.0-intl php7.0-json php7.0-mbstring php7.0-mcrypt php7.0-pgsql php7.0-memcache php7.0-memcached php7.0-mysql php7.0-xdebug php7.0-yaml php7.0-xml php7.0-zip newrelic-php5 newrelic-php5-common newrelic-daemon -yqq \\\n && phpdismod pdo_pgsql \\\n && phpdismod pgsql \\\n && phpdismod yaml \\\n && phpdismod xdebug \\\n && rm -rf /usr/lib/php/20121212 \\\n && rm -rf /usr/lib/php/20131226 \\\n && rm -rf /usr/lib/php/20160303 \\\n && rm -rf /usr/lib/php/20170718 \\\n && curl -sS https://getcomposer.org/installer | php \\\n && mv composer.phar /usr/local/bin/composer \\\n && pecl install redis-4.2.0 \\\n && echo \"extension=redis.so\" > $CONF_PHPMODS/redis.ini \\\n && apt-get remove --purge -yq php7.0-dev \\\n && /bin/bash /clean.sh\n#   Overlay the root filesystem from this repo\nCOPY ./container/root /\n#   - Hack: share startup scripts between variant versions by symlinking\nRUN ln -s /usr/sbin/php-fpm7.0 /usr/sbin/php-fpm \\\n && phpenmod overrides \\\n && phpenmod newrelic \\\n && /bin/bash -e /prep-php.sh\nRUN goss -g /tests/php-fpm/7.0.goss.yaml validate \\\n && /aufs_hack.sh\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM behance/docker-nginx:8.5\nMAINTAINER Bryan Latten <latten@adobe.com>\n#  Set TERM to suppress warning messages.\nENV CONF_PHPFPM=\"/etc/php/7.0/fpm/php-fpm.conf\" \\\n    CONF_PHPMODS=\"/etc/php/7.0/mods-available\" \\\n    CONF_FPMPOOL=\"/etc/php/7.0/fpm/pool.d/www.conf\" \\\n    CONF_FPMOVERRIDES=\"/etc/php/7.0/fpm/conf.d/overrides.user.ini\" \\\n    APP_ROOT=\"/app\" \\\n    SERVER_WORKER_CONNECTIONS=\"3072\" \\\n    SERVER_CLIENT_BODY_BUFFER_SIZE=\"128k\" \\\n    SERVER_CLIENT_HEADER_BUFFER_SIZE=\"1k\" \\\n    SERVER_CLIENT_BODY_BUFFER_SIZE=\"128k\" \\\n    SERVER_LARGE_CLIENT_HEADER_BUFFERS=\"4 256k\" \\\n    PHP_FPM_MAX_CHILDREN=\"4096\" \\\n    PHP_FPM_START_SERVERS=\"20\" \\\n    PHP_FPM_MAX_REQUESTS=\"1024\" \\\n    PHP_FPM_MIN_SPARE_SERVERS=\"5\" \\\n    PHP_FPM_MAX_SPARE_SERVERS=\"128\" \\\n    PHP_FPM_MEMORY_LIMIT=\"256M\" \\\n    PHP_FPM_MAX_EXECUTION_TIME=\"60\" \\\n    PHP_FPM_UPLOAD_MAX_FILESIZE=\"1M\" \\\n    PHP_OPCACHE_MEMORY_CONSUMPTION=\"128\" \\\n    PHP_OPCACHE_INTERNED_STRINGS_BUFFER=\"16\" \\\n    PHP_OPCACHE_MAX_WASTED_PERCENTAGE=\"5\" \\\n    CFG_APP_DEBUG=\"1\"\n#  - Update security packages, only\nRUN /bin/bash -e /security_updates.sh \\\n && apt-get install --no-install-recommends gpg-agent git curl wget software-properties-common locales -yqq \\\n && locale-gen en_US.UTF-8 \\\n && export LANG=en_US.UTF-8 \\\n && add-apt-repository ppa:ondrej/php -y \\\n && echo 'deb http://apt.newrelic.com/debian/ newrelic non-free' | tee /etc/apt/sources.list.d/newrelic.list \\\n && wget -O- https://download.newrelic.com/548C16BF.gpg | apt-key add - \\\n && echo newrelic-php5 newrelic-php5/application-name string \"REPLACE_NEWRELIC_APP\" | debconf-set-selections \\\n && echo newrelic-php5 newrelic-php5/license-key string \"REPLACE_NEWRELIC_LICENSE\" | debconf-set-selections \\\n && apt-get remove --purge -yq patch software-properties-common locales wget \\\n && /bin/bash /clean.sh\n#  Add PHP and support packages \\\nRUN apt-get update -q \\\n && apt-mark hold php5.6-cli php5.6-common php5.6-json php7.1-cli php7.1-common php7.1-json php7.2-cli php7.2-common php7.2-json php7.3-cli php7.3-common php7.3-json \\\n && apt-get install php7.0 php7.0-apcu php7.0-bcmath php7.0-bz2 php7.0-curl php7.0-dev php7.0-fpm php7.0-gd php7.0-igbinary php7.0-intl php7.0-json php7.0-mbstring php7.0-mcrypt php7.0-pgsql php7.0-memcache php7.0-memcached php7.0-mysql php7.0-xdebug php7.0-yaml php7.0-xml php7.0-zip newrelic-php5 newrelic-php5-common newrelic-daemon -yqq \\\n && phpdismod pdo_pgsql \\\n && phpdismod pgsql \\\n && phpdismod yaml \\\n && phpdismod xdebug \\\n && rm -rf /usr/lib/php/20121212 \\\n && rm -rf /usr/lib/php/20131226 \\\n && rm -rf /usr/lib/php/20160303 \\\n && rm -rf /usr/lib/php/20170718 \\\n && curl -sS https://getcomposer.org/installer | php \\\n && mv composer.phar /usr/local/bin/composer \\\n && pecl install redis-4.2.0 \\\n && echo \"extension=redis.so\" > $CONF_PHPMODS/redis.ini \\\n && apt-get remove --purge -yq php7.0-dev \\\n && /bin/bash /clean.sh\n#  Overlay the root filesystem from this repo\nCOPY ./container/root /\n#  - Hack: share startup scripts between variant versions by symlinking\nRUN ln -s /usr/sbin/php-fpm7.0 /usr/sbin/php-fpm \\\n && phpenmod overrides \\\n && phpenmod newrelic \\\n && /bin/bash -e /prep-php.sh\nRUN goss -g /tests/php-fpm/7.0.goss.yaml validate \\\n && /aufs_hack.sh\n","injectedSmells":[],"originalDockerfileHash":"9781f1edda321ce0e867c2166db5a135","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM behance/docker-nginx:8.5\nMAINTAINER Bryan Latten <latten@adobe.com>\n#   Set TERM to suppress warning messages.\nENV CONF_PHPFPM=\"/etc/php/7.0/fpm/php-fpm.conf\" \\\n    CONF_PHPMODS=\"/etc/php/7.0/mods-available\" \\\n    CONF_FPMPOOL=\"/etc/php/7.0/fpm/pool.d/www.conf\" \\\n    CONF_FPMOVERRIDES=\"/etc/php/7.0/fpm/conf.d/overrides.user.ini\" \\\n    APP_ROOT=\"/app\" \\\n    SERVER_WORKER_CONNECTIONS=\"3072\" \\\n    SERVER_CLIENT_BODY_BUFFER_SIZE=\"128k\" \\\n    SERVER_CLIENT_HEADER_BUFFER_SIZE=\"1k\" \\\n    SERVER_CLIENT_BODY_BUFFER_SIZE=\"128k\" \\\n    SERVER_LARGE_CLIENT_HEADER_BUFFERS=\"4 256k\" \\\n    PHP_FPM_MAX_CHILDREN=\"4096\" \\\n    PHP_FPM_START_SERVERS=\"20\" \\\n    PHP_FPM_MAX_REQUESTS=\"1024\" \\\n    PHP_FPM_MIN_SPARE_SERVERS=\"5\" \\\n    PHP_FPM_MAX_SPARE_SERVERS=\"128\" \\\n    PHP_FPM_MEMORY_LIMIT=\"256M\" \\\n    PHP_FPM_MAX_EXECUTION_TIME=\"60\" \\\n    PHP_FPM_UPLOAD_MAX_FILESIZE=\"1M\" \\\n    PHP_OPCACHE_MEMORY_CONSUMPTION=\"128\" \\\n    PHP_OPCACHE_INTERNED_STRINGS_BUFFER=\"16\" \\\n    PHP_OPCACHE_MAX_WASTED_PERCENTAGE=\"5\" \\\n    CFG_APP_DEBUG=\"1\"\n#   - Update security packages, only\nRUN /bin/bash -e /security_updates.sh \\\n && apt-get install --no-install-recommends gpg-agent git curl wget software-properties-common locales -yqq \\\n && locale-gen en_US.UTF-8 \\\n && export LANG=en_US.UTF-8 \\\n && add-apt-repository ppa:ondrej/php -y \\\n && echo 'deb http://apt.newrelic.com/debian/ newrelic non-free' | tee /etc/apt/sources.list.d/newrelic.list \\\n && wget -O- https://download.newrelic.com/548C16BF.gpg | apt-key add - \\\n && echo newrelic-php5 newrelic-php5/application-name string \"REPLACE_NEWRELIC_APP\" | debconf-set-selections \\\n && echo newrelic-php5 newrelic-php5/license-key string \"REPLACE_NEWRELIC_LICENSE\" | debconf-set-selections \\\n && apt-get remove --purge -yq patch software-properties-common locales wget \\\n && /bin/bash /clean.sh\n#   Add PHP and support packages \\\nRUN apt-get update -q \\\n && apt-mark hold php5.6-cli php5.6-common php5.6-json php7.1-cli php7.1-common php7.1-json php7.2-cli php7.2-common php7.2-json php7.3-cli php7.3-common php7.3-json \\\n && apt-get install php7.0 php7.0-apcu php7.0-bcmath php7.0-bz2 php7.0-curl php7.0-dev php7.0-fpm php7.0-gd php7.0-igbinary php7.0-intl php7.0-json php7.0-mbstring php7.0-mcrypt php7.0-pgsql php7.0-memcache php7.0-memcached php7.0-mysql php7.0-xdebug php7.0-yaml php7.0-xml php7.0-zip newrelic-php5 newrelic-php5-common newrelic-daemon -yqq \\\n && phpdismod pdo_pgsql \\\n && phpdismod pgsql \\\n && phpdismod yaml \\\n && phpdismod xdebug \\\n && rm -rf /usr/lib/php/20121212 \\\n && rm -rf /usr/lib/php/20131226 \\\n && rm -rf /usr/lib/php/20160303 \\\n && rm -rf /usr/lib/php/20170718 \\\n && curl -sS https://getcomposer.org/installer | php \\\n && mv composer.phar /usr/local/bin/composer \\\n && pecl install redis-4.2.0 \\\n && echo \"extension=redis.so\" > $CONF_PHPMODS/redis.ini \\\n && apt-get remove --purge -yq php7.0-dev \\\n && /bin/bash /clean.sh\n#   Overlay the root filesystem from this repo\nCOPY ./container/root /\n#   - Hack: share startup scripts between variant versions by symlinking\nRUN ln -s /usr/sbin/php-fpm7.0 /usr/sbin/php-fpm \\\n && phpenmod overrides \\\n && phpenmod newrelic \\\n && /bin/bash -e /prep-php.sh\nRUN goss -g /tests/php-fpm/7.0.goss.yaml validate \\\n && /aufs_hack.sh\n","originalDockerfileUglifiedHash":"f6eb7b3245a7e0a8fd3e2647e19379d1","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/5bac3414e892679c246a2648f21b2d5106afcb59.dockerfile"}