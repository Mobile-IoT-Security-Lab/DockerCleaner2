{"seed":1894301628,"processedDockerfileHash":"5fe8baf94eb46c74fecc2f9998090fef","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM alpine:edge\nMAINTAINER Paul Smith <pa.ulsmith.net>\n#   Add repos\nRUN echo \"http://dl-cdn.alpinelinux.org/alpine/edge/testing\" >> /etc/apk/repositories\n#   Add basics first\nRUN apk update \\\n && apk upgrade \\\n && apk add bash=5.2.15-r2 apache2=2.4.57-r0 php5-apache2 curl=8.0.1-r1 ca-certificates=20230106-r0 openssl=3.1.0-r2 git=2.40.0-r0 php5 php5-phar php5-json php5-iconv php5-openssl tzdata=2023c-r0 openntpd=6.8_p1-r8 vim=9.0.1440-r0 nano=7.2-r0\n#   Setup apache and php\nRUN apk add php5-ftp php5-mcrypt php5-soap php5-gmp php5-pdo_odbc php5-dom php5-pdo php5-zip php5-mysqli php5-sqlite3 php5-pdo_pgsql php5-bcmath php5-gd php5-odbc php5-pdo_mysql php5-pdo_sqlite php5-gettext php5-xmlrpc php5-bz2 php5-pdo_dblib php5-curl php5-ctype sqlite=3.41.2-r1 rsync=3.2.7-r1 pwgen=2.08-r2 netcat-openbsd=1.219-r0 \\\n && cp /usr/bin/php5 /usr/bin/php \\\n && rm -f /var/cache/apk/*\n#   Add Composer\nRUN curl -sS https://getcomposer.org/installer | php \\\n && mv composer.phar /usr/local/bin/composer\n#   enabling SSH\nRUN apk add openssh=9.3_p1-r1 --update --no-cache \\\n && sed -i s/#PermitRootLogin.*/PermitRootLogin yes/ /etc/ssh/sshd_config \\\n && echo \"root:THISISNOTFORLOGIN102i3709123\" | chpasswd \\\n && rm -rf /var/cache/apk/*\nRUN sed -ie 's/#Port 22/Port 22/g' /etc/ssh/sshd_config\nRUN sed -ri 's/#HostKey \\/etc\\/ssh\\/ssh_host_key/HostKey \\/etc\\/ssh\\/ssh_host_key/g' /etc/ssh/sshd_config\nRUN sed -ir 's/#HostKey \\/etc\\/ssh\\/ssh_host_rsa_key/HostKey \\/etc\\/ssh\\/ssh_host_rsa_key/g' /etc/ssh/sshd_config\nRUN sed -ir 's/#HostKey \\/etc\\/ssh\\/ssh_host_dsa_key/HostKey \\/etc\\/ssh\\/ssh_host_dsa_key/g' /etc/ssh/sshd_config\nRUN sed -ir 's/#HostKey \\/etc\\/ssh\\/ssh_host_ecdsa_key/HostKey \\/etc\\/ssh\\/ssh_host_ecdsa_key/g' /etc/ssh/sshd_config\nRUN sed -ir 's/#HostKey \\/etc\\/ssh\\/ssh_host_ed25519_key/HostKey \\/etc\\/ssh\\/ssh_host_ed25519_key/g' /etc/ssh/sshd_config\nRUN printf \"\\nClientAliveInterval 15\\nClientAliveCountMax 8\" >> /etc/ssh/sshd_config\nRUN /usr/bin/ssh-keygen -A\nRUN ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_key\n#   Add apache to run and configure\nRUN mkdir /run/apache2 \\\n && sed -i \"s/#LoadModule\\ rewrite_module/LoadModule\\ rewrite_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s/#LoadModule\\ session_module/LoadModule\\ session_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s/#LoadModule\\ session_cookie_module/LoadModule\\ session_cookie_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s/#LoadModule\\ session_crypto_module/LoadModule\\ session_crypto_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s/#LoadModule\\ deflate_module/LoadModule\\ deflate_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s#^DocumentRoot \\\".*#DocumentRoot \\\"/var/www/html\\\"#g\" /etc/apache2/httpd.conf \\\n && sed -i \"s#/var/www/localhost/htdocs#/var/www/html#\" /etc/apache2/httpd.conf \\\n && printf \"\\n<Directory \\\"/var/www/html\\\">\\n\\tAllowOverride All\\n</Directory>\\n\" >> /etc/apache2/httpd.conf\n#   add flag\nARG username\nENV username=\"${username}\"\n#   create user\nRUN adduser -D -u 1000 $username\n#   create webroot directory\nRUN mkdir -p /var/www/html\n#   add challs\nCOPY challs /var/www/html\n#   remove README.md\nRUN rm -f /var/www/html/README.md\n#   change ownership and mode\nRUN chown -R root:$username /var/www/html/* \\\n && chmod -R 775 /var/www/html/* \\\n && mkdir bootstrap\nRUN chown -R apache:apache /var/www/html/sqlite\nRUN chown -R apache:apache /var/www/html/assets\nRUN chown -R apache:apache /var/www/html/runtime\n#   composer install\nWORKDIR /var/www/html\nRUN composer install --no-dev\n#   store\nARG flag\nARG flag_name\nARG password\nENV flag=\"${flag}\"\nENV flag_name=\"${flag_name}\"\nENV password=\"${password}\"\nRUN echo \"$username:$password\" | chpasswd\n#   store and securing flag\nRUN echo $flag > /var/www/html/flag/$flag_name\nRUN sed -i \"s/flag.txt/$flag_name/g\" /var/www/html/views/site/index.php\nRUN chown -R root:root /var/www/html/flag \\\n && chmod -R 755 /var/www/html/flag\n#  bootstrap\nCOPY start.sh /bootstrap/\nRUN chmod +x /bootstrap/start.sh\nEXPOSE 80/tcp 22/tcp\nENTRYPOINT [\"/bootstrap/start.sh\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM alpine:edge\nMAINTAINER Paul Smith <pa.ulsmith.net>\n#  Add repos\nRUN echo \"http://dl-cdn.alpinelinux.org/alpine/edge/testing\" >> /etc/apk/repositories\n#  Add basics first\nRUN apk update \\\n && apk upgrade \\\n && apk add bash apache2 php5-apache2 curl ca-certificates openssl git php5 php5-phar php5-json php5-iconv php5-openssl tzdata openntpd vim nano\n#  Setup apache and php\nRUN apk add php5-ftp php5-mcrypt php5-soap php5-gmp php5-pdo_odbc php5-dom php5-pdo php5-zip php5-mysqli php5-sqlite3 php5-pdo_pgsql php5-bcmath php5-gd php5-odbc php5-pdo_mysql php5-pdo_sqlite php5-gettext php5-xmlrpc php5-bz2 php5-pdo_dblib php5-curl php5-ctype sqlite rsync pwgen netcat-openbsd \\\n && cp /usr/bin/php5 /usr/bin/php \\\n && rm -f /var/cache/apk/*\n#  Add Composer\nRUN curl -sS https://getcomposer.org/installer | php \\\n && mv composer.phar /usr/local/bin/composer\n#  enabling SSH\nRUN apk --update add --no-cache openssh \\\n && sed -i s/#PermitRootLogin.*/PermitRootLogin yes/ /etc/ssh/sshd_config \\\n && echo \"root:THISISNOTFORLOGIN102i3709123\" | chpasswd \\\n && rm -rf /var/cache/apk/*\nRUN sed -ie 's/#Port 22/Port 22/g' /etc/ssh/sshd_config\nRUN sed -ri 's/#HostKey \\/etc\\/ssh\\/ssh_host_key/HostKey \\/etc\\/ssh\\/ssh_host_key/g' /etc/ssh/sshd_config\nRUN sed -ir 's/#HostKey \\/etc\\/ssh\\/ssh_host_rsa_key/HostKey \\/etc\\/ssh\\/ssh_host_rsa_key/g' /etc/ssh/sshd_config\nRUN sed -ir 's/#HostKey \\/etc\\/ssh\\/ssh_host_dsa_key/HostKey \\/etc\\/ssh\\/ssh_host_dsa_key/g' /etc/ssh/sshd_config\nRUN sed -ir 's/#HostKey \\/etc\\/ssh\\/ssh_host_ecdsa_key/HostKey \\/etc\\/ssh\\/ssh_host_ecdsa_key/g' /etc/ssh/sshd_config\nRUN sed -ir 's/#HostKey \\/etc\\/ssh\\/ssh_host_ed25519_key/HostKey \\/etc\\/ssh\\/ssh_host_ed25519_key/g' /etc/ssh/sshd_config\nRUN printf \"\\nClientAliveInterval 15\\nClientAliveCountMax 8\" >> /etc/ssh/sshd_config\nRUN /usr/bin/ssh-keygen -A\nRUN ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_key\n#  Add apache to run and configure\nRUN mkdir /run/apache2 \\\n && sed -i \"s/#LoadModule\\ rewrite_module/LoadModule\\ rewrite_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s/#LoadModule\\ session_module/LoadModule\\ session_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s/#LoadModule\\ session_cookie_module/LoadModule\\ session_cookie_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s/#LoadModule\\ session_crypto_module/LoadModule\\ session_crypto_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s/#LoadModule\\ deflate_module/LoadModule\\ deflate_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s#^DocumentRoot \\\".*#DocumentRoot \\\"/var/www/html\\\"#g\" /etc/apache2/httpd.conf \\\n && sed -i \"s#/var/www/localhost/htdocs#/var/www/html#\" /etc/apache2/httpd.conf \\\n && printf \"\\n<Directory \\\"/var/www/html\\\">\\n\\tAllowOverride All\\n</Directory>\\n\" >> /etc/apache2/httpd.conf\n#  add flag\nARG username\nENV username=\"${username}\"\n#  create user\nRUN adduser -D -u 1000 $username\n#  create webroot directory\nRUN mkdir -p /var/www/html\n#  add challs\nADD challs /var/www/html\n#  remove README.md\nRUN rm -f /var/www/html/README.md\n#  change ownership and mode\nRUN chown -R root:$username /var/www/html/* \\\n && chmod -R 775 /var/www/html/* \\\n && mkdir bootstrap\nRUN chown -R apache:apache /var/www/html/sqlite\nRUN chown -R apache:apache /var/www/html/assets\nRUN chown -R apache:apache /var/www/html/runtime\n#  composer install\nWORKDIR /var/www/html\nRUN composer install --no-dev\n#  store\nARG flag\nARG flag_name\nARG password\nENV flag=\"${flag}\"\nENV flag_name=\"${flag_name}\"\nENV password=\"${password}\"\nRUN echo \"$username:$password\" | chpasswd\n#  store and securing flag\nRUN echo $flag > /var/www/html/flag/$flag_name\nRUN sed -i \"s/flag.txt/$flag_name/g\" /var/www/html/views/site/index.php\nRUN chown -R root:root /var/www/html/flag \\\n && chmod -R 755 /var/www/html/flag\n# bootstrap\nADD start.sh /bootstrap/\nRUN chmod +x /bootstrap/start.sh\nEXPOSE 80/tcp 22/tcp\nENTRYPOINT [\"/bootstrap/start.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"0b6ed3a82f6fd9a54d7d801670e8bfbc","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM alpine:edge\nMAINTAINER Paul Smith <pa.ulsmith.net>\n#   Add repos\nRUN echo \"http://dl-cdn.alpinelinux.org/alpine/edge/testing\" >> /etc/apk/repositories\n#   Add basics first\nRUN apk update \\\n && apk upgrade \\\n && apk add bash apache2 php5-apache2 curl ca-certificates openssl git php5 php5-phar php5-json php5-iconv php5-openssl tzdata openntpd vim nano\n#   Setup apache and php\nRUN apk add php5-ftp php5-mcrypt php5-soap php5-gmp php5-pdo_odbc php5-dom php5-pdo php5-zip php5-mysqli php5-sqlite3 php5-pdo_pgsql php5-bcmath php5-gd php5-odbc php5-pdo_mysql php5-pdo_sqlite php5-gettext php5-xmlrpc php5-bz2 php5-pdo_dblib php5-curl php5-ctype sqlite rsync pwgen netcat-openbsd \\\n && cp /usr/bin/php5 /usr/bin/php \\\n && rm -f /var/cache/apk/*\n#   Add Composer\nRUN curl -sS https://getcomposer.org/installer | php \\\n && mv composer.phar /usr/local/bin/composer\n#   enabling SSH\nRUN apk --update add --no-cache openssh \\\n && sed -i s/#PermitRootLogin.*/PermitRootLogin yes/ /etc/ssh/sshd_config \\\n && echo \"root:THISISNOTFORLOGIN102i3709123\" | chpasswd \\\n && rm -rf /var/cache/apk/*\nRUN sed -ie 's/#Port 22/Port 22/g' /etc/ssh/sshd_config\nRUN sed -ri 's/#HostKey \\/etc\\/ssh\\/ssh_host_key/HostKey \\/etc\\/ssh\\/ssh_host_key/g' /etc/ssh/sshd_config\nRUN sed -ir 's/#HostKey \\/etc\\/ssh\\/ssh_host_rsa_key/HostKey \\/etc\\/ssh\\/ssh_host_rsa_key/g' /etc/ssh/sshd_config\nRUN sed -ir 's/#HostKey \\/etc\\/ssh\\/ssh_host_dsa_key/HostKey \\/etc\\/ssh\\/ssh_host_dsa_key/g' /etc/ssh/sshd_config\nRUN sed -ir 's/#HostKey \\/etc\\/ssh\\/ssh_host_ecdsa_key/HostKey \\/etc\\/ssh\\/ssh_host_ecdsa_key/g' /etc/ssh/sshd_config\nRUN sed -ir 's/#HostKey \\/etc\\/ssh\\/ssh_host_ed25519_key/HostKey \\/etc\\/ssh\\/ssh_host_ed25519_key/g' /etc/ssh/sshd_config\nRUN printf \"\\nClientAliveInterval 15\\nClientAliveCountMax 8\" >> /etc/ssh/sshd_config\nRUN /usr/bin/ssh-keygen -A\nRUN ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_key\n#   Add apache to run and configure\nRUN mkdir /run/apache2 \\\n && sed -i \"s/#LoadModule\\ rewrite_module/LoadModule\\ rewrite_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s/#LoadModule\\ session_module/LoadModule\\ session_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s/#LoadModule\\ session_cookie_module/LoadModule\\ session_cookie_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s/#LoadModule\\ session_crypto_module/LoadModule\\ session_crypto_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s/#LoadModule\\ deflate_module/LoadModule\\ deflate_module/\" /etc/apache2/httpd.conf \\\n && sed -i \"s#^DocumentRoot \\\".*#DocumentRoot \\\"/var/www/html\\\"#g\" /etc/apache2/httpd.conf \\\n && sed -i \"s#/var/www/localhost/htdocs#/var/www/html#\" /etc/apache2/httpd.conf \\\n && printf \"\\n<Directory \\\"/var/www/html\\\">\\n\\tAllowOverride All\\n</Directory>\\n\" >> /etc/apache2/httpd.conf\n#   add flag\nARG username\nENV username=\"${username}\"\n#   create user\nRUN adduser -D -u 1000 $username\n#   create webroot directory\nRUN mkdir -p /var/www/html\n#   add challs\nADD challs /var/www/html\n#   remove README.md\nRUN rm -f /var/www/html/README.md\n#   change ownership and mode\nRUN chown -R root:$username /var/www/html/* \\\n && chmod -R 775 /var/www/html/* \\\n && mkdir bootstrap\nRUN chown -R apache:apache /var/www/html/sqlite\nRUN chown -R apache:apache /var/www/html/assets\nRUN chown -R apache:apache /var/www/html/runtime\n#   composer install\nWORKDIR /var/www/html\nRUN composer install --no-dev\n#   store\nARG flag\nARG flag_name\nARG password\nENV flag=\"${flag}\"\nENV flag_name=\"${flag_name}\"\nENV password=\"${password}\"\nRUN echo \"$username:$password\" | chpasswd\n#   store and securing flag\nRUN echo $flag > /var/www/html/flag/$flag_name\nRUN sed -i \"s/flag.txt/$flag_name/g\" /var/www/html/views/site/index.php\nRUN chown -R root:root /var/www/html/flag \\\n && chmod -R 755 /var/www/html/flag\n#  bootstrap\nADD start.sh /bootstrap/\nRUN chmod +x /bootstrap/start.sh\nEXPOSE 80/tcp 22/tcp\nENTRYPOINT [\"/bootstrap/start.sh\"]\n","originalDockerfileUglifiedHash":"15307ee3e210398eaa23cc240d4794de","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/1933b9a1ce1540a912e84f72607dbac554769050.dockerfile"}