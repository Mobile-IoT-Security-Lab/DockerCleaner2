{"seed":3124087545,"processedDockerfileHash":"0e2cbbf2aeddc81642a16b0685893604","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   Base java image\n#   Version 3.7 because on 3.8 Python could not find a version that satisfies the requirement cffi!=1.11.3,>=1.8\nFROM openjdk:alpine3.7\n#   Set environment\nENV NIFI_VERSION=\"1.7.0\"\nENV GLIBC_VERSION=\"2.25-r0\"\n#   Install required packages\nRUN apk add ca-certificates=20190108-r0 wget=1.20.3-r0 bash=4.4.19-r1 java-snappy=1.1.2.6-r1 --update --no-cache \\\n && update-ca-certificates\n#   Download nifi\nRUN wget -qO- https://archive.apache.org/dist/nifi/$NIFI_VERSION/nifi-$NIFI_VERSION-bin.tar.gz | tar -xz \\\n && mv nifi-$NIFI_VERSION /usr \\\n && mv /usr/nifi-$NIFI_VERSION /usr/nifi\n#   Install glibc\nRUN wget --no-cache -q -O /etc/apk/keys/sgerrand.rsa.pub https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub \\\n && wget -q https://github.com/sgerrand/alpine-pkg-glibc/releases/download/$GLIBC_VERSION/glibc-$GLIBC_VERSION.apk \\\n && apk add glibc-$GLIBC_VERSION.apk \\\n && rm glibc-$GLIBC_VERSION.apk\nRUN rm -r /usr/nifi/conf\n#   Link kylo jars\nCOPY dist/ /usr/nifi/kylo\nRUN mkdir -p /usr/nifi/lib/app\nRUN mkdir -p /usr/nifi/dump\n#  ###############################################################################\n#  ###############################################################################\n#  #\n#  #   WARNING !!! WARNING !!! WARNING !!! WARNING !!! WARNING !!! WARNING !!!\n#  #\n#  # When you upgrade to a new version of Kylo or Nifi please double check that\n#  # you are still making symbolic links to the correct version ho the NARs (e.g.\n#  # v1 vs v1.2)\n#  #\n#  #\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-core-service-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-core-service-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-standard-services-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-standard-services-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-core-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-core-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-spark-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-spark-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-spark-service-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-spark-service-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-hadoop-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-hadoop-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-hadoop-service-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-hadoop-service-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-elasticsearch-v1-nar-*.nar /usr/nifi/lib/kylo-nifi-elasticsearch-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-teradata-tdch-nar-*.nar /usr/nifi/lib/kylo-nifi-teradata-tdch-nar.nar\n#   Create links for custom kylo provenance\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-provenance-repo-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-provenance-repo-nar.nar\n#   Create links for custom kylo-spark jars\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-validate-cleanse-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-validate-cleanse-jar-with-dependencies.jar\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-job-profiler-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-job-profiler-jar-with-dependencies.jar\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-interpreter-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-interpreter-jar-with-dependencies.jar\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-merge-table-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-merge-table-jar-with-dependencies.jar\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-multi-exec-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-multi-exec-jar-with-dependencies.jar\n#  #\n#  #\n#  ###############################################################################\n#  ###############################################################################\n#   Create links for Teamdigitale custom processors\nRUN ln -f -s /usr/nifi/kylo/daf/teamdigitale-daf-nifi-processors-*.nar /usr/nifi/lib/teamdigitale-daf-nifi-processors.nar\nRUN mkdir -p /usr/nifi/activemq\nRUN mkdir -p /usr/nifi/drivers\nRUN mkdir -p /usr/nifi/drivers/impala\nRUN mkdir -p /usr/nifi/conf.temp\nRUN wget http://central.maven.org/maven2/org/apache/activemq/activemq-all/5.15.0/activemq-all-5.15.0.jar -P /usr/nifi/activemq/\nRUN wget http://central.maven.org/maven2/org/mariadb/jdbc/mariadb-java-client/2.1.0/mariadb-java-client-2.1.0.jar -P /usr/nifi/drivers/\n#  download Impala JDBC driver\nRUN wget -q https://downloads.cloudera.com/connectors/impala_jdbc_2.5.42.1062.zip\nRUN unzip impala_jdbc_2.5.42.1062.zip\nRUN unzip ClouderaImpalaJDBC-2.5.42.1062/ClouderaImpalaJDBC4_2.5.42.zip\nRUN mv ClouderaImpalaJDBC4_2.5.42/* /usr/nifi/drivers/impala\n#   Expose default nifi port\nEXPOSE 8080/tcp\nRUN apk update\nRUN apk add krb5-libs=1.15.4-r0 krb5=1.15.4-r0 krb5-dev=1.15.4-r0 sudo=1.8.21_p2-r1 coreutils=8.28-r0 python cyrus-sasl=2.1.26-r11 alpine-sdk=0.5-r0 libsasl=2.1.26-r11 libffi-dev=3.2.1-r4 openssl-dev=1.0.2t-r0 cyrus-sasl-dev=2.1.26-r11 --no-cache \\\n && apk add python3=3.6.9-r1 python3-dev=3.6.9-r1 --no-cache \\\n && python3 -m ensurepip \\\n && rm -r /usr/lib/python*/ensurepip \\\n && pip3 install --upgrade pip setuptools thrift_sasl==0.2.1 sasl impyla hdfs polling requests_kerberos\nCOPY scripts/ /scripts\nRUN chmod a+x /scripts/*\n#   Start nifi\nCMD /scripts/setup.sh ; /usr/nifi/bin/nifi.sh run\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  Base java image\n#  Version 3.7 because on 3.8 Python could not find a version that satisfies the requirement cffi!=1.11.3,>=1.8\nFROM openjdk:alpine3.7\n#  Set environment\nENV NIFI_VERSION=\"1.7.0\"\nENV GLIBC_VERSION=\"2.25-r0\"\n#  Install required packages\nRUN apk add --update --no-cache ca-certificates wget bash java-snappy \\\n && update-ca-certificates\n#  Download nifi\nRUN wget -qO- https://archive.apache.org/dist/nifi/$NIFI_VERSION/nifi-$NIFI_VERSION-bin.tar.gz | tar -xz \\\n && mv nifi-$NIFI_VERSION /usr \\\n && mv /usr/nifi-$NIFI_VERSION /usr/nifi\n#  Install glibc\nRUN wget --no-cache -q -O /etc/apk/keys/sgerrand.rsa.pub https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub \\\n && wget -q https://github.com/sgerrand/alpine-pkg-glibc/releases/download/$GLIBC_VERSION/glibc-$GLIBC_VERSION.apk \\\n && apk add glibc-$GLIBC_VERSION.apk \\\n && rm glibc-$GLIBC_VERSION.apk\nRUN rm -r /usr/nifi/conf\n#  Link kylo jars\nADD dist/ /usr/nifi/kylo\nRUN mkdir -p /usr/nifi/lib/app\nRUN mkdir -p /usr/nifi/dump\n# ###############################################################################\n# ###############################################################################\n# #\n# #   WARNING !!! WARNING !!! WARNING !!! WARNING !!! WARNING !!! WARNING !!!\n# #\n# # When you upgrade to a new version of Kylo or Nifi please double check that\n# # you are still making symbolic links to the correct version ho the NARs (e.g.\n# # v1 vs v1.2)\n# #\n# #\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-core-service-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-core-service-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-standard-services-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-standard-services-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-core-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-core-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-spark-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-spark-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-spark-service-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-spark-service-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-hadoop-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-hadoop-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-hadoop-service-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-hadoop-service-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-elasticsearch-v1-nar-*.nar /usr/nifi/lib/kylo-nifi-elasticsearch-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-teradata-tdch-nar-*.nar /usr/nifi/lib/kylo-nifi-teradata-tdch-nar.nar\n#  Create links for custom kylo provenance\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-provenance-repo-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-provenance-repo-nar.nar\n#  Create links for custom kylo-spark jars\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-validate-cleanse-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-validate-cleanse-jar-with-dependencies.jar\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-job-profiler-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-job-profiler-jar-with-dependencies.jar\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-interpreter-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-interpreter-jar-with-dependencies.jar\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-merge-table-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-merge-table-jar-with-dependencies.jar\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-multi-exec-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-multi-exec-jar-with-dependencies.jar\n# #\n# #\n# ###############################################################################\n# ###############################################################################\n#  Create links for Teamdigitale custom processors\nRUN ln -f -s /usr/nifi/kylo/daf/teamdigitale-daf-nifi-processors-*.nar /usr/nifi/lib/teamdigitale-daf-nifi-processors.nar\nRUN mkdir -p /usr/nifi/activemq\nRUN mkdir -p /usr/nifi/drivers\nRUN mkdir -p /usr/nifi/drivers/impala\nRUN mkdir -p /usr/nifi/conf.temp\nRUN wget http://central.maven.org/maven2/org/apache/activemq/activemq-all/5.15.0/activemq-all-5.15.0.jar -P /usr/nifi/activemq/\nRUN wget http://central.maven.org/maven2/org/mariadb/jdbc/mariadb-java-client/2.1.0/mariadb-java-client-2.1.0.jar -P /usr/nifi/drivers/\n# download Impala JDBC driver\nRUN wget -q https://downloads.cloudera.com/connectors/impala_jdbc_2.5.42.1062.zip\nRUN unzip impala_jdbc_2.5.42.1062.zip\nRUN unzip ClouderaImpalaJDBC-2.5.42.1062/ClouderaImpalaJDBC4_2.5.42.zip\nRUN mv ClouderaImpalaJDBC4_2.5.42/* /usr/nifi/drivers/impala\n#  Expose default nifi port\nEXPOSE 8080/tcp\nRUN apk update\nRUN apk add --no-cache krb5-libs krb5 krb5-dev sudo coreutils python cyrus-sasl alpine-sdk libsasl libffi-dev openssl-dev cyrus-sasl-dev \\\n && apk add --no-cache python3 python3-dev \\\n && python3 -m ensurepip \\\n && rm -r /usr/lib/python*/ensurepip \\\n && pip3 install --upgrade pip setuptools thrift_sasl==0.2.1 sasl impyla hdfs polling requests_kerberos\nADD scripts/ /scripts\nRUN chmod a+x /scripts/*\n#  Start nifi\nCMD /scripts/setup.sh ; /usr/nifi/bin/nifi.sh run\n","injectedSmells":[],"originalDockerfileHash":"a7960f2c069e3dca08c139c9ba35caf9","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   Base java image\n#   Version 3.7 because on 3.8 Python could not find a version that satisfies the requirement cffi!=1.11.3,>=1.8\nFROM openjdk:alpine3.7\n#   Set environment\nENV NIFI_VERSION=\"1.7.0\"\nENV GLIBC_VERSION=\"2.25-r0\"\n#   Install required packages\nRUN apk add --update --no-cache ca-certificates wget bash java-snappy \\\n && update-ca-certificates\n#   Download nifi\nRUN wget -qO- https://archive.apache.org/dist/nifi/$NIFI_VERSION/nifi-$NIFI_VERSION-bin.tar.gz | tar -xz \\\n && mv nifi-$NIFI_VERSION /usr \\\n && mv /usr/nifi-$NIFI_VERSION /usr/nifi\n#   Install glibc\nRUN wget --no-cache -q -O /etc/apk/keys/sgerrand.rsa.pub https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub \\\n && wget -q https://github.com/sgerrand/alpine-pkg-glibc/releases/download/$GLIBC_VERSION/glibc-$GLIBC_VERSION.apk \\\n && apk add glibc-$GLIBC_VERSION.apk \\\n && rm glibc-$GLIBC_VERSION.apk\nRUN rm -r /usr/nifi/conf\n#   Link kylo jars\nADD dist/ /usr/nifi/kylo\nRUN mkdir -p /usr/nifi/lib/app\nRUN mkdir -p /usr/nifi/dump\n#  ###############################################################################\n#  ###############################################################################\n#  #\n#  #   WARNING !!! WARNING !!! WARNING !!! WARNING !!! WARNING !!! WARNING !!!\n#  #\n#  # When you upgrade to a new version of Kylo or Nifi please double check that\n#  # you are still making symbolic links to the correct version ho the NARs (e.g.\n#  # v1 vs v1.2)\n#  #\n#  #\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-core-service-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-core-service-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-standard-services-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-standard-services-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-core-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-core-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-spark-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-spark-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-spark-service-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-spark-service-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-hadoop-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-hadoop-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-hadoop-service-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-hadoop-service-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-elasticsearch-v1-nar-*.nar /usr/nifi/lib/kylo-nifi-elasticsearch-nar.nar\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-teradata-tdch-nar-*.nar /usr/nifi/lib/kylo-nifi-teradata-tdch-nar.nar\n#   Create links for custom kylo provenance\nRUN ln -f -s /usr/nifi/kylo/kylo-nifi-provenance-repo-v1.2-nar-*.nar /usr/nifi/lib/kylo-nifi-provenance-repo-nar.nar\n#   Create links for custom kylo-spark jars\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-validate-cleanse-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-validate-cleanse-jar-with-dependencies.jar\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-job-profiler-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-job-profiler-jar-with-dependencies.jar\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-interpreter-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-interpreter-jar-with-dependencies.jar\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-merge-table-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-merge-table-jar-with-dependencies.jar\nRUN ln -f -s /usr/nifi/kylo/kylo-spark-multi-exec-v2-*-jar-with-dependencies.jar /usr/nifi/lib/app/kylo-spark-multi-exec-jar-with-dependencies.jar\n#  #\n#  #\n#  ###############################################################################\n#  ###############################################################################\n#   Create links for Teamdigitale custom processors\nRUN ln -f -s /usr/nifi/kylo/daf/teamdigitale-daf-nifi-processors-*.nar /usr/nifi/lib/teamdigitale-daf-nifi-processors.nar\nRUN mkdir -p /usr/nifi/activemq\nRUN mkdir -p /usr/nifi/drivers\nRUN mkdir -p /usr/nifi/drivers/impala\nRUN mkdir -p /usr/nifi/conf.temp\nRUN wget http://central.maven.org/maven2/org/apache/activemq/activemq-all/5.15.0/activemq-all-5.15.0.jar -P /usr/nifi/activemq/\nRUN wget http://central.maven.org/maven2/org/mariadb/jdbc/mariadb-java-client/2.1.0/mariadb-java-client-2.1.0.jar -P /usr/nifi/drivers/\n#  download Impala JDBC driver\nRUN wget -q https://downloads.cloudera.com/connectors/impala_jdbc_2.5.42.1062.zip\nRUN unzip impala_jdbc_2.5.42.1062.zip\nRUN unzip ClouderaImpalaJDBC-2.5.42.1062/ClouderaImpalaJDBC4_2.5.42.zip\nRUN mv ClouderaImpalaJDBC4_2.5.42/* /usr/nifi/drivers/impala\n#   Expose default nifi port\nEXPOSE 8080/tcp\nRUN apk update\nRUN apk add --no-cache krb5-libs krb5 krb5-dev sudo coreutils python cyrus-sasl alpine-sdk libsasl libffi-dev openssl-dev cyrus-sasl-dev \\\n && apk add --no-cache python3 python3-dev \\\n && python3 -m ensurepip \\\n && rm -r /usr/lib/python*/ensurepip \\\n && pip3 install --upgrade pip setuptools thrift_sasl==0.2.1 sasl impyla hdfs polling requests_kerberos\nADD scripts/ /scripts\nRUN chmod a+x /scripts/*\n#   Start nifi\nCMD /scripts/setup.sh ; /usr/nifi/bin/nifi.sh run\n","originalDockerfileUglifiedHash":"c7232d7e7d6f0baa2ee6938a69a2e532","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/efe5bcbf3a8b26a0b3fc828a46a2c6ccf4f7fa80.dockerfile"}