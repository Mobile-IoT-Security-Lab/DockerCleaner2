{"seed":1775334584,"processedDockerfileHash":"bb44973b0e976da7c1e93e40c1cea282","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM cassandra:3.11\n#   install wget, for the custom metrics-graphite reporter\n#  RUN set -x \\\n#      && apt-get update \\\n#          && apt-get install -y --no-install-recommends \\\n#              wget \\\n#          && rm -rf /var/lib/apt/lists/*\n#   install the custom metrics-graphite reporter, to allow measurement filtering\n#  RUN echo \"JVM_OPTS=\\\"\\$JVM_OPTS -Dcassandra.metricsReporterConfigFile=graphite.yaml\\\"\" >> /etc/cassandra/cassandra-env.sh\n#  RUN wget -P /usr/share/cassandra/lib/ \\\n#          http://central.maven.org/maven2/net/java/dev/jna/jna/4.0.0/jna-4.0.0.jar\n#  RUN rm /usr/share/cassandra/lib/metrics-core-3.1.0.jar \\\n#      /usr/share/cassandra/lib/reporter-config-base-3.0.0.jar \\\n#      /usr/share/cassandra/lib/reporter-config3-3.0.0.jar\n#  COPY lib/metrics-core-3.1.2.jar \\\n#      lib/metrics-graphite-3.1.2.jar \\\n#      lib/reporter-config-base-3.0.3.jar \\\n#      lib/reporter-config3-3.0.3.jar \\\n#      /usr/share/cassandra/lib/\n#   install Java 8, which is required for the custom metrics reporter used above\n#  RUN set -x \\\n#      && echo \"deb http://ppa.launchpad.net/webupd8team/java/ubuntu xenial main\" \\\n#          | tee /etc/apt/sources.list.d/webupd8team-java.list \\\n#      && echo \"deb-src http://ppa.launchpad.net/webupd8team/java/ubuntu xenial main\" \\\n#          | tee -a /etc/apt/sources.list.d/webupd8team-java.list \\\n#      && apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys EEA14886 \\\n#      && apt-get update \\\n#      && echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true \\\n#          | /usr/bin/debconf-set-selections \\\n#      && apt-get install -y \\\n#          oracle-java8-installer \\\n#          oracle-java8-set-default\n#   install filebeat for Logstash ingestion\n#  ENV ELK_VERSION 5.3.0\n#  ENV DOWNLOAD_URL https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-${ELK_VERSION}-amd64.deb\n#  RUN set -x \\\n#      && apt-get update \\\n#          && apt-get install -y --no-install-recommends \\\n#              curl \\\n#          && rm -rf /var/lib/apt/lists/* \\\n#      && curl -L -O ${DOWNLOAD_URL} \\\n#          && dpkg -i filebeat-${ELK_VERSION}-amd64.deb \\\n#          && rm filebeat-${ELK_VERSION}-amd64.deb \\\n#      && update-rc.d filebeat defaults 95 10 \\\n#      && echo \"/etc/init.d/filebeat start\" \\\n#          >> /etc/cassandra/cassandra-env.sh \\\n#  \t&& apt-get purge -y --auto-remove \\\n#  \t    curl\n#  RUN mkdir \\\n#          /var/lib/filebeat \\\n#          /var/log/filebeat \\\n#      && touch /var/run/filebeat.pid \\\n#      && chown cassandra:cassandra \\\n#          /var/lib/filebeat \\\n#          /var/log/filebeat \\\n#          /var/run/filebeat.pid\n#   install collectd\n#   NOTE: jessie packages are now being included since librrd4 and\n#   libmicrohttpd10 were missing from the stretch repos\nRUN set -x \\\n && echo \"deb http://pkg.ci.collectd.org/deb jessie collectd-5.7\" > /etc/apt/sources.list.d/pkg.ci.collectd.org.list \\\n && gpg --keyserver hkp://pgp.mit.edu:80 --recv-keys 3994D24FB8543576 \\\n && gpg --export -a 3994D24FB8543576 | apt-key add - \\\n && apt-get update \\\n && apt-get install --no-install-recommends collectd=5.7.1-1.1 collectd-utils libprotobuf-c-dev libmicrohttpd-dev -y \\\n && echo \"deb http://deb.debian.org/debian jessie main\" >> /etc/apt/sources.list.d/pkg.ci.collectd.org.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends librrd4 libmicrohttpd10 -y \\\n && rm -rf /var/lib/apt/lists/*\nRUN touch /var/log/collectd.log \\\n && chown cassandra:cassandra /var/log/collectd.log\n#   install Prometheus JMX exporter\n#   NOTE: 0.10 will not work until this issue is resolved:\n#         https://github.com/prometheus/jmx_exporter/issues/170\nENV JMX_EXPORTER_VERSION=\"0.9\"\nCOPY lib/jmx_prometheus_javaagent-${JMX_EXPORTER_VERSION}.jar /prometheus/\nRUN echo 'JVM_OPTS=\"$JVM_OPTS -javaagent:'/prometheus/jmx_prometheus_javaagent-${JMX_EXPORTER_VERSION}.jar=7070:/prometheus/prometheus.yml'\"' | tee -a /etc/cassandra/cassandra-env.sh\n#   add JMX authentication files for Reaper access\nCOPY config/jmxremote.access /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/management/jmxremote.access\nCOPY config/jmxremote.password /etc/cassandra/jmxremote.password\nRUN chown cassandra:cassandra /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/management/jmxremote.access /etc/cassandra/jmxremote.password \\\n && chmod 600 /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/management/jmxremote.access /etc/cassandra/jmxremote.password\n#   overwrite the base docker-entrypoint.sh with modified one, for filebeat perms\nCOPY docker-entrypoint.sh /docker-entrypoint.sh\n#   does not work for some reason\n#  RUN echo \"exec service collectd start &\" \\\n#      >> /etc/cassandra/cassandra-env.sh\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM cassandra:3.11\n#  install wget, for the custom metrics-graphite reporter\n# RUN set -x \\\n#     && apt-get update \\\n#         && apt-get install -y --no-install-recommends \\\n#             wget \\\n#         && rm -rf /var/lib/apt/lists/*\n#  install the custom metrics-graphite reporter, to allow measurement filtering\n# RUN echo \"JVM_OPTS=\\\"\\$JVM_OPTS -Dcassandra.metricsReporterConfigFile=graphite.yaml\\\"\" >> /etc/cassandra/cassandra-env.sh\n# RUN wget -P /usr/share/cassandra/lib/ \\\n#         http://central.maven.org/maven2/net/java/dev/jna/jna/4.0.0/jna-4.0.0.jar\n# RUN rm /usr/share/cassandra/lib/metrics-core-3.1.0.jar \\\n#     /usr/share/cassandra/lib/reporter-config-base-3.0.0.jar \\\n#     /usr/share/cassandra/lib/reporter-config3-3.0.0.jar\n# COPY lib/metrics-core-3.1.2.jar \\\n#     lib/metrics-graphite-3.1.2.jar \\\n#     lib/reporter-config-base-3.0.3.jar \\\n#     lib/reporter-config3-3.0.3.jar \\\n#     /usr/share/cassandra/lib/\n#  install Java 8, which is required for the custom metrics reporter used above\n# RUN set -x \\\n#     && echo \"deb http://ppa.launchpad.net/webupd8team/java/ubuntu xenial main\" \\\n#         | tee /etc/apt/sources.list.d/webupd8team-java.list \\\n#     && echo \"deb-src http://ppa.launchpad.net/webupd8team/java/ubuntu xenial main\" \\\n#         | tee -a /etc/apt/sources.list.d/webupd8team-java.list \\\n#     && apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys EEA14886 \\\n#     && apt-get update \\\n#     && echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true \\\n#         | /usr/bin/debconf-set-selections \\\n#     && apt-get install -y \\\n#         oracle-java8-installer \\\n#         oracle-java8-set-default\n#  install filebeat for Logstash ingestion\n# ENV ELK_VERSION 5.3.0\n# ENV DOWNLOAD_URL https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-${ELK_VERSION}-amd64.deb\n# RUN set -x \\\n#     && apt-get update \\\n#         && apt-get install -y --no-install-recommends \\\n#             curl \\\n#         && rm -rf /var/lib/apt/lists/* \\\n#     && curl -L -O ${DOWNLOAD_URL} \\\n#         && dpkg -i filebeat-${ELK_VERSION}-amd64.deb \\\n#         && rm filebeat-${ELK_VERSION}-amd64.deb \\\n#     && update-rc.d filebeat defaults 95 10 \\\n#     && echo \"/etc/init.d/filebeat start\" \\\n#         >> /etc/cassandra/cassandra-env.sh \\\n# \t&& apt-get purge -y --auto-remove \\\n# \t    curl\n# RUN mkdir \\\n#         /var/lib/filebeat \\\n#         /var/log/filebeat \\\n#     && touch /var/run/filebeat.pid \\\n#     && chown cassandra:cassandra \\\n#         /var/lib/filebeat \\\n#         /var/log/filebeat \\\n#         /var/run/filebeat.pid\n#  install collectd\n#  NOTE: jessie packages are now being included since librrd4 and\n#  libmicrohttpd10 were missing from the stretch repos\nRUN set -x \\\n && echo \"deb http://pkg.ci.collectd.org/deb jessie collectd-5.7\" > /etc/apt/sources.list.d/pkg.ci.collectd.org.list \\\n && gpg --keyserver hkp://pgp.mit.edu:80 --recv-keys 3994D24FB8543576 \\\n && gpg --export -a 3994D24FB8543576 | apt-key add - \\\n && apt-get update \\\n && apt-get install --no-install-recommends collectd=5.7.1-1.1 collectd-utils libprotobuf-c-dev libmicrohttpd-dev -y \\\n && echo \"deb http://deb.debian.org/debian jessie main\" >> /etc/apt/sources.list.d/pkg.ci.collectd.org.list \\\n && apt-get update \\\n && apt-get install librrd4 libmicrohttpd10 -y \\\n && rm -rf /var/lib/apt/lists/*\nRUN touch /var/log/collectd.log \\\n && chown cassandra:cassandra /var/log/collectd.log\n#  install Prometheus JMX exporter\n#  NOTE: 0.10 will not work until this issue is resolved:\n#        https://github.com/prometheus/jmx_exporter/issues/170\nENV JMX_EXPORTER_VERSION=\"0.9\"\nCOPY lib/jmx_prometheus_javaagent-${JMX_EXPORTER_VERSION}.jar /prometheus/\nRUN echo 'JVM_OPTS=\"$JVM_OPTS -javaagent:'/prometheus/jmx_prometheus_javaagent-${JMX_EXPORTER_VERSION}.jar=7070:/prometheus/prometheus.yml'\"' | tee -a /etc/cassandra/cassandra-env.sh\n#  add JMX authentication files for Reaper access\nCOPY config/jmxremote.access /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/management/jmxremote.access\nCOPY config/jmxremote.password /etc/cassandra/jmxremote.password\nRUN chown cassandra:cassandra /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/management/jmxremote.access /etc/cassandra/jmxremote.password \\\n && chmod 600 /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/management/jmxremote.access /etc/cassandra/jmxremote.password\n#  overwrite the base docker-entrypoint.sh with modified one, for filebeat perms\nCOPY docker-entrypoint.sh /docker-entrypoint.sh\n#  does not work for some reason\n# RUN echo \"exec service collectd start &\" \\\n#     >> /etc/cassandra/cassandra-env.sh\n","injectedSmells":[],"originalDockerfileHash":"752b11941ff990c08e4f9bf469d174b8","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM cassandra:3.11\n#   install wget, for the custom metrics-graphite reporter\n#  RUN set -x \\\n#      && apt-get update \\\n#          && apt-get install -y --no-install-recommends \\\n#              wget \\\n#          && rm -rf /var/lib/apt/lists/*\n#   install the custom metrics-graphite reporter, to allow measurement filtering\n#  RUN echo \"JVM_OPTS=\\\"\\$JVM_OPTS -Dcassandra.metricsReporterConfigFile=graphite.yaml\\\"\" >> /etc/cassandra/cassandra-env.sh\n#  RUN wget -P /usr/share/cassandra/lib/ \\\n#          http://central.maven.org/maven2/net/java/dev/jna/jna/4.0.0/jna-4.0.0.jar\n#  RUN rm /usr/share/cassandra/lib/metrics-core-3.1.0.jar \\\n#      /usr/share/cassandra/lib/reporter-config-base-3.0.0.jar \\\n#      /usr/share/cassandra/lib/reporter-config3-3.0.0.jar\n#  COPY lib/metrics-core-3.1.2.jar \\\n#      lib/metrics-graphite-3.1.2.jar \\\n#      lib/reporter-config-base-3.0.3.jar \\\n#      lib/reporter-config3-3.0.3.jar \\\n#      /usr/share/cassandra/lib/\n#   install Java 8, which is required for the custom metrics reporter used above\n#  RUN set -x \\\n#      && echo \"deb http://ppa.launchpad.net/webupd8team/java/ubuntu xenial main\" \\\n#          | tee /etc/apt/sources.list.d/webupd8team-java.list \\\n#      && echo \"deb-src http://ppa.launchpad.net/webupd8team/java/ubuntu xenial main\" \\\n#          | tee -a /etc/apt/sources.list.d/webupd8team-java.list \\\n#      && apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys EEA14886 \\\n#      && apt-get update \\\n#      && echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true \\\n#          | /usr/bin/debconf-set-selections \\\n#      && apt-get install -y \\\n#          oracle-java8-installer \\\n#          oracle-java8-set-default\n#   install filebeat for Logstash ingestion\n#  ENV ELK_VERSION 5.3.0\n#  ENV DOWNLOAD_URL https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-${ELK_VERSION}-amd64.deb\n#  RUN set -x \\\n#      && apt-get update \\\n#          && apt-get install -y --no-install-recommends \\\n#              curl \\\n#          && rm -rf /var/lib/apt/lists/* \\\n#      && curl -L -O ${DOWNLOAD_URL} \\\n#          && dpkg -i filebeat-${ELK_VERSION}-amd64.deb \\\n#          && rm filebeat-${ELK_VERSION}-amd64.deb \\\n#      && update-rc.d filebeat defaults 95 10 \\\n#      && echo \"/etc/init.d/filebeat start\" \\\n#          >> /etc/cassandra/cassandra-env.sh \\\n#  \t&& apt-get purge -y --auto-remove \\\n#  \t    curl\n#  RUN mkdir \\\n#          /var/lib/filebeat \\\n#          /var/log/filebeat \\\n#      && touch /var/run/filebeat.pid \\\n#      && chown cassandra:cassandra \\\n#          /var/lib/filebeat \\\n#          /var/log/filebeat \\\n#          /var/run/filebeat.pid\n#   install collectd\n#   NOTE: jessie packages are now being included since librrd4 and\n#   libmicrohttpd10 were missing from the stretch repos\nRUN set -x \\\n && echo \"deb http://pkg.ci.collectd.org/deb jessie collectd-5.7\" > /etc/apt/sources.list.d/pkg.ci.collectd.org.list \\\n && gpg --keyserver hkp://pgp.mit.edu:80 --recv-keys 3994D24FB8543576 \\\n && gpg --export -a 3994D24FB8543576 | apt-key add - \\\n && apt-get update \\\n && apt-get install --no-install-recommends collectd=5.7.1-1.1 collectd-utils libprotobuf-c-dev libmicrohttpd-dev -y \\\n && echo \"deb http://deb.debian.org/debian jessie main\" >> /etc/apt/sources.list.d/pkg.ci.collectd.org.list \\\n && apt-get update \\\n && apt-get install librrd4 libmicrohttpd10 -y \\\n && rm -rf /var/lib/apt/lists/*\nRUN touch /var/log/collectd.log \\\n && chown cassandra:cassandra /var/log/collectd.log\n#   install Prometheus JMX exporter\n#   NOTE: 0.10 will not work until this issue is resolved:\n#         https://github.com/prometheus/jmx_exporter/issues/170\nENV JMX_EXPORTER_VERSION=\"0.9\"\nCOPY lib/jmx_prometheus_javaagent-${JMX_EXPORTER_VERSION}.jar /prometheus/\nRUN echo 'JVM_OPTS=\"$JVM_OPTS -javaagent:'/prometheus/jmx_prometheus_javaagent-${JMX_EXPORTER_VERSION}.jar=7070:/prometheus/prometheus.yml'\"' | tee -a /etc/cassandra/cassandra-env.sh\n#   add JMX authentication files for Reaper access\nCOPY config/jmxremote.access /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/management/jmxremote.access\nCOPY config/jmxremote.password /etc/cassandra/jmxremote.password\nRUN chown cassandra:cassandra /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/management/jmxremote.access /etc/cassandra/jmxremote.password \\\n && chmod 600 /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/management/jmxremote.access /etc/cassandra/jmxremote.password\n#   overwrite the base docker-entrypoint.sh with modified one, for filebeat perms\nCOPY docker-entrypoint.sh /docker-entrypoint.sh\n#   does not work for some reason\n#  RUN echo \"exec service collectd start &\" \\\n#      >> /etc/cassandra/cassandra-env.sh\n","originalDockerfileUglifiedHash":"d1efad4aa61feab0a959979bce986248","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/31d231dc756bf057c69df469995eadd53171db93.dockerfile"}