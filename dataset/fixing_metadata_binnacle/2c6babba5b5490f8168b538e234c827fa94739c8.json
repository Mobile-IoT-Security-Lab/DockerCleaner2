{"seed":1212039174,"processedDockerfileHash":"d4b87b9a9032e0e5d2171c761dc85976","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","use-copy-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM ubuntu:14.04\nMAINTAINER Luis Elizondo \"lelizondo@gmail.com\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\n#   Ensure UTF-8\nRUN locale-gen en_US.UTF-8\nENV LANG=\"en_US.UTF-8\"\nENV LC_ALL=\"en_US.UTF-8\"\nENV SMTP_HOST=\"smtp.gmail.com\"\nENV SMTP_PORT=\"587\"\nENV SMTP_FROMNAME=\"My Name\"\nENV SMTP_USERNAME=\"username@example.com\"\n# A secret has been removed here. Please do not provide secrets from the Dockerfile as these will leak into the metadata of the resulting docker image. To provide secrets the --secret flag of the docker build command can be used (https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information).\n#   Update system\nRUN : \\\n && apt-get dist-upgrade -y\n#   Prevent restarts when installing\nRUN echo '#!/bin/sh\\nexit 101' > /usr/sbin/policy-rc.d \\\n && chmod +x /usr/sbin/policy-rc.d\n#   Basic packages\nRUN (apt-get update ;apt-get install --no-install-recommends php5-fpm=5.5.9+dfsg-1ubuntu4.29 php5-mysql=5.5.9+dfsg-1ubuntu4.29 php-apc=4.0.2-2build1 php5-imagick=3.1.2-1build1 php5-imap=5.4.6-0ubuntu5.1 php5-mcrypt=5.4.6-0ubuntu5 php5-curl=5.5.9+dfsg-1ubuntu4.29 php5-cli=5.5.9+dfsg-1ubuntu4.29 php5-gd=5.5.9+dfsg-1ubuntu4.29 php5-pgsql=5.5.9+dfsg-1ubuntu4.29 php5-sqlite=5.5.9+dfsg-1ubuntu4.29 php5-common=5.5.9+dfsg-1ubuntu4.29 php-pear=5.5.9+dfsg-1ubuntu4.29 curl=7.35.0-1ubuntu2.20 php5-json=1.3.2-2build1 php5-redis=2.2.4-1build2 php5-memcache=3.0.8-4build1 -y )\nRUN (apt-get update ;apt-get install --no-install-recommends nginx-extras=1.4.6-1ubuntu3.9 git=1:1.9.1-1ubuntu0.10 curl=7.35.0-1ubuntu2.20 supervisor=3.0b2-1ubuntu0.1 -y )\nRUN (apt-get update ;apt-get install --no-install-recommends msmtp=1.4.31-1 msmtp-mta=1.4.31-1 -y )\nRUN php5enmod mcrypt\nRUN /usr/bin/curl -sS https://getcomposer.org/installer | /usr/bin/php\nRUN /bin/mv composer.phar /usr/local/bin/composer\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#   Install Composer and Drush\nRUN /usr/local/bin/composer self-update\nRUN /usr/local/bin/composer global require drush/drush:6.*\nRUN ln -s /root/.composer/vendor/drush/drush/drush /usr/local/bin/drush\n#   Prepare directory\nRUN mkdir /var/www\nRUN usermod -u 1000 www-data\nRUN usermod -a -G users www-data\nRUN chown -R www-data:www-data /var/www\nEXPOSE 80/tcp\nWORKDIR /var/www\nVOLUME [\"/var/www/sites/default/files\"]\nCMD [\"/usr/bin/supervisord\", \"-n\"]\n#   Startup script\n#   This startup script wll configure nginx\nCOPY ./startup.sh /opt/startup.sh\nRUN chmod +x /opt/startup.sh\nCOPY ./mail.sh /opt/mail.sh\nRUN chmod +x /opt/mail.sh\nCOPY ./cron.sh /opt/cron.sh\nRUN chmod +x /opt/cron.sh\n#   We want it empty\nRUN touch /etc/msmtprc\nRUN chgrp mail /etc/msmtprc\nRUN chmod 660 /etc/msmtprc\nRUN touch /var/log/supervisor/msmtp.log\nRUN chgrp mail /var/log/supervisor/msmtp.log\nRUN chmod 660 /var/log/supervisor/msmtp.log\nRUN adduser www-data mail\nRUN rm /usr/sbin/sendmail\nRUN rm /usr/lib/sendmail\nRUN ln -s /usr/bin/msmtp /usr/sbin/sendmail\nRUN ln -s /usr/bin/msmtp /usr/bin/sendmail\nRUN ln -s /usr/bin/msmtp /usr/lib/sendmail\nRUN mkdir -p /var/cache/nginx/microcache\n#  ## Add configuration files\n#   Supervisor\nCOPY ./config/supervisor/supervisord-nginx.conf /etc/supervisor/conf.d/supervisord-nginx.conf\n#   PHP\nCOPY ./config/php/www.conf /etc/php5/fpm/pool.d/www.conf\nCOPY ./config/php/php.ini /etc/php5/fpm/php.ini\n#   Nginx\nCOPY ./config/nginx/blacklist.conf /etc/nginx/blacklist.conf\nCOPY ./config/nginx/drupal.conf /etc/nginx/drupal.conf\nCOPY ./config/nginx/drupal_upload_progress.conf /etc/nginx/drupal_upload_progress.conf\nCOPY ./config/nginx/fastcgi.conf /etc/nginx/fastcgi.conf\nCOPY ./config/nginx/fastcgi_drupal.conf /etc/nginx/fastcgi_drupal.conf\nCOPY ./config/nginx/fastcgi_microcache_zone.conf /etc/nginx/fastcgi_microcache_zone.conf\nCOPY ./config/nginx/fastcgi_no_args_drupal.conf /etc/nginx/fastcgi_no_args_drupal.conf\nCOPY ./config/nginx/map_cache.conf /etc/nginx/map_cache.conf\nCOPY ./config/nginx/microcache_fcgi.conf /etc/nginx/microcache_fcgi.conf\nCOPY ./config/nginx/microcache_fcgi_auth.conf /etc/nginx/microcache_fcgi_auth.conf\nCOPY ./config/nginx/mime.types /etc/nginx/mime.types\nCOPY ./config/nginx/nginx.conf /etc/nginx/nginx.conf\nCOPY ./config/nginx/upstream_phpcgi_unix.conf /etc/nginx/upstream_phpcgi_unix.conf\nCOPY ./config/nginx/map_block_http_methods.conf /etc/nginx/map_block_http_methods.conf\nCOPY ./config/nginx/map_https_fcgi.conf /etc/nginx/map_https_fcgi.conf\nCOPY ./config/nginx/nginx_status_allowed_hosts.conf /etc/nginx/nginx_status_allowed_hosts.conf\nCOPY ./config/nginx/cron_allowed_hosts.conf /etc/nginx/cron_allowed_hosts.conf\nCOPY ./config/nginx/php_fpm_status_allowed_hosts.conf /etc/nginx/php_fpm_status_allowed_hosts.conf\nCOPY ./config/nginx/default /etc/nginx/sites-enabled/default\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ubuntu:14.04\nMAINTAINER Luis Elizondo \"lelizondo@gmail.com\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\n#  Ensure UTF-8\nRUN locale-gen en_US.UTF-8\nENV LANG=\"en_US.UTF-8\"\nENV LC_ALL=\"en_US.UTF-8\"\nENV SMTP_HOST=\"smtp.gmail.com\"\nENV SMTP_PORT=\"587\"\nENV SMTP_FROMNAME=\"My Name\"\nENV SMTP_USERNAME=\"username@example.com\"\nENV SMTP_PASSWORD=\"secret\"\n#  Update system\nRUN apt-get update \\\n && apt-get dist-upgrade -y\n#  Prevent restarts when installing\nRUN echo '#!/bin/sh\\nexit 101' > /usr/sbin/policy-rc.d \\\n && chmod +x /usr/sbin/policy-rc.d\n#  Basic packages\nRUN apt-get install php5-fpm php5-mysql php-apc php5-imagick php5-imap php5-mcrypt php5-curl php5-cli php5-gd php5-pgsql php5-sqlite php5-common php-pear curl php5-json php5-redis php5-memcache -y\nRUN apt-get install nginx-extras git curl supervisor -y\nRUN apt-get install msmtp msmtp-mta -y\nRUN php5enmod mcrypt\nRUN /usr/bin/curl -sS https://getcomposer.org/installer | /usr/bin/php\nRUN /bin/mv composer.phar /usr/local/bin/composer\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#  Install Composer and Drush\nRUN /usr/local/bin/composer self-update\nRUN /usr/local/bin/composer global require drush/drush:6.*\nRUN ln -s /root/.composer/vendor/drush/drush/drush /usr/local/bin/drush\n#  Prepare directory\nRUN mkdir /var/www\nRUN usermod -u 1000 www-data\nRUN usermod -a -G users www-data\nRUN chown -R www-data:www-data /var/www\nEXPOSE 80/tcp\nWORKDIR /var/www\nVOLUME [\"/var/www/sites/default/files\"]\nCMD [\"/usr/bin/supervisord\", \"-n\"]\n#  Startup script\n#  This startup script wll configure nginx\nADD ./startup.sh /opt/startup.sh\nRUN chmod +x /opt/startup.sh\nADD ./mail.sh /opt/mail.sh\nRUN chmod +x /opt/mail.sh\nADD ./cron.sh /opt/cron.sh\nRUN chmod +x /opt/cron.sh\n#  We want it empty\nRUN touch /etc/msmtprc\nRUN chgrp mail /etc/msmtprc\nRUN chmod 660 /etc/msmtprc\nRUN touch /var/log/supervisor/msmtp.log\nRUN chgrp mail /var/log/supervisor/msmtp.log\nRUN chmod 660 /var/log/supervisor/msmtp.log\nRUN adduser www-data mail\nRUN rm /usr/sbin/sendmail\nRUN rm /usr/lib/sendmail\nRUN ln -s /usr/bin/msmtp /usr/sbin/sendmail\nRUN ln -s /usr/bin/msmtp /usr/bin/sendmail\nRUN ln -s /usr/bin/msmtp /usr/lib/sendmail\nRUN mkdir -p /var/cache/nginx/microcache\n# ## Add configuration files\n#  Supervisor\nADD ./config/supervisor/supervisord-nginx.conf /etc/supervisor/conf.d/supervisord-nginx.conf\n#  PHP\nADD ./config/php/www.conf /etc/php5/fpm/pool.d/www.conf\nADD ./config/php/php.ini /etc/php5/fpm/php.ini\n#  Nginx\nADD ./config/nginx/blacklist.conf /etc/nginx/blacklist.conf\nADD ./config/nginx/drupal.conf /etc/nginx/drupal.conf\nADD ./config/nginx/drupal_upload_progress.conf /etc/nginx/drupal_upload_progress.conf\nADD ./config/nginx/fastcgi.conf /etc/nginx/fastcgi.conf\nADD ./config/nginx/fastcgi_drupal.conf /etc/nginx/fastcgi_drupal.conf\nADD ./config/nginx/fastcgi_microcache_zone.conf /etc/nginx/fastcgi_microcache_zone.conf\nADD ./config/nginx/fastcgi_no_args_drupal.conf /etc/nginx/fastcgi_no_args_drupal.conf\nADD ./config/nginx/map_cache.conf /etc/nginx/map_cache.conf\nADD ./config/nginx/microcache_fcgi.conf /etc/nginx/microcache_fcgi.conf\nADD ./config/nginx/microcache_fcgi_auth.conf /etc/nginx/microcache_fcgi_auth.conf\nADD ./config/nginx/mime.types /etc/nginx/mime.types\nADD ./config/nginx/nginx.conf /etc/nginx/nginx.conf\nADD ./config/nginx/upstream_phpcgi_unix.conf /etc/nginx/upstream_phpcgi_unix.conf\nADD ./config/nginx/map_block_http_methods.conf /etc/nginx/map_block_http_methods.conf\nADD ./config/nginx/map_https_fcgi.conf /etc/nginx/map_https_fcgi.conf\nADD ./config/nginx/nginx_status_allowed_hosts.conf /etc/nginx/nginx_status_allowed_hosts.conf\nADD ./config/nginx/cron_allowed_hosts.conf /etc/nginx/cron_allowed_hosts.conf\nADD ./config/nginx/php_fpm_status_allowed_hosts.conf /etc/nginx/php_fpm_status_allowed_hosts.conf\nADD ./config/nginx/default /etc/nginx/sites-enabled/default\n","injectedSmells":[],"originalDockerfileHash":"2f67ea4d3574022975224167483e4006","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:14.04\nMAINTAINER Luis Elizondo \"lelizondo@gmail.com\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\n#   Ensure UTF-8\nRUN locale-gen en_US.UTF-8\nENV LANG=\"en_US.UTF-8\"\nENV LC_ALL=\"en_US.UTF-8\"\nENV SMTP_HOST=\"smtp.gmail.com\"\nENV SMTP_PORT=\"587\"\nENV SMTP_FROMNAME=\"My Name\"\nENV SMTP_USERNAME=\"username@example.com\"\nENV SMTP_PASSWORD=\"secret\"\n#   Update system\nRUN apt-get update \\\n && apt-get dist-upgrade -y\n#   Prevent restarts when installing\nRUN echo '#!/bin/sh\\nexit 101' > /usr/sbin/policy-rc.d \\\n && chmod +x /usr/sbin/policy-rc.d\n#   Basic packages\nRUN apt-get install php5-fpm php5-mysql php-apc php5-imagick php5-imap php5-mcrypt php5-curl php5-cli php5-gd php5-pgsql php5-sqlite php5-common php-pear curl php5-json php5-redis php5-memcache -y\nRUN apt-get install nginx-extras git curl supervisor -y\nRUN apt-get install msmtp msmtp-mta -y\nRUN php5enmod mcrypt\nRUN /usr/bin/curl -sS https://getcomposer.org/installer | /usr/bin/php\nRUN /bin/mv composer.phar /usr/local/bin/composer\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#   Install Composer and Drush\nRUN /usr/local/bin/composer self-update\nRUN /usr/local/bin/composer global require drush/drush:6.*\nRUN ln -s /root/.composer/vendor/drush/drush/drush /usr/local/bin/drush\n#   Prepare directory\nRUN mkdir /var/www\nRUN usermod -u 1000 www-data\nRUN usermod -a -G users www-data\nRUN chown -R www-data:www-data /var/www\nEXPOSE 80/tcp\nWORKDIR /var/www\nVOLUME [\"/var/www/sites/default/files\"]\nCMD [\"/usr/bin/supervisord\", \"-n\"]\n#   Startup script\n#   This startup script wll configure nginx\nADD ./startup.sh /opt/startup.sh\nRUN chmod +x /opt/startup.sh\nADD ./mail.sh /opt/mail.sh\nRUN chmod +x /opt/mail.sh\nADD ./cron.sh /opt/cron.sh\nRUN chmod +x /opt/cron.sh\n#   We want it empty\nRUN touch /etc/msmtprc\nRUN chgrp mail /etc/msmtprc\nRUN chmod 660 /etc/msmtprc\nRUN touch /var/log/supervisor/msmtp.log\nRUN chgrp mail /var/log/supervisor/msmtp.log\nRUN chmod 660 /var/log/supervisor/msmtp.log\nRUN adduser www-data mail\nRUN rm /usr/sbin/sendmail\nRUN rm /usr/lib/sendmail\nRUN ln -s /usr/bin/msmtp /usr/sbin/sendmail\nRUN ln -s /usr/bin/msmtp /usr/bin/sendmail\nRUN ln -s /usr/bin/msmtp /usr/lib/sendmail\nRUN mkdir -p /var/cache/nginx/microcache\n#  ## Add configuration files\n#   Supervisor\nADD ./config/supervisor/supervisord-nginx.conf /etc/supervisor/conf.d/supervisord-nginx.conf\n#   PHP\nADD ./config/php/www.conf /etc/php5/fpm/pool.d/www.conf\nADD ./config/php/php.ini /etc/php5/fpm/php.ini\n#   Nginx\nADD ./config/nginx/blacklist.conf /etc/nginx/blacklist.conf\nADD ./config/nginx/drupal.conf /etc/nginx/drupal.conf\nADD ./config/nginx/drupal_upload_progress.conf /etc/nginx/drupal_upload_progress.conf\nADD ./config/nginx/fastcgi.conf /etc/nginx/fastcgi.conf\nADD ./config/nginx/fastcgi_drupal.conf /etc/nginx/fastcgi_drupal.conf\nADD ./config/nginx/fastcgi_microcache_zone.conf /etc/nginx/fastcgi_microcache_zone.conf\nADD ./config/nginx/fastcgi_no_args_drupal.conf /etc/nginx/fastcgi_no_args_drupal.conf\nADD ./config/nginx/map_cache.conf /etc/nginx/map_cache.conf\nADD ./config/nginx/microcache_fcgi.conf /etc/nginx/microcache_fcgi.conf\nADD ./config/nginx/microcache_fcgi_auth.conf /etc/nginx/microcache_fcgi_auth.conf\nADD ./config/nginx/mime.types /etc/nginx/mime.types\nADD ./config/nginx/nginx.conf /etc/nginx/nginx.conf\nADD ./config/nginx/upstream_phpcgi_unix.conf /etc/nginx/upstream_phpcgi_unix.conf\nADD ./config/nginx/map_block_http_methods.conf /etc/nginx/map_block_http_methods.conf\nADD ./config/nginx/map_https_fcgi.conf /etc/nginx/map_https_fcgi.conf\nADD ./config/nginx/nginx_status_allowed_hosts.conf /etc/nginx/nginx_status_allowed_hosts.conf\nADD ./config/nginx/cron_allowed_hosts.conf /etc/nginx/cron_allowed_hosts.conf\nADD ./config/nginx/php_fpm_status_allowed_hosts.conf /etc/nginx/php_fpm_status_allowed_hosts.conf\nADD ./config/nginx/default /etc/nginx/sites-enabled/default\n","originalDockerfileUglifiedHash":"b4cbc94ea84ea4b619e89ffe835fcca3","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/2c6babba5b5490f8168b538e234c827fa94739c8.dockerfile"}