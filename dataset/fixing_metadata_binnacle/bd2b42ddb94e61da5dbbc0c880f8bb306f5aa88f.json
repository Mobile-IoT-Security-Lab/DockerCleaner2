{"seed":703967860,"processedDockerfileHash":"9ea4d055a7e0f5be575815f24f3e2b0e","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"#  | This Dockerfile provides a starting point for a ROCm installation of math & DL libs.\nFROM ubuntu:xenial-20170619\nMAINTAINER Jeff Poznanovic <jeffrey.poznanovic@amd.com>\n#  ARG DEB_ROCM_REPO=http://repo.radeon.com/rocm/apt/debian/\nARG DEB_ROCM_REPO=http://172.27.226.104/artifactory/list/rocm-dkms-release-1.7-ubuntu\nARG ROCM_PATH=/opt/rocm\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV HOME=\"/root/\"\nRUN apt-get update \\\n && (apt-get update ;apt-get install --no-install-recommends wget software-properties-common -y )\n#   Add rocm repository\nRUN apt-get clean all\n#  RUN wget -qO - $DEB_ROCM_REPO/rocm.gpg.key | apt-key add -\nRUN sh -c \"echo deb [arch=amd64] $DEB_ROCM_REPO xenial main > /etc/apt/sources.list.d/rocm.list\"\n#   Install misc pkgs\nRUN : \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y build-essential clang-3.8 clang-format-3.8 clang-tidy-3.8 cmake cmake-qt-gui ssh curl apt-utils pkg-config g++-multilib git libunwind-dev libfftw3-dev libelf-dev libncurses5-dev libpthread-stubs0-dev vim gfortran libboost-program-options-dev libssl-dev libboost-dev libboost-system-dev libboost-filesystem-dev rpm libnuma-dev wget \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\n#   Install rocm pkgs\nRUN : \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y --allow-unauthenticated rocm-dev rocm-libs rocm-utils rocfft rocblas miopengemm hipblas rocrand rocm-profiler cxlactivitylogger \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\nENV HCC_HOME=\"$ROCM_PATH/hcc\"\nENV HIP_PATH=\"$ROCM_PATH/hip\"\nENV OPENCL_ROOT=\"$ROCM_PATH/opencl\"\nENV PATH=\"$HCC_HOME/bin:$HIP_PATH/bin:${PATH}\"\nENV PATH=\"$ROCM_PATH/bin:${PATH}\"\nENV PATH=\"$OPENCL_ROOT/bin:${PATH}\"\nCOPY ./docker/ubuntu-16.04-rocm171/target.lst /opt/rocm/bin\nCOPY ./tmp/MLOpen /root/MLOpen\n#   Setup environment variables, and add those environment variables at the end of ~/.bashrc \nARG HCC_HOME=/opt/rocm/hcc\nARG HIP_PATH=/opt/rocm/hip\nARG PATH=$HCC_HOME/bin:$HIP_PATH/bin:$PATH\nRUN cd /root/MLOpen \\\n && cmake -P install_deps.cmake \\\n && mkdir -p build \\\n && cd build \\\n && CXX=/opt/rocm/hcc/bin/hcc cmake -DMIOPEN_BACKEND=HIP -DCMAKE_PREFIX_PATH=\"/opt/rocm/hcc;/opt/rocm/hip\" -DCMAKE_CXX_FLAGS=\"-isystem /usr/include/x86_64-linux-gnu/\" .. \\\n && make -j $( nproc ;) \\\n && make install\nWORKDIR $HOME\nENV HOME=\"/rocm-caffe2\"\nENV MIOPEN_DISABLE_CACHE=\"1\"\n#   Required system packages to build hipcaffe on UB16.04:\nRUN : \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y pkg-config libgoogle-glog-dev libgtest-dev libiomp-dev libleveldb-dev liblmdb-dev libopencv-dev libopenmpi-dev libsnappy-dev libprotobuf-dev openmpi-bin openmpi-doc protobuf-compiler python-dev python-pip python-numpy python-scipy python3-dev python-yaml libfftw3-dev libelf-dev\nRUN pip install future==0.18.3 numpy==1.24.2 protobuf==4.22.3 future==0.18.3 pydot==1.4.2 opencv-python==4.7.0.72 hypothesis==6.72.0 pytest==7.3.1\nRUN (apt-get update ;apt-get install --no-install-recommends libgflags-dev -y )\nWORKDIR /data\nRUN git clone --recursive https://github.com/ROCmSoftwarePlatform/Thrust.git\nWORKDIR Thrust/thrust/system/cuda/detail\nRUN rm -r cub-hip\nRUN git clone --recursive https://github.com/ROCmSoftwarePlatform/cub-hip.git\nWORKDIR cub-hip\nRUN git checkout hip_port_1.7.4_caffe2\nENV THRUST_ROOT=\"/data/Thrust\"\nWORKDIR /data\nRUN git clone https://github.com/ROCmSoftwarePlatform/rocPRIM.git\nRUN cd rocPRIM \\\n && mkdir build \\\n && cd build \\\n && CXX=/opt/rocm/hcc/bin/hcc cmake .. \\\n && make -j $( nproc ;) \\\n && make install\nWORKDIR $HOME\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# | This Dockerfile provides a starting point for a ROCm installation of math & DL libs.\nFROM ubuntu:xenial-20170619\nMAINTAINER Jeff Poznanovic <jeffrey.poznanovic@amd.com>\n# ARG DEB_ROCM_REPO=http://repo.radeon.com/rocm/apt/debian/\nARG DEB_ROCM_REPO=http://172.27.226.104/artifactory/list/rocm-dkms-release-1.7-ubuntu\nARG ROCM_PATH=/opt/rocm\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV HOME=\"/root/\"\nRUN apt-get update \\\n && apt-get install -y wget software-properties-common\n#  Add rocm repository\nRUN apt-get clean all\n# RUN wget -qO - $DEB_ROCM_REPO/rocm.gpg.key | apt-key add -\nRUN sh -c \"echo deb [arch=amd64] $DEB_ROCM_REPO xenial main > /etc/apt/sources.list.d/rocm.list\"\n#  Install misc pkgs\nRUN apt-get update --allow-insecure-repositories \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y build-essential clang-3.8 clang-format-3.8 clang-tidy-3.8 cmake cmake-qt-gui ssh curl apt-utils pkg-config g++-multilib git libunwind-dev libfftw3-dev libelf-dev libncurses5-dev libpthread-stubs0-dev vim gfortran libboost-program-options-dev libssl-dev libboost-dev libboost-system-dev libboost-filesystem-dev rpm libnuma-dev wget \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\n#  Install rocm pkgs\nRUN apt-get update --allow-insecure-repositories \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y --allow-unauthenticated rocm-dev rocm-libs rocm-utils rocfft rocblas miopengemm hipblas rocrand rocm-profiler cxlactivitylogger \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\nENV HCC_HOME=\"$ROCM_PATH/hcc\"\nENV HIP_PATH=\"$ROCM_PATH/hip\"\nENV OPENCL_ROOT=\"$ROCM_PATH/opencl\"\nENV PATH=\"$HCC_HOME/bin:$HIP_PATH/bin:${PATH}\"\nENV PATH=\"$ROCM_PATH/bin:${PATH}\"\nENV PATH=\"$OPENCL_ROOT/bin:${PATH}\"\nADD ./docker/ubuntu-16.04-rocm171/target.lst /opt/rocm/bin\nADD ./tmp/MLOpen /root/MLOpen\n#  Setup environment variables, and add those environment variables at the end of ~/.bashrc \nARG HCC_HOME=/opt/rocm/hcc\nARG HIP_PATH=/opt/rocm/hip\nARG PATH=$HCC_HOME/bin:$HIP_PATH/bin:$PATH\nRUN cd /root/MLOpen \\\n && cmake -P install_deps.cmake \\\n && mkdir -p build \\\n && cd build \\\n && CXX=/opt/rocm/hcc/bin/hcc cmake -DMIOPEN_BACKEND=HIP -DCMAKE_PREFIX_PATH=\"/opt/rocm/hcc;/opt/rocm/hip\" -DCMAKE_CXX_FLAGS=\"-isystem /usr/include/x86_64-linux-gnu/\" .. \\\n && make -j $( nproc ;) \\\n && make install\nWORKDIR $HOME\nENV HOME=\"/rocm-caffe2\"\nENV MIOPEN_DISABLE_CACHE=\"1\"\n#  Required system packages to build hipcaffe on UB16.04:\nRUN apt-get update \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y pkg-config libgoogle-glog-dev libgtest-dev libiomp-dev libleveldb-dev liblmdb-dev libopencv-dev libopenmpi-dev libsnappy-dev libprotobuf-dev openmpi-bin openmpi-doc protobuf-compiler python-dev python-pip python-numpy python-scipy python3-dev python-yaml libfftw3-dev libelf-dev\nRUN pip install future numpy protobuf future pydot opencv-python hypothesis pytest\nRUN apt-get install --no-install-recommends libgflags-dev -y\nWORKDIR /data\nRUN git clone --recursive https://github.com/ROCmSoftwarePlatform/Thrust.git\nWORKDIR Thrust/thrust/system/cuda/detail\nRUN rm -r cub-hip\nRUN git clone --recursive https://github.com/ROCmSoftwarePlatform/cub-hip.git\nWORKDIR cub-hip\nRUN git checkout hip_port_1.7.4_caffe2\nENV THRUST_ROOT=\"/data/Thrust\"\nWORKDIR /data\nRUN git clone https://github.com/ROCmSoftwarePlatform/rocPRIM.git\nRUN cd rocPRIM \\\n && mkdir build \\\n && cd build \\\n && CXX=/opt/rocm/hcc/bin/hcc cmake .. \\\n && make -j $( nproc ;) \\\n && make install\nWORKDIR $HOME\n","injectedSmells":[],"originalDockerfileHash":"272a9f45fd4f5f7f6e71069829f5b274","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  | This Dockerfile provides a starting point for a ROCm installation of math & DL libs.\nFROM ubuntu:xenial-20170619\nMAINTAINER Jeff Poznanovic <jeffrey.poznanovic@amd.com>\n#  ARG DEB_ROCM_REPO=http://repo.radeon.com/rocm/apt/debian/\nARG DEB_ROCM_REPO=http://172.27.226.104/artifactory/list/rocm-dkms-release-1.7-ubuntu\nARG ROCM_PATH=/opt/rocm\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV HOME=\"/root/\"\nRUN apt-get update \\\n && apt-get install wget software-properties-common -y\n#   Add rocm repository\nRUN apt-get clean all\n#  RUN wget -qO - $DEB_ROCM_REPO/rocm.gpg.key | apt-key add -\nRUN sh -c \"echo deb [arch=amd64] $DEB_ROCM_REPO xenial main > /etc/apt/sources.list.d/rocm.list\"\n#   Install misc pkgs\nRUN apt-get update --allow-insecure-repositories \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y build-essential clang-3.8 clang-format-3.8 clang-tidy-3.8 cmake cmake-qt-gui ssh curl apt-utils pkg-config g++-multilib git libunwind-dev libfftw3-dev libelf-dev libncurses5-dev libpthread-stubs0-dev vim gfortran libboost-program-options-dev libssl-dev libboost-dev libboost-system-dev libboost-filesystem-dev rpm libnuma-dev wget \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\n#   Install rocm pkgs\nRUN apt-get update --allow-insecure-repositories \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y --allow-unauthenticated rocm-dev rocm-libs rocm-utils rocfft rocblas miopengemm hipblas rocrand rocm-profiler cxlactivitylogger \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\nENV HCC_HOME=\"$ROCM_PATH/hcc\"\nENV HIP_PATH=\"$ROCM_PATH/hip\"\nENV OPENCL_ROOT=\"$ROCM_PATH/opencl\"\nENV PATH=\"$HCC_HOME/bin:$HIP_PATH/bin:${PATH}\"\nENV PATH=\"$ROCM_PATH/bin:${PATH}\"\nENV PATH=\"$OPENCL_ROOT/bin:${PATH}\"\nADD ./docker/ubuntu-16.04-rocm171/target.lst /opt/rocm/bin\nADD ./tmp/MLOpen /root/MLOpen\n#   Setup environment variables, and add those environment variables at the end of ~/.bashrc \nARG HCC_HOME=/opt/rocm/hcc\nARG HIP_PATH=/opt/rocm/hip\nARG PATH=$HCC_HOME/bin:$HIP_PATH/bin:$PATH\nRUN cd /root/MLOpen \\\n && cmake -P install_deps.cmake \\\n && mkdir -p build \\\n && cd build \\\n && CXX=/opt/rocm/hcc/bin/hcc cmake -DMIOPEN_BACKEND=HIP -DCMAKE_PREFIX_PATH=\"/opt/rocm/hcc;/opt/rocm/hip\" -DCMAKE_CXX_FLAGS=\"-isystem /usr/include/x86_64-linux-gnu/\" .. \\\n && make -j $( nproc ;) \\\n && make install\nWORKDIR $HOME\nENV HOME=\"/rocm-caffe2\"\nENV MIOPEN_DISABLE_CACHE=\"1\"\n#   Required system packages to build hipcaffe on UB16.04:\nRUN apt-get update \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y pkg-config libgoogle-glog-dev libgtest-dev libiomp-dev libleveldb-dev liblmdb-dev libopencv-dev libopenmpi-dev libsnappy-dev libprotobuf-dev openmpi-bin openmpi-doc protobuf-compiler python-dev python-pip python-numpy python-scipy python3-dev python-yaml libfftw3-dev libelf-dev\nRUN pip install future numpy protobuf future pydot opencv-python hypothesis pytest\nRUN apt-get install --no-install-recommends libgflags-dev -y\nWORKDIR /data\nRUN git clone --recursive https://github.com/ROCmSoftwarePlatform/Thrust.git\nWORKDIR Thrust/thrust/system/cuda/detail\nRUN rm -r cub-hip\nRUN git clone --recursive https://github.com/ROCmSoftwarePlatform/cub-hip.git\nWORKDIR cub-hip\nRUN git checkout hip_port_1.7.4_caffe2\nENV THRUST_ROOT=\"/data/Thrust\"\nWORKDIR /data\nRUN git clone https://github.com/ROCmSoftwarePlatform/rocPRIM.git\nRUN cd rocPRIM \\\n && mkdir build \\\n && cd build \\\n && CXX=/opt/rocm/hcc/bin/hcc cmake .. \\\n && make -j $( nproc ;) \\\n && make install\nWORKDIR $HOME\n","originalDockerfileUglifiedHash":"3163f6b6461e3294c5dc547bf677084d","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/bd2b42ddb94e61da5dbbc0c880f8bb306f5aa88f.dockerfile"}