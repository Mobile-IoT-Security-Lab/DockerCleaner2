{"seed":896895937,"processedDockerfileHash":"034c80b0cce3447b1bb709c6b1793259","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-pip","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM balenalib/%%BALENA_MACHINE_NAME%%-node:8-run\n#   Install Systemd\nENV container=\"docker\"\nRUN apt-get update \\\n && apt-get install --no-install-recommends systemd-sysv -y \\\n && rm -rf /var/lib/apt/lists/*\n#   We never want these to run in a container\n#   Feel free to edit the list but this is the one we used\nRUN systemctl mask dev-hugepages.mount sys-fs-fuse-connections.mount sys-kernel-config.mount display-manager.service getty@.service systemd-logind.service systemd-remount-fs.service getty.target graphical.target\nCOPY systemd/entry.sh /usr/bin/entry.sh\nCOPY systemd/balena.service /etc/systemd/system/balena.service\nRUN systemctl enable /etc/systemd/system/balena.service\nSTOPSIGNAL 37\nENTRYPOINT [\"/usr/bin/entry.sh\"]\nENV INITSYSTEM=\"on\"\n#   Finish setup systemd\n#   Move to app dir\nRUN mkdir -p /usr/src/app/\nWORKDIR /usr/src/app\nCOPY ./app/package.json ./\n#   Add Mopidy sources and install apt deps\nRUN apt-get update \\\n && apt-get install --no-install-recommends wget -yq \\\n && wget -q -O - https://apt.mopidy.com/mopidy.gpg | sudo apt-key add - \\\n && wget -q -O /etc/apt/sources.list.d/mopidy.list https://apt.mopidy.com/jessie.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends git build-essential python-dev python-pip python-wheel libxml2-dev libz-dev libxslt1-dev alsa-utils autoconf automake libtool libdaemon-dev libasound2-dev libpopt-dev libconfig-dev gstreamer1.0-alsa gstreamer1.0-plugins-bad gstreamer1.0-plugins-good gstreamer1.0-plugins-ugly gstreamer1.0-tools gstreamer1.0-libav mopidy -yq \\\n && JOBS=MAX npm install --unsafe-perm --production \\\n && npm cache clean --force \\\n && rm -rf /tmp/* \\\n && pip install setuptools==67.6.1 --upgrade \\\n && pip install packaging==23.1 pyparsing==3.0.9 youtube-dl==2021.12.17 \\\n && pip install mopidy-gmusic==4.0.1 Mopidy-YouTube==3.6.1 mopidy-musicbox-webclient==3.1.0 Mopidy-Local-SQLite==1.0.0 \\\n && apt-get purge -y build-essential python-dev python-pip git curl libxml2-dev libxslt1-dev autoconf automake libtool libdaemon-dev libasound2-dev libpopt-dev libconfig-dev libz-dev \\\n && apt-get autoremove -y \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\n#   Configure Mopidy\nCOPY ./Dockerbin/mopidy.conf /etc/mopidy/mopidy.conf\n#   Configure DAC\nCOPY ./Dockerbin/asound.conf /etc/asound.conf\n#   Move app to filesystem\nCOPY ./app ./\n#   Disable mopidy service - we will manually start it later\nRUN systemctl disable mopidy\n#   Start app\nCMD [\"bash\", \"/usr/src/app/start.sh\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM balenalib/%%BALENA_MACHINE_NAME%%-node:8-run\n#  Install Systemd\nENV container=\"docker\"\nRUN apt-get update \\\n && apt-get install --no-install-recommends systemd-sysv -y \\\n && rm -rf /var/lib/apt/lists/*\n#  We never want these to run in a container\n#  Feel free to edit the list but this is the one we used\nRUN systemctl mask dev-hugepages.mount sys-fs-fuse-connections.mount sys-kernel-config.mount display-manager.service getty@.service systemd-logind.service systemd-remount-fs.service getty.target graphical.target\nCOPY systemd/entry.sh /usr/bin/entry.sh\nCOPY systemd/balena.service /etc/systemd/system/balena.service\nRUN systemctl enable /etc/systemd/system/balena.service\nSTOPSIGNAL 37\nENTRYPOINT [\"/usr/bin/entry.sh\"]\nENV INITSYSTEM=\"on\"\n#  Finish setup systemd\n#  Move to app dir\nRUN mkdir -p /usr/src/app/\nWORKDIR /usr/src/app\nCOPY ./app/package.json ./\n#  Add Mopidy sources and install apt deps\nRUN apt-get update \\\n && apt-get install --no-install-recommends wget -yq \\\n && wget -q -O - https://apt.mopidy.com/mopidy.gpg | sudo apt-key add - \\\n && wget -q -O /etc/apt/sources.list.d/mopidy.list https://apt.mopidy.com/jessie.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends git build-essential python-dev python-pip python-wheel libxml2-dev libz-dev libxslt1-dev alsa-utils autoconf automake libtool libdaemon-dev libasound2-dev libpopt-dev libconfig-dev gstreamer1.0-alsa gstreamer1.0-plugins-bad gstreamer1.0-plugins-good gstreamer1.0-plugins-ugly gstreamer1.0-tools gstreamer1.0-libav mopidy -yq \\\n && JOBS=MAX npm install --unsafe-perm --production \\\n && npm cache clean --force \\\n && rm -rf /tmp/* \\\n && pip install setuptools --upgrade \\\n && pip install packaging pyparsing youtube-dl \\\n && pip install mopidy-gmusic Mopidy-YouTube mopidy-musicbox-webclient Mopidy-Local-SQLite \\\n && apt-get purge -y build-essential python-dev python-pip git curl libxml2-dev libxslt1-dev autoconf automake libtool libdaemon-dev libasound2-dev libpopt-dev libconfig-dev libz-dev \\\n && apt-get autoremove -y \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\n#  Configure Mopidy\nCOPY ./Dockerbin/mopidy.conf /etc/mopidy/mopidy.conf\n#  Configure DAC\nCOPY ./Dockerbin/asound.conf /etc/asound.conf\n#  Move app to filesystem\nCOPY ./app ./\n#  Disable mopidy service - we will manually start it later\nRUN systemctl disable mopidy\n#  Start app\nCMD [\"bash\", \"/usr/src/app/start.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"bba584ab541e9606c994a4af35758bc1","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM balenalib/%%BALENA_MACHINE_NAME%%-node:8-run\n#   Install Systemd\nENV container=\"docker\"\nRUN apt-get update \\\n && apt-get install --no-install-recommends systemd-sysv -y \\\n && rm -rf /var/lib/apt/lists/*\n#   We never want these to run in a container\n#   Feel free to edit the list but this is the one we used\nRUN systemctl mask dev-hugepages.mount sys-fs-fuse-connections.mount sys-kernel-config.mount display-manager.service getty@.service systemd-logind.service systemd-remount-fs.service getty.target graphical.target\nCOPY systemd/entry.sh /usr/bin/entry.sh\nCOPY systemd/balena.service /etc/systemd/system/balena.service\nRUN systemctl enable /etc/systemd/system/balena.service\nSTOPSIGNAL 37\nENTRYPOINT [\"/usr/bin/entry.sh\"]\nENV INITSYSTEM=\"on\"\n#   Finish setup systemd\n#   Move to app dir\nRUN mkdir -p /usr/src/app/\nWORKDIR /usr/src/app\nCOPY ./app/package.json ./\n#   Add Mopidy sources and install apt deps\nRUN apt-get update \\\n && apt-get install --no-install-recommends wget -yq \\\n && wget -q -O - https://apt.mopidy.com/mopidy.gpg | sudo apt-key add - \\\n && wget -q -O /etc/apt/sources.list.d/mopidy.list https://apt.mopidy.com/jessie.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends git build-essential python-dev python-pip python-wheel libxml2-dev libz-dev libxslt1-dev alsa-utils autoconf automake libtool libdaemon-dev libasound2-dev libpopt-dev libconfig-dev gstreamer1.0-alsa gstreamer1.0-plugins-bad gstreamer1.0-plugins-good gstreamer1.0-plugins-ugly gstreamer1.0-tools gstreamer1.0-libav mopidy -yq \\\n && JOBS=MAX npm install --unsafe-perm --production \\\n && npm cache clean --force \\\n && rm -rf /tmp/* \\\n && pip install setuptools --upgrade \\\n && pip install packaging pyparsing youtube-dl \\\n && pip install mopidy-gmusic Mopidy-YouTube mopidy-musicbox-webclient Mopidy-Local-SQLite \\\n && apt-get purge -y build-essential python-dev python-pip git curl libxml2-dev libxslt1-dev autoconf automake libtool libdaemon-dev libasound2-dev libpopt-dev libconfig-dev libz-dev \\\n && apt-get autoremove -y \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\n#   Configure Mopidy\nCOPY ./Dockerbin/mopidy.conf /etc/mopidy/mopidy.conf\n#   Configure DAC\nCOPY ./Dockerbin/asound.conf /etc/asound.conf\n#   Move app to filesystem\nCOPY ./app ./\n#   Disable mopidy service - we will manually start it later\nRUN systemctl disable mopidy\n#   Start app\nCMD [\"bash\", \"/usr/src/app/start.sh\"]\n","originalDockerfileUglifiedHash":"a8e6bc770ed2eaf10807d2905e6cfc6f","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/dcb93c21e9b1145ccb9bf4045e76e953c1a8d9ea.dockerfile"}