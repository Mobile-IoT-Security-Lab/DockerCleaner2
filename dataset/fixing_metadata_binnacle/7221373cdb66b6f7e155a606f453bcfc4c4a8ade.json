{"seed":2133361565,"processedDockerfileHash":"f6a9862dfba01f796018d01032e9d08d","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   The Dockerfile is Licensed under GNU AFFERO GENERAL PUBLIC LICENSE Version 3\nFROM ubuntu AS builder\nLABEL maintainer=\"sahil@ole.org,mappuji@ole.org\"\nCOPY ./crosscompile.sh .\nRUN bash ./crosscompile.sh armv7 install\nFROM resin/rpi-raspbian\nENV COUCHDB_VERSION=\"2.0.0\"\n#  create dirs and links for the npm module\nRUN mkdir -p /usr/lib/node_modules ; ln -s /usr/lib/node_modules/grunt-cli/bin/grunt /usr/bin/grunt\nCOPY --from=builder /usr/lib/node_modules /usr/lib/node_modules\n#   Add CouchDB user account\nRUN groupadd -r couchdb \\\n && useradd -d /opt/couchdb -g couchdb couchdb\nRUN apt-get update -y \\\n && apt-get install --no-install-recommends ca-certificates=20230311 curl=7.88.1-7ubuntu1 erlang-nox=1:25.2.3+dfsg-1 erlang-reltool=1:25.2.3+dfsg-1 haproxy=2.6.9-1ubuntu1 libicu52 libmozjs185-1.0 openssl=3.0.8-1ubuntu1 -y \\\n && rm -rf /var/lib/apt/lists/*\n#   grab gosu for easy step-down from root and tini for signal handling\nRUN gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && curl -o /usr/local/bin/gosu -fSL \"https://github.com/tianon/gosu/releases/download/1.7/gosu-$( dpkg --print-architecture ;)\" \\\n && curl -o /usr/local/bin/gosu.asc -fSL \"https://github.com/tianon/gosu/releases/download/1.7/gosu-$( dpkg --print-architecture ;).asc\" \\\n && gpg --verify /usr/local/bin/gosu.asc \\\n && rm /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && gpg --keyserver ha.pool.sks-keyservers.net --recv-keys 6380DC428747F6C393FEACA59A84159D7001A4E5 ; if ! type \"tini\" > /dev/null; then curl -o /usr/local/bin/tini -fSL \"https://github.com/krallin/tini/releases/download/v0.14.0/tini\" \\\n && curl -o /usr/local/bin/tini.asc -fSL \"https://github.com/krallin/tini/releases/download/v0.14.0/tini.asc\" \\\n && gpg --verify /usr/local/bin/tini.asc \\\n && rm /usr/local/bin/tini.asc \\\n && chmod +x /usr/local/bin/tini ; fi\n#   https://www.apache.org/dist/couchdb/KEYS\nENV GPG_KEYS=\"15DD4F3B8AACA54740EB78C7B7B7C53943ECCEE1  1CFBFA43C19B6DF4A0CA3934669C02FFDF3CEBA3  25BBBAC113C1BFD5AA594A4C9F96B92930380381  4BFCA2B99BADC6F9F105BEC9C5E32E2D6B065BFB  5D680346FAA3E51B29DBCB681015F68F9DA248BC  7BCCEB868313DDA925DF1805ECA5BCB7BB9656B0  C3F4DFAEAD621E1C94523AEEC376457E61D50B88  D2B17F9DA23C0A10991AF2E3D9EE01E47852AEE4  E0AF0A194D55C84E4A19A801CDB0C0F904F4EE9B\"\nRUN set -xe \\\n && for key in $GPG_KEYS; do gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; done\nENV COUCHDB_VERSION=\"2.0.0\"\n#   Download dev dependencies\nRUN buildDeps=' apt-transport-https gcc git g++ erlang-dev libcurl4-openssl-dev libicu-dev libmozjs185-dev make ' \\\n && apt-get update -y -qq \\\n && apt-get install --no-install-recommends $buildDeps -y \\\n && curl -s https://deb.nodesource.com/gpgkey/nodesource.gpg.key | apt-key add - \\\n && echo 'deb https://deb.nodesource.com/node_4.x jessie main' > /etc/apt/sources.list.d/nodesource.list \\\n && echo 'deb-src https://deb.nodesource.com/node_4.x jessie main' >> /etc/apt/sources.list.d/nodesource.list \\\n && apt-get update -y -qq \\\n && apt-get install --no-install-recommends nodejs=18.13.0+dfsg1-1ubuntu2 -y \\\n && cd /usr/src \\\n && mkdir couchdb \\\n && curl -fSL https://github.com/apache/couchdb/archive/$COUCHDB_VERSION.tar.gz -o couchdb.tar.gz \\\n && tar -xzf couchdb.tar.gz -C couchdb --strip-components=1 \\\n && cd couchdb \\\n && ./configure --disable-docs \\\n && make release \\\n && mv /usr/src/couchdb/rel/couchdb /opt/ \\\n && apt-get purge -y --auto-remove $buildDeps \\\n && rm -rf /var/lib/apt/lists/* /usr/lib/node_modules /usr/src/couchdb*\n#   Add configuration\nCOPY local.ini /opt/couchdb/etc/local.d/\nCOPY vm.args /opt/couchdb/etc/\nCOPY ./docker-entrypoint.sh /\n#   Setup directories and permissions\nRUN chmod +x /docker-entrypoint.sh \\\n && mkdir /opt/couchdb/data /opt/couchdb/etc/default.d \\\n && chown -R couchdb:couchdb /opt/couchdb/\nWORKDIR /opt/couchdb\nEXPOSE 5984/tcp 4369/tcp 9100/tcp\nVOLUME [\"/opt/couchdb/data\"]\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\nCMD [\"/opt/couchdb/bin/couchdb\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  The Dockerfile is Licensed under GNU AFFERO GENERAL PUBLIC LICENSE Version 3\nFROM ubuntu AS builder\nLABEL maintainer=\"sahil@ole.org,mappuji@ole.org\"\nCOPY ./crosscompile.sh .\nRUN bash ./crosscompile.sh armv7 install\nFROM resin/rpi-raspbian\nENV COUCHDB_VERSION=\"2.0.0\"\n# create dirs and links for the npm module\nRUN mkdir -p /usr/lib/node_modules ; ln -s /usr/lib/node_modules/grunt-cli/bin/grunt /usr/bin/grunt\nCOPY --from=builder /usr/lib/node_modules /usr/lib/node_modules\n#  Add CouchDB user account\nRUN groupadd -r couchdb \\\n && useradd -d /opt/couchdb -g couchdb couchdb\nRUN apt-get update -y \\\n && apt-get install --no-install-recommends ca-certificates curl erlang-nox erlang-reltool haproxy libicu52 libmozjs185-1.0 openssl -y \\\n && rm -rf /var/lib/apt/lists/*\n#  grab gosu for easy step-down from root and tini for signal handling\nRUN gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && curl -o /usr/local/bin/gosu -fSL \"https://github.com/tianon/gosu/releases/download/1.7/gosu-$( dpkg --print-architecture ;)\" \\\n && curl -o /usr/local/bin/gosu.asc -fSL \"https://github.com/tianon/gosu/releases/download/1.7/gosu-$( dpkg --print-architecture ;).asc\" \\\n && gpg --verify /usr/local/bin/gosu.asc \\\n && rm /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && gpg --keyserver ha.pool.sks-keyservers.net --recv-keys 6380DC428747F6C393FEACA59A84159D7001A4E5 ; if ! type \"tini\" > /dev/null; then curl -o /usr/local/bin/tini -fSL \"https://github.com/krallin/tini/releases/download/v0.14.0/tini\" \\\n && curl -o /usr/local/bin/tini.asc -fSL \"https://github.com/krallin/tini/releases/download/v0.14.0/tini.asc\" \\\n && gpg --verify /usr/local/bin/tini.asc \\\n && rm /usr/local/bin/tini.asc \\\n && chmod +x /usr/local/bin/tini ; fi\n#  https://www.apache.org/dist/couchdb/KEYS\nENV GPG_KEYS=\"15DD4F3B8AACA54740EB78C7B7B7C53943ECCEE1  1CFBFA43C19B6DF4A0CA3934669C02FFDF3CEBA3  25BBBAC113C1BFD5AA594A4C9F96B92930380381  4BFCA2B99BADC6F9F105BEC9C5E32E2D6B065BFB  5D680346FAA3E51B29DBCB681015F68F9DA248BC  7BCCEB868313DDA925DF1805ECA5BCB7BB9656B0  C3F4DFAEAD621E1C94523AEEC376457E61D50B88  D2B17F9DA23C0A10991AF2E3D9EE01E47852AEE4  E0AF0A194D55C84E4A19A801CDB0C0F904F4EE9B\"\nRUN set -xe \\\n && for key in $GPG_KEYS; do gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; done\nENV COUCHDB_VERSION=\"2.0.0\"\n#  Download dev dependencies\nRUN buildDeps=' apt-transport-https gcc git g++ erlang-dev libcurl4-openssl-dev libicu-dev libmozjs185-dev make ' \\\n && apt-get update -y -qq \\\n && apt-get install --no-install-recommends $buildDeps -y \\\n && curl -s https://deb.nodesource.com/gpgkey/nodesource.gpg.key | apt-key add - \\\n && echo 'deb https://deb.nodesource.com/node_4.x jessie main' > /etc/apt/sources.list.d/nodesource.list \\\n && echo 'deb-src https://deb.nodesource.com/node_4.x jessie main' >> /etc/apt/sources.list.d/nodesource.list \\\n && apt-get update -y -qq \\\n && apt-get install nodejs -y \\\n && cd /usr/src \\\n && mkdir couchdb \\\n && curl -fSL https://github.com/apache/couchdb/archive/$COUCHDB_VERSION.tar.gz -o couchdb.tar.gz \\\n && tar -xzf couchdb.tar.gz -C couchdb --strip-components=1 \\\n && cd couchdb \\\n && ./configure --disable-docs \\\n && make release \\\n && mv /usr/src/couchdb/rel/couchdb /opt/ \\\n && apt-get purge -y --auto-remove $buildDeps \\\n && rm -rf /var/lib/apt/lists/* /usr/lib/node_modules /usr/src/couchdb*\n#  Add configuration\nCOPY local.ini /opt/couchdb/etc/local.d/\nCOPY vm.args /opt/couchdb/etc/\nCOPY ./docker-entrypoint.sh /\n#  Setup directories and permissions\nRUN chmod +x /docker-entrypoint.sh \\\n && mkdir /opt/couchdb/data /opt/couchdb/etc/default.d \\\n && chown -R couchdb:couchdb /opt/couchdb/\nWORKDIR /opt/couchdb\nEXPOSE 5984/tcp 4369/tcp 9100/tcp\nVOLUME [\"/opt/couchdb/data\"]\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\nCMD [\"/opt/couchdb/bin/couchdb\"]\n","injectedSmells":[],"originalDockerfileHash":"6ea4e4ea9749a9c32a81f3777f28839d","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   The Dockerfile is Licensed under GNU AFFERO GENERAL PUBLIC LICENSE Version 3\nFROM ubuntu AS builder\nLABEL maintainer=\"sahil@ole.org,mappuji@ole.org\"\nCOPY ./crosscompile.sh .\nRUN bash ./crosscompile.sh armv7 install\nFROM resin/rpi-raspbian\nENV COUCHDB_VERSION=\"2.0.0\"\n#  create dirs and links for the npm module\nRUN mkdir -p /usr/lib/node_modules ; ln -s /usr/lib/node_modules/grunt-cli/bin/grunt /usr/bin/grunt\nCOPY --from=builder /usr/lib/node_modules /usr/lib/node_modules\n#   Add CouchDB user account\nRUN groupadd -r couchdb \\\n && useradd -d /opt/couchdb -g couchdb couchdb\nRUN apt-get update -y \\\n && apt-get install --no-install-recommends ca-certificates curl erlang-nox erlang-reltool haproxy libicu52 libmozjs185-1.0 openssl -y \\\n && rm -rf /var/lib/apt/lists/*\n#   grab gosu for easy step-down from root and tini for signal handling\nRUN gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && curl -o /usr/local/bin/gosu -fSL \"https://github.com/tianon/gosu/releases/download/1.7/gosu-$( dpkg --print-architecture ;)\" \\\n && curl -o /usr/local/bin/gosu.asc -fSL \"https://github.com/tianon/gosu/releases/download/1.7/gosu-$( dpkg --print-architecture ;).asc\" \\\n && gpg --verify /usr/local/bin/gosu.asc \\\n && rm /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && gpg --keyserver ha.pool.sks-keyservers.net --recv-keys 6380DC428747F6C393FEACA59A84159D7001A4E5 ; if ! type \"tini\" > /dev/null; then curl -o /usr/local/bin/tini -fSL \"https://github.com/krallin/tini/releases/download/v0.14.0/tini\" \\\n && curl -o /usr/local/bin/tini.asc -fSL \"https://github.com/krallin/tini/releases/download/v0.14.0/tini.asc\" \\\n && gpg --verify /usr/local/bin/tini.asc \\\n && rm /usr/local/bin/tini.asc \\\n && chmod +x /usr/local/bin/tini ; fi\n#   https://www.apache.org/dist/couchdb/KEYS\nENV GPG_KEYS=\"15DD4F3B8AACA54740EB78C7B7B7C53943ECCEE1  1CFBFA43C19B6DF4A0CA3934669C02FFDF3CEBA3  25BBBAC113C1BFD5AA594A4C9F96B92930380381  4BFCA2B99BADC6F9F105BEC9C5E32E2D6B065BFB  5D680346FAA3E51B29DBCB681015F68F9DA248BC  7BCCEB868313DDA925DF1805ECA5BCB7BB9656B0  C3F4DFAEAD621E1C94523AEEC376457E61D50B88  D2B17F9DA23C0A10991AF2E3D9EE01E47852AEE4  E0AF0A194D55C84E4A19A801CDB0C0F904F4EE9B\"\nRUN set -xe \\\n && for key in $GPG_KEYS; do gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; done\nENV COUCHDB_VERSION=\"2.0.0\"\n#   Download dev dependencies\nRUN buildDeps=' apt-transport-https gcc git g++ erlang-dev libcurl4-openssl-dev libicu-dev libmozjs185-dev make ' \\\n && apt-get update -y -qq \\\n && apt-get install --no-install-recommends $buildDeps -y \\\n && curl -s https://deb.nodesource.com/gpgkey/nodesource.gpg.key | apt-key add - \\\n && echo 'deb https://deb.nodesource.com/node_4.x jessie main' > /etc/apt/sources.list.d/nodesource.list \\\n && echo 'deb-src https://deb.nodesource.com/node_4.x jessie main' >> /etc/apt/sources.list.d/nodesource.list \\\n && apt-get update -y -qq \\\n && apt-get install nodejs -y \\\n && cd /usr/src \\\n && mkdir couchdb \\\n && curl -fSL https://github.com/apache/couchdb/archive/$COUCHDB_VERSION.tar.gz -o couchdb.tar.gz \\\n && tar -xzf couchdb.tar.gz -C couchdb --strip-components=1 \\\n && cd couchdb \\\n && ./configure --disable-docs \\\n && make release \\\n && mv /usr/src/couchdb/rel/couchdb /opt/ \\\n && apt-get purge -y --auto-remove $buildDeps \\\n && rm -rf /var/lib/apt/lists/* /usr/lib/node_modules /usr/src/couchdb*\n#   Add configuration\nCOPY local.ini /opt/couchdb/etc/local.d/\nCOPY vm.args /opt/couchdb/etc/\nCOPY ./docker-entrypoint.sh /\n#   Setup directories and permissions\nRUN chmod +x /docker-entrypoint.sh \\\n && mkdir /opt/couchdb/data /opt/couchdb/etc/default.d \\\n && chown -R couchdb:couchdb /opt/couchdb/\nWORKDIR /opt/couchdb\nEXPOSE 5984/tcp 4369/tcp 9100/tcp\nVOLUME [\"/opt/couchdb/data\"]\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\nCMD [\"/opt/couchdb/bin/couchdb\"]\n","originalDockerfileUglifiedHash":"3eb0aa6e316da2d91183f8b2b4f5a110","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/7221373cdb66b6f7e155a606f453bcfc4c4a8ade.dockerfile"}