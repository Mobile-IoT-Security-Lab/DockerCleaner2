{"seed":4174119094,"processedDockerfileHash":"081db5c5e036574899e930908e6f2c59","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-pip","pin-package-manager-versions-apk","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM python:3.7-alpine3.9\nENV OMAHA_SERVER_PATH=\"/srv/omaha\"\nWORKDIR ${OMAHA_SERVER_PATH}\n#   Add low-level dependencies\nRUN apk add bash=4.4.19-r1 ca-certificates=20191127-r2 \\\n && apk add nginx=1.14.2-r5 supervisor=3.3.4-r1 openrc=0.39.2-r3 \\\n && apk add build-base=0.5-r1 --virtual dev-deps \\\n && apk add py3-lxml=4.2.5-r0 py-psycopg2=2.7.5-r0 py-pillow=5.4.1-r0 \\\n && apk add fuse-dev=2.9.8-r2 libxml2-dev=2.9.9-r3 libxslt-dev=1.1.33-r3 libcurl=7.64.0-r5 curl-dev=7.64.0-r5 libstdc++=8.3.0-r0 \\\n && apk add autoconf=2.69-r2 automake=1.16.1-r0 libtool=2.4.6-r5 pkgconfig openssl-dev=1.1.1k-r0 wget=1.20.3-r0 tar=1.32-r0 --virtual fuse-deps \\\n && apk add linux-headers=4.18.13-r1 pcre-dev=8.42-r2 gd-dev=2.2.5-r4 geoip-dev=1.6.12-r1 \\\n && apk add openssl=1.1.1k-r0 pcre=8.42-r2 zlib=1.2.11-r1 zlib-dev=1.2.11-r1 \\\n && apk add build-base=0.5-r1 lua5.1-dev=5.1.5-r7 luarocks=2.4.4-r0 \\\n && apk add postgresql-libs=11.11-r0 postgresql-dev=11.11-r0 libc6-compat=1.1.20-r6 gzip=1.10-r0 --no-cache \\\n && apk add libffi-dev=3.2.1-r6 --no-cache \\\n && pip install lxml==4.9.2\n#   Prepare for building Nginx. Intsall LuaJIT.\nRUN apk add luajit=2.1.0_beta3-r4 luajit-dev=2.1.0_beta3-r4 nginx-lua nginx-mod-http-lua=1.14.2-r5 \\\n && wget http://luajit.org/download/LuaJIT-2.1.0-beta3.tar.gz \\\n && tar -xzvf LuaJIT-2.1.0-beta3.tar.gz \\\n && rm LuaJIT-2.1.0-beta3.tar.gz \\\n && cd LuaJIT-2.1.0-beta3 \\\n && make \\\n && make install\nENV LUAJIT_LIB=\"/usr/local/lib\"\nENV LUAJIT_INC=\"/usr/local/include/luajit-2.1\"\n#   Build Lua module for Nginx\nRUN luarocks-5.1 install lua-zlib \\\n && cd /tmp \\\n && NGINX_VERSION=`nginx -v 2>&1 | grep -o '[[:digit:]].*$' ` \\\n && wget http://nginx.org/download/nginx-$NGINX_VERSION.tar.gz \\\n && tar -xzvf nginx-$NGINX_VERSION.tar.gz \\\n && wget -qO- https://api.github.com/repos/openresty/lua-nginx-module/tags | grep -m 1 tarball_url | cut -d '\"' -f 4 | xargs wget -O lua-nginx-module.tar \\\n && mkdir -p /tmp/lua-nginx-module \\\n && tar -xvf lua-nginx-module.tar -C /tmp/lua-nginx-module --strip-components=1 \\\n && wget -qO- https://api.github.com/repos/simpl/ngx_devel_kit/tags | grep -m 1 tarball_url | cut -d '\"' -f 4 | xargs wget -O ngx_devel_kit.tar \\\n && mkdir -p /tmp/ngx_devel_kit \\\n && tar -xvf ngx_devel_kit.tar -C /tmp/ngx_devel_kit --strip-components=1 \\\n && cd nginx-$NGINX_VERSION \\\n && ./configure --prefix=/var/lib/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules --conf-path=/etc/nginx/nginx.conf --pid-path=/run/nginx/nginx.pid --lock-path=/run/nginx/nginx.lock --http-client-body-temp-path=/var/tmp/nginx/client_body --http-proxy-temp-path=/var/tmp/nginx/proxy --http-fastcgi-temp-path=/var/tmp/nginx/fastcgi --http-uwsgi-temp-path=/var/tmp/nginx/uwsgi --http-scgi-temp-path=/var/tmp/nginx/scgi --user=nginx --group=nginx --with-threads --with-file-aio --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_xslt_module=dynamic --with-http_image_filter_module=dynamic --with-http_geoip_module=dynamic --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_degradation_module --with-http_slice_module --with-http_stub_status_module --with-mail=dynamic --with-mail_ssl_module --with-stream=dynamic --with-stream_ssl_module --with-stream_realip_module --with-stream_geoip_module=dynamic --with-stream_ssl_preread_module --add-dynamic-module=/tmp/ngx_devel_kit --add-dynamic-module=/tmp/lua-nginx-module \\\n && make build \\\n && cp objs/ndk_http_module.so /usr/lib/nginx/modules/ndk_http_module.so \\\n && cp objs/ngx_http_lua_module.so /usr/lib/nginx/modules/ngx_http_lua_module.so \\\n && cd /tmp \\\n && rm -R /tmp/*\n#   S3FS\nARG S3FS_VERSION=1.84\nRUN mkdir /usr/src/omaha-server \\\n && wget --no-check-certificate https://github.com/s3fs-fuse/s3fs-fuse/archive/v${S3FS_VERSION}.tar.gz -O /usr/src/omaha-server/v${S3FS_VERSION}.tar.gz \\\n && tar xvz -C /usr/src/omaha-server -f /usr/src/omaha-server/v${S3FS_VERSION}.tar.gz \\\n && cd /usr/src/omaha-server/s3fs-fuse-${S3FS_VERSION} \\\n && ./autogen.sh \\\n && ./configure --prefix=/usr \\\n && make \\\n && make install \\\n && mkdir -p /srv/omaha_s3 \\\n && rm /usr/src/omaha-server/v${S3FS_VERSION}.tar.gz\n#   Filebeat\nARG FILEBEAT_PACKEGE=filebeat-6.0.0-linux-x86_64\nRUN wget https://artifacts.elastic.co/downloads/beats/filebeat/${FILEBEAT_PACKEGE}.tar.gz -O /usr/src/omaha-server/${FILEBEAT_PACKEGE}.tar.gz \\\n && tar xzvf /usr/src/omaha-server/${FILEBEAT_PACKEGE}.tar.gz -C /etc/ \\\n && mv /etc/${FILEBEAT_PACKEGE} /etc/filebeat \\\n && mkdir /tmp/filebeat/ \\\n && ln /etc/filebeat/filebeat /usr/bin/\n#   Clean Up\nRUN rm -rf /var/cache/apk/* \\\n && apk del fuse-deps dev-deps\n#   Setup application dependencies\nRUN mkdir -p $OMAHA_SERVER_PATH/requirements\nCOPY Pipfile Pipfile.lock $OMAHA_SERVER_PATH/\n#   Dependencies for Pillow\nRUN apk add jpeg-dev=8-r6 libjpeg=8-r6 \\\n && apk add rsyslog=8.40.0-r4\nRUN pip install pipenv==2023.3.20 \\\n && pipenv install --system --deploy\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM python:3.7-alpine3.9\nENV OMAHA_SERVER_PATH=\"/srv/omaha\"\nWORKDIR ${OMAHA_SERVER_PATH}\n#  Add low-level dependencies\nRUN apk add bash ca-certificates \\\n && apk add nginx supervisor openrc \\\n && apk add --virtual dev-deps build-base \\\n && apk add py3-lxml py-psycopg2 py-pillow \\\n && apk add fuse-dev libxml2-dev libxslt-dev libcurl curl-dev libstdc++ \\\n && apk add --virtual fuse-deps autoconf automake libtool pkgconfig openssl-dev wget tar \\\n && apk add linux-headers pcre-dev gd-dev geoip-dev \\\n && apk add openssl pcre zlib zlib-dev \\\n && apk add build-base lua5.1-dev luarocks \\\n && apk add --no-cache postgresql-libs postgresql-dev libc6-compat gzip \\\n && apk add --no-cache libffi-dev \\\n && pip install lxml\n#  Prepare for building Nginx. Intsall LuaJIT.\nRUN apk add luajit luajit-dev nginx-lua nginx-mod-http-lua \\\n && wget http://luajit.org/download/LuaJIT-2.1.0-beta3.tar.gz \\\n && tar -xzvf LuaJIT-2.1.0-beta3.tar.gz \\\n && rm LuaJIT-2.1.0-beta3.tar.gz \\\n && cd LuaJIT-2.1.0-beta3 \\\n && make \\\n && make install\nENV LUAJIT_LIB=\"/usr/local/lib\"\nENV LUAJIT_INC=\"/usr/local/include/luajit-2.1\"\n#  Build Lua module for Nginx\nRUN luarocks-5.1 install lua-zlib \\\n && cd /tmp \\\n && NGINX_VERSION=`nginx -v 2>&1 | grep -o '[[:digit:]].*$' ` \\\n && wget http://nginx.org/download/nginx-$NGINX_VERSION.tar.gz \\\n && tar -xzvf nginx-$NGINX_VERSION.tar.gz \\\n && wget -qO- https://api.github.com/repos/openresty/lua-nginx-module/tags | grep -m 1 tarball_url | cut -d '\"' -f 4 | xargs wget -O lua-nginx-module.tar \\\n && mkdir -p /tmp/lua-nginx-module \\\n && tar -xvf lua-nginx-module.tar -C /tmp/lua-nginx-module --strip-components=1 \\\n && wget -qO- https://api.github.com/repos/simpl/ngx_devel_kit/tags | grep -m 1 tarball_url | cut -d '\"' -f 4 | xargs wget -O ngx_devel_kit.tar \\\n && mkdir -p /tmp/ngx_devel_kit \\\n && tar -xvf ngx_devel_kit.tar -C /tmp/ngx_devel_kit --strip-components=1 \\\n && cd nginx-$NGINX_VERSION \\\n && ./configure --prefix=/var/lib/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules --conf-path=/etc/nginx/nginx.conf --pid-path=/run/nginx/nginx.pid --lock-path=/run/nginx/nginx.lock --http-client-body-temp-path=/var/tmp/nginx/client_body --http-proxy-temp-path=/var/tmp/nginx/proxy --http-fastcgi-temp-path=/var/tmp/nginx/fastcgi --http-uwsgi-temp-path=/var/tmp/nginx/uwsgi --http-scgi-temp-path=/var/tmp/nginx/scgi --user=nginx --group=nginx --with-threads --with-file-aio --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_xslt_module=dynamic --with-http_image_filter_module=dynamic --with-http_geoip_module=dynamic --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_degradation_module --with-http_slice_module --with-http_stub_status_module --with-mail=dynamic --with-mail_ssl_module --with-stream=dynamic --with-stream_ssl_module --with-stream_realip_module --with-stream_geoip_module=dynamic --with-stream_ssl_preread_module --add-dynamic-module=/tmp/ngx_devel_kit --add-dynamic-module=/tmp/lua-nginx-module \\\n && make build \\\n && cp objs/ndk_http_module.so /usr/lib/nginx/modules/ndk_http_module.so \\\n && cp objs/ngx_http_lua_module.so /usr/lib/nginx/modules/ngx_http_lua_module.so \\\n && cd /tmp \\\n && rm -R /tmp/*\n#  S3FS\nARG S3FS_VERSION=1.84\nRUN mkdir /usr/src/omaha-server \\\n && wget --no-check-certificate https://github.com/s3fs-fuse/s3fs-fuse/archive/v${S3FS_VERSION}.tar.gz -O /usr/src/omaha-server/v${S3FS_VERSION}.tar.gz \\\n && tar xvz -C /usr/src/omaha-server -f /usr/src/omaha-server/v${S3FS_VERSION}.tar.gz \\\n && cd /usr/src/omaha-server/s3fs-fuse-${S3FS_VERSION} \\\n && ./autogen.sh \\\n && ./configure --prefix=/usr \\\n && make \\\n && make install \\\n && mkdir -p /srv/omaha_s3 \\\n && rm /usr/src/omaha-server/v${S3FS_VERSION}.tar.gz\n#  Filebeat\nARG FILEBEAT_PACKEGE=filebeat-6.0.0-linux-x86_64\nRUN wget https://artifacts.elastic.co/downloads/beats/filebeat/${FILEBEAT_PACKEGE}.tar.gz -O /usr/src/omaha-server/${FILEBEAT_PACKEGE}.tar.gz \\\n && tar xzvf /usr/src/omaha-server/${FILEBEAT_PACKEGE}.tar.gz -C /etc/ \\\n && mv /etc/${FILEBEAT_PACKEGE} /etc/filebeat \\\n && mkdir /tmp/filebeat/ \\\n && ln /etc/filebeat/filebeat /usr/bin/\n#  Clean Up\nRUN rm -rf /var/cache/apk/* \\\n && apk del fuse-deps dev-deps\n#  Setup application dependencies\nRUN mkdir -p $OMAHA_SERVER_PATH/requirements\nADD Pipfile Pipfile.lock $OMAHA_SERVER_PATH/\n#  Dependencies for Pillow\nRUN apk add jpeg-dev libjpeg \\\n && apk add rsyslog\nRUN pip install pipenv \\\n && pipenv install --system --deploy\n","injectedSmells":[],"originalDockerfileHash":"a7c697729e6b8ce7ce55f69bf8cc00b6","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM python:3.7-alpine3.9\nENV OMAHA_SERVER_PATH=\"/srv/omaha\"\nWORKDIR ${OMAHA_SERVER_PATH}\n#   Add low-level dependencies\nRUN apk add bash ca-certificates \\\n && apk add nginx supervisor openrc \\\n && apk add --virtual dev-deps build-base \\\n && apk add py3-lxml py-psycopg2 py-pillow \\\n && apk add fuse-dev libxml2-dev libxslt-dev libcurl curl-dev libstdc++ \\\n && apk add --virtual fuse-deps autoconf automake libtool pkgconfig openssl-dev wget tar \\\n && apk add linux-headers pcre-dev gd-dev geoip-dev \\\n && apk add openssl pcre zlib zlib-dev \\\n && apk add build-base lua5.1-dev luarocks \\\n && apk add --no-cache postgresql-libs postgresql-dev libc6-compat gzip \\\n && apk add --no-cache libffi-dev \\\n && pip install lxml\n#   Prepare for building Nginx. Intsall LuaJIT.\nRUN apk add luajit luajit-dev nginx-lua nginx-mod-http-lua \\\n && wget http://luajit.org/download/LuaJIT-2.1.0-beta3.tar.gz \\\n && tar -xzvf LuaJIT-2.1.0-beta3.tar.gz \\\n && rm LuaJIT-2.1.0-beta3.tar.gz \\\n && cd LuaJIT-2.1.0-beta3 \\\n && make \\\n && make install\nENV LUAJIT_LIB=\"/usr/local/lib\"\nENV LUAJIT_INC=\"/usr/local/include/luajit-2.1\"\n#   Build Lua module for Nginx\nRUN luarocks-5.1 install lua-zlib \\\n && cd /tmp \\\n && NGINX_VERSION=`nginx -v 2>&1 | grep -o '[[:digit:]].*$' ` \\\n && wget http://nginx.org/download/nginx-$NGINX_VERSION.tar.gz \\\n && tar -xzvf nginx-$NGINX_VERSION.tar.gz \\\n && wget -qO- https://api.github.com/repos/openresty/lua-nginx-module/tags | grep -m 1 tarball_url | cut -d '\"' -f 4 | xargs wget -O lua-nginx-module.tar \\\n && mkdir -p /tmp/lua-nginx-module \\\n && tar -xvf lua-nginx-module.tar -C /tmp/lua-nginx-module --strip-components=1 \\\n && wget -qO- https://api.github.com/repos/simpl/ngx_devel_kit/tags | grep -m 1 tarball_url | cut -d '\"' -f 4 | xargs wget -O ngx_devel_kit.tar \\\n && mkdir -p /tmp/ngx_devel_kit \\\n && tar -xvf ngx_devel_kit.tar -C /tmp/ngx_devel_kit --strip-components=1 \\\n && cd nginx-$NGINX_VERSION \\\n && ./configure --prefix=/var/lib/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules --conf-path=/etc/nginx/nginx.conf --pid-path=/run/nginx/nginx.pid --lock-path=/run/nginx/nginx.lock --http-client-body-temp-path=/var/tmp/nginx/client_body --http-proxy-temp-path=/var/tmp/nginx/proxy --http-fastcgi-temp-path=/var/tmp/nginx/fastcgi --http-uwsgi-temp-path=/var/tmp/nginx/uwsgi --http-scgi-temp-path=/var/tmp/nginx/scgi --user=nginx --group=nginx --with-threads --with-file-aio --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_xslt_module=dynamic --with-http_image_filter_module=dynamic --with-http_geoip_module=dynamic --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_degradation_module --with-http_slice_module --with-http_stub_status_module --with-mail=dynamic --with-mail_ssl_module --with-stream=dynamic --with-stream_ssl_module --with-stream_realip_module --with-stream_geoip_module=dynamic --with-stream_ssl_preread_module --add-dynamic-module=/tmp/ngx_devel_kit --add-dynamic-module=/tmp/lua-nginx-module \\\n && make build \\\n && cp objs/ndk_http_module.so /usr/lib/nginx/modules/ndk_http_module.so \\\n && cp objs/ngx_http_lua_module.so /usr/lib/nginx/modules/ngx_http_lua_module.so \\\n && cd /tmp \\\n && rm -R /tmp/*\n#   S3FS\nARG S3FS_VERSION=1.84\nRUN mkdir /usr/src/omaha-server \\\n && wget --no-check-certificate https://github.com/s3fs-fuse/s3fs-fuse/archive/v${S3FS_VERSION}.tar.gz -O /usr/src/omaha-server/v${S3FS_VERSION}.tar.gz \\\n && tar xvz -C /usr/src/omaha-server -f /usr/src/omaha-server/v${S3FS_VERSION}.tar.gz \\\n && cd /usr/src/omaha-server/s3fs-fuse-${S3FS_VERSION} \\\n && ./autogen.sh \\\n && ./configure --prefix=/usr \\\n && make \\\n && make install \\\n && mkdir -p /srv/omaha_s3 \\\n && rm /usr/src/omaha-server/v${S3FS_VERSION}.tar.gz\n#   Filebeat\nARG FILEBEAT_PACKEGE=filebeat-6.0.0-linux-x86_64\nRUN wget https://artifacts.elastic.co/downloads/beats/filebeat/${FILEBEAT_PACKEGE}.tar.gz -O /usr/src/omaha-server/${FILEBEAT_PACKEGE}.tar.gz \\\n && tar xzvf /usr/src/omaha-server/${FILEBEAT_PACKEGE}.tar.gz -C /etc/ \\\n && mv /etc/${FILEBEAT_PACKEGE} /etc/filebeat \\\n && mkdir /tmp/filebeat/ \\\n && ln /etc/filebeat/filebeat /usr/bin/\n#   Clean Up\nRUN rm -rf /var/cache/apk/* \\\n && apk del fuse-deps dev-deps\n#   Setup application dependencies\nRUN mkdir -p $OMAHA_SERVER_PATH/requirements\nADD Pipfile Pipfile.lock $OMAHA_SERVER_PATH/\n#   Dependencies for Pillow\nRUN apk add jpeg-dev libjpeg \\\n && apk add rsyslog\nRUN pip install pipenv \\\n && pipenv install --system --deploy\n","originalDockerfileUglifiedHash":"298b10ba1ff327112f9637eee668f72d","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/806cd14fc9f9ed261944fc742f5c11cff464f288.dockerfile"}