{"seed":3956170872,"processedDockerfileHash":"c5bab8140e4ba5aa4babe89e78c8d67b","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM idoall/ubuntu16.04-nginx:1.12.1\nMAINTAINER lion <lion.net@163.com>\nARG DEBIAN_FRONTEND=noninteractive\nCOPY files/ /\nENV PHP_VERSION=\"7.1.9\"\n#   -----------------------------------------------------------------------------\n#   基础工具\n#   -----------------------------------------------------------------------------\nRUN apt-fast update -y \\\n && apt-fast install -y imagemagick graphicsmagick libmemcached-dev libxml2 libxml2-dev libcurl3-openssl-dev libjpeg-dev libpng-dev libfreetype6-dev libmcrypt-dev git autoconf \\\n && ln -s /usr/lib/x86_64-linux-gnu/libssl.so /usr/lib\n#   -----------------------------------------------------------------------------\n#   安装 PHP \n#   -----------------------------------------------------------------------------\nRUN cd /home/work/_src \\\n && axel -n 10 -o /home/work/_src/php.tgz http://cn2.php.net/distributions/php-$PHP_VERSION.tar.gz \\\n && tar xzvf php.tgz \\\n && cd php-$PHP_VERSION \\\n && ./configure --prefix=/home/work/_app/php7.1.9 --with-config-file-path=/home/work/_app/php7.1.9/etc --with-mcrypt=/usr/include --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-gd --with-iconv --with-zlib --enable-xml --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --enable-mbregex --enable-fpm --enable-mbstring --enable-ftp --enable-gd-native-ttf --with-openssl --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --without-pear --with-gettext --enable-session --with-curl --with-jpeg-dir --with-freetype-dir --enable-opcache \\\n && make \\\n && make install \\\n && cp php.ini-production /home/work/_app/php7.1.9/etc/php.ini \\\n && cp /home/work/_app/php7.1.9/etc/php-fpm.conf.default /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n && cp /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf.default /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && mkdir -p /home/work/_logs/php /home/work/_app/php7.1.9/session \\\n && chmod o=rwx -R /home/work/_app/php7.1.9/session \\\n && sed -i \"s/pdo_mysql.default_socket=/pdo_mysql.default_socket=\\/tmp\\/mysql.sock/\" /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i \"s/;date.timezone =.*/date.timezone = Asia\\/Shanghai/\" /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/max_execution_time = 30/max_execution_time = 300/g' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/upload_max_filesize = 2M/upload_max_filesize = 256M/g' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/post_max_size = 8M/post_max_size = 512M/g' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/memory_limit = 128M/memory_limit = 256M/g' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/;session.save_path = .*/session.save_path = \"\\/home\\/work\\/_app\\/php7.1.9\\/session\"/' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i \"s/;error_log = log\\/php-fpm.log/error_log = \\/home\\/work\\/_logs\\/php\\/php-fpm.error.log/\" /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n && sed -i \"s/listen = 127.0.0.1:9000/listen = \\/var\\/run\\/php-fpm.sock/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/user = nobody/user = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/group = nobody/group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.owner = nobody/listen.owner = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.group = work/listen.group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.mode = 0660/listen.mode = 0666/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;access.log = log\\/$pool.access.log/access.log = \\/home\\/work\\/_logs\\/php\\/php.access.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;slowlog = log\\/$pool.log.slow/slowlog = \\/home\\/work\\/_logs\\/php\\/fpm-php.slow.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;request_slowlog_timeout = 0/request_slowlog_timeout = 10s/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;php_admin_value\\[error_log\\] = \\/var\\/log\\/fpm-php.www.log/php_admin_value\\[error_log\\] = \\/home\\/work\\/_logs\\/php\\/php-fpm.www.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i -e 's/fastcgi_param SERVER_PORT $server_port;/fastcgi_param SERVER_PORT $http_x_forwarded_port;/g' /home/work/_app/nginx/conf/fastcgi.conf \\\n && sed -i -e 's/fastcgi_param SERVER_PORT $server_port;/fastcgi_param SERVER_PORT $http_x_forwarded_port;/g' /home/work/_app/nginx/conf/fastcgi_params \\\n && echo \"<?php phpinfo(); ?>\" > /home/work/_app/nginx/html/index.php\n#   -----------------------------------------------------------------------------\n#   安装 php-redis\n#   ----------------------------------------------------------------------------- \nRUN export PATH=$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin \\\n && cd /home/work/_src \\\n && git clone https://github.com/phpredis/phpredis.git \\\n && cd phpredis \\\n && phpize \\\n && ./configure \\\n && make \\\n && make install \\\n && echo \"extension=redis.so\" >> /home/work/_app/php7.1.9/etc/php.ini\n#   -----------------------------------------------------------------------------\n#   安装 php-memcached\n#   ----------------------------------------------------------------------------- \nRUN export PATH=$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin \\\n && cd /home/work/_src \\\n && git clone https://github.com/php-memcached-dev/php-memcached.git \\\n && cd php-memcached \\\n && git checkout php7 \\\n && phpize \\\n && ./configure \\\n && make \\\n && make install \\\n && echo \"extension=memcached.so\" >> /home/work/_app/php7.1.9/etc/php.ini\n#   -----------------------------------------------------------------------------\n#   清除\n#   -----------------------------------------------------------------------------\nRUN chmod 755 /hooks \\\n && chown -R work:work /home/work/* \\\n && apt-get -y clean \\\n && rm -rf /var/lib/apt/lists/* \\\n && rm -rf /var/cache/apt/archives/apt-fast/* \\\n && rm -rf /home/work/_src/*\n#   -----------------------------------------------------------------------------\n#   设置变量\n#   -----------------------------------------------------------------------------\nENV PATH=\"$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin\"\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM idoall/ubuntu16.04-nginx:1.12.1\nMAINTAINER lion <lion.net@163.com>\nARG DEBIAN_FRONTEND=noninteractive\nCOPY files/ /\nENV PHP_VERSION=\"7.1.9\"\n#  -----------------------------------------------------------------------------\n#  基础工具\n#  -----------------------------------------------------------------------------\nRUN apt-fast update -y \\\n && apt-fast install -y imagemagick graphicsmagick libmemcached-dev libxml2 libxml2-dev libcurl3-openssl-dev libjpeg-dev libpng-dev libfreetype6-dev libmcrypt-dev git autoconf \\\n && ln -s /usr/lib/x86_64-linux-gnu/libssl.so /usr/lib\n#  -----------------------------------------------------------------------------\n#  安装 PHP \n#  -----------------------------------------------------------------------------\nRUN cd /home/work/_src \\\n && axel -n 10 -o /home/work/_src/php.tgz http://cn2.php.net/distributions/php-$PHP_VERSION.tar.gz \\\n && tar xzvf php.tgz \\\n && cd php-$PHP_VERSION \\\n && ./configure --prefix=/home/work/_app/php7.1.9 --with-config-file-path=/home/work/_app/php7.1.9/etc --with-mcrypt=/usr/include --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-gd --with-iconv --with-zlib --enable-xml --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --enable-mbregex --enable-fpm --enable-mbstring --enable-ftp --enable-gd-native-ttf --with-openssl --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --without-pear --with-gettext --enable-session --with-curl --with-jpeg-dir --with-freetype-dir --enable-opcache \\\n && make \\\n && make install \\\n && cp php.ini-production /home/work/_app/php7.1.9/etc/php.ini \\\n && cp /home/work/_app/php7.1.9/etc/php-fpm.conf.default /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n && cp /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf.default /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && mkdir -p /home/work/_logs/php /home/work/_app/php7.1.9/session \\\n && chmod o=rwx -R /home/work/_app/php7.1.9/session \\\n && sed -i \"s/pdo_mysql.default_socket=/pdo_mysql.default_socket=\\/tmp\\/mysql.sock/\" /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i \"s/;date.timezone =.*/date.timezone = Asia\\/Shanghai/\" /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/max_execution_time = 30/max_execution_time = 300/g' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/upload_max_filesize = 2M/upload_max_filesize = 256M/g' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/post_max_size = 8M/post_max_size = 512M/g' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/memory_limit = 128M/memory_limit = 256M/g' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/;session.save_path = .*/session.save_path = \"\\/home\\/work\\/_app\\/php7.1.9\\/session\"/' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i \"s/;error_log = log\\/php-fpm.log/error_log = \\/home\\/work\\/_logs\\/php\\/php-fpm.error.log/\" /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n && sed -i \"s/listen = 127.0.0.1:9000/listen = \\/var\\/run\\/php-fpm.sock/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/user = nobody/user = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/group = nobody/group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.owner = nobody/listen.owner = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.group = work/listen.group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.mode = 0660/listen.mode = 0666/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;access.log = log\\/$pool.access.log/access.log = \\/home\\/work\\/_logs\\/php\\/php.access.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;slowlog = log\\/$pool.log.slow/slowlog = \\/home\\/work\\/_logs\\/php\\/fpm-php.slow.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;request_slowlog_timeout = 0/request_slowlog_timeout = 10s/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;php_admin_value\\[error_log\\] = \\/var\\/log\\/fpm-php.www.log/php_admin_value\\[error_log\\] = \\/home\\/work\\/_logs\\/php\\/php-fpm.www.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i -e 's/fastcgi_param SERVER_PORT $server_port;/fastcgi_param SERVER_PORT $http_x_forwarded_port;/g' /home/work/_app/nginx/conf/fastcgi.conf \\\n && sed -i -e 's/fastcgi_param SERVER_PORT $server_port;/fastcgi_param SERVER_PORT $http_x_forwarded_port;/g' /home/work/_app/nginx/conf/fastcgi_params \\\n && echo \"<?php phpinfo(); ?>\" > /home/work/_app/nginx/html/index.php\n#  -----------------------------------------------------------------------------\n#  安装 php-redis\n#  ----------------------------------------------------------------------------- \nRUN export PATH=$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin \\\n && cd /home/work/_src \\\n && git clone https://github.com/phpredis/phpredis.git \\\n && cd phpredis \\\n && phpize \\\n && ./configure \\\n && make \\\n && make install \\\n && echo \"extension=redis.so\" >> /home/work/_app/php7.1.9/etc/php.ini\n#  -----------------------------------------------------------------------------\n#  安装 php-memcached\n#  ----------------------------------------------------------------------------- \nRUN export PATH=$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin \\\n && cd /home/work/_src \\\n && git clone https://github.com/php-memcached-dev/php-memcached.git \\\n && cd php-memcached \\\n && git checkout php7 \\\n && phpize \\\n && ./configure \\\n && make \\\n && make install \\\n && echo \"extension=memcached.so\" >> /home/work/_app/php7.1.9/etc/php.ini\n#  -----------------------------------------------------------------------------\n#  清除\n#  -----------------------------------------------------------------------------\nRUN chmod 755 /hooks \\\n && chown -R work:work /home/work/* \\\n && apt-get -y clean \\\n && rm -rf /var/lib/apt/lists/* \\\n && rm -rf /var/cache/apt/archives/apt-fast/* \\\n && rm -rf /home/work/_src/*\n#  -----------------------------------------------------------------------------\n#  设置变量\n#  -----------------------------------------------------------------------------\nENV PATH=\"$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin\"\n","injectedSmells":[],"originalDockerfileHash":"0dba9eecaa0d25c96fa37c08ebce6078","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM idoall/ubuntu16.04-nginx:1.12.1\nMAINTAINER lion <lion.net@163.com>\nARG DEBIAN_FRONTEND=noninteractive\nCOPY files/ /\nENV PHP_VERSION=\"7.1.9\"\n#   -----------------------------------------------------------------------------\n#   基础工具\n#   -----------------------------------------------------------------------------\nRUN apt-fast update -y \\\n && apt-fast install -y imagemagick graphicsmagick libmemcached-dev libxml2 libxml2-dev libcurl3-openssl-dev libjpeg-dev libpng-dev libfreetype6-dev libmcrypt-dev git autoconf \\\n && ln -s /usr/lib/x86_64-linux-gnu/libssl.so /usr/lib\n#   -----------------------------------------------------------------------------\n#   安装 PHP \n#   -----------------------------------------------------------------------------\nRUN cd /home/work/_src \\\n && axel -n 10 -o /home/work/_src/php.tgz http://cn2.php.net/distributions/php-$PHP_VERSION.tar.gz \\\n && tar xzvf php.tgz \\\n && cd php-$PHP_VERSION \\\n && ./configure --prefix=/home/work/_app/php7.1.9 --with-config-file-path=/home/work/_app/php7.1.9/etc --with-mcrypt=/usr/include --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-gd --with-iconv --with-zlib --enable-xml --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --enable-mbregex --enable-fpm --enable-mbstring --enable-ftp --enable-gd-native-ttf --with-openssl --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --without-pear --with-gettext --enable-session --with-curl --with-jpeg-dir --with-freetype-dir --enable-opcache \\\n && make \\\n && make install \\\n && cp php.ini-production /home/work/_app/php7.1.9/etc/php.ini \\\n && cp /home/work/_app/php7.1.9/etc/php-fpm.conf.default /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n && cp /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf.default /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && mkdir -p /home/work/_logs/php /home/work/_app/php7.1.9/session \\\n && chmod o=rwx -R /home/work/_app/php7.1.9/session \\\n && sed -i \"s/pdo_mysql.default_socket=/pdo_mysql.default_socket=\\/tmp\\/mysql.sock/\" /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i \"s/;date.timezone =.*/date.timezone = Asia\\/Shanghai/\" /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/max_execution_time = 30/max_execution_time = 300/g' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/upload_max_filesize = 2M/upload_max_filesize = 256M/g' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/post_max_size = 8M/post_max_size = 512M/g' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/memory_limit = 128M/memory_limit = 256M/g' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/;session.save_path = .*/session.save_path = \"\\/home\\/work\\/_app\\/php7.1.9\\/session\"/' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i \"s/;error_log = log\\/php-fpm.log/error_log = \\/home\\/work\\/_logs\\/php\\/php-fpm.error.log/\" /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n && sed -i \"s/listen = 127.0.0.1:9000/listen = \\/var\\/run\\/php-fpm.sock/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/user = nobody/user = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/group = nobody/group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.owner = nobody/listen.owner = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.group = work/listen.group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.mode = 0660/listen.mode = 0666/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;access.log = log\\/$pool.access.log/access.log = \\/home\\/work\\/_logs\\/php\\/php.access.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;slowlog = log\\/$pool.log.slow/slowlog = \\/home\\/work\\/_logs\\/php\\/fpm-php.slow.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;request_slowlog_timeout = 0/request_slowlog_timeout = 10s/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;php_admin_value\\[error_log\\] = \\/var\\/log\\/fpm-php.www.log/php_admin_value\\[error_log\\] = \\/home\\/work\\/_logs\\/php\\/php-fpm.www.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i -e 's/fastcgi_param SERVER_PORT $server_port;/fastcgi_param SERVER_PORT $http_x_forwarded_port;/g' /home/work/_app/nginx/conf/fastcgi.conf \\\n && sed -i -e 's/fastcgi_param SERVER_PORT $server_port;/fastcgi_param SERVER_PORT $http_x_forwarded_port;/g' /home/work/_app/nginx/conf/fastcgi_params \\\n && echo \"<?php phpinfo(); ?>\" > /home/work/_app/nginx/html/index.php\n#   -----------------------------------------------------------------------------\n#   安装 php-redis\n#   ----------------------------------------------------------------------------- \nRUN export PATH=$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin \\\n && cd /home/work/_src \\\n && git clone https://github.com/phpredis/phpredis.git \\\n && cd phpredis \\\n && phpize \\\n && ./configure \\\n && make \\\n && make install \\\n && echo \"extension=redis.so\" >> /home/work/_app/php7.1.9/etc/php.ini\n#   -----------------------------------------------------------------------------\n#   安装 php-memcached\n#   ----------------------------------------------------------------------------- \nRUN export PATH=$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin \\\n && cd /home/work/_src \\\n && git clone https://github.com/php-memcached-dev/php-memcached.git \\\n && cd php-memcached \\\n && git checkout php7 \\\n && phpize \\\n && ./configure \\\n && make \\\n && make install \\\n && echo \"extension=memcached.so\" >> /home/work/_app/php7.1.9/etc/php.ini\n#   -----------------------------------------------------------------------------\n#   清除\n#   -----------------------------------------------------------------------------\nRUN chmod 755 /hooks \\\n && chown -R work:work /home/work/* \\\n && apt-get -y clean \\\n && rm -rf /var/lib/apt/lists/* \\\n && rm -rf /var/cache/apt/archives/apt-fast/* \\\n && rm -rf /home/work/_src/*\n#   -----------------------------------------------------------------------------\n#   设置变量\n#   -----------------------------------------------------------------------------\nENV PATH=\"$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin\"\n","originalDockerfileUglifiedHash":"69471d880a5d247a4e822966b3b78d79","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/0c403d5246e033c65c5c91c0fc6631b5e91d019e.dockerfile"}