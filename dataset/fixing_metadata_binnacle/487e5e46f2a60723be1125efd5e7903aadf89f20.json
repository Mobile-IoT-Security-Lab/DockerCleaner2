{"seed":3026000174,"processedDockerfileHash":"0f36a248ac6fb9914914a8e64fb7f7fa","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   First stage, install composer and its dependencies and fetch vendor files and submodules\nFROM alpine:3.7\nRUN apk update\nRUN apk add php7=7.1.33-r0 php7-dom=7.1.33-r0 php7-phar=7.1.33-r0 php7-gd=7.1.33-r0 php7-json=7.1.33-r0 php7-mysqli=7.1.33-r0 php7-mysqlnd=7.1.33-r0 php7-mbstring=7.1.33-r0 php7-ctype=7.1.33-r0 php7-iconv=7.1.33-r0 php7-tokenizer=7.1.33-r0 php7-openssl=7.1.33-r0 php7-xml=7.1.33-r0 php7-simplexml=7.1.33-r0 php7-xmlwriter=7.1.33-r0 php7-zlib php7-curl=7.1.33-r0 git=2.15.4-r0 curl=7.61.1-r3 --no-cache\nRUN mkdir /app \\\n && curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer\nWORKDIR /app\nCOPY . /app/\nRUN git submodule init\nRUN git submodule update --recursive --init\nARG COMPOSER_ALLOW_SUPERUSER=1\nARG COMPOSER_NO_INTERACTION=1\nRUN cd /app/extensions/OpenIDConnect \\\n && composer install --no-dev\nRUN cd /app/extensions/PluggableAuth \\\n && composer install --no-dev\n#   Cleanup before copying over to next stage - version history takes up a lot of space\nRUN rm -rf .git/\n#   Second stage, build usable container\nFROM alpine:3.7\nLABEL maintainer=\"Ilia Salem\"\nRUN apk add apache2=2.4.41-r0 php7=7.1.33-r0 php7-apache2=7.1.33-r0 php7-curl=7.1.33-r0 php7-dom=7.1.33-r0 php7-gd=7.1.33-r0 php7-json=7.1.33-r0 php7-mysqli=7.1.33-r0 php7-mbstring=7.1.33-r0 php7-ctype=7.1.33-r0 php7-iconv=7.1.33-r0 php7-xml=7.1.33-r0 php7-session=7.1.33-r0 php7-curl=7.1.33-r0 php7-fileinfo=7.1.33-r0 php7-zlib php7-xmlreader=7.1.33-r0 php7-opcache=7.1.33-r0 php7-intl=7.1.33-r0 php7-apcu=5.1.11-r0 curl=7.61.1-r3 python3=3.6.9-r1 --no-cache \\\n && apk update \\\n && mkdir -p /data \\\n && mkdir -p /run/apache2 \\\n && chown apache /data \\\n && ln -s /dev/stderr /var/log/apache2/error.log \\\n && ln -s /dev/stdout /var/log/apache2/access.log \\\n && sed -i '/#LoadModule rewrite_module modules\\/mod_rewrite.so/c\\LoadModule rewrite_module modules\\/mod_rewrite.so' /etc/apache2/httpd.conf \\\n && sed -i '/DocumentRoot \"\\/var\\/www\\/localhost\\/htdocs\"/c\\DocumentRoot \"\\/var\\/www\\/html\\/docker_gcpedia\"' /etc/apache2/httpd.conf \\\n && sed -i '/Options Indexes FollowSymLinks/c\\\\' /etc/apache2/httpd.conf \\\n && sed -i '/AllowOverride None/c\\\\' /etc/apache2/httpd.conf \\\n && sed -i '/Options Indexes FollowSymLinks/c\\\\' /etc/apache2/httpd.conf \\\n && sed -i '/<Directory \"\\/var\\/www\\/localhost\\/htdocs\">/c\\<Directory \"\\/var\\/www\\/html\\/docker_gcpedia\">\\nDirectoryIndex index.php\\nOptions FollowSymLinks MultiViews\\nAllowOverride All\\nOrder allow,deny\\nallow from all\\n' /etc/apache2/httpd.conf\nRUN { echo 'opcache.memory_consumption=128' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=4000' ;echo 'opcache.revalidate_freq=60' ;echo 'opcache.fast_shutdown=1' ;echo 'opcache.enable_cli=1' ; } > /etc/php7/conf.d/opcache-recommended.ini\nWORKDIR /var/www/html/docker_gcpedia\n#   Version\nENV MEDIAWIKI_MAJOR_VERSION=\"1.31\"\nENV MEDIAWIKI_BRANCH=\"REL1_31\"\nENV MEDIAWIKI_VERSION=\"1.31.1\"\nENV MEDIAWIKI_SHA512=\"ee49649cc37d0a7d45a7c6d90c822c2a595df290be2b5bf085affbec3318768700a458a6e5b5b7e437651400b9641424429d6d304f870c22ec63fae86ffc5152\"\n#   MediaWiki setup\nRUN curl -fSL \"https://releases.wikimedia.org/mediawiki/${MEDIAWIKI_MAJOR_VERSION}/mediawiki-${MEDIAWIKI_VERSION}.tar.gz\" -o mediawiki.tar.gz \\\n && echo \"${MEDIAWIKI_SHA512} *mediawiki.tar.gz\" | sha512sum -c - \\\n && tar -xz --strip-components=1 -f mediawiki.tar.gz \\\n && rm mediawiki.tar.gz \\\n && chown -R apache:apache extensions skins cache images\nCOPY --from=0 /app/ /var/www/html/docker_gcpedia/\n#   for automated install\nRUN chown apache:apache /var/www/html/docker_gcpedia/\nRUN mkdir /super\nRUN mv /var/www/html/docker_gcpedia/docker/secrets.php /super/secrets.php\nRUN chown apache:apache /super/secrets.php\nEXPOSE 80/tcp\nRUN chmod +x docker/start.sh\n#   Start Apache in foreground mode\nRUN rm -f /run/apache2/httpd.pid\nENTRYPOINT [\"docker/start.sh\"]\nCMD [\"/usr/sbin/httpd\", \"-D\", \"FOREGROUND\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  First stage, install composer and its dependencies and fetch vendor files and submodules\nFROM alpine:3.7\nRUN apk update\nRUN apk --no-cache add php7 php7-dom php7-phar php7-gd php7-json php7-mysqli php7-mysqlnd php7-mbstring php7-ctype php7-iconv php7-tokenizer php7-openssl php7-xml php7-simplexml php7-xmlwriter php7-zlib php7-curl git curl\nRUN mkdir /app \\\n && curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer\nWORKDIR /app\nCOPY . /app/\nRUN git submodule init\nRUN git submodule update --recursive --init\nARG COMPOSER_ALLOW_SUPERUSER=1\nARG COMPOSER_NO_INTERACTION=1\nRUN cd /app/extensions/OpenIDConnect \\\n && composer install --no-dev\nRUN cd /app/extensions/PluggableAuth \\\n && composer install --no-dev\n#  Cleanup before copying over to next stage - version history takes up a lot of space\nRUN rm -rf .git/\n#  Second stage, build usable container\nFROM alpine:3.7\nLABEL maintainer=\"Ilia Salem\"\nRUN apk --no-cache add apache2 php7 php7-apache2 php7-curl php7-dom php7-gd php7-json php7-mysqli php7-mbstring php7-ctype php7-iconv php7-xml php7-session php7-curl php7-fileinfo php7-zlib php7-xmlreader php7-opcache php7-intl php7-apcu curl python3 \\\n && apk update \\\n && mkdir -p /data \\\n && mkdir -p /run/apache2 \\\n && chown apache /data \\\n && ln -s /dev/stderr /var/log/apache2/error.log \\\n && ln -s /dev/stdout /var/log/apache2/access.log \\\n && sed -i '/#LoadModule rewrite_module modules\\/mod_rewrite.so/c\\LoadModule rewrite_module modules\\/mod_rewrite.so' /etc/apache2/httpd.conf \\\n && sed -i '/DocumentRoot \"\\/var\\/www\\/localhost\\/htdocs\"/c\\DocumentRoot \"\\/var\\/www\\/html\\/docker_gcpedia\"' /etc/apache2/httpd.conf \\\n && sed -i '/Options Indexes FollowSymLinks/c\\\\' /etc/apache2/httpd.conf \\\n && sed -i '/AllowOverride None/c\\\\' /etc/apache2/httpd.conf \\\n && sed -i '/Options Indexes FollowSymLinks/c\\\\' /etc/apache2/httpd.conf \\\n && sed -i '/<Directory \"\\/var\\/www\\/localhost\\/htdocs\">/c\\<Directory \"\\/var\\/www\\/html\\/docker_gcpedia\">\\nDirectoryIndex index.php\\nOptions FollowSymLinks MultiViews\\nAllowOverride All\\nOrder allow,deny\\nallow from all\\n' /etc/apache2/httpd.conf\nRUN { echo 'opcache.memory_consumption=128' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=4000' ;echo 'opcache.revalidate_freq=60' ;echo 'opcache.fast_shutdown=1' ;echo 'opcache.enable_cli=1' ; } > /etc/php7/conf.d/opcache-recommended.ini\nWORKDIR /var/www/html/docker_gcpedia\n#  Version\nENV MEDIAWIKI_MAJOR_VERSION=\"1.31\"\nENV MEDIAWIKI_BRANCH=\"REL1_31\"\nENV MEDIAWIKI_VERSION=\"1.31.1\"\nENV MEDIAWIKI_SHA512=\"ee49649cc37d0a7d45a7c6d90c822c2a595df290be2b5bf085affbec3318768700a458a6e5b5b7e437651400b9641424429d6d304f870c22ec63fae86ffc5152\"\n#  MediaWiki setup\nRUN curl -fSL \"https://releases.wikimedia.org/mediawiki/${MEDIAWIKI_MAJOR_VERSION}/mediawiki-${MEDIAWIKI_VERSION}.tar.gz\" -o mediawiki.tar.gz \\\n && echo \"${MEDIAWIKI_SHA512} *mediawiki.tar.gz\" | sha512sum -c - \\\n && tar -xz --strip-components=1 -f mediawiki.tar.gz \\\n && rm mediawiki.tar.gz \\\n && chown -R apache:apache extensions skins cache images\nCOPY --from=0 /app/ /var/www/html/docker_gcpedia/\n#  for automated install\nRUN chown apache:apache /var/www/html/docker_gcpedia/\nRUN mkdir /super\nRUN mv /var/www/html/docker_gcpedia/docker/secrets.php /super/secrets.php\nRUN chown apache:apache /super/secrets.php\nEXPOSE 80/tcp\nRUN chmod +x docker/start.sh\n#  Start Apache in foreground mode\nRUN rm -f /run/apache2/httpd.pid\nENTRYPOINT [\"docker/start.sh\"]\nCMD [\"/usr/sbin/httpd\", \"-D\", \"FOREGROUND\"]\n","injectedSmells":[],"originalDockerfileHash":"7562866843594853f08006eab45d192e","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   First stage, install composer and its dependencies and fetch vendor files and submodules\nFROM alpine:3.7\nRUN apk update\nRUN apk --no-cache add php7 php7-dom php7-phar php7-gd php7-json php7-mysqli php7-mysqlnd php7-mbstring php7-ctype php7-iconv php7-tokenizer php7-openssl php7-xml php7-simplexml php7-xmlwriter php7-zlib php7-curl git curl\nRUN mkdir /app \\\n && curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer\nWORKDIR /app\nCOPY . /app/\nRUN git submodule init\nRUN git submodule update --recursive --init\nARG COMPOSER_ALLOW_SUPERUSER=1\nARG COMPOSER_NO_INTERACTION=1\nRUN cd /app/extensions/OpenIDConnect \\\n && composer install --no-dev\nRUN cd /app/extensions/PluggableAuth \\\n && composer install --no-dev\n#   Cleanup before copying over to next stage - version history takes up a lot of space\nRUN rm -rf .git/\n#   Second stage, build usable container\nFROM alpine:3.7\nLABEL maintainer=\"Ilia Salem\"\nRUN apk --no-cache add apache2 php7 php7-apache2 php7-curl php7-dom php7-gd php7-json php7-mysqli php7-mbstring php7-ctype php7-iconv php7-xml php7-session php7-curl php7-fileinfo php7-zlib php7-xmlreader php7-opcache php7-intl php7-apcu curl python3 \\\n && apk update \\\n && mkdir -p /data \\\n && mkdir -p /run/apache2 \\\n && chown apache /data \\\n && ln -s /dev/stderr /var/log/apache2/error.log \\\n && ln -s /dev/stdout /var/log/apache2/access.log \\\n && sed -i '/#LoadModule rewrite_module modules\\/mod_rewrite.so/c\\LoadModule rewrite_module modules\\/mod_rewrite.so' /etc/apache2/httpd.conf \\\n && sed -i '/DocumentRoot \"\\/var\\/www\\/localhost\\/htdocs\"/c\\DocumentRoot \"\\/var\\/www\\/html\\/docker_gcpedia\"' /etc/apache2/httpd.conf \\\n && sed -i '/Options Indexes FollowSymLinks/c\\\\' /etc/apache2/httpd.conf \\\n && sed -i '/AllowOverride None/c\\\\' /etc/apache2/httpd.conf \\\n && sed -i '/Options Indexes FollowSymLinks/c\\\\' /etc/apache2/httpd.conf \\\n && sed -i '/<Directory \"\\/var\\/www\\/localhost\\/htdocs\">/c\\<Directory \"\\/var\\/www\\/html\\/docker_gcpedia\">\\nDirectoryIndex index.php\\nOptions FollowSymLinks MultiViews\\nAllowOverride All\\nOrder allow,deny\\nallow from all\\n' /etc/apache2/httpd.conf\nRUN { echo 'opcache.memory_consumption=128' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=4000' ;echo 'opcache.revalidate_freq=60' ;echo 'opcache.fast_shutdown=1' ;echo 'opcache.enable_cli=1' ; } > /etc/php7/conf.d/opcache-recommended.ini\nWORKDIR /var/www/html/docker_gcpedia\n#   Version\nENV MEDIAWIKI_MAJOR_VERSION=\"1.31\"\nENV MEDIAWIKI_BRANCH=\"REL1_31\"\nENV MEDIAWIKI_VERSION=\"1.31.1\"\nENV MEDIAWIKI_SHA512=\"ee49649cc37d0a7d45a7c6d90c822c2a595df290be2b5bf085affbec3318768700a458a6e5b5b7e437651400b9641424429d6d304f870c22ec63fae86ffc5152\"\n#   MediaWiki setup\nRUN curl -fSL \"https://releases.wikimedia.org/mediawiki/${MEDIAWIKI_MAJOR_VERSION}/mediawiki-${MEDIAWIKI_VERSION}.tar.gz\" -o mediawiki.tar.gz \\\n && echo \"${MEDIAWIKI_SHA512} *mediawiki.tar.gz\" | sha512sum -c - \\\n && tar -xz --strip-components=1 -f mediawiki.tar.gz \\\n && rm mediawiki.tar.gz \\\n && chown -R apache:apache extensions skins cache images\nCOPY --from=0 /app/ /var/www/html/docker_gcpedia/\n#   for automated install\nRUN chown apache:apache /var/www/html/docker_gcpedia/\nRUN mkdir /super\nRUN mv /var/www/html/docker_gcpedia/docker/secrets.php /super/secrets.php\nRUN chown apache:apache /super/secrets.php\nEXPOSE 80/tcp\nRUN chmod +x docker/start.sh\n#   Start Apache in foreground mode\nRUN rm -f /run/apache2/httpd.pid\nENTRYPOINT [\"docker/start.sh\"]\nCMD [\"/usr/sbin/httpd\", \"-D\", \"FOREGROUND\"]\n","originalDockerfileUglifiedHash":"d1932e8b2242f89a0122ba8fa5ffefbe","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/487e5e46f2a60723be1125efd5e7903aadf89f20.dockerfile"}