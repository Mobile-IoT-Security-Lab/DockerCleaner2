{"seed":3651076583,"processedDockerfileHash":"ae2d03b7037337eb9880bb3f8d835c78","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   Automatically generated Dockerfile \n#   - Build ${timestamp}\n#   - Lucene/Solr version ${currentLuceneVersion}\n#   - Mtas release ${project.version} \n#\nFROM ubuntu:16.04\nMAINTAINER Matthijs Brouwer, Textexploration.org\nEXPOSE 8983/tcp 80/tcp\nUSER root\nWORKDIR \"/root\" \nRUN mkdir lib\nRUN which wget &> /dev/null || apt-get install --no-install-recommends wget=1.20.3 ; wget --no-verbose --output-document /root/lib/ https://github.com/textexploration/mtas/releases/download/v${project.version}/mtas-${project.version}.jar\nRUN apt-get update \\\n && apt-get install --no-install-recommends locales=2.23-0ubuntu11.3 lsof=4.89+dfsg-0.1 software-properties-common=0.96.20.10 python-software-properties=0.96.20.10 apache2=2.4.18-2ubuntu3.17 curl=7.47.0-1ubuntu2.19 subversion=1.9.3-2ubuntu1.3 -y \\\n && locale-gen en_US.UTF-8 en_US \\\n && update-locale LANG=en_US.UTF-8 LANGUAGE=en_US:en\nRUN mathurl=$( curl -s 'http://www.apache.org/dyn/closer.lua/commons/math/binaries/commons-math3-3.6.1-bin.tar.gz' | grep -o '<strong>[^<]*</strong>' | sed 's/<[^>]*>//g' | head -1 ;) \\\n && if echo \"$mathurl\" | grep -q '^.*[^ ].*$' ; then curl -f -o /root/lib/commons-math3-3.6.1-bin.tar.gz -O $mathurl || true ; fi \\\n && if [ ! -f /root/lib/commons-math3-3.6.1-bin.tar.gz ] ; then echo \"Commons-math3 not found in mirror, falling back to apache archive\" ;mathurl=\"http://archive.apache.org/dist/commons/math/binaries/commons-math3-3.6.1-bin.tar.gz\" ;curl -f -o /root/lib/commons-math3-3.6.1-bin.tar.gz -O $mathurl ; fi \\\n && tar xzf lib/commons-math3-3.6.1-bin.tar.gz -C lib commons-math3-3.6.1/commons-math3-3.6.1.jar --strip-components=1 \\\n && rm lib/commons-math3-3.6.1-bin.tar.gz\nRUN svn export https://github.com/textexploration/mtas/trunk/docker/ data\nRUN add-apt-repository -y ppa:webupd8team/java \\\n && apt-get update \\\n && echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true | /usr/bin/debconf-set-selections \\\n && apt-get install --no-install-recommends oracle-java8-installer -y \\\n && rm -rf /var/lib/apt/lists/*\nRUN solrurl=$( curl -s 'http://www.apache.org/dyn/closer.lua/lucene/solr/${currentLuceneVersion}/solr-${currentLuceneVersion}.tgz' | grep -o '<strong>[^<]*</strong>' | sed 's/<[^>]*>//g' | head -1 ;) \\\n && if echo \"$solrurl\" | grep -q '^.*[^ ].*$' ; then curl -f -o /root/solr-${currentLuceneVersion}.tgz -O $solrurl || true ; fi \\\n && if [ ! -f /root/solr-${currentLuceneVersion}.tgz ] ; then echo \"Solr ${currentLuceneVersion} not found in mirror, falling back to apache archive\" ;solrurl=\"http://archive.apache.org/dist/lucene/solr/${currentLuceneVersion}/solr-${currentLuceneVersion}.tgz\" ;curl -f -o /root/solr-${currentLuceneVersion}.tgz -O $solrurl ; fi \\\n && tar xzf solr-${currentLuceneVersion}.tgz solr-${currentLuceneVersion}/bin/install_solr_service.sh --strip-components=2 \\\n && bash ./install_solr_service.sh solr-${currentLuceneVersion}.tgz \\\n && rm install_solr_service.sh \\\n && rm -rf solr-${currentLuceneVersion}.tgz\nRUN service apache2 stop \\\n && echo \"ServerName localhost\" | tee /etc/apache2/conf-available/fqdn.conf \\\n && a2enmod proxy \\\n && a2enmod proxy_http \\\n && a2enmod proxy_ajp \\\n && a2enmod rewrite \\\n && a2enmod deflate \\\n && a2enmod headers \\\n && a2enmod proxy_balancer \\\n && a2enmod proxy_connect \\\n && a2enmod proxy_html \\\n && a2enmod xml2enc \\\n && a2enconf fqdn \\\n && sed -i '/<\\/VirtualHost>/ i ProxyPass /solr http://localhost:8983/solr\\nProxyPassReverse /solr http://localhost:8983/solr' /etc/apache2/sites-enabled/000-default.conf \\\n && rm -rf /var/www/html/* \\\n && mkdir /var/www/html/demo \\\n && cp -rp data/*-samples /var/www/html/demo/ \\\n && gunzip -r /var/www/html/demo \\\n && cp -rp data/site/* /var/www/html \\\n && chmod -R 755 /var/www/html \\\n && printf \"echo\\n\" >> /start.sh \\\n && printf \"echo \\\"================ Mtas -- Multi Tier Annotation Search =================\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\" Timestamp ${timestamp}\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\" Lucene/Solr version ${currentLuceneVersion}\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\" Mtas release ${project.version}\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\" See https://textexploration.github.io/mtas/ for more information\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\"=======================================================================\\\"\\n\" >> /start.sh \\\n && printf \"echo\\n\" >> /start.sh \\\n && printf \"service solr start\\nservice apache2 start\\n\" >> /start.sh \\\n && chmod 755 /start.sh \\\n && mkdir demo1 \\\n && mkdir demo1/lib \\\n && mkdir demo1/conf \\\n && echo \"name=demo1\" > demo1/core.properties \\\n && cp lib/commons-math3-3.6.1.jar demo1/lib/ \\\n && cp lib/mtas-${project.version}.jar demo1/lib/ \\\n && cp data/solrconfig.xml demo1/conf/ \\\n && cp data/schemaBasic.xml demo1/conf/schema.xml \\\n && cp -r data/mtas demo1/conf/ \\\n && cp data/mtas.xml demo1/conf/ \\\n && chmod -R 777 demo1 \\\n && cp -rp demo1 demo2 \\\n && cp data/schemaFull.xml demo2/conf/schema.xml \\\n && echo \"name=demo2\" > demo2/core.properties \\\n && cp -rp demo1 demo3 \\\n && cp data/schemaFull.xml demo3/conf/schema.xml \\\n && echo \"name=demo3\" > demo3/core.properties \\\n && cp -rp demo1 demo4 \\\n && cp data/schemaFull.xml demo4/conf/schema.xml \\\n && echo \"name=demo4\" > demo4/core.properties \\\n && mv demo1 /var/solr/data/ \\\n && mv demo2 /var/solr/data/ \\\n && mv demo3 /var/solr/data/ \\\n && mv demo4 /var/solr/data/\nCMD bash -C '/start.sh' ; 'bash'\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  Automatically generated Dockerfile \n#  - Build ${timestamp}\n#  - Lucene/Solr version ${currentLuceneVersion}\n#  - Mtas release ${project.version} \n#\nFROM ubuntu:16.04\nMAINTAINER Matthijs Brouwer, Textexploration.org\nEXPOSE 8983/tcp 80/tcp\nUSER root\nWORKDIR \"/root\" \nRUN mkdir lib\nADD https://github.com/textexploration/mtas/releases/download/v${project.version}/mtas-${project.version}.jar /root/lib/\nRUN apt-get update \\\n && apt-get install locales lsof software-properties-common python-software-properties apache2 curl subversion -y \\\n && locale-gen en_US.UTF-8 en_US \\\n && update-locale LANG=en_US.UTF-8 LANGUAGE=en_US:en\nRUN mathurl=$( curl -s 'http://www.apache.org/dyn/closer.lua/commons/math/binaries/commons-math3-3.6.1-bin.tar.gz' | grep -o '<strong>[^<]*</strong>' | sed 's/<[^>]*>//g' | head -1 ;) \\\n && if echo \"$mathurl\" | grep -q '^.*[^ ].*$' ; then curl -f -o /root/lib/commons-math3-3.6.1-bin.tar.gz -O $mathurl || true ; fi \\\n && if [ ! -f /root/lib/commons-math3-3.6.1-bin.tar.gz ] ; then echo \"Commons-math3 not found in mirror, falling back to apache archive\" ;mathurl=\"http://archive.apache.org/dist/commons/math/binaries/commons-math3-3.6.1-bin.tar.gz\" ;curl -f -o /root/lib/commons-math3-3.6.1-bin.tar.gz -O $mathurl ; fi \\\n && tar xzf lib/commons-math3-3.6.1-bin.tar.gz -C lib commons-math3-3.6.1/commons-math3-3.6.1.jar --strip-components=1 \\\n && rm lib/commons-math3-3.6.1-bin.tar.gz\nRUN svn export https://github.com/textexploration/mtas/trunk/docker/ data\nRUN add-apt-repository -y ppa:webupd8team/java \\\n && apt-get update \\\n && echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true | /usr/bin/debconf-set-selections \\\n && apt-get install oracle-java8-installer -y \\\n && rm -rf /var/lib/apt/lists/*\nRUN solrurl=$( curl -s 'http://www.apache.org/dyn/closer.lua/lucene/solr/${currentLuceneVersion}/solr-${currentLuceneVersion}.tgz' | grep -o '<strong>[^<]*</strong>' | sed 's/<[^>]*>//g' | head -1 ;) \\\n && if echo \"$solrurl\" | grep -q '^.*[^ ].*$' ; then curl -f -o /root/solr-${currentLuceneVersion}.tgz -O $solrurl || true ; fi \\\n && if [ ! -f /root/solr-${currentLuceneVersion}.tgz ] ; then echo \"Solr ${currentLuceneVersion} not found in mirror, falling back to apache archive\" ;solrurl=\"http://archive.apache.org/dist/lucene/solr/${currentLuceneVersion}/solr-${currentLuceneVersion}.tgz\" ;curl -f -o /root/solr-${currentLuceneVersion}.tgz -O $solrurl ; fi \\\n && tar xzf solr-${currentLuceneVersion}.tgz solr-${currentLuceneVersion}/bin/install_solr_service.sh --strip-components=2 \\\n && bash ./install_solr_service.sh solr-${currentLuceneVersion}.tgz \\\n && rm install_solr_service.sh \\\n && rm -rf solr-${currentLuceneVersion}.tgz\nRUN service apache2 stop \\\n && echo \"ServerName localhost\" | tee /etc/apache2/conf-available/fqdn.conf \\\n && a2enmod proxy \\\n && a2enmod proxy_http \\\n && a2enmod proxy_ajp \\\n && a2enmod rewrite \\\n && a2enmod deflate \\\n && a2enmod headers \\\n && a2enmod proxy_balancer \\\n && a2enmod proxy_connect \\\n && a2enmod proxy_html \\\n && a2enmod xml2enc \\\n && a2enconf fqdn \\\n && sed -i '/<\\/VirtualHost>/ i ProxyPass /solr http://localhost:8983/solr\\nProxyPassReverse /solr http://localhost:8983/solr' /etc/apache2/sites-enabled/000-default.conf \\\n && rm -rf /var/www/html/* \\\n && mkdir /var/www/html/demo \\\n && cp -rp data/*-samples /var/www/html/demo/ \\\n && gunzip -r /var/www/html/demo \\\n && cp -rp data/site/* /var/www/html \\\n && chmod -R 755 /var/www/html \\\n && printf \"echo\\n\" >> /start.sh \\\n && printf \"echo \\\"================ Mtas -- Multi Tier Annotation Search =================\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\" Timestamp ${timestamp}\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\" Lucene/Solr version ${currentLuceneVersion}\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\" Mtas release ${project.version}\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\" See https://textexploration.github.io/mtas/ for more information\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\"=======================================================================\\\"\\n\" >> /start.sh \\\n && printf \"echo\\n\" >> /start.sh \\\n && printf \"service solr start\\nservice apache2 start\\n\" >> /start.sh \\\n && chmod 755 /start.sh \\\n && mkdir demo1 \\\n && mkdir demo1/lib \\\n && mkdir demo1/conf \\\n && echo \"name=demo1\" > demo1/core.properties \\\n && cp lib/commons-math3-3.6.1.jar demo1/lib/ \\\n && cp lib/mtas-${project.version}.jar demo1/lib/ \\\n && cp data/solrconfig.xml demo1/conf/ \\\n && cp data/schemaBasic.xml demo1/conf/schema.xml \\\n && cp -r data/mtas demo1/conf/ \\\n && cp data/mtas.xml demo1/conf/ \\\n && chmod -R 777 demo1 \\\n && cp -rp demo1 demo2 \\\n && cp data/schemaFull.xml demo2/conf/schema.xml \\\n && echo \"name=demo2\" > demo2/core.properties \\\n && cp -rp demo1 demo3 \\\n && cp data/schemaFull.xml demo3/conf/schema.xml \\\n && echo \"name=demo3\" > demo3/core.properties \\\n && cp -rp demo1 demo4 \\\n && cp data/schemaFull.xml demo4/conf/schema.xml \\\n && echo \"name=demo4\" > demo4/core.properties \\\n && mv demo1 /var/solr/data/ \\\n && mv demo2 /var/solr/data/ \\\n && mv demo3 /var/solr/data/ \\\n && mv demo4 /var/solr/data/\nCMD bash -C '/start.sh' ; 'bash'\n","injectedSmells":[],"originalDockerfileHash":"3f8d653ba04cdd8374b7dfbcd99f01e7","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   Automatically generated Dockerfile \n#   - Build ${timestamp}\n#   - Lucene/Solr version ${currentLuceneVersion}\n#   - Mtas release ${project.version} \n#\nFROM ubuntu:16.04\nMAINTAINER Matthijs Brouwer, Textexploration.org\nEXPOSE 8983/tcp 80/tcp\nUSER root\nWORKDIR \"/root\" \nRUN mkdir lib\nADD https://github.com/textexploration/mtas/releases/download/v${project.version}/mtas-${project.version}.jar /root/lib/\nRUN apt-get update \\\n && apt-get install locales lsof software-properties-common python-software-properties apache2 curl subversion -y \\\n && locale-gen en_US.UTF-8 en_US \\\n && update-locale LANG=en_US.UTF-8 LANGUAGE=en_US:en\nRUN mathurl=$( curl -s 'http://www.apache.org/dyn/closer.lua/commons/math/binaries/commons-math3-3.6.1-bin.tar.gz' | grep -o '<strong>[^<]*</strong>' | sed 's/<[^>]*>//g' | head -1 ;) \\\n && if echo \"$mathurl\" | grep -q '^.*[^ ].*$' ; then curl -f -o /root/lib/commons-math3-3.6.1-bin.tar.gz -O $mathurl || true ; fi \\\n && if [ ! -f /root/lib/commons-math3-3.6.1-bin.tar.gz ] ; then echo \"Commons-math3 not found in mirror, falling back to apache archive\" ;mathurl=\"http://archive.apache.org/dist/commons/math/binaries/commons-math3-3.6.1-bin.tar.gz\" ;curl -f -o /root/lib/commons-math3-3.6.1-bin.tar.gz -O $mathurl ; fi \\\n && tar xzf lib/commons-math3-3.6.1-bin.tar.gz -C lib commons-math3-3.6.1/commons-math3-3.6.1.jar --strip-components=1 \\\n && rm lib/commons-math3-3.6.1-bin.tar.gz\nRUN svn export https://github.com/textexploration/mtas/trunk/docker/ data\nRUN add-apt-repository -y ppa:webupd8team/java \\\n && apt-get update \\\n && echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true | /usr/bin/debconf-set-selections \\\n && apt-get install oracle-java8-installer -y \\\n && rm -rf /var/lib/apt/lists/*\nRUN solrurl=$( curl -s 'http://www.apache.org/dyn/closer.lua/lucene/solr/${currentLuceneVersion}/solr-${currentLuceneVersion}.tgz' | grep -o '<strong>[^<]*</strong>' | sed 's/<[^>]*>//g' | head -1 ;) \\\n && if echo \"$solrurl\" | grep -q '^.*[^ ].*$' ; then curl -f -o /root/solr-${currentLuceneVersion}.tgz -O $solrurl || true ; fi \\\n && if [ ! -f /root/solr-${currentLuceneVersion}.tgz ] ; then echo \"Solr ${currentLuceneVersion} not found in mirror, falling back to apache archive\" ;solrurl=\"http://archive.apache.org/dist/lucene/solr/${currentLuceneVersion}/solr-${currentLuceneVersion}.tgz\" ;curl -f -o /root/solr-${currentLuceneVersion}.tgz -O $solrurl ; fi \\\n && tar xzf solr-${currentLuceneVersion}.tgz solr-${currentLuceneVersion}/bin/install_solr_service.sh --strip-components=2 \\\n && bash ./install_solr_service.sh solr-${currentLuceneVersion}.tgz \\\n && rm install_solr_service.sh \\\n && rm -rf solr-${currentLuceneVersion}.tgz\nRUN service apache2 stop \\\n && echo \"ServerName localhost\" | tee /etc/apache2/conf-available/fqdn.conf \\\n && a2enmod proxy \\\n && a2enmod proxy_http \\\n && a2enmod proxy_ajp \\\n && a2enmod rewrite \\\n && a2enmod deflate \\\n && a2enmod headers \\\n && a2enmod proxy_balancer \\\n && a2enmod proxy_connect \\\n && a2enmod proxy_html \\\n && a2enmod xml2enc \\\n && a2enconf fqdn \\\n && sed -i '/<\\/VirtualHost>/ i ProxyPass /solr http://localhost:8983/solr\\nProxyPassReverse /solr http://localhost:8983/solr' /etc/apache2/sites-enabled/000-default.conf \\\n && rm -rf /var/www/html/* \\\n && mkdir /var/www/html/demo \\\n && cp -rp data/*-samples /var/www/html/demo/ \\\n && gunzip -r /var/www/html/demo \\\n && cp -rp data/site/* /var/www/html \\\n && chmod -R 755 /var/www/html \\\n && printf \"echo\\n\" >> /start.sh \\\n && printf \"echo \\\"================ Mtas -- Multi Tier Annotation Search =================\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\" Timestamp ${timestamp}\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\" Lucene/Solr version ${currentLuceneVersion}\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\" Mtas release ${project.version}\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\" See https://textexploration.github.io/mtas/ for more information\\\"\\n\" >> /start.sh \\\n && printf \"echo \\\"=======================================================================\\\"\\n\" >> /start.sh \\\n && printf \"echo\\n\" >> /start.sh \\\n && printf \"service solr start\\nservice apache2 start\\n\" >> /start.sh \\\n && chmod 755 /start.sh \\\n && mkdir demo1 \\\n && mkdir demo1/lib \\\n && mkdir demo1/conf \\\n && echo \"name=demo1\" > demo1/core.properties \\\n && cp lib/commons-math3-3.6.1.jar demo1/lib/ \\\n && cp lib/mtas-${project.version}.jar demo1/lib/ \\\n && cp data/solrconfig.xml demo1/conf/ \\\n && cp data/schemaBasic.xml demo1/conf/schema.xml \\\n && cp -r data/mtas demo1/conf/ \\\n && cp data/mtas.xml demo1/conf/ \\\n && chmod -R 777 demo1 \\\n && cp -rp demo1 demo2 \\\n && cp data/schemaFull.xml demo2/conf/schema.xml \\\n && echo \"name=demo2\" > demo2/core.properties \\\n && cp -rp demo1 demo3 \\\n && cp data/schemaFull.xml demo3/conf/schema.xml \\\n && echo \"name=demo3\" > demo3/core.properties \\\n && cp -rp demo1 demo4 \\\n && cp data/schemaFull.xml demo4/conf/schema.xml \\\n && echo \"name=demo4\" > demo4/core.properties \\\n && mv demo1 /var/solr/data/ \\\n && mv demo2 /var/solr/data/ \\\n && mv demo3 /var/solr/data/ \\\n && mv demo4 /var/solr/data/\nCMD bash -C '/start.sh' ; 'bash'\n","originalDockerfileUglifiedHash":"66cdf11e50ea2ab9ef9e59cf1c664ceb","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/67c20e12a0dbff57ffc7e48e8f8ed72c0d8be20a.dockerfile"}