{"seed":2653524383,"processedDockerfileHash":"6bada3542c200ce625f6081d98d1c5d1","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-user"],"processedDockerfile":"FROM alpine:3.10\nARG NEXTCLOUD_VERSION=16.0.1\nARG GPG_nextcloud=\"2880 6A87 8AE4 23A2 8372  792E D758 99B9 A724 937A\"\nARG BUILD_CORES\nARG NGINX_VER=1.17.0\nARG PHP_VER=7.3.6\nARG LIBICONV_VERSION=1.16\nLABEL description=\"A server software for creating file hosting services\" \\\n      nextcloud=\"Nextcloud v${NEXTCLOUD_VERSION}\" \\\n      maintainer=\"Starbix <starbix@laubacher.io>\" \\\n      php_version=\"PHP v$PHP_VER built from source\" \\\n      nginx_version=\"NGINX v$NGINX_VER built from source\"\nARG PHP_MIRROR=https://secure.php.net\nARG GNU_MIRROR=https://mirror.init7.net\nARG NGINX_CONF=\"  --prefix=/nginx  --sbin-path=/usr/local/sbin/nginx  --http-log-path=/nginx/logs/access.log  --error-log-path=/nginx/logs/error.log  --pid-path=/nginx/run/nginx.pid  --lock-path=/nginx/run/nginx.lock  --with-threads  --with-file-aio  --without-http_geo_module  --without-http_autoindex_module  --without-http_split_clients_module  --without-http_memcached_module  --without-http_empty_gif_module  --without-http_browser_module\"\nARG PHP_CONF=\"  --prefix=/usr  --libdir=/usr/lib/php  --datadir=/usr/share/php  --sysconfdir=/php/etc  --localstatedir=/php/var  --with-pear=/usr/share/php  --with-config-file-scan-dir=/php/conf.d  --with-config-file-path=/php  --enable-option-checking=fatal  --enable-zip=shared  --with-libzip=/usr  --with-pic  --disable-short-tags  --without-readline  --enable-bcmath=shared  --enable-fpm  --disable-cgi  --enable-mysqlnd  --enable-mbstring  --with-curl  --with-libedit  --with-openssl  --with-iconv=/usr/local  --with-gd  --with-jpeg-dir  --with-png-dir  --with-webp-dir  --with-xpm-dir=no  --with-freetype-dir  --disable-gd-jis-conv  --with-sodium=shared  --with-zlib\"\nARG PHP_EXT_LIST=\"  mysqli  ctype  dom  json  xml  mbstring  posix  xmlwriter  zip  zlib  sqlite3  pdo_sqlite  pdo_pgsql  pdo_mysql  pcntl  curl  fileinfo  bz2  intl  openssl  ldap  simplexml  pgsql  ftp  exif  gmp  sodium  imap\"\nARG CUSTOM_BUILD_PKGS=\"  freetype-dev  openldap-dev  gmp-dev  icu-dev  postgresql-dev  libpng-dev  libwebp-dev  gd-dev  libjpeg-turbo-dev  libxpm-dev  libedit-dev  libxml2-dev  openssl-dev  libbz2  re2c  sqlite-dev  imagemagick-dev  libsodium-dev  libzip-dev  imap-dev\"\nARG CUSTOM_PKGS=\"  freetype  openldap  gmp  bzip2-dev  icu  libpq  libzip  libsodium  imagemagick  c-client\"\nENV UID=\"991\" \\\n    GID=\"991\" \\\n    UPLOAD_MAX_SIZE=\"25G\" \\\n    APC_SHM_SIZE=\"128M\" \\\n    OPCACHE_MEM_SIZE=\"128\" \\\n    MEMORY_LIMIT=\"512M\" \\\n    CRON_PERIOD=\"15m\" \\\n    CRON_MEMORY_LIMIT=\"1g\" \\\n    TZ=\"Etc/UTC\" \\\n    DB_TYPE=\"sqlite3\" \\\n    DOMAIN=\"localhost\"\nCOPY rootfs-nginx-php /\nRUN apk -U upgrade \\\n && apk add gnupg=2.2.19-r0 tar=1.32-r1 build-base=0.5-r1 autoconf=2.69-r2 automake=1.16.1-r0 pcre-dev=8.43-r1 libtool=2.4.6-r6 samba-dev=4.10.18-r0 linux-headers=4.19.36-r0 libtool=2.4.6-r6 build-base=0.5-r1 pcre-dev=8.43-r1 zlib-dev=1.2.11-r1 wget=1.20.3-r0 gnupg=2.2.19-r0 autoconf=2.69-r2 gcc=8.3.0-r0 g++=8.3.0-r0 libc-dev=0.7.1-r0 make=4.2.1-r2 pkgconf=1.6.1-r1 curl-dev=7.66.0-r4 ca-certificates=20191127-r2 ${CUSTOM_BUILD_PKGS} -t build-dependencies \\\n && apk add openssl=1.1.1k-r0 ca-certificates=20191127-r2 libsmbclient=4.10.18-r0 tzdata=2021a-r0 s6=2.8.0.1-r0 su-exec=0.2-r0 curl=7.66.0-r4 libedit=20190324.3.1-r0 libxml2=2.9.9-r5 libwebp=1.0.2-r0 gd=2.2.5-r3 pcre=8.43-r1 zlib=1.2.11-r1 ${CUSTOM_PKGS} \\\n && NB_CORES=${BUILD_CORES-$( getconf _NPROCESSORS_CONF ;)} \\\n && wget https://nginx.org/download/nginx-${NGINX_VER}.tar.gz -O /tmp/nginx-${NGINX_VER}.tar.gz \\\n && wget https://nginx.org/download/nginx-${NGINX_VER}.tar.gz.asc -O /tmp/nginx-${NGINX_VER}.tar.gz.asc \\\n && wget ${PHP_MIRROR}/get/php-${PHP_VER}.tar.gz/from/this/mirror -O /tmp/php-${PHP_VER}.tar.gz \\\n && wget ${PHP_MIRROR}/get/php-${PHP_VER}.tar.gz.asc/from/this/mirror -O /tmp/php-${PHP_VER}.tar.gz.asc \\\n && wget ${GNU_MIRROR}/gnu/libiconv/libiconv-${LIBICONV_VERSION}.tar.gz -O /tmp/libiconv-${LIBICONV_VERSION}.tar.gz \\\n && mkdir -p /php/conf.d \\\n && mkdir -p /usr/src \\\n && tar xzf /tmp/nginx-${NGINX_VER}.tar.gz -C /usr/src \\\n && tar xzvf /tmp/php-${PHP_VER}.tar.gz -C /usr/src \\\n && tar xzf /tmp/libiconv-${LIBICONV_VERSION}.tar.gz -C /usr/src \\\n && cd /usr/src/nginx-${NGINX_VER} \\\n && ./configure --with-cc-opt=\"-O3 -fPIE -fstack-protector-strong -m64 --param=ssp-buffer-size=4 -gsplit-dwarf -D_FORTIFY_SOURCE=2 -Wformat -Werror=format-security -Wno-deprecated-declarations\" ${NGINX_CONF} \\\n && make -j ${NB_CORES} \\\n && make install \\\n && cd /usr/src/libiconv-${LIBICONV_VERSION} \\\n && ./configure --prefix=/usr/local \\\n && make \\\n && make install \\\n && libtool --finish /usr/local/lib \\\n && mv /usr/src/php-${PHP_VER} /usr/src/php \\\n && cd /usr/src/php \\\n && ./configure CFLAGS=\"-O3 -fstack-protector-strong -fpic -fpie\" LDFLAGS=\"-Wl,-O2 -Wl,--hash-style=both -pie\" ${PHP_CONF} \\\n && make -j ${NB_CORES} \\\n && make install \\\n && { find /usr/local/bin /usr/local/sbin -type f -perm +0111 -exec strip --strip-all '{}' + || true ; } \\\n && make clean \\\n && chmod u+x /usr/local/bin/* /etc/s6.d/*/* \\\n && docker-php-ext-install ${PHP_EXT_LIST} \\\n && mkdir -p /nginx/logs /nginx/run /php/php-fpm.d /php/logs /php/run /php/session \\\n && pecl install smbclient apcu redis imagick \\\n && echo \"extension=smbclient.so\" > /php/conf.d/smbclient.ini \\\n && echo \"extension=redis.so\" > /php/conf.d/redis.ini \\\n && mkdir /nextcloud \\\n && cd /tmp \\\n && NEXTCLOUD_TARBALL=\"nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" \\\n && wget -q https://download.nextcloud.com/server/releases/${NEXTCLOUD_TARBALL} \\\n && wget -q https://download.nextcloud.com/server/releases/${NEXTCLOUD_TARBALL}.sha512 \\\n && wget -q https://download.nextcloud.com/server/releases/${NEXTCLOUD_TARBALL}.asc \\\n && wget -q https://nextcloud.com/nextcloud.asc \\\n && echo \"Verifying both integrity and authenticity of ${NEXTCLOUD_TARBALL}...\" \\\n && CHECKSUM_STATE=$( echo -n $( sha512sum -c ${NEXTCLOUD_TARBALL}.sha512 ;) | tail -c 2 ;) \\\n && if [ \"${CHECKSUM_STATE}\" != \"OK\" ] ; then echo \"Warning! Checksum does not match!\" \\\n && exit 1 ; fi \\\n && gpg --import nextcloud.asc \\\n && FINGERPRINT=\"$( LANG=C gpg --verify ${NEXTCLOUD_TARBALL}.asc ${NEXTCLOUD_TARBALL} 2>&1 | sed -n \"s#Primary key fingerprint: \\(.*\\)#\\1#p\" ;)\" \\\n && if [ -z \"${FINGERPRINT}\" ] ; then echo \"Warning! Invalid GPG signature!\" \\\n && exit 1 ; fi \\\n && if [ \"${FINGERPRINT}\" != \"${GPG_nextcloud}\" ] ; then echo \"Warning! Wrong GPG fingerprint!\" \\\n && exit 1 ; fi \\\n && echo \"All seems good, now unpacking ${NEXTCLOUD_TARBALL}...\" \\\n && tar xjf ${NEXTCLOUD_TARBALL} --strip 1 -C /nextcloud \\\n && update-ca-certificates \\\n && apk del build-dependencies \\\n && rm -rf /var/cache/apk/* /tmp/* /root/.gnupg /usr/src/* /gcc\nCOPY rootfs /\nRUN chmod +x /usr/local/bin/* /etc/s6.d/*/* /etc/s6.d/.s6-svscan/*\nVOLUME /data /config /apps2 /nextcloud/themes\nHEALTHCHECK --interval=120s --timeout=5s CMD curl -f http://localhost:8888/ || exit 1\nEXPOSE 8888/tcp\nCMD [\"run.sh\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n","originalDockerfile":"FROM alpine:3.10\nARG NEXTCLOUD_VERSION=16.0.1\nARG GPG_nextcloud=\"2880 6A87 8AE4 23A2 8372  792E D758 99B9 A724 937A\"\nARG BUILD_CORES\nARG NGINX_VER=1.17.0\nARG PHP_VER=7.3.6\nARG LIBICONV_VERSION=1.16\nLABEL description=\"A server software for creating file hosting services\" \\\n      nextcloud=\"Nextcloud v${NEXTCLOUD_VERSION}\" \\\n      maintainer=\"Starbix <starbix@laubacher.io>\" \\\n      php_version=\"PHP v$PHP_VER built from source\" \\\n      nginx_version=\"NGINX v$NGINX_VER built from source\"\nARG PHP_MIRROR=https://secure.php.net\nARG GNU_MIRROR=https://mirror.init7.net\nARG NGINX_CONF=\"  --prefix=/nginx  --sbin-path=/usr/local/sbin/nginx  --http-log-path=/nginx/logs/access.log  --error-log-path=/nginx/logs/error.log  --pid-path=/nginx/run/nginx.pid  --lock-path=/nginx/run/nginx.lock  --with-threads  --with-file-aio  --without-http_geo_module  --without-http_autoindex_module  --without-http_split_clients_module  --without-http_memcached_module  --without-http_empty_gif_module  --without-http_browser_module\"\nARG PHP_CONF=\"  --prefix=/usr  --libdir=/usr/lib/php  --datadir=/usr/share/php  --sysconfdir=/php/etc  --localstatedir=/php/var  --with-pear=/usr/share/php  --with-config-file-scan-dir=/php/conf.d  --with-config-file-path=/php  --enable-option-checking=fatal  --enable-zip=shared  --with-libzip=/usr  --with-pic  --disable-short-tags  --without-readline  --enable-bcmath=shared  --enable-fpm  --disable-cgi  --enable-mysqlnd  --enable-mbstring  --with-curl  --with-libedit  --with-openssl  --with-iconv=/usr/local  --with-gd  --with-jpeg-dir  --with-png-dir  --with-webp-dir  --with-xpm-dir=no  --with-freetype-dir  --disable-gd-jis-conv  --with-sodium=shared  --with-zlib\"\nARG PHP_EXT_LIST=\"  mysqli  ctype  dom  json  xml  mbstring  posix  xmlwriter  zip  zlib  sqlite3  pdo_sqlite  pdo_pgsql  pdo_mysql  pcntl  curl  fileinfo  bz2  intl  openssl  ldap  simplexml  pgsql  ftp  exif  gmp  sodium  imap\"\nARG CUSTOM_BUILD_PKGS=\"  freetype-dev  openldap-dev  gmp-dev  icu-dev  postgresql-dev  libpng-dev  libwebp-dev  gd-dev  libjpeg-turbo-dev  libxpm-dev  libedit-dev  libxml2-dev  openssl-dev  libbz2  re2c  sqlite-dev  imagemagick-dev  libsodium-dev  libzip-dev  imap-dev\"\nARG CUSTOM_PKGS=\"  freetype  openldap  gmp  bzip2-dev  icu  libpq  libzip  libsodium  imagemagick  c-client\"\nENV UID=\"991\" \\\n    GID=\"991\" \\\n    UPLOAD_MAX_SIZE=\"25G\" \\\n    APC_SHM_SIZE=\"128M\" \\\n    OPCACHE_MEM_SIZE=\"128\" \\\n    MEMORY_LIMIT=\"512M\" \\\n    CRON_PERIOD=\"15m\" \\\n    CRON_MEMORY_LIMIT=\"1g\" \\\n    TZ=\"Etc/UTC\" \\\n    DB_TYPE=\"sqlite3\" \\\n    DOMAIN=\"localhost\"\nCOPY rootfs-nginx-php /\nRUN apk -U upgrade \\\n && apk add -t build-dependencies gnupg tar build-base autoconf automake pcre-dev libtool samba-dev linux-headers libtool build-base pcre-dev zlib-dev wget gnupg autoconf gcc g++ libc-dev make pkgconf curl-dev ca-certificates ${CUSTOM_BUILD_PKGS} \\\n && apk add openssl ca-certificates libsmbclient tzdata s6 su-exec curl libedit libxml2 libwebp gd pcre zlib ${CUSTOM_PKGS} \\\n && NB_CORES=${BUILD_CORES-$( getconf _NPROCESSORS_CONF ;)} \\\n && wget https://nginx.org/download/nginx-${NGINX_VER}.tar.gz -O /tmp/nginx-${NGINX_VER}.tar.gz \\\n && wget https://nginx.org/download/nginx-${NGINX_VER}.tar.gz.asc -O /tmp/nginx-${NGINX_VER}.tar.gz.asc \\\n && wget ${PHP_MIRROR}/get/php-${PHP_VER}.tar.gz/from/this/mirror -O /tmp/php-${PHP_VER}.tar.gz \\\n && wget ${PHP_MIRROR}/get/php-${PHP_VER}.tar.gz.asc/from/this/mirror -O /tmp/php-${PHP_VER}.tar.gz.asc \\\n && wget ${GNU_MIRROR}/gnu/libiconv/libiconv-${LIBICONV_VERSION}.tar.gz -O /tmp/libiconv-${LIBICONV_VERSION}.tar.gz \\\n && mkdir -p /php/conf.d \\\n && mkdir -p /usr/src \\\n && tar xzf /tmp/nginx-${NGINX_VER}.tar.gz -C /usr/src \\\n && tar xzvf /tmp/php-${PHP_VER}.tar.gz -C /usr/src \\\n && tar xzf /tmp/libiconv-${LIBICONV_VERSION}.tar.gz -C /usr/src \\\n && cd /usr/src/nginx-${NGINX_VER} \\\n && ./configure --with-cc-opt=\"-O3 -fPIE -fstack-protector-strong -m64 --param=ssp-buffer-size=4 -gsplit-dwarf -D_FORTIFY_SOURCE=2 -Wformat -Werror=format-security -Wno-deprecated-declarations\" ${NGINX_CONF} \\\n && make -j ${NB_CORES} \\\n && make install \\\n && cd /usr/src/libiconv-${LIBICONV_VERSION} \\\n && ./configure --prefix=/usr/local \\\n && make \\\n && make install \\\n && libtool --finish /usr/local/lib \\\n && mv /usr/src/php-${PHP_VER} /usr/src/php \\\n && cd /usr/src/php \\\n && ./configure CFLAGS=\"-O3 -fstack-protector-strong -fpic -fpie\" LDFLAGS=\"-Wl,-O2 -Wl,--hash-style=both -pie\" ${PHP_CONF} \\\n && make -j ${NB_CORES} \\\n && make install \\\n && { find /usr/local/bin /usr/local/sbin -type f -perm +0111 -exec strip --strip-all '{}' + || true ; } \\\n && make clean \\\n && chmod u+x /usr/local/bin/* /etc/s6.d/*/* \\\n && docker-php-ext-install ${PHP_EXT_LIST} \\\n && mkdir -p /nginx/logs /nginx/run /php/php-fpm.d /php/logs /php/run /php/session \\\n && pecl install smbclient apcu redis imagick \\\n && echo \"extension=smbclient.so\" > /php/conf.d/smbclient.ini \\\n && echo \"extension=redis.so\" > /php/conf.d/redis.ini \\\n && mkdir /nextcloud \\\n && cd /tmp \\\n && NEXTCLOUD_TARBALL=\"nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" \\\n && wget -q https://download.nextcloud.com/server/releases/${NEXTCLOUD_TARBALL} \\\n && wget -q https://download.nextcloud.com/server/releases/${NEXTCLOUD_TARBALL}.sha512 \\\n && wget -q https://download.nextcloud.com/server/releases/${NEXTCLOUD_TARBALL}.asc \\\n && wget -q https://nextcloud.com/nextcloud.asc \\\n && echo \"Verifying both integrity and authenticity of ${NEXTCLOUD_TARBALL}...\" \\\n && CHECKSUM_STATE=$( echo -n $( sha512sum -c ${NEXTCLOUD_TARBALL}.sha512 ;) | tail -c 2 ;) \\\n && if [ \"${CHECKSUM_STATE}\" != \"OK\" ] ; then echo \"Warning! Checksum does not match!\" \\\n && exit 1 ; fi \\\n && gpg --import nextcloud.asc \\\n && FINGERPRINT=\"$( LANG=C gpg --verify ${NEXTCLOUD_TARBALL}.asc ${NEXTCLOUD_TARBALL} 2>&1 | sed -n \"s#Primary key fingerprint: \\(.*\\)#\\1#p\" ;)\" \\\n && if [ -z \"${FINGERPRINT}\" ] ; then echo \"Warning! Invalid GPG signature!\" \\\n && exit 1 ; fi \\\n && if [ \"${FINGERPRINT}\" != \"${GPG_nextcloud}\" ] ; then echo \"Warning! Wrong GPG fingerprint!\" \\\n && exit 1 ; fi \\\n && echo \"All seems good, now unpacking ${NEXTCLOUD_TARBALL}...\" \\\n && tar xjf ${NEXTCLOUD_TARBALL} --strip 1 -C /nextcloud \\\n && update-ca-certificates \\\n && apk del build-dependencies \\\n && rm -rf /var/cache/apk/* /tmp/* /root/.gnupg /usr/src/* /gcc\nCOPY rootfs /\nRUN chmod +x /usr/local/bin/* /etc/s6.d/*/* /etc/s6.d/.s6-svscan/*\nVOLUME /data /config /apps2 /nextcloud/themes\nHEALTHCHECK --interval=120s --timeout=5s CMD curl -f http://localhost:8888/ || exit 1\nEXPOSE 8888/tcp\nCMD [\"run.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"9d39bfd3cfe8d26f88536cfb9e29919f","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM alpine:3.10\nARG NEXTCLOUD_VERSION=16.0.1\nARG GPG_nextcloud=\"2880 6A87 8AE4 23A2 8372  792E D758 99B9 A724 937A\"\nARG BUILD_CORES\nARG NGINX_VER=1.17.0\nARG PHP_VER=7.3.6\nARG LIBICONV_VERSION=1.16\nLABEL description=\"A server software for creating file hosting services\" \\\n      nextcloud=\"Nextcloud v${NEXTCLOUD_VERSION}\" \\\n      maintainer=\"Starbix <starbix@laubacher.io>\" \\\n      php_version=\"PHP v$PHP_VER built from source\" \\\n      nginx_version=\"NGINX v$NGINX_VER built from source\"\nARG PHP_MIRROR=https://secure.php.net\nARG GNU_MIRROR=https://mirror.init7.net\nARG NGINX_CONF=\"  --prefix=/nginx  --sbin-path=/usr/local/sbin/nginx  --http-log-path=/nginx/logs/access.log  --error-log-path=/nginx/logs/error.log  --pid-path=/nginx/run/nginx.pid  --lock-path=/nginx/run/nginx.lock  --with-threads  --with-file-aio  --without-http_geo_module  --without-http_autoindex_module  --without-http_split_clients_module  --without-http_memcached_module  --without-http_empty_gif_module  --without-http_browser_module\"\nARG PHP_CONF=\"  --prefix=/usr  --libdir=/usr/lib/php  --datadir=/usr/share/php  --sysconfdir=/php/etc  --localstatedir=/php/var  --with-pear=/usr/share/php  --with-config-file-scan-dir=/php/conf.d  --with-config-file-path=/php  --enable-option-checking=fatal  --enable-zip=shared  --with-libzip=/usr  --with-pic  --disable-short-tags  --without-readline  --enable-bcmath=shared  --enable-fpm  --disable-cgi  --enable-mysqlnd  --enable-mbstring  --with-curl  --with-libedit  --with-openssl  --with-iconv=/usr/local  --with-gd  --with-jpeg-dir  --with-png-dir  --with-webp-dir  --with-xpm-dir=no  --with-freetype-dir  --disable-gd-jis-conv  --with-sodium=shared  --with-zlib\"\nARG PHP_EXT_LIST=\"  mysqli  ctype  dom  json  xml  mbstring  posix  xmlwriter  zip  zlib  sqlite3  pdo_sqlite  pdo_pgsql  pdo_mysql  pcntl  curl  fileinfo  bz2  intl  openssl  ldap  simplexml  pgsql  ftp  exif  gmp  sodium  imap\"\nARG CUSTOM_BUILD_PKGS=\"  freetype-dev  openldap-dev  gmp-dev  icu-dev  postgresql-dev  libpng-dev  libwebp-dev  gd-dev  libjpeg-turbo-dev  libxpm-dev  libedit-dev  libxml2-dev  openssl-dev  libbz2  re2c  sqlite-dev  imagemagick-dev  libsodium-dev  libzip-dev  imap-dev\"\nARG CUSTOM_PKGS=\"  freetype  openldap  gmp  bzip2-dev  icu  libpq  libzip  libsodium  imagemagick  c-client\"\nENV UID=\"991\" \\\n    GID=\"991\" \\\n    UPLOAD_MAX_SIZE=\"25G\" \\\n    APC_SHM_SIZE=\"128M\" \\\n    OPCACHE_MEM_SIZE=\"128\" \\\n    MEMORY_LIMIT=\"512M\" \\\n    CRON_PERIOD=\"15m\" \\\n    CRON_MEMORY_LIMIT=\"1g\" \\\n    TZ=\"Etc/UTC\" \\\n    DB_TYPE=\"sqlite3\" \\\n    DOMAIN=\"localhost\"\nCOPY rootfs-nginx-php /\nRUN apk -U upgrade \\\n && apk add -t build-dependencies gnupg tar build-base autoconf automake pcre-dev libtool samba-dev linux-headers libtool build-base pcre-dev zlib-dev wget gnupg autoconf gcc g++ libc-dev make pkgconf curl-dev ca-certificates ${CUSTOM_BUILD_PKGS} \\\n && apk add openssl ca-certificates libsmbclient tzdata s6 su-exec curl libedit libxml2 libwebp gd pcre zlib ${CUSTOM_PKGS} \\\n && NB_CORES=${BUILD_CORES-$( getconf _NPROCESSORS_CONF ;)} \\\n && wget https://nginx.org/download/nginx-${NGINX_VER}.tar.gz -O /tmp/nginx-${NGINX_VER}.tar.gz \\\n && wget https://nginx.org/download/nginx-${NGINX_VER}.tar.gz.asc -O /tmp/nginx-${NGINX_VER}.tar.gz.asc \\\n && wget ${PHP_MIRROR}/get/php-${PHP_VER}.tar.gz/from/this/mirror -O /tmp/php-${PHP_VER}.tar.gz \\\n && wget ${PHP_MIRROR}/get/php-${PHP_VER}.tar.gz.asc/from/this/mirror -O /tmp/php-${PHP_VER}.tar.gz.asc \\\n && wget ${GNU_MIRROR}/gnu/libiconv/libiconv-${LIBICONV_VERSION}.tar.gz -O /tmp/libiconv-${LIBICONV_VERSION}.tar.gz \\\n && mkdir -p /php/conf.d \\\n && mkdir -p /usr/src \\\n && tar xzf /tmp/nginx-${NGINX_VER}.tar.gz -C /usr/src \\\n && tar xzvf /tmp/php-${PHP_VER}.tar.gz -C /usr/src \\\n && tar xzf /tmp/libiconv-${LIBICONV_VERSION}.tar.gz -C /usr/src \\\n && cd /usr/src/nginx-${NGINX_VER} \\\n && ./configure --with-cc-opt=\"-O3 -fPIE -fstack-protector-strong -m64 --param=ssp-buffer-size=4 -gsplit-dwarf -D_FORTIFY_SOURCE=2 -Wformat -Werror=format-security -Wno-deprecated-declarations\" ${NGINX_CONF} \\\n && make -j ${NB_CORES} \\\n && make install \\\n && cd /usr/src/libiconv-${LIBICONV_VERSION} \\\n && ./configure --prefix=/usr/local \\\n && make \\\n && make install \\\n && libtool --finish /usr/local/lib \\\n && mv /usr/src/php-${PHP_VER} /usr/src/php \\\n && cd /usr/src/php \\\n && ./configure CFLAGS=\"-O3 -fstack-protector-strong -fpic -fpie\" LDFLAGS=\"-Wl,-O2 -Wl,--hash-style=both -pie\" ${PHP_CONF} \\\n && make -j ${NB_CORES} \\\n && make install \\\n && { find /usr/local/bin /usr/local/sbin -type f -perm +0111 -exec strip --strip-all '{}' + || true ; } \\\n && make clean \\\n && chmod u+x /usr/local/bin/* /etc/s6.d/*/* \\\n && docker-php-ext-install ${PHP_EXT_LIST} \\\n && mkdir -p /nginx/logs /nginx/run /php/php-fpm.d /php/logs /php/run /php/session \\\n && pecl install smbclient apcu redis imagick \\\n && echo \"extension=smbclient.so\" > /php/conf.d/smbclient.ini \\\n && echo \"extension=redis.so\" > /php/conf.d/redis.ini \\\n && mkdir /nextcloud \\\n && cd /tmp \\\n && NEXTCLOUD_TARBALL=\"nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" \\\n && wget -q https://download.nextcloud.com/server/releases/${NEXTCLOUD_TARBALL} \\\n && wget -q https://download.nextcloud.com/server/releases/${NEXTCLOUD_TARBALL}.sha512 \\\n && wget -q https://download.nextcloud.com/server/releases/${NEXTCLOUD_TARBALL}.asc \\\n && wget -q https://nextcloud.com/nextcloud.asc \\\n && echo \"Verifying both integrity and authenticity of ${NEXTCLOUD_TARBALL}...\" \\\n && CHECKSUM_STATE=$( echo -n $( sha512sum -c ${NEXTCLOUD_TARBALL}.sha512 ;) | tail -c 2 ;) \\\n && if [ \"${CHECKSUM_STATE}\" != \"OK\" ] ; then echo \"Warning! Checksum does not match!\" \\\n && exit 1 ; fi \\\n && gpg --import nextcloud.asc \\\n && FINGERPRINT=\"$( LANG=C gpg --verify ${NEXTCLOUD_TARBALL}.asc ${NEXTCLOUD_TARBALL} 2>&1 | sed -n \"s#Primary key fingerprint: \\(.*\\)#\\1#p\" ;)\" \\\n && if [ -z \"${FINGERPRINT}\" ] ; then echo \"Warning! Invalid GPG signature!\" \\\n && exit 1 ; fi \\\n && if [ \"${FINGERPRINT}\" != \"${GPG_nextcloud}\" ] ; then echo \"Warning! Wrong GPG fingerprint!\" \\\n && exit 1 ; fi \\\n && echo \"All seems good, now unpacking ${NEXTCLOUD_TARBALL}...\" \\\n && tar xjf ${NEXTCLOUD_TARBALL} --strip 1 -C /nextcloud \\\n && update-ca-certificates \\\n && apk del build-dependencies \\\n && rm -rf /var/cache/apk/* /tmp/* /root/.gnupg /usr/src/* /gcc\nCOPY rootfs /\nRUN chmod +x /usr/local/bin/* /etc/s6.d/*/* /etc/s6.d/.s6-svscan/*\nVOLUME /data /config /apps2 /nextcloud/themes\nHEALTHCHECK --interval=120s --timeout=5s CMD curl -f http://localhost:8888/ || exit 1\nEXPOSE 8888/tcp\nCMD [\"run.sh\"]\n","originalDockerfileUglifiedHash":"9d39bfd3cfe8d26f88536cfb9e29919f","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/aaa4158f90a1f3f2aac9d4c9c50c9d2c24efbea7.dockerfile"}