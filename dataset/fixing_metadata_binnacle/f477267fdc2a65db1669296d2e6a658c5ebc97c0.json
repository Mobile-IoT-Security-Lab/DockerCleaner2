{"seed":2028324214,"processedDockerfileHash":"8f6e9ec90e0cc9bae08ce28e08e8e6d9","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","use-copy-instead-of-add","have-a-healthcheck"],"processedDockerfile":"FROM python:2.7\nENV PYTHONUNBUFFERED=\"1\"\nRUN dpkg --add-architecture i386 \\\n && apt-get update \\\n && apt-get install --no-install-recommends git libpq-dev postgresql-client rabbitmq-server libdb-dev fp-compiler fp-units-base fp-units-math texlive-latex-base texlive-lang-polish texlive-latex-extra texlive-fonts-recommended gcc-multilib sudo libstdc++6:i386 zlib1g:i386 locales -y \\\n && apt-get clean\n#   This is oioioi user linux uid. Setting it is useful in development.\n#   By default we use an unused uid of 1234.\n#   This is placed here to avoid redownloading package on uid change\nARG oioioi_uid=1234\n#  Bash as shell, setup folders, create oioioi user\nRUN rm /bin/sh \\\n && ln -s /bin/bash /bin/sh \\\n && mkdir -pv /sio2/oioioi \\\n && mkdir -pv /sio2/logs \\\n && mkdir -pv /sio2/sandboxes \\\n && chmod a+rw -R /sio2/logs \\\n && useradd -U oioioi -m -d /home/oioioi/ -u $oioioi_uid \\\n && echo \"oioioi ALL=(ALL) NOPASSWD: ALL\" >> /etc/sudoers \\\n && chown -R oioioi:oioioi /sio2\n#   Modify locale\nRUN sed -i -e \"s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/\" /etc/locale.gen \\\n && locale-gen\n#   Configure rabbitmq-server\nRUN echo \"[{rabbit, [{tcp_listeners, [5672]}, {loopback_users, []}]}].\" > /etc/rabbitmq/rabbitmq.config \\\n && echo \"SERVER_ERL_ARGS=\\\"+K true +A 4 +P 1048576 -kernel\\\"\" > /etc/rabbitmq/rabbitmq-env.conf\n#   Configuring .bashrc\nRUN echo \"source /sio2/venv/bin/activate\" >> ~/.bashrc \\\n && echo \"cd /sio2\" >> ~/.bashrc \\\n && echo \"export PATH=$PATH:~/.local/bin\" >> ~/.bashrc\n#   Installing python dependencies\nUSER oioioi\nRUN easy_install --user distribute\nRUN pip install psycopg2-binary==2.9.6 --user\nRUN pip install twisted==22.10.0 --user\nWORKDIR /sio2/oioioi\nCOPY setup.py requirements.txt ./\nRUN pip install -r requirements.txt --user\nCOPY --chown=oioioi:oioioi . /sio2/oioioi\nENV PATH=\"$PATH:/home/oioioi/.local/bin/\"\nRUN oioioi-create-config /sio2/deployment\nWORKDIR /sio2/deployment\nRUN sed -i -e \"s/django.db.backends./django.db.backends.postgresql_psycopg2/g; s/'NAME': ''/'NAME': 'oioioi'/g; s/'USER': ''/'USER': 'oioioi'/g; s/'HOST': '',/'HOST': 'db',/g; s/'PASSWORD': ''/'PASSWORD': ''/g; s/#BROKER_URL/BROKER_URL/g; s/USE_UNSAFE_EXEC/#USE_UNSAFE_EXEC/g; s/USE_LOCAL_COMPILERS/#USE_LOCAL_COMPILERS/g; s/#FILETRACKER_SERVER_ENABLED/FILETRACKER_SERVER_ENABLED/g; s/#FILETRACKER_LISTEN_ADDR/FILETRACKER_LISTEN_ADDR/g; s/#FILETRACKER_LISTEN_PORT/FILETRACKER_LISTEN_PORT/g; s/#FILETRACKER_LISTEN_URL/FILETRACKER_LISTEN_URL/g; s/#FILETRACKER_URL/FILETRACKER_URL/g; s/#SIOWORKERS_LISTEN_ADDR/SIOWORKERS_LISTEN_ADDR/g; s/#SIOWORKERS_LISTEN_PORT/SIOWORKERS_LISTEN_PORT/g; s/#RUN_SIOWORKERSD.*$/RUN_SIOWORKERSD = True/g; s/#USE_UNSAFE_EXEC = True/USE_UNSAFE_EXEC = True/g; s/#USE_LOCAL_COMPILERS = True/USE_LOCAL_COMPILERS = False/g; s/#USE_UNSAFE_CHECKER = True/USE_UNSAFE_CHECKER = False/g; s/.*RUN_LOCAL_WORKERS = True/RUN_LOCAL_WORKERS = False/g; s/ALLOWED_HOSTS = \\[.*\\]/ALLOWED_HOSTS = \\['oioioi', '127.0.0.1', 'localhost', 'web'\\]/g\" settings.py \\\n && echo \"SIOWORKERS_BACKEND = 'oioioi.sioworkers.backends.SioworkersdBackend'\" >> settings.py \\\n && echo \"CELERY_RESULT_BACKEND = None\" >> settings.py \\\n && sed -i -e \"s|twistd|/home/oioioi/.local/bin/twistd|g\" -e \"s|{{ PROJECT_DIR }}/logs|/sio2/logs|g\" -e \"s|command=filetracker-server|command=/home/oioioi/.local/bin/filetracker-server|g\" supervisord.conf \\\n && mkdir -p /sio2/logs/{supervisor,runserver}\n#   Download sandboxes\nRUN ./manage.py supervisor --daemonize > /dev/null \\\n && ./manage.py download_sandboxes -q -y -c /sio2/sandboxes \\\n && ./manage.py supervisor stop all\nRUN sed -i -e \"s|FILETRACKER_URL = '.*'|FILETRACKER_URL = 'http://web:9999'|g\" settings.py \\\n && cp settings.py test_settings.py \\\n && sed -i -e \"s/from oioioi.default_settings/from oioioi.test_settings/g\" test_settings.py \\\n && cp settings.py selenium_settings.py \\\n && sed -i -e \"s/from oioioi.default_settings/from oioioi.selenium_settings/g\" selenium_settings.py\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM python:2.7\nENV PYTHONUNBUFFERED=\"1\"\nRUN dpkg --add-architecture i386 \\\n && apt-get update \\\n && apt-get install git libpq-dev postgresql-client rabbitmq-server libdb-dev fp-compiler fp-units-base fp-units-math texlive-latex-base texlive-lang-polish texlive-latex-extra texlive-fonts-recommended gcc-multilib sudo libstdc++6:i386 zlib1g:i386 locales -y \\\n && apt-get clean\n#  This is oioioi user linux uid. Setting it is useful in development.\n#  By default we use an unused uid of 1234.\n#  This is placed here to avoid redownloading package on uid change\nARG oioioi_uid=1234\n# Bash as shell, setup folders, create oioioi user\nRUN rm /bin/sh \\\n && ln -s /bin/bash /bin/sh \\\n && mkdir -pv /sio2/oioioi \\\n && mkdir -pv /sio2/logs \\\n && mkdir -pv /sio2/sandboxes \\\n && chmod a+rw -R /sio2/logs \\\n && useradd -U oioioi -m -d /home/oioioi/ -u $oioioi_uid \\\n && echo \"oioioi ALL=(ALL) NOPASSWD: ALL\" >> /etc/sudoers \\\n && chown -R oioioi:oioioi /sio2\n#  Modify locale\nRUN sed -i -e \"s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/\" /etc/locale.gen \\\n && locale-gen\n#  Configure rabbitmq-server\nRUN echo \"[{rabbit, [{tcp_listeners, [5672]}, {loopback_users, []}]}].\" > /etc/rabbitmq/rabbitmq.config \\\n && echo \"SERVER_ERL_ARGS=\\\"+K true +A 4 +P 1048576 -kernel\\\"\" > /etc/rabbitmq/rabbitmq-env.conf\n#  Configuring .bashrc\nRUN echo \"source /sio2/venv/bin/activate\" >> ~/.bashrc \\\n && echo \"cd /sio2\" >> ~/.bashrc \\\n && echo \"export PATH=$PATH:~/.local/bin\" >> ~/.bashrc\n#  Installing python dependencies\nUSER oioioi\nRUN easy_install --user distribute\nRUN pip install psycopg2-binary --user\nRUN pip install twisted --user\nWORKDIR /sio2/oioioi\nCOPY setup.py requirements.txt ./\nRUN pip install -r requirements.txt --user\nADD --chown=oioioi:oioioi . /sio2/oioioi\nENV PATH=\"$PATH:/home/oioioi/.local/bin/\"\nRUN oioioi-create-config /sio2/deployment\nWORKDIR /sio2/deployment\nRUN sed -i -e \"s/django.db.backends./django.db.backends.postgresql_psycopg2/g; s/'NAME': ''/'NAME': 'oioioi'/g; s/'USER': ''/'USER': 'oioioi'/g; s/'HOST': '',/'HOST': 'db',/g; s/'PASSWORD': ''/'PASSWORD': ''/g; s/#BROKER_URL/BROKER_URL/g; s/USE_UNSAFE_EXEC/#USE_UNSAFE_EXEC/g; s/USE_LOCAL_COMPILERS/#USE_LOCAL_COMPILERS/g; s/#FILETRACKER_SERVER_ENABLED/FILETRACKER_SERVER_ENABLED/g; s/#FILETRACKER_LISTEN_ADDR/FILETRACKER_LISTEN_ADDR/g; s/#FILETRACKER_LISTEN_PORT/FILETRACKER_LISTEN_PORT/g; s/#FILETRACKER_LISTEN_URL/FILETRACKER_LISTEN_URL/g; s/#FILETRACKER_URL/FILETRACKER_URL/g; s/#SIOWORKERS_LISTEN_ADDR/SIOWORKERS_LISTEN_ADDR/g; s/#SIOWORKERS_LISTEN_PORT/SIOWORKERS_LISTEN_PORT/g; s/#RUN_SIOWORKERSD.*$/RUN_SIOWORKERSD = True/g; s/#USE_UNSAFE_EXEC = True/USE_UNSAFE_EXEC = True/g; s/#USE_LOCAL_COMPILERS = True/USE_LOCAL_COMPILERS = False/g; s/#USE_UNSAFE_CHECKER = True/USE_UNSAFE_CHECKER = False/g; s/.*RUN_LOCAL_WORKERS = True/RUN_LOCAL_WORKERS = False/g; s/ALLOWED_HOSTS = \\[.*\\]/ALLOWED_HOSTS = \\['oioioi', '127.0.0.1', 'localhost', 'web'\\]/g\" settings.py \\\n && echo \"SIOWORKERS_BACKEND = 'oioioi.sioworkers.backends.SioworkersdBackend'\" >> settings.py \\\n && echo \"CELERY_RESULT_BACKEND = None\" >> settings.py \\\n && sed -i -e \"s|twistd|/home/oioioi/.local/bin/twistd|g\" -e \"s|{{ PROJECT_DIR }}/logs|/sio2/logs|g\" -e \"s|command=filetracker-server|command=/home/oioioi/.local/bin/filetracker-server|g\" supervisord.conf \\\n && mkdir -p /sio2/logs/{supervisor,runserver}\n#  Download sandboxes\nRUN ./manage.py supervisor --daemonize > /dev/null \\\n && ./manage.py download_sandboxes -q -y -c /sio2/sandboxes \\\n && ./manage.py supervisor stop all\nRUN sed -i -e \"s|FILETRACKER_URL = '.*'|FILETRACKER_URL = 'http://web:9999'|g\" settings.py \\\n && cp settings.py test_settings.py \\\n && sed -i -e \"s/from oioioi.default_settings/from oioioi.test_settings/g\" test_settings.py \\\n && cp settings.py selenium_settings.py \\\n && sed -i -e \"s/from oioioi.default_settings/from oioioi.selenium_settings/g\" selenium_settings.py\n","injectedSmells":[],"originalDockerfileHash":"ded31c2f028669d5dccc670278e5c576","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM python:2.7\nENV PYTHONUNBUFFERED=\"1\"\nRUN dpkg --add-architecture i386 \\\n && apt-get update \\\n && apt-get install git libpq-dev postgresql-client rabbitmq-server libdb-dev fp-compiler fp-units-base fp-units-math texlive-latex-base texlive-lang-polish texlive-latex-extra texlive-fonts-recommended gcc-multilib sudo libstdc++6:i386 zlib1g:i386 locales -y \\\n && apt-get clean\n#   This is oioioi user linux uid. Setting it is useful in development.\n#   By default we use an unused uid of 1234.\n#   This is placed here to avoid redownloading package on uid change\nARG oioioi_uid=1234\n#  Bash as shell, setup folders, create oioioi user\nRUN rm /bin/sh \\\n && ln -s /bin/bash /bin/sh \\\n && mkdir -pv /sio2/oioioi \\\n && mkdir -pv /sio2/logs \\\n && mkdir -pv /sio2/sandboxes \\\n && chmod a+rw -R /sio2/logs \\\n && useradd -U oioioi -m -d /home/oioioi/ -u $oioioi_uid \\\n && echo \"oioioi ALL=(ALL) NOPASSWD: ALL\" >> /etc/sudoers \\\n && chown -R oioioi:oioioi /sio2\n#   Modify locale\nRUN sed -i -e \"s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/\" /etc/locale.gen \\\n && locale-gen\n#   Configure rabbitmq-server\nRUN echo \"[{rabbit, [{tcp_listeners, [5672]}, {loopback_users, []}]}].\" > /etc/rabbitmq/rabbitmq.config \\\n && echo \"SERVER_ERL_ARGS=\\\"+K true +A 4 +P 1048576 -kernel\\\"\" > /etc/rabbitmq/rabbitmq-env.conf\n#   Configuring .bashrc\nRUN echo \"source /sio2/venv/bin/activate\" >> ~/.bashrc \\\n && echo \"cd /sio2\" >> ~/.bashrc \\\n && echo \"export PATH=$PATH:~/.local/bin\" >> ~/.bashrc\n#   Installing python dependencies\nUSER oioioi\nRUN easy_install --user distribute\nRUN pip install psycopg2-binary --user\nRUN pip install twisted --user\nWORKDIR /sio2/oioioi\nCOPY setup.py requirements.txt ./\nRUN pip install -r requirements.txt --user\nADD --chown=oioioi:oioioi . /sio2/oioioi\nENV PATH=\"$PATH:/home/oioioi/.local/bin/\"\nRUN oioioi-create-config /sio2/deployment\nWORKDIR /sio2/deployment\nRUN sed -i -e \"s/django.db.backends./django.db.backends.postgresql_psycopg2/g; s/'NAME': ''/'NAME': 'oioioi'/g; s/'USER': ''/'USER': 'oioioi'/g; s/'HOST': '',/'HOST': 'db',/g; s/'PASSWORD': ''/'PASSWORD': ''/g; s/#BROKER_URL/BROKER_URL/g; s/USE_UNSAFE_EXEC/#USE_UNSAFE_EXEC/g; s/USE_LOCAL_COMPILERS/#USE_LOCAL_COMPILERS/g; s/#FILETRACKER_SERVER_ENABLED/FILETRACKER_SERVER_ENABLED/g; s/#FILETRACKER_LISTEN_ADDR/FILETRACKER_LISTEN_ADDR/g; s/#FILETRACKER_LISTEN_PORT/FILETRACKER_LISTEN_PORT/g; s/#FILETRACKER_LISTEN_URL/FILETRACKER_LISTEN_URL/g; s/#FILETRACKER_URL/FILETRACKER_URL/g; s/#SIOWORKERS_LISTEN_ADDR/SIOWORKERS_LISTEN_ADDR/g; s/#SIOWORKERS_LISTEN_PORT/SIOWORKERS_LISTEN_PORT/g; s/#RUN_SIOWORKERSD.*$/RUN_SIOWORKERSD = True/g; s/#USE_UNSAFE_EXEC = True/USE_UNSAFE_EXEC = True/g; s/#USE_LOCAL_COMPILERS = True/USE_LOCAL_COMPILERS = False/g; s/#USE_UNSAFE_CHECKER = True/USE_UNSAFE_CHECKER = False/g; s/.*RUN_LOCAL_WORKERS = True/RUN_LOCAL_WORKERS = False/g; s/ALLOWED_HOSTS = \\[.*\\]/ALLOWED_HOSTS = \\['oioioi', '127.0.0.1', 'localhost', 'web'\\]/g\" settings.py \\\n && echo \"SIOWORKERS_BACKEND = 'oioioi.sioworkers.backends.SioworkersdBackend'\" >> settings.py \\\n && echo \"CELERY_RESULT_BACKEND = None\" >> settings.py \\\n && sed -i -e \"s|twistd|/home/oioioi/.local/bin/twistd|g\" -e \"s|{{ PROJECT_DIR }}/logs|/sio2/logs|g\" -e \"s|command=filetracker-server|command=/home/oioioi/.local/bin/filetracker-server|g\" supervisord.conf \\\n && mkdir -p /sio2/logs/{supervisor,runserver}\n#   Download sandboxes\nRUN ./manage.py supervisor --daemonize > /dev/null \\\n && ./manage.py download_sandboxes -q -y -c /sio2/sandboxes \\\n && ./manage.py supervisor stop all\nRUN sed -i -e \"s|FILETRACKER_URL = '.*'|FILETRACKER_URL = 'http://web:9999'|g\" settings.py \\\n && cp settings.py test_settings.py \\\n && sed -i -e \"s/from oioioi.default_settings/from oioioi.test_settings/g\" test_settings.py \\\n && cp settings.py selenium_settings.py \\\n && sed -i -e \"s/from oioioi.default_settings/from oioioi.selenium_settings/g\" selenium_settings.py\n","originalDockerfileUglifiedHash":"77310dc88723bbac2bf369a95813dc34","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/f477267fdc2a65db1669296d2e6a658c5ebc97c0.dockerfile"}