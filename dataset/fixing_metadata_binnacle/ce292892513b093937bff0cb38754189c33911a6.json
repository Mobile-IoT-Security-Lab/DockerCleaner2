{"seed":2368259044,"processedDockerfileHash":"4f51df00cb918510f6e0c0062a0778c3","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","have-a-healthcheck"],"processedDockerfile":"FROM ubuntu:18.04\nCMD [\"jupyter\", \"notebook\"]\nRUN echo \"deb http://nl.archive.ubuntu.com/ubuntu/ bionic main restricted universe multiverse\" > /etc/apt/sources.list \\\n && echo \"deb http://nl.archive.ubuntu.com/ubuntu/ bionic-updates main restricted universe multiverse\" >> /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends apt-utils=1.6.14 debconf-utils=1.5.66ubuntu1 -y \\\n && apt-get -y upgrade \\\n && apt-get clean\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN apt-get install --no-install-recommends python2.7=2.7.17-1~18.04ubuntu1.11 python-dev=2.7.15~rc1-1 python-numpy=1:1.13.3-2ubuntu1 python-scipy=0.19.1-2ubuntu1 python-pip=9.0.1-2.3~ubuntu1.18.04.8 python-nose=1.3.7-3 python-tk=2.7.17-1~18.04 python-dbus=1.2.6-1 build-essential=12.4ubuntu1 git=1:2.17.1-1ubuntu0.17 wget=1.19.4-1ubuntu2.2 cmake=3.10.2-1ubuntu2.18.04.2 flex=2.6.4-6 bison=2:3.0.4.dfsg-1build1 g++=4:7.4.0-1ubuntu2.3 xvfb=2:1.19.6-1ubuntu4.14 libcfitsio-dev=3.430-2 libreadline6-dev libncurses5-dev=6.1-1ubuntu1.18.04 libhdf5-serial-dev=1.10.0-patch1+docs-4 libpython3.6-dev=3.6.9-1~18.04ubuntu1.12 libboost-python-dev=1.65.1.0ubuntu1 libblas-dev=3.7.1-4ubuntu1 liblapacke-dev=3.7.1-4ubuntu1 libfftw3-dev=3.3.7-1 wcslib-dev=5.18-1 libboost-program-options-dev=1.65.1.0ubuntu1 libboost-filesystem-dev=1.65.1.0ubuntu1 libboost-system-dev=1.65.1.0ubuntu1 libboost-python-dev=1.65.1.0ubuntu1 libboost-thread-dev=1.65.1.0ubuntu1 libboost-regex-dev=1.65.1.0ubuntu1 libqt4-dev=4:4.8.7+dfsg-7ubuntu1 pgplot5=5.2.2-19.3build1 openjdk-8-jre=8u362-ga-0ubuntu1~18.04.1 libdbus-1-dev=1.12.2-1ubuntu1.4 libdbus-c++-dev=0.9.0-8.1 libxml2-dev=2.9.4+dfsg1-6.1ubuntu1.8 libxslt1-dev=1.1.29-5ubuntu0.3 libqwt-dev=6.1.3-1 libsqlite3-dev=3.22.0-1ubuntu0.7 liblog4cxx-dev=0.10.0-13ubuntu2 doxygen=1.8.13-10 swig=3.0.12-1 libgsl-dev=2.4+dfsg-6 curl=7.58.0-2ubuntu3.24 -y \\\n && apt-get clean\n#   Libgsl from 16.04 is too old for CASA, get the version from 18.04\n#  RUN for i in libgslcblas0_2.4+dfsg-6_amd64.deb libgsl23_2.4+dfsg-6_amd64.deb libgsl-dev_2.4+dfsg-6_amd64.deb; \\\n#      do wget http://nl.archive.ubuntu.com/ubuntu/pool/universe/g/gsl/$i; dpkg -i $i; rm $i; done\n#   Default libxerces in 18.04 is too new for casa code, use older version\nRUN wget http://launchpadlibrarian.net/344856440/libxerces-c3.1_3.1.4+debian-2build2_amd64.deb \\\n && wget http://launchpadlibrarian.net/344856431/libxerces-c-dev_3.1.4+debian-2build2_amd64.deb \\\n && dpkg -i libxerces-c3.1_3.1.4+debian-2build2_amd64.deb \\\n && dpkg -i libxerces-c-dev_3.1.4+debian-2build2_amd64.deb\n#   We need an older version of libeigen3 for libsakura\nRUN wget http://launchpadlibrarian.net/165141962/libeigen3-dev_3.2.0-8_all.deb \\\n && dpkg -i libeigen3-dev_3.2.0-8_all.deb \\\n && rm libeigen3-dev_3.2.0-8_all.deb\n#   install jupyter\nRUN apt-get install --no-install-recommends gfortran=4:7.4.0-1ubuntu2.3 build-essential=12.4ubuntu1 python-numpy-dev -y \\\n && pip install pip==23.1 --upgrade \\\n && /usr/local/bin/pip install matplotlib notebook widgetsnbextension \\\n && jupyter nbextension enable --py widgetsnbextension --sys-prefix\n#   Dependencies - RPFITS\nRUN wget ftp://ftp.atnf.csiro.au/pub/software/rpfits/rpfits.tar.gz \\\n && tar zxvf rpfits.tar.gz \\\n && cd rpfits/linux64 \\\n && make install \\\n && cd ../.. \\\n && rm -rf rpfits*\n#   Dependencies - LIBSAKURA\nRUN git clone https://github.com/aardk/libsakura \\\n && cd libsakura \\\n && wget https://github.com/google/googletest/archive/release-1.7.0.tar.gz \\\n && tar zxvf release-1.7.0.tar.gz \\\n && ln -s googletest-release-1.7.0 gtest \\\n && mkdir build \\\n && cd build \\\n && cmake -DSIMD_ARCH=SSE4 .. \\\n && make \\\n && make apidoc \\\n && make install \\\n && cd ../.. \\\n && rm -rf libsakura\n#   casa data needs git lfs support\nENV LFSVERSION=\"v2.6.1\"\nRUN mkdir -p gitlfs-${LFSVERSION} \\\n && cd gitlfs-${LFSVERSION} \\\n && wget https://github.com/git-lfs/git-lfs/releases/download/${LFSVERSION}/git-lfs-linux-amd64-${LFSVERSION}.tar.gz \\\n && tar zxvf git-lfs-linux-amd64-${LFSVERSION}.tar.gz \\\n && ./install.sh \\\n && cd .. \\\n && rm -rf gitlfs-${LFSVERSION}\nENV HOST_CPU_CORES=\"8\" \\\n    CASA_BUILD_TYPE=\"Release\" \\\n    CASA_ARCH=\"linux64\" \\\n    CASA_BRANCH=\"release/5.5.0\" \\\n    workDir=\"/usr/local/casa\" \\\n    CASAPATH=\"$workDir $CASA_ARCH\"\n#   ASAP need this patch to compile\nCOPY asap.patch casacore.patch /root/\n#   Build casa\nRUN git clone -b $CASA_BRANCH https://open-bitbucket.nrao.edu/scm/casa/casa.git $workDir \\\n && cd $workDir \\\n && git submodule update --init casacore \\\n && git clone https://open-bitbucket.nrao.edu/scm/casa/casa-asap.git \\\n && git clone --no-checkout https://open-bitbucket.nrao.edu/scm/casa/casa-data.git $workDir/data \\\n && cd data \\\n && git show HEAD:distro | bash \\\n && rm -rf .git ../git \\\n && cd $workDir/casacore \\\n && patch -p1 < /root/casacore.patch \\\n && mkdir $workDir/casacore/build \\\n && cd $workDir/casacore/build \\\n && cmake .. -DCMAKE_BUILD_TYPE=$CASA_BUILD_TYPE -DCMAKE_INSTALL_PREFIX=$workDir/$CASA_ARCH -DDATA_DIR=$workDir/data -DUSE_THREADS=ON -DCFITSIO_INCLUDE_DIR=/usr/include/cfitsio -DUSE_FFTW3=ON -DCFITSIO_INCLUDE_DIR=/usr/include -DCASA_BUILD=ON -DUSE_HDF5=ON -DBUILD_PYTHON=ON \\\n && make -j$HOST_CPU_CORES \\\n && make install \\\n && cd $workDir \\\n && rm -rf casacore \\\n && mkdir $workDir/code/build \\\n && cd $workDir/code/build \\\n && cmake .. -DCMAKE_BUILD_TYPE=$CASA_BUILD_TYPE -DINTERACTIVE_ITERATION=1 -DCMAKE_INSTALL_PREFIX=$workDir/$CASA_ARCH \\\n && make -j$HOST_CPU_CORES \\\n && cd $workDir \\\n && rm -rf code/build \\\n && mkdir $workDir/gcwrap/build \\\n && cd $workDir/gcwrap/build \\\n && cmake .. -Darch=$CASA_ARCH -DCMAKE_INSTALL_PREFIX=$workDir/$CASA_ARCH -DPYTHON_LIBNAME=2.7 -DCMAKE_BUILD_TYPE=$CASA_BUILD_TYPE -DINTERACTIVE_ITERATION=1 \\\n && make -j$HOST_CPU_CORES \\\n && cd $workDir \\\n && rm -rf gcWrap \\\n && cd $workDir/casa-asap \\\n && ls -l \\\n && patch -p1 < /root/asap.patch \\\n && mkdir $workDir/casa-asap/build \\\n && cd $workDir/casa-asap/build \\\n && cmake .. -Darch=$CASA_ARCH -DCMAKE_INSTALL_PREFIX=$workDir/$CASA_ARCH -DPYTHON_LIBNAME=2.7 -DCMAKE_BUILD_TYPE=$CASA_BUILD_TYPE \\\n && make -j$HOST_CPU_CORES \\\n && cd $workDir \\\n && rm -rf casa-asap \\\n && rm -rf code\n#   Install jupyter casa wrapper and copy fixed casa tasked\nRUN mkdir -p /usr/local/lib/python2.7/dist-packages\nCOPY python/start_casa /usr/local/lib/python2.7/dist-packages/start_casa\nCOPY jupyter /usr/local/share/jupyter\nCOPY python/casa/TablePlotTkAgg.py python/casa/task_setjy.py $workDir/linux64/lib/python2.7/\n#   Disable ipv6\n#  RUN echo \"net.ipv6.conf.all.disable_ipv6 = 1\\n net.ipv6.conf.default.disable_ipv6 = 1\\n net.ipv6.conf.lo.disable_ipv6 = 1\" >> /etc/sysctl.d/99-sysctl.conf \\\n#      && cat /etc/sysctl.d/99-sysctl.conf \nRUN groupadd -g 1000 jupyter \\\n && useradd -u 1000 -m -g jupyter jupyter\nEXPOSE 8888/tcp\nUSER jupyter\nWORKDIR /home/jupyter\nENV PYTHONPATH=\"/usr/local/lib/python2.7/dist-packages:/usr/local/casa/linux64/lib/python2.7\" \\\n    LD_LIBRARY_PATH=\"/usr/local/casa/linux64/lib\" \\\n    CASAPATH=\"/usr/local/casa/ linux64\" \\\n    PATH=\"/usr/local/casa/linux64/bin:$PATH\" \\\n    QT_X11_NO_MITSHM=\"1\"\nRUN mkdir -p /home/jupyter/.jupyter\nCOPY --chown=jupyter:jupyter docker/jupyter_notebook_config.py /home/jupyter/.jupyter\nCOPY --chown=jupyter:jupyter docker/create_font_cache.py /home/jupyter\nRUN python create_font_cache.py\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ubuntu:18.04\nCMD [\"jupyter\", \"notebook\"]\nRUN echo \"deb http://nl.archive.ubuntu.com/ubuntu/ bionic main restricted universe multiverse\" > /etc/apt/sources.list \\\n && echo \"deb http://nl.archive.ubuntu.com/ubuntu/ bionic-updates main restricted universe multiverse\" >> /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install apt-utils debconf-utils -y \\\n && apt-get -y upgrade \\\n && apt-get clean\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN apt-get install python2.7 python-dev python-numpy python-scipy python-pip python-nose python-tk python-dbus build-essential git wget cmake flex bison g++ xvfb libcfitsio-dev libreadline6-dev libncurses5-dev libhdf5-serial-dev libpython3.6-dev libboost-python-dev libblas-dev liblapacke-dev libfftw3-dev wcslib-dev libboost-program-options-dev libboost-filesystem-dev libboost-system-dev libboost-python-dev libboost-thread-dev libboost-regex-dev libqt4-dev pgplot5 openjdk-8-jre libdbus-1-dev libdbus-c++-dev libxml2-dev libxslt1-dev libqwt-dev libsqlite3-dev liblog4cxx-dev doxygen swig libgsl-dev curl -y \\\n && apt-get clean\n#  Libgsl from 16.04 is too old for CASA, get the version from 18.04\n# RUN for i in libgslcblas0_2.4+dfsg-6_amd64.deb libgsl23_2.4+dfsg-6_amd64.deb libgsl-dev_2.4+dfsg-6_amd64.deb; \\\n#     do wget http://nl.archive.ubuntu.com/ubuntu/pool/universe/g/gsl/$i; dpkg -i $i; rm $i; done\n#  Default libxerces in 18.04 is too new for casa code, use older version\nRUN wget http://launchpadlibrarian.net/344856440/libxerces-c3.1_3.1.4+debian-2build2_amd64.deb \\\n && wget http://launchpadlibrarian.net/344856431/libxerces-c-dev_3.1.4+debian-2build2_amd64.deb \\\n && dpkg -i libxerces-c3.1_3.1.4+debian-2build2_amd64.deb \\\n && dpkg -i libxerces-c-dev_3.1.4+debian-2build2_amd64.deb\n#  We need an older version of libeigen3 for libsakura\nRUN wget http://launchpadlibrarian.net/165141962/libeigen3-dev_3.2.0-8_all.deb \\\n && dpkg -i libeigen3-dev_3.2.0-8_all.deb \\\n && rm libeigen3-dev_3.2.0-8_all.deb\n#  install jupyter\nRUN apt-get install gfortran build-essential python-numpy-dev -y \\\n && pip install pip --upgrade \\\n && /usr/local/bin/pip install matplotlib notebook widgetsnbextension \\\n && jupyter nbextension enable --py widgetsnbextension --sys-prefix\n#  Dependencies - RPFITS\nRUN wget ftp://ftp.atnf.csiro.au/pub/software/rpfits/rpfits.tar.gz \\\n && tar zxvf rpfits.tar.gz \\\n && cd rpfits/linux64 \\\n && make install \\\n && cd ../.. \\\n && rm -rf rpfits*\n#  Dependencies - LIBSAKURA\nRUN git clone https://github.com/aardk/libsakura \\\n && cd libsakura \\\n && wget https://github.com/google/googletest/archive/release-1.7.0.tar.gz \\\n && tar zxvf release-1.7.0.tar.gz \\\n && ln -s googletest-release-1.7.0 gtest \\\n && mkdir build \\\n && cd build \\\n && cmake -DSIMD_ARCH=SSE4 .. \\\n && make \\\n && make apidoc \\\n && make install \\\n && cd ../.. \\\n && rm -rf libsakura\n#  casa data needs git lfs support\nENV LFSVERSION=\"v2.6.1\"\nRUN mkdir -p gitlfs-${LFSVERSION} \\\n && cd gitlfs-${LFSVERSION} \\\n && wget https://github.com/git-lfs/git-lfs/releases/download/${LFSVERSION}/git-lfs-linux-amd64-${LFSVERSION}.tar.gz \\\n && tar zxvf git-lfs-linux-amd64-${LFSVERSION}.tar.gz \\\n && ./install.sh \\\n && cd .. \\\n && rm -rf gitlfs-${LFSVERSION}\nENV HOST_CPU_CORES=\"8\" \\\n    CASA_BUILD_TYPE=\"Release\" \\\n    CASA_ARCH=\"linux64\" \\\n    CASA_BRANCH=\"release/5.5.0\" \\\n    workDir=\"/usr/local/casa\" \\\n    CASAPATH=\"$workDir $CASA_ARCH\"\n#  ASAP need this patch to compile\nCOPY asap.patch casacore.patch /root/\n#  Build casa\nRUN git clone -b $CASA_BRANCH https://open-bitbucket.nrao.edu/scm/casa/casa.git $workDir \\\n && cd $workDir \\\n && git submodule update --init casacore \\\n && git clone https://open-bitbucket.nrao.edu/scm/casa/casa-asap.git \\\n && git clone --no-checkout https://open-bitbucket.nrao.edu/scm/casa/casa-data.git $workDir/data \\\n && cd data \\\n && git show HEAD:distro | bash \\\n && rm -rf .git ../git \\\n && cd $workDir/casacore \\\n && patch -p1 < /root/casacore.patch \\\n && mkdir $workDir/casacore/build \\\n && cd $workDir/casacore/build \\\n && cmake .. -DCMAKE_BUILD_TYPE=$CASA_BUILD_TYPE -DCMAKE_INSTALL_PREFIX=$workDir/$CASA_ARCH -DDATA_DIR=$workDir/data -DUSE_THREADS=ON -DCFITSIO_INCLUDE_DIR=/usr/include/cfitsio -DUSE_FFTW3=ON -DCFITSIO_INCLUDE_DIR=/usr/include -DCASA_BUILD=ON -DUSE_HDF5=ON -DBUILD_PYTHON=ON \\\n && make -j$HOST_CPU_CORES \\\n && make install \\\n && cd $workDir \\\n && rm -rf casacore \\\n && mkdir $workDir/code/build \\\n && cd $workDir/code/build \\\n && cmake .. -DCMAKE_BUILD_TYPE=$CASA_BUILD_TYPE -DINTERACTIVE_ITERATION=1 -DCMAKE_INSTALL_PREFIX=$workDir/$CASA_ARCH \\\n && make -j$HOST_CPU_CORES \\\n && cd $workDir \\\n && rm -rf code/build \\\n && mkdir $workDir/gcwrap/build \\\n && cd $workDir/gcwrap/build \\\n && cmake .. -Darch=$CASA_ARCH -DCMAKE_INSTALL_PREFIX=$workDir/$CASA_ARCH -DPYTHON_LIBNAME=2.7 -DCMAKE_BUILD_TYPE=$CASA_BUILD_TYPE -DINTERACTIVE_ITERATION=1 \\\n && make -j$HOST_CPU_CORES \\\n && cd $workDir \\\n && rm -rf gcWrap \\\n && cd $workDir/casa-asap \\\n && ls -l \\\n && patch -p1 < /root/asap.patch \\\n && mkdir $workDir/casa-asap/build \\\n && cd $workDir/casa-asap/build \\\n && cmake .. -Darch=$CASA_ARCH -DCMAKE_INSTALL_PREFIX=$workDir/$CASA_ARCH -DPYTHON_LIBNAME=2.7 -DCMAKE_BUILD_TYPE=$CASA_BUILD_TYPE \\\n && make -j$HOST_CPU_CORES \\\n && cd $workDir \\\n && rm -rf casa-asap \\\n && rm -rf code\n#  Install jupyter casa wrapper and copy fixed casa tasked\nRUN mkdir -p /usr/local/lib/python2.7/dist-packages\nCOPY python/start_casa /usr/local/lib/python2.7/dist-packages/start_casa\nCOPY jupyter /usr/local/share/jupyter\nCOPY python/casa/TablePlotTkAgg.py python/casa/task_setjy.py $workDir/linux64/lib/python2.7/\n#  Disable ipv6\n# RUN echo \"net.ipv6.conf.all.disable_ipv6 = 1\\n net.ipv6.conf.default.disable_ipv6 = 1\\n net.ipv6.conf.lo.disable_ipv6 = 1\" >> /etc/sysctl.d/99-sysctl.conf \\\n#     && cat /etc/sysctl.d/99-sysctl.conf \nRUN groupadd -g 1000 jupyter \\\n && useradd -u 1000 -m -g jupyter jupyter\nEXPOSE 8888/tcp\nUSER jupyter\nWORKDIR /home/jupyter\nENV PYTHONPATH=\"/usr/local/lib/python2.7/dist-packages:/usr/local/casa/linux64/lib/python2.7\" \\\n    LD_LIBRARY_PATH=\"/usr/local/casa/linux64/lib\" \\\n    CASAPATH=\"/usr/local/casa/ linux64\" \\\n    PATH=\"/usr/local/casa/linux64/bin:$PATH\" \\\n    QT_X11_NO_MITSHM=\"1\"\nRUN mkdir -p /home/jupyter/.jupyter\nCOPY --chown=jupyter:jupyter docker/jupyter_notebook_config.py /home/jupyter/.jupyter\nCOPY --chown=jupyter:jupyter docker/create_font_cache.py /home/jupyter\nRUN python create_font_cache.py\n","injectedSmells":[],"originalDockerfileHash":"1b121ea45de7c2f1235dadd68d28c3e4","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:18.04\nCMD [\"jupyter\", \"notebook\"]\nRUN echo \"deb http://nl.archive.ubuntu.com/ubuntu/ bionic main restricted universe multiverse\" > /etc/apt/sources.list \\\n && echo \"deb http://nl.archive.ubuntu.com/ubuntu/ bionic-updates main restricted universe multiverse\" >> /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install apt-utils debconf-utils -y \\\n && apt-get -y upgrade \\\n && apt-get clean\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN apt-get install python2.7 python-dev python-numpy python-scipy python-pip python-nose python-tk python-dbus build-essential git wget cmake flex bison g++ xvfb libcfitsio-dev libreadline6-dev libncurses5-dev libhdf5-serial-dev libpython3.6-dev libboost-python-dev libblas-dev liblapacke-dev libfftw3-dev wcslib-dev libboost-program-options-dev libboost-filesystem-dev libboost-system-dev libboost-python-dev libboost-thread-dev libboost-regex-dev libqt4-dev pgplot5 openjdk-8-jre libdbus-1-dev libdbus-c++-dev libxml2-dev libxslt1-dev libqwt-dev libsqlite3-dev liblog4cxx-dev doxygen swig libgsl-dev curl -y \\\n && apt-get clean\n#   Libgsl from 16.04 is too old for CASA, get the version from 18.04\n#  RUN for i in libgslcblas0_2.4+dfsg-6_amd64.deb libgsl23_2.4+dfsg-6_amd64.deb libgsl-dev_2.4+dfsg-6_amd64.deb; \\\n#      do wget http://nl.archive.ubuntu.com/ubuntu/pool/universe/g/gsl/$i; dpkg -i $i; rm $i; done\n#   Default libxerces in 18.04 is too new for casa code, use older version\nRUN wget http://launchpadlibrarian.net/344856440/libxerces-c3.1_3.1.4+debian-2build2_amd64.deb \\\n && wget http://launchpadlibrarian.net/344856431/libxerces-c-dev_3.1.4+debian-2build2_amd64.deb \\\n && dpkg -i libxerces-c3.1_3.1.4+debian-2build2_amd64.deb \\\n && dpkg -i libxerces-c-dev_3.1.4+debian-2build2_amd64.deb\n#   We need an older version of libeigen3 for libsakura\nRUN wget http://launchpadlibrarian.net/165141962/libeigen3-dev_3.2.0-8_all.deb \\\n && dpkg -i libeigen3-dev_3.2.0-8_all.deb \\\n && rm libeigen3-dev_3.2.0-8_all.deb\n#   install jupyter\nRUN apt-get install gfortran build-essential python-numpy-dev -y \\\n && pip install pip --upgrade \\\n && /usr/local/bin/pip install matplotlib notebook widgetsnbextension \\\n && jupyter nbextension enable --py widgetsnbextension --sys-prefix\n#   Dependencies - RPFITS\nRUN wget ftp://ftp.atnf.csiro.au/pub/software/rpfits/rpfits.tar.gz \\\n && tar zxvf rpfits.tar.gz \\\n && cd rpfits/linux64 \\\n && make install \\\n && cd ../.. \\\n && rm -rf rpfits*\n#   Dependencies - LIBSAKURA\nRUN git clone https://github.com/aardk/libsakura \\\n && cd libsakura \\\n && wget https://github.com/google/googletest/archive/release-1.7.0.tar.gz \\\n && tar zxvf release-1.7.0.tar.gz \\\n && ln -s googletest-release-1.7.0 gtest \\\n && mkdir build \\\n && cd build \\\n && cmake -DSIMD_ARCH=SSE4 .. \\\n && make \\\n && make apidoc \\\n && make install \\\n && cd ../.. \\\n && rm -rf libsakura\n#   casa data needs git lfs support\nENV LFSVERSION=\"v2.6.1\"\nRUN mkdir -p gitlfs-${LFSVERSION} \\\n && cd gitlfs-${LFSVERSION} \\\n && wget https://github.com/git-lfs/git-lfs/releases/download/${LFSVERSION}/git-lfs-linux-amd64-${LFSVERSION}.tar.gz \\\n && tar zxvf git-lfs-linux-amd64-${LFSVERSION}.tar.gz \\\n && ./install.sh \\\n && cd .. \\\n && rm -rf gitlfs-${LFSVERSION}\nENV HOST_CPU_CORES=\"8\" \\\n    CASA_BUILD_TYPE=\"Release\" \\\n    CASA_ARCH=\"linux64\" \\\n    CASA_BRANCH=\"release/5.5.0\" \\\n    workDir=\"/usr/local/casa\" \\\n    CASAPATH=\"$workDir $CASA_ARCH\"\n#   ASAP need this patch to compile\nCOPY asap.patch casacore.patch /root/\n#   Build casa\nRUN git clone -b $CASA_BRANCH https://open-bitbucket.nrao.edu/scm/casa/casa.git $workDir \\\n && cd $workDir \\\n && git submodule update --init casacore \\\n && git clone https://open-bitbucket.nrao.edu/scm/casa/casa-asap.git \\\n && git clone --no-checkout https://open-bitbucket.nrao.edu/scm/casa/casa-data.git $workDir/data \\\n && cd data \\\n && git show HEAD:distro | bash \\\n && rm -rf .git ../git \\\n && cd $workDir/casacore \\\n && patch -p1 < /root/casacore.patch \\\n && mkdir $workDir/casacore/build \\\n && cd $workDir/casacore/build \\\n && cmake .. -DCMAKE_BUILD_TYPE=$CASA_BUILD_TYPE -DCMAKE_INSTALL_PREFIX=$workDir/$CASA_ARCH -DDATA_DIR=$workDir/data -DUSE_THREADS=ON -DCFITSIO_INCLUDE_DIR=/usr/include/cfitsio -DUSE_FFTW3=ON -DCFITSIO_INCLUDE_DIR=/usr/include -DCASA_BUILD=ON -DUSE_HDF5=ON -DBUILD_PYTHON=ON \\\n && make -j$HOST_CPU_CORES \\\n && make install \\\n && cd $workDir \\\n && rm -rf casacore \\\n && mkdir $workDir/code/build \\\n && cd $workDir/code/build \\\n && cmake .. -DCMAKE_BUILD_TYPE=$CASA_BUILD_TYPE -DINTERACTIVE_ITERATION=1 -DCMAKE_INSTALL_PREFIX=$workDir/$CASA_ARCH \\\n && make -j$HOST_CPU_CORES \\\n && cd $workDir \\\n && rm -rf code/build \\\n && mkdir $workDir/gcwrap/build \\\n && cd $workDir/gcwrap/build \\\n && cmake .. -Darch=$CASA_ARCH -DCMAKE_INSTALL_PREFIX=$workDir/$CASA_ARCH -DPYTHON_LIBNAME=2.7 -DCMAKE_BUILD_TYPE=$CASA_BUILD_TYPE -DINTERACTIVE_ITERATION=1 \\\n && make -j$HOST_CPU_CORES \\\n && cd $workDir \\\n && rm -rf gcWrap \\\n && cd $workDir/casa-asap \\\n && ls -l \\\n && patch -p1 < /root/asap.patch \\\n && mkdir $workDir/casa-asap/build \\\n && cd $workDir/casa-asap/build \\\n && cmake .. -Darch=$CASA_ARCH -DCMAKE_INSTALL_PREFIX=$workDir/$CASA_ARCH -DPYTHON_LIBNAME=2.7 -DCMAKE_BUILD_TYPE=$CASA_BUILD_TYPE \\\n && make -j$HOST_CPU_CORES \\\n && cd $workDir \\\n && rm -rf casa-asap \\\n && rm -rf code\n#   Install jupyter casa wrapper and copy fixed casa tasked\nRUN mkdir -p /usr/local/lib/python2.7/dist-packages\nCOPY python/start_casa /usr/local/lib/python2.7/dist-packages/start_casa\nCOPY jupyter /usr/local/share/jupyter\nCOPY python/casa/TablePlotTkAgg.py python/casa/task_setjy.py $workDir/linux64/lib/python2.7/\n#   Disable ipv6\n#  RUN echo \"net.ipv6.conf.all.disable_ipv6 = 1\\n net.ipv6.conf.default.disable_ipv6 = 1\\n net.ipv6.conf.lo.disable_ipv6 = 1\" >> /etc/sysctl.d/99-sysctl.conf \\\n#      && cat /etc/sysctl.d/99-sysctl.conf \nRUN groupadd -g 1000 jupyter \\\n && useradd -u 1000 -m -g jupyter jupyter\nEXPOSE 8888/tcp\nUSER jupyter\nWORKDIR /home/jupyter\nENV PYTHONPATH=\"/usr/local/lib/python2.7/dist-packages:/usr/local/casa/linux64/lib/python2.7\" \\\n    LD_LIBRARY_PATH=\"/usr/local/casa/linux64/lib\" \\\n    CASAPATH=\"/usr/local/casa/ linux64\" \\\n    PATH=\"/usr/local/casa/linux64/bin:$PATH\" \\\n    QT_X11_NO_MITSHM=\"1\"\nRUN mkdir -p /home/jupyter/.jupyter\nCOPY --chown=jupyter:jupyter docker/jupyter_notebook_config.py /home/jupyter/.jupyter\nCOPY --chown=jupyter:jupyter docker/create_font_cache.py /home/jupyter\nRUN python create_font_cache.py\n","originalDockerfileUglifiedHash":"31a318c8cce26ddfaad2aa0e6a7843ee","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/ce292892513b093937bff0cb38754189c33911a6.dockerfile"}