{"seed":939320103,"processedDockerfileHash":"0570950c0e2421abefefffb9dfc37926","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apt-get","have-a-healthcheck","have-a-user"],"processedDockerfile":"ARG docker_repo=zokradonh\nFROM ${docker_repo}/kopano_base\nARG VCS_REF\nARG ADDITIONAL_KOPANO_PACKAGES=\"\"\nARG DOWNLOAD_COMMUNITY_PACKAGES=1\nARG KOPANO_REPOSITORY_FLAGS=\"trusted=yes\"\nARG RELEASE_KEY_DOWNLOAD=0\nARG DEBIAN_FRONTEND=noninteractive\nARG KOPANO_CORE_REPOSITORY_URL=\"file:/kopano/repo/core\"\nARG KOPANO_CORE_VERSION=newest\nARG KOPANO_ZPUSH_REPOSITORY_URL=\"http://repo.z-hub.io/z-push:/final/Debian_9.0/\"\nARG KOPANO_ZPUSH_VERSION=newest\nENV ADDITIONAL_KOPANO_PACKAGES=\"$ADDITIONAL_KOPANO_PACKAGES\" \\\n    DOWNLOAD_COMMUNITY_PACKAGES=\"$DOWNLOAD_COMMUNITY_PACKAGES\" \\\n    KOPANO_CORE_REPOSITORY_URL=\"$KOPANO_CORE_REPOSITORY_URL\" \\\n    KOPANO_CORE_VERSION=\"$KOPANO_CORE_VERSION\" \\\n    KOPANO_REPOSITORY_FLAGS=\"$KOPANO_REPOSITORY_FLAGS\" \\\n    RELEASE_KEY_DOWNLOAD=\"$RELEASE_KEY_DOWNLOAD\" \\\n    KOPANO_ZPUSH_REPOSITORY_URL=\"$KOPANO_ZPUSH_REPOSITORY_URL\" \\\n    KOPANO_ZPUSH_VERSION=\"$KOPANO_ZPUSH_VERSION\"\nLABEL maintainer=\"az@zok.xyz\" \\\n      org.label-schema.name=\"Kopano Z-Push container\" \\\n      org.label-schema.description=\"Container for running Z-Push with Kopano Groupware Core\" \\\n      org.label-schema.url=\"https://kopano.io\" \\\n      org.label-schema.vcs-ref=\"$VCS_REF\" \\\n      org.label-schema.vcs-url=\"https://github.com/zokradonh/kopano-docker\" \\\n      org.label-schema.version=\"$KOPANO_ZPUSH_VERSION\" \\\n      org.label-schema.schema-version=\"1.0\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   install Kopano WebApp and refresh ca-certificates\nRUN . /kopano/helper/create-kopano-repo.sh \\\n && if [ ${DOWNLOAD_COMMUNITY_PACKAGES} -eq 1 ] ; then dl_and_package_community \"core\" ; fi ; echo \"deb [${KOPANO_REPOSITORY_FLAGS}] ${KOPANO_CORE_REPOSITORY_URL} ./\" > /etc/apt/sources.list.d/kopano.list; echo \"deb ${KOPANO_ZPUSH_REPOSITORY_URL} /\" > /etc/apt/sources.list.d/zpush.list \\\n && curl -s -S -o - \"${KOPANO_ZPUSH_REPOSITORY_URL}/Release.key\" | apt-key add - \\\n && set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends apache2=2.4.55-1ubuntu2 libapache2-mod-php7.0 crudini=0.9.4-1 z-push-kopano z-push-config-apache z-push-kopano-gabsync z-push-autodiscover z-push-config-apache-autodiscover ca-certificates=20230311 ${ADDITIONAL_KOPANO_PACKAGES} -y \\\n && rm -rf /var/cache/apt /var/lib/apt/lists\nCOPY apache2-kopano.conf /etc/apache2/sites-available/kopano.conf\n#   configure basics\nRUN rm /etc/apache2/sites-enabled/* \\\n && sed -e 's,^ErrorLog.*,ErrorLog \"|/bin/cat\",' -i /etc/apache2/apache2.conf \\\n && sed -e \"s,MaxSpareServers[^:].*,MaxSpareServers 5,\" -i /etc/apache2/mods-available/mpm_prefork.conf \\\n && a2disconf other-vhosts-access-log \\\n && a2ensite kopano \\\n && echo \"Listen 80\" > /etc/apache2/ports.conf \\\n && a2enmod rewrite \\\n && crudini --set /etc/php/7.0/apache2/php.ini PHP upload_max_filesize 500M \\\n && crudini --set /etc/php/7.0/apache2/php.ini PHP post_max_size 500M \\\n && crudini --set /etc/php/7.0/apache2/php.ini PHP max_input_vars 1800 \\\n && crudini --set /etc/php/7.0/apache2/php.ini Session session.save_path /run/sessions \\\n && mkdir -p /var/lib/z-push /var/log/z-push \\\n && chown www-data:www-data /var/lib/z-push /var/log/z-push\n#   Patch Gabsync to make it work\n#   See https://jira.z-hub.io/browse/ZP-1463\n#   https://forum.kopano.io/topic/1928/8-7-80-missing-php-files-in-php-mapi-deb-package-ubuntu-16-04\n#   can be removed once gabsync is fixed - should not hurt\nRUN sed -i -e \"s/set_include_path(get_include_path() . PATH_SEPARATOR . BASE_PATH_CLI);/define('PATH_TO_ZPUSH', '..\\/..\\/backend\\/kopano\\/');\\n set_include_path(get_include_path() . PATH_SEPARATOR . BASE_PATH_CLI . PATH_SEPARATOR . BASE_PATH_CLI . PATH_TO_ZPUSH);/\" /usr/share/z-push/tools/gab-sync/gab-sync.php\nVOLUME /var/lib/z-push/\nEXPOSE 80/tcp\nCOPY start.sh /kopano/start.sh\nENV LANG=\"en_US.UTF-8\"\nENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\nCMD [\"/kopano/start.sh\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"ARG docker_repo=zokradonh\nFROM ${docker_repo}/kopano_base\nARG VCS_REF\nARG ADDITIONAL_KOPANO_PACKAGES=\"\"\nARG DOWNLOAD_COMMUNITY_PACKAGES=1\nARG KOPANO_REPOSITORY_FLAGS=\"trusted=yes\"\nARG RELEASE_KEY_DOWNLOAD=0\nARG DEBIAN_FRONTEND=noninteractive\nARG KOPANO_CORE_REPOSITORY_URL=\"file:/kopano/repo/core\"\nARG KOPANO_CORE_VERSION=newest\nARG KOPANO_ZPUSH_REPOSITORY_URL=\"http://repo.z-hub.io/z-push:/final/Debian_9.0/\"\nARG KOPANO_ZPUSH_VERSION=newest\nENV ADDITIONAL_KOPANO_PACKAGES=\"$ADDITIONAL_KOPANO_PACKAGES\" \\\n    DOWNLOAD_COMMUNITY_PACKAGES=\"$DOWNLOAD_COMMUNITY_PACKAGES\" \\\n    KOPANO_CORE_REPOSITORY_URL=\"$KOPANO_CORE_REPOSITORY_URL\" \\\n    KOPANO_CORE_VERSION=\"$KOPANO_CORE_VERSION\" \\\n    KOPANO_REPOSITORY_FLAGS=\"$KOPANO_REPOSITORY_FLAGS\" \\\n    RELEASE_KEY_DOWNLOAD=\"$RELEASE_KEY_DOWNLOAD\" \\\n    KOPANO_ZPUSH_REPOSITORY_URL=\"$KOPANO_ZPUSH_REPOSITORY_URL\" \\\n    KOPANO_ZPUSH_VERSION=\"$KOPANO_ZPUSH_VERSION\"\nLABEL maintainer=\"az@zok.xyz\" \\\n      org.label-schema.name=\"Kopano Z-Push container\" \\\n      org.label-schema.description=\"Container for running Z-Push with Kopano Groupware Core\" \\\n      org.label-schema.url=\"https://kopano.io\" \\\n      org.label-schema.vcs-ref=\"$VCS_REF\" \\\n      org.label-schema.vcs-url=\"https://github.com/zokradonh/kopano-docker\" \\\n      org.label-schema.version=\"$KOPANO_ZPUSH_VERSION\" \\\n      org.label-schema.schema-version=\"1.0\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  install Kopano WebApp and refresh ca-certificates\nRUN . /kopano/helper/create-kopano-repo.sh \\\n && if [ ${DOWNLOAD_COMMUNITY_PACKAGES} -eq 1 ] ; then dl_and_package_community \"core\" ; fi ; echo \"deb [${KOPANO_REPOSITORY_FLAGS}] ${KOPANO_CORE_REPOSITORY_URL} ./\" > /etc/apt/sources.list.d/kopano.list; echo \"deb ${KOPANO_ZPUSH_REPOSITORY_URL} /\" > /etc/apt/sources.list.d/zpush.list \\\n && curl -s -S -o - \"${KOPANO_ZPUSH_REPOSITORY_URL}/Release.key\" | apt-key add - \\\n && set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends apache2 libapache2-mod-php7.0 crudini z-push-kopano z-push-config-apache z-push-kopano-gabsync z-push-autodiscover z-push-config-apache-autodiscover ca-certificates ${ADDITIONAL_KOPANO_PACKAGES} -y \\\n && rm -rf /var/cache/apt /var/lib/apt/lists\nCOPY apache2-kopano.conf /etc/apache2/sites-available/kopano.conf\n#  configure basics\nRUN rm /etc/apache2/sites-enabled/* \\\n && sed -e 's,^ErrorLog.*,ErrorLog \"|/bin/cat\",' -i /etc/apache2/apache2.conf \\\n && sed -e \"s,MaxSpareServers[^:].*,MaxSpareServers 5,\" -i /etc/apache2/mods-available/mpm_prefork.conf \\\n && a2disconf other-vhosts-access-log \\\n && a2ensite kopano \\\n && echo \"Listen 80\" > /etc/apache2/ports.conf \\\n && a2enmod rewrite \\\n && crudini --set /etc/php/7.0/apache2/php.ini PHP upload_max_filesize 500M \\\n && crudini --set /etc/php/7.0/apache2/php.ini PHP post_max_size 500M \\\n && crudini --set /etc/php/7.0/apache2/php.ini PHP max_input_vars 1800 \\\n && crudini --set /etc/php/7.0/apache2/php.ini Session session.save_path /run/sessions \\\n && mkdir -p /var/lib/z-push /var/log/z-push \\\n && chown www-data:www-data /var/lib/z-push /var/log/z-push\n#  Patch Gabsync to make it work\n#  See https://jira.z-hub.io/browse/ZP-1463\n#  https://forum.kopano.io/topic/1928/8-7-80-missing-php-files-in-php-mapi-deb-package-ubuntu-16-04\n#  can be removed once gabsync is fixed - should not hurt\nRUN sed -i -e \"s/set_include_path(get_include_path() . PATH_SEPARATOR . BASE_PATH_CLI);/define('PATH_TO_ZPUSH', '..\\/..\\/backend\\/kopano\\/');\\n set_include_path(get_include_path() . PATH_SEPARATOR . BASE_PATH_CLI . PATH_SEPARATOR . BASE_PATH_CLI . PATH_TO_ZPUSH);/\" /usr/share/z-push/tools/gab-sync/gab-sync.php\nVOLUME /var/lib/z-push/\nEXPOSE 80/tcp\nCOPY start.sh /kopano/start.sh\nENV LANG=\"en_US.UTF-8\"\nENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\nCMD [\"/kopano/start.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"41ee23d03e60d67bfa41eb6a37fce327","successfullyInjectedSmells":[],"originalDockerfileUglified":"ARG docker_repo=zokradonh\nFROM ${docker_repo}/kopano_base\nARG VCS_REF\nARG ADDITIONAL_KOPANO_PACKAGES=\"\"\nARG DOWNLOAD_COMMUNITY_PACKAGES=1\nARG KOPANO_REPOSITORY_FLAGS=\"trusted=yes\"\nARG RELEASE_KEY_DOWNLOAD=0\nARG DEBIAN_FRONTEND=noninteractive\nARG KOPANO_CORE_REPOSITORY_URL=\"file:/kopano/repo/core\"\nARG KOPANO_CORE_VERSION=newest\nARG KOPANO_ZPUSH_REPOSITORY_URL=\"http://repo.z-hub.io/z-push:/final/Debian_9.0/\"\nARG KOPANO_ZPUSH_VERSION=newest\nENV ADDITIONAL_KOPANO_PACKAGES=\"$ADDITIONAL_KOPANO_PACKAGES\" \\\n    DOWNLOAD_COMMUNITY_PACKAGES=\"$DOWNLOAD_COMMUNITY_PACKAGES\" \\\n    KOPANO_CORE_REPOSITORY_URL=\"$KOPANO_CORE_REPOSITORY_URL\" \\\n    KOPANO_CORE_VERSION=\"$KOPANO_CORE_VERSION\" \\\n    KOPANO_REPOSITORY_FLAGS=\"$KOPANO_REPOSITORY_FLAGS\" \\\n    RELEASE_KEY_DOWNLOAD=\"$RELEASE_KEY_DOWNLOAD\" \\\n    KOPANO_ZPUSH_REPOSITORY_URL=\"$KOPANO_ZPUSH_REPOSITORY_URL\" \\\n    KOPANO_ZPUSH_VERSION=\"$KOPANO_ZPUSH_VERSION\"\nLABEL maintainer=\"az@zok.xyz\" \\\n      org.label-schema.name=\"Kopano Z-Push container\" \\\n      org.label-schema.description=\"Container for running Z-Push with Kopano Groupware Core\" \\\n      org.label-schema.url=\"https://kopano.io\" \\\n      org.label-schema.vcs-ref=\"$VCS_REF\" \\\n      org.label-schema.vcs-url=\"https://github.com/zokradonh/kopano-docker\" \\\n      org.label-schema.version=\"$KOPANO_ZPUSH_VERSION\" \\\n      org.label-schema.schema-version=\"1.0\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   install Kopano WebApp and refresh ca-certificates\nRUN . /kopano/helper/create-kopano-repo.sh \\\n && if [ ${DOWNLOAD_COMMUNITY_PACKAGES} -eq 1 ] ; then dl_and_package_community \"core\" ; fi ; echo \"deb [${KOPANO_REPOSITORY_FLAGS}] ${KOPANO_CORE_REPOSITORY_URL} ./\" > /etc/apt/sources.list.d/kopano.list; echo \"deb ${KOPANO_ZPUSH_REPOSITORY_URL} /\" > /etc/apt/sources.list.d/zpush.list \\\n && curl -s -S -o - \"${KOPANO_ZPUSH_REPOSITORY_URL}/Release.key\" | apt-key add - \\\n && set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends apache2 libapache2-mod-php7.0 crudini z-push-kopano z-push-config-apache z-push-kopano-gabsync z-push-autodiscover z-push-config-apache-autodiscover ca-certificates ${ADDITIONAL_KOPANO_PACKAGES} -y \\\n && rm -rf /var/cache/apt /var/lib/apt/lists\nCOPY apache2-kopano.conf /etc/apache2/sites-available/kopano.conf\n#   configure basics\nRUN rm /etc/apache2/sites-enabled/* \\\n && sed -e 's,^ErrorLog.*,ErrorLog \"|/bin/cat\",' -i /etc/apache2/apache2.conf \\\n && sed -e \"s,MaxSpareServers[^:].*,MaxSpareServers 5,\" -i /etc/apache2/mods-available/mpm_prefork.conf \\\n && a2disconf other-vhosts-access-log \\\n && a2ensite kopano \\\n && echo \"Listen 80\" > /etc/apache2/ports.conf \\\n && a2enmod rewrite \\\n && crudini --set /etc/php/7.0/apache2/php.ini PHP upload_max_filesize 500M \\\n && crudini --set /etc/php/7.0/apache2/php.ini PHP post_max_size 500M \\\n && crudini --set /etc/php/7.0/apache2/php.ini PHP max_input_vars 1800 \\\n && crudini --set /etc/php/7.0/apache2/php.ini Session session.save_path /run/sessions \\\n && mkdir -p /var/lib/z-push /var/log/z-push \\\n && chown www-data:www-data /var/lib/z-push /var/log/z-push\n#   Patch Gabsync to make it work\n#   See https://jira.z-hub.io/browse/ZP-1463\n#   https://forum.kopano.io/topic/1928/8-7-80-missing-php-files-in-php-mapi-deb-package-ubuntu-16-04\n#   can be removed once gabsync is fixed - should not hurt\nRUN sed -i -e \"s/set_include_path(get_include_path() . PATH_SEPARATOR . BASE_PATH_CLI);/define('PATH_TO_ZPUSH', '..\\/..\\/backend\\/kopano\\/');\\n set_include_path(get_include_path() . PATH_SEPARATOR . BASE_PATH_CLI . PATH_SEPARATOR . BASE_PATH_CLI . PATH_TO_ZPUSH);/\" /usr/share/z-push/tools/gab-sync/gab-sync.php\nVOLUME /var/lib/z-push/\nEXPOSE 80/tcp\nCOPY start.sh /kopano/start.sh\nENV LANG=\"en_US.UTF-8\"\nENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\nCMD [\"/kopano/start.sh\"]\n","originalDockerfileUglifiedHash":"df7d98f734f3ae346a81c4d0e68747bf","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/c1966715742c30c07c0b93bb6a3fb0ec0e845f01.dockerfile"}