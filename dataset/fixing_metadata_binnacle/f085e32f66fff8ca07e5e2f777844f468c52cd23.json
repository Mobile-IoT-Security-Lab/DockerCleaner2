{"seed":4062817015,"processedDockerfileHash":"5287a2d74aeab23ce4872b7e3a468b7d","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","have-a-healthcheck"],"processedDockerfile":"FROM debian:9.6-slim\n#   install package\nRUN apt-get update -y \\\n && apt-get install --no-install-recommends build-essential python-setuptools wget cron sudo locales git supervisor nginx gettext-base libssl1.0-dev -y \\\n && apt-get autoremove --purge \\\n && apt-get clean\n#   [work around] for  \"cmd\": \"chsh frappe -s $(which bash)\", \"stderr\": \"Password: chsh: PAM: Authentication failure\"\n#   caused by > bench/playbooks/create_user.yml > shell: \"chsh {{ frappe_user }} -s $(which bash)\"\nRUN sed -i 's/auth required pam_shells.so/auth sufficient pam_shells.so/' /etc/pam.d/chsh\n#   set locales\nRUN sed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen \\\n && locale-gen\nENV LC_ALL=\"en_US.UTF-8\" \\\n    LC_CTYPE=\"en_US.UTF-8\" \\\n    LANG=\"en_US.UTF-8\"\n#   manually install mariadb\nRUN apt-get update \\\n && apt-get install --no-install-recommends software-properties-common dirmngr -y \\\n && apt-key adv --no-tty --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xF1656F24C74CD1D8 \\\n && add-apt-repository 'deb [arch=amd64,i386,ppc64el] http://nyc2.mirrors.digitalocean.com/mariadb/repo/10.3/debian stretch main' \\\n && export DEBIAN_FRONTEND=noninteractive \\\n && apt-get update \\\n && apt-get install --no-install-recommends mariadb-server mariadb-client mariadb-common libmariadbclient18 python-mysqldb python3-mysqldb -y\n#   add users without sudo password\nENV systemUser=\"frappe\"\nRUN adduser --disabled-password --gecos \"\" $systemUser \\\n && usermod -aG sudo $systemUser \\\n && echo \"%sudo ALL=(ALL) NOPASSWD: ALL\" > /etc/sudoers.d/sudoers\n#   set user and workdir\nUSER $systemUser\nWORKDIR /home/$systemUser\nCOPY ./mariadb.cnf /etc/mysql/conf.d/mariadb.cnf\n#   install prerequisite for bench with easy install script\nENV easyinstallRepo=\"https://raw.githubusercontent.com/frappe/bench/master/playbooks/install.py\" \\\n    benchPath=\"bench-repo\" \\\n    benchBranch=\"master\" \\\n    benchFolderName=\"bench\" \\\n    benchRepo=\"https://github.com/frappe/bench\" \\\n    frappeRepo=\"https://github.com/frappe/frappe\" \\\n    erpnextRepo=\"https://github.com/frappe/erpnext\" \\\n    siteName=\"site1.local\" \\\n    adminPass=\"12345\" \\\n    mysqlPass=\"travis\"\n#   for python 2 use = python\n#   for python 3 use = python3 or python3.6 for centos\nARG pythonVersion=python\nARG appBranch=master\nRUN sudo service mysql start \\\n && mysql --user=\"root\" --execute=\"ALTER USER 'root'@'localhost' IDENTIFIED BY 'travis';\" \\\n && git clone $benchRepo /tmp/.bench --depth 1 --branch $benchBranch \\\n && wget $easyinstallRepo \\\n && sed -i '/mariadb/d' /tmp/.bench/playbooks/site.yml \\\n && python install.py --without-bench-setup \\\n && rm -rf bench \\\n && git clone --branch $benchBranch --depth 1 --origin upstream $benchRepo $benchPath \\\n && sudo pip install -e $benchPath \\\n && bench init $benchFolderName --frappe-path $frappeRepo --frappe-branch $appBranch --python $pythonVersion \\\n && cd $benchFolderName \\\n && bench get-app erpnext $erpnextRepo --branch $appBranch \\\n && bench update --patch \\\n && rm -rf apps/frappe_io apps/foundation \\\n && sed -i '/foundation\\|frappe_io/d' sites/apps.txt \\\n && sudo rm -rf /tmp/* \\\n && sudo apt-get autoremove --purge -y \\\n && sudo apt-get clean \\\n && sudo service mysql start \\\n && bench new-site $siteName --mariadb-root-password $mysqlPass --admin-password $adminPass \\\n && bench --site $siteName install-app erpnext\n#   [work around] change back config for work around for  \"cmd\": \"chsh frappe -s $(which bash)\", \"stderr\": \"Password: chsh: PAM: Authentication failure\"\nRUN sudo sed -i 's/auth sufficient pam_shells.so/auth required pam_shells.so/' /etc/pam.d/chsh\n#   set user and workdir\nUSER $systemUser\nWORKDIR /home/$systemUser/$benchFolderName\n#   copy production config\nCOPY production_setup/conf/frappe-docker-conf /home/$systemUser/production_config\n#   run start mysql service and start bench when container start\nCOPY entrypoint.sh /usr/local/bin/\n#   fix for [docker Error response from daemon OCI runtime create failed starting container process caused \"permission denied\" unknown]\nRUN sudo chmod +x /home/$systemUser/production_config/entrypoint_prd.sh \\\n && sudo chmod +x /usr/local/bin/entrypoint.sh\n#   image entrypoint script\nCMD [\"/usr/local/bin/entrypoint.sh\"]\n#   expose port\nEXPOSE 8000-8005 9000-9005 3306-3307\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM debian:9.6-slim\n#  install package\nRUN apt-get update -y \\\n && apt-get install build-essential python-setuptools wget cron sudo locales git supervisor nginx gettext-base libssl1.0-dev -y \\\n && apt-get autoremove --purge \\\n && apt-get clean\n#  [work around] for  \"cmd\": \"chsh frappe -s $(which bash)\", \"stderr\": \"Password: chsh: PAM: Authentication failure\"\n#  caused by > bench/playbooks/create_user.yml > shell: \"chsh {{ frappe_user }} -s $(which bash)\"\nRUN sed -i 's/auth required pam_shells.so/auth sufficient pam_shells.so/' /etc/pam.d/chsh\n#  set locales\nRUN sed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen \\\n && locale-gen\nENV LC_ALL=\"en_US.UTF-8\" \\\n    LC_CTYPE=\"en_US.UTF-8\" \\\n    LANG=\"en_US.UTF-8\"\n#  manually install mariadb\nRUN apt-get update \\\n && apt-get install software-properties-common dirmngr -y \\\n && apt-key adv --no-tty --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xF1656F24C74CD1D8 \\\n && add-apt-repository 'deb [arch=amd64,i386,ppc64el] http://nyc2.mirrors.digitalocean.com/mariadb/repo/10.3/debian stretch main' \\\n && export DEBIAN_FRONTEND=noninteractive \\\n && apt-get update \\\n && apt-get install mariadb-server mariadb-client mariadb-common libmariadbclient18 python-mysqldb python3-mysqldb -y\n#  add users without sudo password\nENV systemUser=\"frappe\"\nRUN adduser --disabled-password --gecos \"\" $systemUser \\\n && usermod -aG sudo $systemUser \\\n && echo \"%sudo ALL=(ALL) NOPASSWD: ALL\" > /etc/sudoers.d/sudoers\n#  set user and workdir\nUSER $systemUser\nWORKDIR /home/$systemUser\nCOPY ./mariadb.cnf /etc/mysql/conf.d/mariadb.cnf\n#  install prerequisite for bench with easy install script\nENV easyinstallRepo=\"https://raw.githubusercontent.com/frappe/bench/master/playbooks/install.py\" \\\n    benchPath=\"bench-repo\" \\\n    benchBranch=\"master\" \\\n    benchFolderName=\"bench\" \\\n    benchRepo=\"https://github.com/frappe/bench\" \\\n    frappeRepo=\"https://github.com/frappe/frappe\" \\\n    erpnextRepo=\"https://github.com/frappe/erpnext\" \\\n    siteName=\"site1.local\" \\\n    adminPass=\"12345\" \\\n    mysqlPass=\"travis\"\n#  for python 2 use = python\n#  for python 3 use = python3 or python3.6 for centos\nARG pythonVersion=python\nARG appBranch=master\nRUN sudo service mysql start \\\n && mysql --user=\"root\" --execute=\"ALTER USER 'root'@'localhost' IDENTIFIED BY 'travis';\" \\\n && git clone $benchRepo /tmp/.bench --depth 1 --branch $benchBranch \\\n && wget $easyinstallRepo \\\n && sed -i '/mariadb/d' /tmp/.bench/playbooks/site.yml \\\n && python install.py --without-bench-setup \\\n && rm -rf bench \\\n && git clone --branch $benchBranch --depth 1 --origin upstream $benchRepo $benchPath \\\n && sudo pip install -e $benchPath \\\n && bench init $benchFolderName --frappe-path $frappeRepo --frappe-branch $appBranch --python $pythonVersion \\\n && cd $benchFolderName \\\n && bench get-app erpnext $erpnextRepo --branch $appBranch \\\n && bench update --patch \\\n && rm -rf apps/frappe_io apps/foundation \\\n && sed -i '/foundation\\|frappe_io/d' sites/apps.txt \\\n && sudo rm -rf /tmp/* \\\n && sudo apt-get autoremove --purge -y \\\n && sudo apt-get clean \\\n && sudo service mysql start \\\n && bench new-site $siteName --mariadb-root-password $mysqlPass --admin-password $adminPass \\\n && bench --site $siteName install-app erpnext\n#  [work around] change back config for work around for  \"cmd\": \"chsh frappe -s $(which bash)\", \"stderr\": \"Password: chsh: PAM: Authentication failure\"\nRUN sudo sed -i 's/auth sufficient pam_shells.so/auth required pam_shells.so/' /etc/pam.d/chsh\n#  set user and workdir\nUSER $systemUser\nWORKDIR /home/$systemUser/$benchFolderName\n#  copy production config\nCOPY production_setup/conf/frappe-docker-conf /home/$systemUser/production_config\n#  run start mysql service and start bench when container start\nCOPY entrypoint.sh /usr/local/bin/\n#  fix for [docker Error response from daemon OCI runtime create failed starting container process caused \"permission denied\" unknown]\nRUN sudo chmod +x /home/$systemUser/production_config/entrypoint_prd.sh \\\n && sudo chmod +x /usr/local/bin/entrypoint.sh\n#  image entrypoint script\nCMD [\"/usr/local/bin/entrypoint.sh\"]\n#  expose port\nEXPOSE 8000-8005 9000-9005 3306-3307\n","injectedSmells":[],"originalDockerfileHash":"6e62db2bf3e48c143ccc21c6f229aaf7","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM debian:9.6-slim\n#   install package\nRUN apt-get update -y \\\n && apt-get install build-essential python-setuptools wget cron sudo locales git supervisor nginx gettext-base libssl1.0-dev -y \\\n && apt-get autoremove --purge \\\n && apt-get clean\n#   [work around] for  \"cmd\": \"chsh frappe -s $(which bash)\", \"stderr\": \"Password: chsh: PAM: Authentication failure\"\n#   caused by > bench/playbooks/create_user.yml > shell: \"chsh {{ frappe_user }} -s $(which bash)\"\nRUN sed -i 's/auth required pam_shells.so/auth sufficient pam_shells.so/' /etc/pam.d/chsh\n#   set locales\nRUN sed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen \\\n && locale-gen\nENV LC_ALL=\"en_US.UTF-8\" \\\n    LC_CTYPE=\"en_US.UTF-8\" \\\n    LANG=\"en_US.UTF-8\"\n#   manually install mariadb\nRUN apt-get update \\\n && apt-get install software-properties-common dirmngr -y \\\n && apt-key adv --no-tty --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xF1656F24C74CD1D8 \\\n && add-apt-repository 'deb [arch=amd64,i386,ppc64el] http://nyc2.mirrors.digitalocean.com/mariadb/repo/10.3/debian stretch main' \\\n && export DEBIAN_FRONTEND=noninteractive \\\n && apt-get update \\\n && apt-get install mariadb-server mariadb-client mariadb-common libmariadbclient18 python-mysqldb python3-mysqldb -y\n#   add users without sudo password\nENV systemUser=\"frappe\"\nRUN adduser --disabled-password --gecos \"\" $systemUser \\\n && usermod -aG sudo $systemUser \\\n && echo \"%sudo ALL=(ALL) NOPASSWD: ALL\" > /etc/sudoers.d/sudoers\n#   set user and workdir\nUSER $systemUser\nWORKDIR /home/$systemUser\nCOPY ./mariadb.cnf /etc/mysql/conf.d/mariadb.cnf\n#   install prerequisite for bench with easy install script\nENV easyinstallRepo=\"https://raw.githubusercontent.com/frappe/bench/master/playbooks/install.py\" \\\n    benchPath=\"bench-repo\" \\\n    benchBranch=\"master\" \\\n    benchFolderName=\"bench\" \\\n    benchRepo=\"https://github.com/frappe/bench\" \\\n    frappeRepo=\"https://github.com/frappe/frappe\" \\\n    erpnextRepo=\"https://github.com/frappe/erpnext\" \\\n    siteName=\"site1.local\" \\\n    adminPass=\"12345\" \\\n    mysqlPass=\"travis\"\n#   for python 2 use = python\n#   for python 3 use = python3 or python3.6 for centos\nARG pythonVersion=python\nARG appBranch=master\nRUN sudo service mysql start \\\n && mysql --user=\"root\" --execute=\"ALTER USER 'root'@'localhost' IDENTIFIED BY 'travis';\" \\\n && git clone $benchRepo /tmp/.bench --depth 1 --branch $benchBranch \\\n && wget $easyinstallRepo \\\n && sed -i '/mariadb/d' /tmp/.bench/playbooks/site.yml \\\n && python install.py --without-bench-setup \\\n && rm -rf bench \\\n && git clone --branch $benchBranch --depth 1 --origin upstream $benchRepo $benchPath \\\n && sudo pip install -e $benchPath \\\n && bench init $benchFolderName --frappe-path $frappeRepo --frappe-branch $appBranch --python $pythonVersion \\\n && cd $benchFolderName \\\n && bench get-app erpnext $erpnextRepo --branch $appBranch \\\n && bench update --patch \\\n && rm -rf apps/frappe_io apps/foundation \\\n && sed -i '/foundation\\|frappe_io/d' sites/apps.txt \\\n && sudo rm -rf /tmp/* \\\n && sudo apt-get autoremove --purge -y \\\n && sudo apt-get clean \\\n && sudo service mysql start \\\n && bench new-site $siteName --mariadb-root-password $mysqlPass --admin-password $adminPass \\\n && bench --site $siteName install-app erpnext\n#   [work around] change back config for work around for  \"cmd\": \"chsh frappe -s $(which bash)\", \"stderr\": \"Password: chsh: PAM: Authentication failure\"\nRUN sudo sed -i 's/auth sufficient pam_shells.so/auth required pam_shells.so/' /etc/pam.d/chsh\n#   set user and workdir\nUSER $systemUser\nWORKDIR /home/$systemUser/$benchFolderName\n#   copy production config\nCOPY production_setup/conf/frappe-docker-conf /home/$systemUser/production_config\n#   run start mysql service and start bench when container start\nCOPY entrypoint.sh /usr/local/bin/\n#   fix for [docker Error response from daemon OCI runtime create failed starting container process caused \"permission denied\" unknown]\nRUN sudo chmod +x /home/$systemUser/production_config/entrypoint_prd.sh \\\n && sudo chmod +x /usr/local/bin/entrypoint.sh\n#   image entrypoint script\nCMD [\"/usr/local/bin/entrypoint.sh\"]\n#   expose port\nEXPOSE 8000-8005 9000-9005 3306-3307\n","originalDockerfileUglifiedHash":"8f8af468584a168afbf612bbbef39541","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/f085e32f66fff8ca07e5e2f777844f468c52cd23.dockerfile"}