{"seed":2540460218,"processedDockerfileHash":"2c733ded30b0e7e26d3a860885e53a1c","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"#\n#   NOTE: THIS DOCKERFILE IS GENERATED VIA \"update.sh\"\n#\n#   PLEASE DO NOT EDIT IT DIRECTLY.\n#\nFROM alpine:3.8\n#   add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\nRUN set -eux ; addgroup -S varnish ; for user in varnish vcache; do adduser -S -G varnish $user ; done\n#   dependencies required for building VMOD (Varnish modules)\nENV VMOD_BUILD_DEPS=\"autoconf  automake  libtool  make  pkgconf  python3\"\n#   persistent / runtime deps\nRUN apk add gcc=6.4.0-r9 libc-dev=0.7.1-r0 libgcc=6.4.0-r9 --no-cache --virtual .persistent-deps\nENV VARNISH_VERSION=\"6.2.0\"\nENV VARNISH_URL=\"https://varnish-cache.org/_downloads/varnish-6.2.0.tgz\"\nENV VARNISH_SHA256=\"c37af353aca25a83d22f9c5ce0ae800fe433e4d02e1457e02886a5849f988e53\"\nCOPY *.patch /varnish-alpine-patches/\nRUN set -eux ; fetchDeps=' ca-certificates wget ' ; buildDeps=\" $VMOD_BUILD_DEPS coreutils dpkg dpkg-dev libedit-dev libexecinfo-dev linux-headers ncurses-dev patch pcre-dev \" ; apk add $fetchDeps $buildDeps --no-cache --virtual .build-deps ; wget -O varnish.tar.gz \"$VARNISH_URL\" ; if [ -n \"$VARNISH_SHA256\" ] ; then echo \"$VARNISH_SHA256 *varnish.tar.gz\" | sha256sum -c - ; fi ; mkdir -p /usr/src/varnish ; tar -zxf varnish.tar.gz -C /usr/src/varnish --strip-components=1 ; rm varnish.tar.gz ; cd /usr/src/varnish ; for p in /varnish-alpine-patches/*.patch; do [ -f \"$p\" ] || continue ;patch -p1 -i \"$p\" ; done ; gnuArch=\"$( dpkg-architecture --query DEB_BUILD_GNU_TYPE ;)\" ; ./autogen.sh ; ./configure --build=\"$gnuArch\" --without-jemalloc --with-rst2man=$( command -v true ;) --with-sphinx-build=$( command -v true ;) ; make -j \"$( nproc ;)\" ; make install ; cd / ; rm -r /usr/src/varnish ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ] || [ -e /usr/local/lib/varnish/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add $runDeps --no-cache --virtual .varnish-rundeps ; apk del .build-deps ; varnishd -V\nWORKDIR /usr/local/var/varnish\nRUN chown -R varnish:varnish /usr/local/var/varnish\nVOLUME /usr/local/var/varnish\nCOPY docker-varnish-entrypoint /usr/local/bin/\nENTRYPOINT [\"docker-varnish-entrypoint\"]\nEXPOSE 80/tcp\nCMD [\"varnishd\", \"-F\", \"-f\", \"/usr/local/etc/varnish/default.vcl\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#\n#  NOTE: THIS DOCKERFILE IS GENERATED VIA \"update.sh\"\n#\n#  PLEASE DO NOT EDIT IT DIRECTLY.\n#\nFROM alpine:3.8\n#  add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\nRUN set -eux ; addgroup -S varnish ; for user in varnish vcache; do adduser -S -G varnish $user ; done\n#  dependencies required for building VMOD (Varnish modules)\nENV VMOD_BUILD_DEPS=\"autoconf  automake  libtool  make  pkgconf  python3\"\n#  persistent / runtime deps\nRUN apk add --no-cache --virtual .persistent-deps gcc libc-dev libgcc\nENV VARNISH_VERSION=\"6.2.0\"\nENV VARNISH_URL=\"https://varnish-cache.org/_downloads/varnish-6.2.0.tgz\"\nENV VARNISH_SHA256=\"c37af353aca25a83d22f9c5ce0ae800fe433e4d02e1457e02886a5849f988e53\"\nCOPY *.patch /varnish-alpine-patches/\nRUN set -eux ; fetchDeps=' ca-certificates wget ' ; buildDeps=\" $VMOD_BUILD_DEPS coreutils dpkg dpkg-dev libedit-dev libexecinfo-dev linux-headers ncurses-dev patch pcre-dev \" ; apk add --no-cache --virtual .build-deps $fetchDeps $buildDeps ; wget -O varnish.tar.gz \"$VARNISH_URL\" ; if [ -n \"$VARNISH_SHA256\" ] ; then echo \"$VARNISH_SHA256 *varnish.tar.gz\" | sha256sum -c - ; fi ; mkdir -p /usr/src/varnish ; tar -zxf varnish.tar.gz -C /usr/src/varnish --strip-components=1 ; rm varnish.tar.gz ; cd /usr/src/varnish ; for p in /varnish-alpine-patches/*.patch; do [ -f \"$p\" ] || continue ;patch -p1 -i \"$p\" ; done ; gnuArch=\"$( dpkg-architecture --query DEB_BUILD_GNU_TYPE ;)\" ; ./autogen.sh ; ./configure --build=\"$gnuArch\" --without-jemalloc --with-rst2man=$( command -v true ;) --with-sphinx-build=$( command -v true ;) ; make -j \"$( nproc ;)\" ; make install ; cd / ; rm -r /usr/src/varnish ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ] || [ -e /usr/local/lib/varnish/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add --no-cache --virtual .varnish-rundeps $runDeps ; apk del .build-deps ; varnishd -V\nWORKDIR /usr/local/var/varnish\nRUN chown -R varnish:varnish /usr/local/var/varnish\nVOLUME /usr/local/var/varnish\nCOPY docker-varnish-entrypoint /usr/local/bin/\nENTRYPOINT [\"docker-varnish-entrypoint\"]\nEXPOSE 80/tcp\nCMD [\"varnishd\", \"-F\", \"-f\", \"/usr/local/etc/varnish/default.vcl\"]\n","injectedSmells":[],"originalDockerfileHash":"f1432fa8061181af11011010976c58ba","successfullyInjectedSmells":[],"originalDockerfileUglified":"#\n#   NOTE: THIS DOCKERFILE IS GENERATED VIA \"update.sh\"\n#\n#   PLEASE DO NOT EDIT IT DIRECTLY.\n#\nFROM alpine:3.8\n#   add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\nRUN set -eux ; addgroup -S varnish ; for user in varnish vcache; do adduser -S -G varnish $user ; done\n#   dependencies required for building VMOD (Varnish modules)\nENV VMOD_BUILD_DEPS=\"autoconf  automake  libtool  make  pkgconf  python3\"\n#   persistent / runtime deps\nRUN apk add --no-cache --virtual .persistent-deps gcc libc-dev libgcc\nENV VARNISH_VERSION=\"6.2.0\"\nENV VARNISH_URL=\"https://varnish-cache.org/_downloads/varnish-6.2.0.tgz\"\nENV VARNISH_SHA256=\"c37af353aca25a83d22f9c5ce0ae800fe433e4d02e1457e02886a5849f988e53\"\nCOPY *.patch /varnish-alpine-patches/\nRUN set -eux ; fetchDeps=' ca-certificates wget ' ; buildDeps=\" $VMOD_BUILD_DEPS coreutils dpkg dpkg-dev libedit-dev libexecinfo-dev linux-headers ncurses-dev patch pcre-dev \" ; apk add --no-cache --virtual .build-deps $fetchDeps $buildDeps ; wget -O varnish.tar.gz \"$VARNISH_URL\" ; if [ -n \"$VARNISH_SHA256\" ] ; then echo \"$VARNISH_SHA256 *varnish.tar.gz\" | sha256sum -c - ; fi ; mkdir -p /usr/src/varnish ; tar -zxf varnish.tar.gz -C /usr/src/varnish --strip-components=1 ; rm varnish.tar.gz ; cd /usr/src/varnish ; for p in /varnish-alpine-patches/*.patch; do [ -f \"$p\" ] || continue ;patch -p1 -i \"$p\" ; done ; gnuArch=\"$( dpkg-architecture --query DEB_BUILD_GNU_TYPE ;)\" ; ./autogen.sh ; ./configure --build=\"$gnuArch\" --without-jemalloc --with-rst2man=$( command -v true ;) --with-sphinx-build=$( command -v true ;) ; make -j \"$( nproc ;)\" ; make install ; cd / ; rm -r /usr/src/varnish ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ] || [ -e /usr/local/lib/varnish/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add --no-cache --virtual .varnish-rundeps $runDeps ; apk del .build-deps ; varnishd -V\nWORKDIR /usr/local/var/varnish\nRUN chown -R varnish:varnish /usr/local/var/varnish\nVOLUME /usr/local/var/varnish\nCOPY docker-varnish-entrypoint /usr/local/bin/\nENTRYPOINT [\"docker-varnish-entrypoint\"]\nEXPOSE 80/tcp\nCMD [\"varnishd\", \"-F\", \"-f\", \"/usr/local/etc/varnish/default.vcl\"]\n","originalDockerfileUglifiedHash":"8963057e8040c17d4d3af63b42be6bd4","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/add98eccbe4e0c9058319dd4ed9b7e2d5637c119.dockerfile"}