{"seed":504796928,"processedDockerfileHash":"4df061e5c54ada2c511429994707e82f","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   Dockerfile for XRDP on Debian 8 desktop.\n#\n#   Copyright (C) 2017 Hiroo MATSUMOTO <hiroom2.mail@gmail.com>\n#\nFROM debian:8\nMAINTAINER Hiroo MATSUMOTO <hiroom2.mail@gmail.com>\nLABEL Description=\"XRDP on Debian 8 desktop\" \\\n      Version=\"1.0\"\nEXPOSE 3389/tcp\nARG user=${user:-doxrdp}\nARG password=${password:-doxrdp}\nARG desktop=${desktop:-gnome}\nARG xrdp=${xrdp:-0.9.1-4~bpo8+1}\nARG model=${model:-pc105}\nARG layout=${layout:-us}\nARG variant=${variant:-\"English (US)\"}\nARG cpu=${cpu:-amd64}\n#   Check desktop argument at an early stage.\nRUN case \"${desktop}\" in (gnome) true ;;(xfce) true ;;(mate) true ;;(lxde) true ;;(kde) true ;;(*) echo \"Not supported desktop: ${desktop}\" 1>&2; false ;; esac\n#   Update Debian.\nRUN : \\\n && apt-get upgrade -y\n#   Set locale.\nRUN (apt-get update ;apt-get install --no-install-recommends locales -y )\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US:en\"\nRUN sed -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/g' -i /etc/locale.gen \\\n && locale-gen en_US en_US.UTF-8 \\\n && locale > /etc/default/locale\n#   Install expect.\nRUN (apt-get update ;apt-get install --no-install-recommends expect -y )\n#   Install debconf at an early stage for debconf-set-selections.\nRUN (apt-get update ;apt-get install --no-install-recommends debconf -y )\n#   Set keyboard. Debian requires keyboard-configuration/variant\n#   compared to Ubuntu.\nRUN echo \"keyboard-configuration keyboard-configuration/modelcode string ${model}\\nkeyboard-configuration keyboard-configuration/layoutcode string ${layout}\\nkeyboard-configuration keyboard-configuration/variant string ${variant}\\n\" | debconf-set-selections\n#   Create user.\nRUN (apt-get update ;apt-get install --no-install-recommends sudo bash -y ) \\\n && sed -e 's/%sudo\\(.*\\)ALL$/%sudo\\1NOPASSWD:ALL/g' -i /etc/sudoers \\\n && useradd -m ${user} -s /bin/bash \\\n && gpasswd -a ${user} sudo \\\n && printf \"set timeout -1\\nspawn passwd ${user}\\nexpect \\\"Enter new UNIX password:\\\" { send \\\"${password}\\n\\\" }\\nexpect \\\"Retype new UNIX password:\\\" { send \\\"${password}\\n\\\" }\\nexpect eof\\n\" | expect\n#   Install package for FLTK, TigerVNC and XRDP.\nRUN (apt-get update ;apt-get install --no-install-recommends wget dpkg-dev git patch -y )\n#   Install FLTK for TigerVNC.\nRUN mkdir fltk.build \\\n && cd fltk.build \\\n && URL=http://archive.ubuntu.com/ubuntu/pool/universe/f/ \\\n && wget -q ${URL}/fltk1.3/fltk1.3_1.3.3.orig.tar.gz \\\n && wget -q ${URL}/fltk1.3/fltk1.3_1.3.3-8.dsc \\\n && wget -q ${URL}/fltk1.3/fltk1.3_1.3.3-8.debian.tar.xz \\\n && tar zxvf fltk1.3_1.3.3.orig.tar.gz \\\n && cd fltk-1.3.3/ \\\n && tar xvf ../fltk1.3_1.3.3-8.debian.tar.xz \\\n && pkgs=\"$( dpkg-checkbuilddeps 2>&1 | sed -e 's/.*build dependencies://g' -e 's/|/ /g' -e 's/libglu-dev//g' -e 's/libgl-dev//g' -e 's/libz-dev//g' -e 's/([^)]*)//g' ;)\" \\\n && (apt-get update ;apt-get install --no-install-recommends 'apt::install-recommends=true' ${pkgs} -y -o ) \\\n && dpkg-buildpackage -us -uc \\\n && apt-get remove -y ${pkgs} \\\n && cd .. \\\n && dpkg -i *.deb || ((apt-get update ;apt-get install --no-install-recommends -f -y ) ;dpkg -i *.deb ) \\\n && cd .. \\\n && rm -rf fltk.build\n#   Install TigerVNC from upstream.\nRUN mkdir tigervnc.build \\\n && cd tigervnc.build \\\n && git clone https://github.com/TigerVNC/tigervnc \\\n && cd tigervnc \\\n && git checkout ff872614b507d0aa8bfbd09ef41550390cfe658a -b branch \\\n && ln -s contrib/packages/deb/ubuntu-xenial/debian \\\n && chmod a+x debian/rules \\\n && sed -e 's/libjpeg-turbo8/libjpeg62-turbo/g' -e 's/libgnutls30/libgnutls-deb0-28/g' -e 's/libgnutls-dev/libgnutls28-dev/g' -i debian/control \\\n && pkgs=\"$( dpkg-checkbuilddeps 2>&1 | sed -e 's/.*build dependencies://g' -e 's/([^)]*)//g' ;)\" \\\n && (apt-get update ;apt-get install --no-install-recommends 'apt::install-recommends=true' ${pkgs} -y -o ) \\\n && rm debian/xorg-source-patches/xserver118-patch.patch \\\n && touch debian/xorg-source-patches/xserver118-patch.patch \\\n && fakeroot debian/rules binary \\\n && apt-get remove -y ${pkgs} \\\n && cd .. \\\n && dpkg -i *.deb || ((apt-get update ;apt-get install --no-install-recommends -f -y ) ;dpkg -i *.deb ) \\\n && cd .. \\\n && rm -rf tigervnc.build\n#   Install latest XRDP. XRDP 0.9.1-4~bpo8+1 can be installed without\n#   updating other package while XRDP 0.9.1-7 cannot. And apply patch to\n#   latest XRDP for changing Xvnc session to be default because Xorg\n#   session's cursor has black background.\nRUN mkdir xrdp \\\n && cd xrdp \\\n && URL=http://ftp.debian.org/debian/pool/main/x/xrdp \\\n && PKG=\"xrdp_${xrdp}_${cpu}.deb xorgxrdp_${xrdp}_${cpu}.deb \" \\\n && for pkg in ${PKG}; do wget -q ${URL}/${pkg} \\\n && (dpkg -i \"${pkg}\" || (apt-get update ;apt-get install --no-install-recommends -f -y ) ) ; done \\\n && cd .. \\\n && rm -rf xrdp \\\n && cd /etc/xrdp \\\n && echo \"--- xrdp.ini.org 2017-02-23 07:14:16.614833723 +0000\\n+++ xrdp.ini 2017-02-23 07:15:10.489078284 +0000\\n@@ -147,15 +147,6 @@ tcutils=true\\n ; Session types\\n ;\\n \\n-[Xorg]\\n-name=Xorg\\n-lib=libxup.so\\n-username=ask\\n-password=ask\\n-ip=127.0.0.1\\n-port=-1\\n-code=20\\n-\\n [Xvnc]\\n name=Xvnc\\n lib=libvnc.so\\n@@ -166,6 +157,15 @@ port=-1\\n \\n+[Xorg]\\n+name=Xorg\\n+lib=libxup.so\\n+username=ask\\n+password=ask\\n+ip=127.0.0.1\\n+port=-1\\n+code=20\\n+\\n [console]\\n name=console\\n lib=libvnc.so\\n\" | patch -p0\n#   Install package for fltk, TigerVNC and XRDP.\n#   Remove package for building fltk and TigerVNC.\nRUN apt-get remove -y wget dpkg-dev git patch\n#   Disable resolvconf postinst to /etc/resolv.conf which cannot be\n#   updated in container.\n#   https://github.com/docker/docker/issues/1297#issuecomment-115458690\nRUN echo \"resolvconf resolvconf/linkify-resolvconf boolean false\" | debconf-set-selections\n#   Install desktop.\nRUN case \"${desktop}\" in (gnome) (apt-get update ;apt-get install --no-install-recommends task-gnome-desktop -y ) \\\n && service dbus start \\\n && su - ${user} -c \"dbus-launch gsettings set org.gnome.desktop.lockdown disable-lock-screen true\" \\\n && su - ${user} -c \"dbus-launch gsettings set org.gnome.desktop.session idle-delay 0\" \\\n && service dbus stop ;;(xfce) (apt-get update ;apt-get install --no-install-recommends task-xfce-desktop -y ) \\\n && echo \"mode: off\\n\" > /home/${user}/.xscreensaver \\\n && chown ${user}:${user} /home/${user}/.xscreensaver ;;(mate) (apt-get update ;apt-get install --no-install-recommends task-mate-desktop -y ) \\\n && service dbus start \\\n && su - ${user} -c \"dbus-launch gsettings set org.mate.screensaver idle-activation-enabled false\" \\\n && su - ${user} -c \"dbus-launch gsettings set org.mate.screensaver lock-enabled false\" \\\n && service dbus stop ;;(lxde) echo \"Package: wicd-daemon\\nPin: version *\\nPin-Priority: -1\\n\" > /etc/apt/preferences.d/wicd-daemon \\\n && apt-mark hold wicd \\\n && (apt-get update ;apt-get install --no-install-recommends task-lxde-desktop -y ) \\\n && echo \"mode: off\\n\" > /home/${user}/.xscreensaver \\\n && chown ${user}:${user} /home/${user}/.xscreensaver ;;(kde) (apt-get update ;apt-get install --no-install-recommends task-kde-desktop -y ) ;; esac\n#   Remove expect.\nRUN apt-get remove -y expect\n#   Clean cache\nRUN apt-get autoremove -y \\\n && apt-get clean -y all\n#   Use rsyslog instead of journald.\nCMD service rsyslog start \\\n && service dbus start \\\n && service xrdp start \\\n && tail -f /var/log/syslog\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  Dockerfile for XRDP on Debian 8 desktop.\n#\n#  Copyright (C) 2017 Hiroo MATSUMOTO <hiroom2.mail@gmail.com>\n#\nFROM debian:8\nMAINTAINER Hiroo MATSUMOTO <hiroom2.mail@gmail.com>\nLABEL Description=\"XRDP on Debian 8 desktop\" \\\n      Version=\"1.0\"\nEXPOSE 3389/tcp\nARG user=${user:-doxrdp}\nARG password=${password:-doxrdp}\nARG desktop=${desktop:-gnome}\nARG xrdp=${xrdp:-0.9.1-4~bpo8+1}\nARG model=${model:-pc105}\nARG layout=${layout:-us}\nARG variant=${variant:-\"English (US)\"}\nARG cpu=${cpu:-amd64}\n#  Check desktop argument at an early stage.\nRUN case \"${desktop}\" in (gnome) true ;;(xfce) true ;;(mate) true ;;(lxde) true ;;(kde) true ;;(*) echo \"Not supported desktop: ${desktop}\" 1>&2; false ;; esac\n#  Update Debian.\nRUN apt-get update -y \\\n && apt-get upgrade -y\n#  Set locale.\nRUN apt-get install locales -y\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US:en\"\nRUN sed -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/g' -i /etc/locale.gen \\\n && locale-gen en_US en_US.UTF-8 \\\n && locale > /etc/default/locale\n#  Install expect.\nRUN apt-get install expect -y\n#  Install debconf at an early stage for debconf-set-selections.\nRUN apt-get install debconf -y\n#  Set keyboard. Debian requires keyboard-configuration/variant\n#  compared to Ubuntu.\nRUN echo \"keyboard-configuration keyboard-configuration/modelcode string ${model}\\nkeyboard-configuration keyboard-configuration/layoutcode string ${layout}\\nkeyboard-configuration keyboard-configuration/variant string ${variant}\\n\" | debconf-set-selections\n#  Create user.\nRUN apt-get install sudo bash -y \\\n && sed -e 's/%sudo\\(.*\\)ALL$/%sudo\\1NOPASSWD:ALL/g' -i /etc/sudoers \\\n && useradd -m ${user} -s /bin/bash \\\n && gpasswd -a ${user} sudo \\\n && printf \"set timeout -1\\nspawn passwd ${user}\\nexpect \\\"Enter new UNIX password:\\\" { send \\\"${password}\\\\n\\\" }\\nexpect \\\"Retype new UNIX password:\\\" { send \\\"${password}\\\\n\\\" }\\nexpect eof\\n\" | expect\n#  Install package for FLTK, TigerVNC and XRDP.\nRUN apt-get install wget dpkg-dev git patch -y\n#  Install FLTK for TigerVNC.\nRUN mkdir fltk.build \\\n && cd fltk.build \\\n && URL=http://archive.ubuntu.com/ubuntu/pool/universe/f/ \\\n && wget -q ${URL}/fltk1.3/fltk1.3_1.3.3.orig.tar.gz \\\n && wget -q ${URL}/fltk1.3/fltk1.3_1.3.3-8.dsc \\\n && wget -q ${URL}/fltk1.3/fltk1.3_1.3.3-8.debian.tar.xz \\\n && tar zxvf fltk1.3_1.3.3.orig.tar.gz \\\n && cd fltk-1.3.3/ \\\n && tar xvf ../fltk1.3_1.3.3-8.debian.tar.xz \\\n && pkgs=\"$( dpkg-checkbuilddeps 2>&1 | sed -e 's/.*build dependencies://g' -e 's/|/ /g' -e 's/libglu-dev//g' -e 's/libgl-dev//g' -e 's/libz-dev//g' -e 's/([^)]*)//g' ;)\" \\\n && apt-get install 'apt::install-recommends=true' ${pkgs} -y -o \\\n && dpkg-buildpackage -us -uc \\\n && apt-get remove -y ${pkgs} \\\n && cd .. \\\n && dpkg -i *.deb || (apt-get install -f -y ;dpkg -i *.deb ) \\\n && cd .. \\\n && rm -rf fltk.build\n#  Install TigerVNC from upstream.\nRUN mkdir tigervnc.build \\\n && cd tigervnc.build \\\n && git clone https://github.com/TigerVNC/tigervnc \\\n && cd tigervnc \\\n && git checkout ff872614b507d0aa8bfbd09ef41550390cfe658a -b branch \\\n && ln -s contrib/packages/deb/ubuntu-xenial/debian \\\n && chmod a+x debian/rules \\\n && sed -e 's/libjpeg-turbo8/libjpeg62-turbo/g' -e 's/libgnutls30/libgnutls-deb0-28/g' -e 's/libgnutls-dev/libgnutls28-dev/g' -i debian/control \\\n && pkgs=\"$( dpkg-checkbuilddeps 2>&1 | sed -e 's/.*build dependencies://g' -e 's/([^)]*)//g' ;)\" \\\n && apt-get install 'apt::install-recommends=true' ${pkgs} -y -o \\\n && rm debian/xorg-source-patches/xserver118-patch.patch \\\n && touch debian/xorg-source-patches/xserver118-patch.patch \\\n && fakeroot debian/rules binary \\\n && apt-get remove -y ${pkgs} \\\n && cd .. \\\n && dpkg -i *.deb || (apt-get install -f -y ;dpkg -i *.deb ) \\\n && cd .. \\\n && rm -rf tigervnc.build\n#  Install latest XRDP. XRDP 0.9.1-4~bpo8+1 can be installed without\n#  updating other package while XRDP 0.9.1-7 cannot. And apply patch to\n#  latest XRDP for changing Xvnc session to be default because Xorg\n#  session's cursor has black background.\nRUN mkdir xrdp \\\n && cd xrdp \\\n && URL=http://ftp.debian.org/debian/pool/main/x/xrdp \\\n && PKG=\"xrdp_${xrdp}_${cpu}.deb xorgxrdp_${xrdp}_${cpu}.deb \" \\\n && for pkg in ${PKG}; do wget -q ${URL}/${pkg} \\\n && (dpkg -i \"${pkg}\" || apt-get install -f -y ) ; done \\\n && cd .. \\\n && rm -rf xrdp \\\n && cd /etc/xrdp \\\n && echo \"--- xrdp.ini.org 2017-02-23 07:14:16.614833723 +0000\\n+++ xrdp.ini 2017-02-23 07:15:10.489078284 +0000\\n@@ -147,15 +147,6 @@ tcutils=true\\n ; Session types\\n ;\\n \\n-[Xorg]\\n-name=Xorg\\n-lib=libxup.so\\n-username=ask\\n-password=ask\\n-ip=127.0.0.1\\n-port=-1\\n-code=20\\n-\\n [Xvnc]\\n name=Xvnc\\n lib=libvnc.so\\n@@ -166,6 +157,15 @@ port=-1\\n \\n+[Xorg]\\n+name=Xorg\\n+lib=libxup.so\\n+username=ask\\n+password=ask\\n+ip=127.0.0.1\\n+port=-1\\n+code=20\\n+\\n [console]\\n name=console\\n lib=libvnc.so\\n\" | patch -p0\n#  Install package for fltk, TigerVNC and XRDP.\n#  Remove package for building fltk and TigerVNC.\nRUN apt-get remove -y wget dpkg-dev git patch\n#  Disable resolvconf postinst to /etc/resolv.conf which cannot be\n#  updated in container.\n#  https://github.com/docker/docker/issues/1297#issuecomment-115458690\nRUN echo \"resolvconf resolvconf/linkify-resolvconf boolean false\" | debconf-set-selections\n#  Install desktop.\nRUN case \"${desktop}\" in (gnome) apt-get install task-gnome-desktop -y \\\n && service dbus start \\\n && su - ${user} -c \"dbus-launch gsettings set org.gnome.desktop.lockdown disable-lock-screen true\" \\\n && su - ${user} -c \"dbus-launch gsettings set org.gnome.desktop.session idle-delay 0\" \\\n && service dbus stop ;;(xfce) apt-get install task-xfce-desktop -y \\\n && echo \"mode: off\\n\" > /home/${user}/.xscreensaver \\\n && chown ${user}:${user} /home/${user}/.xscreensaver ;;(mate) apt-get install task-mate-desktop -y \\\n && service dbus start \\\n && su - ${user} -c \"dbus-launch gsettings set org.mate.screensaver idle-activation-enabled false\" \\\n && su - ${user} -c \"dbus-launch gsettings set org.mate.screensaver lock-enabled false\" \\\n && service dbus stop ;;(lxde) echo \"Package: wicd-daemon\\nPin: version *\\nPin-Priority: -1\\n\" > /etc/apt/preferences.d/wicd-daemon \\\n && apt-mark hold wicd \\\n && apt-get install task-lxde-desktop -y \\\n && echo \"mode: off\\n\" > /home/${user}/.xscreensaver \\\n && chown ${user}:${user} /home/${user}/.xscreensaver ;;(kde) apt-get install task-kde-desktop -y ;; esac\n#  Remove expect.\nRUN apt-get remove -y expect\n#  Clean cache\nRUN apt-get autoremove -y \\\n && apt-get clean -y all\n#  Use rsyslog instead of journald.\nCMD service rsyslog start \\\n && service dbus start \\\n && service xrdp start \\\n && tail -f /var/log/syslog\n","injectedSmells":[],"originalDockerfileHash":"2e2393815dec3e742583f9ae1e169700","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   Dockerfile for XRDP on Debian 8 desktop.\n#\n#   Copyright (C) 2017 Hiroo MATSUMOTO <hiroom2.mail@gmail.com>\n#\nFROM debian:8\nMAINTAINER Hiroo MATSUMOTO <hiroom2.mail@gmail.com>\nLABEL Description=\"XRDP on Debian 8 desktop\" \\\n      Version=\"1.0\"\nEXPOSE 3389/tcp\nARG user=${user:-doxrdp}\nARG password=${password:-doxrdp}\nARG desktop=${desktop:-gnome}\nARG xrdp=${xrdp:-0.9.1-4~bpo8+1}\nARG model=${model:-pc105}\nARG layout=${layout:-us}\nARG variant=${variant:-\"English (US)\"}\nARG cpu=${cpu:-amd64}\n#   Check desktop argument at an early stage.\nRUN case \"${desktop}\" in (gnome) true ;;(xfce) true ;;(mate) true ;;(lxde) true ;;(kde) true ;;(*) echo \"Not supported desktop: ${desktop}\" 1>&2; false ;; esac\n#   Update Debian.\nRUN apt-get update -y \\\n && apt-get upgrade -y\n#   Set locale.\nRUN apt-get install locales -y\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US:en\"\nRUN sed -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/g' -i /etc/locale.gen \\\n && locale-gen en_US en_US.UTF-8 \\\n && locale > /etc/default/locale\n#   Install expect.\nRUN apt-get install expect -y\n#   Install debconf at an early stage for debconf-set-selections.\nRUN apt-get install debconf -y\n#   Set keyboard. Debian requires keyboard-configuration/variant\n#   compared to Ubuntu.\nRUN echo \"keyboard-configuration keyboard-configuration/modelcode string ${model}\\nkeyboard-configuration keyboard-configuration/layoutcode string ${layout}\\nkeyboard-configuration keyboard-configuration/variant string ${variant}\\n\" | debconf-set-selections\n#   Create user.\nRUN apt-get install sudo bash -y \\\n && sed -e 's/%sudo\\(.*\\)ALL$/%sudo\\1NOPASSWD:ALL/g' -i /etc/sudoers \\\n && useradd -m ${user} -s /bin/bash \\\n && gpasswd -a ${user} sudo \\\n && printf \"set timeout -1\\nspawn passwd ${user}\\nexpect \\\"Enter new UNIX password:\\\" { send \\\"${password}\\n\\\" }\\nexpect \\\"Retype new UNIX password:\\\" { send \\\"${password}\\n\\\" }\\nexpect eof\\n\" | expect\n#   Install package for FLTK, TigerVNC and XRDP.\nRUN apt-get install wget dpkg-dev git patch -y\n#   Install FLTK for TigerVNC.\nRUN mkdir fltk.build \\\n && cd fltk.build \\\n && URL=http://archive.ubuntu.com/ubuntu/pool/universe/f/ \\\n && wget -q ${URL}/fltk1.3/fltk1.3_1.3.3.orig.tar.gz \\\n && wget -q ${URL}/fltk1.3/fltk1.3_1.3.3-8.dsc \\\n && wget -q ${URL}/fltk1.3/fltk1.3_1.3.3-8.debian.tar.xz \\\n && tar zxvf fltk1.3_1.3.3.orig.tar.gz \\\n && cd fltk-1.3.3/ \\\n && tar xvf ../fltk1.3_1.3.3-8.debian.tar.xz \\\n && pkgs=\"$( dpkg-checkbuilddeps 2>&1 | sed -e 's/.*build dependencies://g' -e 's/|/ /g' -e 's/libglu-dev//g' -e 's/libgl-dev//g' -e 's/libz-dev//g' -e 's/([^)]*)//g' ;)\" \\\n && apt-get install 'apt::install-recommends=true' ${pkgs} -y -o \\\n && dpkg-buildpackage -us -uc \\\n && apt-get remove -y ${pkgs} \\\n && cd .. \\\n && dpkg -i *.deb || (apt-get install -f -y ;dpkg -i *.deb ) \\\n && cd .. \\\n && rm -rf fltk.build\n#   Install TigerVNC from upstream.\nRUN mkdir tigervnc.build \\\n && cd tigervnc.build \\\n && git clone https://github.com/TigerVNC/tigervnc \\\n && cd tigervnc \\\n && git checkout ff872614b507d0aa8bfbd09ef41550390cfe658a -b branch \\\n && ln -s contrib/packages/deb/ubuntu-xenial/debian \\\n && chmod a+x debian/rules \\\n && sed -e 's/libjpeg-turbo8/libjpeg62-turbo/g' -e 's/libgnutls30/libgnutls-deb0-28/g' -e 's/libgnutls-dev/libgnutls28-dev/g' -i debian/control \\\n && pkgs=\"$( dpkg-checkbuilddeps 2>&1 | sed -e 's/.*build dependencies://g' -e 's/([^)]*)//g' ;)\" \\\n && apt-get install 'apt::install-recommends=true' ${pkgs} -y -o \\\n && rm debian/xorg-source-patches/xserver118-patch.patch \\\n && touch debian/xorg-source-patches/xserver118-patch.patch \\\n && fakeroot debian/rules binary \\\n && apt-get remove -y ${pkgs} \\\n && cd .. \\\n && dpkg -i *.deb || (apt-get install -f -y ;dpkg -i *.deb ) \\\n && cd .. \\\n && rm -rf tigervnc.build\n#   Install latest XRDP. XRDP 0.9.1-4~bpo8+1 can be installed without\n#   updating other package while XRDP 0.9.1-7 cannot. And apply patch to\n#   latest XRDP for changing Xvnc session to be default because Xorg\n#   session's cursor has black background.\nRUN mkdir xrdp \\\n && cd xrdp \\\n && URL=http://ftp.debian.org/debian/pool/main/x/xrdp \\\n && PKG=\"xrdp_${xrdp}_${cpu}.deb xorgxrdp_${xrdp}_${cpu}.deb \" \\\n && for pkg in ${PKG}; do wget -q ${URL}/${pkg} \\\n && (dpkg -i \"${pkg}\" || apt-get install -f -y ) ; done \\\n && cd .. \\\n && rm -rf xrdp \\\n && cd /etc/xrdp \\\n && echo \"--- xrdp.ini.org 2017-02-23 07:14:16.614833723 +0000\\n+++ xrdp.ini 2017-02-23 07:15:10.489078284 +0000\\n@@ -147,15 +147,6 @@ tcutils=true\\n ; Session types\\n ;\\n \\n-[Xorg]\\n-name=Xorg\\n-lib=libxup.so\\n-username=ask\\n-password=ask\\n-ip=127.0.0.1\\n-port=-1\\n-code=20\\n-\\n [Xvnc]\\n name=Xvnc\\n lib=libvnc.so\\n@@ -166,6 +157,15 @@ port=-1\\n \\n+[Xorg]\\n+name=Xorg\\n+lib=libxup.so\\n+username=ask\\n+password=ask\\n+ip=127.0.0.1\\n+port=-1\\n+code=20\\n+\\n [console]\\n name=console\\n lib=libvnc.so\\n\" | patch -p0\n#   Install package for fltk, TigerVNC and XRDP.\n#   Remove package for building fltk and TigerVNC.\nRUN apt-get remove -y wget dpkg-dev git patch\n#   Disable resolvconf postinst to /etc/resolv.conf which cannot be\n#   updated in container.\n#   https://github.com/docker/docker/issues/1297#issuecomment-115458690\nRUN echo \"resolvconf resolvconf/linkify-resolvconf boolean false\" | debconf-set-selections\n#   Install desktop.\nRUN case \"${desktop}\" in (gnome) apt-get install task-gnome-desktop -y \\\n && service dbus start \\\n && su - ${user} -c \"dbus-launch gsettings set org.gnome.desktop.lockdown disable-lock-screen true\" \\\n && su - ${user} -c \"dbus-launch gsettings set org.gnome.desktop.session idle-delay 0\" \\\n && service dbus stop ;;(xfce) apt-get install task-xfce-desktop -y \\\n && echo \"mode: off\\n\" > /home/${user}/.xscreensaver \\\n && chown ${user}:${user} /home/${user}/.xscreensaver ;;(mate) apt-get install task-mate-desktop -y \\\n && service dbus start \\\n && su - ${user} -c \"dbus-launch gsettings set org.mate.screensaver idle-activation-enabled false\" \\\n && su - ${user} -c \"dbus-launch gsettings set org.mate.screensaver lock-enabled false\" \\\n && service dbus stop ;;(lxde) echo \"Package: wicd-daemon\\nPin: version *\\nPin-Priority: -1\\n\" > /etc/apt/preferences.d/wicd-daemon \\\n && apt-mark hold wicd \\\n && apt-get install task-lxde-desktop -y \\\n && echo \"mode: off\\n\" > /home/${user}/.xscreensaver \\\n && chown ${user}:${user} /home/${user}/.xscreensaver ;;(kde) apt-get install task-kde-desktop -y ;; esac\n#   Remove expect.\nRUN apt-get remove -y expect\n#   Clean cache\nRUN apt-get autoremove -y \\\n && apt-get clean -y all\n#   Use rsyslog instead of journald.\nCMD service rsyslog start \\\n && service dbus start \\\n && service xrdp start \\\n && tail -f /var/log/syslog\n","originalDockerfileUglifiedHash":"6fb6aedc13134280e4685c0e11cfa9fa","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/570974502d44e4dd7595f1763fef6636371bfcb4.dockerfile"}