{"seed":1392092315,"processedDockerfileHash":"bebaed5526f56ae2e74118a52d904e03","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck"],"processedDockerfile":"FROM php:7.2-fpm-alpine\nRUN apk update\nRUN apk add git=2.38.4-r1 icu=72.1-r1 zlib=1.2.13-r0 --no-cache\nENV APCU_VERSION=\"5.1.8\"\nRUN set -xe \\\n && apk add icu-dev=72.1-r1 postgresql-dev zlib-dev=1.2.13-r0 --no-cache \\\n && apk add libpng=1.6.38-r0 libjpeg-turbo=2.1.4-r0 freetype=2.12.1-r0 libpng-dev=1.6.38-r0 libjpeg-turbo-dev=2.1.4-r0 freetype-dev=2.12.1-r0 --no-cache \\\n && apk add unzip=6.0-r13 chromium=112.0.5615.49-r0 chromium-chromedriver=112.0.5615.49-r0 --no-cache \\\n && apk add jpegoptim=1.5.3-r0 optipng=0.7.7-r1 pngquant=2.17.0-r2 --no-cache \\\n && apk add $PHPIZE_DEPS --no-cache --virtual .build-deps \\\n && docker-php-ext-configure pdo_pgsql \\\n && docker-php-ext-configure gd --with-gd --with-freetype-dir=/usr/include/ --with-png-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n && docker-php-ext-install intl pdo_pgsql zip bcmath gd \\\n && pecl install apcu-${APCU_VERSION} \\\n && docker-php-ext-enable --ini-name 20-apcu.ini apcu \\\n && docker-php-ext-enable --ini-name 05-opcache.ini opcache \\\n && apk del .build-deps\nCOPY docker/php/php.ini /usr/local/etc/php/php.ini\nCOPY docker/php/install-composer.sh /usr/local/bin/docker-app-install-composer\nRUN chmod +x /usr/local/bin/docker-app-install-composer\nRUN set -xe \\\n && apk add openssl=3.0.8-r3 --no-cache --virtual .fetch-deps \\\n && sh /usr/local/bin/docker-app-install-composer \\\n && mv composer.phar /usr/local/bin/composer \\\n && apk del .fetch-deps\n#   https://getcomposer.org/doc/03-cli.md#composer-allow-superuser\nENV COMPOSER_ALLOW_SUPERUSER=\"1\"\nRUN composer global require \"hirak/prestissimo:^0.3\" --prefer-dist --no-progress --no-suggest --optimize-autoloader --classmap-authoritative \\\n && composer clear-cache\nENV COMPOSER_ALLOW_SUPERUSER=\"0\"\nENV PANTHER_CHROME_BINARY=\"/usr/bin/chromium-browser\"\nENV PANTHER_CHROME_DRIVER_BINARY=\"/usr/lib/chromium/chromedriver\"\nENV PANTHER_NO_SANDBOX=\"1\"\nWORKDIR /srv/coopcycle\nCOPY composer.json ./\nCOPY composer.lock ./\nRUN mkdir -p var/cache var/logs var/sessions vendor \\\n && chown -R www-data var/cache \\\n && chown -R www-data var/logs \\\n && chown -R www-data var/sessions \\\n && chmod -R +w var/cache \\\n && chmod a+w var \\\n && chown -R www-data vendor\nCOPY app app/\nCOPY bin bin/\nCOPY src src/\nCOPY web web/\nCOPY docker/php/start.sh /usr/local/bin/docker-app-start\nRUN chmod +x /usr/local/bin/docker-app-start\nRUN chmod +x bin/demo\n#   Needed to fix permissions error\nUSER 82\nRUN composer dump-autoload --optimize --classmap-authoritative --no-dev\nRUN composer install --prefer-dist --no-dev --no-autoloader --no-scripts --no-progress --no-suggest \\\n && composer clear-cache\nENTRYPOINT [\"docker-app-start\"]\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n","originalDockerfile":"FROM php:7.2-fpm-alpine\nRUN apk update\nRUN apk add --no-cache git icu zlib\nENV APCU_VERSION=\"5.1.8\"\nRUN set -xe \\\n && apk add --no-cache icu-dev postgresql-dev zlib-dev \\\n && apk add --no-cache libpng libjpeg-turbo freetype libpng-dev libjpeg-turbo-dev freetype-dev \\\n && apk add --no-cache unzip chromium chromium-chromedriver \\\n && apk add --no-cache jpegoptim optipng pngquant \\\n && apk add --no-cache --virtual .build-deps $PHPIZE_DEPS \\\n && docker-php-ext-configure pdo_pgsql \\\n && docker-php-ext-configure gd --with-gd --with-freetype-dir=/usr/include/ --with-png-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n && docker-php-ext-install intl pdo_pgsql zip bcmath gd \\\n && pecl install apcu-${APCU_VERSION} \\\n && docker-php-ext-enable --ini-name 20-apcu.ini apcu \\\n && docker-php-ext-enable --ini-name 05-opcache.ini opcache \\\n && apk del .build-deps\nCOPY docker/php/php.ini /usr/local/etc/php/php.ini\nCOPY docker/php/install-composer.sh /usr/local/bin/docker-app-install-composer\nRUN chmod +x /usr/local/bin/docker-app-install-composer\nRUN set -xe \\\n && apk add --no-cache --virtual .fetch-deps openssl \\\n && sh /usr/local/bin/docker-app-install-composer \\\n && mv composer.phar /usr/local/bin/composer \\\n && apk del .fetch-deps\n#  https://getcomposer.org/doc/03-cli.md#composer-allow-superuser\nENV COMPOSER_ALLOW_SUPERUSER=\"1\"\nRUN composer global require \"hirak/prestissimo:^0.3\" --prefer-dist --no-progress --no-suggest --optimize-autoloader --classmap-authoritative \\\n && composer clear-cache\nENV COMPOSER_ALLOW_SUPERUSER=\"0\"\nENV PANTHER_CHROME_BINARY=\"/usr/bin/chromium-browser\"\nENV PANTHER_CHROME_DRIVER_BINARY=\"/usr/lib/chromium/chromedriver\"\nENV PANTHER_NO_SANDBOX=\"1\"\nWORKDIR /srv/coopcycle\nCOPY composer.json ./\nCOPY composer.lock ./\nRUN mkdir -p var/cache var/logs var/sessions vendor \\\n && chown -R www-data var/cache \\\n && chown -R www-data var/logs \\\n && chown -R www-data var/sessions \\\n && chmod -R +w var/cache \\\n && chmod a+w var \\\n && chown -R www-data vendor\nCOPY app app/\nCOPY bin bin/\nCOPY src src/\nCOPY web web/\nCOPY docker/php/start.sh /usr/local/bin/docker-app-start\nRUN chmod +x /usr/local/bin/docker-app-start\nRUN chmod +x bin/demo\n#  Needed to fix permissions error\nUSER 82\nRUN composer dump-autoload --optimize --classmap-authoritative --no-dev\nRUN composer install --prefer-dist --no-dev --no-autoloader --no-scripts --no-progress --no-suggest \\\n && composer clear-cache\nENTRYPOINT [\"docker-app-start\"]\n","injectedSmells":[],"originalDockerfileHash":"ca8a72e59c79c3027cde618752f9a49b","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM php:7.2-fpm-alpine\nRUN apk update\nRUN apk add --no-cache git icu zlib\nENV APCU_VERSION=\"5.1.8\"\nRUN set -xe \\\n && apk add --no-cache icu-dev postgresql-dev zlib-dev \\\n && apk add --no-cache libpng libjpeg-turbo freetype libpng-dev libjpeg-turbo-dev freetype-dev \\\n && apk add --no-cache unzip chromium chromium-chromedriver \\\n && apk add --no-cache jpegoptim optipng pngquant \\\n && apk add --no-cache --virtual .build-deps $PHPIZE_DEPS \\\n && docker-php-ext-configure pdo_pgsql \\\n && docker-php-ext-configure gd --with-gd --with-freetype-dir=/usr/include/ --with-png-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n && docker-php-ext-install intl pdo_pgsql zip bcmath gd \\\n && pecl install apcu-${APCU_VERSION} \\\n && docker-php-ext-enable --ini-name 20-apcu.ini apcu \\\n && docker-php-ext-enable --ini-name 05-opcache.ini opcache \\\n && apk del .build-deps\nCOPY docker/php/php.ini /usr/local/etc/php/php.ini\nCOPY docker/php/install-composer.sh /usr/local/bin/docker-app-install-composer\nRUN chmod +x /usr/local/bin/docker-app-install-composer\nRUN set -xe \\\n && apk add --no-cache --virtual .fetch-deps openssl \\\n && sh /usr/local/bin/docker-app-install-composer \\\n && mv composer.phar /usr/local/bin/composer \\\n && apk del .fetch-deps\n#   https://getcomposer.org/doc/03-cli.md#composer-allow-superuser\nENV COMPOSER_ALLOW_SUPERUSER=\"1\"\nRUN composer global require \"hirak/prestissimo:^0.3\" --prefer-dist --no-progress --no-suggest --optimize-autoloader --classmap-authoritative \\\n && composer clear-cache\nENV COMPOSER_ALLOW_SUPERUSER=\"0\"\nENV PANTHER_CHROME_BINARY=\"/usr/bin/chromium-browser\"\nENV PANTHER_CHROME_DRIVER_BINARY=\"/usr/lib/chromium/chromedriver\"\nENV PANTHER_NO_SANDBOX=\"1\"\nWORKDIR /srv/coopcycle\nCOPY composer.json ./\nCOPY composer.lock ./\nRUN mkdir -p var/cache var/logs var/sessions vendor \\\n && chown -R www-data var/cache \\\n && chown -R www-data var/logs \\\n && chown -R www-data var/sessions \\\n && chmod -R +w var/cache \\\n && chmod a+w var \\\n && chown -R www-data vendor\nCOPY app app/\nCOPY bin bin/\nCOPY src src/\nCOPY web web/\nCOPY docker/php/start.sh /usr/local/bin/docker-app-start\nRUN chmod +x /usr/local/bin/docker-app-start\nRUN chmod +x bin/demo\n#   Needed to fix permissions error\nUSER 82\nRUN composer dump-autoload --optimize --classmap-authoritative --no-dev\nRUN composer install --prefer-dist --no-dev --no-autoloader --no-scripts --no-progress --no-suggest \\\n && composer clear-cache\nENTRYPOINT [\"docker-app-start\"]\n","originalDockerfileUglifiedHash":"2675ecdcb46e24375e35a6edcb5ae2ed","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/dfab19669c75404aa936075c8945a9963e774d7c.dockerfile"}