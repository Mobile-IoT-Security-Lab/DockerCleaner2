{"seed":3923369428,"processedDockerfileHash":"d5c0fb3a76083aca2a1942af1cf4be01","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["do-not-have-secrets","have-a-healthcheck"],"processedDockerfile":"#   © Copyright IBM Corporation 2015, 2019\n#\n#   Licensed under the Apache License, Version 2.0 (the \"License\");\n#   you may not use this file except in compliance with the License.\n#   You may obtain a copy of the License at\n#\n#   http://www.apache.org/licenses/LICENSE-2.0\n#\n#   Unless required by applicable law or agreed to in writing, software\n#   distributed under the License is distributed on an \"AS IS\" BASIS,\n#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#   See the License for the specific language governing permissions and\n#   limitations under the License.\n#  ##############################################################################\n#   Build stage to build Go code\n#  ##############################################################################\nFROM registry.access.redhat.com/devtools/go-toolset-7-rhel7 AS builder\n#   FROM docker.io/centos/go-toolset-7-centos7 as builder\n#   The URL to download the MQ installer from in tar.gz format\n#   This assumes an archive containing the MQ RPM install packages\nARG MQ_URL=\"https://public.dhe.ibm.com/ibmdl/export/pub/software/websphere/messaging/mqadv/mqadv_dev912_linux_x86-64.tar.gz\"\nARG IMAGE_REVISION=\"Not specified\"\nARG IMAGE_SOURCE=\"Not specified\"\nARG IMAGE_TAG=\"Not specified\"\nARG MQM_UID=888\nUSER 0\nCOPY install-mq.sh /usr/local/bin/\nRUN chmod a+x /usr/local/bin/install-mq.sh \\\n && sleep 1 \\\n && MQ_PACKAGES=\"MQSeriesRuntime-*.rpm MQSeriesSDK-*.rpm MQSeriesSamples*.rpm\" install-mq.sh $MQM_UID\nWORKDIR /opt/app-root/src/go/src/github.com/ibm-messaging/mq-container/\nCOPY cmd/ ./cmd\nCOPY internal/ ./internal\nCOPY vendor/ ./vendor\nENV PATH=\"${PATH}:/opt/rh/go-toolset-7/root/usr/bin\" \\\n    CGO_CFLAGS=\"-I/opt/mqm/inc/\" \\\n    CGO_LDFLAGS_ALLOW=\"-Wl,-rpath.*\"\nRUN go build -ldflags \"-X \\\"main.ImageCreated=$( date --iso-8601=seconds ;)\\\" -X \\\"main.ImageRevision=$IMAGE_REVISION\\\" -X \\\"main.ImageSource=$IMAGE_SOURCE\\\" -X \\\"main.ImageTag=$IMAGE_TAG\\\"\" ./cmd/runmqserver/\nRUN go build ./cmd/chkmqready/\nRUN go build ./cmd/chkmqhealthy/\nRUN go build ./cmd/runmqdevserver/\nRUN go test -v ./cmd/runmqdevserver/...\nRUN go test -v ./cmd/runmqserver/\nRUN go test -v ./cmd/chkmqready/\nRUN go test -v ./cmd/chkmqhealthy/\nRUN go test -v ./internal/...\nRUN go vet ./cmd/... ./internal/...\n#  ##############################################################################\n#   Main build stage, to build MQ image\n#  ##############################################################################\nFROM registry.access.redhat.com/ubi7/ubi-minimal AS mq-server\n#   The MQ packages to install - see install-mq.sh for default value\nARG MQ_URL=\"https://public.dhe.ibm.com/ibmdl/export/pub/software/websphere/messaging/mqadv/mqadv_dev912_linux_x86-64.tar.gz\"\nARG MQ_PACKAGES=\"MQSeriesRuntime-*.rpm MQSeriesServer-*.rpm MQSeriesJava*.rpm MQSeriesJRE*.rpm MQSeriesGSKit*.rpm MQSeriesMsg*.rpm MQSeriesSamples*.rpm MQSeriesWeb*.rpm MQSeriesAMS-*.rpm\"\n#  ARG MQ_PACKAGES=\"ibmmq-server ibmmq-java ibmmq-jre ibmmq-gskit ibmmq-msg-.* ibmmq-samples ibmmq-web ibmmq-ams\"\nARG MQM_UID=888\nLABEL summary=\"IBM MQ Advanced Server\"\nLABEL description=\"Simplify, accelerate and facilitate the reliable exchange of data with a security-rich messaging solution — trusted by the world’s most successful enterprises\"\nLABEL vendor=\"IBM\"\nLABEL distribution-scope=\"private\"\nLABEL authoritative-source-url=\"https://www.ibm.com/software/passportadvantage/\"\nLABEL url=\"https://www.ibm.com/products/mq/advanced\"\nLABEL io.openshift.tags=\"mq messaging\"\nLABEL io.k8s.display-name=\"IBM MQ Advanced Server\"\nLABEL io.k8s.description=\"Simplify, accelerate and facilitate the reliable exchange of data with a security-rich messaging solution — trusted by the world’s most successful enterprises\"\nCOPY install-mq.sh /usr/local/bin/\nCOPY install-mq-server-prereqs.sh /usr/local/bin/\n#   Install MQ.  To avoid a \"text file busy\" error here, we sleep before installing.\nRUN env \\\n && chmod u+x /usr/local/bin/install-*.sh \\\n && sleep 1 \\\n && install-mq-server-prereqs.sh $MQM_UID \\\n && install-mq.sh $MQM_UID\n#   Create a directory for runtime data from runmqserver\nRUN mkdir -p /run/runmqserver \\\n && chown mqm:mqm /run/runmqserver\nCOPY --from=builder /opt/app-root/src/go/src/github.com/ibm-messaging/mq-container/runmqserver /usr/local/bin/\nCOPY --from=builder /opt/app-root/src/go/src/github.com/ibm-messaging/mq-container/chkmq* /usr/local/bin/\nCOPY NOTICES.txt /opt/mqm/licenses/notices-container.txt\n#   Copy web XML files\nCOPY web /etc/mqm/web\nCOPY etc/mqm/*.tpl /etc/mqm/\nRUN chmod ug+x /usr/local/bin/runmqserver \\\n && chown mqm:mqm /usr/local/bin/*mq* \\\n && chmod ug+xs /usr/local/bin/chkmq* \\\n && chown -R mqm:mqm /etc/mqm/* \\\n && install --directory --mode 0775 --owner mqm --group root /run/runmqserver \\\n && touch /run/termination-log \\\n && chown mqm:root /run/termination-log \\\n && chmod 0660 /run/termination-log\n#   Always use port 1414 for MQ & 9157 for the metrics\nEXPOSE 1414/tcp 9157/tcp 9443/tcp\nENV LANG=\"en_US.UTF-8\" \\\n    AMQ_DIAGNOSTIC_MSG_SEVERITY=\"1\" \\\n    AMQ_ADDITIONAL_JSON_LOG=\"1\" \\\n    LOG_FORMAT=\"basic\"\nUSER $MQM_UID\nENTRYPOINT [\"runmqserver\"]\n#  ##############################################################################\n#   Add default developer config\n#  ##############################################################################\nFROM mq-server AS mq-dev-server\nARG MQM_UID=888\n#   Enable MQ developer default configuration\nENV MQ_DEV=\"true\"\n#   Default administrator password\n# A secret has been removed here. Please do not provide secrets from the Dockerfile as these will leak into the metadata of the resulting docker image. To provide secrets the --secret flag of the docker build command can be used (https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information).\nLABEL summary=\"IBM MQ Advanced for Developers Server\"\nLABEL description=\"Simplify, accelerate and facilitate the reliable exchange of data with a security-rich messaging solution — trusted by the world’s most successful enterprises\"\nLABEL vendor=\"IBM\"\nLABEL distribution-scope=\"private\"\nLABEL authoritative-source-url=\"https://www.ibm.com/software/passportadvantage/\"\nLABEL url=\"https://www.ibm.com/products/mq/advanced\"\nLABEL io.openshift.tags=\"mq messaging\"\nLABEL io.k8s.display-name=\"IBM MQ Advanced for Developers Server\"\nLABEL io.k8s.description=\"Simplify, accelerate and facilitate the reliable exchange of data with a security-rich messaging solution — trusted by the world’s most successful enterprises\"\nUSER 0\nCOPY incubating/mqadvanced-server-dev/install-extra-packages.sh /usr/local/bin/\nRUN chmod u+x /usr/local/bin/install-extra-packages.sh \\\n && sleep 1 \\\n && install-extra-packages.sh\n#   WARNING: This is what allows the mqm user to change the password of any other user\n#   It's used by runmqdevserver to change the admin/app passwords.\nRUN echo \"mqm ALL = NOPASSWD: /usr/sbin/chpasswd\" > /etc/sudoers.d/mq-dev-config\n#  # Add admin and app users, and set a default password for admin\nRUN useradd admin -G mqm \\\n && groupadd mqclient \\\n && useradd app -G mqclient \\\n && echo admin:$MQ_ADMIN_PASSWORD | chpasswd\n#   Create a directory for runtime data from runmqserver\nRUN mkdir -p /run/runmqdevserver \\\n && chown mqm:mqm /run/runmqdevserver\nCOPY --from=builder /opt/app-root/src/go/src/github.com/ibm-messaging/mq-container/runmqdevserver /usr/local/bin/\n#   Copy template files\nCOPY incubating/mqadvanced-server-dev/*.tpl /etc/mqm/\n#   Copy web XML files for default developer configuration\nCOPY incubating/mqadvanced-server-dev/web /etc/mqm/web\nRUN chown -R mqm:mqm /etc/mqm/* \\\n && chmod +x /usr/local/bin/runmq* \\\n && install --directory --mode 0775 --owner mqm --group root /run/runmqdevserver\nENV MQ_ENABLE_EMBEDDED_WEB_SERVER=\"1\"\nUSER $MQM_UID\nENTRYPOINT [\"runmqdevserver\"]\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  © Copyright IBM Corporation 2015, 2019\n#\n#  Licensed under the Apache License, Version 2.0 (the \"License\");\n#  you may not use this file except in compliance with the License.\n#  You may obtain a copy of the License at\n#\n#  http://www.apache.org/licenses/LICENSE-2.0\n#\n#  Unless required by applicable law or agreed to in writing, software\n#  distributed under the License is distributed on an \"AS IS\" BASIS,\n#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#  See the License for the specific language governing permissions and\n#  limitations under the License.\n# ##############################################################################\n#  Build stage to build Go code\n# ##############################################################################\nFROM registry.access.redhat.com/devtools/go-toolset-7-rhel7 AS builder\n#  FROM docker.io/centos/go-toolset-7-centos7 as builder\n#  The URL to download the MQ installer from in tar.gz format\n#  This assumes an archive containing the MQ RPM install packages\nARG MQ_URL=\"https://public.dhe.ibm.com/ibmdl/export/pub/software/websphere/messaging/mqadv/mqadv_dev912_linux_x86-64.tar.gz\"\nARG IMAGE_REVISION=\"Not specified\"\nARG IMAGE_SOURCE=\"Not specified\"\nARG IMAGE_TAG=\"Not specified\"\nARG MQM_UID=888\nUSER 0\nCOPY install-mq.sh /usr/local/bin/\nRUN chmod a+x /usr/local/bin/install-mq.sh \\\n && sleep 1 \\\n && MQ_PACKAGES=\"MQSeriesRuntime-*.rpm MQSeriesSDK-*.rpm MQSeriesSamples*.rpm\" install-mq.sh $MQM_UID\nWORKDIR /opt/app-root/src/go/src/github.com/ibm-messaging/mq-container/\nCOPY cmd/ ./cmd\nCOPY internal/ ./internal\nCOPY vendor/ ./vendor\nENV PATH=\"${PATH}:/opt/rh/go-toolset-7/root/usr/bin\" \\\n    CGO_CFLAGS=\"-I/opt/mqm/inc/\" \\\n    CGO_LDFLAGS_ALLOW=\"-Wl,-rpath.*\"\nRUN go build -ldflags \"-X \\\"main.ImageCreated=$( date --iso-8601=seconds ;)\\\" -X \\\"main.ImageRevision=$IMAGE_REVISION\\\" -X \\\"main.ImageSource=$IMAGE_SOURCE\\\" -X \\\"main.ImageTag=$IMAGE_TAG\\\"\" ./cmd/runmqserver/\nRUN go build ./cmd/chkmqready/\nRUN go build ./cmd/chkmqhealthy/\nRUN go build ./cmd/runmqdevserver/\nRUN go test -v ./cmd/runmqdevserver/...\nRUN go test -v ./cmd/runmqserver/\nRUN go test -v ./cmd/chkmqready/\nRUN go test -v ./cmd/chkmqhealthy/\nRUN go test -v ./internal/...\nRUN go vet ./cmd/... ./internal/...\n# ##############################################################################\n#  Main build stage, to build MQ image\n# ##############################################################################\nFROM registry.access.redhat.com/ubi7/ubi-minimal AS mq-server\n#  The MQ packages to install - see install-mq.sh for default value\nARG MQ_URL=\"https://public.dhe.ibm.com/ibmdl/export/pub/software/websphere/messaging/mqadv/mqadv_dev912_linux_x86-64.tar.gz\"\nARG MQ_PACKAGES=\"MQSeriesRuntime-*.rpm MQSeriesServer-*.rpm MQSeriesJava*.rpm MQSeriesJRE*.rpm MQSeriesGSKit*.rpm MQSeriesMsg*.rpm MQSeriesSamples*.rpm MQSeriesWeb*.rpm MQSeriesAMS-*.rpm\"\n# ARG MQ_PACKAGES=\"ibmmq-server ibmmq-java ibmmq-jre ibmmq-gskit ibmmq-msg-.* ibmmq-samples ibmmq-web ibmmq-ams\"\nARG MQM_UID=888\nLABEL summary=\"IBM MQ Advanced Server\"\nLABEL description=\"Simplify, accelerate and facilitate the reliable exchange of data with a security-rich messaging solution — trusted by the world’s most successful enterprises\"\nLABEL vendor=\"IBM\"\nLABEL distribution-scope=\"private\"\nLABEL authoritative-source-url=\"https://www.ibm.com/software/passportadvantage/\"\nLABEL url=\"https://www.ibm.com/products/mq/advanced\"\nLABEL io.openshift.tags=\"mq messaging\"\nLABEL io.k8s.display-name=\"IBM MQ Advanced Server\"\nLABEL io.k8s.description=\"Simplify, accelerate and facilitate the reliable exchange of data with a security-rich messaging solution — trusted by the world’s most successful enterprises\"\nCOPY install-mq.sh /usr/local/bin/\nCOPY install-mq-server-prereqs.sh /usr/local/bin/\n#  Install MQ.  To avoid a \"text file busy\" error here, we sleep before installing.\nRUN env \\\n && chmod u+x /usr/local/bin/install-*.sh \\\n && sleep 1 \\\n && install-mq-server-prereqs.sh $MQM_UID \\\n && install-mq.sh $MQM_UID\n#  Create a directory for runtime data from runmqserver\nRUN mkdir -p /run/runmqserver \\\n && chown mqm:mqm /run/runmqserver\nCOPY --from=builder /opt/app-root/src/go/src/github.com/ibm-messaging/mq-container/runmqserver /usr/local/bin/\nCOPY --from=builder /opt/app-root/src/go/src/github.com/ibm-messaging/mq-container/chkmq* /usr/local/bin/\nCOPY NOTICES.txt /opt/mqm/licenses/notices-container.txt\n#  Copy web XML files\nCOPY web /etc/mqm/web\nCOPY etc/mqm/*.tpl /etc/mqm/\nRUN chmod ug+x /usr/local/bin/runmqserver \\\n && chown mqm:mqm /usr/local/bin/*mq* \\\n && chmod ug+xs /usr/local/bin/chkmq* \\\n && chown -R mqm:mqm /etc/mqm/* \\\n && install --directory --mode 0775 --owner mqm --group root /run/runmqserver \\\n && touch /run/termination-log \\\n && chown mqm:root /run/termination-log \\\n && chmod 0660 /run/termination-log\n#  Always use port 1414 for MQ & 9157 for the metrics\nEXPOSE 1414/tcp 9157/tcp 9443/tcp\nENV LANG=\"en_US.UTF-8\" \\\n    AMQ_DIAGNOSTIC_MSG_SEVERITY=\"1\" \\\n    AMQ_ADDITIONAL_JSON_LOG=\"1\" \\\n    LOG_FORMAT=\"basic\"\nUSER $MQM_UID\nENTRYPOINT [\"runmqserver\"]\n# ##############################################################################\n#  Add default developer config\n# ##############################################################################\nFROM mq-server AS mq-dev-server\nARG MQM_UID=888\n#  Enable MQ developer default configuration\nENV MQ_DEV=\"true\"\n#  Default administrator password\nENV MQ_ADMIN_PASSWORD=\"passw0rd\"\nLABEL summary=\"IBM MQ Advanced for Developers Server\"\nLABEL description=\"Simplify, accelerate and facilitate the reliable exchange of data with a security-rich messaging solution — trusted by the world’s most successful enterprises\"\nLABEL vendor=\"IBM\"\nLABEL distribution-scope=\"private\"\nLABEL authoritative-source-url=\"https://www.ibm.com/software/passportadvantage/\"\nLABEL url=\"https://www.ibm.com/products/mq/advanced\"\nLABEL io.openshift.tags=\"mq messaging\"\nLABEL io.k8s.display-name=\"IBM MQ Advanced for Developers Server\"\nLABEL io.k8s.description=\"Simplify, accelerate and facilitate the reliable exchange of data with a security-rich messaging solution — trusted by the world’s most successful enterprises\"\nUSER 0\nCOPY incubating/mqadvanced-server-dev/install-extra-packages.sh /usr/local/bin/\nRUN chmod u+x /usr/local/bin/install-extra-packages.sh \\\n && sleep 1 \\\n && install-extra-packages.sh\n#  WARNING: This is what allows the mqm user to change the password of any other user\n#  It's used by runmqdevserver to change the admin/app passwords.\nRUN echo \"mqm ALL = NOPASSWD: /usr/sbin/chpasswd\" > /etc/sudoers.d/mq-dev-config\n# # Add admin and app users, and set a default password for admin\nRUN useradd admin -G mqm \\\n && groupadd mqclient \\\n && useradd app -G mqclient \\\n && echo admin:$MQ_ADMIN_PASSWORD | chpasswd\n#  Create a directory for runtime data from runmqserver\nRUN mkdir -p /run/runmqdevserver \\\n && chown mqm:mqm /run/runmqdevserver\nCOPY --from=builder /opt/app-root/src/go/src/github.com/ibm-messaging/mq-container/runmqdevserver /usr/local/bin/\n#  Copy template files\nCOPY incubating/mqadvanced-server-dev/*.tpl /etc/mqm/\n#  Copy web XML files for default developer configuration\nCOPY incubating/mqadvanced-server-dev/web /etc/mqm/web\nRUN chown -R mqm:mqm /etc/mqm/* \\\n && chmod +x /usr/local/bin/runmq* \\\n && install --directory --mode 0775 --owner mqm --group root /run/runmqdevserver\nENV MQ_ENABLE_EMBEDDED_WEB_SERVER=\"1\"\nUSER $MQM_UID\nENTRYPOINT [\"runmqdevserver\"]\n","injectedSmells":[],"originalDockerfileHash":"9032d96cf7d64be3bd7dc2b3e9d9ddd4","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   © Copyright IBM Corporation 2015, 2019\n#\n#   Licensed under the Apache License, Version 2.0 (the \"License\");\n#   you may not use this file except in compliance with the License.\n#   You may obtain a copy of the License at\n#\n#   http://www.apache.org/licenses/LICENSE-2.0\n#\n#   Unless required by applicable law or agreed to in writing, software\n#   distributed under the License is distributed on an \"AS IS\" BASIS,\n#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#   See the License for the specific language governing permissions and\n#   limitations under the License.\n#  ##############################################################################\n#   Build stage to build Go code\n#  ##############################################################################\nFROM registry.access.redhat.com/devtools/go-toolset-7-rhel7 AS builder\n#   FROM docker.io/centos/go-toolset-7-centos7 as builder\n#   The URL to download the MQ installer from in tar.gz format\n#   This assumes an archive containing the MQ RPM install packages\nARG MQ_URL=\"https://public.dhe.ibm.com/ibmdl/export/pub/software/websphere/messaging/mqadv/mqadv_dev912_linux_x86-64.tar.gz\"\nARG IMAGE_REVISION=\"Not specified\"\nARG IMAGE_SOURCE=\"Not specified\"\nARG IMAGE_TAG=\"Not specified\"\nARG MQM_UID=888\nUSER 0\nCOPY install-mq.sh /usr/local/bin/\nRUN chmod a+x /usr/local/bin/install-mq.sh \\\n && sleep 1 \\\n && MQ_PACKAGES=\"MQSeriesRuntime-*.rpm MQSeriesSDK-*.rpm MQSeriesSamples*.rpm\" install-mq.sh $MQM_UID\nWORKDIR /opt/app-root/src/go/src/github.com/ibm-messaging/mq-container/\nCOPY cmd/ ./cmd\nCOPY internal/ ./internal\nCOPY vendor/ ./vendor\nENV PATH=\"${PATH}:/opt/rh/go-toolset-7/root/usr/bin\" \\\n    CGO_CFLAGS=\"-I/opt/mqm/inc/\" \\\n    CGO_LDFLAGS_ALLOW=\"-Wl,-rpath.*\"\nRUN go build -ldflags \"-X \\\"main.ImageCreated=$( date --iso-8601=seconds ;)\\\" -X \\\"main.ImageRevision=$IMAGE_REVISION\\\" -X \\\"main.ImageSource=$IMAGE_SOURCE\\\" -X \\\"main.ImageTag=$IMAGE_TAG\\\"\" ./cmd/runmqserver/\nRUN go build ./cmd/chkmqready/\nRUN go build ./cmd/chkmqhealthy/\nRUN go build ./cmd/runmqdevserver/\nRUN go test -v ./cmd/runmqdevserver/...\nRUN go test -v ./cmd/runmqserver/\nRUN go test -v ./cmd/chkmqready/\nRUN go test -v ./cmd/chkmqhealthy/\nRUN go test -v ./internal/...\nRUN go vet ./cmd/... ./internal/...\n#  ##############################################################################\n#   Main build stage, to build MQ image\n#  ##############################################################################\nFROM registry.access.redhat.com/ubi7/ubi-minimal AS mq-server\n#   The MQ packages to install - see install-mq.sh for default value\nARG MQ_URL=\"https://public.dhe.ibm.com/ibmdl/export/pub/software/websphere/messaging/mqadv/mqadv_dev912_linux_x86-64.tar.gz\"\nARG MQ_PACKAGES=\"MQSeriesRuntime-*.rpm MQSeriesServer-*.rpm MQSeriesJava*.rpm MQSeriesJRE*.rpm MQSeriesGSKit*.rpm MQSeriesMsg*.rpm MQSeriesSamples*.rpm MQSeriesWeb*.rpm MQSeriesAMS-*.rpm\"\n#  ARG MQ_PACKAGES=\"ibmmq-server ibmmq-java ibmmq-jre ibmmq-gskit ibmmq-msg-.* ibmmq-samples ibmmq-web ibmmq-ams\"\nARG MQM_UID=888\nLABEL summary=\"IBM MQ Advanced Server\"\nLABEL description=\"Simplify, accelerate and facilitate the reliable exchange of data with a security-rich messaging solution — trusted by the world’s most successful enterprises\"\nLABEL vendor=\"IBM\"\nLABEL distribution-scope=\"private\"\nLABEL authoritative-source-url=\"https://www.ibm.com/software/passportadvantage/\"\nLABEL url=\"https://www.ibm.com/products/mq/advanced\"\nLABEL io.openshift.tags=\"mq messaging\"\nLABEL io.k8s.display-name=\"IBM MQ Advanced Server\"\nLABEL io.k8s.description=\"Simplify, accelerate and facilitate the reliable exchange of data with a security-rich messaging solution — trusted by the world’s most successful enterprises\"\nCOPY install-mq.sh /usr/local/bin/\nCOPY install-mq-server-prereqs.sh /usr/local/bin/\n#   Install MQ.  To avoid a \"text file busy\" error here, we sleep before installing.\nRUN env \\\n && chmod u+x /usr/local/bin/install-*.sh \\\n && sleep 1 \\\n && install-mq-server-prereqs.sh $MQM_UID \\\n && install-mq.sh $MQM_UID\n#   Create a directory for runtime data from runmqserver\nRUN mkdir -p /run/runmqserver \\\n && chown mqm:mqm /run/runmqserver\nCOPY --from=builder /opt/app-root/src/go/src/github.com/ibm-messaging/mq-container/runmqserver /usr/local/bin/\nCOPY --from=builder /opt/app-root/src/go/src/github.com/ibm-messaging/mq-container/chkmq* /usr/local/bin/\nCOPY NOTICES.txt /opt/mqm/licenses/notices-container.txt\n#   Copy web XML files\nCOPY web /etc/mqm/web\nCOPY etc/mqm/*.tpl /etc/mqm/\nRUN chmod ug+x /usr/local/bin/runmqserver \\\n && chown mqm:mqm /usr/local/bin/*mq* \\\n && chmod ug+xs /usr/local/bin/chkmq* \\\n && chown -R mqm:mqm /etc/mqm/* \\\n && install --directory --mode 0775 --owner mqm --group root /run/runmqserver \\\n && touch /run/termination-log \\\n && chown mqm:root /run/termination-log \\\n && chmod 0660 /run/termination-log\n#   Always use port 1414 for MQ & 9157 for the metrics\nEXPOSE 1414/tcp 9157/tcp 9443/tcp\nENV LANG=\"en_US.UTF-8\" \\\n    AMQ_DIAGNOSTIC_MSG_SEVERITY=\"1\" \\\n    AMQ_ADDITIONAL_JSON_LOG=\"1\" \\\n    LOG_FORMAT=\"basic\"\nUSER $MQM_UID\nENTRYPOINT [\"runmqserver\"]\n#  ##############################################################################\n#   Add default developer config\n#  ##############################################################################\nFROM mq-server AS mq-dev-server\nARG MQM_UID=888\n#   Enable MQ developer default configuration\nENV MQ_DEV=\"true\"\n#   Default administrator password\nENV MQ_ADMIN_PASSWORD=\"passw0rd\"\nLABEL summary=\"IBM MQ Advanced for Developers Server\"\nLABEL description=\"Simplify, accelerate and facilitate the reliable exchange of data with a security-rich messaging solution — trusted by the world’s most successful enterprises\"\nLABEL vendor=\"IBM\"\nLABEL distribution-scope=\"private\"\nLABEL authoritative-source-url=\"https://www.ibm.com/software/passportadvantage/\"\nLABEL url=\"https://www.ibm.com/products/mq/advanced\"\nLABEL io.openshift.tags=\"mq messaging\"\nLABEL io.k8s.display-name=\"IBM MQ Advanced for Developers Server\"\nLABEL io.k8s.description=\"Simplify, accelerate and facilitate the reliable exchange of data with a security-rich messaging solution — trusted by the world’s most successful enterprises\"\nUSER 0\nCOPY incubating/mqadvanced-server-dev/install-extra-packages.sh /usr/local/bin/\nRUN chmod u+x /usr/local/bin/install-extra-packages.sh \\\n && sleep 1 \\\n && install-extra-packages.sh\n#   WARNING: This is what allows the mqm user to change the password of any other user\n#   It's used by runmqdevserver to change the admin/app passwords.\nRUN echo \"mqm ALL = NOPASSWD: /usr/sbin/chpasswd\" > /etc/sudoers.d/mq-dev-config\n#  # Add admin and app users, and set a default password for admin\nRUN useradd admin -G mqm \\\n && groupadd mqclient \\\n && useradd app -G mqclient \\\n && echo admin:$MQ_ADMIN_PASSWORD | chpasswd\n#   Create a directory for runtime data from runmqserver\nRUN mkdir -p /run/runmqdevserver \\\n && chown mqm:mqm /run/runmqdevserver\nCOPY --from=builder /opt/app-root/src/go/src/github.com/ibm-messaging/mq-container/runmqdevserver /usr/local/bin/\n#   Copy template files\nCOPY incubating/mqadvanced-server-dev/*.tpl /etc/mqm/\n#   Copy web XML files for default developer configuration\nCOPY incubating/mqadvanced-server-dev/web /etc/mqm/web\nRUN chown -R mqm:mqm /etc/mqm/* \\\n && chmod +x /usr/local/bin/runmq* \\\n && install --directory --mode 0775 --owner mqm --group root /run/runmqdevserver\nENV MQ_ENABLE_EMBEDDED_WEB_SERVER=\"1\"\nUSER $MQM_UID\nENTRYPOINT [\"runmqdevserver\"]\n","originalDockerfileUglifiedHash":"2512417a080c9736f57f3a883e7986c8","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/b9afb9d7763db7df1abccbcd7d38a7560d7e6bd7.dockerfile"}