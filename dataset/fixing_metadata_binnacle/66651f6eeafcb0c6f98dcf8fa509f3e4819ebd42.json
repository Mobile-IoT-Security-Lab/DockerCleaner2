{"seed":328221696,"processedDockerfileHash":"f6c3139861bb8466da93114df6f36579","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-pip","use-copy-instead-of-add","have-a-healthcheck"],"processedDockerfile":"#  ckan + ckanext-harvest + ckanext-dcat + ckanext-dcatapit\nFROM centos:7\n#   set vars\nENV CKAN_HOME=\"/usr/lib/ckan/default\"\nENV CKAN_CONFIG=\"/etc/ckan/default\"\nENV CKAN_LOG_DIR=\"/var/log/ckan\"\nENV CKAN_STORAGE_PATH=\"/var/lib/ckan\"\nENV CKAN_SITE_URL=\"http://localhost:5000\"\n#   install requirements\nRUN yum -y install epel-release\nRUN yum -y install postgresql postgresql-contrib postgresql-devel postgis\nRUN yum -y install gcc gcc-c++ make git gdal geos\nRUN yum -y install libxml2 libxml2-devel libxslt libxslt-devel\nRUN yum -y install gdal-python python-pip python-imaging python-virtualenv libxml2-python libxslt-python python-lxml python-devel python-babel python-repoze-who python-repoze-who-plugins-sa python-repoze-who-testutil python-repoze-who-friendlyform python-tempita python-zope-interface policycoreutils-python\nRUN yum -y install postgresql wget\nRUN wget http://download.redis.io/redis-stable.tar.gz \\\n && tar xvzf redis-stable.tar.gz \\\n && pushd redis-stable \\\n && make \\\n && cp src/redis-cli /usr/local/bin/ \\\n && chmod 755 /usr/local/bin/redis-cli \\\n && popd \\\n && rm -rf ./redis-stable*\n#   upgrade python pip\nRUN pip install pip==23.1 --upgrade\n#   setup ckan Directory\nRUN mkdir -p $CKAN_HOME\nRUN mkdir -p $CKAN_LOG_DIR\nRUN mkdir -p $CKAN_CONFIG\nRUN mkdir -p $CKAN_STORAGE_PATH\n#   add 'ckan' user\nRUN useradd -m -s /sbin/nologin -d \"${CKAN_HOME}\" -c \"CKAN User\" ckan\n#   add CKAN source code\nRUN mkdir -p $CKAN_HOME/src/ckan/\nCOPY ./ckan $CKAN_HOME/src/ckan/\n#   temporary fix for dependencies\nRUN pip install pytz==2023.3 diagnostics==0.2.4\n#   install requirements\nRUN pip install \"setuptools==36.1\"\nRUN pip install -r \"${CKAN_HOME}/src/ckan/requirements.txt\"\n#   install CKAN\nRUN pip install -e \"${CKAN_HOME}/src/ckan\"\n#   Add ckan.ini configuration file\nCOPY ./ckan.ini $CKAN_CONFIG\nRUN chmod 777 $CKAN_CONFIG/ckan.ini\n#   DCATAPIT theme to group mapping file\nCOPY ./data/config/theme_to_group.ini $CKAN_CONFIG\nRUN chmod 666 $CKAN_CONFIG/theme_to_group.ini\n#   CKAN group to DCATAPIT theme mapping file\nCOPY ./data/config/topics.json $CKAN_CONFIG\nRUN chmod 666 $CKAN_CONFIG/topics.json\n#   Copy various data and initialization files\nRUN mkdir $CKAN_HOME/data/\nCOPY ./data $CKAN_HOME/data/\n#   Link to who.ini\nRUN ln -s ${CKAN_HOME}/src/ckan/ckan/config/who.ini ${CKAN_CONFIG}/who.ini\n#   Install ckanext-harvest\nRUN mkdir $CKAN_HOME/src/ckanext-harvest/\nCOPY ./ckanext-harvest/ $CKAN_HOME/src/ckanext-harvest/\nRUN pip install -e $CKAN_HOME/src/ckanext-harvest/\nRUN pip install -r $CKAN_HOME/src/ckanext-harvest/pip-requirements.txt\nRUN pip install -r $CKAN_HOME/src/ckanext-harvest/dev-requirements.txt\n#  # Install ckanext-dcat\nRUN mkdir $CKAN_HOME/src/ckanext-dcat/\nCOPY ./ckanext-dcat/ $CKAN_HOME/src/ckanext-dcat/\nRUN pip install -e $CKAN_HOME/src/ckanext-dcat/\nRUN pip install -r $CKAN_HOME/src/ckanext-dcat/requirements.txt\n#  # Install ckanext-dcatapit\nRUN mkdir $CKAN_HOME/src/ckanext-dcatapit/\nCOPY ./ckanext-dcatapit/ $CKAN_HOME/src/ckanext-dcatapit/\nRUN pip install -e $CKAN_HOME/src/ckanext-dcatapit/\nRUN pip install -r $CKAN_HOME/src/ckanext-dcatapit/dev-requirements.txt\n#  # Install ckanext-spatial\nRUN mkdir $CKAN_HOME/src/ckanext-spatial/\nCOPY ./ckanext-spatial/ $CKAN_HOME/src/ckanext-spatial/\nRUN pip install -e $CKAN_HOME/src/ckanext-spatial/\nRUN pip install -r $CKAN_HOME/src/ckanext-spatial/pip-requirements.txt\n#  # Install ckanext-spatial\nRUN mkdir $CKAN_HOME/src/ckanext-multilang/\nCOPY ./ckanext-multilang/ $CKAN_HOME/src/ckanext-multilang/\nRUN pip install -e $CKAN_HOME/src/ckanext-multilang/\nRUN chown ckan:ckan \"${CKAN_HOME}\" -R \\\n && chown ckan:ckan \"${CKAN_CONFIG}\" -R \\\n && chown ckan:ckan \"${CKAN_LOG_DIR}\" -R \\\n && chown ckan:ckan \"${CKAN_STORAGE_PATH}\" -R\nRUN chmod 755 \"${CKAN_HOME}\" -R \\\n && chmod 755 \"${CKAN_CONFIG}\" -R \\\n && chmod 755 \"${CKAN_LOG_DIR}\" -R \\\n && chmod 755 \"${CKAN_STORAGE_PATH}\" -R\n#   SetUp EntryPoint \nCOPY ./ckan-entrypoint.sh /\nRUN chmod +x /ckan-entrypoint.sh\nENTRYPOINT [\"/ckan-entrypoint.sh\"]\n#   Add startup scripts\nCOPY ./ckan-init.sh ./ckan-harvest-init.sh /\nRUN chmod +x /ckan-init.sh /ckan-harvest-init.sh\nCOPY ./wait-for-services.sh /\nRUN chmod +x /wait-for-services.sh\nCOPY ./harvest_fetch_and_gather.sh /\nRUN chmod +x /harvest_fetch_and_gather.sh\nCOPY ./periodic-harvest-run.sh /\nRUN chmod +x /periodic-harvest-run.sh\nCOPY ./periodic-harvester-joball.sh /\nRUN chmod +x /periodic-harvester-joball.sh\n#   Volumes \nVOLUME [\"/etc/ckan/default\"]\nVOLUME [\"/var/lib/ckan\"]\nVOLUME [\"/var/log/ckan\"]\nUSER ckan\nEXPOSE 5000/tcp\nWORKDIR \"${CKAN_CONFIG}\"\nCMD [\"paster\", \"serve\", \"ckan.ini\"]\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# ckan + ckanext-harvest + ckanext-dcat + ckanext-dcatapit\nFROM centos:7\n#  set vars\nENV CKAN_HOME=\"/usr/lib/ckan/default\"\nENV CKAN_CONFIG=\"/etc/ckan/default\"\nENV CKAN_LOG_DIR=\"/var/log/ckan\"\nENV CKAN_STORAGE_PATH=\"/var/lib/ckan\"\nENV CKAN_SITE_URL=\"http://localhost:5000\"\n#  install requirements\nRUN yum -y install epel-release\nRUN yum -y install postgresql postgresql-contrib postgresql-devel postgis\nRUN yum -y install gcc gcc-c++ make git gdal geos\nRUN yum -y install libxml2 libxml2-devel libxslt libxslt-devel\nRUN yum -y install gdal-python python-pip python-imaging python-virtualenv libxml2-python libxslt-python python-lxml python-devel python-babel python-repoze-who python-repoze-who-plugins-sa python-repoze-who-testutil python-repoze-who-friendlyform python-tempita python-zope-interface policycoreutils-python\nRUN yum -y install postgresql wget\nRUN wget http://download.redis.io/redis-stable.tar.gz \\\n && tar xvzf redis-stable.tar.gz \\\n && pushd redis-stable \\\n && make \\\n && cp src/redis-cli /usr/local/bin/ \\\n && chmod 755 /usr/local/bin/redis-cli \\\n && popd \\\n && rm -rf ./redis-stable*\n#  upgrade python pip\nRUN pip install pip --upgrade\n#  setup ckan Directory\nRUN mkdir -p $CKAN_HOME\nRUN mkdir -p $CKAN_LOG_DIR\nRUN mkdir -p $CKAN_CONFIG\nRUN mkdir -p $CKAN_STORAGE_PATH\n#  add 'ckan' user\nRUN useradd -m -s /sbin/nologin -d \"${CKAN_HOME}\" -c \"CKAN User\" ckan\n#  add CKAN source code\nRUN mkdir -p $CKAN_HOME/src/ckan/\nADD ./ckan $CKAN_HOME/src/ckan/\n#  temporary fix for dependencies\nRUN pip install pytz diagnostics\n#  install requirements\nRUN pip install \"setuptools==36.1\"\nRUN pip install -r \"${CKAN_HOME}/src/ckan/requirements.txt\"\n#  install CKAN\nRUN pip install -e \"${CKAN_HOME}/src/ckan\"\n#  Add ckan.ini configuration file\nADD ./ckan.ini $CKAN_CONFIG\nRUN chmod 777 $CKAN_CONFIG/ckan.ini\n#  DCATAPIT theme to group mapping file\nADD ./data/config/theme_to_group.ini $CKAN_CONFIG\nRUN chmod 666 $CKAN_CONFIG/theme_to_group.ini\n#  CKAN group to DCATAPIT theme mapping file\nADD ./data/config/topics.json $CKAN_CONFIG\nRUN chmod 666 $CKAN_CONFIG/topics.json\n#  Copy various data and initialization files\nRUN mkdir $CKAN_HOME/data/\nADD ./data $CKAN_HOME/data/\n#  Link to who.ini\nRUN ln -s ${CKAN_HOME}/src/ckan/ckan/config/who.ini ${CKAN_CONFIG}/who.ini\n#  Install ckanext-harvest\nRUN mkdir $CKAN_HOME/src/ckanext-harvest/\nADD ./ckanext-harvest/ $CKAN_HOME/src/ckanext-harvest/\nRUN pip install -e $CKAN_HOME/src/ckanext-harvest/\nRUN pip install -r $CKAN_HOME/src/ckanext-harvest/pip-requirements.txt\nRUN pip install -r $CKAN_HOME/src/ckanext-harvest/dev-requirements.txt\n# # Install ckanext-dcat\nRUN mkdir $CKAN_HOME/src/ckanext-dcat/\nADD ./ckanext-dcat/ $CKAN_HOME/src/ckanext-dcat/\nRUN pip install -e $CKAN_HOME/src/ckanext-dcat/\nRUN pip install -r $CKAN_HOME/src/ckanext-dcat/requirements.txt\n# # Install ckanext-dcatapit\nRUN mkdir $CKAN_HOME/src/ckanext-dcatapit/\nADD ./ckanext-dcatapit/ $CKAN_HOME/src/ckanext-dcatapit/\nRUN pip install -e $CKAN_HOME/src/ckanext-dcatapit/\nRUN pip install -r $CKAN_HOME/src/ckanext-dcatapit/dev-requirements.txt\n# # Install ckanext-spatial\nRUN mkdir $CKAN_HOME/src/ckanext-spatial/\nADD ./ckanext-spatial/ $CKAN_HOME/src/ckanext-spatial/\nRUN pip install -e $CKAN_HOME/src/ckanext-spatial/\nRUN pip install -r $CKAN_HOME/src/ckanext-spatial/pip-requirements.txt\n# # Install ckanext-spatial\nRUN mkdir $CKAN_HOME/src/ckanext-multilang/\nADD ./ckanext-multilang/ $CKAN_HOME/src/ckanext-multilang/\nRUN pip install -e $CKAN_HOME/src/ckanext-multilang/\nRUN chown ckan:ckan \"${CKAN_HOME}\" -R \\\n && chown ckan:ckan \"${CKAN_CONFIG}\" -R \\\n && chown ckan:ckan \"${CKAN_LOG_DIR}\" -R \\\n && chown ckan:ckan \"${CKAN_STORAGE_PATH}\" -R\nRUN chmod 755 \"${CKAN_HOME}\" -R \\\n && chmod 755 \"${CKAN_CONFIG}\" -R \\\n && chmod 755 \"${CKAN_LOG_DIR}\" -R \\\n && chmod 755 \"${CKAN_STORAGE_PATH}\" -R\n#  SetUp EntryPoint \nCOPY ./ckan-entrypoint.sh /\nRUN chmod +x /ckan-entrypoint.sh\nENTRYPOINT [\"/ckan-entrypoint.sh\"]\n#  Add startup scripts\nADD ./ckan-init.sh ./ckan-harvest-init.sh /\nRUN chmod +x /ckan-init.sh /ckan-harvest-init.sh\nADD ./wait-for-services.sh /\nRUN chmod +x /wait-for-services.sh\nADD ./harvest_fetch_and_gather.sh /\nRUN chmod +x /harvest_fetch_and_gather.sh\nADD ./periodic-harvest-run.sh /\nRUN chmod +x /periodic-harvest-run.sh\nADD ./periodic-harvester-joball.sh /\nRUN chmod +x /periodic-harvester-joball.sh\n#  Volumes \nVOLUME [\"/etc/ckan/default\"]\nVOLUME [\"/var/lib/ckan\"]\nVOLUME [\"/var/log/ckan\"]\nUSER ckan\nEXPOSE 5000/tcp\nWORKDIR \"${CKAN_CONFIG}\"\nCMD [\"paster\", \"serve\", \"ckan.ini\"]\n","injectedSmells":[],"originalDockerfileHash":"56ff07d29f2a5b44f46f8c8e13904400","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  ckan + ckanext-harvest + ckanext-dcat + ckanext-dcatapit\nFROM centos:7\n#   set vars\nENV CKAN_HOME=\"/usr/lib/ckan/default\"\nENV CKAN_CONFIG=\"/etc/ckan/default\"\nENV CKAN_LOG_DIR=\"/var/log/ckan\"\nENV CKAN_STORAGE_PATH=\"/var/lib/ckan\"\nENV CKAN_SITE_URL=\"http://localhost:5000\"\n#   install requirements\nRUN yum -y install epel-release\nRUN yum -y install postgresql postgresql-contrib postgresql-devel postgis\nRUN yum -y install gcc gcc-c++ make git gdal geos\nRUN yum -y install libxml2 libxml2-devel libxslt libxslt-devel\nRUN yum -y install gdal-python python-pip python-imaging python-virtualenv libxml2-python libxslt-python python-lxml python-devel python-babel python-repoze-who python-repoze-who-plugins-sa python-repoze-who-testutil python-repoze-who-friendlyform python-tempita python-zope-interface policycoreutils-python\nRUN yum -y install postgresql wget\nRUN wget http://download.redis.io/redis-stable.tar.gz \\\n && tar xvzf redis-stable.tar.gz \\\n && pushd redis-stable \\\n && make \\\n && cp src/redis-cli /usr/local/bin/ \\\n && chmod 755 /usr/local/bin/redis-cli \\\n && popd \\\n && rm -rf ./redis-stable*\n#   upgrade python pip\nRUN pip install pip --upgrade\n#   setup ckan Directory\nRUN mkdir -p $CKAN_HOME\nRUN mkdir -p $CKAN_LOG_DIR\nRUN mkdir -p $CKAN_CONFIG\nRUN mkdir -p $CKAN_STORAGE_PATH\n#   add 'ckan' user\nRUN useradd -m -s /sbin/nologin -d \"${CKAN_HOME}\" -c \"CKAN User\" ckan\n#   add CKAN source code\nRUN mkdir -p $CKAN_HOME/src/ckan/\nADD ./ckan $CKAN_HOME/src/ckan/\n#   temporary fix for dependencies\nRUN pip install pytz diagnostics\n#   install requirements\nRUN pip install \"setuptools==36.1\"\nRUN pip install -r \"${CKAN_HOME}/src/ckan/requirements.txt\"\n#   install CKAN\nRUN pip install -e \"${CKAN_HOME}/src/ckan\"\n#   Add ckan.ini configuration file\nADD ./ckan.ini $CKAN_CONFIG\nRUN chmod 777 $CKAN_CONFIG/ckan.ini\n#   DCATAPIT theme to group mapping file\nADD ./data/config/theme_to_group.ini $CKAN_CONFIG\nRUN chmod 666 $CKAN_CONFIG/theme_to_group.ini\n#   CKAN group to DCATAPIT theme mapping file\nADD ./data/config/topics.json $CKAN_CONFIG\nRUN chmod 666 $CKAN_CONFIG/topics.json\n#   Copy various data and initialization files\nRUN mkdir $CKAN_HOME/data/\nADD ./data $CKAN_HOME/data/\n#   Link to who.ini\nRUN ln -s ${CKAN_HOME}/src/ckan/ckan/config/who.ini ${CKAN_CONFIG}/who.ini\n#   Install ckanext-harvest\nRUN mkdir $CKAN_HOME/src/ckanext-harvest/\nADD ./ckanext-harvest/ $CKAN_HOME/src/ckanext-harvest/\nRUN pip install -e $CKAN_HOME/src/ckanext-harvest/\nRUN pip install -r $CKAN_HOME/src/ckanext-harvest/pip-requirements.txt\nRUN pip install -r $CKAN_HOME/src/ckanext-harvest/dev-requirements.txt\n#  # Install ckanext-dcat\nRUN mkdir $CKAN_HOME/src/ckanext-dcat/\nADD ./ckanext-dcat/ $CKAN_HOME/src/ckanext-dcat/\nRUN pip install -e $CKAN_HOME/src/ckanext-dcat/\nRUN pip install -r $CKAN_HOME/src/ckanext-dcat/requirements.txt\n#  # Install ckanext-dcatapit\nRUN mkdir $CKAN_HOME/src/ckanext-dcatapit/\nADD ./ckanext-dcatapit/ $CKAN_HOME/src/ckanext-dcatapit/\nRUN pip install -e $CKAN_HOME/src/ckanext-dcatapit/\nRUN pip install -r $CKAN_HOME/src/ckanext-dcatapit/dev-requirements.txt\n#  # Install ckanext-spatial\nRUN mkdir $CKAN_HOME/src/ckanext-spatial/\nADD ./ckanext-spatial/ $CKAN_HOME/src/ckanext-spatial/\nRUN pip install -e $CKAN_HOME/src/ckanext-spatial/\nRUN pip install -r $CKAN_HOME/src/ckanext-spatial/pip-requirements.txt\n#  # Install ckanext-spatial\nRUN mkdir $CKAN_HOME/src/ckanext-multilang/\nADD ./ckanext-multilang/ $CKAN_HOME/src/ckanext-multilang/\nRUN pip install -e $CKAN_HOME/src/ckanext-multilang/\nRUN chown ckan:ckan \"${CKAN_HOME}\" -R \\\n && chown ckan:ckan \"${CKAN_CONFIG}\" -R \\\n && chown ckan:ckan \"${CKAN_LOG_DIR}\" -R \\\n && chown ckan:ckan \"${CKAN_STORAGE_PATH}\" -R\nRUN chmod 755 \"${CKAN_HOME}\" -R \\\n && chmod 755 \"${CKAN_CONFIG}\" -R \\\n && chmod 755 \"${CKAN_LOG_DIR}\" -R \\\n && chmod 755 \"${CKAN_STORAGE_PATH}\" -R\n#   SetUp EntryPoint \nCOPY ./ckan-entrypoint.sh /\nRUN chmod +x /ckan-entrypoint.sh\nENTRYPOINT [\"/ckan-entrypoint.sh\"]\n#   Add startup scripts\nADD ./ckan-init.sh ./ckan-harvest-init.sh /\nRUN chmod +x /ckan-init.sh /ckan-harvest-init.sh\nADD ./wait-for-services.sh /\nRUN chmod +x /wait-for-services.sh\nADD ./harvest_fetch_and_gather.sh /\nRUN chmod +x /harvest_fetch_and_gather.sh\nADD ./periodic-harvest-run.sh /\nRUN chmod +x /periodic-harvest-run.sh\nADD ./periodic-harvester-joball.sh /\nRUN chmod +x /periodic-harvester-joball.sh\n#   Volumes \nVOLUME [\"/etc/ckan/default\"]\nVOLUME [\"/var/lib/ckan\"]\nVOLUME [\"/var/log/ckan\"]\nUSER ckan\nEXPOSE 5000/tcp\nWORKDIR \"${CKAN_CONFIG}\"\nCMD [\"paster\", \"serve\", \"ckan.ini\"]\n","originalDockerfileUglifiedHash":"3a637bf29d4ff6c3191536f113f14f72","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/66651f6eeafcb0c6f98dcf8fa509f3e4819ebd42.dockerfile"}