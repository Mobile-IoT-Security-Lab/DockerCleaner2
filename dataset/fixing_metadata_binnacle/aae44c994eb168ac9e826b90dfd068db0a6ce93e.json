{"seed":529135786,"processedDockerfileHash":"73ddee6b66fd5c52d90816f88bb001ae","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM ubuntu:14.04\nMAINTAINER Jan Nonnen <helvalius@gmail.com>\n#   Define the OSM argument, use monaco as default\nARG OSM=http://download.geofabrik.de/europe/monaco-latest.osm.pbf\nRUN :\n#   Install basic software\nRUN (apt-get update ;apt-get install --no-install-recommends wget=1.15-1ubuntu1.14.04.5 -y )\n#   Note: libgeos++-dev is included here too (the nominatim install page suggests installing it if there is a problem with the 'pear install DB' below - it seems safe to install it anyway)\nRUN (apt-get update ;apt-get install --no-install-recommends build-essential=11.6ubuntu6 gcc=4:4.8.2-1ubuntu6 git=1:1.9.1-1ubuntu0.10 osmosis=0.40.1+ds1-7 libxml2-dev=2.9.1+dfsg1-3ubuntu4.13 libgeos-dev=3.4.2-4ubuntu1 libpq-dev=9.3.24-0ubuntu0.14.04 libbz2-dev=1.0.6-5 libtool=2.4.2-1.7ubuntu1 cmake=2.8.12.2-0ubuntu3 libproj-dev=4.8.0-2ubuntu2 proj-bin=4.8.0-2ubuntu2 libgeos-c1=3.4.2-4ubuntu1 libgeos++-dev=3.4.2-4ubuntu1 libexpat1-dev=2.1.0-4ubuntu1.4 -y )\n#   Install Boost (required by osm2pqsql)\nRUN (apt-get update ;apt-get install --no-install-recommends autoconf=2.69-6 make=3.81-8.2ubuntu3 g++=4:4.8.2-1ubuntu6 libboost-dev=1.54.0.1ubuntu1 libboost-system-dev=1.54.0.1ubuntu1 libboost-filesystem-dev=1.54.0.1ubuntu1 libboost-thread-dev=1.54.0.1ubuntu1 lua5.2=5.2.3-1 liblua5.2-dev=5.2.3-1 -y )\n#   Install PHP5\nRUN (apt-get update ;apt-get install --no-install-recommends php5=5.5.9+dfsg-1ubuntu4.29 php-pear=5.5.9+dfsg-1ubuntu4.29 php5-pgsql=5.5.9+dfsg-1ubuntu4.29 php5-json=1.3.2-2build1 php-db=1.7.14-2 -y )\n#   From the website \"If you plan to install the source from github, the following additional packages are needed:\"\n#   RUN apt-get -y install git autoconf-archive\n#   Install Postgres, PostGIS and dependencies\nRUN (apt-get update ;apt-get install --no-install-recommends postgresql=9.3+154ubuntu1.1 postgis=2.1.2+dfsg-2ubuntu0.2 postgresql-contrib=9.3+154ubuntu1.1 postgresql-9.3-postgis-2.1=2.1.2+dfsg-2ubuntu0.2 postgresql-server-dev-9.3=9.3.24-0ubuntu0.14.04 -y )\n#   Work around for AUFS bug as per https://github.com/docker/docker/issues/783#issuecomment-56013588\nRUN mkdir /etc/ssl/private-copy ; mv /etc/ssl/private/* /etc/ssl/private-copy/ ; rm -r /etc/ssl/private ; mv /etc/ssl/private-copy /etc/ssl/private ; chmod -R 0700 /etc/ssl/private ; chown -R postgres /etc/ssl/private\n#   Some additional packages that may not already be installed\n#   bc is needed in configPostgresql.sh\nRUN (apt-get update ;apt-get install --no-install-recommends bc=1.06.95-8ubuntu1 -y )\n#   Install Apache\nRUN (apt-get update ;apt-get install --no-install-recommends apache2=2.4.7-1ubuntu4.22 -y )\n#   Add Protobuf support\nRUN (apt-get update ;apt-get install --no-install-recommends libprotobuf-c0-dev=0.15-1build1 protobuf-c-compiler=0.15-1build1 -y )\nRUN (apt-get update ;apt-get install --no-install-recommends sudo=1.8.9p5-1ubuntu1.4 -y )\n#\nRUN pear install DB\nRUN useradd -m -p password1234 nominatim\nRUN mkdir -p /app/git/\nRUN git clone --recursive https://github.com/twain47/Nominatim.git /app/git/\nRUN mkdir -p /app/nominatim\nWORKDIR /app/nominatim\nRUN cmake /app/git/\nRUN make\n#   Configure postgresql\nRUN service postgresql start \\\n && pg_dropcluster --stop 9.3 main\nRUN service postgresql start \\\n && pg_createcluster --start -e UTF-8 9.3 main\nRUN sudo -u postgres /usr/lib/postgresql/9.3/bin/pg_ctl start -w -D /etc/postgresql/9.3/main/ \\\n && cat /var/log/postgresql/postgresql-9.3-main.log \\\n && sudo -u postgres psql postgres -tAc \"SELECT 1 FROM pg_roles WHERE rolname='nominatim'\" | grep -q 1 || sudo -u postgres createuser -s nominatim \\\n && sudo -u postgres psql postgres -tAc \"SELECT 1 FROM pg_roles WHERE rolname='www-data'\" | grep -q 1 || sudo -u postgres createuser -SDR www-data \\\n && sudo -u postgres psql postgres -c \"DROP DATABASE IF EXISTS nominatim\"\nRUN wget --output-document=/app/data.pbf $OSM\n#   RUN wget --output-document=/app/data.pbf http://download.geofabrik.de/europe/luxembourg-latest.osm.pbf\n#   RUN wget --output-document=/app/data.pbf http://download.geofabrik.de/north-america-latest.osm.pbf\n#   RUN wget --output-document=/app/data.pbf http://download.geofabrik.de/north-america/us/delaware-latest.osm.pbf\nWORKDIR /app/nominatim\nCOPY local.php /app/nominatim/settings/local.php\nRUN ./utils/setup.php --help\nRUN chown -R nominatim:nominatim /app/nominatim\nRUN sudo -u postgres /usr/lib/postgresql/9.3/bin/pg_ctl start -w -D /etc/postgresql/9.3/main/ \\\n && sudo -u nominatim ./utils/setup.php --osm-file /app/data.pbf --all --threads 2\nRUN mkdir -p /var/www/nominatim\nRUN cp -R /app/nominatim/website /var/www/nominatim/\nRUN cp -R /app/nominatim/settings /var/www/nominatim/\nRUN chown -R nominatim:www-data /var/www/nominatim\n#   Adjust PostgreSQL configuration so that remote connections to the\n#   database are possible.\nRUN echo \"host all all 0.0.0.0/0 trust\" >> /etc/postgresql/9.3/main/pg_hba.conf\n#   And add ``listen_addresses`` to ``/etc/postgresql/9.3/main/postgresql.conf``\nRUN echo \"listen_addresses='*'\" >> /etc/postgresql/9.3/main/postgresql.conf\n#   Expose the PostgreSQL port\nEXPOSE 5432/tcp\nRUN (apt-get update ;apt-get install --no-install-recommends curl=7.35.0-1ubuntu2.20 -y )\nCOPY 400-nominatim.conf /etc/apache2/sites-available/400-nominatim.conf\nRUN service apache2 start \\\n && a2ensite 400-nominatim.conf \\\n && /etc/init.d/apache2 reload\n#   Expose the HTTP port\nEXPOSE 8080/tcp\nCOPY configPostgresql.sh /app/nominatim/configPostgresql.sh\nWORKDIR /app/nominatim\nRUN chmod +x ./configPostgresql.sh\nCOPY start.sh /app/nominatim/start.sh\nRUN chmod +x /app/nominatim/start.sh\nRUN echo \"Using OSM URL: \"$OSM\nCMD /app/nominatim/start.sh\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ubuntu:14.04\nMAINTAINER Jan Nonnen <helvalius@gmail.com>\n#  Define the OSM argument, use monaco as default\nARG OSM=http://download.geofabrik.de/europe/monaco-latest.osm.pbf\nRUN apt-get update\n#  Install basic software\nRUN apt-get install wget -y\n#  Note: libgeos++-dev is included here too (the nominatim install page suggests installing it if there is a problem with the 'pear install DB' below - it seems safe to install it anyway)\nRUN apt-get install build-essential gcc git osmosis libxml2-dev libgeos-dev libpq-dev libbz2-dev libtool cmake libproj-dev proj-bin libgeos-c1 libgeos++-dev libexpat1-dev -y\n#  Install Boost (required by osm2pqsql)\nRUN apt-get install autoconf make g++ libboost-dev libboost-system-dev libboost-filesystem-dev libboost-thread-dev lua5.2 liblua5.2-dev -y\n#  Install PHP5\nRUN apt-get install php5 php-pear php5-pgsql php5-json php-db -y\n#  From the website \"If you plan to install the source from github, the following additional packages are needed:\"\n#  RUN apt-get -y install git autoconf-archive\n#  Install Postgres, PostGIS and dependencies\nRUN apt-get install postgresql postgis postgresql-contrib postgresql-9.3-postgis-2.1 postgresql-server-dev-9.3 -y\n#  Work around for AUFS bug as per https://github.com/docker/docker/issues/783#issuecomment-56013588\nRUN mkdir /etc/ssl/private-copy ; mv /etc/ssl/private/* /etc/ssl/private-copy/ ; rm -r /etc/ssl/private ; mv /etc/ssl/private-copy /etc/ssl/private ; chmod -R 0700 /etc/ssl/private ; chown -R postgres /etc/ssl/private\n#  Some additional packages that may not already be installed\n#  bc is needed in configPostgresql.sh\nRUN apt-get install bc -y\n#  Install Apache\nRUN apt-get install apache2 -y\n#  Add Protobuf support\nRUN apt-get install libprotobuf-c0-dev protobuf-c-compiler -y\nRUN apt-get install sudo -y\n#\nRUN pear install DB\nRUN useradd -m -p password1234 nominatim\nRUN mkdir -p /app/git/\nRUN git clone --recursive https://github.com/twain47/Nominatim.git /app/git/\nRUN mkdir -p /app/nominatim\nWORKDIR /app/nominatim\nRUN cmake /app/git/\nRUN make\n#  Configure postgresql\nRUN service postgresql start \\\n && pg_dropcluster --stop 9.3 main\nRUN service postgresql start \\\n && pg_createcluster --start -e UTF-8 9.3 main\nRUN sudo -u postgres /usr/lib/postgresql/9.3/bin/pg_ctl start -w -D /etc/postgresql/9.3/main/ \\\n && cat /var/log/postgresql/postgresql-9.3-main.log \\\n && sudo -u postgres psql postgres -tAc \"SELECT 1 FROM pg_roles WHERE rolname='nominatim'\" | grep -q 1 || sudo -u postgres createuser -s nominatim \\\n && sudo -u postgres psql postgres -tAc \"SELECT 1 FROM pg_roles WHERE rolname='www-data'\" | grep -q 1 || sudo -u postgres createuser -SDR www-data \\\n && sudo -u postgres psql postgres -c \"DROP DATABASE IF EXISTS nominatim\"\nRUN wget --output-document=/app/data.pbf $OSM\n#  RUN wget --output-document=/app/data.pbf http://download.geofabrik.de/europe/luxembourg-latest.osm.pbf\n#  RUN wget --output-document=/app/data.pbf http://download.geofabrik.de/north-america-latest.osm.pbf\n#  RUN wget --output-document=/app/data.pbf http://download.geofabrik.de/north-america/us/delaware-latest.osm.pbf\nWORKDIR /app/nominatim\nADD local.php /app/nominatim/settings/local.php\nRUN ./utils/setup.php --help\nRUN chown -R nominatim:nominatim /app/nominatim\nRUN sudo -u postgres /usr/lib/postgresql/9.3/bin/pg_ctl start -w -D /etc/postgresql/9.3/main/ \\\n && sudo -u nominatim ./utils/setup.php --osm-file /app/data.pbf --all --threads 2\nRUN mkdir -p /var/www/nominatim\nRUN cp -R /app/nominatim/website /var/www/nominatim/\nRUN cp -R /app/nominatim/settings /var/www/nominatim/\nRUN chown -R nominatim:www-data /var/www/nominatim\n#  Adjust PostgreSQL configuration so that remote connections to the\n#  database are possible.\nRUN echo \"host all all 0.0.0.0/0 trust\" >> /etc/postgresql/9.3/main/pg_hba.conf\n#  And add ``listen_addresses`` to ``/etc/postgresql/9.3/main/postgresql.conf``\nRUN echo \"listen_addresses='*'\" >> /etc/postgresql/9.3/main/postgresql.conf\n#  Expose the PostgreSQL port\nEXPOSE 5432/tcp\nRUN apt-get install curl -y\nADD 400-nominatim.conf /etc/apache2/sites-available/400-nominatim.conf\nRUN service apache2 start \\\n && a2ensite 400-nominatim.conf \\\n && /etc/init.d/apache2 reload\n#  Expose the HTTP port\nEXPOSE 8080/tcp\nADD configPostgresql.sh /app/nominatim/configPostgresql.sh\nWORKDIR /app/nominatim\nRUN chmod +x ./configPostgresql.sh\nADD start.sh /app/nominatim/start.sh\nRUN chmod +x /app/nominatim/start.sh\nRUN echo \"Using OSM URL: \"$OSM\nCMD /app/nominatim/start.sh\n","injectedSmells":[],"originalDockerfileHash":"c2ad8a8c9518b1d8c93de0a81f89f8aa","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:14.04\nMAINTAINER Jan Nonnen <helvalius@gmail.com>\n#   Define the OSM argument, use monaco as default\nARG OSM=http://download.geofabrik.de/europe/monaco-latest.osm.pbf\nRUN apt-get update\n#   Install basic software\nRUN apt-get install wget -y\n#   Note: libgeos++-dev is included here too (the nominatim install page suggests installing it if there is a problem with the 'pear install DB' below - it seems safe to install it anyway)\nRUN apt-get install build-essential gcc git osmosis libxml2-dev libgeos-dev libpq-dev libbz2-dev libtool cmake libproj-dev proj-bin libgeos-c1 libgeos++-dev libexpat1-dev -y\n#   Install Boost (required by osm2pqsql)\nRUN apt-get install autoconf make g++ libboost-dev libboost-system-dev libboost-filesystem-dev libboost-thread-dev lua5.2 liblua5.2-dev -y\n#   Install PHP5\nRUN apt-get install php5 php-pear php5-pgsql php5-json php-db -y\n#   From the website \"If you plan to install the source from github, the following additional packages are needed:\"\n#   RUN apt-get -y install git autoconf-archive\n#   Install Postgres, PostGIS and dependencies\nRUN apt-get install postgresql postgis postgresql-contrib postgresql-9.3-postgis-2.1 postgresql-server-dev-9.3 -y\n#   Work around for AUFS bug as per https://github.com/docker/docker/issues/783#issuecomment-56013588\nRUN mkdir /etc/ssl/private-copy ; mv /etc/ssl/private/* /etc/ssl/private-copy/ ; rm -r /etc/ssl/private ; mv /etc/ssl/private-copy /etc/ssl/private ; chmod -R 0700 /etc/ssl/private ; chown -R postgres /etc/ssl/private\n#   Some additional packages that may not already be installed\n#   bc is needed in configPostgresql.sh\nRUN apt-get install bc -y\n#   Install Apache\nRUN apt-get install apache2 -y\n#   Add Protobuf support\nRUN apt-get install libprotobuf-c0-dev protobuf-c-compiler -y\nRUN apt-get install sudo -y\n#\nRUN pear install DB\nRUN useradd -m -p password1234 nominatim\nRUN mkdir -p /app/git/\nRUN git clone --recursive https://github.com/twain47/Nominatim.git /app/git/\nRUN mkdir -p /app/nominatim\nWORKDIR /app/nominatim\nRUN cmake /app/git/\nRUN make\n#   Configure postgresql\nRUN service postgresql start \\\n && pg_dropcluster --stop 9.3 main\nRUN service postgresql start \\\n && pg_createcluster --start -e UTF-8 9.3 main\nRUN sudo -u postgres /usr/lib/postgresql/9.3/bin/pg_ctl start -w -D /etc/postgresql/9.3/main/ \\\n && cat /var/log/postgresql/postgresql-9.3-main.log \\\n && sudo -u postgres psql postgres -tAc \"SELECT 1 FROM pg_roles WHERE rolname='nominatim'\" | grep -q 1 || sudo -u postgres createuser -s nominatim \\\n && sudo -u postgres psql postgres -tAc \"SELECT 1 FROM pg_roles WHERE rolname='www-data'\" | grep -q 1 || sudo -u postgres createuser -SDR www-data \\\n && sudo -u postgres psql postgres -c \"DROP DATABASE IF EXISTS nominatim\"\nRUN wget --output-document=/app/data.pbf $OSM\n#   RUN wget --output-document=/app/data.pbf http://download.geofabrik.de/europe/luxembourg-latest.osm.pbf\n#   RUN wget --output-document=/app/data.pbf http://download.geofabrik.de/north-america-latest.osm.pbf\n#   RUN wget --output-document=/app/data.pbf http://download.geofabrik.de/north-america/us/delaware-latest.osm.pbf\nWORKDIR /app/nominatim\nADD local.php /app/nominatim/settings/local.php\nRUN ./utils/setup.php --help\nRUN chown -R nominatim:nominatim /app/nominatim\nRUN sudo -u postgres /usr/lib/postgresql/9.3/bin/pg_ctl start -w -D /etc/postgresql/9.3/main/ \\\n && sudo -u nominatim ./utils/setup.php --osm-file /app/data.pbf --all --threads 2\nRUN mkdir -p /var/www/nominatim\nRUN cp -R /app/nominatim/website /var/www/nominatim/\nRUN cp -R /app/nominatim/settings /var/www/nominatim/\nRUN chown -R nominatim:www-data /var/www/nominatim\n#   Adjust PostgreSQL configuration so that remote connections to the\n#   database are possible.\nRUN echo \"host all all 0.0.0.0/0 trust\" >> /etc/postgresql/9.3/main/pg_hba.conf\n#   And add ``listen_addresses`` to ``/etc/postgresql/9.3/main/postgresql.conf``\nRUN echo \"listen_addresses='*'\" >> /etc/postgresql/9.3/main/postgresql.conf\n#   Expose the PostgreSQL port\nEXPOSE 5432/tcp\nRUN apt-get install curl -y\nADD 400-nominatim.conf /etc/apache2/sites-available/400-nominatim.conf\nRUN service apache2 start \\\n && a2ensite 400-nominatim.conf \\\n && /etc/init.d/apache2 reload\n#   Expose the HTTP port\nEXPOSE 8080/tcp\nADD configPostgresql.sh /app/nominatim/configPostgresql.sh\nWORKDIR /app/nominatim\nRUN chmod +x ./configPostgresql.sh\nADD start.sh /app/nominatim/start.sh\nRUN chmod +x /app/nominatim/start.sh\nRUN echo \"Using OSM URL: \"$OSM\nCMD /app/nominatim/start.sh\n","originalDockerfileUglifiedHash":"61a803670193ee7ae1cdcba5a7e28c1b","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/aae44c994eb168ac9e826b90dfd068db0a6ce93e.dockerfile"}