{"seed":526430396,"processedDockerfileHash":"09c6ba08930d42573f30b85e300750f3","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"#  upstream https://github.com/nextcloud/docker\n#   DO NOT EDIT: created by update.sh from Dockerfile-alpine.template\nFROM php:7.2-fpm-alpine3.8\n#   entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apk add rsync=3.1.3-r1 --no-cache ; rm /var/spool/cron/crontabs/root ; echo '*/15 * * * * php -f /var/www/html/cron.php' > /var/spool/cron/crontabs/www-data\n#   install the PHP extensions we need\n#   see https://docs.nextcloud.com/server/12/admin_manual/installation/source_installation.html\nRUN set -ex ; apk add autoconf=2.69-r2 freetype-dev=2.9.1-r1 icu-dev=60.2-r3 libjpeg-turbo-dev=1.5.3-r6 libmcrypt-dev=2.5.8-r7 libpng-dev=1.6.37-r0 libmemcached-dev=1.0.18-r2 libxml2-dev=2.9.8-r2 openldap-dev=2.4.48-r1 pcre-dev=8.42-r0 postgresql-dev=10.12-r0 $PHPIZE_DEPS --no-cache --virtual .build-deps ; docker-php-ext-configure gd --with-freetype-dir=/usr --with-png-dir=/usr --with-jpeg-dir=/usr ; docker-php-ext-configure ldap ; docker-php-ext-install exif gd intl ldap opcache pcntl pdo_mysql pdo_pgsql zip ; pecl install APCu-5.1.12 ; pecl install memcached-3.0.4 ; pecl install redis-4.1.1 ; docker-php-ext-enable apcu memcached redis ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local/lib/php/extensions | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add $runDeps --virtual .nextcloud-phpext-rundeps ; apk del .build-deps\n#   set recommended PHP.ini settings\n#   see https://docs.nextcloud.com/server/12/admin_manual/configuration_server/server_tuning.html#enable-php-opcache\nRUN { echo 'opcache.enable=1' ;echo 'opcache.enable_cli=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidate_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; echo 'memory_limit=512M' > /usr/local/etc/php/conf.d/memory-limit.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\nENV NEXTCLOUD_VERSION=\"14.0.3\"\nRUN set -ex ; apk add bzip2=1.0.6-r7 gnupg=2.2.19-r0 --no-cache --virtual .fetch-deps ; curl -fsSL -o nextcloud.tar.bz2 \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" ; curl -fsSL -o nextcloud.tar.bz2.asc \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys 28806A878AE423A28372792ED75899B9A724937A ; gpg --batch --verify nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; tar -xjf nextcloud.tar.bz2 -C /usr/src/ ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; rm -rf /usr/src/nextcloud/updater ; mkdir -p /usr/src/nextcloud/data ; mkdir -p /usr/src/nextcloud/custom_apps ; chmod +x /usr/src/nextcloud/occ ; apk del .fetch-deps\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/nextcloud/config/\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"php-fpm\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n","originalDockerfile":"# upstream https://github.com/nextcloud/docker\n#  DO NOT EDIT: created by update.sh from Dockerfile-alpine.template\nFROM php:7.2-fpm-alpine3.8\n#  entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apk add --no-cache rsync ; rm /var/spool/cron/crontabs/root ; echo '*/15 * * * * php -f /var/www/html/cron.php' > /var/spool/cron/crontabs/www-data\n#  install the PHP extensions we need\n#  see https://docs.nextcloud.com/server/12/admin_manual/installation/source_installation.html\nRUN set -ex ; apk add --no-cache --virtual .build-deps $PHPIZE_DEPS autoconf freetype-dev icu-dev libjpeg-turbo-dev libmcrypt-dev libpng-dev libmemcached-dev libxml2-dev openldap-dev pcre-dev postgresql-dev ; docker-php-ext-configure gd --with-freetype-dir=/usr --with-png-dir=/usr --with-jpeg-dir=/usr ; docker-php-ext-configure ldap ; docker-php-ext-install exif gd intl ldap opcache pcntl pdo_mysql pdo_pgsql zip ; pecl install APCu-5.1.12 ; pecl install memcached-3.0.4 ; pecl install redis-4.1.1 ; docker-php-ext-enable apcu memcached redis ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local/lib/php/extensions | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add --virtual .nextcloud-phpext-rundeps $runDeps ; apk del .build-deps\n#  set recommended PHP.ini settings\n#  see https://docs.nextcloud.com/server/12/admin_manual/configuration_server/server_tuning.html#enable-php-opcache\nRUN { echo 'opcache.enable=1' ;echo 'opcache.enable_cli=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidate_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; echo 'memory_limit=512M' > /usr/local/etc/php/conf.d/memory-limit.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\nENV NEXTCLOUD_VERSION=\"14.0.3\"\nRUN set -ex ; apk add --no-cache --virtual .fetch-deps bzip2 gnupg ; curl -fsSL -o nextcloud.tar.bz2 \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" ; curl -fsSL -o nextcloud.tar.bz2.asc \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys 28806A878AE423A28372792ED75899B9A724937A ; gpg --batch --verify nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; tar -xjf nextcloud.tar.bz2 -C /usr/src/ ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; rm -rf /usr/src/nextcloud/updater ; mkdir -p /usr/src/nextcloud/data ; mkdir -p /usr/src/nextcloud/custom_apps ; chmod +x /usr/src/nextcloud/occ ; apk del .fetch-deps\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/nextcloud/config/\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"php-fpm\"]\n","injectedSmells":[],"originalDockerfileHash":"396282582a2da94ce5c9dbf61f60b0bc","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  upstream https://github.com/nextcloud/docker\n#   DO NOT EDIT: created by update.sh from Dockerfile-alpine.template\nFROM php:7.2-fpm-alpine3.8\n#   entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apk add --no-cache rsync ; rm /var/spool/cron/crontabs/root ; echo '*/15 * * * * php -f /var/www/html/cron.php' > /var/spool/cron/crontabs/www-data\n#   install the PHP extensions we need\n#   see https://docs.nextcloud.com/server/12/admin_manual/installation/source_installation.html\nRUN set -ex ; apk add --no-cache --virtual .build-deps $PHPIZE_DEPS autoconf freetype-dev icu-dev libjpeg-turbo-dev libmcrypt-dev libpng-dev libmemcached-dev libxml2-dev openldap-dev pcre-dev postgresql-dev ; docker-php-ext-configure gd --with-freetype-dir=/usr --with-png-dir=/usr --with-jpeg-dir=/usr ; docker-php-ext-configure ldap ; docker-php-ext-install exif gd intl ldap opcache pcntl pdo_mysql pdo_pgsql zip ; pecl install APCu-5.1.12 ; pecl install memcached-3.0.4 ; pecl install redis-4.1.1 ; docker-php-ext-enable apcu memcached redis ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local/lib/php/extensions | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add --virtual .nextcloud-phpext-rundeps $runDeps ; apk del .build-deps\n#   set recommended PHP.ini settings\n#   see https://docs.nextcloud.com/server/12/admin_manual/configuration_server/server_tuning.html#enable-php-opcache\nRUN { echo 'opcache.enable=1' ;echo 'opcache.enable_cli=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidate_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; echo 'memory_limit=512M' > /usr/local/etc/php/conf.d/memory-limit.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\nENV NEXTCLOUD_VERSION=\"14.0.3\"\nRUN set -ex ; apk add --no-cache --virtual .fetch-deps bzip2 gnupg ; curl -fsSL -o nextcloud.tar.bz2 \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" ; curl -fsSL -o nextcloud.tar.bz2.asc \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys 28806A878AE423A28372792ED75899B9A724937A ; gpg --batch --verify nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; tar -xjf nextcloud.tar.bz2 -C /usr/src/ ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; rm -rf /usr/src/nextcloud/updater ; mkdir -p /usr/src/nextcloud/data ; mkdir -p /usr/src/nextcloud/custom_apps ; chmod +x /usr/src/nextcloud/occ ; apk del .fetch-deps\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/nextcloud/config/\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"php-fpm\"]\n","originalDockerfileUglifiedHash":"2168a25b5c274cebeb70d2828a5aed7d","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/c222bfeaf1d0fd58086c03731ac44049e1211f1a.dockerfile"}