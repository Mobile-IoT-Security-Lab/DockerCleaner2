{"seed":1621336772,"processedDockerfileHash":"6f329ac7713146187cb6fb61f3107189","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["have-a-healthcheck","have-a-user"],"processedDockerfile":"#   DO NOT EDIT: created by update.sh from Dockerfile-debian.template\nFROM php:7.2-fpm-stretch\n#   entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends rsync bzip2 busybox-static -y ; rm -rf /var/lib/apt/lists/* ; mkdir -p /var/spool/cron/crontabs ; echo '*/15 * * * * php -f /var/www/html/cron.php' > /var/spool/cron/crontabs/www-data\n#   install the PHP extensions we need\n#   see https://docs.nextcloud.com/server/stable/admin_manual/installation/source_installation.html\nRUN set -ex ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends libcurl4-openssl-dev libevent-dev libfreetype6-dev libicu-dev libjpeg-dev libldap2-dev libmcrypt-dev libmemcached-dev libpng-dev libpq-dev libxml2-dev libmagickwand-dev -y ; debMultiarch=\"$( dpkg-architecture --query DEB_BUILD_MULTIARCH ;)\" ; docker-php-ext-configure gd --with-freetype-dir=/usr --with-png-dir=/usr --with-jpeg-dir=/usr ; docker-php-ext-configure ldap --with-libdir=\"lib/$debMultiarch\" ; docker-php-ext-install exif gd intl ldap opcache pcntl pdo_mysql pdo_pgsql zip ; pecl install APCu-5.1.17 ; pecl install memcached-3.1.3 ; pecl install redis-4.3.0 ; pecl install imagick-3.4.4 ; docker-php-ext-enable apcu memcached redis imagick ; apt-mark auto '.*' > /dev/null; apt-mark manual $savedAptMark ; ldd \"$( php -r 'echo ini_get(\"extension_dir\");' ;)\"/*.so | awk '/=>/ { print $3 }' | sort -u | xargs -r dpkg-query -S | cut -d: -f1 | sort -u | xargs -rt apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; rm -rf /var/lib/apt/lists/*\n#   set recommended PHP.ini settings\n#   see https://docs.nextcloud.com/server/12/admin_manual/configuration_server/server_tuning.html#enable-php-opcache\nRUN { echo 'opcache.enable=1' ;echo 'opcache.enable_cli=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidate_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; echo 'memory_limit=512M' > /usr/local/etc/php/conf.d/memory-limit.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\nENV NEXTCLOUD_VERSION=\"14.0.12\"\nRUN set -ex ; fetchDeps=\" gnupg dirmngr \" ; apt-get update ; apt-get install --no-install-recommends $fetchDeps -y ; curl -fsSL -o nextcloud.tar.bz2 \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" ; curl -fsSL -o nextcloud.tar.bz2.asc \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 28806A878AE423A28372792ED75899B9A724937A ; gpg --batch --verify nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; tar -xjf nextcloud.tar.bz2 -C /usr/src/ ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; rm -rf /usr/src/nextcloud/updater ; mkdir -p /usr/src/nextcloud/data ; mkdir -p /usr/src/nextcloud/custom_apps ; chmod +x /usr/src/nextcloud/occ ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps ; rm -rf /var/lib/apt/lists/*\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/nextcloud/config/\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"php-fpm\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n","originalDockerfile":"#  DO NOT EDIT: created by update.sh from Dockerfile-debian.template\nFROM php:7.2-fpm-stretch\n#  entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends rsync bzip2 busybox-static -y ; rm -rf /var/lib/apt/lists/* ; mkdir -p /var/spool/cron/crontabs ; echo '*/15 * * * * php -f /var/www/html/cron.php' > /var/spool/cron/crontabs/www-data\n#  install the PHP extensions we need\n#  see https://docs.nextcloud.com/server/stable/admin_manual/installation/source_installation.html\nRUN set -ex ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends libcurl4-openssl-dev libevent-dev libfreetype6-dev libicu-dev libjpeg-dev libldap2-dev libmcrypt-dev libmemcached-dev libpng-dev libpq-dev libxml2-dev libmagickwand-dev -y ; debMultiarch=\"$( dpkg-architecture --query DEB_BUILD_MULTIARCH ;)\" ; docker-php-ext-configure gd --with-freetype-dir=/usr --with-png-dir=/usr --with-jpeg-dir=/usr ; docker-php-ext-configure ldap --with-libdir=\"lib/$debMultiarch\" ; docker-php-ext-install exif gd intl ldap opcache pcntl pdo_mysql pdo_pgsql zip ; pecl install APCu-5.1.17 ; pecl install memcached-3.1.3 ; pecl install redis-4.3.0 ; pecl install imagick-3.4.4 ; docker-php-ext-enable apcu memcached redis imagick ; apt-mark auto '.*' > /dev/null; apt-mark manual $savedAptMark ; ldd \"$( php -r 'echo ini_get(\"extension_dir\");' ;)\"/*.so | awk '/=>/ { print $3 }' | sort -u | xargs -r dpkg-query -S | cut -d: -f1 | sort -u | xargs -rt apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; rm -rf /var/lib/apt/lists/*\n#  set recommended PHP.ini settings\n#  see https://docs.nextcloud.com/server/12/admin_manual/configuration_server/server_tuning.html#enable-php-opcache\nRUN { echo 'opcache.enable=1' ;echo 'opcache.enable_cli=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidate_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; echo 'memory_limit=512M' > /usr/local/etc/php/conf.d/memory-limit.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\nENV NEXTCLOUD_VERSION=\"14.0.12\"\nRUN set -ex ; fetchDeps=\" gnupg dirmngr \" ; apt-get update ; apt-get install --no-install-recommends $fetchDeps -y ; curl -fsSL -o nextcloud.tar.bz2 \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" ; curl -fsSL -o nextcloud.tar.bz2.asc \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 28806A878AE423A28372792ED75899B9A724937A ; gpg --batch --verify nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; tar -xjf nextcloud.tar.bz2 -C /usr/src/ ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; rm -rf /usr/src/nextcloud/updater ; mkdir -p /usr/src/nextcloud/data ; mkdir -p /usr/src/nextcloud/custom_apps ; chmod +x /usr/src/nextcloud/occ ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps ; rm -rf /var/lib/apt/lists/*\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/nextcloud/config/\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"php-fpm\"]\n","injectedSmells":[],"originalDockerfileHash":"882921e9f2c7d3a6d306236a60a3a2c4","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   DO NOT EDIT: created by update.sh from Dockerfile-debian.template\nFROM php:7.2-fpm-stretch\n#   entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends rsync bzip2 busybox-static -y ; rm -rf /var/lib/apt/lists/* ; mkdir -p /var/spool/cron/crontabs ; echo '*/15 * * * * php -f /var/www/html/cron.php' > /var/spool/cron/crontabs/www-data\n#   install the PHP extensions we need\n#   see https://docs.nextcloud.com/server/stable/admin_manual/installation/source_installation.html\nRUN set -ex ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends libcurl4-openssl-dev libevent-dev libfreetype6-dev libicu-dev libjpeg-dev libldap2-dev libmcrypt-dev libmemcached-dev libpng-dev libpq-dev libxml2-dev libmagickwand-dev -y ; debMultiarch=\"$( dpkg-architecture --query DEB_BUILD_MULTIARCH ;)\" ; docker-php-ext-configure gd --with-freetype-dir=/usr --with-png-dir=/usr --with-jpeg-dir=/usr ; docker-php-ext-configure ldap --with-libdir=\"lib/$debMultiarch\" ; docker-php-ext-install exif gd intl ldap opcache pcntl pdo_mysql pdo_pgsql zip ; pecl install APCu-5.1.17 ; pecl install memcached-3.1.3 ; pecl install redis-4.3.0 ; pecl install imagick-3.4.4 ; docker-php-ext-enable apcu memcached redis imagick ; apt-mark auto '.*' > /dev/null; apt-mark manual $savedAptMark ; ldd \"$( php -r 'echo ini_get(\"extension_dir\");' ;)\"/*.so | awk '/=>/ { print $3 }' | sort -u | xargs -r dpkg-query -S | cut -d: -f1 | sort -u | xargs -rt apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; rm -rf /var/lib/apt/lists/*\n#   set recommended PHP.ini settings\n#   see https://docs.nextcloud.com/server/12/admin_manual/configuration_server/server_tuning.html#enable-php-opcache\nRUN { echo 'opcache.enable=1' ;echo 'opcache.enable_cli=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidate_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; echo 'memory_limit=512M' > /usr/local/etc/php/conf.d/memory-limit.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\nENV NEXTCLOUD_VERSION=\"14.0.12\"\nRUN set -ex ; fetchDeps=\" gnupg dirmngr \" ; apt-get update ; apt-get install --no-install-recommends $fetchDeps -y ; curl -fsSL -o nextcloud.tar.bz2 \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" ; curl -fsSL -o nextcloud.tar.bz2.asc \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 28806A878AE423A28372792ED75899B9A724937A ; gpg --batch --verify nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; tar -xjf nextcloud.tar.bz2 -C /usr/src/ ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; rm -rf /usr/src/nextcloud/updater ; mkdir -p /usr/src/nextcloud/data ; mkdir -p /usr/src/nextcloud/custom_apps ; chmod +x /usr/src/nextcloud/occ ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps ; rm -rf /var/lib/apt/lists/*\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/nextcloud/config/\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"php-fpm\"]\n","originalDockerfileUglifiedHash":"5706782b209cc866c6ebca81a5c8d507","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/c8f8d01bd8804a4ca9a8ec2b728a54272383e3ee.dockerfile"}