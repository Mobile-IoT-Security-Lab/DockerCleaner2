{"seed":1043358042,"processedDockerfileHash":"754e868eb55d22e8368e18d82b0d39d5","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","have-a-healthcheck","have-a-user"],"processedDockerfile":"#  This image runs Cape :\n#   You can run cape in 3 different modes :\n#   * Standalone :    docker run ...\n#   * As a Master,Scheduler and Worker(s):\n#     * Master:       docker run ...\n#     * Scheduler:    docker run ...\n#     * Worker(s):    docker run ...\nFROM ubuntu:18.04\nRUN apt-get update -y \\\n && apt-get install --no-install-recommends python-dev=2.7.15~rc1-1 python3-dev=3.6.7-1~18.04 python3-pip=9.0.1-2.3~ubuntu1.18.04.8 git=1:2.17.1-1ubuntu0.17 zlib1g-dev=1:1.2.11.dfsg-0ubuntu2.2 apt-transport-https=1.6.14 ca-certificates=20211016ubuntu0.18.04.1 wget=1.19.4-1ubuntu2.2 build-essential=12.4ubuntu1 libcurl4-openssl-dev=7.58.0-2ubuntu3.24 g++=4:7.4.0-1ubuntu2.3 htop=2.1.0-3 nano=2.9.3-2 parallel=20161222-1 curl=7.58.0-2ubuntu3.24 locales=2.27-3ubuntu1.6 daemontools=1:0.76-6.1 unzip=6.0-21ubuntu1.2 python3-distutils=3.6.9-1~18.04 -y \\\n && apt-get clean\nRUN pip3 install --upgrade pip setuptools dumb-init ipython\n#   Ensure that we always use UTF-8 and with US English locale\nRUN locale-gen en_US.UTF-8\nENV LC_ALL=\"en_US.UTF-8\"\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US.UTF-8\"\nENV PYTHONIOENCODING=\"utf-8\"\n#  Add non-root user to run app\nRUN useradd -G users -m runner\nWORKDIR /mnt/\n#  Argument to rebuild from this point after an update\nARG COMMIT_SHA1=1\nRUN pip3 install -vv --process-dependency-links --upgrade git+https://github.com/bloomsburyai/cape-frontend\nRUN pip3 install -vv --process-dependency-links --upgrade git+https://github.com/bloomsburyai/cape-webservices\n#  Run model tests to automatically download latest standard production model\nRUN pytest -vs --pyargs cape_document_qa.tests\nEXPOSE 5050/tcp\nEXPOSE 5051/tcp\n#  Default configuration\nENV PORT=\"5050\"\nENV FRONTEND_PORT=\"5051\"\nENTRYPOINT [\"/usr/local/bin/dumb-init\", \"--\"]\n#  #######################################\n#  # CAPE DEFAULT ENVIRONMENT VARIABLES ##\n#  #######################################\n#   cape-webservices Environment variables:\n#  ENV CAPE_WEBSERVICE_HOST 0.0.0.0\n#  ENV CAPE_WEBSERVICE_PORT 5050\n#   Max request size will be 100 megabytes\n#  ENV CAPE_WEBSERVICE_REQUEST_MAX_SIZE 100000000\n#   request timeout is 10 mins\n#  ENV CAPE_WEBSERVICE_REQUEST_TIMEOUT 600\n#   graceful shutdown times out in 3 seconds\n#  ENV CAPE_WEBSERVICE_GRACEFUL_SHUTDOWN_TIMEOUT 3\n#   Websocket max size is 1 MB\n#  ENV CAPE_WEBSERVICE_WEBSOCKET_MAX_SIZE 1000000\n#  ENV CAPE_WEBSERVICE_WEBSOCKET_MAX_QUEUE 32\n#  ENV CAPE_WEBSERVICE_MAX_NUM_ANSWERS 50\n#  ENV CAPE_HOSTNAME DEV_SERVER\n#   max size of inline text will be 150000 characters:\n#  ENV CAPE_WEBSERVICE_MAX_SIZE_INLINE_TEXT 150000\n#   cape-responder Environment variables:\n#  ENV CAPE_CLUSTER_SCHEDULER_IP 127.0.0.1\n#  ENV CAPE_CLUSTER_SCHEDULER_PORT 8786\n#  ENV CAPE_NUM_WORKERS_PER_REQUEST 8\n#   cape-document-qa Environment variables:\n#  ENV CAPE_MODELS_FOLDER os.path.join(THIS_FOLDER, 'storage', 'models')\n#  ENV CAPE_MODEL_FOLDER os.path.join(MODELS_FOLDER, 'production_ready_model')\n#  ENV CAPE_MODEL_URL https://github.com/bloomsburyai/cape-document-qa/releases/download/v0.1.2/production_ready_model.tar.xz\n#  ENV CAPE_MODEL_MB_SIZE 422\n#  ENV DOWNLOAD_ALL_GLOVE_EMBEDDINGS False\n#  ENV CAPE_GLOVE_EMBEDDINGS_URL https://nlp.stanford.edu/data/glove.840B.300d.zip\n#  ENV CAPE_LM_URL https://github.com/bloogram/cape-document-qa/releases/download/v0.1.2/lm.tar.bz2\n#   cape-document-manager Environment variables:\n#\n#  ENV CAPE_SPLITTER_WORDS_PER_CHUNK 500\n#  ENV CAPE_SPLITTER_WORDS_OVERLAP_BEFORE 50\n#  ENV CAPE_SPLITTER_WORDS_OVERLAP_AFTER 50\n#  ENV CAPE_LOCAL_UNPICKLING_LRU_CACHE_MAX_SIZE 50000\n#  ENV CAPE_SQLITE_PATH os.path.join(THIS_FOLDER, 'storage', 'bla.sqlite')\n#  ENV CAPE_SQLITE_JOURNAL_MODE wal\n#    cache size in kibibytes (64 megibytes)\n#  ENV CAPE_SQLITE_CACHE_SIZE -65536\n#   cape-userdb Environment variables:\n#   ENV CAPE_USERDB_SQLITE_PATH os.path.join(THIS_FOLDER, 'storage', 'capeusers.sqlite'))\n#   cape-api-helpers Environment variables:\n#  ENV CAPE_SECRET_DEBUG_KEYWORD debug7373\n#  ENV CAPE_SECRET_EXTRA_INFO_KEYWORD trail8hef89\n#   cape-slack-plugin Environment variables:\n#  ENV CAPE_SLACK_CLIENT_ID REPLACEME\n#  ENV CAPE_SLACK_CLIENT_SECRET REPLACEME\n#  ENV CAPE_SLACK_VERIFICATION REPLACEME\n#  ENV CAPE_SLACK_APP_URL REPLACEME\n#   cape-facebook-plugin Environment variables:\n#  ENV CAPE_FACEBOOK_VERIFICATION REPLACEME\n#   cape-hangouts-plugin Environment variables:\n#  ENV CAPE_HANGOUTS_VERIFICATION REPLACEME\n#   cape-email-plugin Environment variables:\n#\n#  ENV CAPE_MAILGUN_API_KEY REPLACEME\n#  ENV CAPE_MAILGUN_DOMAIN REPLACEME\n#  ENV CAPE_DEFAULT_EMAIL REPLACEME\n#   cape-frontend Environment variables:\n#  ENV CAPE_FRONTEND_CREATE_DEMO_ACCOUNT_ON_INIT True\n#  ENV CAPE_FRONTEND_WAIT_FOR_BACKENDS True\n#  ENV CAPE_FRONTEND_ACTIVATE_NGROK_LINUX True\nCMD [\"bash\", \"-c\", \"python3\", \"-m\", \"cape_webservices.run\", \"$PORT\", \"&;\", \"python3\", \"-m\", \"cape_frontend.run\", \"$FRONTEND_PORT\"]\n#  docker stop my_service;docker rm my_service;docker build -t my_service_image -f deployment/Dockerfile . && docker run -ti --ulimit core=0:0 --user runner --rm -v $(pwd)/..:/mnt --name my_service my_service_image\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# This image runs Cape :\n#  You can run cape in 3 different modes :\n#  * Standalone :    docker run ...\n#  * As a Master,Scheduler and Worker(s):\n#    * Master:       docker run ...\n#    * Scheduler:    docker run ...\n#    * Worker(s):    docker run ...\nFROM ubuntu:18.04\nRUN apt-get update -y \\\n && apt-get install python-dev python3-dev python3-pip git zlib1g-dev apt-transport-https ca-certificates wget build-essential libcurl4-openssl-dev g++ htop nano parallel curl locales daemontools unzip python3-distutils -y \\\n && apt-get clean\nRUN pip3 install --upgrade pip setuptools dumb-init ipython\n#  Ensure that we always use UTF-8 and with US English locale\nRUN locale-gen en_US.UTF-8\nENV LC_ALL=\"en_US.UTF-8\"\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US.UTF-8\"\nENV PYTHONIOENCODING=\"utf-8\"\n# Add non-root user to run app\nRUN useradd -G users -m runner\nWORKDIR /mnt/\n# Argument to rebuild from this point after an update\nARG COMMIT_SHA1=1\nRUN pip3 install -vv --process-dependency-links --upgrade git+https://github.com/bloomsburyai/cape-frontend\nRUN pip3 install -vv --process-dependency-links --upgrade git+https://github.com/bloomsburyai/cape-webservices\n# Run model tests to automatically download latest standard production model\nRUN pytest -vs --pyargs cape_document_qa.tests\nEXPOSE 5050/tcp\nEXPOSE 5051/tcp\n# Default configuration\nENV PORT=\"5050\"\nENV FRONTEND_PORT=\"5051\"\nENTRYPOINT [\"/usr/local/bin/dumb-init\", \"--\"]\n# #######################################\n# # CAPE DEFAULT ENVIRONMENT VARIABLES ##\n# #######################################\n#  cape-webservices Environment variables:\n# ENV CAPE_WEBSERVICE_HOST 0.0.0.0\n# ENV CAPE_WEBSERVICE_PORT 5050\n#  Max request size will be 100 megabytes\n# ENV CAPE_WEBSERVICE_REQUEST_MAX_SIZE 100000000\n#  request timeout is 10 mins\n# ENV CAPE_WEBSERVICE_REQUEST_TIMEOUT 600\n#  graceful shutdown times out in 3 seconds\n# ENV CAPE_WEBSERVICE_GRACEFUL_SHUTDOWN_TIMEOUT 3\n#  Websocket max size is 1 MB\n# ENV CAPE_WEBSERVICE_WEBSOCKET_MAX_SIZE 1000000\n# ENV CAPE_WEBSERVICE_WEBSOCKET_MAX_QUEUE 32\n# ENV CAPE_WEBSERVICE_MAX_NUM_ANSWERS 50\n# ENV CAPE_HOSTNAME DEV_SERVER\n#  max size of inline text will be 150000 characters:\n# ENV CAPE_WEBSERVICE_MAX_SIZE_INLINE_TEXT 150000\n#  cape-responder Environment variables:\n# ENV CAPE_CLUSTER_SCHEDULER_IP 127.0.0.1\n# ENV CAPE_CLUSTER_SCHEDULER_PORT 8786\n# ENV CAPE_NUM_WORKERS_PER_REQUEST 8\n#  cape-document-qa Environment variables:\n# ENV CAPE_MODELS_FOLDER os.path.join(THIS_FOLDER, 'storage', 'models')\n# ENV CAPE_MODEL_FOLDER os.path.join(MODELS_FOLDER, 'production_ready_model')\n# ENV CAPE_MODEL_URL https://github.com/bloomsburyai/cape-document-qa/releases/download/v0.1.2/production_ready_model.tar.xz\n# ENV CAPE_MODEL_MB_SIZE 422\n# ENV DOWNLOAD_ALL_GLOVE_EMBEDDINGS False\n# ENV CAPE_GLOVE_EMBEDDINGS_URL https://nlp.stanford.edu/data/glove.840B.300d.zip\n# ENV CAPE_LM_URL https://github.com/bloogram/cape-document-qa/releases/download/v0.1.2/lm.tar.bz2\n#  cape-document-manager Environment variables:\n#\n# ENV CAPE_SPLITTER_WORDS_PER_CHUNK 500\n# ENV CAPE_SPLITTER_WORDS_OVERLAP_BEFORE 50\n# ENV CAPE_SPLITTER_WORDS_OVERLAP_AFTER 50\n# ENV CAPE_LOCAL_UNPICKLING_LRU_CACHE_MAX_SIZE 50000\n# ENV CAPE_SQLITE_PATH os.path.join(THIS_FOLDER, 'storage', 'bla.sqlite')\n# ENV CAPE_SQLITE_JOURNAL_MODE wal\n#   cache size in kibibytes (64 megibytes)\n# ENV CAPE_SQLITE_CACHE_SIZE -65536\n#  cape-userdb Environment variables:\n#  ENV CAPE_USERDB_SQLITE_PATH os.path.join(THIS_FOLDER, 'storage', 'capeusers.sqlite'))\n#  cape-api-helpers Environment variables:\n# ENV CAPE_SECRET_DEBUG_KEYWORD debug7373\n# ENV CAPE_SECRET_EXTRA_INFO_KEYWORD trail8hef89\n#  cape-slack-plugin Environment variables:\n# ENV CAPE_SLACK_CLIENT_ID REPLACEME\n# ENV CAPE_SLACK_CLIENT_SECRET REPLACEME\n# ENV CAPE_SLACK_VERIFICATION REPLACEME\n# ENV CAPE_SLACK_APP_URL REPLACEME\n#  cape-facebook-plugin Environment variables:\n# ENV CAPE_FACEBOOK_VERIFICATION REPLACEME\n#  cape-hangouts-plugin Environment variables:\n# ENV CAPE_HANGOUTS_VERIFICATION REPLACEME\n#  cape-email-plugin Environment variables:\n#\n# ENV CAPE_MAILGUN_API_KEY REPLACEME\n# ENV CAPE_MAILGUN_DOMAIN REPLACEME\n# ENV CAPE_DEFAULT_EMAIL REPLACEME\n#  cape-frontend Environment variables:\n# ENV CAPE_FRONTEND_CREATE_DEMO_ACCOUNT_ON_INIT True\n# ENV CAPE_FRONTEND_WAIT_FOR_BACKENDS True\n# ENV CAPE_FRONTEND_ACTIVATE_NGROK_LINUX True\nCMD [\"bash\", \"-c\", \"python3\", \"-m\", \"cape_webservices.run\", \"$PORT\", \"&;\", \"python3\", \"-m\", \"cape_frontend.run\", \"$FRONTEND_PORT\"]\n# docker stop my_service;docker rm my_service;docker build -t my_service_image -f deployment/Dockerfile . && docker run -ti --ulimit core=0:0 --user runner --rm -v $(pwd)/..:/mnt --name my_service my_service_image\n","injectedSmells":[],"originalDockerfileHash":"d6b64165ee1142dc3c04f1923e30615a","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  This image runs Cape :\n#   You can run cape in 3 different modes :\n#   * Standalone :    docker run ...\n#   * As a Master,Scheduler and Worker(s):\n#     * Master:       docker run ...\n#     * Scheduler:    docker run ...\n#     * Worker(s):    docker run ...\nFROM ubuntu:18.04\nRUN apt-get update -y \\\n && apt-get install python-dev python3-dev python3-pip git zlib1g-dev apt-transport-https ca-certificates wget build-essential libcurl4-openssl-dev g++ htop nano parallel curl locales daemontools unzip python3-distutils -y \\\n && apt-get clean\nRUN pip3 install --upgrade pip setuptools dumb-init ipython\n#   Ensure that we always use UTF-8 and with US English locale\nRUN locale-gen en_US.UTF-8\nENV LC_ALL=\"en_US.UTF-8\"\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US.UTF-8\"\nENV PYTHONIOENCODING=\"utf-8\"\n#  Add non-root user to run app\nRUN useradd -G users -m runner\nWORKDIR /mnt/\n#  Argument to rebuild from this point after an update\nARG COMMIT_SHA1=1\nRUN pip3 install -vv --process-dependency-links --upgrade git+https://github.com/bloomsburyai/cape-frontend\nRUN pip3 install -vv --process-dependency-links --upgrade git+https://github.com/bloomsburyai/cape-webservices\n#  Run model tests to automatically download latest standard production model\nRUN pytest -vs --pyargs cape_document_qa.tests\nEXPOSE 5050/tcp\nEXPOSE 5051/tcp\n#  Default configuration\nENV PORT=\"5050\"\nENV FRONTEND_PORT=\"5051\"\nENTRYPOINT [\"/usr/local/bin/dumb-init\", \"--\"]\n#  #######################################\n#  # CAPE DEFAULT ENVIRONMENT VARIABLES ##\n#  #######################################\n#   cape-webservices Environment variables:\n#  ENV CAPE_WEBSERVICE_HOST 0.0.0.0\n#  ENV CAPE_WEBSERVICE_PORT 5050\n#   Max request size will be 100 megabytes\n#  ENV CAPE_WEBSERVICE_REQUEST_MAX_SIZE 100000000\n#   request timeout is 10 mins\n#  ENV CAPE_WEBSERVICE_REQUEST_TIMEOUT 600\n#   graceful shutdown times out in 3 seconds\n#  ENV CAPE_WEBSERVICE_GRACEFUL_SHUTDOWN_TIMEOUT 3\n#   Websocket max size is 1 MB\n#  ENV CAPE_WEBSERVICE_WEBSOCKET_MAX_SIZE 1000000\n#  ENV CAPE_WEBSERVICE_WEBSOCKET_MAX_QUEUE 32\n#  ENV CAPE_WEBSERVICE_MAX_NUM_ANSWERS 50\n#  ENV CAPE_HOSTNAME DEV_SERVER\n#   max size of inline text will be 150000 characters:\n#  ENV CAPE_WEBSERVICE_MAX_SIZE_INLINE_TEXT 150000\n#   cape-responder Environment variables:\n#  ENV CAPE_CLUSTER_SCHEDULER_IP 127.0.0.1\n#  ENV CAPE_CLUSTER_SCHEDULER_PORT 8786\n#  ENV CAPE_NUM_WORKERS_PER_REQUEST 8\n#   cape-document-qa Environment variables:\n#  ENV CAPE_MODELS_FOLDER os.path.join(THIS_FOLDER, 'storage', 'models')\n#  ENV CAPE_MODEL_FOLDER os.path.join(MODELS_FOLDER, 'production_ready_model')\n#  ENV CAPE_MODEL_URL https://github.com/bloomsburyai/cape-document-qa/releases/download/v0.1.2/production_ready_model.tar.xz\n#  ENV CAPE_MODEL_MB_SIZE 422\n#  ENV DOWNLOAD_ALL_GLOVE_EMBEDDINGS False\n#  ENV CAPE_GLOVE_EMBEDDINGS_URL https://nlp.stanford.edu/data/glove.840B.300d.zip\n#  ENV CAPE_LM_URL https://github.com/bloogram/cape-document-qa/releases/download/v0.1.2/lm.tar.bz2\n#   cape-document-manager Environment variables:\n#\n#  ENV CAPE_SPLITTER_WORDS_PER_CHUNK 500\n#  ENV CAPE_SPLITTER_WORDS_OVERLAP_BEFORE 50\n#  ENV CAPE_SPLITTER_WORDS_OVERLAP_AFTER 50\n#  ENV CAPE_LOCAL_UNPICKLING_LRU_CACHE_MAX_SIZE 50000\n#  ENV CAPE_SQLITE_PATH os.path.join(THIS_FOLDER, 'storage', 'bla.sqlite')\n#  ENV CAPE_SQLITE_JOURNAL_MODE wal\n#    cache size in kibibytes (64 megibytes)\n#  ENV CAPE_SQLITE_CACHE_SIZE -65536\n#   cape-userdb Environment variables:\n#   ENV CAPE_USERDB_SQLITE_PATH os.path.join(THIS_FOLDER, 'storage', 'capeusers.sqlite'))\n#   cape-api-helpers Environment variables:\n#  ENV CAPE_SECRET_DEBUG_KEYWORD debug7373\n#  ENV CAPE_SECRET_EXTRA_INFO_KEYWORD trail8hef89\n#   cape-slack-plugin Environment variables:\n#  ENV CAPE_SLACK_CLIENT_ID REPLACEME\n#  ENV CAPE_SLACK_CLIENT_SECRET REPLACEME\n#  ENV CAPE_SLACK_VERIFICATION REPLACEME\n#  ENV CAPE_SLACK_APP_URL REPLACEME\n#   cape-facebook-plugin Environment variables:\n#  ENV CAPE_FACEBOOK_VERIFICATION REPLACEME\n#   cape-hangouts-plugin Environment variables:\n#  ENV CAPE_HANGOUTS_VERIFICATION REPLACEME\n#   cape-email-plugin Environment variables:\n#\n#  ENV CAPE_MAILGUN_API_KEY REPLACEME\n#  ENV CAPE_MAILGUN_DOMAIN REPLACEME\n#  ENV CAPE_DEFAULT_EMAIL REPLACEME\n#   cape-frontend Environment variables:\n#  ENV CAPE_FRONTEND_CREATE_DEMO_ACCOUNT_ON_INIT True\n#  ENV CAPE_FRONTEND_WAIT_FOR_BACKENDS True\n#  ENV CAPE_FRONTEND_ACTIVATE_NGROK_LINUX True\nCMD [\"bash\", \"-c\", \"python3\", \"-m\", \"cape_webservices.run\", \"$PORT\", \"&;\", \"python3\", \"-m\", \"cape_frontend.run\", \"$FRONTEND_PORT\"]\n#  docker stop my_service;docker rm my_service;docker build -t my_service_image -f deployment/Dockerfile . && docker run -ti --ulimit core=0:0 --user runner --rm -v $(pwd)/..:/mnt --name my_service my_service_image\n","originalDockerfileUglifiedHash":"f4a82f405bced2f0406a8ebcdbf6b4d3","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/dce9370681e3645cc44514c24fcb5c03dde600a9.dockerfile"}