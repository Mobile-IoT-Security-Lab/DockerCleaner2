{"seed":3300087786,"processedDockerfileHash":"11edb3c568d80b30f84f4892bb10b6d9","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-npm","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM php:7.0.16-fpm\nMAINTAINER \"Magento\"\nENV PHP_EXTRA_CONFIGURE_ARGS=\"--enable-fpm --with-fpm-user=magento2 --with-fpm-group=magento2\"\nRUN apt-get update \\\n && apt-get install --no-install-recommends apt-utils sudo wget unzip cron curl libmcrypt-dev libicu-dev libxml2-dev libxslt1-dev libfreetype6-dev libjpeg62-turbo-dev libpng12-dev git vim openssh-server supervisor mysql-client ocaml expect -y \\\n && curl -L https://github.com/bcpierce00/unison/archive/2.48.4.tar.gz | tar zxv -C /tmp \\\n && cd /tmp/unison-2.48.4 \\\n && sed -i -e 's/GLIBC_SUPPORT_INOTIFY 0/GLIBC_SUPPORT_INOTIFY 1/' src/fsmonitor/linux/inotify_stubs.c \\\n && make \\\n && cp src/unison src/unison-fsmonitor /usr/local/bin \\\n && cd /root \\\n && rm -rf /tmp/unison-2.48.4 \\\n && docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n && docker-php-ext-configure hash --with-mhash \\\n && docker-php-ext-install -j$( nproc ;) mcrypt intl xsl gd zip pdo_mysql opcache soap bcmath json iconv \\\n && curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer \\\n && pecl install xdebug \\\n && docker-php-ext-enable xdebug \\\n && echo \"xdebug.remote_enable=1\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.remote_port=9000\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.remote_connect_back=0\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.remote_host=127.0.0.1\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.idekey=PHPSTORM\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.max_nesting_level=1000\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && chmod 666 /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && mkdir /var/run/sshd \\\n && apt-get clean \\\n && apt-get update \\\n && apt-get install --no-install-recommends nodejs -y \\\n && ln -s /usr/bin/nodejs /usr/bin/node \\\n && apt-get install --no-install-recommends npm -y \\\n && npm update -g npm \\\n && npm install grunt-cli@1.4.3 -g \\\n && npm install gulp@4.0.2 -g \\\n && echo \"StrictHostKeyChecking no\" >> /etc/ssh/ssh_config \\\n && apt-get install --no-install-recommends apache2 -y \\\n && a2enmod rewrite \\\n && a2enmod proxy \\\n && a2enmod proxy_fcgi \\\n && rm -f /etc/apache2/sites-enabled/000-default.conf \\\n && useradd -m -d /home/magento2 -s /bin/bash magento2 \\\n && adduser magento2 sudo \\\n && echo \"magento2 ALL=(ALL) NOPASSWD: ALL\" >> /etc/sudoers \\\n && touch /etc/sudoers.d/privacy \\\n && echo \"Defaults lecture = never\" >> /etc/sudoers.d/privacy \\\n && mkdir /home/magento2/magento2 \\\n && mkdir /var/www/magento2 \\\n && mkdir /home/magento2/state \\\n && curl -sS https://accounts.magento.cloud/cli/installer -o /home/magento2/installer \\\n && rm -r /usr/local/etc/php-fpm.d/* \\\n && sed -i 's/www-data/magento2/g' /etc/apache2/envvars\n#   PHP config\nCOPY conf/php.ini /usr/local/etc/php\n#   SSH config\nCOPY conf/sshd_config /etc/ssh/sshd_config\nRUN chown magento2:magento2 /etc/ssh/ssh_config\n#   supervisord config\nCOPY conf/supervisord.conf /etc/supervisord.conf\n#   php-fpm config\nCOPY conf/php-fpm-magento2.conf /usr/local/etc/php-fpm.d/php-fpm-magento2.conf\n#   apache config\nCOPY conf/apache-default.conf /etc/apache2/sites-enabled/apache-default.conf\n#   unison script\nCOPY conf/.unison/magento2.prf /home/magento2/.unison/magento2.prf\nCOPY conf/unison.sh /usr/local/bin/unison.sh\nCOPY conf/entrypoint.sh /usr/local/bin/entrypoint.sh\nCOPY conf/check-unison.sh /usr/local/bin/check-unison.sh\nRUN chmod +x /usr/local/bin/unison.sh \\\n && chmod +x /usr/local/bin/entrypoint.sh \\\n && chmod +x /usr/local/bin/check-unison.sh\nENV PATH=\"$PATH:/home/magento2/scripts/:/home/magento2/.magento-cloud/bin\"\nENV PATH=\"$PATH:/var/www/magento2/bin\"\nENV USE_SHARED_WEBROOT=\"1\"\nENV SHARED_CODE_PATH=\"/var/www/magento2\"\nENV WEBROOT_PATH=\"/var/www/magento2\"\nENV MAGENTO_ENABLE_SYNC_MARKER=\"0\"\nRUN mkdir /windows \\\n && cd /windows \\\n && curl -L -o unison-windows.zip https://www.irif.fr/~vouillon/unison/unison%202.48.3.zip \\\n && unzip unison-windows.zip \\\n && rm unison-windows.zip \\\n && mv 'unison 2.48.3 text.exe' unison.exe \\\n && rm 'unison 2.48.3 GTK.exe' \\\n && chown -R magento2:magento2 .\nRUN mkdir /mac-osx \\\n && cd /mac-osx \\\n && curl -L -o unison-mac-osx.zip http://unison-binaries.inria.fr/files/Unison-OS-X-2.48.15.zip \\\n && unzip unison-mac-osx.zip \\\n && rm unison-mac-osx.zip \\\n && chown -R magento2:magento2 .\n#   Initial scripts\nCOPY scripts/ /home/magento2/scripts/\nRUN sed -i 's/^/;/' /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && cd /home/magento2/scripts \\\n && composer install \\\n && chmod +x /home/magento2/scripts/m2init \\\n && sed -i 's/^;;*//' /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini\nRUN chown -R magento2:magento2 /home/magento2 \\\n && chown -R magento2:magento2 /var/www/magento2 \\\n && chmod 755 /home/magento2/scripts/bin/magento-cloud-login\n#   Delete user password to connect with ssh with empty password\nRUN passwd magento2 -d\nEXPOSE 80/tcp 22/tcp 5000/tcp 44100/tcp\nWORKDIR /home/magento2\nUSER root\nENTRYPOINT [\"/usr/local/bin/entrypoint.sh\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n","originalDockerfile":"FROM php:7.0.16-fpm\nMAINTAINER \"Magento\"\nENV PHP_EXTRA_CONFIGURE_ARGS=\"--enable-fpm --with-fpm-user=magento2 --with-fpm-group=magento2\"\nRUN apt-get update \\\n && apt-get install apt-utils sudo wget unzip cron curl libmcrypt-dev libicu-dev libxml2-dev libxslt1-dev libfreetype6-dev libjpeg62-turbo-dev libpng12-dev git vim openssh-server supervisor mysql-client ocaml expect -y \\\n && curl -L https://github.com/bcpierce00/unison/archive/2.48.4.tar.gz | tar zxv -C /tmp \\\n && cd /tmp/unison-2.48.4 \\\n && sed -i -e 's/GLIBC_SUPPORT_INOTIFY 0/GLIBC_SUPPORT_INOTIFY 1/' src/fsmonitor/linux/inotify_stubs.c \\\n && make \\\n && cp src/unison src/unison-fsmonitor /usr/local/bin \\\n && cd /root \\\n && rm -rf /tmp/unison-2.48.4 \\\n && docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n && docker-php-ext-configure hash --with-mhash \\\n && docker-php-ext-install -j$( nproc ;) mcrypt intl xsl gd zip pdo_mysql opcache soap bcmath json iconv \\\n && curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer \\\n && pecl install xdebug \\\n && docker-php-ext-enable xdebug \\\n && echo \"xdebug.remote_enable=1\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.remote_port=9000\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.remote_connect_back=0\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.remote_host=127.0.0.1\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.idekey=PHPSTORM\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.max_nesting_level=1000\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && chmod 666 /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && mkdir /var/run/sshd \\\n && apt-get clean \\\n && apt-get update \\\n && apt-get install nodejs -y \\\n && ln -s /usr/bin/nodejs /usr/bin/node \\\n && apt-get install npm -y \\\n && npm update -g npm \\\n && npm install grunt-cli -g \\\n && npm install gulp -g \\\n && echo \"StrictHostKeyChecking no\" >> /etc/ssh/ssh_config \\\n && apt-get install apache2 -y \\\n && a2enmod rewrite \\\n && a2enmod proxy \\\n && a2enmod proxy_fcgi \\\n && rm -f /etc/apache2/sites-enabled/000-default.conf \\\n && useradd -m -d /home/magento2 -s /bin/bash magento2 \\\n && adduser magento2 sudo \\\n && echo \"magento2 ALL=(ALL) NOPASSWD: ALL\" >> /etc/sudoers \\\n && touch /etc/sudoers.d/privacy \\\n && echo \"Defaults lecture = never\" >> /etc/sudoers.d/privacy \\\n && mkdir /home/magento2/magento2 \\\n && mkdir /var/www/magento2 \\\n && mkdir /home/magento2/state \\\n && curl -sS https://accounts.magento.cloud/cli/installer -o /home/magento2/installer \\\n && rm -r /usr/local/etc/php-fpm.d/* \\\n && sed -i 's/www-data/magento2/g' /etc/apache2/envvars\n#  PHP config\nADD conf/php.ini /usr/local/etc/php\n#  SSH config\nCOPY conf/sshd_config /etc/ssh/sshd_config\nRUN chown magento2:magento2 /etc/ssh/ssh_config\n#  supervisord config\nADD conf/supervisord.conf /etc/supervisord.conf\n#  php-fpm config\nADD conf/php-fpm-magento2.conf /usr/local/etc/php-fpm.d/php-fpm-magento2.conf\n#  apache config\nADD conf/apache-default.conf /etc/apache2/sites-enabled/apache-default.conf\n#  unison script\nADD conf/.unison/magento2.prf /home/magento2/.unison/magento2.prf\nADD conf/unison.sh /usr/local/bin/unison.sh\nADD conf/entrypoint.sh /usr/local/bin/entrypoint.sh\nADD conf/check-unison.sh /usr/local/bin/check-unison.sh\nRUN chmod +x /usr/local/bin/unison.sh \\\n && chmod +x /usr/local/bin/entrypoint.sh \\\n && chmod +x /usr/local/bin/check-unison.sh\nENV PATH=\"$PATH:/home/magento2/scripts/:/home/magento2/.magento-cloud/bin\"\nENV PATH=\"$PATH:/var/www/magento2/bin\"\nENV USE_SHARED_WEBROOT=\"1\"\nENV SHARED_CODE_PATH=\"/var/www/magento2\"\nENV WEBROOT_PATH=\"/var/www/magento2\"\nENV MAGENTO_ENABLE_SYNC_MARKER=\"0\"\nRUN mkdir /windows \\\n && cd /windows \\\n && curl -L -o unison-windows.zip https://www.irif.fr/~vouillon/unison/unison%202.48.3.zip \\\n && unzip unison-windows.zip \\\n && rm unison-windows.zip \\\n && mv 'unison 2.48.3 text.exe' unison.exe \\\n && rm 'unison 2.48.3 GTK.exe' \\\n && chown -R magento2:magento2 .\nRUN mkdir /mac-osx \\\n && cd /mac-osx \\\n && curl -L -o unison-mac-osx.zip http://unison-binaries.inria.fr/files/Unison-OS-X-2.48.15.zip \\\n && unzip unison-mac-osx.zip \\\n && rm unison-mac-osx.zip \\\n && chown -R magento2:magento2 .\n#  Initial scripts\nCOPY scripts/ /home/magento2/scripts/\nRUN sed -i 's/^/;/' /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && cd /home/magento2/scripts \\\n && composer install \\\n && chmod +x /home/magento2/scripts/m2init \\\n && sed -i 's/^;;*//' /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini\nRUN chown -R magento2:magento2 /home/magento2 \\\n && chown -R magento2:magento2 /var/www/magento2 \\\n && chmod 755 /home/magento2/scripts/bin/magento-cloud-login\n#  Delete user password to connect with ssh with empty password\nRUN passwd magento2 -d\nEXPOSE 80/tcp 22/tcp 5000/tcp 44100/tcp\nWORKDIR /home/magento2\nUSER root\nENTRYPOINT [\"/usr/local/bin/entrypoint.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"ae1d8b4263eb14054d6d3a3bc4b357ea","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM php:7.0.16-fpm\nMAINTAINER \"Magento\"\nENV PHP_EXTRA_CONFIGURE_ARGS=\"--enable-fpm --with-fpm-user=magento2 --with-fpm-group=magento2\"\nRUN apt-get update \\\n && apt-get install apt-utils sudo wget unzip cron curl libmcrypt-dev libicu-dev libxml2-dev libxslt1-dev libfreetype6-dev libjpeg62-turbo-dev libpng12-dev git vim openssh-server supervisor mysql-client ocaml expect -y \\\n && curl -L https://github.com/bcpierce00/unison/archive/2.48.4.tar.gz | tar zxv -C /tmp \\\n && cd /tmp/unison-2.48.4 \\\n && sed -i -e 's/GLIBC_SUPPORT_INOTIFY 0/GLIBC_SUPPORT_INOTIFY 1/' src/fsmonitor/linux/inotify_stubs.c \\\n && make \\\n && cp src/unison src/unison-fsmonitor /usr/local/bin \\\n && cd /root \\\n && rm -rf /tmp/unison-2.48.4 \\\n && docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n && docker-php-ext-configure hash --with-mhash \\\n && docker-php-ext-install -j$( nproc ;) mcrypt intl xsl gd zip pdo_mysql opcache soap bcmath json iconv \\\n && curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer \\\n && pecl install xdebug \\\n && docker-php-ext-enable xdebug \\\n && echo \"xdebug.remote_enable=1\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.remote_port=9000\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.remote_connect_back=0\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.remote_host=127.0.0.1\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.idekey=PHPSTORM\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && echo \"xdebug.max_nesting_level=1000\" >> /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && chmod 666 /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && mkdir /var/run/sshd \\\n && apt-get clean \\\n && apt-get update \\\n && apt-get install nodejs -y \\\n && ln -s /usr/bin/nodejs /usr/bin/node \\\n && apt-get install npm -y \\\n && npm update -g npm \\\n && npm install grunt-cli -g \\\n && npm install gulp -g \\\n && echo \"StrictHostKeyChecking no\" >> /etc/ssh/ssh_config \\\n && apt-get install apache2 -y \\\n && a2enmod rewrite \\\n && a2enmod proxy \\\n && a2enmod proxy_fcgi \\\n && rm -f /etc/apache2/sites-enabled/000-default.conf \\\n && useradd -m -d /home/magento2 -s /bin/bash magento2 \\\n && adduser magento2 sudo \\\n && echo \"magento2 ALL=(ALL) NOPASSWD: ALL\" >> /etc/sudoers \\\n && touch /etc/sudoers.d/privacy \\\n && echo \"Defaults lecture = never\" >> /etc/sudoers.d/privacy \\\n && mkdir /home/magento2/magento2 \\\n && mkdir /var/www/magento2 \\\n && mkdir /home/magento2/state \\\n && curl -sS https://accounts.magento.cloud/cli/installer -o /home/magento2/installer \\\n && rm -r /usr/local/etc/php-fpm.d/* \\\n && sed -i 's/www-data/magento2/g' /etc/apache2/envvars\n#   PHP config\nADD conf/php.ini /usr/local/etc/php\n#   SSH config\nCOPY conf/sshd_config /etc/ssh/sshd_config\nRUN chown magento2:magento2 /etc/ssh/ssh_config\n#   supervisord config\nADD conf/supervisord.conf /etc/supervisord.conf\n#   php-fpm config\nADD conf/php-fpm-magento2.conf /usr/local/etc/php-fpm.d/php-fpm-magento2.conf\n#   apache config\nADD conf/apache-default.conf /etc/apache2/sites-enabled/apache-default.conf\n#   unison script\nADD conf/.unison/magento2.prf /home/magento2/.unison/magento2.prf\nADD conf/unison.sh /usr/local/bin/unison.sh\nADD conf/entrypoint.sh /usr/local/bin/entrypoint.sh\nADD conf/check-unison.sh /usr/local/bin/check-unison.sh\nRUN chmod +x /usr/local/bin/unison.sh \\\n && chmod +x /usr/local/bin/entrypoint.sh \\\n && chmod +x /usr/local/bin/check-unison.sh\nENV PATH=\"$PATH:/home/magento2/scripts/:/home/magento2/.magento-cloud/bin\"\nENV PATH=\"$PATH:/var/www/magento2/bin\"\nENV USE_SHARED_WEBROOT=\"1\"\nENV SHARED_CODE_PATH=\"/var/www/magento2\"\nENV WEBROOT_PATH=\"/var/www/magento2\"\nENV MAGENTO_ENABLE_SYNC_MARKER=\"0\"\nRUN mkdir /windows \\\n && cd /windows \\\n && curl -L -o unison-windows.zip https://www.irif.fr/~vouillon/unison/unison%202.48.3.zip \\\n && unzip unison-windows.zip \\\n && rm unison-windows.zip \\\n && mv 'unison 2.48.3 text.exe' unison.exe \\\n && rm 'unison 2.48.3 GTK.exe' \\\n && chown -R magento2:magento2 .\nRUN mkdir /mac-osx \\\n && cd /mac-osx \\\n && curl -L -o unison-mac-osx.zip http://unison-binaries.inria.fr/files/Unison-OS-X-2.48.15.zip \\\n && unzip unison-mac-osx.zip \\\n && rm unison-mac-osx.zip \\\n && chown -R magento2:magento2 .\n#   Initial scripts\nCOPY scripts/ /home/magento2/scripts/\nRUN sed -i 's/^/;/' /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini \\\n && cd /home/magento2/scripts \\\n && composer install \\\n && chmod +x /home/magento2/scripts/m2init \\\n && sed -i 's/^;;*//' /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini\nRUN chown -R magento2:magento2 /home/magento2 \\\n && chown -R magento2:magento2 /var/www/magento2 \\\n && chmod 755 /home/magento2/scripts/bin/magento-cloud-login\n#   Delete user password to connect with ssh with empty password\nRUN passwd magento2 -d\nEXPOSE 80/tcp 22/tcp 5000/tcp 44100/tcp\nWORKDIR /home/magento2\nUSER root\nENTRYPOINT [\"/usr/local/bin/entrypoint.sh\"]\n","originalDockerfileUglifiedHash":"bf2f95587206b04b3c4ee0dc83d91ff0","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/18a1ea0515d6e65d9d7e70439c5e6f3211eacc33.dockerfile"}