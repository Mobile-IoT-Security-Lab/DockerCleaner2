{"seed":2769200696,"processedDockerfileHash":"9334b5d0bdbba5b653dd660cfb9bb89b","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-npm","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM centos\n#  ## Guacamole Server ###\n#   更多详细安装信息可参考 Guacamole 官方 <https://guacamole.apache.org/doc/gug/installing-guacamole.html>\n#   拷贝定制过的 guacamole-server 并解压\nCOPY f2etest-guacamole/guacamole-server-0.9.3.tar.gz /home/guacdshare\nWORKDIR /home/guacdshare\n#   安装需要使用到的依赖包\nRUN yum install -y wget gcc initscripts sudo lsof automake autoconf libtool make cairo-devel libpng-devel uuid-devel freerdp* libvncserver-devel openssl-devel \\\n && ln -s /usr/local/lib/freerdp/guacsnd.so /usr/lib64/freerdp/ \\\n && ln -s /usr/local/lib/freerdp/guacdr.so /usr/lib64/freerdp/\nWORKDIR /home/guacdshare/guacamole-server-0.9.3\n#   运行配置脚本并将 `guacd` 添加到 `/etc/init.d` 目录\nRUN ./configure --with-init-dir=/etc/init.d \\\n && make \\\n && make install \\\n && ldconfig \\\n && chkconfig --add guacd \\\n && chkconfig guacd on\n#  ## Guacamole Client ###\nWORKDIR /root\n#  # JAVA ##\n#   下载 JDK 1.8\nRUN wget --no-cookies --no-check-certificate --header \"Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie\" \"http://download.oracle.com/otn-pub/java/jdk/8u141-b15/336fa29ff2bb4ef291e347e091f7f4a7/jdk-8u141-linux-x64.tar.gz\" \\\n && mkdir /usr/java\nWORKDIR /usr/java\n#   拷贝并解压 JDK\nRUN cp /root/jdk-8u141-linux-x64.tar.gz ./ \\\n && tar xzf jdk-8u141-linux-x64.tar.gz\n#   设置 JAVA 运行环境\nENV JAVA_HOME=\"/usr/java/jdk1.8.0_141\"\nENV PATH=\"$JAVA_HOME/bin;$PATH\"\nENV CLASSPATH=\".:$JAVA_HOME/lib\"\n#  # TOMCAT ##\nWORKDIR /usr/local\n#   下载并解压 Tomcat\nRUN wget http://mirrors.hust.edu.cn/apache/tomcat/tomcat-8/v8.5.38/bin/apache-tomcat-8.5.38.tar.gz \\\n && tar -xzvf apache-tomcat-8.5.38.tar.gz \\\n && mv apache-tomcat-8.5.38 tomcat8\n#   拷贝定制过的 WAR 包\nCOPY f2etest-guacamole/guacamole-0.9.3.war /usr/local/tomcat8/webapps/guacamole.war\n#   拷贝 guacamole 配置文件和免登配置文件\nCOPY f2etest-docker/guacamole.properties /etc/guacamole/\nCOPY f2etest-docker/noauth-config.xml /etc/guacamole/\n#   拷贝 Tomcat 服务脚本到 `/etc/init.d` 目录\nCOPY f2etest-docker/tomcat8 /etc/init.d/\nWORKDIR /etc/init.d\n#   增加 Tomcat 服务让其运行时自动启动\nRUN chmod 755 tomcat8 \\\n && chkconfig --add tomcat8 \\\n && chkconfig --level 234 tomcat8 on \\\n && mkdir /root/.guacamole \\\n && ln -s /etc/guacamole/guacamole.properties /root/.guacamole\n#  ## F2etst Web ###\n#  # Node Env ##\nWORKDIR /usr/local\n#   下载 node v10 并解压\nRUN wget https://nodejs.org/dist/v10.15.1/node-v10.15.1-linux-x64.tar.xz \\\n && xz -d node-v10.15.1-linux-x64.tar.xz \\\n && tar -xf node-v10.15.1-linux-x64.tar \\\n && mv node-v10.15.1-linux-x64 node \\\n && ln -s /usr/local/node/bin/node /usr/bin/node \\\n && ln -s /usr/local/node/bin/npm /usr/bin/npm \\\n && npm install pm2@5.3.0 -g \\\n && ln -s /usr/local/node/bin/pm2 /usr/bin/pm2\n#  # MySQL ##\n#   下载安装 MySQL\nRUN wget http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm \\\n && yum localinstall -y mysql-community-release-el7-5.noarch.rpm \\\n && yum install -y mysql-community-server\n#  # Nginx ##\n#   拷贝 nginx 源配置\nCOPY f2etest-docker/nginx.repo /etc/yum.repos.d/\n#   yum 安装 nginx\nRUN yum-config-manager --enable nginx-mainline \\\n && yum install -y nginx\nCOPY f2etest-docker/nginx.conf /etc/nginx/\n#   拷贝 Web 应用程序\nCOPY f2etest-web /home/f2etest-web\nWORKDIR /home/f2etest-web/\n#   安装 node 依赖包\nRUN npm install\n#   拷贝初始化脚本（初始化数据库表、`pm2` 启动 Web、启动 Nginx）\nCOPY f2etest-docker/setup.sh ./\nRUN chmod 777 setup.sh\nEXPOSE 80/tcp\n#   指定容器启动程序（以防出现权限不足情况）\nENTRYPOINT [\"/usr/sbin/init\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM centos\n# ## Guacamole Server ###\n#  更多详细安装信息可参考 Guacamole 官方 <https://guacamole.apache.org/doc/gug/installing-guacamole.html>\n#  拷贝定制过的 guacamole-server 并解压\nADD f2etest-guacamole/guacamole-server-0.9.3.tar.gz /home/guacdshare\nWORKDIR /home/guacdshare\n#  安装需要使用到的依赖包\nRUN yum install -y wget gcc initscripts sudo lsof automake autoconf libtool make cairo-devel libpng-devel uuid-devel freerdp* libvncserver-devel openssl-devel \\\n && ln -s /usr/local/lib/freerdp/guacsnd.so /usr/lib64/freerdp/ \\\n && ln -s /usr/local/lib/freerdp/guacdr.so /usr/lib64/freerdp/\nWORKDIR /home/guacdshare/guacamole-server-0.9.3\n#  运行配置脚本并将 `guacd` 添加到 `/etc/init.d` 目录\nRUN ./configure --with-init-dir=/etc/init.d \\\n && make \\\n && make install \\\n && ldconfig \\\n && chkconfig --add guacd \\\n && chkconfig guacd on\n# ## Guacamole Client ###\nWORKDIR /root\n# # JAVA ##\n#  下载 JDK 1.8\nRUN wget --no-cookies --no-check-certificate --header \"Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie\" \"http://download.oracle.com/otn-pub/java/jdk/8u141-b15/336fa29ff2bb4ef291e347e091f7f4a7/jdk-8u141-linux-x64.tar.gz\" \\\n && mkdir /usr/java\nWORKDIR /usr/java\n#  拷贝并解压 JDK\nRUN cp /root/jdk-8u141-linux-x64.tar.gz ./ \\\n && tar xzf jdk-8u141-linux-x64.tar.gz\n#  设置 JAVA 运行环境\nENV JAVA_HOME=\"/usr/java/jdk1.8.0_141\"\nENV PATH=\"$JAVA_HOME/bin;$PATH\"\nENV CLASSPATH=\".:$JAVA_HOME/lib\"\n# # TOMCAT ##\nWORKDIR /usr/local\n#  下载并解压 Tomcat\nRUN wget http://mirrors.hust.edu.cn/apache/tomcat/tomcat-8/v8.5.38/bin/apache-tomcat-8.5.38.tar.gz \\\n && tar -xzvf apache-tomcat-8.5.38.tar.gz \\\n && mv apache-tomcat-8.5.38 tomcat8\n#  拷贝定制过的 WAR 包\nCOPY f2etest-guacamole/guacamole-0.9.3.war /usr/local/tomcat8/webapps/guacamole.war\n#  拷贝 guacamole 配置文件和免登配置文件\nCOPY f2etest-docker/guacamole.properties /etc/guacamole/\nCOPY f2etest-docker/noauth-config.xml /etc/guacamole/\n#  拷贝 Tomcat 服务脚本到 `/etc/init.d` 目录\nCOPY f2etest-docker/tomcat8 /etc/init.d/\nWORKDIR /etc/init.d\n#  增加 Tomcat 服务让其运行时自动启动\nRUN chmod 755 tomcat8 \\\n && chkconfig --add tomcat8 \\\n && chkconfig --level 234 tomcat8 on \\\n && mkdir /root/.guacamole \\\n && ln -s /etc/guacamole/guacamole.properties /root/.guacamole\n# ## F2etst Web ###\n# # Node Env ##\nWORKDIR /usr/local\n#  下载 node v10 并解压\nRUN wget https://nodejs.org/dist/v10.15.1/node-v10.15.1-linux-x64.tar.xz \\\n && xz -d node-v10.15.1-linux-x64.tar.xz \\\n && tar -xf node-v10.15.1-linux-x64.tar \\\n && mv node-v10.15.1-linux-x64 node \\\n && ln -s /usr/local/node/bin/node /usr/bin/node \\\n && ln -s /usr/local/node/bin/npm /usr/bin/npm \\\n && npm install pm2 -g \\\n && ln -s /usr/local/node/bin/pm2 /usr/bin/pm2\n# # MySQL ##\n#  下载安装 MySQL\nRUN wget http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm \\\n && yum localinstall -y mysql-community-release-el7-5.noarch.rpm \\\n && yum install -y mysql-community-server\n# # Nginx ##\n#  拷贝 nginx 源配置\nCOPY f2etest-docker/nginx.repo /etc/yum.repos.d/\n#  yum 安装 nginx\nRUN yum-config-manager --enable nginx-mainline \\\n && yum install -y nginx\nCOPY f2etest-docker/nginx.conf /etc/nginx/\n#  拷贝 Web 应用程序\nCOPY f2etest-web /home/f2etest-web\nWORKDIR /home/f2etest-web/\n#  安装 node 依赖包\nRUN npm install\n#  拷贝初始化脚本（初始化数据库表、`pm2` 启动 Web、启动 Nginx）\nCOPY f2etest-docker/setup.sh ./\nRUN chmod 777 setup.sh\nEXPOSE 80/tcp\n#  指定容器启动程序（以防出现权限不足情况）\nENTRYPOINT [\"/usr/sbin/init\"]\n","injectedSmells":[],"originalDockerfileHash":"077cd09a2c349c59d2a13c62a50ea638","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM centos\n#  ## Guacamole Server ###\n#   更多详细安装信息可参考 Guacamole 官方 <https://guacamole.apache.org/doc/gug/installing-guacamole.html>\n#   拷贝定制过的 guacamole-server 并解压\nADD f2etest-guacamole/guacamole-server-0.9.3.tar.gz /home/guacdshare\nWORKDIR /home/guacdshare\n#   安装需要使用到的依赖包\nRUN yum install -y wget gcc initscripts sudo lsof automake autoconf libtool make cairo-devel libpng-devel uuid-devel freerdp* libvncserver-devel openssl-devel \\\n && ln -s /usr/local/lib/freerdp/guacsnd.so /usr/lib64/freerdp/ \\\n && ln -s /usr/local/lib/freerdp/guacdr.so /usr/lib64/freerdp/\nWORKDIR /home/guacdshare/guacamole-server-0.9.3\n#   运行配置脚本并将 `guacd` 添加到 `/etc/init.d` 目录\nRUN ./configure --with-init-dir=/etc/init.d \\\n && make \\\n && make install \\\n && ldconfig \\\n && chkconfig --add guacd \\\n && chkconfig guacd on\n#  ## Guacamole Client ###\nWORKDIR /root\n#  # JAVA ##\n#   下载 JDK 1.8\nRUN wget --no-cookies --no-check-certificate --header \"Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie\" \"http://download.oracle.com/otn-pub/java/jdk/8u141-b15/336fa29ff2bb4ef291e347e091f7f4a7/jdk-8u141-linux-x64.tar.gz\" \\\n && mkdir /usr/java\nWORKDIR /usr/java\n#   拷贝并解压 JDK\nRUN cp /root/jdk-8u141-linux-x64.tar.gz ./ \\\n && tar xzf jdk-8u141-linux-x64.tar.gz\n#   设置 JAVA 运行环境\nENV JAVA_HOME=\"/usr/java/jdk1.8.0_141\"\nENV PATH=\"$JAVA_HOME/bin;$PATH\"\nENV CLASSPATH=\".:$JAVA_HOME/lib\"\n#  # TOMCAT ##\nWORKDIR /usr/local\n#   下载并解压 Tomcat\nRUN wget http://mirrors.hust.edu.cn/apache/tomcat/tomcat-8/v8.5.38/bin/apache-tomcat-8.5.38.tar.gz \\\n && tar -xzvf apache-tomcat-8.5.38.tar.gz \\\n && mv apache-tomcat-8.5.38 tomcat8\n#   拷贝定制过的 WAR 包\nCOPY f2etest-guacamole/guacamole-0.9.3.war /usr/local/tomcat8/webapps/guacamole.war\n#   拷贝 guacamole 配置文件和免登配置文件\nCOPY f2etest-docker/guacamole.properties /etc/guacamole/\nCOPY f2etest-docker/noauth-config.xml /etc/guacamole/\n#   拷贝 Tomcat 服务脚本到 `/etc/init.d` 目录\nCOPY f2etest-docker/tomcat8 /etc/init.d/\nWORKDIR /etc/init.d\n#   增加 Tomcat 服务让其运行时自动启动\nRUN chmod 755 tomcat8 \\\n && chkconfig --add tomcat8 \\\n && chkconfig --level 234 tomcat8 on \\\n && mkdir /root/.guacamole \\\n && ln -s /etc/guacamole/guacamole.properties /root/.guacamole\n#  ## F2etst Web ###\n#  # Node Env ##\nWORKDIR /usr/local\n#   下载 node v10 并解压\nRUN wget https://nodejs.org/dist/v10.15.1/node-v10.15.1-linux-x64.tar.xz \\\n && xz -d node-v10.15.1-linux-x64.tar.xz \\\n && tar -xf node-v10.15.1-linux-x64.tar \\\n && mv node-v10.15.1-linux-x64 node \\\n && ln -s /usr/local/node/bin/node /usr/bin/node \\\n && ln -s /usr/local/node/bin/npm /usr/bin/npm \\\n && npm install pm2 -g \\\n && ln -s /usr/local/node/bin/pm2 /usr/bin/pm2\n#  # MySQL ##\n#   下载安装 MySQL\nRUN wget http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm \\\n && yum localinstall -y mysql-community-release-el7-5.noarch.rpm \\\n && yum install -y mysql-community-server\n#  # Nginx ##\n#   拷贝 nginx 源配置\nCOPY f2etest-docker/nginx.repo /etc/yum.repos.d/\n#   yum 安装 nginx\nRUN yum-config-manager --enable nginx-mainline \\\n && yum install -y nginx\nCOPY f2etest-docker/nginx.conf /etc/nginx/\n#   拷贝 Web 应用程序\nCOPY f2etest-web /home/f2etest-web\nWORKDIR /home/f2etest-web/\n#   安装 node 依赖包\nRUN npm install\n#   拷贝初始化脚本（初始化数据库表、`pm2` 启动 Web、启动 Nginx）\nCOPY f2etest-docker/setup.sh ./\nRUN chmod 777 setup.sh\nEXPOSE 80/tcp\n#   指定容器启动程序（以防出现权限不足情况）\nENTRYPOINT [\"/usr/sbin/init\"]\n","originalDockerfileUglifiedHash":"6b8668c7821067a3a7eb298daebc2777","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/5817d5a6c53cdf5ce635e41c61eb72d9cf232b9f.dockerfile"}