{"seed":158492739,"processedDockerfileHash":"5f2bba78bc744a942c8f4f1158473da5","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck"],"processedDockerfile":"#   Build a docker image from latest YaCy sources on Alpine Linux\n#   Base image : latest stable official jdk 8 image from Docker based on Alpine Linux\nFROM openjdk:8-alpine\n#   trace java version\nRUN java -version\n#   Install needed packages not in base image\n#   (curl for sh scripts in /bin, and imagemagick,xvfb and ghostscript to enable PDF and image snapshot generation)\nRUN apk add curl imagemagick xvfb ghostscript --no-cache\n#   --- Begin of wkhtmltopdf install : compile from sources because the wkhtmltopdf Alpine package is currently only on the Alpine edge branch\n#   set current working dir\nWORKDIR /tmp\n#   set wkhtmltopdf version once in a environment variable\nENV WKHTMLTOPDF_VERSION=\"0.12.5\"\n#   Download and extract wkhtmltopdf sources\nRUN curl -fSL https://github.com/wkhtmltopdf/wkhtmltopdf/archive/${WKHTMLTOPDF_VERSION}.tar.gz -o wkhtmltopdf-${WKHTMLTOPDF_VERSION}-src.tar.gz \\\n && tar xzf wkhtmltopdf-${WKHTMLTOPDF_VERSION}-src.tar.gz\n#   set current working dir\nWORKDIR wkhtmltopdf-${WKHTMLTOPDF_VERSION}\n#   All in one step to reduce image size growth :\n#   - add packages necessary to build wkhtmltopdf from sources and then to run it\n#   - build wkhtmltopdf\n#   - create a symbolic link to the wkhtmltopdf executable at a path where YaCy is expecting it\n#   - remove the sources archive\n#   - remove the build packages\nRUN apk update \\\n && apk add g++ make qt5-qtbase-dev qt5-qtwebkit-dev qt5-qtsvg-dev qt5-qtxmlpatterns-dev libgcc libstdc++ musl qt5-qtbase qt5-qtbase-x11 qt5-qtsvg qt5-qtwebkit --no-cache \\\n && qmake-qt5 -makefile \\\n && make \\\n && make install \\\n && rm -f /tmp/wkhtmltopdf-${WKHTMLTOPDF_VERSION}-src.tar.gz \\\n && apk del g++ make qt5-qtbase-dev qt5-qtwebkit-dev qt5-qtsvg-dev qt5-qtxmlpatterns-dev\n#   --- End of wkhtmltopdf install\n#   --- Begin of apache ant install : from binary distribution because ant is not in alpine packages\n#   set current working dir\nWORKDIR /tmp\n#   set ant version once in a environment variable\nENV ANT_VERSION=\"1.10.5\"\n#   All in one step to reduce image size growth :\n#   - add gnupg package\n#   - get ant binary file from a mirror and PGP file signature from main repository\n#   - import gpg keys from main repository and verify binary file signature\n#   - extract binary, make /opt directory, move extracted ant to /opt/ant\n#   - remove archive and gnupg package\nRUN apk update \\\n && apk add gnupg --no-cache \\\n && curl -fSL https://archive.apache.org/dist/ant/binaries/apache-ant-${ANT_VERSION}-bin.tar.gz -o apache-ant-${ANT_VERSION}-bin.tar.gz \\\n && curl -fSL https://archive.apache.org/dist/ant/binaries/apache-ant-${ANT_VERSION}-bin.tar.gz.asc -o apache-ant-${ANT_VERSION}-bin.tar.gz.asc \\\n && curl -fSL https://www.apache.org/dist/ant/KEYS | gpg --import \\\n && gpg --verify apache-ant-${ANT_VERSION}-bin.tar.gz.asc \\\n && tar xzf apache-ant-${ANT_VERSION}-bin.tar.gz \\\n && mkdir -p /opt \\\n && mv apache-ant-${ANT_VERSION} /opt/ant \\\n && rm -f apache-ant-${ANT_VERSION}-bin.tar.gz \\\n && apk del gnupg\n#   set ant required environment variables\nENV ANT_HOME=\"/opt/ant\"\nENV PATH=\"${PATH}:/opt/ant/bin\"\n#   --- End of apache ant install\n#   set current working dir\nWORKDIR /opt\n#   All in one step to reduce image size growth :\n#   - add git package\n#   - clone main YaCy git repository (we need to clone git repository to generate correct version when building from source)\n#   - compile with apache ant\n#   - remove unnecessary and size consuming .git directory\n#   - delete git package and ant binary install\n#   Possible alternative : copy directly your current sources an remove git clone command from the following RUN\n#   COPY . /opt/yacy_search_server/\nRUN apk add git --no-cache \\\n && git clone https://github.com/yacy/yacy_search_server.git \\\n && ant compile -f /opt/yacy_search_server/build.xml \\\n && rm -rf /opt/yacy_search_server/.git \\\n && rm -rf /opt/ant \\\n && apk del git\nRUN sed -i \"/adminAccountBase64MD5=/c\\adminAccountBase64MD5=MD5:e672161ffdce91be4678605f4f4e6786\" /opt/yacy_search_server/defaults/yacy.init \\\n && sed -i \"/server.https=false/c\\server.https=true\" /opt/yacy_search_server/defaults/yacy.init \\\n && addgroup yacy \\\n && adduser -S -G yacy -H -D yacy \\\n && chown yacy:yacy -R /opt/yacy_search_server\n#   Expose HTTP and HTTPS default ports\nEXPOSE 8090/tcp 8443/tcp\n#   Set data volume : yacy data and configuration will persist aven after container stop or destruction\nVOLUME [\"/opt/yacy_search_server/DATA\"]\n#   Next commands run as yacy as non-root user for improved security\nUSER yacy\n#   Start yacy as a foreground process (-f) to display console logs and to wait for yacy process\nCMD [\"/bin/sh\", \"/opt/yacy_search_server/startYACY.sh\", \"-f\"]\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  Build a docker image from latest YaCy sources on Alpine Linux\n#  Base image : latest stable official jdk 8 image from Docker based on Alpine Linux\nFROM openjdk:8-alpine\n#  trace java version\nRUN java -version\n#  Install needed packages not in base image\n#  (curl for sh scripts in /bin, and imagemagick,xvfb and ghostscript to enable PDF and image snapshot generation)\nRUN apk add --no-cache curl imagemagick xvfb ghostscript\n#  --- Begin of wkhtmltopdf install : compile from sources because the wkhtmltopdf Alpine package is currently only on the Alpine edge branch\n#  set current working dir\nWORKDIR /tmp\n#  set wkhtmltopdf version once in a environment variable\nENV WKHTMLTOPDF_VERSION=\"0.12.5\"\n#  Download and extract wkhtmltopdf sources\nRUN curl -fSL https://github.com/wkhtmltopdf/wkhtmltopdf/archive/${WKHTMLTOPDF_VERSION}.tar.gz -o wkhtmltopdf-${WKHTMLTOPDF_VERSION}-src.tar.gz \\\n && tar xzf wkhtmltopdf-${WKHTMLTOPDF_VERSION}-src.tar.gz\n#  set current working dir\nWORKDIR wkhtmltopdf-${WKHTMLTOPDF_VERSION}\n#  All in one step to reduce image size growth :\n#  - add packages necessary to build wkhtmltopdf from sources and then to run it\n#  - build wkhtmltopdf\n#  - create a symbolic link to the wkhtmltopdf executable at a path where YaCy is expecting it\n#  - remove the sources archive\n#  - remove the build packages\nRUN apk update \\\n && apk add --no-cache g++ make qt5-qtbase-dev qt5-qtwebkit-dev qt5-qtsvg-dev qt5-qtxmlpatterns-dev libgcc libstdc++ musl qt5-qtbase qt5-qtbase-x11 qt5-qtsvg qt5-qtwebkit \\\n && qmake-qt5 -makefile \\\n && make \\\n && make install \\\n && rm -f /tmp/wkhtmltopdf-${WKHTMLTOPDF_VERSION}-src.tar.gz \\\n && apk del g++ make qt5-qtbase-dev qt5-qtwebkit-dev qt5-qtsvg-dev qt5-qtxmlpatterns-dev\n#  --- End of wkhtmltopdf install\n#  --- Begin of apache ant install : from binary distribution because ant is not in alpine packages\n#  set current working dir\nWORKDIR /tmp\n#  set ant version once in a environment variable\nENV ANT_VERSION=\"1.10.5\"\n#  All in one step to reduce image size growth :\n#  - add gnupg package\n#  - get ant binary file from a mirror and PGP file signature from main repository\n#  - import gpg keys from main repository and verify binary file signature\n#  - extract binary, make /opt directory, move extracted ant to /opt/ant\n#  - remove archive and gnupg package\nRUN apk update \\\n && apk add --no-cache gnupg \\\n && curl -fSL https://archive.apache.org/dist/ant/binaries/apache-ant-${ANT_VERSION}-bin.tar.gz -o apache-ant-${ANT_VERSION}-bin.tar.gz \\\n && curl -fSL https://archive.apache.org/dist/ant/binaries/apache-ant-${ANT_VERSION}-bin.tar.gz.asc -o apache-ant-${ANT_VERSION}-bin.tar.gz.asc \\\n && curl -fSL https://www.apache.org/dist/ant/KEYS | gpg --import \\\n && gpg --verify apache-ant-${ANT_VERSION}-bin.tar.gz.asc \\\n && tar xzf apache-ant-${ANT_VERSION}-bin.tar.gz \\\n && mkdir -p /opt \\\n && mv apache-ant-${ANT_VERSION} /opt/ant \\\n && rm -f apache-ant-${ANT_VERSION}-bin.tar.gz \\\n && apk del gnupg\n#  set ant required environment variables\nENV ANT_HOME=\"/opt/ant\"\nENV PATH=\"${PATH}:/opt/ant/bin\"\n#  --- End of apache ant install\n#  set current working dir\nWORKDIR /opt\n#  All in one step to reduce image size growth :\n#  - add git package\n#  - clone main YaCy git repository (we need to clone git repository to generate correct version when building from source)\n#  - compile with apache ant\n#  - remove unnecessary and size consuming .git directory\n#  - delete git package and ant binary install\n#  Possible alternative : copy directly your current sources an remove git clone command from the following RUN\n#  COPY . /opt/yacy_search_server/\nRUN apk add --no-cache git \\\n && git clone https://github.com/yacy/yacy_search_server.git \\\n && ant compile -f /opt/yacy_search_server/build.xml \\\n && rm -rf /opt/yacy_search_server/.git \\\n && rm -rf /opt/ant \\\n && apk del git\nRUN sed -i \"/adminAccountBase64MD5=/c\\adminAccountBase64MD5=MD5:e672161ffdce91be4678605f4f4e6786\" /opt/yacy_search_server/defaults/yacy.init \\\n && sed -i \"/server.https=false/c\\server.https=true\" /opt/yacy_search_server/defaults/yacy.init \\\n && addgroup yacy \\\n && adduser -S -G yacy -H -D yacy \\\n && chown yacy:yacy -R /opt/yacy_search_server\n#  Expose HTTP and HTTPS default ports\nEXPOSE 8090/tcp 8443/tcp\n#  Set data volume : yacy data and configuration will persist aven after container stop or destruction\nVOLUME [\"/opt/yacy_search_server/DATA\"]\n#  Next commands run as yacy as non-root user for improved security\nUSER yacy\n#  Start yacy as a foreground process (-f) to display console logs and to wait for yacy process\nCMD [\"/bin/sh\", \"/opt/yacy_search_server/startYACY.sh\", \"-f\"]\n","injectedSmells":[],"originalDockerfileHash":"37579ddd0622a3b03444561509726843","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   Build a docker image from latest YaCy sources on Alpine Linux\n#   Base image : latest stable official jdk 8 image from Docker based on Alpine Linux\nFROM openjdk:8-alpine\n#   trace java version\nRUN java -version\n#   Install needed packages not in base image\n#   (curl for sh scripts in /bin, and imagemagick,xvfb and ghostscript to enable PDF and image snapshot generation)\nRUN apk add --no-cache curl imagemagick xvfb ghostscript\n#   --- Begin of wkhtmltopdf install : compile from sources because the wkhtmltopdf Alpine package is currently only on the Alpine edge branch\n#   set current working dir\nWORKDIR /tmp\n#   set wkhtmltopdf version once in a environment variable\nENV WKHTMLTOPDF_VERSION=\"0.12.5\"\n#   Download and extract wkhtmltopdf sources\nRUN curl -fSL https://github.com/wkhtmltopdf/wkhtmltopdf/archive/${WKHTMLTOPDF_VERSION}.tar.gz -o wkhtmltopdf-${WKHTMLTOPDF_VERSION}-src.tar.gz \\\n && tar xzf wkhtmltopdf-${WKHTMLTOPDF_VERSION}-src.tar.gz\n#   set current working dir\nWORKDIR wkhtmltopdf-${WKHTMLTOPDF_VERSION}\n#   All in one step to reduce image size growth :\n#   - add packages necessary to build wkhtmltopdf from sources and then to run it\n#   - build wkhtmltopdf\n#   - create a symbolic link to the wkhtmltopdf executable at a path where YaCy is expecting it\n#   - remove the sources archive\n#   - remove the build packages\nRUN apk update \\\n && apk add --no-cache g++ make qt5-qtbase-dev qt5-qtwebkit-dev qt5-qtsvg-dev qt5-qtxmlpatterns-dev libgcc libstdc++ musl qt5-qtbase qt5-qtbase-x11 qt5-qtsvg qt5-qtwebkit \\\n && qmake-qt5 -makefile \\\n && make \\\n && make install \\\n && rm -f /tmp/wkhtmltopdf-${WKHTMLTOPDF_VERSION}-src.tar.gz \\\n && apk del g++ make qt5-qtbase-dev qt5-qtwebkit-dev qt5-qtsvg-dev qt5-qtxmlpatterns-dev\n#   --- End of wkhtmltopdf install\n#   --- Begin of apache ant install : from binary distribution because ant is not in alpine packages\n#   set current working dir\nWORKDIR /tmp\n#   set ant version once in a environment variable\nENV ANT_VERSION=\"1.10.5\"\n#   All in one step to reduce image size growth :\n#   - add gnupg package\n#   - get ant binary file from a mirror and PGP file signature from main repository\n#   - import gpg keys from main repository and verify binary file signature\n#   - extract binary, make /opt directory, move extracted ant to /opt/ant\n#   - remove archive and gnupg package\nRUN apk update \\\n && apk add --no-cache gnupg \\\n && curl -fSL https://archive.apache.org/dist/ant/binaries/apache-ant-${ANT_VERSION}-bin.tar.gz -o apache-ant-${ANT_VERSION}-bin.tar.gz \\\n && curl -fSL https://archive.apache.org/dist/ant/binaries/apache-ant-${ANT_VERSION}-bin.tar.gz.asc -o apache-ant-${ANT_VERSION}-bin.tar.gz.asc \\\n && curl -fSL https://www.apache.org/dist/ant/KEYS | gpg --import \\\n && gpg --verify apache-ant-${ANT_VERSION}-bin.tar.gz.asc \\\n && tar xzf apache-ant-${ANT_VERSION}-bin.tar.gz \\\n && mkdir -p /opt \\\n && mv apache-ant-${ANT_VERSION} /opt/ant \\\n && rm -f apache-ant-${ANT_VERSION}-bin.tar.gz \\\n && apk del gnupg\n#   set ant required environment variables\nENV ANT_HOME=\"/opt/ant\"\nENV PATH=\"${PATH}:/opt/ant/bin\"\n#   --- End of apache ant install\n#   set current working dir\nWORKDIR /opt\n#   All in one step to reduce image size growth :\n#   - add git package\n#   - clone main YaCy git repository (we need to clone git repository to generate correct version when building from source)\n#   - compile with apache ant\n#   - remove unnecessary and size consuming .git directory\n#   - delete git package and ant binary install\n#   Possible alternative : copy directly your current sources an remove git clone command from the following RUN\n#   COPY . /opt/yacy_search_server/\nRUN apk add --no-cache git \\\n && git clone https://github.com/yacy/yacy_search_server.git \\\n && ant compile -f /opt/yacy_search_server/build.xml \\\n && rm -rf /opt/yacy_search_server/.git \\\n && rm -rf /opt/ant \\\n && apk del git\nRUN sed -i \"/adminAccountBase64MD5=/c\\adminAccountBase64MD5=MD5:e672161ffdce91be4678605f4f4e6786\" /opt/yacy_search_server/defaults/yacy.init \\\n && sed -i \"/server.https=false/c\\server.https=true\" /opt/yacy_search_server/defaults/yacy.init \\\n && addgroup yacy \\\n && adduser -S -G yacy -H -D yacy \\\n && chown yacy:yacy -R /opt/yacy_search_server\n#   Expose HTTP and HTTPS default ports\nEXPOSE 8090/tcp 8443/tcp\n#   Set data volume : yacy data and configuration will persist aven after container stop or destruction\nVOLUME [\"/opt/yacy_search_server/DATA\"]\n#   Next commands run as yacy as non-root user for improved security\nUSER yacy\n#   Start yacy as a foreground process (-f) to display console logs and to wait for yacy process\nCMD [\"/bin/sh\", \"/opt/yacy_search_server/startYACY.sh\", \"-f\"]\n","originalDockerfileUglifiedHash":"14c8f634ce8f75e8c2735ab6a17a28d7","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/15ee1993a3bebdc97d28fab95dca7d35abf92dbf.dockerfile"}