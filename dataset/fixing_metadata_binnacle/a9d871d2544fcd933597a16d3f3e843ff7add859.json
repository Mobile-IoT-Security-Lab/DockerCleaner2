{"seed":532257835,"processedDockerfileHash":"9a85e365b5cde8be0536530f41f722a7","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM ubuntu:16.04\nMAINTAINER Jason Rivers <jason@jasonrivers.co.uk>\nENV NAGIOS_HOME=\"/opt/nagios\"\nENV NAGIOS_USER=\"nagios\"\nENV NAGIOS_GROUP=\"nagios\"\nENV NAGIOS_CMDUSER=\"nagios\"\nENV NAGIOS_CMDGROUP=\"nagios\"\nENV NAGIOS_FQDN=\"nagios.example.com\"\nENV NAGIOSADMIN_USER=\"nagiosadmin\"\nENV NAGIOSADMIN_PASS=\"nagios\"\nENV APACHE_RUN_USER=\"nagios\"\nENV APACHE_RUN_GROUP=\"nagios\"\nENV NAGIOS_TIMEZONE=\"UTC\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV NG_NAGIOS_CONFIG_FILE=\"${NAGIOS_HOME}/etc/nagios.cfg\"\nENV NG_CGI_DIR=\"${NAGIOS_HOME}/sbin\"\nENV NG_WWW_DIR=\"${NAGIOS_HOME}/share/nagiosgraph\"\nENV NG_CGI_URL=\"/cgi-bin\"\nENV NAGIOS_BRANCH=\"nagios-4.4.3\"\nENV NAGIOS_PLUGINS_BRANCH=\"release-2.2.1\"\nENV NRPE_BRANCH=\"nrpe-3.2.1\"\nRUN echo postfix postfix/main_mailer_type string \"'Internet Site'\" | debconf-set-selections \\\n && echo postfix postfix/mynetworks string \"127.0.0.0/8\" | debconf-set-selections \\\n && echo postfix postfix/mailname string ${NAGIOS_FQDN} | debconf-set-selections \\\n && apt-get update \\\n && apt-get install --no-install-recommends apache2=2.4.18-2ubuntu3.17 apache2-utils=2.4.18-2ubuntu3.17 autoconf=2.69-9 automake=1:1.15-4ubuntu1 bc=1.06.95-9build1 bsd-mailx=8.1.2-0.20160123cvs-2 build-essential=12.1ubuntu2 dnsutils=1:9.10.3.dfsg.P4-8ubuntu1.19 fping=3.13-1 gettext=0.19.7-2ubuntu3.1 git=1:2.7.4-0ubuntu1.10 gperf=3.0.4-2 iputils-ping=3:20121221-5ubuntu2 jq=1.5+dfsg-1ubuntu0.1 libapache2-mod-php=1:7.0+35ubuntu6.1 libcache-memcached-perl=1.30-1 libcgi-pm-perl=4.26-1 libdbd-mysql-perl=4.033-1ubuntu0.1 libdbi-dev=0.9.0-4 libdbi-perl=1.634-1ubuntu0.2 libfreeradius-client-dev=1.1.6-7 libgd2-xpm-dev libgd-gd2-perl libjson-perl=2.90-1 libldap2-dev=2.4.42+dfsg-2ubuntu3.13 libmysqlclient-dev=5.7.33-0ubuntu0.16.04.1 libnagios-object-perl=0.21.20-2 libnagios-plugin-perl=0.36-2 libnet-snmp-perl=6.0.1-2 libnet-snmp-perl=6.0.1-2 libnet-tftp-perl=0.19-1 libnet-xmpp-perl=1.02-5 libpq-dev=9.5.25-0ubuntu0.16.04.1 libredis-perl=2:1.9820-1 librrds-perl=1.5.5-4 libssl-dev=1.0.2g-1ubuntu4.20 libswitch-perl=2.17-2 libwww-perl=6.15-1 m4=1.4.17-5 netcat=1.10-41 parallel=20161222-1~ubuntu0.16.04.1 php-cli=1:7.0+35ubuntu6.1 php-gd=1:7.0+35ubuntu6.1 postfix=3.1.0-3ubuntu0.4 python-pip=8.1.1-2ubuntu0.6 rsyslog=8.16.0-1ubuntu3.1 runit=2.1.2-3ubuntu1 smbclient=2:4.3.11+dfsg-0ubuntu0.16.04.34 snmp=5.7.3+dfsg-1ubuntu4.6 snmpd=5.7.3+dfsg-1ubuntu4.6 snmp-mibs-downloader=1.1 unzip=6.0-20ubuntu1.1 python=2.7.12-1~16.04 -y \\\n && apt-get clean \\\n && rm -Rf /var/lib/apt/lists/*\nRUN (egrep -i \"^${NAGIOS_GROUP}\" /etc/group || groupadd $NAGIOS_GROUP ) \\\n && (egrep -i \"^${NAGIOS_CMDGROUP}\" /etc/group || groupadd $NAGIOS_CMDGROUP )\nRUN (id -u $NAGIOS_USER || useradd --system -d $NAGIOS_HOME -g $NAGIOS_GROUP $NAGIOS_USER ) \\\n && (id -u $NAGIOS_CMDUSER || useradd --system -d $NAGIOS_HOME -g $NAGIOS_CMDGROUP $NAGIOS_CMDUSER )\nRUN cd /tmp \\\n && git clone https://github.com/multiplay/qstat.git \\\n && cd qstat \\\n && ./autogen.sh \\\n && ./configure \\\n && make \\\n && make install \\\n && make clean \\\n && cd /tmp \\\n && rm -Rf qstat\nRUN cd /tmp \\\n && git clone https://github.com/NagiosEnterprises/nagioscore.git -b $NAGIOS_BRANCH \\\n && cd nagioscore \\\n && ./configure --prefix=${NAGIOS_HOME} --exec-prefix=${NAGIOS_HOME} --enable-event-broker --with-command-user=${NAGIOS_CMDUSER} --with-command-group=${NAGIOS_CMDGROUP} --with-nagios-user=${NAGIOS_USER} --with-nagios-group=${NAGIOS_GROUP} \\\n && make all \\\n && make install \\\n && make install-config \\\n && make install-commandmode \\\n && make install-webconf \\\n && make clean \\\n && cd /tmp \\\n && rm -Rf nagioscore\nRUN cd /tmp \\\n && git clone https://github.com/nagios-plugins/nagios-plugins.git -b $NAGIOS_PLUGINS_BRANCH \\\n && cd nagios-plugins \\\n && ./tools/setup \\\n && ./configure --prefix=${NAGIOS_HOME} --with-ipv6 --with-ping6-command=\"/bin/ping6 -n -U -W %d -c %d %s\" \\\n && make \\\n && make install \\\n && make clean \\\n && mkdir -p /usr/lib/nagios/plugins \\\n && ln -sf ${NAGIOS_HOME}/libexec/utils.pm /usr/lib/nagios/plugins \\\n && cd /tmp \\\n && rm -Rf nagios-plugins\nRUN wget -O ${NAGIOS_HOME}/libexec/check_ncpa.py https://raw.githubusercontent.com/NagiosEnterprises/ncpa/v2.0.5/client/check_ncpa.py \\\n && chmod +x ${NAGIOS_HOME}/libexec/check_ncpa.py\nRUN cd /tmp \\\n && git clone https://github.com/NagiosEnterprises/nrpe.git -b $NRPE_BRANCH \\\n && cd nrpe \\\n && ./configure --with-ssl=/usr/bin/openssl --with-ssl-lib=/usr/lib/x86_64-linux-gnu \\\n && make check_nrpe \\\n && cp src/check_nrpe ${NAGIOS_HOME}/libexec/ \\\n && make clean \\\n && cd /tmp \\\n && rm -Rf nrpe\nRUN cd /tmp \\\n && git clone https://git.code.sf.net/p/nagiosgraph/git nagiosgraph \\\n && cd nagiosgraph \\\n && ./install.pl --install --prefix /opt/nagiosgraph --nagios-user ${NAGIOS_USER} --www-user ${NAGIOS_USER} --nagios-perfdata-file ${NAGIOS_HOME}/var/perfdata.log --nagios-cgi-url /cgi-bin \\\n && cp share/nagiosgraph.ssi ${NAGIOS_HOME}/share/ssi/common-header.ssi \\\n && cd /tmp \\\n && rm -Rf nagiosgraph\nRUN cd /opt \\\n && pip install pymssql==2.2.7 \\\n && git clone https://github.com/willixix/naglio-plugins.git WL-Nagios-Plugins \\\n && git clone https://github.com/JasonRivers/nagios-plugins.git JR-Nagios-Plugins \\\n && git clone https://github.com/justintime/nagios-plugins.git JE-Nagios-Plugins \\\n && git clone https://github.com/nagiosenterprises/check_mssql_collection.git nagios-mssql \\\n && chmod +x /opt/WL-Nagios-Plugins/check* \\\n && chmod +x /opt/JE-Nagios-Plugins/check_mem/check_mem.pl \\\n && cp /opt/JE-Nagios-Plugins/check_mem/check_mem.pl ${NAGIOS_HOME}/libexec/ \\\n && cp /opt/nagios-mssql/check_mssql_database.py ${NAGIOS_HOME}/libexec/ \\\n && cp /opt/nagios-mssql/check_mssql_server.py ${NAGIOS_HOME}/libexec/\nRUN sed -i.bak 's/.*\\=www\\-data//g' /etc/apache2/envvars\nRUN export DOC_ROOT=\"DocumentRoot $( echo $NAGIOS_HOME/share ;)\" \\\n && sed -i \"s,DocumentRoot.*,$DOC_ROOT,\" /etc/apache2/sites-enabled/000-default.conf \\\n && sed -i \"s,</VirtualHost>,<IfDefine ENABLE_USR_LIB_CGI_BIN>\\nScriptAlias /cgi-bin/ ${NAGIOS_HOME}/sbin/\\n</IfDefine>\\n</VirtualHost>,\" /etc/apache2/sites-enabled/000-default.conf \\\n && ln -s /etc/apache2/mods-available/cgi.load /etc/apache2/mods-enabled/cgi.load\nRUN mkdir -p -m 0755 /usr/share/snmp/mibs \\\n && mkdir -p ${NAGIOS_HOME}/etc/conf.d \\\n && mkdir -p ${NAGIOS_HOME}/etc/monitor \\\n && mkdir -p -m 700 ${NAGIOS_HOME}/.ssh \\\n && chown ${NAGIOS_USER}:${NAGIOS_GROUP} ${NAGIOS_HOME}/.ssh \\\n && touch /usr/share/snmp/mibs/.foo \\\n && ln -s /usr/share/snmp/mibs ${NAGIOS_HOME}/libexec/mibs \\\n && ln -s ${NAGIOS_HOME}/bin/nagios /usr/local/bin/nagios \\\n && download-mibs \\\n && echo \"mibs +ALL\" > /etc/snmp/snmp.conf\nRUN sed -i 's,/bin/mail,/usr/bin/mail,' ${NAGIOS_HOME}/etc/objects/commands.cfg \\\n && sed -i 's,/usr/usr,/usr,' ${NAGIOS_HOME}/etc/objects/commands.cfg\nRUN cp /etc/services /var/spool/postfix/etc/ \\\n && echo \"smtp_address_preference = ipv4\" >> /etc/postfix/main.cf\nRUN rm -rf /etc/rsyslog.d /etc/rsyslog.conf\nRUN rm -rf /etc/sv/getty-5\nCOPY overlay /\nRUN echo \"use_timezone=${NAGIOS_TIMEZONE}\" >> ${NAGIOS_HOME}/etc/nagios.cfg\n#   Copy example config in-case the user has started with empty var or etc\nRUN mkdir -p /orig/var \\\n && mkdir -p /orig/etc \\\n && cp -Rp ${NAGIOS_HOME}/var/* /orig/var/ \\\n && cp -Rp ${NAGIOS_HOME}/etc/* /orig/etc/\nRUN a2enmod session \\\n && a2enmod session_cookie \\\n && a2enmod session_crypto \\\n && a2enmod auth_form \\\n && a2enmod request\nRUN chmod +x /usr/local/bin/start_nagios \\\n && chmod +x /etc/sv/apache/run \\\n && chmod +x /etc/sv/nagios/run \\\n && chmod +x /etc/sv/postfix/run \\\n && chmod +x /etc/sv/rsyslog/run \\\n && chmod +x /opt/nagiosgraph/etc/fix-nagiosgraph-multiple-selection.sh\nRUN cd /opt/nagiosgraph/etc \\\n && sh fix-nagiosgraph-multiple-selection.sh\nRUN rm /opt/nagiosgraph/etc/fix-nagiosgraph-multiple-selection.sh\n#   enable all runit services\nRUN ln -s /etc/sv/* /etc/service\nENV APACHE_LOCK_DIR=\"/var/run\"\nENV APACHE_LOG_DIR=\"/var/log/apache2\"\n#  Set ServerName and timezone for Apache\nRUN echo \"ServerName ${NAGIOS_FQDN}\" > /etc/apache2/conf-available/servername.conf \\\n && echo \"PassEnv TZ\" > /etc/apache2/conf-available/timezone.conf \\\n && ln -s /etc/apache2/conf-available/servername.conf /etc/apache2/conf-enabled/servername.conf \\\n && ln -s /etc/apache2/conf-available/timezone.conf /etc/apache2/conf-enabled/timezone.conf\nEXPOSE 80/tcp\nVOLUME \"${NAGIOS_HOME}/var\" \"${NAGIOS_HOME}/etc\" \"/var/log/apache2\" \"/opt/Custom-Nagios-Plugins\" \"/opt/nagiosgraph/var\" \"/opt/nagiosgraph/etc\"\nCMD [\"/usr/local/bin/start_nagios\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ubuntu:16.04\nMAINTAINER Jason Rivers <jason@jasonrivers.co.uk>\nENV NAGIOS_HOME=\"/opt/nagios\"\nENV NAGIOS_USER=\"nagios\"\nENV NAGIOS_GROUP=\"nagios\"\nENV NAGIOS_CMDUSER=\"nagios\"\nENV NAGIOS_CMDGROUP=\"nagios\"\nENV NAGIOS_FQDN=\"nagios.example.com\"\nENV NAGIOSADMIN_USER=\"nagiosadmin\"\nENV NAGIOSADMIN_PASS=\"nagios\"\nENV APACHE_RUN_USER=\"nagios\"\nENV APACHE_RUN_GROUP=\"nagios\"\nENV NAGIOS_TIMEZONE=\"UTC\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV NG_NAGIOS_CONFIG_FILE=\"${NAGIOS_HOME}/etc/nagios.cfg\"\nENV NG_CGI_DIR=\"${NAGIOS_HOME}/sbin\"\nENV NG_WWW_DIR=\"${NAGIOS_HOME}/share/nagiosgraph\"\nENV NG_CGI_URL=\"/cgi-bin\"\nENV NAGIOS_BRANCH=\"nagios-4.4.3\"\nENV NAGIOS_PLUGINS_BRANCH=\"release-2.2.1\"\nENV NRPE_BRANCH=\"nrpe-3.2.1\"\nRUN echo postfix postfix/main_mailer_type string \"'Internet Site'\" | debconf-set-selections \\\n && echo postfix postfix/mynetworks string \"127.0.0.0/8\" | debconf-set-selections \\\n && echo postfix postfix/mailname string ${NAGIOS_FQDN} | debconf-set-selections \\\n && apt-get update \\\n && apt-get install apache2 apache2-utils autoconf automake bc bsd-mailx build-essential dnsutils fping gettext git gperf iputils-ping jq libapache2-mod-php libcache-memcached-perl libcgi-pm-perl libdbd-mysql-perl libdbi-dev libdbi-perl libfreeradius-client-dev libgd2-xpm-dev libgd-gd2-perl libjson-perl libldap2-dev libmysqlclient-dev libnagios-object-perl libnagios-plugin-perl libnet-snmp-perl libnet-snmp-perl libnet-tftp-perl libnet-xmpp-perl libpq-dev libredis-perl librrds-perl libssl-dev libswitch-perl libwww-perl m4 netcat parallel php-cli php-gd postfix python-pip rsyslog runit smbclient snmp snmpd snmp-mibs-downloader unzip python -y \\\n && apt-get clean \\\n && rm -Rf /var/lib/apt/lists/*\nRUN (egrep -i \"^${NAGIOS_GROUP}\" /etc/group || groupadd $NAGIOS_GROUP ) \\\n && (egrep -i \"^${NAGIOS_CMDGROUP}\" /etc/group || groupadd $NAGIOS_CMDGROUP )\nRUN (id -u $NAGIOS_USER || useradd --system -d $NAGIOS_HOME -g $NAGIOS_GROUP $NAGIOS_USER ) \\\n && (id -u $NAGIOS_CMDUSER || useradd --system -d $NAGIOS_HOME -g $NAGIOS_CMDGROUP $NAGIOS_CMDUSER )\nRUN cd /tmp \\\n && git clone https://github.com/multiplay/qstat.git \\\n && cd qstat \\\n && ./autogen.sh \\\n && ./configure \\\n && make \\\n && make install \\\n && make clean \\\n && cd /tmp \\\n && rm -Rf qstat\nRUN cd /tmp \\\n && git clone https://github.com/NagiosEnterprises/nagioscore.git -b $NAGIOS_BRANCH \\\n && cd nagioscore \\\n && ./configure --prefix=${NAGIOS_HOME} --exec-prefix=${NAGIOS_HOME} --enable-event-broker --with-command-user=${NAGIOS_CMDUSER} --with-command-group=${NAGIOS_CMDGROUP} --with-nagios-user=${NAGIOS_USER} --with-nagios-group=${NAGIOS_GROUP} \\\n && make all \\\n && make install \\\n && make install-config \\\n && make install-commandmode \\\n && make install-webconf \\\n && make clean \\\n && cd /tmp \\\n && rm -Rf nagioscore\nRUN cd /tmp \\\n && git clone https://github.com/nagios-plugins/nagios-plugins.git -b $NAGIOS_PLUGINS_BRANCH \\\n && cd nagios-plugins \\\n && ./tools/setup \\\n && ./configure --prefix=${NAGIOS_HOME} --with-ipv6 --with-ping6-command=\"/bin/ping6 -n -U -W %d -c %d %s\" \\\n && make \\\n && make install \\\n && make clean \\\n && mkdir -p /usr/lib/nagios/plugins \\\n && ln -sf ${NAGIOS_HOME}/libexec/utils.pm /usr/lib/nagios/plugins \\\n && cd /tmp \\\n && rm -Rf nagios-plugins\nRUN wget -O ${NAGIOS_HOME}/libexec/check_ncpa.py https://raw.githubusercontent.com/NagiosEnterprises/ncpa/v2.0.5/client/check_ncpa.py \\\n && chmod +x ${NAGIOS_HOME}/libexec/check_ncpa.py\nRUN cd /tmp \\\n && git clone https://github.com/NagiosEnterprises/nrpe.git -b $NRPE_BRANCH \\\n && cd nrpe \\\n && ./configure --with-ssl=/usr/bin/openssl --with-ssl-lib=/usr/lib/x86_64-linux-gnu \\\n && make check_nrpe \\\n && cp src/check_nrpe ${NAGIOS_HOME}/libexec/ \\\n && make clean \\\n && cd /tmp \\\n && rm -Rf nrpe\nRUN cd /tmp \\\n && git clone https://git.code.sf.net/p/nagiosgraph/git nagiosgraph \\\n && cd nagiosgraph \\\n && ./install.pl --install --prefix /opt/nagiosgraph --nagios-user ${NAGIOS_USER} --www-user ${NAGIOS_USER} --nagios-perfdata-file ${NAGIOS_HOME}/var/perfdata.log --nagios-cgi-url /cgi-bin \\\n && cp share/nagiosgraph.ssi ${NAGIOS_HOME}/share/ssi/common-header.ssi \\\n && cd /tmp \\\n && rm -Rf nagiosgraph\nRUN cd /opt \\\n && pip install pymssql \\\n && git clone https://github.com/willixix/naglio-plugins.git WL-Nagios-Plugins \\\n && git clone https://github.com/JasonRivers/nagios-plugins.git JR-Nagios-Plugins \\\n && git clone https://github.com/justintime/nagios-plugins.git JE-Nagios-Plugins \\\n && git clone https://github.com/nagiosenterprises/check_mssql_collection.git nagios-mssql \\\n && chmod +x /opt/WL-Nagios-Plugins/check* \\\n && chmod +x /opt/JE-Nagios-Plugins/check_mem/check_mem.pl \\\n && cp /opt/JE-Nagios-Plugins/check_mem/check_mem.pl ${NAGIOS_HOME}/libexec/ \\\n && cp /opt/nagios-mssql/check_mssql_database.py ${NAGIOS_HOME}/libexec/ \\\n && cp /opt/nagios-mssql/check_mssql_server.py ${NAGIOS_HOME}/libexec/\nRUN sed -i.bak 's/.*\\=www\\-data//g' /etc/apache2/envvars\nRUN export DOC_ROOT=\"DocumentRoot $( echo $NAGIOS_HOME/share ;)\" \\\n && sed -i \"s,DocumentRoot.*,$DOC_ROOT,\" /etc/apache2/sites-enabled/000-default.conf \\\n && sed -i \"s,</VirtualHost>,<IfDefine ENABLE_USR_LIB_CGI_BIN>\\nScriptAlias /cgi-bin/ ${NAGIOS_HOME}/sbin/\\n</IfDefine>\\n</VirtualHost>,\" /etc/apache2/sites-enabled/000-default.conf \\\n && ln -s /etc/apache2/mods-available/cgi.load /etc/apache2/mods-enabled/cgi.load\nRUN mkdir -p -m 0755 /usr/share/snmp/mibs \\\n && mkdir -p ${NAGIOS_HOME}/etc/conf.d \\\n && mkdir -p ${NAGIOS_HOME}/etc/monitor \\\n && mkdir -p -m 700 ${NAGIOS_HOME}/.ssh \\\n && chown ${NAGIOS_USER}:${NAGIOS_GROUP} ${NAGIOS_HOME}/.ssh \\\n && touch /usr/share/snmp/mibs/.foo \\\n && ln -s /usr/share/snmp/mibs ${NAGIOS_HOME}/libexec/mibs \\\n && ln -s ${NAGIOS_HOME}/bin/nagios /usr/local/bin/nagios \\\n && download-mibs \\\n && echo \"mibs +ALL\" > /etc/snmp/snmp.conf\nRUN sed -i 's,/bin/mail,/usr/bin/mail,' ${NAGIOS_HOME}/etc/objects/commands.cfg \\\n && sed -i 's,/usr/usr,/usr,' ${NAGIOS_HOME}/etc/objects/commands.cfg\nRUN cp /etc/services /var/spool/postfix/etc/ \\\n && echo \"smtp_address_preference = ipv4\" >> /etc/postfix/main.cf\nRUN rm -rf /etc/rsyslog.d /etc/rsyslog.conf\nRUN rm -rf /etc/sv/getty-5\nADD overlay /\nRUN echo \"use_timezone=${NAGIOS_TIMEZONE}\" >> ${NAGIOS_HOME}/etc/nagios.cfg\n#  Copy example config in-case the user has started with empty var or etc\nRUN mkdir -p /orig/var \\\n && mkdir -p /orig/etc \\\n && cp -Rp ${NAGIOS_HOME}/var/* /orig/var/ \\\n && cp -Rp ${NAGIOS_HOME}/etc/* /orig/etc/\nRUN a2enmod session \\\n && a2enmod session_cookie \\\n && a2enmod session_crypto \\\n && a2enmod auth_form \\\n && a2enmod request\nRUN chmod +x /usr/local/bin/start_nagios \\\n && chmod +x /etc/sv/apache/run \\\n && chmod +x /etc/sv/nagios/run \\\n && chmod +x /etc/sv/postfix/run \\\n && chmod +x /etc/sv/rsyslog/run \\\n && chmod +x /opt/nagiosgraph/etc/fix-nagiosgraph-multiple-selection.sh\nRUN cd /opt/nagiosgraph/etc \\\n && sh fix-nagiosgraph-multiple-selection.sh\nRUN rm /opt/nagiosgraph/etc/fix-nagiosgraph-multiple-selection.sh\n#  enable all runit services\nRUN ln -s /etc/sv/* /etc/service\nENV APACHE_LOCK_DIR=\"/var/run\"\nENV APACHE_LOG_DIR=\"/var/log/apache2\"\n# Set ServerName and timezone for Apache\nRUN echo \"ServerName ${NAGIOS_FQDN}\" > /etc/apache2/conf-available/servername.conf \\\n && echo \"PassEnv TZ\" > /etc/apache2/conf-available/timezone.conf \\\n && ln -s /etc/apache2/conf-available/servername.conf /etc/apache2/conf-enabled/servername.conf \\\n && ln -s /etc/apache2/conf-available/timezone.conf /etc/apache2/conf-enabled/timezone.conf\nEXPOSE 80/tcp\nVOLUME \"${NAGIOS_HOME}/var\" \"${NAGIOS_HOME}/etc\" \"/var/log/apache2\" \"/opt/Custom-Nagios-Plugins\" \"/opt/nagiosgraph/var\" \"/opt/nagiosgraph/etc\"\nCMD [\"/usr/local/bin/start_nagios\"]\n","injectedSmells":[],"originalDockerfileHash":"0d7967de6838ca02a1541bcb1fb99c2b","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:16.04\nMAINTAINER Jason Rivers <jason@jasonrivers.co.uk>\nENV NAGIOS_HOME=\"/opt/nagios\"\nENV NAGIOS_USER=\"nagios\"\nENV NAGIOS_GROUP=\"nagios\"\nENV NAGIOS_CMDUSER=\"nagios\"\nENV NAGIOS_CMDGROUP=\"nagios\"\nENV NAGIOS_FQDN=\"nagios.example.com\"\nENV NAGIOSADMIN_USER=\"nagiosadmin\"\nENV NAGIOSADMIN_PASS=\"nagios\"\nENV APACHE_RUN_USER=\"nagios\"\nENV APACHE_RUN_GROUP=\"nagios\"\nENV NAGIOS_TIMEZONE=\"UTC\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV NG_NAGIOS_CONFIG_FILE=\"${NAGIOS_HOME}/etc/nagios.cfg\"\nENV NG_CGI_DIR=\"${NAGIOS_HOME}/sbin\"\nENV NG_WWW_DIR=\"${NAGIOS_HOME}/share/nagiosgraph\"\nENV NG_CGI_URL=\"/cgi-bin\"\nENV NAGIOS_BRANCH=\"nagios-4.4.3\"\nENV NAGIOS_PLUGINS_BRANCH=\"release-2.2.1\"\nENV NRPE_BRANCH=\"nrpe-3.2.1\"\nRUN echo postfix postfix/main_mailer_type string \"'Internet Site'\" | debconf-set-selections \\\n && echo postfix postfix/mynetworks string \"127.0.0.0/8\" | debconf-set-selections \\\n && echo postfix postfix/mailname string ${NAGIOS_FQDN} | debconf-set-selections \\\n && apt-get update \\\n && apt-get install apache2 apache2-utils autoconf automake bc bsd-mailx build-essential dnsutils fping gettext git gperf iputils-ping jq libapache2-mod-php libcache-memcached-perl libcgi-pm-perl libdbd-mysql-perl libdbi-dev libdbi-perl libfreeradius-client-dev libgd2-xpm-dev libgd-gd2-perl libjson-perl libldap2-dev libmysqlclient-dev libnagios-object-perl libnagios-plugin-perl libnet-snmp-perl libnet-snmp-perl libnet-tftp-perl libnet-xmpp-perl libpq-dev libredis-perl librrds-perl libssl-dev libswitch-perl libwww-perl m4 netcat parallel php-cli php-gd postfix python-pip rsyslog runit smbclient snmp snmpd snmp-mibs-downloader unzip python -y \\\n && apt-get clean \\\n && rm -Rf /var/lib/apt/lists/*\nRUN (egrep -i \"^${NAGIOS_GROUP}\" /etc/group || groupadd $NAGIOS_GROUP ) \\\n && (egrep -i \"^${NAGIOS_CMDGROUP}\" /etc/group || groupadd $NAGIOS_CMDGROUP )\nRUN (id -u $NAGIOS_USER || useradd --system -d $NAGIOS_HOME -g $NAGIOS_GROUP $NAGIOS_USER ) \\\n && (id -u $NAGIOS_CMDUSER || useradd --system -d $NAGIOS_HOME -g $NAGIOS_CMDGROUP $NAGIOS_CMDUSER )\nRUN cd /tmp \\\n && git clone https://github.com/multiplay/qstat.git \\\n && cd qstat \\\n && ./autogen.sh \\\n && ./configure \\\n && make \\\n && make install \\\n && make clean \\\n && cd /tmp \\\n && rm -Rf qstat\nRUN cd /tmp \\\n && git clone https://github.com/NagiosEnterprises/nagioscore.git -b $NAGIOS_BRANCH \\\n && cd nagioscore \\\n && ./configure --prefix=${NAGIOS_HOME} --exec-prefix=${NAGIOS_HOME} --enable-event-broker --with-command-user=${NAGIOS_CMDUSER} --with-command-group=${NAGIOS_CMDGROUP} --with-nagios-user=${NAGIOS_USER} --with-nagios-group=${NAGIOS_GROUP} \\\n && make all \\\n && make install \\\n && make install-config \\\n && make install-commandmode \\\n && make install-webconf \\\n && make clean \\\n && cd /tmp \\\n && rm -Rf nagioscore\nRUN cd /tmp \\\n && git clone https://github.com/nagios-plugins/nagios-plugins.git -b $NAGIOS_PLUGINS_BRANCH \\\n && cd nagios-plugins \\\n && ./tools/setup \\\n && ./configure --prefix=${NAGIOS_HOME} --with-ipv6 --with-ping6-command=\"/bin/ping6 -n -U -W %d -c %d %s\" \\\n && make \\\n && make install \\\n && make clean \\\n && mkdir -p /usr/lib/nagios/plugins \\\n && ln -sf ${NAGIOS_HOME}/libexec/utils.pm /usr/lib/nagios/plugins \\\n && cd /tmp \\\n && rm -Rf nagios-plugins\nRUN wget -O ${NAGIOS_HOME}/libexec/check_ncpa.py https://raw.githubusercontent.com/NagiosEnterprises/ncpa/v2.0.5/client/check_ncpa.py \\\n && chmod +x ${NAGIOS_HOME}/libexec/check_ncpa.py\nRUN cd /tmp \\\n && git clone https://github.com/NagiosEnterprises/nrpe.git -b $NRPE_BRANCH \\\n && cd nrpe \\\n && ./configure --with-ssl=/usr/bin/openssl --with-ssl-lib=/usr/lib/x86_64-linux-gnu \\\n && make check_nrpe \\\n && cp src/check_nrpe ${NAGIOS_HOME}/libexec/ \\\n && make clean \\\n && cd /tmp \\\n && rm -Rf nrpe\nRUN cd /tmp \\\n && git clone https://git.code.sf.net/p/nagiosgraph/git nagiosgraph \\\n && cd nagiosgraph \\\n && ./install.pl --install --prefix /opt/nagiosgraph --nagios-user ${NAGIOS_USER} --www-user ${NAGIOS_USER} --nagios-perfdata-file ${NAGIOS_HOME}/var/perfdata.log --nagios-cgi-url /cgi-bin \\\n && cp share/nagiosgraph.ssi ${NAGIOS_HOME}/share/ssi/common-header.ssi \\\n && cd /tmp \\\n && rm -Rf nagiosgraph\nRUN cd /opt \\\n && pip install pymssql \\\n && git clone https://github.com/willixix/naglio-plugins.git WL-Nagios-Plugins \\\n && git clone https://github.com/JasonRivers/nagios-plugins.git JR-Nagios-Plugins \\\n && git clone https://github.com/justintime/nagios-plugins.git JE-Nagios-Plugins \\\n && git clone https://github.com/nagiosenterprises/check_mssql_collection.git nagios-mssql \\\n && chmod +x /opt/WL-Nagios-Plugins/check* \\\n && chmod +x /opt/JE-Nagios-Plugins/check_mem/check_mem.pl \\\n && cp /opt/JE-Nagios-Plugins/check_mem/check_mem.pl ${NAGIOS_HOME}/libexec/ \\\n && cp /opt/nagios-mssql/check_mssql_database.py ${NAGIOS_HOME}/libexec/ \\\n && cp /opt/nagios-mssql/check_mssql_server.py ${NAGIOS_HOME}/libexec/\nRUN sed -i.bak 's/.*\\=www\\-data//g' /etc/apache2/envvars\nRUN export DOC_ROOT=\"DocumentRoot $( echo $NAGIOS_HOME/share ;)\" \\\n && sed -i \"s,DocumentRoot.*,$DOC_ROOT,\" /etc/apache2/sites-enabled/000-default.conf \\\n && sed -i \"s,</VirtualHost>,<IfDefine ENABLE_USR_LIB_CGI_BIN>\\nScriptAlias /cgi-bin/ ${NAGIOS_HOME}/sbin/\\n</IfDefine>\\n</VirtualHost>,\" /etc/apache2/sites-enabled/000-default.conf \\\n && ln -s /etc/apache2/mods-available/cgi.load /etc/apache2/mods-enabled/cgi.load\nRUN mkdir -p -m 0755 /usr/share/snmp/mibs \\\n && mkdir -p ${NAGIOS_HOME}/etc/conf.d \\\n && mkdir -p ${NAGIOS_HOME}/etc/monitor \\\n && mkdir -p -m 700 ${NAGIOS_HOME}/.ssh \\\n && chown ${NAGIOS_USER}:${NAGIOS_GROUP} ${NAGIOS_HOME}/.ssh \\\n && touch /usr/share/snmp/mibs/.foo \\\n && ln -s /usr/share/snmp/mibs ${NAGIOS_HOME}/libexec/mibs \\\n && ln -s ${NAGIOS_HOME}/bin/nagios /usr/local/bin/nagios \\\n && download-mibs \\\n && echo \"mibs +ALL\" > /etc/snmp/snmp.conf\nRUN sed -i 's,/bin/mail,/usr/bin/mail,' ${NAGIOS_HOME}/etc/objects/commands.cfg \\\n && sed -i 's,/usr/usr,/usr,' ${NAGIOS_HOME}/etc/objects/commands.cfg\nRUN cp /etc/services /var/spool/postfix/etc/ \\\n && echo \"smtp_address_preference = ipv4\" >> /etc/postfix/main.cf\nRUN rm -rf /etc/rsyslog.d /etc/rsyslog.conf\nRUN rm -rf /etc/sv/getty-5\nADD overlay /\nRUN echo \"use_timezone=${NAGIOS_TIMEZONE}\" >> ${NAGIOS_HOME}/etc/nagios.cfg\n#   Copy example config in-case the user has started with empty var or etc\nRUN mkdir -p /orig/var \\\n && mkdir -p /orig/etc \\\n && cp -Rp ${NAGIOS_HOME}/var/* /orig/var/ \\\n && cp -Rp ${NAGIOS_HOME}/etc/* /orig/etc/\nRUN a2enmod session \\\n && a2enmod session_cookie \\\n && a2enmod session_crypto \\\n && a2enmod auth_form \\\n && a2enmod request\nRUN chmod +x /usr/local/bin/start_nagios \\\n && chmod +x /etc/sv/apache/run \\\n && chmod +x /etc/sv/nagios/run \\\n && chmod +x /etc/sv/postfix/run \\\n && chmod +x /etc/sv/rsyslog/run \\\n && chmod +x /opt/nagiosgraph/etc/fix-nagiosgraph-multiple-selection.sh\nRUN cd /opt/nagiosgraph/etc \\\n && sh fix-nagiosgraph-multiple-selection.sh\nRUN rm /opt/nagiosgraph/etc/fix-nagiosgraph-multiple-selection.sh\n#   enable all runit services\nRUN ln -s /etc/sv/* /etc/service\nENV APACHE_LOCK_DIR=\"/var/run\"\nENV APACHE_LOG_DIR=\"/var/log/apache2\"\n#  Set ServerName and timezone for Apache\nRUN echo \"ServerName ${NAGIOS_FQDN}\" > /etc/apache2/conf-available/servername.conf \\\n && echo \"PassEnv TZ\" > /etc/apache2/conf-available/timezone.conf \\\n && ln -s /etc/apache2/conf-available/servername.conf /etc/apache2/conf-enabled/servername.conf \\\n && ln -s /etc/apache2/conf-available/timezone.conf /etc/apache2/conf-enabled/timezone.conf\nEXPOSE 80/tcp\nVOLUME \"${NAGIOS_HOME}/var\" \"${NAGIOS_HOME}/etc\" \"/var/log/apache2\" \"/opt/Custom-Nagios-Plugins\" \"/opt/nagiosgraph/var\" \"/opt/nagiosgraph/etc\"\nCMD [\"/usr/local/bin/start_nagios\"]\n","originalDockerfileUglifiedHash":"7fdf36637c44d8de62e6b47e9c1760f9","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/a9d871d2544fcd933597a16d3f3e843ff7add859.dockerfile"}