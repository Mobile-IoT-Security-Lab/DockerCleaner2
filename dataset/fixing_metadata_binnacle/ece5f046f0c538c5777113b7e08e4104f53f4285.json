{"seed":90058041,"processedDockerfileHash":"b48ab2ec8dc0a39a71888968e6b7cd29","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-user"],"processedDockerfile":"FROM alpine:3.5\nMAINTAINER mail@racktear.com\nRUN addgroup -S tarantool \\\n && adduser -S -G tarantool tarantool \\\n && apk add 'su-exec>=0.2' --no-cache\nENV TARANTOOL_VERSION=\"1.6.9-11-gf4619d0\" \\\n    TARANTOOL_DOWNLOAD_URL=\"https://github.com/tarantool/tarantool.git\" \\\n    TARANTOOL_INSTALL_LUADIR=\"/usr/local/share/tarantool\" \\\n    CURL_REPO=\"https://github.com/curl/curl.git\" \\\n    CURL_TAG=\"curl-7_59_0\" \\\n    GPERFTOOLS_REPO=\"https://github.com/gperftools/gperftools.git\" \\\n    GPERFTOOLS_TAG=\"gperftools-2.5\" \\\n    LUAROCKS_URL=\"http://keplerproject.github.io/luarocks/releases/luarocks-2.3.0.tar.gz\" \\\n    LUAROCK_AVRO_SCHEMA_REPO=\"https://github.com/tarantool/avro-schema.git\" \\\n    LUAROCK_AVRO_SCHEMA_TAG=\"b49efa8\" \\\n    LUAROCK_EXPIRATIOND_REPO=\"https://github.com/tarantool/expirationd.git\" \\\n    LUAROCK_EXPIRATIOND_TAG=\"9ec22b6\" \\\n    LUAROCK_QUEUE_REPO=\"https://github.com/tarantool/queue.git\" \\\n    LUAROCK_QUEUE_TAG=\"24d730c\" \\\n    LUAROCK_CONNPOOL_REPO=\"https://github.com/tarantool/connpool.git\" \\\n    LUAROCK_CONNPOOL_TAG=\"685af44\" \\\n    LUAROCK_SHARD_REPO=\"https://github.com/tarantool/shard.git\" \\\n    LUAROCK_SHARD_TAG=\"278b906\" \\\n    LUAROCK_HTTP_REPO=\"https://github.com/tarantool/http.git\" \\\n    LUAROCK_HTTP_TAG=\"67d8a9b\" \\\n    LUAROCK_PG_REPO=\"https://github.com/tarantool/pg.git\" \\\n    LUAROCK_PG_TAG=\"43a7130\" \\\n    LUAROCK_MYSQL_REPO=\"https://github.com/tarantool/mysql.git\" \\\n    LUAROCK_MYSQL_TAG=\"1c15d30\" \\\n    LUAROCK_MEMCACHED_REPO=\"https://github.com/tarantool/memcached.git\" \\\n    LUAROCK_MEMCACHED_TAG=\"c927626\" \\\n    LUAROCK_TARANTOOL_PROMETHEUS_REPO=\"https://github.com/tarantool/prometheus.git\" \\\n    LUAROCK_TARANTOOL_PROMETHEUS_TAG=\"0654304\" \\\n    LUAROCK_TARANTOOL_CURL_REPO=\"https://github.com/tarantool/curl.git\" \\\n    LUAROCK_TARANTOOL_CURL_TAG=\"2.2.7\" \\\n    LUAROCK_MQTT_REPO=\"https://github.com/tarantool/mqtt.git\" \\\n    LUAROCK_MQTT_TAG=\"238fd2e\" \\\n    LUAROCK_TARANTOOL_GIS_REPO=\"https://github.com/tarantool/gis.git\" \\\n    LUAROCK_TARANTOOL_GIS_TAG=\"25209fc\" \\\n    LUAROCK_GPERFTOOLS_REPO=\"https://github.com/tarantool/gperftools.git\" \\\n    LUAROCK_GPERFTOOLS_TAG=\"12a7ac2\"\nCOPY gperftools_alpine.diff /\nRUN set -x \\\n && apk add libstdc++=6.2.1-r1 readline=6.3.008-r4 libressl=2.4.4-r0 yaml=0.1.7-r0 lz4=131-r0 binutils=2.27-r1 ncurses=6.0_p20171125-r1 libgomp=6.2.1-r1 lua=5.1.5-r4 tar=1.29-r1 zip=3.0-r4 ca-certificates=20161130-r1 --no-cache --virtual .run-deps \\\n && apk add gcc=6.2.1-r1 g++=6.2.1-r1 cmake=3.6.3-r0 readline-dev=6.3.008-r4 libressl-dev=2.4.4-r0 yaml-dev=0.1.7-r0 lz4-dev=131-r0 binutils-dev=2.27-r1 ncurses-dev=6.0_p20171125-r1 lua-dev=5.1.5-r4 musl-dev=1.1.15-r8 make=4.2.1-r0 git=2.11.3-r2 libunwind-dev=1.2_rc1-r0 autoconf=2.69-r0 automake=1.15-r0 libtool=2.4.6-r1 linux-headers=4.4.6-r1 go=1.7.3-r0 wget=1.18-r4 --no-cache --virtual .build-deps \\\n && : \"---------- curl ----------\" \\\n && mkdir -p /usr/src/curl \\\n && git clone \"$CURL_REPO\" /usr/src/curl \\\n && git -C /usr/src/curl checkout \"$CURL_TAG\" \\\n && (cd /usr/src/curl \\\n && ./buildconf \\\n && ./configure --prefix \"/usr/local\" \\\n && make -j \\\n && make install ) \\\n && : \"---------- gperftools ----------\" \\\n && mkdir -p /usr/src/gperftools \\\n && git clone \"$GPERFTOOLS_REPO\" /usr/src/gperftools \\\n && git -C /usr/src/gperftools checkout \"$GPERFTOOLS_TAG\" \\\n && (cd /usr/src/gperftools ;patch -p1 < /gperftools_alpine.diff;rm /gperftools_alpine.diff ;./autogen.sh ;./configure ;make ;cp .libs/libprofiler.so* /usr/local/lib ) \\\n && (GOPATH=/usr/src/go go get github.com/google/pprof ;cp /usr/src/go/bin/pprof /usr/local/bin ) \\\n && : \"---------- tarantool ----------\" \\\n && mkdir -p /usr/src/tarantool \\\n && git clone \"$TARANTOOL_DOWNLOAD_URL\" /usr/src/tarantool \\\n && git -C /usr/src/tarantool checkout \"$TARANTOOL_VERSION\" \\\n && git -C /usr/src/tarantool submodule update --init --recursive \\\n && (cd /usr/src/tarantool ;cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_BUNDLED_LIBYAML:BOOL=OFF -DENABLE_BACKTRACE:BOOL=ON -DENABLE_DIST:BOOL=ON . ) \\\n && make -C /usr/src/tarantool -j \\\n && make -C /usr/src/tarantool install \\\n && make -C /usr/src/tarantool clean \\\n && : \"---------- small ----------\" \\\n && (cd /usr/src/tarantool/src/lib/small ;cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_INSTALL_LIBDIR=lib -DCMAKE_BUILD_TYPE=RelWithDebInfo . ) \\\n && make -C /usr/src/tarantool/src/lib/small \\\n && make -C /usr/src/tarantool/src/lib/small install \\\n && make -C /usr/src/tarantool/src/lib/small clean \\\n && : \"---------- msgpuck ----------\" \\\n && (cd /usr/src/tarantool/src/lib/msgpuck ;cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_INSTALL_LIBDIR=lib -DCMAKE_BUILD_TYPE=RelWithDebInfo . ) \\\n && make -C /usr/src/tarantool/src/lib/msgpuck \\\n && make -C /usr/src/tarantool/src/lib/msgpuck install \\\n && make -C /usr/src/tarantool/src/lib/msgpuck clean \\\n && : \"---------- luarocks ----------\" \\\n && wget -O luarocks.tar.gz \"$LUAROCKS_URL\" \\\n && mkdir -p /usr/src/luarocks \\\n && tar -xzf luarocks.tar.gz -C /usr/src/luarocks --strip-components=1 \\\n && (cd /usr/src/luarocks ;./configure ;make build ;make install ) \\\n && rm -r /usr/src/luarocks \\\n && rm -rf /usr/src/tarantool \\\n && rm -rf /usr/src/gperftools \\\n && rm -rf /usr/src/go \\\n && : \"---------- remove build deps ----------\" \\\n && apk del .build-deps\nCOPY luarocks-config.lua /usr/local/etc/luarocks/config-5.1.lua\nRUN set -x \\\n && apk add mariadb-client-libs=10.1.32-r0 libpq=9.6.10-r0 cyrus-sasl=2.1.26-r8 mosquitto-libs=1.4.15-r0 libev=4.22-r0 --no-cache --virtual .run-deps \\\n && apk add git=2.11.3-r2 cmake=3.6.3-r0 make=4.2.1-r0 gcc=6.2.1-r1 g++=6.2.1-r1 postgresql-dev=9.6.10-r0 lua-dev=5.1.5-r4 musl-dev=1.1.15-r8 cyrus-sasl-dev=2.1.26-r8 mosquitto-dev=1.4.15-r0 libev-dev=4.22-r0 --no-cache --virtual .build-deps \\\n && : \"---------- proj (for gis module) ----------\" \\\n && wget -O proj.tar.gz http://download.osgeo.org/proj/proj-4.9.3.tar.gz \\\n && mkdir -p /usr/src/proj \\\n && tar -xzf proj.tar.gz -C /usr/src/proj --strip-components=1 \\\n && (cd /usr/src/proj ;./configure ;make ;make install ) \\\n && rm -r /usr/src/proj \\\n && rm -rf /usr/src/proj \\\n && : \"---------- geos (for gis module) ----------\" \\\n && wget -O geos.tar.bz2 http://download.osgeo.org/geos/geos-3.6.0.tar.bz2 \\\n && mkdir -p /usr/src/geos \\\n && tar -xjf geos.tar.bz2 -C /usr/src/geos --strip-components=1 \\\n && (cd /usr/src/geos ;./configure ;make ;make install ) \\\n && rm -r /usr/src/geos \\\n && rm -rf /usr/src/geos \\\n && : \"---------- luarocks ----------\" \\\n && luarocks install lua-term \\\n && luarocks install ldoc \\\n && : \"avro\" \\\n && git clone $LUAROCK_AVRO_SCHEMA_REPO /rocks/avro \\\n && git -C /rocks/avro checkout $LUAROCK_AVRO_SCHEMA_TAG \\\n && (cd /rocks/avro \\\n && luarocks make *rockspec ) \\\n && : \"expirationd\" \\\n && git clone $LUAROCK_EXPIRATIOND_REPO /rocks/expirationd \\\n && git -C /rocks/expirationd checkout $LUAROCK_EXPIRATIOND_TAG \\\n && (cd /rocks/expirationd \\\n && luarocks make *rockspec ) \\\n && : \"queue\" \\\n && git clone $LUAROCK_QUEUE_REPO /rocks/queue \\\n && git -C /rocks/queue checkout $LUAROCK_QUEUE_TAG \\\n && (cd /rocks/queue \\\n && luarocks make *rockspec ) \\\n && : \"connpool\" \\\n && git clone $LUAROCK_CONNPOOL_REPO /rocks/connpool \\\n && git -C /rocks/connpool checkout $LUAROCK_CONNPOOL_TAG \\\n && (cd /rocks/connpool \\\n && luarocks make *rockspec ) \\\n && : \"shard\" \\\n && git clone $LUAROCK_SHARD_REPO /rocks/shard \\\n && git -C /rocks/shard checkout $LUAROCK_SHARD_TAG \\\n && (cd /rocks/shard \\\n && luarocks make *rockspec ) \\\n && : \"http\" \\\n && git clone $LUAROCK_HTTP_REPO /rocks/http \\\n && git -C /rocks/http checkout $LUAROCK_HTTP_TAG \\\n && (cd /rocks/http \\\n && luarocks make *rockspec ) \\\n && : \"pg\" \\\n && git clone $LUAROCK_PG_REPO /rocks/pg \\\n && git -C /rocks/pg checkout $LUAROCK_PG_TAG \\\n && (cd /rocks/pg \\\n && luarocks make *rockspec ) \\\n && : \"mysql\" \\\n && git clone $LUAROCK_MYSQL_REPO /rocks/mysql \\\n && git -C /rocks/mysql checkout $LUAROCK_MYSQL_TAG \\\n && (cd /rocks/mysql \\\n && luarocks make *rockspec ) \\\n && : \"memcached\" \\\n && git clone $LUAROCK_MEMCACHED_REPO /rocks/memcached \\\n && git -C /rocks/memcached checkout $LUAROCK_MEMCACHED_TAG \\\n && (cd /rocks/memcached \\\n && luarocks make *rockspec ) \\\n && : \"prometheus\" \\\n && git clone $LUAROCK_TARANTOOL_PROMETHEUS_REPO /rocks/prometheus \\\n && git -C /rocks/prometheus checkout $LUAROCK_TARANTOOL_PROMETHEUS_TAG \\\n && (cd /rocks/prometheus \\\n && luarocks make *rockspec ) \\\n && : \"curl\" \\\n && git clone $LUAROCK_TARANTOOL_CURL_REPO /rocks/curl \\\n && git -C /rocks/curl checkout $LUAROCK_TARANTOOL_CURL_TAG \\\n && (cd /rocks/curl \\\n && luarocks make *rockspec ) \\\n && : \"mqtt\" \\\n && git clone $LUAROCK_MQTT_REPO /rocks/mqtt \\\n && git -C /rocks/mqtt checkout $LUAROCK_MQTT_TAG \\\n && (cd /rocks/mqtt \\\n && luarocks make *rockspec ) \\\n && : \"gis\" \\\n && git clone $LUAROCK_TARANTOOL_GIS_REPO /rocks/gis \\\n && git -C /rocks/gis checkout $LUAROCK_TARANTOOL_GIS_TAG \\\n && (cd /rocks/gis \\\n && luarocks make *rockspec ) \\\n && : \"gperftools\" \\\n && git clone $LUAROCK_GPERFTOOLS_REPO /rocks/gperftools \\\n && git -C /rocks/gperftools checkout $LUAROCK_GPERFTOOLS_TAG \\\n && (cd /rocks/gperftools \\\n && luarocks make *rockspec ) \\\n && : \"---------- remove build deps ----------\" \\\n && apk del .build-deps\nRUN mkdir -p /var/lib/tarantool \\\n && chown tarantool:tarantool /var/lib/tarantool \\\n && mkdir -p /opt/tarantool \\\n && chown tarantool:tarantool /opt/tarantool \\\n && mkdir -p /var/run/tarantool \\\n && chown tarantool:tarantool /var/run/tarantool \\\n && mkdir /etc/tarantool \\\n && chown tarantool:tarantool /etc/tarantool\nVOLUME /var/lib/tarantool\nWORKDIR /opt/tarantool\nCOPY tarantool-entrypoint.lua /usr/local/bin/\nCOPY tarantool_set_config.lua /usr/local/bin/\nCOPY docker-entrypoint.sh /usr/local/bin/\nCOPY console /usr/local/bin/\nCOPY tarantool_is_up /usr/local/bin/\nCOPY tarantool.default /usr/local/etc/default/tarantool\nRUN ln -s usr/local/bin/docker-entrypoint.sh /entrypoint.sh\nENTRYPOINT [\"docker-entrypoint.sh\"]\nHEALTHCHECK CMD tarantool_is_up\nEXPOSE 3301/tcp\nCMD [\"tarantool\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n","originalDockerfile":"FROM alpine:3.5\nMAINTAINER mail@racktear.com\nRUN addgroup -S tarantool \\\n && adduser -S -G tarantool tarantool \\\n && apk add --no-cache 'su-exec>=0.2'\nENV TARANTOOL_VERSION=\"1.6.9-11-gf4619d0\" \\\n    TARANTOOL_DOWNLOAD_URL=\"https://github.com/tarantool/tarantool.git\" \\\n    TARANTOOL_INSTALL_LUADIR=\"/usr/local/share/tarantool\" \\\n    CURL_REPO=\"https://github.com/curl/curl.git\" \\\n    CURL_TAG=\"curl-7_59_0\" \\\n    GPERFTOOLS_REPO=\"https://github.com/gperftools/gperftools.git\" \\\n    GPERFTOOLS_TAG=\"gperftools-2.5\" \\\n    LUAROCKS_URL=\"http://keplerproject.github.io/luarocks/releases/luarocks-2.3.0.tar.gz\" \\\n    LUAROCK_AVRO_SCHEMA_REPO=\"https://github.com/tarantool/avro-schema.git\" \\\n    LUAROCK_AVRO_SCHEMA_TAG=\"b49efa8\" \\\n    LUAROCK_EXPIRATIOND_REPO=\"https://github.com/tarantool/expirationd.git\" \\\n    LUAROCK_EXPIRATIOND_TAG=\"9ec22b6\" \\\n    LUAROCK_QUEUE_REPO=\"https://github.com/tarantool/queue.git\" \\\n    LUAROCK_QUEUE_TAG=\"24d730c\" \\\n    LUAROCK_CONNPOOL_REPO=\"https://github.com/tarantool/connpool.git\" \\\n    LUAROCK_CONNPOOL_TAG=\"685af44\" \\\n    LUAROCK_SHARD_REPO=\"https://github.com/tarantool/shard.git\" \\\n    LUAROCK_SHARD_TAG=\"278b906\" \\\n    LUAROCK_HTTP_REPO=\"https://github.com/tarantool/http.git\" \\\n    LUAROCK_HTTP_TAG=\"67d8a9b\" \\\n    LUAROCK_PG_REPO=\"https://github.com/tarantool/pg.git\" \\\n    LUAROCK_PG_TAG=\"43a7130\" \\\n    LUAROCK_MYSQL_REPO=\"https://github.com/tarantool/mysql.git\" \\\n    LUAROCK_MYSQL_TAG=\"1c15d30\" \\\n    LUAROCK_MEMCACHED_REPO=\"https://github.com/tarantool/memcached.git\" \\\n    LUAROCK_MEMCACHED_TAG=\"c927626\" \\\n    LUAROCK_TARANTOOL_PROMETHEUS_REPO=\"https://github.com/tarantool/prometheus.git\" \\\n    LUAROCK_TARANTOOL_PROMETHEUS_TAG=\"0654304\" \\\n    LUAROCK_TARANTOOL_CURL_REPO=\"https://github.com/tarantool/curl.git\" \\\n    LUAROCK_TARANTOOL_CURL_TAG=\"2.2.7\" \\\n    LUAROCK_MQTT_REPO=\"https://github.com/tarantool/mqtt.git\" \\\n    LUAROCK_MQTT_TAG=\"238fd2e\" \\\n    LUAROCK_TARANTOOL_GIS_REPO=\"https://github.com/tarantool/gis.git\" \\\n    LUAROCK_TARANTOOL_GIS_TAG=\"25209fc\" \\\n    LUAROCK_GPERFTOOLS_REPO=\"https://github.com/tarantool/gperftools.git\" \\\n    LUAROCK_GPERFTOOLS_TAG=\"12a7ac2\"\nCOPY gperftools_alpine.diff /\nRUN set -x \\\n && apk add --no-cache --virtual .run-deps libstdc++ readline libressl yaml lz4 binutils ncurses libgomp lua tar zip ca-certificates \\\n && apk add --no-cache --virtual .build-deps gcc g++ cmake readline-dev libressl-dev yaml-dev lz4-dev binutils-dev ncurses-dev lua-dev musl-dev make git libunwind-dev autoconf automake libtool linux-headers go wget \\\n && : \"---------- curl ----------\" \\\n && mkdir -p /usr/src/curl \\\n && git clone \"$CURL_REPO\" /usr/src/curl \\\n && git -C /usr/src/curl checkout \"$CURL_TAG\" \\\n && (cd /usr/src/curl \\\n && ./buildconf \\\n && ./configure --prefix \"/usr/local\" \\\n && make -j \\\n && make install ) \\\n && : \"---------- gperftools ----------\" \\\n && mkdir -p /usr/src/gperftools \\\n && git clone \"$GPERFTOOLS_REPO\" /usr/src/gperftools \\\n && git -C /usr/src/gperftools checkout \"$GPERFTOOLS_TAG\" \\\n && (cd /usr/src/gperftools ;patch -p1 < /gperftools_alpine.diff;rm /gperftools_alpine.diff ;./autogen.sh ;./configure ;make ;cp .libs/libprofiler.so* /usr/local/lib ) \\\n && (GOPATH=/usr/src/go go get github.com/google/pprof ;cp /usr/src/go/bin/pprof /usr/local/bin ) \\\n && : \"---------- tarantool ----------\" \\\n && mkdir -p /usr/src/tarantool \\\n && git clone \"$TARANTOOL_DOWNLOAD_URL\" /usr/src/tarantool \\\n && git -C /usr/src/tarantool checkout \"$TARANTOOL_VERSION\" \\\n && git -C /usr/src/tarantool submodule update --init --recursive \\\n && (cd /usr/src/tarantool ;cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_BUNDLED_LIBYAML:BOOL=OFF -DENABLE_BACKTRACE:BOOL=ON -DENABLE_DIST:BOOL=ON . ) \\\n && make -C /usr/src/tarantool -j \\\n && make -C /usr/src/tarantool install \\\n && make -C /usr/src/tarantool clean \\\n && : \"---------- small ----------\" \\\n && (cd /usr/src/tarantool/src/lib/small ;cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_INSTALL_LIBDIR=lib -DCMAKE_BUILD_TYPE=RelWithDebInfo . ) \\\n && make -C /usr/src/tarantool/src/lib/small \\\n && make -C /usr/src/tarantool/src/lib/small install \\\n && make -C /usr/src/tarantool/src/lib/small clean \\\n && : \"---------- msgpuck ----------\" \\\n && (cd /usr/src/tarantool/src/lib/msgpuck ;cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_INSTALL_LIBDIR=lib -DCMAKE_BUILD_TYPE=RelWithDebInfo . ) \\\n && make -C /usr/src/tarantool/src/lib/msgpuck \\\n && make -C /usr/src/tarantool/src/lib/msgpuck install \\\n && make -C /usr/src/tarantool/src/lib/msgpuck clean \\\n && : \"---------- luarocks ----------\" \\\n && wget -O luarocks.tar.gz \"$LUAROCKS_URL\" \\\n && mkdir -p /usr/src/luarocks \\\n && tar -xzf luarocks.tar.gz -C /usr/src/luarocks --strip-components=1 \\\n && (cd /usr/src/luarocks ;./configure ;make build ;make install ) \\\n && rm -r /usr/src/luarocks \\\n && rm -rf /usr/src/tarantool \\\n && rm -rf /usr/src/gperftools \\\n && rm -rf /usr/src/go \\\n && : \"---------- remove build deps ----------\" \\\n && apk del .build-deps\nCOPY luarocks-config.lua /usr/local/etc/luarocks/config-5.1.lua\nRUN set -x \\\n && apk add --no-cache --virtual .run-deps mariadb-client-libs libpq cyrus-sasl mosquitto-libs libev \\\n && apk add --no-cache --virtual .build-deps git cmake make gcc g++ postgresql-dev lua-dev musl-dev cyrus-sasl-dev mosquitto-dev libev-dev \\\n && : \"---------- proj (for gis module) ----------\" \\\n && wget -O proj.tar.gz http://download.osgeo.org/proj/proj-4.9.3.tar.gz \\\n && mkdir -p /usr/src/proj \\\n && tar -xzf proj.tar.gz -C /usr/src/proj --strip-components=1 \\\n && (cd /usr/src/proj ;./configure ;make ;make install ) \\\n && rm -r /usr/src/proj \\\n && rm -rf /usr/src/proj \\\n && : \"---------- geos (for gis module) ----------\" \\\n && wget -O geos.tar.bz2 http://download.osgeo.org/geos/geos-3.6.0.tar.bz2 \\\n && mkdir -p /usr/src/geos \\\n && tar -xjf geos.tar.bz2 -C /usr/src/geos --strip-components=1 \\\n && (cd /usr/src/geos ;./configure ;make ;make install ) \\\n && rm -r /usr/src/geos \\\n && rm -rf /usr/src/geos \\\n && : \"---------- luarocks ----------\" \\\n && luarocks install lua-term \\\n && luarocks install ldoc \\\n && : \"avro\" \\\n && git clone $LUAROCK_AVRO_SCHEMA_REPO /rocks/avro \\\n && git -C /rocks/avro checkout $LUAROCK_AVRO_SCHEMA_TAG \\\n && (cd /rocks/avro \\\n && luarocks make *rockspec ) \\\n && : \"expirationd\" \\\n && git clone $LUAROCK_EXPIRATIOND_REPO /rocks/expirationd \\\n && git -C /rocks/expirationd checkout $LUAROCK_EXPIRATIOND_TAG \\\n && (cd /rocks/expirationd \\\n && luarocks make *rockspec ) \\\n && : \"queue\" \\\n && git clone $LUAROCK_QUEUE_REPO /rocks/queue \\\n && git -C /rocks/queue checkout $LUAROCK_QUEUE_TAG \\\n && (cd /rocks/queue \\\n && luarocks make *rockspec ) \\\n && : \"connpool\" \\\n && git clone $LUAROCK_CONNPOOL_REPO /rocks/connpool \\\n && git -C /rocks/connpool checkout $LUAROCK_CONNPOOL_TAG \\\n && (cd /rocks/connpool \\\n && luarocks make *rockspec ) \\\n && : \"shard\" \\\n && git clone $LUAROCK_SHARD_REPO /rocks/shard \\\n && git -C /rocks/shard checkout $LUAROCK_SHARD_TAG \\\n && (cd /rocks/shard \\\n && luarocks make *rockspec ) \\\n && : \"http\" \\\n && git clone $LUAROCK_HTTP_REPO /rocks/http \\\n && git -C /rocks/http checkout $LUAROCK_HTTP_TAG \\\n && (cd /rocks/http \\\n && luarocks make *rockspec ) \\\n && : \"pg\" \\\n && git clone $LUAROCK_PG_REPO /rocks/pg \\\n && git -C /rocks/pg checkout $LUAROCK_PG_TAG \\\n && (cd /rocks/pg \\\n && luarocks make *rockspec ) \\\n && : \"mysql\" \\\n && git clone $LUAROCK_MYSQL_REPO /rocks/mysql \\\n && git -C /rocks/mysql checkout $LUAROCK_MYSQL_TAG \\\n && (cd /rocks/mysql \\\n && luarocks make *rockspec ) \\\n && : \"memcached\" \\\n && git clone $LUAROCK_MEMCACHED_REPO /rocks/memcached \\\n && git -C /rocks/memcached checkout $LUAROCK_MEMCACHED_TAG \\\n && (cd /rocks/memcached \\\n && luarocks make *rockspec ) \\\n && : \"prometheus\" \\\n && git clone $LUAROCK_TARANTOOL_PROMETHEUS_REPO /rocks/prometheus \\\n && git -C /rocks/prometheus checkout $LUAROCK_TARANTOOL_PROMETHEUS_TAG \\\n && (cd /rocks/prometheus \\\n && luarocks make *rockspec ) \\\n && : \"curl\" \\\n && git clone $LUAROCK_TARANTOOL_CURL_REPO /rocks/curl \\\n && git -C /rocks/curl checkout $LUAROCK_TARANTOOL_CURL_TAG \\\n && (cd /rocks/curl \\\n && luarocks make *rockspec ) \\\n && : \"mqtt\" \\\n && git clone $LUAROCK_MQTT_REPO /rocks/mqtt \\\n && git -C /rocks/mqtt checkout $LUAROCK_MQTT_TAG \\\n && (cd /rocks/mqtt \\\n && luarocks make *rockspec ) \\\n && : \"gis\" \\\n && git clone $LUAROCK_TARANTOOL_GIS_REPO /rocks/gis \\\n && git -C /rocks/gis checkout $LUAROCK_TARANTOOL_GIS_TAG \\\n && (cd /rocks/gis \\\n && luarocks make *rockspec ) \\\n && : \"gperftools\" \\\n && git clone $LUAROCK_GPERFTOOLS_REPO /rocks/gperftools \\\n && git -C /rocks/gperftools checkout $LUAROCK_GPERFTOOLS_TAG \\\n && (cd /rocks/gperftools \\\n && luarocks make *rockspec ) \\\n && : \"---------- remove build deps ----------\" \\\n && apk del .build-deps\nRUN mkdir -p /var/lib/tarantool \\\n && chown tarantool:tarantool /var/lib/tarantool \\\n && mkdir -p /opt/tarantool \\\n && chown tarantool:tarantool /opt/tarantool \\\n && mkdir -p /var/run/tarantool \\\n && chown tarantool:tarantool /var/run/tarantool \\\n && mkdir /etc/tarantool \\\n && chown tarantool:tarantool /etc/tarantool\nVOLUME /var/lib/tarantool\nWORKDIR /opt/tarantool\nCOPY tarantool-entrypoint.lua /usr/local/bin/\nCOPY tarantool_set_config.lua /usr/local/bin/\nCOPY docker-entrypoint.sh /usr/local/bin/\nCOPY console /usr/local/bin/\nCOPY tarantool_is_up /usr/local/bin/\nCOPY tarantool.default /usr/local/etc/default/tarantool\nRUN ln -s usr/local/bin/docker-entrypoint.sh /entrypoint.sh\nENTRYPOINT [\"docker-entrypoint.sh\"]\nHEALTHCHECK CMD tarantool_is_up\nEXPOSE 3301/tcp\nCMD [\"tarantool\"]\n","injectedSmells":[],"originalDockerfileHash":"1563bc34eedcdc02709d98a9055e2d39","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM alpine:3.5\nMAINTAINER mail@racktear.com\nRUN addgroup -S tarantool \\\n && adduser -S -G tarantool tarantool \\\n && apk add --no-cache 'su-exec>=0.2'\nENV TARANTOOL_VERSION=\"1.6.9-11-gf4619d0\" \\\n    TARANTOOL_DOWNLOAD_URL=\"https://github.com/tarantool/tarantool.git\" \\\n    TARANTOOL_INSTALL_LUADIR=\"/usr/local/share/tarantool\" \\\n    CURL_REPO=\"https://github.com/curl/curl.git\" \\\n    CURL_TAG=\"curl-7_59_0\" \\\n    GPERFTOOLS_REPO=\"https://github.com/gperftools/gperftools.git\" \\\n    GPERFTOOLS_TAG=\"gperftools-2.5\" \\\n    LUAROCKS_URL=\"http://keplerproject.github.io/luarocks/releases/luarocks-2.3.0.tar.gz\" \\\n    LUAROCK_AVRO_SCHEMA_REPO=\"https://github.com/tarantool/avro-schema.git\" \\\n    LUAROCK_AVRO_SCHEMA_TAG=\"b49efa8\" \\\n    LUAROCK_EXPIRATIOND_REPO=\"https://github.com/tarantool/expirationd.git\" \\\n    LUAROCK_EXPIRATIOND_TAG=\"9ec22b6\" \\\n    LUAROCK_QUEUE_REPO=\"https://github.com/tarantool/queue.git\" \\\n    LUAROCK_QUEUE_TAG=\"24d730c\" \\\n    LUAROCK_CONNPOOL_REPO=\"https://github.com/tarantool/connpool.git\" \\\n    LUAROCK_CONNPOOL_TAG=\"685af44\" \\\n    LUAROCK_SHARD_REPO=\"https://github.com/tarantool/shard.git\" \\\n    LUAROCK_SHARD_TAG=\"278b906\" \\\n    LUAROCK_HTTP_REPO=\"https://github.com/tarantool/http.git\" \\\n    LUAROCK_HTTP_TAG=\"67d8a9b\" \\\n    LUAROCK_PG_REPO=\"https://github.com/tarantool/pg.git\" \\\n    LUAROCK_PG_TAG=\"43a7130\" \\\n    LUAROCK_MYSQL_REPO=\"https://github.com/tarantool/mysql.git\" \\\n    LUAROCK_MYSQL_TAG=\"1c15d30\" \\\n    LUAROCK_MEMCACHED_REPO=\"https://github.com/tarantool/memcached.git\" \\\n    LUAROCK_MEMCACHED_TAG=\"c927626\" \\\n    LUAROCK_TARANTOOL_PROMETHEUS_REPO=\"https://github.com/tarantool/prometheus.git\" \\\n    LUAROCK_TARANTOOL_PROMETHEUS_TAG=\"0654304\" \\\n    LUAROCK_TARANTOOL_CURL_REPO=\"https://github.com/tarantool/curl.git\" \\\n    LUAROCK_TARANTOOL_CURL_TAG=\"2.2.7\" \\\n    LUAROCK_MQTT_REPO=\"https://github.com/tarantool/mqtt.git\" \\\n    LUAROCK_MQTT_TAG=\"238fd2e\" \\\n    LUAROCK_TARANTOOL_GIS_REPO=\"https://github.com/tarantool/gis.git\" \\\n    LUAROCK_TARANTOOL_GIS_TAG=\"25209fc\" \\\n    LUAROCK_GPERFTOOLS_REPO=\"https://github.com/tarantool/gperftools.git\" \\\n    LUAROCK_GPERFTOOLS_TAG=\"12a7ac2\"\nCOPY gperftools_alpine.diff /\nRUN set -x \\\n && apk add --no-cache --virtual .run-deps libstdc++ readline libressl yaml lz4 binutils ncurses libgomp lua tar zip ca-certificates \\\n && apk add --no-cache --virtual .build-deps gcc g++ cmake readline-dev libressl-dev yaml-dev lz4-dev binutils-dev ncurses-dev lua-dev musl-dev make git libunwind-dev autoconf automake libtool linux-headers go wget \\\n && : \"---------- curl ----------\" \\\n && mkdir -p /usr/src/curl \\\n && git clone \"$CURL_REPO\" /usr/src/curl \\\n && git -C /usr/src/curl checkout \"$CURL_TAG\" \\\n && (cd /usr/src/curl \\\n && ./buildconf \\\n && ./configure --prefix \"/usr/local\" \\\n && make -j \\\n && make install ) \\\n && : \"---------- gperftools ----------\" \\\n && mkdir -p /usr/src/gperftools \\\n && git clone \"$GPERFTOOLS_REPO\" /usr/src/gperftools \\\n && git -C /usr/src/gperftools checkout \"$GPERFTOOLS_TAG\" \\\n && (cd /usr/src/gperftools ;patch -p1 < /gperftools_alpine.diff;rm /gperftools_alpine.diff ;./autogen.sh ;./configure ;make ;cp .libs/libprofiler.so* /usr/local/lib ) \\\n && (GOPATH=/usr/src/go go get github.com/google/pprof ;cp /usr/src/go/bin/pprof /usr/local/bin ) \\\n && : \"---------- tarantool ----------\" \\\n && mkdir -p /usr/src/tarantool \\\n && git clone \"$TARANTOOL_DOWNLOAD_URL\" /usr/src/tarantool \\\n && git -C /usr/src/tarantool checkout \"$TARANTOOL_VERSION\" \\\n && git -C /usr/src/tarantool submodule update --init --recursive \\\n && (cd /usr/src/tarantool ;cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_BUNDLED_LIBYAML:BOOL=OFF -DENABLE_BACKTRACE:BOOL=ON -DENABLE_DIST:BOOL=ON . ) \\\n && make -C /usr/src/tarantool -j \\\n && make -C /usr/src/tarantool install \\\n && make -C /usr/src/tarantool clean \\\n && : \"---------- small ----------\" \\\n && (cd /usr/src/tarantool/src/lib/small ;cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_INSTALL_LIBDIR=lib -DCMAKE_BUILD_TYPE=RelWithDebInfo . ) \\\n && make -C /usr/src/tarantool/src/lib/small \\\n && make -C /usr/src/tarantool/src/lib/small install \\\n && make -C /usr/src/tarantool/src/lib/small clean \\\n && : \"---------- msgpuck ----------\" \\\n && (cd /usr/src/tarantool/src/lib/msgpuck ;cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_INSTALL_LIBDIR=lib -DCMAKE_BUILD_TYPE=RelWithDebInfo . ) \\\n && make -C /usr/src/tarantool/src/lib/msgpuck \\\n && make -C /usr/src/tarantool/src/lib/msgpuck install \\\n && make -C /usr/src/tarantool/src/lib/msgpuck clean \\\n && : \"---------- luarocks ----------\" \\\n && wget -O luarocks.tar.gz \"$LUAROCKS_URL\" \\\n && mkdir -p /usr/src/luarocks \\\n && tar -xzf luarocks.tar.gz -C /usr/src/luarocks --strip-components=1 \\\n && (cd /usr/src/luarocks ;./configure ;make build ;make install ) \\\n && rm -r /usr/src/luarocks \\\n && rm -rf /usr/src/tarantool \\\n && rm -rf /usr/src/gperftools \\\n && rm -rf /usr/src/go \\\n && : \"---------- remove build deps ----------\" \\\n && apk del .build-deps\nCOPY luarocks-config.lua /usr/local/etc/luarocks/config-5.1.lua\nRUN set -x \\\n && apk add --no-cache --virtual .run-deps mariadb-client-libs libpq cyrus-sasl mosquitto-libs libev \\\n && apk add --no-cache --virtual .build-deps git cmake make gcc g++ postgresql-dev lua-dev musl-dev cyrus-sasl-dev mosquitto-dev libev-dev \\\n && : \"---------- proj (for gis module) ----------\" \\\n && wget -O proj.tar.gz http://download.osgeo.org/proj/proj-4.9.3.tar.gz \\\n && mkdir -p /usr/src/proj \\\n && tar -xzf proj.tar.gz -C /usr/src/proj --strip-components=1 \\\n && (cd /usr/src/proj ;./configure ;make ;make install ) \\\n && rm -r /usr/src/proj \\\n && rm -rf /usr/src/proj \\\n && : \"---------- geos (for gis module) ----------\" \\\n && wget -O geos.tar.bz2 http://download.osgeo.org/geos/geos-3.6.0.tar.bz2 \\\n && mkdir -p /usr/src/geos \\\n && tar -xjf geos.tar.bz2 -C /usr/src/geos --strip-components=1 \\\n && (cd /usr/src/geos ;./configure ;make ;make install ) \\\n && rm -r /usr/src/geos \\\n && rm -rf /usr/src/geos \\\n && : \"---------- luarocks ----------\" \\\n && luarocks install lua-term \\\n && luarocks install ldoc \\\n && : \"avro\" \\\n && git clone $LUAROCK_AVRO_SCHEMA_REPO /rocks/avro \\\n && git -C /rocks/avro checkout $LUAROCK_AVRO_SCHEMA_TAG \\\n && (cd /rocks/avro \\\n && luarocks make *rockspec ) \\\n && : \"expirationd\" \\\n && git clone $LUAROCK_EXPIRATIOND_REPO /rocks/expirationd \\\n && git -C /rocks/expirationd checkout $LUAROCK_EXPIRATIOND_TAG \\\n && (cd /rocks/expirationd \\\n && luarocks make *rockspec ) \\\n && : \"queue\" \\\n && git clone $LUAROCK_QUEUE_REPO /rocks/queue \\\n && git -C /rocks/queue checkout $LUAROCK_QUEUE_TAG \\\n && (cd /rocks/queue \\\n && luarocks make *rockspec ) \\\n && : \"connpool\" \\\n && git clone $LUAROCK_CONNPOOL_REPO /rocks/connpool \\\n && git -C /rocks/connpool checkout $LUAROCK_CONNPOOL_TAG \\\n && (cd /rocks/connpool \\\n && luarocks make *rockspec ) \\\n && : \"shard\" \\\n && git clone $LUAROCK_SHARD_REPO /rocks/shard \\\n && git -C /rocks/shard checkout $LUAROCK_SHARD_TAG \\\n && (cd /rocks/shard \\\n && luarocks make *rockspec ) \\\n && : \"http\" \\\n && git clone $LUAROCK_HTTP_REPO /rocks/http \\\n && git -C /rocks/http checkout $LUAROCK_HTTP_TAG \\\n && (cd /rocks/http \\\n && luarocks make *rockspec ) \\\n && : \"pg\" \\\n && git clone $LUAROCK_PG_REPO /rocks/pg \\\n && git -C /rocks/pg checkout $LUAROCK_PG_TAG \\\n && (cd /rocks/pg \\\n && luarocks make *rockspec ) \\\n && : \"mysql\" \\\n && git clone $LUAROCK_MYSQL_REPO /rocks/mysql \\\n && git -C /rocks/mysql checkout $LUAROCK_MYSQL_TAG \\\n && (cd /rocks/mysql \\\n && luarocks make *rockspec ) \\\n && : \"memcached\" \\\n && git clone $LUAROCK_MEMCACHED_REPO /rocks/memcached \\\n && git -C /rocks/memcached checkout $LUAROCK_MEMCACHED_TAG \\\n && (cd /rocks/memcached \\\n && luarocks make *rockspec ) \\\n && : \"prometheus\" \\\n && git clone $LUAROCK_TARANTOOL_PROMETHEUS_REPO /rocks/prometheus \\\n && git -C /rocks/prometheus checkout $LUAROCK_TARANTOOL_PROMETHEUS_TAG \\\n && (cd /rocks/prometheus \\\n && luarocks make *rockspec ) \\\n && : \"curl\" \\\n && git clone $LUAROCK_TARANTOOL_CURL_REPO /rocks/curl \\\n && git -C /rocks/curl checkout $LUAROCK_TARANTOOL_CURL_TAG \\\n && (cd /rocks/curl \\\n && luarocks make *rockspec ) \\\n && : \"mqtt\" \\\n && git clone $LUAROCK_MQTT_REPO /rocks/mqtt \\\n && git -C /rocks/mqtt checkout $LUAROCK_MQTT_TAG \\\n && (cd /rocks/mqtt \\\n && luarocks make *rockspec ) \\\n && : \"gis\" \\\n && git clone $LUAROCK_TARANTOOL_GIS_REPO /rocks/gis \\\n && git -C /rocks/gis checkout $LUAROCK_TARANTOOL_GIS_TAG \\\n && (cd /rocks/gis \\\n && luarocks make *rockspec ) \\\n && : \"gperftools\" \\\n && git clone $LUAROCK_GPERFTOOLS_REPO /rocks/gperftools \\\n && git -C /rocks/gperftools checkout $LUAROCK_GPERFTOOLS_TAG \\\n && (cd /rocks/gperftools \\\n && luarocks make *rockspec ) \\\n && : \"---------- remove build deps ----------\" \\\n && apk del .build-deps\nRUN mkdir -p /var/lib/tarantool \\\n && chown tarantool:tarantool /var/lib/tarantool \\\n && mkdir -p /opt/tarantool \\\n && chown tarantool:tarantool /opt/tarantool \\\n && mkdir -p /var/run/tarantool \\\n && chown tarantool:tarantool /var/run/tarantool \\\n && mkdir /etc/tarantool \\\n && chown tarantool:tarantool /etc/tarantool\nVOLUME /var/lib/tarantool\nWORKDIR /opt/tarantool\nCOPY tarantool-entrypoint.lua /usr/local/bin/\nCOPY tarantool_set_config.lua /usr/local/bin/\nCOPY docker-entrypoint.sh /usr/local/bin/\nCOPY console /usr/local/bin/\nCOPY tarantool_is_up /usr/local/bin/\nCOPY tarantool.default /usr/local/etc/default/tarantool\nRUN ln -s usr/local/bin/docker-entrypoint.sh /entrypoint.sh\nENTRYPOINT [\"docker-entrypoint.sh\"]\nHEALTHCHECK CMD tarantool_is_up\nEXPOSE 3301/tcp\nCMD [\"tarantool\"]\n","originalDockerfileUglifiedHash":"1563bc34eedcdc02709d98a9055e2d39","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/ece5f046f0c538c5777113b7e08e4104f53f4285.dockerfile"}