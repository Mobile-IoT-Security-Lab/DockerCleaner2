{"seed":2785287382,"processedDockerfileHash":"38575c200d2b4f85ae1cac8cd486f864","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","have-a-healthcheck"],"processedDockerfile":"FROM ubuntu:16.04\nMAINTAINER Nicola <niquola@gmail.com>,  BazZy <bazzy.bazzy@gmail.com>,  Danil Kutkevich <danil@kutkevich.org>\nENV REFRESHED_AT=\"20160425T0900Z\"\nRUN localedef --force --inputfile=en_US --charmap=UTF-8 --alias-file=/usr/share/locale/locale.alias en_US.UTF-8\nENV LANG=\"en_US.UTF-8\"\nRUN :\nRUN apt-get --yes upgrade\n#   Add PostgreSQL (9.1, 9.2, 9.3, 9.4, 9.5) apt repository\n#   <http://www.postgresql.org/download/linux/ubuntu/>.\nRUN (apt-get update ;apt-get install --no-install-recommends curl=7.47.0-1ubuntu2.19 sudo=1.8.16-0ubuntu1.10 --yes )\nRUN echo 'deb http://apt.postgresql.org/pub/repos/apt/ trusty-pgdg main' > /etc/apt/sources.list.d/pgdg.list\nRUN curl --silent https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -\nRUN :\nRUN apt-get --yes upgrade\n#   Install PostgreSQL.\nENV PG_MAJOR=\"9.4\"\nRUN (apt-get update ;apt-get install --no-install-recommends postgresql-$PG_MAJOR --yes )\n#   Install plv8 (in case of plv8 compilation issues address to\n#   README in <https://github.com/clkao/docker-postgres-plv8>).\nRUN (apt-get update ;apt-get install --no-install-recommends git=1:2.7.4-0ubuntu1.10 build-essential=12.1ubuntu2 libv8-dev=3.14.5.8-5ubuntu2 postgresql-server-dev-$PG_MAJOR --yes )\nRUN (apt-get update ;apt-get install --no-install-recommends nodejs-dev=4.2.6~dfsg-1ubuntu4.2 --yes )\n#   Adjust PostgreSQL configuration so that remote connections to the\n#   database are possible.\nRUN echo 'host all all 0.0.0.0/0 md5' >> /etc/postgresql/$PG_MAJOR/main/pg_hba.conf\nRUN echo 'local all all trust' >> /etc/postgresql/$PG_MAJOR/main/pg_hba.conf\nRUN echo \"listen_addresses='*'\" >> /etc/postgresql/$PG_MAJOR/main/postgresql.conf\nUSER postgres\n#   Fix PostgreSQL locale\n#   <http://stackoverflow.com/questions/16736891/pgerror-error-new-encoding-utf8-is-incompatible#16737776>,\n#   <http://www.postgresql.org/message-id/43FE1E65.3030000@genome.chop.edu>,\n#   <http://www.postgresql.org/docs/current/static/multibyte.html#AEN35730>.\nRUN service postgresql start \\\n && psql --command=\"UPDATE pg_database SET datistemplate = FALSE WHERE datname = 'template1';\" \\\n && psql --command=\"DROP DATABASE template1;\" \\\n && psql --command=\"CREATE DATABASE template1 WITH TEMPLATE = template0 ENCODING = 'UNICODE' LC_COLLATE='en_US.UTF-8' LC_CTYPE='en_US.UTF-8';\" \\\n && psql --command=\"UPDATE pg_database SET datistemplate = TRUE WHERE datname = 'template1';\" \\\n && psql --command=\"CREATE ROLE fhirbase WITH SUPERUSER LOGIN PASSWORD 'fhirbase';\" \\\n && psql --command=\"CREATE DATABASE fhirbase WITH OWNER fhirbase ENCODING = 'UTF8';\"\nUSER root\nRUN useradd --user-group --create-home --shell /bin/bash fhirbase \\\n && echo 'fhirbase:fhirbase' | chpasswd \\\n && adduser fhirbase sudo\nRUN echo 'fhirbase ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers\nUSER fhirbase\nRUN cd ~ \\\n && git clone https://github.com/fhirbase/fhirbase-plv8.git fhirbase \\\n && cd ~/fhirbase \\\n && git submodule update --init --recursive\n#   Install nodejs.\nRUN curl --silent -o- https://raw.githubusercontent.com/creationix/nvm/v0.31.1/install.sh | bash\nRUN bash -lc 'source ~/.nvm/nvm.sh \\\n && nvm install 6.2.0'\nRUN bash -lc 'cd ~/fhirbase \\\n && source ~/.nvm/nvm.sh \\\n && nvm use 6.2.0 \\\n && npm install'\nRUN bash -lc 'cd ~/fhirbase/plpl \\\n && source ~/.nvm/nvm.sh \\\n && nvm use 6.2.0 \\\n && npm install'\nUSER root\nENV PLV8_VERSION=\"v1.4.7\"\nRUN cd /tmp \\\n && git clone https://github.com/plv8/plv8.git \\\n && cd /tmp/plv8 \\\n && git checkout $PLV8_VERSION \\\n && make all install\nUSER fhirbase\n#   Install fhirbase.\nRUN bash -lc 'sudo service postgresql start \\\n && cd ~/fhirbase \\\n && source ~/.nvm/nvm.sh \\\n && nvm use 6.2.0 \\\n && export PATH=\"$HOME\"/fhirbase/node_modules/coffee-script/bin:\"$PATH\" \\\n && export DATABASE_URL=postgres://fhirbase:fhirbase@localhost:5432/fhirbase \\\n && ~/fhirbase/build-commit.sh --rebuild \\\n && cat ~/fhirbase/build/latest/build.sql | psql fhirbase'\nUSER root\nCOPY docker-run-tests.sh /\nRUN chmod a+rwx /docker-run-tests.sh\nRUN chown fhirbase /docker-run-tests.sh\n#   Install utils.\nRUN (apt-get update ;apt-get install --no-install-recommends openssh-server=1:7.2p2-4ubuntu2.10 aptitude=0.7.4-2ubuntu2 --yes )\nUSER fhirbase\n#   Expose the PostgreSQL port.\nEXPOSE 5432/tcp\n#   Add VOLUMEs to allow backup of config, logs, socket and databases\nVOLUME [\"/etc/postgresql\", \"/var/log/postgresql\", \"/var/lib/postgresql\", \"/var/run/postgresql\"]\nWORKDIR /home/fhirbase\nCMD /bin/bash\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ubuntu:16.04\nMAINTAINER Nicola <niquola@gmail.com>,  BazZy <bazzy.bazzy@gmail.com>,  Danil Kutkevich <danil@kutkevich.org>\nENV REFRESHED_AT=\"20160425T0900Z\"\nRUN localedef --force --inputfile=en_US --charmap=UTF-8 --alias-file=/usr/share/locale/locale.alias en_US.UTF-8\nENV LANG=\"en_US.UTF-8\"\nRUN apt-get update --yes\nRUN apt-get --yes upgrade\n#  Add PostgreSQL (9.1, 9.2, 9.3, 9.4, 9.5) apt repository\n#  <http://www.postgresql.org/download/linux/ubuntu/>.\nRUN apt-get install curl sudo --yes\nRUN echo 'deb http://apt.postgresql.org/pub/repos/apt/ trusty-pgdg main' > /etc/apt/sources.list.d/pgdg.list\nRUN curl --silent https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -\nRUN apt-get update --yes\nRUN apt-get --yes upgrade\n#  Install PostgreSQL.\nENV PG_MAJOR=\"9.4\"\nRUN apt-get install postgresql-$PG_MAJOR --yes\n#  Install plv8 (in case of plv8 compilation issues address to\n#  README in <https://github.com/clkao/docker-postgres-plv8>).\nRUN apt-get install git build-essential libv8-dev postgresql-server-dev-$PG_MAJOR --yes\nRUN apt-get install nodejs-dev --yes\n#  Adjust PostgreSQL configuration so that remote connections to the\n#  database are possible.\nRUN echo 'host all all 0.0.0.0/0 md5' >> /etc/postgresql/$PG_MAJOR/main/pg_hba.conf\nRUN echo 'local all all trust' >> /etc/postgresql/$PG_MAJOR/main/pg_hba.conf\nRUN echo \"listen_addresses='*'\" >> /etc/postgresql/$PG_MAJOR/main/postgresql.conf\nUSER postgres\n#  Fix PostgreSQL locale\n#  <http://stackoverflow.com/questions/16736891/pgerror-error-new-encoding-utf8-is-incompatible#16737776>,\n#  <http://www.postgresql.org/message-id/43FE1E65.3030000@genome.chop.edu>,\n#  <http://www.postgresql.org/docs/current/static/multibyte.html#AEN35730>.\nRUN service postgresql start \\\n && psql --command=\"UPDATE pg_database SET datistemplate = FALSE WHERE datname = 'template1';\" \\\n && psql --command=\"DROP DATABASE template1;\" \\\n && psql --command=\"CREATE DATABASE template1 WITH TEMPLATE = template0 ENCODING = 'UNICODE' LC_COLLATE='en_US.UTF-8' LC_CTYPE='en_US.UTF-8';\" \\\n && psql --command=\"UPDATE pg_database SET datistemplate = TRUE WHERE datname = 'template1';\" \\\n && psql --command=\"CREATE ROLE fhirbase WITH SUPERUSER LOGIN PASSWORD 'fhirbase';\" \\\n && psql --command=\"CREATE DATABASE fhirbase WITH OWNER fhirbase ENCODING = 'UTF8';\"\nUSER root\nRUN useradd --user-group --create-home --shell /bin/bash fhirbase \\\n && echo 'fhirbase:fhirbase' | chpasswd \\\n && adduser fhirbase sudo\nRUN echo 'fhirbase ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers\nUSER fhirbase\nRUN cd ~ \\\n && git clone https://github.com/fhirbase/fhirbase-plv8.git fhirbase \\\n && cd ~/fhirbase \\\n && git submodule update --init --recursive\n#  Install nodejs.\nRUN curl --silent -o- https://raw.githubusercontent.com/creationix/nvm/v0.31.1/install.sh | bash\nRUN bash -lc 'source ~/.nvm/nvm.sh \\\n && nvm install 6.2.0'\nRUN bash -lc 'cd ~/fhirbase \\\n && source ~/.nvm/nvm.sh \\\n && nvm use 6.2.0 \\\n && npm install'\nRUN bash -lc 'cd ~/fhirbase/plpl \\\n && source ~/.nvm/nvm.sh \\\n && nvm use 6.2.0 \\\n && npm install'\nUSER root\nENV PLV8_VERSION=\"v1.4.7\"\nRUN cd /tmp \\\n && git clone https://github.com/plv8/plv8.git \\\n && cd /tmp/plv8 \\\n && git checkout $PLV8_VERSION \\\n && make all install\nUSER fhirbase\n#  Install fhirbase.\nRUN bash -lc 'sudo service postgresql start \\\n && cd ~/fhirbase \\\n && source ~/.nvm/nvm.sh \\\n && nvm use 6.2.0 \\\n && export PATH=\"$HOME\"/fhirbase/node_modules/coffee-script/bin:\"$PATH\" \\\n && export DATABASE_URL=postgres://fhirbase:fhirbase@localhost:5432/fhirbase \\\n && ~/fhirbase/build-commit.sh --rebuild \\\n && cat ~/fhirbase/build/latest/build.sql | psql fhirbase'\nUSER root\nCOPY docker-run-tests.sh /\nRUN chmod a+rwx /docker-run-tests.sh\nRUN chown fhirbase /docker-run-tests.sh\n#  Install utils.\nRUN apt-get install openssh-server aptitude --yes\nUSER fhirbase\n#  Expose the PostgreSQL port.\nEXPOSE 5432/tcp\n#  Add VOLUMEs to allow backup of config, logs, socket and databases\nVOLUME [\"/etc/postgresql\", \"/var/log/postgresql\", \"/var/lib/postgresql\", \"/var/run/postgresql\"]\nWORKDIR /home/fhirbase\nCMD /bin/bash\n","injectedSmells":[],"originalDockerfileHash":"99920e3f6e485b40eea94fdaa6041cd6","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:16.04\nMAINTAINER Nicola <niquola@gmail.com>,  BazZy <bazzy.bazzy@gmail.com>,  Danil Kutkevich <danil@kutkevich.org>\nENV REFRESHED_AT=\"20160425T0900Z\"\nRUN localedef --force --inputfile=en_US --charmap=UTF-8 --alias-file=/usr/share/locale/locale.alias en_US.UTF-8\nENV LANG=\"en_US.UTF-8\"\nRUN apt-get update --yes\nRUN apt-get --yes upgrade\n#   Add PostgreSQL (9.1, 9.2, 9.3, 9.4, 9.5) apt repository\n#   <http://www.postgresql.org/download/linux/ubuntu/>.\nRUN apt-get install curl sudo --yes\nRUN echo 'deb http://apt.postgresql.org/pub/repos/apt/ trusty-pgdg main' > /etc/apt/sources.list.d/pgdg.list\nRUN curl --silent https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -\nRUN apt-get update --yes\nRUN apt-get --yes upgrade\n#   Install PostgreSQL.\nENV PG_MAJOR=\"9.4\"\nRUN apt-get install postgresql-$PG_MAJOR --yes\n#   Install plv8 (in case of plv8 compilation issues address to\n#   README in <https://github.com/clkao/docker-postgres-plv8>).\nRUN apt-get install git build-essential libv8-dev postgresql-server-dev-$PG_MAJOR --yes\nRUN apt-get install nodejs-dev --yes\n#   Adjust PostgreSQL configuration so that remote connections to the\n#   database are possible.\nRUN echo 'host all all 0.0.0.0/0 md5' >> /etc/postgresql/$PG_MAJOR/main/pg_hba.conf\nRUN echo 'local all all trust' >> /etc/postgresql/$PG_MAJOR/main/pg_hba.conf\nRUN echo \"listen_addresses='*'\" >> /etc/postgresql/$PG_MAJOR/main/postgresql.conf\nUSER postgres\n#   Fix PostgreSQL locale\n#   <http://stackoverflow.com/questions/16736891/pgerror-error-new-encoding-utf8-is-incompatible#16737776>,\n#   <http://www.postgresql.org/message-id/43FE1E65.3030000@genome.chop.edu>,\n#   <http://www.postgresql.org/docs/current/static/multibyte.html#AEN35730>.\nRUN service postgresql start \\\n && psql --command=\"UPDATE pg_database SET datistemplate = FALSE WHERE datname = 'template1';\" \\\n && psql --command=\"DROP DATABASE template1;\" \\\n && psql --command=\"CREATE DATABASE template1 WITH TEMPLATE = template0 ENCODING = 'UNICODE' LC_COLLATE='en_US.UTF-8' LC_CTYPE='en_US.UTF-8';\" \\\n && psql --command=\"UPDATE pg_database SET datistemplate = TRUE WHERE datname = 'template1';\" \\\n && psql --command=\"CREATE ROLE fhirbase WITH SUPERUSER LOGIN PASSWORD 'fhirbase';\" \\\n && psql --command=\"CREATE DATABASE fhirbase WITH OWNER fhirbase ENCODING = 'UTF8';\"\nUSER root\nRUN useradd --user-group --create-home --shell /bin/bash fhirbase \\\n && echo 'fhirbase:fhirbase' | chpasswd \\\n && adduser fhirbase sudo\nRUN echo 'fhirbase ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers\nUSER fhirbase\nRUN cd ~ \\\n && git clone https://github.com/fhirbase/fhirbase-plv8.git fhirbase \\\n && cd ~/fhirbase \\\n && git submodule update --init --recursive\n#   Install nodejs.\nRUN curl --silent -o- https://raw.githubusercontent.com/creationix/nvm/v0.31.1/install.sh | bash\nRUN bash -lc 'source ~/.nvm/nvm.sh \\\n && nvm install 6.2.0'\nRUN bash -lc 'cd ~/fhirbase \\\n && source ~/.nvm/nvm.sh \\\n && nvm use 6.2.0 \\\n && npm install'\nRUN bash -lc 'cd ~/fhirbase/plpl \\\n && source ~/.nvm/nvm.sh \\\n && nvm use 6.2.0 \\\n && npm install'\nUSER root\nENV PLV8_VERSION=\"v1.4.7\"\nRUN cd /tmp \\\n && git clone https://github.com/plv8/plv8.git \\\n && cd /tmp/plv8 \\\n && git checkout $PLV8_VERSION \\\n && make all install\nUSER fhirbase\n#   Install fhirbase.\nRUN bash -lc 'sudo service postgresql start \\\n && cd ~/fhirbase \\\n && source ~/.nvm/nvm.sh \\\n && nvm use 6.2.0 \\\n && export PATH=\"$HOME\"/fhirbase/node_modules/coffee-script/bin:\"$PATH\" \\\n && export DATABASE_URL=postgres://fhirbase:fhirbase@localhost:5432/fhirbase \\\n && ~/fhirbase/build-commit.sh --rebuild \\\n && cat ~/fhirbase/build/latest/build.sql | psql fhirbase'\nUSER root\nCOPY docker-run-tests.sh /\nRUN chmod a+rwx /docker-run-tests.sh\nRUN chown fhirbase /docker-run-tests.sh\n#   Install utils.\nRUN apt-get install openssh-server aptitude --yes\nUSER fhirbase\n#   Expose the PostgreSQL port.\nEXPOSE 5432/tcp\n#   Add VOLUMEs to allow backup of config, logs, socket and databases\nVOLUME [\"/etc/postgresql\", \"/var/log/postgresql\", \"/var/lib/postgresql\", \"/var/run/postgresql\"]\nWORKDIR /home/fhirbase\nCMD /bin/bash\n","originalDockerfileUglifiedHash":"256508eced2dab3161372d6c815f7bc4","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/72cdb79a35e28ab7d584988b91899c0955b6b392.dockerfile"}