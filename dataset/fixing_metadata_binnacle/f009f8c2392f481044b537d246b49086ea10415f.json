{"seed":2911415017,"processedDockerfileHash":"bbcf084cb917775b348d1884a0a90513","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM debian:wheezy\nMAINTAINER Semen Pisarev <s.a.pisarev@gmail.com>\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN echo \"APT::Install-Recommends 0;\" >> /etc/apt/apt.conf.d/01norecommends \\\n && echo \"APT::Install-Suggests 0;\" >> /etc/apt/apt.conf.d/01norecommends\nENV IREDMAIL_VERSION=\"0.9.0\"\n#   TODO: Replace hostname\nENV HOSTNAME=\"mx.example.com\"\nENV DOCKER_LDAP_DN=\"dc=example,dc=com\"\n#   Local sources (for speed-up)\nCOPY ./sources.list.ru /etc/apt/sources.list\n#   Install some necessary packages\nRUN echo 'deb http://inverse.ca/debian wheezy wheezy' > /etc/apt/sources.list.d/00-inverse-ca.list \\\n && apt-key adv --keyserver keys.gnupg.net --recv-key 0x810273C4 \\\n && apt-get update -q \\\n && apt-get install --no-install-recommends apt-utils -y -q \\\n && apt-get install --no-install-recommends curl wget bzip2 dialog openssl rsync rsyslog dovecot-core dovecot-imapd dovecot-ldap dovecot-lmtpd dovecot-managesieved dovecot-mysql dovecot-pop3d dovecot-sieve -y -q \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* \\\n && rm -f /etc/apt/sources.list.d/00-inverse-ca.list\n#   Set working directory\nWORKDIR /opt/iredmail\n#   Copy files, extract iRedMail, remove archive, copy & configure tools\nCOPY ./files ./\nRUN wget -O - --no-check-certificate https://bitbucket.org/zhb/iredmail/downloads/iRedMail-\"${IREDMAIL_VERSION}\".tar.bz2 | tar xvj \\\n && cp -rl iRedMail-\"${IREDMAIL_VERSION}\"/* . \\\n && rm -rf iRedMail-\"${IREDMAIL_VERSION}\"* \\\n && mkdir -p /opt/itools \\\n && cp ./tools/* /opt/itools \\\n && mkdir -p /var/vmail/backup \\\n && mv ./backup.sh /var/vmail/backup \\\n && sed -i 's/dc=example,dc=com/'\"$DOCKER_LDAP_DN\"'/' /opt/itools/create_mail_user_OpenLDAP.py\n#   Fake `uname` and `hostname`\nRUN mv /bin/uname /bin/uname_ \\\n && mv /bin/hostname /bin/hostname_ \\\n && cp -l ./hostname ./uname /bin/\n#   Set hostname\nRUN echo $HOSTNAME > /etc/hostname \\\n && echo $HOSTNAME > /etc/mailname \\\n && mkdir -p /etc/apache2/ \\\n && echo 'ServerName '$HOSTNAME > /etc/apache2/httpd.conf\n#   Make link to Apache log files\nRUN rm -rf /var/www/apache2/ \\\n && mkdir -p /var/log/apache2/www/ /var/www/ \\\n && ln -s /var/log/apache2/www/ /var/www/apache2 \\\n && chown -R www-data:www-data /var/www/ /var/log/apache2/\n#   Make ClamAV socket file (to avoid installation warning)\nRUN touch /tmp/clamd.socket \\\n && chmod -Rf 766 /tmp/clamd.socket\n#   Avoid getty errors in log files\nRUN sed -ri 's/^[1-6]:[2-6]{2,4}:.*/#\\0/' /etc/inittab\n#   Enable services startup during install, \n#     run iRedMail installation & remove unneeded, \n#     disable services startup during install\nRUN sed -i 's/ 101/ 0/' /usr/sbin/policy-rc.d \\\n && IREDMAIL_DEBUG='NO' AUTO_USE_EXISTING_CONFIG_FILE=y AUTO_INSTALL_WITHOUT_CONFIRM=y AUTO_CLEANUP_REMOVE_SENDMAIL=y AUTO_CLEANUP_REMOVE_MOD_PYTHON=y AUTO_CLEANUP_REPLACE_FIREWALL_RULES=n AUTO_CLEANUP_RESTART_IPTABLES=y AUTO_CLEANUP_REPLACE_MYSQL_CONFIG=y AUTO_CLEANUP_RESTART_POSTFIX=n bash iRedMail.sh \\\n && apt-get purge -y -q dialog apt-utils \\\n && apt-get autoremove -y -q \\\n && apt-get clean -y -q \\\n && rm -rf /var/lib/apt/lists/* \\\n && sed -i 's/ 0/ 101/' /usr/sbin/policy-rc.d\n#   Create directory for LDIF files\nRUN mkdir -p ldifs\n#   Create users from mail_users.csv\nRUN if [ -e mail_users.csv ] ; then python /opt/itools/create_mail_user_OpenLDAP.py ./mail_users.csv \\\n && mv ./mail_users.csv.ldif ldifs/20_mail_users.ldif ; fi\n#   Run slapd as root\nRUN rm -rf /etc/ldap/slapd.d \\\n && sed -i 's/openldap/root/g' /etc/default/slapd\n#   Limit slapd memory (see https://github.com/cema-sp/iredmail-docker/issues/3)\nRUN sed -ri 's/^PATH/ulimit -n 1024\\nPATH/' /etc/init.d/slapd\n#   TODO: Replace ldap password (LDAP_ROOTPW)\n#   Copy initial ldif and add all ldifs to ldap\nRUN cp /opt/iredmail/conf/ldap_init.ldif ldifs/00_ldap_init.ldif \\\n && service slapd start \\\n && for f in ldifs/*.ldif; do (ldapadd -D 'cn=Manager,'\"$DOCKER_LDAP_DN\" -w password_ldap -f \"$f\" || ldapmodify -v -D 'cn=Manager,'\"$DOCKER_LDAP_DN\" -w password_ldap -f \"$f\" ) ; done\n#   Encrypy iRedMail.tips\n#   TODO: Replace tips password (random)\nRUN echo 'password' | openssl enc -in /opt/iredmail/iRedMail.tips -out /opt/iRedMail.tips.enc -e -aes256 -pass stdin\n#   Schedule backup script\nRUN (crontab -l 2> /dev/null;echo \"0 4 * * * /bin/bash /var/vmail/backup/backup.sh\" ) | crontab -\n#   Force users to change passwords\nRUN echo \"plugins.append('ldap_force_change_password_in_days')\" >> /opt/iredapd/settings.py \\\n && echo \"CHANGE_PASSWORD_DAYS = 365\" >> /opt/iredapd/settings.py \\\n && echo \"CHANGE_PASSWORD_MESSAGE = 'Please change your password in webmail: https://$HOSTNAME/mail/'\" >> /opt/iredapd/settings.py\nWORKDIR /opt\n#   Remove distr, return `uname` and `hostname`\nRUN rm -rf /opt/iredmail /root/.bash_history \\\n && rm -f /bin/uname /bin/hostname \\\n && mv /bin/uname_ /bin/uname \\\n && mv /bin/hostname_ /bin/hostname\n#   Open Ports: \n#   Apache: 80/tcp, 443/tcp Postfix: 25/tcp, 587/tcp \n#   Dovecot: 110/tcp, 143/tcp, 993/tcp, 995/tcp OpenLDAP: 389/tcp, 636/tcp\nEXPOSE 80/tcp 443/tcp 25/tcp 587/tcp 110/tcp 143/tcp 993/tcp 995/tcp 389/tcp 636/tcp\n#   Volume for backups\nVOLUME /backups\n#   Start all services\nCMD [\"/sbin/init\", \"2\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM debian:wheezy\nMAINTAINER Semen Pisarev <s.a.pisarev@gmail.com>\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN echo \"APT::Install-Recommends 0;\" >> /etc/apt/apt.conf.d/01norecommends \\\n && echo \"APT::Install-Suggests 0;\" >> /etc/apt/apt.conf.d/01norecommends\nENV IREDMAIL_VERSION=\"0.9.0\"\n#  TODO: Replace hostname\nENV HOSTNAME=\"mx.example.com\"\nENV DOCKER_LDAP_DN=\"dc=example,dc=com\"\n#  Local sources (for speed-up)\nCOPY ./sources.list.ru /etc/apt/sources.list\n#  Install some necessary packages\nRUN echo 'deb http://inverse.ca/debian wheezy wheezy' > /etc/apt/sources.list.d/00-inverse-ca.list \\\n && apt-key adv --keyserver keys.gnupg.net --recv-key 0x810273C4 \\\n && apt-get update -q \\\n && apt-get install apt-utils -y -q \\\n && apt-get install curl wget bzip2 dialog openssl rsync rsyslog dovecot-core dovecot-imapd dovecot-ldap dovecot-lmtpd dovecot-managesieved dovecot-mysql dovecot-pop3d dovecot-sieve -y -q \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* \\\n && rm -f /etc/apt/sources.list.d/00-inverse-ca.list\n#  Set working directory\nWORKDIR /opt/iredmail\n#  Copy files, extract iRedMail, remove archive, copy & configure tools\nCOPY ./files ./\nRUN wget -O - --no-check-certificate https://bitbucket.org/zhb/iredmail/downloads/iRedMail-\"${IREDMAIL_VERSION}\".tar.bz2 | tar xvj \\\n && cp -rl iRedMail-\"${IREDMAIL_VERSION}\"/* . \\\n && rm -rf iRedMail-\"${IREDMAIL_VERSION}\"* \\\n && mkdir -p /opt/itools \\\n && cp ./tools/* /opt/itools \\\n && mkdir -p /var/vmail/backup \\\n && mv ./backup.sh /var/vmail/backup \\\n && sed -i 's/dc=example,dc=com/'\"$DOCKER_LDAP_DN\"'/' /opt/itools/create_mail_user_OpenLDAP.py\n#  Fake `uname` and `hostname`\nRUN mv /bin/uname /bin/uname_ \\\n && mv /bin/hostname /bin/hostname_ \\\n && cp -l ./hostname ./uname /bin/\n#  Set hostname\nRUN echo $HOSTNAME > /etc/hostname \\\n && echo $HOSTNAME > /etc/mailname \\\n && mkdir -p /etc/apache2/ \\\n && echo 'ServerName '$HOSTNAME > /etc/apache2/httpd.conf\n#  Make link to Apache log files\nRUN rm -rf /var/www/apache2/ \\\n && mkdir -p /var/log/apache2/www/ /var/www/ \\\n && ln -s /var/log/apache2/www/ /var/www/apache2 \\\n && chown -R www-data:www-data /var/www/ /var/log/apache2/\n#  Make ClamAV socket file (to avoid installation warning)\nRUN touch /tmp/clamd.socket \\\n && chmod -Rf 766 /tmp/clamd.socket\n#  Avoid getty errors in log files\nRUN sed -ri 's/^[1-6]:[2-6]{2,4}:.*/#\\0/' /etc/inittab\n#  Enable services startup during install, \n#    run iRedMail installation & remove unneeded, \n#    disable services startup during install\nRUN sed -i 's/ 101/ 0/' /usr/sbin/policy-rc.d \\\n && IREDMAIL_DEBUG='NO' AUTO_USE_EXISTING_CONFIG_FILE=y AUTO_INSTALL_WITHOUT_CONFIRM=y AUTO_CLEANUP_REMOVE_SENDMAIL=y AUTO_CLEANUP_REMOVE_MOD_PYTHON=y AUTO_CLEANUP_REPLACE_FIREWALL_RULES=n AUTO_CLEANUP_RESTART_IPTABLES=y AUTO_CLEANUP_REPLACE_MYSQL_CONFIG=y AUTO_CLEANUP_RESTART_POSTFIX=n bash iRedMail.sh \\\n && apt-get purge -y -q dialog apt-utils \\\n && apt-get autoremove -y -q \\\n && apt-get clean -y -q \\\n && rm -rf /var/lib/apt/lists/* \\\n && sed -i 's/ 0/ 101/' /usr/sbin/policy-rc.d\n#  Create directory for LDIF files\nRUN mkdir -p ldifs\n#  Create users from mail_users.csv\nRUN if [ -e mail_users.csv ] ; then python /opt/itools/create_mail_user_OpenLDAP.py ./mail_users.csv \\\n && mv ./mail_users.csv.ldif ldifs/20_mail_users.ldif ; fi\n#  Run slapd as root\nRUN rm -rf /etc/ldap/slapd.d \\\n && sed -i 's/openldap/root/g' /etc/default/slapd\n#  Limit slapd memory (see https://github.com/cema-sp/iredmail-docker/issues/3)\nRUN sed -ri 's/^PATH/ulimit -n 1024\\nPATH/' /etc/init.d/slapd\n#  TODO: Replace ldap password (LDAP_ROOTPW)\n#  Copy initial ldif and add all ldifs to ldap\nRUN cp /opt/iredmail/conf/ldap_init.ldif ldifs/00_ldap_init.ldif \\\n && service slapd start \\\n && for f in ldifs/*.ldif; do (ldapadd -D 'cn=Manager,'\"$DOCKER_LDAP_DN\" -w password_ldap -f \"$f\" || ldapmodify -v -D 'cn=Manager,'\"$DOCKER_LDAP_DN\" -w password_ldap -f \"$f\" ) ; done\n#  Encrypy iRedMail.tips\n#  TODO: Replace tips password (random)\nRUN echo 'password' | openssl enc -in /opt/iredmail/iRedMail.tips -out /opt/iRedMail.tips.enc -e -aes256 -pass stdin\n#  Schedule backup script\nRUN (crontab -l 2> /dev/null;echo \"0 4 * * * /bin/bash /var/vmail/backup/backup.sh\" ) | crontab -\n#  Force users to change passwords\nRUN echo \"plugins.append('ldap_force_change_password_in_days')\" >> /opt/iredapd/settings.py \\\n && echo \"CHANGE_PASSWORD_DAYS = 365\" >> /opt/iredapd/settings.py \\\n && echo \"CHANGE_PASSWORD_MESSAGE = 'Please change your password in webmail: https://$HOSTNAME/mail/'\" >> /opt/iredapd/settings.py\nWORKDIR /opt\n#  Remove distr, return `uname` and `hostname`\nRUN rm -rf /opt/iredmail /root/.bash_history \\\n && rm -f /bin/uname /bin/hostname \\\n && mv /bin/uname_ /bin/uname \\\n && mv /bin/hostname_ /bin/hostname\n#  Open Ports: \n#  Apache: 80/tcp, 443/tcp Postfix: 25/tcp, 587/tcp \n#  Dovecot: 110/tcp, 143/tcp, 993/tcp, 995/tcp OpenLDAP: 389/tcp, 636/tcp\nEXPOSE 80/tcp 443/tcp 25/tcp 587/tcp 110/tcp 143/tcp 993/tcp 995/tcp 389/tcp 636/tcp\n#  Volume for backups\nVOLUME /backups\n#  Start all services\nCMD [\"/sbin/init\", \"2\"]\n","injectedSmells":[],"originalDockerfileHash":"f468697fc7cbf7b8cf81c40bad88aae9","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM debian:wheezy\nMAINTAINER Semen Pisarev <s.a.pisarev@gmail.com>\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN echo \"APT::Install-Recommends 0;\" >> /etc/apt/apt.conf.d/01norecommends \\\n && echo \"APT::Install-Suggests 0;\" >> /etc/apt/apt.conf.d/01norecommends\nENV IREDMAIL_VERSION=\"0.9.0\"\n#   TODO: Replace hostname\nENV HOSTNAME=\"mx.example.com\"\nENV DOCKER_LDAP_DN=\"dc=example,dc=com\"\n#   Local sources (for speed-up)\nCOPY ./sources.list.ru /etc/apt/sources.list\n#   Install some necessary packages\nRUN echo 'deb http://inverse.ca/debian wheezy wheezy' > /etc/apt/sources.list.d/00-inverse-ca.list \\\n && apt-key adv --keyserver keys.gnupg.net --recv-key 0x810273C4 \\\n && apt-get update -q \\\n && apt-get install apt-utils -y -q \\\n && apt-get install curl wget bzip2 dialog openssl rsync rsyslog dovecot-core dovecot-imapd dovecot-ldap dovecot-lmtpd dovecot-managesieved dovecot-mysql dovecot-pop3d dovecot-sieve -y -q \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* \\\n && rm -f /etc/apt/sources.list.d/00-inverse-ca.list\n#   Set working directory\nWORKDIR /opt/iredmail\n#   Copy files, extract iRedMail, remove archive, copy & configure tools\nCOPY ./files ./\nRUN wget -O - --no-check-certificate https://bitbucket.org/zhb/iredmail/downloads/iRedMail-\"${IREDMAIL_VERSION}\".tar.bz2 | tar xvj \\\n && cp -rl iRedMail-\"${IREDMAIL_VERSION}\"/* . \\\n && rm -rf iRedMail-\"${IREDMAIL_VERSION}\"* \\\n && mkdir -p /opt/itools \\\n && cp ./tools/* /opt/itools \\\n && mkdir -p /var/vmail/backup \\\n && mv ./backup.sh /var/vmail/backup \\\n && sed -i 's/dc=example,dc=com/'\"$DOCKER_LDAP_DN\"'/' /opt/itools/create_mail_user_OpenLDAP.py\n#   Fake `uname` and `hostname`\nRUN mv /bin/uname /bin/uname_ \\\n && mv /bin/hostname /bin/hostname_ \\\n && cp -l ./hostname ./uname /bin/\n#   Set hostname\nRUN echo $HOSTNAME > /etc/hostname \\\n && echo $HOSTNAME > /etc/mailname \\\n && mkdir -p /etc/apache2/ \\\n && echo 'ServerName '$HOSTNAME > /etc/apache2/httpd.conf\n#   Make link to Apache log files\nRUN rm -rf /var/www/apache2/ \\\n && mkdir -p /var/log/apache2/www/ /var/www/ \\\n && ln -s /var/log/apache2/www/ /var/www/apache2 \\\n && chown -R www-data:www-data /var/www/ /var/log/apache2/\n#   Make ClamAV socket file (to avoid installation warning)\nRUN touch /tmp/clamd.socket \\\n && chmod -Rf 766 /tmp/clamd.socket\n#   Avoid getty errors in log files\nRUN sed -ri 's/^[1-6]:[2-6]{2,4}:.*/#\\0/' /etc/inittab\n#   Enable services startup during install, \n#     run iRedMail installation & remove unneeded, \n#     disable services startup during install\nRUN sed -i 's/ 101/ 0/' /usr/sbin/policy-rc.d \\\n && IREDMAIL_DEBUG='NO' AUTO_USE_EXISTING_CONFIG_FILE=y AUTO_INSTALL_WITHOUT_CONFIRM=y AUTO_CLEANUP_REMOVE_SENDMAIL=y AUTO_CLEANUP_REMOVE_MOD_PYTHON=y AUTO_CLEANUP_REPLACE_FIREWALL_RULES=n AUTO_CLEANUP_RESTART_IPTABLES=y AUTO_CLEANUP_REPLACE_MYSQL_CONFIG=y AUTO_CLEANUP_RESTART_POSTFIX=n bash iRedMail.sh \\\n && apt-get purge -y -q dialog apt-utils \\\n && apt-get autoremove -y -q \\\n && apt-get clean -y -q \\\n && rm -rf /var/lib/apt/lists/* \\\n && sed -i 's/ 0/ 101/' /usr/sbin/policy-rc.d\n#   Create directory for LDIF files\nRUN mkdir -p ldifs\n#   Create users from mail_users.csv\nRUN if [ -e mail_users.csv ] ; then python /opt/itools/create_mail_user_OpenLDAP.py ./mail_users.csv \\\n && mv ./mail_users.csv.ldif ldifs/20_mail_users.ldif ; fi\n#   Run slapd as root\nRUN rm -rf /etc/ldap/slapd.d \\\n && sed -i 's/openldap/root/g' /etc/default/slapd\n#   Limit slapd memory (see https://github.com/cema-sp/iredmail-docker/issues/3)\nRUN sed -ri 's/^PATH/ulimit -n 1024\\nPATH/' /etc/init.d/slapd\n#   TODO: Replace ldap password (LDAP_ROOTPW)\n#   Copy initial ldif and add all ldifs to ldap\nRUN cp /opt/iredmail/conf/ldap_init.ldif ldifs/00_ldap_init.ldif \\\n && service slapd start \\\n && for f in ldifs/*.ldif; do (ldapadd -D 'cn=Manager,'\"$DOCKER_LDAP_DN\" -w password_ldap -f \"$f\" || ldapmodify -v -D 'cn=Manager,'\"$DOCKER_LDAP_DN\" -w password_ldap -f \"$f\" ) ; done\n#   Encrypy iRedMail.tips\n#   TODO: Replace tips password (random)\nRUN echo 'password' | openssl enc -in /opt/iredmail/iRedMail.tips -out /opt/iRedMail.tips.enc -e -aes256 -pass stdin\n#   Schedule backup script\nRUN (crontab -l 2> /dev/null;echo \"0 4 * * * /bin/bash /var/vmail/backup/backup.sh\" ) | crontab -\n#   Force users to change passwords\nRUN echo \"plugins.append('ldap_force_change_password_in_days')\" >> /opt/iredapd/settings.py \\\n && echo \"CHANGE_PASSWORD_DAYS = 365\" >> /opt/iredapd/settings.py \\\n && echo \"CHANGE_PASSWORD_MESSAGE = 'Please change your password in webmail: https://$HOSTNAME/mail/'\" >> /opt/iredapd/settings.py\nWORKDIR /opt\n#   Remove distr, return `uname` and `hostname`\nRUN rm -rf /opt/iredmail /root/.bash_history \\\n && rm -f /bin/uname /bin/hostname \\\n && mv /bin/uname_ /bin/uname \\\n && mv /bin/hostname_ /bin/hostname\n#   Open Ports: \n#   Apache: 80/tcp, 443/tcp Postfix: 25/tcp, 587/tcp \n#   Dovecot: 110/tcp, 143/tcp, 993/tcp, 995/tcp OpenLDAP: 389/tcp, 636/tcp\nEXPOSE 80/tcp 443/tcp 25/tcp 587/tcp 110/tcp 143/tcp 993/tcp 995/tcp 389/tcp 636/tcp\n#   Volume for backups\nVOLUME /backups\n#   Start all services\nCMD [\"/sbin/init\", \"2\"]\n","originalDockerfileUglifiedHash":"bfe49e1666cee8c1eb8680e2a35a6bf5","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/f009f8c2392f481044b537d246b49086ea10415f.dockerfile"}