{"seed":1264311373,"processedDockerfileHash":"87d7b10059a1c4f34aa16663cd96178f","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM rhscl/ruby-25-rhel7:latest AS builder\nMAINTAINER OpenShift Development <dev@lists.openshift.redhat.com>\nENV DATA_VERSION=\"1.6.0\" \\\n    FLUENTD_VERSION=\"1.5.1\" \\\n    HOME=\"/opt/app-root/src\" \\\n    PATH=\"/opt/app-root/src/bin:/opt/app-root/bin:$PATH\" \\\n    LOGGING_FILE_PATH=\"/var/log/fluentd/fluentd.log\" \\\n    LOGGING_FILE_AGE=\"10\" \\\n    LOGGING_FILE_SIZE=\"1024000\" \\\n    container=\"oci\"\nARG TEST_REPO\n#  ADD test.repo /etc/yum.repos.d\nUSER 0\nRUN yum-config-manager --enable rhel-7-server-ose-4.1-rpms \\\n && INSTALL_PKGS=\"make gcc-c++ libffi-devel autoconf automake libtool m4 redhat-rpm-config\" \\\n && yum install -y --setopt=tsflags=nodocs $INSTALL_PKGS \\\n && rpm -V $INSTALL_PKGS \\\n && yum clean all\n#   uncomment if you want to try out test rpm builds\n#  ADD *.rpm /tmp/\n#  RUN yum -y install /tmp/*.rpm\nCOPY jemalloc/ ${HOME}/jemalloc/\nRUN cd ${HOME}/jemalloc \\\n && EXTRA_CFLAGS=\"$( rpm --eval '%{optflags}' ;)\" ./autogen.sh \\\n && make install_lib_shared install_bin \\\n && cp COPYING ${HOME}/COPYING.jemalloc \\\n && cd .. \\\n && rm -rf jemalloc\nCOPY source.jemalloc /source.jemalloc\nRUN bash -c '. /source.jemalloc; echo jemalloc $JEMALLOC_VER >> /contents'\nCOPY vendored_gem_src/ ${HOME}/vendored_gem_src/\nCOPY install-gems.sh *.patch.sh *.patch ${HOME}/vendored_gem_src/\nRUN cd ${HOME}/vendored_gem_src/ \\\n && ./install-gems.sh \\\n && cd / \\\n && rm -rf ${HOME}/vendored_gem_src/\nFROM rhel7:7-released\nENV DATA_VERSION=\"1.6.0\" \\\n    FLUENTD_VERSION=\"1.5.1\" \\\n    HOME=\"/opt/app-root/src\" \\\n    PATH=\"/opt/app-root/src/bin:/opt/app-root/bin:$PATH\" \\\n    LOGGING_FILE_PATH=\"/var/log/fluentd/fluentd.log\" \\\n    LOGGING_FILE_AGE=\"10\" \\\n    LOGGING_FILE_SIZE=\"1024000\" \\\n    container=\"oci\"\n#  ADD test.repo /etc/yum.repos.d\nUSER 0\nRUN yum-config-manager --enable rhel-7-server-ose-4.1-rpms --enable rhscl-3.2-rh-ruby25-rhel-7 > /dev/null \\\n && INSTALL_PKGS=\"hostname bc iproute\" \\\n && SCL_PKGS=\"rh-ruby25 rh-ruby25-runtime rh-ruby25-ruby rh-ruby25-rubygem-openssl rh-ruby25-rubygem-json rh-ruby25-ruby-libs rh-ruby25-rubygems rh-ruby25-ruby-irb\" \\\n && yum install -y --setopt=tsflags=nodocs $INSTALL_PKGS $SCL_PKGS \\\n && rpm -V $INSTALL_PKGS $SCL_PKGS \\\n && yum clean all\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/share/gems/gems/** /opt/rh/rh-ruby25/root/usr/local/share/gems/gems/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/share/gems/specifications/** /opt/rh/rh-ruby25/root/usr/local/share/gems/specifications/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/share/gems/extensions/** /opt/rh/rh-ruby25/root/usr/local/share/gems/extensions/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/lib64/gems/ruby/** /opt/rh/rh-ruby25/root/usr/local/lib64/gems/ruby/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/lib/** /opt/rh/rh-ruby25/root/usr/local/lib/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/bin/** /opt/rh/rh-ruby25/root/usr/local/bin/\nCOPY --from=builder /usr/local/lib/** /usr/local/lib/\nCOPY --from=builder /usr/local/bin/** /usr/local/bin/\nCOPY --from=builder /contents /contents\nRUN mkdir -p /etc/fluent/plugin\nCOPY configs.d/ /etc/fluent/configs.d/\nCOPY out_syslog_buffered.rb out_syslog.rb out_rawtcp.rb /etc/fluent/plugin/\nCOPY parser_viaq_docker_audit.rb viaq_docker_audit.rb /etc/fluent/plugin/\nCOPY run.sh generate_syslog_config.rb ${HOME}/\nCOPY lib/generate_throttle_configs/lib/*.rb ${HOME}/\nCOPY lib/filter_parse_json_field/lib/*.rb /etc/fluent/plugin/\nCOPY lib/filter_elasticsearch_genid_ext/lib/filter_elasticsearch_genid_ext.rb /etc/fluent/plugin/\nCOPY utils/** /usr/local/bin/\nRUN mkdir -p /etc/fluent/configs.d/{dynamic,user} \\\n && chmod 777 /etc/fluent/configs.d/dynamic \\\n && ln -s /etc/fluent/configs.d/user/fluent.conf /etc/fluent/fluent.conf\nWORKDIR ${HOME}\nCMD [\"scl\", \"enable\", \"rh-ruby25\", \"--\", \"sh\", \"run.sh\"]\nLABEL io.k8s.display-name=\"Fluentd\"\nLABEL io.k8s.description=\"Fluentd container for collecting of container logs\" \\\n      com.redhat.component=\"logging-fluentd-container\" \\\n      vendor=\"Red Hat\" \\\n      name=\"openshift3/logging-fluentd\" \\\n      License=\"GPLv2+\" \\\n      io.k8s.display-name=\"Fluentd\" \\\n      version=\"v4.0.0\" \\\n      architecture=\"x86_64\" \\\n      release=\"0.0.0.0\" \\\n      io.openshift.tags=\"logging,elk,fluentd\"\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM rhscl/ruby-25-rhel7:latest AS builder\nMAINTAINER OpenShift Development <dev@lists.openshift.redhat.com>\nENV DATA_VERSION=\"1.6.0\" \\\n    FLUENTD_VERSION=\"1.5.1\" \\\n    HOME=\"/opt/app-root/src\" \\\n    PATH=\"/opt/app-root/src/bin:/opt/app-root/bin:$PATH\" \\\n    LOGGING_FILE_PATH=\"/var/log/fluentd/fluentd.log\" \\\n    LOGGING_FILE_AGE=\"10\" \\\n    LOGGING_FILE_SIZE=\"1024000\" \\\n    container=\"oci\"\nARG TEST_REPO\n# ADD test.repo /etc/yum.repos.d\nUSER 0\nRUN yum-config-manager --enable rhel-7-server-ose-4.1-rpms \\\n && INSTALL_PKGS=\"make gcc-c++ libffi-devel autoconf automake libtool m4 redhat-rpm-config\" \\\n && yum install -y --setopt=tsflags=nodocs $INSTALL_PKGS \\\n && rpm -V $INSTALL_PKGS \\\n && yum clean all\n#  uncomment if you want to try out test rpm builds\n# ADD *.rpm /tmp/\n# RUN yum -y install /tmp/*.rpm\nADD jemalloc/ ${HOME}/jemalloc/\nRUN cd ${HOME}/jemalloc \\\n && EXTRA_CFLAGS=\"$( rpm --eval '%{optflags}' ;)\" ./autogen.sh \\\n && make install_lib_shared install_bin \\\n && cp COPYING ${HOME}/COPYING.jemalloc \\\n && cd .. \\\n && rm -rf jemalloc\nADD source.jemalloc /source.jemalloc\nRUN bash -c '. /source.jemalloc; echo jemalloc $JEMALLOC_VER >> /contents'\nADD vendored_gem_src/ ${HOME}/vendored_gem_src/\nADD install-gems.sh *.patch.sh *.patch ${HOME}/vendored_gem_src/\nRUN cd ${HOME}/vendored_gem_src/ \\\n && ./install-gems.sh \\\n && cd / \\\n && rm -rf ${HOME}/vendored_gem_src/\nFROM rhel7:7-released\nENV DATA_VERSION=\"1.6.0\" \\\n    FLUENTD_VERSION=\"1.5.1\" \\\n    HOME=\"/opt/app-root/src\" \\\n    PATH=\"/opt/app-root/src/bin:/opt/app-root/bin:$PATH\" \\\n    LOGGING_FILE_PATH=\"/var/log/fluentd/fluentd.log\" \\\n    LOGGING_FILE_AGE=\"10\" \\\n    LOGGING_FILE_SIZE=\"1024000\" \\\n    container=\"oci\"\n# ADD test.repo /etc/yum.repos.d\nUSER 0\nRUN yum-config-manager --enable rhel-7-server-ose-4.1-rpms --enable rhscl-3.2-rh-ruby25-rhel-7 > /dev/null \\\n && INSTALL_PKGS=\"hostname bc iproute\" \\\n && SCL_PKGS=\"rh-ruby25 rh-ruby25-runtime rh-ruby25-ruby rh-ruby25-rubygem-openssl rh-ruby25-rubygem-json rh-ruby25-ruby-libs rh-ruby25-rubygems rh-ruby25-ruby-irb\" \\\n && yum install -y --setopt=tsflags=nodocs $INSTALL_PKGS $SCL_PKGS \\\n && rpm -V $INSTALL_PKGS $SCL_PKGS \\\n && yum clean all\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/share/gems/gems/** /opt/rh/rh-ruby25/root/usr/local/share/gems/gems/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/share/gems/specifications/** /opt/rh/rh-ruby25/root/usr/local/share/gems/specifications/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/share/gems/extensions/** /opt/rh/rh-ruby25/root/usr/local/share/gems/extensions/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/lib64/gems/ruby/** /opt/rh/rh-ruby25/root/usr/local/lib64/gems/ruby/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/lib/** /opt/rh/rh-ruby25/root/usr/local/lib/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/bin/** /opt/rh/rh-ruby25/root/usr/local/bin/\nCOPY --from=builder /usr/local/lib/** /usr/local/lib/\nCOPY --from=builder /usr/local/bin/** /usr/local/bin/\nCOPY --from=builder /contents /contents\nRUN mkdir -p /etc/fluent/plugin\nADD configs.d/ /etc/fluent/configs.d/\nADD out_syslog_buffered.rb out_syslog.rb out_rawtcp.rb /etc/fluent/plugin/\nADD parser_viaq_docker_audit.rb viaq_docker_audit.rb /etc/fluent/plugin/\nADD run.sh generate_syslog_config.rb ${HOME}/\nADD lib/generate_throttle_configs/lib/*.rb ${HOME}/\nADD lib/filter_parse_json_field/lib/*.rb /etc/fluent/plugin/\nADD lib/filter_elasticsearch_genid_ext/lib/filter_elasticsearch_genid_ext.rb /etc/fluent/plugin/\nCOPY utils/** /usr/local/bin/\nRUN mkdir -p /etc/fluent/configs.d/{dynamic,user} \\\n && chmod 777 /etc/fluent/configs.d/dynamic \\\n && ln -s /etc/fluent/configs.d/user/fluent.conf /etc/fluent/fluent.conf\nWORKDIR ${HOME}\nCMD [\"scl\", \"enable\", \"rh-ruby25\", \"--\", \"sh\", \"run.sh\"]\nLABEL io.k8s.display-name=\"Fluentd\"\nLABEL io.k8s.description=\"Fluentd container for collecting of container logs\" \\\n      com.redhat.component=\"logging-fluentd-container\" \\\n      vendor=\"Red Hat\" \\\n      name=\"openshift3/logging-fluentd\" \\\n      License=\"GPLv2+\" \\\n      io.k8s.display-name=\"Fluentd\" \\\n      version=\"v4.0.0\" \\\n      architecture=\"x86_64\" \\\n      release=\"0.0.0.0\" \\\n      io.openshift.tags=\"logging,elk,fluentd\"\n","injectedSmells":[],"originalDockerfileHash":"aaea54416a507bc4b90cfdd34b5bdc4d","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM rhscl/ruby-25-rhel7:latest AS builder\nMAINTAINER OpenShift Development <dev@lists.openshift.redhat.com>\nENV DATA_VERSION=\"1.6.0\" \\\n    FLUENTD_VERSION=\"1.5.1\" \\\n    HOME=\"/opt/app-root/src\" \\\n    PATH=\"/opt/app-root/src/bin:/opt/app-root/bin:$PATH\" \\\n    LOGGING_FILE_PATH=\"/var/log/fluentd/fluentd.log\" \\\n    LOGGING_FILE_AGE=\"10\" \\\n    LOGGING_FILE_SIZE=\"1024000\" \\\n    container=\"oci\"\nARG TEST_REPO\n#  ADD test.repo /etc/yum.repos.d\nUSER 0\nRUN yum-config-manager --enable rhel-7-server-ose-4.1-rpms \\\n && INSTALL_PKGS=\"make gcc-c++ libffi-devel autoconf automake libtool m4 redhat-rpm-config\" \\\n && yum install -y --setopt=tsflags=nodocs $INSTALL_PKGS \\\n && rpm -V $INSTALL_PKGS \\\n && yum clean all\n#   uncomment if you want to try out test rpm builds\n#  ADD *.rpm /tmp/\n#  RUN yum -y install /tmp/*.rpm\nADD jemalloc/ ${HOME}/jemalloc/\nRUN cd ${HOME}/jemalloc \\\n && EXTRA_CFLAGS=\"$( rpm --eval '%{optflags}' ;)\" ./autogen.sh \\\n && make install_lib_shared install_bin \\\n && cp COPYING ${HOME}/COPYING.jemalloc \\\n && cd .. \\\n && rm -rf jemalloc\nADD source.jemalloc /source.jemalloc\nRUN bash -c '. /source.jemalloc; echo jemalloc $JEMALLOC_VER >> /contents'\nADD vendored_gem_src/ ${HOME}/vendored_gem_src/\nADD install-gems.sh *.patch.sh *.patch ${HOME}/vendored_gem_src/\nRUN cd ${HOME}/vendored_gem_src/ \\\n && ./install-gems.sh \\\n && cd / \\\n && rm -rf ${HOME}/vendored_gem_src/\nFROM rhel7:7-released\nENV DATA_VERSION=\"1.6.0\" \\\n    FLUENTD_VERSION=\"1.5.1\" \\\n    HOME=\"/opt/app-root/src\" \\\n    PATH=\"/opt/app-root/src/bin:/opt/app-root/bin:$PATH\" \\\n    LOGGING_FILE_PATH=\"/var/log/fluentd/fluentd.log\" \\\n    LOGGING_FILE_AGE=\"10\" \\\n    LOGGING_FILE_SIZE=\"1024000\" \\\n    container=\"oci\"\n#  ADD test.repo /etc/yum.repos.d\nUSER 0\nRUN yum-config-manager --enable rhel-7-server-ose-4.1-rpms --enable rhscl-3.2-rh-ruby25-rhel-7 > /dev/null \\\n && INSTALL_PKGS=\"hostname bc iproute\" \\\n && SCL_PKGS=\"rh-ruby25 rh-ruby25-runtime rh-ruby25-ruby rh-ruby25-rubygem-openssl rh-ruby25-rubygem-json rh-ruby25-ruby-libs rh-ruby25-rubygems rh-ruby25-ruby-irb\" \\\n && yum install -y --setopt=tsflags=nodocs $INSTALL_PKGS $SCL_PKGS \\\n && rpm -V $INSTALL_PKGS $SCL_PKGS \\\n && yum clean all\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/share/gems/gems/** /opt/rh/rh-ruby25/root/usr/local/share/gems/gems/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/share/gems/specifications/** /opt/rh/rh-ruby25/root/usr/local/share/gems/specifications/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/share/gems/extensions/** /opt/rh/rh-ruby25/root/usr/local/share/gems/extensions/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/lib64/gems/ruby/** /opt/rh/rh-ruby25/root/usr/local/lib64/gems/ruby/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/lib/** /opt/rh/rh-ruby25/root/usr/local/lib/\nCOPY --from=builder /opt/rh/rh-ruby25/root/usr/local/bin/** /opt/rh/rh-ruby25/root/usr/local/bin/\nCOPY --from=builder /usr/local/lib/** /usr/local/lib/\nCOPY --from=builder /usr/local/bin/** /usr/local/bin/\nCOPY --from=builder /contents /contents\nRUN mkdir -p /etc/fluent/plugin\nADD configs.d/ /etc/fluent/configs.d/\nADD out_syslog_buffered.rb out_syslog.rb out_rawtcp.rb /etc/fluent/plugin/\nADD parser_viaq_docker_audit.rb viaq_docker_audit.rb /etc/fluent/plugin/\nADD run.sh generate_syslog_config.rb ${HOME}/\nADD lib/generate_throttle_configs/lib/*.rb ${HOME}/\nADD lib/filter_parse_json_field/lib/*.rb /etc/fluent/plugin/\nADD lib/filter_elasticsearch_genid_ext/lib/filter_elasticsearch_genid_ext.rb /etc/fluent/plugin/\nCOPY utils/** /usr/local/bin/\nRUN mkdir -p /etc/fluent/configs.d/{dynamic,user} \\\n && chmod 777 /etc/fluent/configs.d/dynamic \\\n && ln -s /etc/fluent/configs.d/user/fluent.conf /etc/fluent/fluent.conf\nWORKDIR ${HOME}\nCMD [\"scl\", \"enable\", \"rh-ruby25\", \"--\", \"sh\", \"run.sh\"]\nLABEL io.k8s.display-name=\"Fluentd\"\nLABEL io.k8s.description=\"Fluentd container for collecting of container logs\" \\\n      com.redhat.component=\"logging-fluentd-container\" \\\n      vendor=\"Red Hat\" \\\n      name=\"openshift3/logging-fluentd\" \\\n      License=\"GPLv2+\" \\\n      io.k8s.display-name=\"Fluentd\" \\\n      version=\"v4.0.0\" \\\n      architecture=\"x86_64\" \\\n      release=\"0.0.0.0\" \\\n      io.openshift.tags=\"logging,elk,fluentd\"\n","originalDockerfileUglifiedHash":"bb03b7f9e3f28ecb747aee0f86032c2f","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/cebcc78f539ef3a9591c135a54d44c22ac04fefa.dockerfile"}