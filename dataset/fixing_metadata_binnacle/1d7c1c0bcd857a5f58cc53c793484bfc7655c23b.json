{"seed":3174453667,"processedDockerfileHash":"d0e1df54521dea4460414ea556e553c3","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   To run, use the command docker build . -f docker/build/go-agent/Dockerfile --tag edx-ops/go-agent:latest\n#   https://hub.docker.com/r/gocd/gocd-agent-ubuntu-16.04/\nFROM gocd/gocd-agent-ubuntu-16.04:v17.10.0\nLABEL version=\"0.02\" \\\n      description=\"This custom go-agent docker file installs additional requirements for the edx pipeline\"\n#   Set locale to UTF-8 which is not the default for go-agent Docker container\nRUN apt-get update \\\n && apt-get install --no-install-recommends locales -y \\\n && locale-gen en_US.UTF-8\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US:en\"\nENV LC_ALL=\"en_US.UTF-8\"\n#   starting with 16.04 apt-get-repository is not installed in the base image, lets install it so we are ready\n#   http://lifeonubuntu.com/ubuntu-missing-add-apt-repository-command/\nRUN apt-get update \\\n && apt-get install --no-install-recommends software-properties-common python-software-properties -y -q\n#   Install a modern git client\nRUN add-apt-repository -y ppa:git-core/ppa \\\n && apt-get update \\\n && apt-get install --no-install-recommends git -y\n#   Configure ca-certificates for java\nRUN /var/lib/dpkg/info/ca-certificates-java.postinst configure\n#   Define working directory.\nWORKDIR /data\n#   Install Python and package mgmt tools.\nRUN apt-get update \\\n && apt-get install --no-install-recommends python python-dev python-distribute python-pip libmysqlclient-dev python3-pip -y -q\n#   Install dependencies needed for Ansible 2.x\nRUN apt-get update \\\n && apt-get install --no-install-recommends libffi-dev libssl-dev -y\n#   Install sudo to execute commands with root privileges\nRUN apt-get install --no-install-recommends sudo -y\n#   Install packages needed for Docker installation\nRUN apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https gnupg-agent -y\n#   Add Docker's GPG key and repository\nRUN curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - \\\n && add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu $( lsb_release -cs ;) stable\"\n#   Install Docker - for Docker container building by a go-agent.\nRUN apt-get update \\\n && apt-get install --no-install-recommends docker-ce -y\n#   Add the go user to the docker group to allow the go user to run docker commands.\n#   See: https://docs.docker.com/engine/installation/linux/ubuntulinux/\nRUN usermod -aG docker go\n#   Assign the go user root privlidges\nRUN printf \"\\ngo ALL=(ALL:ALL) NOPASSWD: /usr/bin/pip, /usr/local/bin/pip\\n\" >> /etc/sudoers\nRUN printf \"\\ngo ALL=(ALL:ALL) NOPASSWD: /usr/bin/pip3, /usr/local/bin/pip3\\n\" >> /etc/sudoers\n#   Upgrade pip and setup tools. Needed for Ansible 2.x\nRUN pip3 install --upgrade pip==9.0.3 \\\n && pip2 install --upgrade pip==9.0.3 \\\n && hash -r \\\n && pip install setuptools==39.0.1 --upgrade \\\n && pip3 install --upgrade setuptools==39.0.1\n#   Compile python 3.6 for Zappa, as zappa requires python 2.7 or 3.6.\n#   There is no bionic GOCD official image published to base off of, and there is no official 3.6 python package for ubuntu 14.04 or 16.04\n#   This will only be on your path as 'python3.6' it will not change the current 'python3' on your path to python 3.6\n#   This isnt a separate agent because deploys of this are likely quite rare.\n#   If we update the GOCD agent to use ubuntu > 14 we can just use the python3\n#   that is already installed for zappa deployments.\nRUN apt-get update \\\n && apt-get install --no-install-recommends zlib1g-dev wget lsb-core -qy \\\n && cd /opt \\\n && wget https://www.python.org/ftp/python/3.6.7/Python-3.6.7.tgz \\\n && tar -xvf Python-3.6.7.tgz \\\n && cd /opt/Python-3.6.7 \\\n && ./configure --prefix=/usr \\\n && cd /opt/Python-3.6.7 \\\n && make \\\n && make commoninstall maninstall \\\n && rm -rf /opt/Python-3.6.7\n#   Install AWS command-line interface - for AWS operations in a go-agent task.\nRUN pip install 'awscli>=1.11.58'\n#   !!!!NOTICE!!!! ---- Runner of this pipeline take heed!! You must replace go_github_key.pem with the REAL key material\n#   that can checkout private github repositories used as pipeline materials. The key material here is faked and is only\n#   used to pass CI!\n#   setup the github identity\nCOPY docker/build/go-agent/files/go_github_key.pem /home/go/.ssh/id_rsa\nRUN chmod 600 /home/go/.ssh/id_rsa \\\n && chown go:go /home/go/.ssh/id_rsa\n#   setup the known_hosts\nRUN touch /home/go/.ssh/known_hosts \\\n && chmod 600 /home/go/.ssh/known_hosts \\\n && chown go:go /home/go/.ssh/known_hosts \\\n && ssh-keyscan -t rsa,dsa github.com > /home/go/.ssh/known_hosts\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  To run, use the command docker build . -f docker/build/go-agent/Dockerfile --tag edx-ops/go-agent:latest\n#  https://hub.docker.com/r/gocd/gocd-agent-ubuntu-16.04/\nFROM gocd/gocd-agent-ubuntu-16.04:v17.10.0\nLABEL version=\"0.02\" \\\n      description=\"This custom go-agent docker file installs additional requirements for the edx pipeline\"\n#  Set locale to UTF-8 which is not the default for go-agent Docker container\nRUN apt-get update \\\n && apt-get install locales -y \\\n && locale-gen en_US.UTF-8\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US:en\"\nENV LC_ALL=\"en_US.UTF-8\"\n#  starting with 16.04 apt-get-repository is not installed in the base image, lets install it so we are ready\n#  http://lifeonubuntu.com/ubuntu-missing-add-apt-repository-command/\nRUN apt-get update \\\n && apt-get install software-properties-common python-software-properties -y -q\n#  Install a modern git client\nRUN add-apt-repository -y ppa:git-core/ppa \\\n && apt-get update \\\n && apt-get install git -y\n#  Configure ca-certificates for java\nRUN /var/lib/dpkg/info/ca-certificates-java.postinst configure\n#  Define working directory.\nWORKDIR /data\n#  Install Python and package mgmt tools.\nRUN apt-get update \\\n && apt-get install python python-dev python-distribute python-pip libmysqlclient-dev python3-pip -y -q\n#  Install dependencies needed for Ansible 2.x\nRUN apt-get update \\\n && apt-get install libffi-dev libssl-dev -y\n#  Install sudo to execute commands with root privileges\nRUN apt-get install sudo -y\n#  Install packages needed for Docker installation\nRUN apt-get update \\\n && apt-get install apt-transport-https gnupg-agent -y\n#  Add Docker's GPG key and repository\nRUN curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - \\\n && add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu $( lsb_release -cs ;) stable\"\n#  Install Docker - for Docker container building by a go-agent.\nRUN apt-get update \\\n && apt-get install docker-ce -y\n#  Add the go user to the docker group to allow the go user to run docker commands.\n#  See: https://docs.docker.com/engine/installation/linux/ubuntulinux/\nRUN usermod -aG docker go\n#  Assign the go user root privlidges\nRUN printf \"\\ngo ALL=(ALL:ALL) NOPASSWD: /usr/bin/pip, /usr/local/bin/pip\\n\" >> /etc/sudoers\nRUN printf \"\\ngo ALL=(ALL:ALL) NOPASSWD: /usr/bin/pip3, /usr/local/bin/pip3\\n\" >> /etc/sudoers\n#  Upgrade pip and setup tools. Needed for Ansible 2.x\nRUN pip3 install --upgrade pip==9.0.3 \\\n && pip2 install --upgrade pip==9.0.3 \\\n && hash -r \\\n && pip install setuptools==39.0.1 --upgrade \\\n && pip3 install --upgrade setuptools==39.0.1\n#  Compile python 3.6 for Zappa, as zappa requires python 2.7 or 3.6.\n#  There is no bionic GOCD official image published to base off of, and there is no official 3.6 python package for ubuntu 14.04 or 16.04\n#  This will only be on your path as 'python3.6' it will not change the current 'python3' on your path to python 3.6\n#  This isnt a separate agent because deploys of this are likely quite rare.\n#  If we update the GOCD agent to use ubuntu > 14 we can just use the python3\n#  that is already installed for zappa deployments.\nRUN apt-get update \\\n && apt-get install zlib1g-dev wget lsb-core -qy \\\n && cd /opt \\\n && wget https://www.python.org/ftp/python/3.6.7/Python-3.6.7.tgz \\\n && tar -xvf Python-3.6.7.tgz \\\n && cd /opt/Python-3.6.7 \\\n && ./configure --prefix=/usr \\\n && cd /opt/Python-3.6.7 \\\n && make \\\n && make commoninstall maninstall \\\n && rm -rf /opt/Python-3.6.7\n#  Install AWS command-line interface - for AWS operations in a go-agent task.\nRUN pip install 'awscli>=1.11.58'\n#  !!!!NOTICE!!!! ---- Runner of this pipeline take heed!! You must replace go_github_key.pem with the REAL key material\n#  that can checkout private github repositories used as pipeline materials. The key material here is faked and is only\n#  used to pass CI!\n#  setup the github identity\nADD docker/build/go-agent/files/go_github_key.pem /home/go/.ssh/id_rsa\nRUN chmod 600 /home/go/.ssh/id_rsa \\\n && chown go:go /home/go/.ssh/id_rsa\n#  setup the known_hosts\nRUN touch /home/go/.ssh/known_hosts \\\n && chmod 600 /home/go/.ssh/known_hosts \\\n && chown go:go /home/go/.ssh/known_hosts \\\n && ssh-keyscan -t rsa,dsa github.com > /home/go/.ssh/known_hosts\n","injectedSmells":[],"originalDockerfileHash":"c9f360cef0088d6949a26fd3bd3651a3","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   To run, use the command docker build . -f docker/build/go-agent/Dockerfile --tag edx-ops/go-agent:latest\n#   https://hub.docker.com/r/gocd/gocd-agent-ubuntu-16.04/\nFROM gocd/gocd-agent-ubuntu-16.04:v17.10.0\nLABEL version=\"0.02\" \\\n      description=\"This custom go-agent docker file installs additional requirements for the edx pipeline\"\n#   Set locale to UTF-8 which is not the default for go-agent Docker container\nRUN apt-get update \\\n && apt-get install locales -y \\\n && locale-gen en_US.UTF-8\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US:en\"\nENV LC_ALL=\"en_US.UTF-8\"\n#   starting with 16.04 apt-get-repository is not installed in the base image, lets install it so we are ready\n#   http://lifeonubuntu.com/ubuntu-missing-add-apt-repository-command/\nRUN apt-get update \\\n && apt-get install software-properties-common python-software-properties -y -q\n#   Install a modern git client\nRUN add-apt-repository -y ppa:git-core/ppa \\\n && apt-get update \\\n && apt-get install git -y\n#   Configure ca-certificates for java\nRUN /var/lib/dpkg/info/ca-certificates-java.postinst configure\n#   Define working directory.\nWORKDIR /data\n#   Install Python and package mgmt tools.\nRUN apt-get update \\\n && apt-get install python python-dev python-distribute python-pip libmysqlclient-dev python3-pip -y -q\n#   Install dependencies needed for Ansible 2.x\nRUN apt-get update \\\n && apt-get install libffi-dev libssl-dev -y\n#   Install sudo to execute commands with root privileges\nRUN apt-get install sudo -y\n#   Install packages needed for Docker installation\nRUN apt-get update \\\n && apt-get install apt-transport-https gnupg-agent -y\n#   Add Docker's GPG key and repository\nRUN curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - \\\n && add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu $( lsb_release -cs ;) stable\"\n#   Install Docker - for Docker container building by a go-agent.\nRUN apt-get update \\\n && apt-get install docker-ce -y\n#   Add the go user to the docker group to allow the go user to run docker commands.\n#   See: https://docs.docker.com/engine/installation/linux/ubuntulinux/\nRUN usermod -aG docker go\n#   Assign the go user root privlidges\nRUN printf \"\\ngo ALL=(ALL:ALL) NOPASSWD: /usr/bin/pip, /usr/local/bin/pip\\n\" >> /etc/sudoers\nRUN printf \"\\ngo ALL=(ALL:ALL) NOPASSWD: /usr/bin/pip3, /usr/local/bin/pip3\\n\" >> /etc/sudoers\n#   Upgrade pip and setup tools. Needed for Ansible 2.x\nRUN pip3 install --upgrade pip==9.0.3 \\\n && pip2 install --upgrade pip==9.0.3 \\\n && hash -r \\\n && pip install setuptools==39.0.1 --upgrade \\\n && pip3 install --upgrade setuptools==39.0.1\n#   Compile python 3.6 for Zappa, as zappa requires python 2.7 or 3.6.\n#   There is no bionic GOCD official image published to base off of, and there is no official 3.6 python package for ubuntu 14.04 or 16.04\n#   This will only be on your path as 'python3.6' it will not change the current 'python3' on your path to python 3.6\n#   This isnt a separate agent because deploys of this are likely quite rare.\n#   If we update the GOCD agent to use ubuntu > 14 we can just use the python3\n#   that is already installed for zappa deployments.\nRUN apt-get update \\\n && apt-get install zlib1g-dev wget lsb-core -qy \\\n && cd /opt \\\n && wget https://www.python.org/ftp/python/3.6.7/Python-3.6.7.tgz \\\n && tar -xvf Python-3.6.7.tgz \\\n && cd /opt/Python-3.6.7 \\\n && ./configure --prefix=/usr \\\n && cd /opt/Python-3.6.7 \\\n && make \\\n && make commoninstall maninstall \\\n && rm -rf /opt/Python-3.6.7\n#   Install AWS command-line interface - for AWS operations in a go-agent task.\nRUN pip install 'awscli>=1.11.58'\n#   !!!!NOTICE!!!! ---- Runner of this pipeline take heed!! You must replace go_github_key.pem with the REAL key material\n#   that can checkout private github repositories used as pipeline materials. The key material here is faked and is only\n#   used to pass CI!\n#   setup the github identity\nADD docker/build/go-agent/files/go_github_key.pem /home/go/.ssh/id_rsa\nRUN chmod 600 /home/go/.ssh/id_rsa \\\n && chown go:go /home/go/.ssh/id_rsa\n#   setup the known_hosts\nRUN touch /home/go/.ssh/known_hosts \\\n && chmod 600 /home/go/.ssh/known_hosts \\\n && chown go:go /home/go/.ssh/known_hosts \\\n && ssh-keyscan -t rsa,dsa github.com > /home/go/.ssh/known_hosts\n","originalDockerfileUglifiedHash":"c739af26342eacdef2a58959c4285d4b","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/1d7c1c0bcd857a5f58cc53c793484bfc7655c23b.dockerfile"}