{"seed":3542845999,"processedDockerfileHash":"a9415b29ab5043726a7f2931a0dc1ea9","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"#  From debian:stretch-slim\n#  From debian:stretch\nFROM ubuntu:18.04\nMAINTAINER Lanka Software Foundation <support@opensource.lk> \nARG DEBIAN_FRONTEND=noninteractive\nENV TELEGRAF_VERSION=\"1.8.1-1\"\nRUN : \\\n && apt-get -y purge exim4*\nRUN apt-get -y upgrade\nRUN (apt-get update ;apt-get install --no-install-recommends apt-utils=1.6.14 -y )\n#   installing netstat command\nRUN (apt-get update ;apt-get install --no-install-recommends net-tools=1.60+git20161116.90da8a0-1ubuntu1 -y )\n#   installing ping command\nRUN (apt-get update ;apt-get install --no-install-recommends iputils-ping=3:20161105-1ubuntu3 -y )\n#   install mail until for testing functions\nRUN (apt-get update ;apt-get install --no-install-recommends mailutils=1:3.4-1 -y )\n#   installing lsof command\nRUN (apt-get update ;apt-get install --no-install-recommends lsof=4.89+dfsg-0.1 -y )\nRUN (apt-get update ;apt-get install --no-install-recommends telnet=0.17-41 -y )\nRUN (apt-get update ;apt-get install --no-install-recommends nano=2.9.3-2 -y )\nRUN (apt-get update ;apt-get install --no-install-recommends letsencrypt=0.27.0-1~ubuntu18.04.2 openssl=1.1.1-1ubuntu2.1~18.04.21 -y )\n#  postfix-mysql was used to connect with a mysql datbase\n#  RUN apt-get -y install postfix postfix-mysql postfix-pcre libsasl2-modules\n#  postfix-ldap required to connect with ldap services\nRUN (apt-get update ;apt-get install --no-install-recommends postfix=3.3.0-1ubuntu0.4 postfix-ldap=3.3.0-1ubuntu0.4 postfix-pcre=3.3.0-1ubuntu0.4 postfix-policyd-spf-python=2.0.2-1 libsasl2-modules=2.1.27~101-g0780600+dfsg-3ubuntu2.4 -y )\nRUN (apt-get update ;apt-get install --no-install-recommends rsyslog=8.32.0-1ubuntu4.2 fetchmail=6.3.26-3ubuntu0.1~18.04.1 libdbi-perl=1.640-1ubuntu0.3 libdbd-pg-perl=3.7.0-1 libdbd-mysql-perl=4.046-1 liblockfile-simple-perl=0.208-1 -y )\n#  RUN apt-get -y install dovecot-core dovecot-imapd dovecot-pop3d dovecot-lmtpd dovecot-mysql dovecot-sieve dnsutils\n#   changing for modifications\n#  RUN apt-get -y install dovecot-core dovecot-imapd dovecot-pop3d dovecot-lmtpd dovecot-mysql dovecot-sieve dnsutils dovecot-managesieved\nRUN (apt-get update ;apt-get install --no-install-recommends dovecot-core=1:2.2.33.2-1ubuntu4.8 dovecot-imapd=1:2.2.33.2-1ubuntu4.8 dovecot-pop3d=1:2.2.33.2-1ubuntu4.8 dovecot-lmtpd=1:2.2.33.2-1ubuntu4.8 dovecot-mysql=1:2.2.33.2-1ubuntu4.8 dovecot-ldap=1:2.2.33.2-1ubuntu4.8 dnsutils=1:9.11.3+dfsg-1ubuntu1.18 -y )\n#  RUN apt-get install -y mail-stack-delivery // this was used instead of dovecto one by one installation\nRUN (apt-get update ;apt-get install --no-install-recommends dovecot-sieve=1:2.2.33.2-1ubuntu4.8 dovecot-managesieved=1:2.2.33.2-1ubuntu4.8 -y )\n#   installing ldap utils for testing perposes\nRUN (apt-get update ;apt-get install --no-install-recommends ldap-utils=2.4.45+dfsg-1ubuntu1.11 curl=7.58.0-2ubuntu3.24 -y )\n#  RUN apt-get -y install gnupg python-gpgme dovecot-managesieved sudo\n#   Following changed introduced to above installation due to python-gpgme not installed in 18.04 ubuntu \n#  RUN apt-get -y install gnupg dovecot-managesieved sudo\nRUN (apt-get update ;apt-get install --no-install-recommends gnupg=2.2.4-1ubuntu1.6 software-properties-common=0.96.24.32.20 -y )\n#   Above two lines used instead of line with python-gpgme\nRUN adduser --system --no-create-home --group --home /etc/zeyple --disabled-login zeyple\nRUN mkdir -p /etc/zeyple/keys \\\n && chmod 700 /etc/zeyple/keys \\\n && chown zeyple: /etc/zeyple/keys\n#  ADD https://raw.github.com/infertux/zeyple/master/zeyple/zeyple.py /usr/local/bin/zeyple.py\nCOPY ./configs/zeyple/zeyple.py /usr/local/bin/zeyple.py\nRUN chmod 744 /usr/local/bin/zeyple.py \\\n && chown zeyple: /usr/local/bin/zeyple.py\nRUN which wget &> /dev/null || (apt-get update ;apt-get install --no-install-recommends wget=1.20.3 ) ; wget --no-verbose --output-document /etc/zeyple.conf https://raw.github.com/infertux/zeyple/master/zeyple/zeyple.conf.example\n#  ADD ./emailserver/config/zeyple/zeyple.conf.example /etc/zeyple.conf\nRUN touch /var/log/zeyple.log \\\n && chown zeyple: /var/log/zeyple.log\nRUN chown -R zeyple /etc/zeyple /usr/local/bin/zeyple.py\n#   COPY Changing dovecot congiguration files permission\nCOPY ./configs/Dovecot /etc/dovecot/\n#  RUN chgrp dovecot /etc/dovecot/dovecot-sql.conf.ext\n#  RUN chmod o= /etc/dovecot/dovecot-sql.conf.ext\n#   changes accoring to url : https://www.linode.com/docs/email/postfix/email-with-postfix-dovecot-and-mariadb-on-centos-7/\nCOPY ./configs/Postfix /etc/postfix/\n#  RUN chmod o= /etc/postfix/mariadb-sql/mysql-virtual_*.cf\n#  RUN chgrp postfix /etc/postfix/mariadb-sql/mysql-virtual_*.cf\n#   Changing sql configuration files permissions \n#  RUN chmod o= /etc/postfix/sql/mysql_virtual_*.cf\n#  RUN chgrp postfix /etc/postfix/sql/mysql_virtual_*.cf\n#   Changing ldap configuration files permissions \nRUN chmod o= /etc/postfix/ldap/*.cf\nRUN chgrp postfix /etc/postfix/ldap/*.cf\n#   Adding sieve file to /var/mail\nCOPY ./configs/sieve /var/mail/sieve\nRUN groupadd -g 5000 vmail \\\n && useradd -g vmail -u 5000 vmail -d /var/mail\nRUN chown -R vmail:vmail /var/mail\nRUN chown -R postfix /etc/postfix\nRUN chmod -R o-rwx /etc/postfix\nRUN chmod -R 755 /etc/postfix\nRUN chown -R vmail:dovecot /etc/dovecot\nRUN chmod -R o-rwx /etc/dovecot\nCOPY ./configs/Rspamd/rspamd.sh /\nRUN ./rspamd.sh // Error : /bin/sh: 1: ./rspamd.sh: Permission denied , bellow line introduced\nRUN chmod +x ./rspamd.sh\nRUN ./rspamd.sh 2> /dev/null || true\nCOPY ./configs/Rspamd /etc/rspamd/\n#  RUN mkdir /var/lib/rspamd/dkim/\t//error :/rspamd/...dkim/': No such file or directory\nRUN mkdir -p /var/lib/rspamd/dkim\nRUN rspamadm dkim_keygen -b 1024 -s 2018 -d $DOMAIN -k /var/lib/rspamd/dkim/2018.key > /var/lib/rspamd/dkim/2018.txt\nRUN chown -R _rspamd:_rspamd /var/lib/rspamd/dkim\nRUN chmod 440 /var/lib/rspamd/dkim/*\nRUN cp -R /etc/rspamd/local.d/dkim_signing.conf /etc/rspamd/local.d/arc.conf\nCOPY ./configs/sieve /sieve\nCOPY ./configs/init_sys.sh /bin/\n#  COPY ./configs/.env /bin/\nRUN chmod +x /bin/init_sys.sh\n#  RUN chmod 755 /bin/.env\n#   Adding pod start commands to the email image\nCOPY ./configs/pod_start.sh /bin/pod_start.sh\nRUN chmod +x /bin/pod_start.sh\n#   install filebeat to send alarms to ELK stack in copper hub\nRUN curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.7.1-linux-x86_64.tar.gz\nRUN tar xzvf filebeat-6.7.1-linux-x86_64.tar.gz\nRUN cd filebeat-6.7.1-linux-x86_64\n#   coppy local filebeat configuration file\nCOPY ./configs/filebeat/filebeat.yml /filebeat-6.7.1-linux-x86_64/filebeat.yml\n#  RUN chown root filebeat.yml\n#  RUN ./filebeat -e\n#   postfixlog analyser \nCOPY ./configs/logAnalyze/pflogsumm /usr/local/bin/pflogsumm\nRUN chown bin:bin /usr/local/bin/pflogsumm\nRUN chmod 755 /usr/local/bin/pflogsumm\n#   copying virus sh file\n#  RUN mkdir /agent\n#  RUN chmod 755 /agent\n#  COPY ./emailserver/configs/clamAV/init_refresh.sh /agent/\n#  RUN chmod +x /agent/init_refresh.sh\n#   Antivirus with amavisd-new and clamAV\nRUN (apt-get update ;apt-get install --no-install-recommends clamav-daemon=0.103.8+dfsg-0ubuntu0.18.04.1 clamav=0.103.8+dfsg-0ubuntu0.18.04.1 -y )\nCOPY ./configs/clamAV/antivirus.conf /etc/rspamd/override.d/\n#   Install Telegraf\nRUN wget https://dl.influxdata.com/telegraf/releases/telegraf_${TELEGRAF_VERSION}_amd64.deb \\\n && dpkg -i telegraf_${TELEGRAF_VERSION}_amd64.deb \\\n && rm telegraf_${TELEGRAF_VERSION}_amd64.deb\n#   Configure Telegraf\nCOPY ./configs/telegraf/telegraf.conf /etc/telegraf/telegraf.conf\nCOPY ./configs/telegraf/init.sh /etc/init.d/telegraf\n#   Cleanup\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\nCOPY ./configs/telegraf/entrypoint.sh entrypoint.sh\nRUN chmod 755 entrypoint.sh\n#  RUN init_sys.sh\nENTRYPOINT [\"init_sys.sh\"]\n#  ENTRYPOINT [\"entrypoint.sh\"]\n#  CMD [\"telegraf\"]\n#  CMD service postfix start\n#  ENTRYPOINT [\"tail\", \"-f\", \"/dev/null\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# From debian:stretch-slim\n# From debian:stretch\nFROM ubuntu:18.04\nMAINTAINER Lanka Software Foundation <support@opensource.lk> \nARG DEBIAN_FRONTEND=noninteractive\nENV TELEGRAF_VERSION=\"1.8.1-1\"\nRUN apt-get update --fix-missing \\\n && apt-get -y purge exim4*\nRUN apt-get -y upgrade\nRUN apt-get install apt-utils -y\n#  installing netstat command\nRUN apt-get install net-tools -y\n#  installing ping command\nRUN apt-get install iputils-ping -y\n#  install mail until for testing functions\nRUN apt-get install mailutils -y\n#  installing lsof command\nRUN apt-get install lsof -y\nRUN apt-get install telnet -y\nRUN apt-get install nano -y\nRUN apt-get install letsencrypt openssl -y\n# postfix-mysql was used to connect with a mysql datbase\n# RUN apt-get -y install postfix postfix-mysql postfix-pcre libsasl2-modules\n# postfix-ldap required to connect with ldap services\nRUN apt-get install postfix postfix-ldap postfix-pcre postfix-policyd-spf-python libsasl2-modules -y\nRUN apt-get install rsyslog fetchmail libdbi-perl libdbd-pg-perl libdbd-mysql-perl liblockfile-simple-perl -y\n# RUN apt-get -y install dovecot-core dovecot-imapd dovecot-pop3d dovecot-lmtpd dovecot-mysql dovecot-sieve dnsutils\n#  changing for modifications\n# RUN apt-get -y install dovecot-core dovecot-imapd dovecot-pop3d dovecot-lmtpd dovecot-mysql dovecot-sieve dnsutils dovecot-managesieved\nRUN apt-get install dovecot-core dovecot-imapd dovecot-pop3d dovecot-lmtpd dovecot-mysql dovecot-ldap dnsutils -y\n# RUN apt-get install -y mail-stack-delivery // this was used instead of dovecto one by one installation\nRUN apt-get install dovecot-sieve dovecot-managesieved -y\n#  installing ldap utils for testing perposes\nRUN apt-get install ldap-utils curl -y\n# RUN apt-get -y install gnupg python-gpgme dovecot-managesieved sudo\n#  Following changed introduced to above installation due to python-gpgme not installed in 18.04 ubuntu \n# RUN apt-get -y install gnupg dovecot-managesieved sudo\nRUN apt-get install gnupg software-properties-common -y\n#  Above two lines used instead of line with python-gpgme\nRUN adduser --system --no-create-home --group --home /etc/zeyple --disabled-login zeyple\nRUN mkdir -p /etc/zeyple/keys \\\n && chmod 700 /etc/zeyple/keys \\\n && chown zeyple: /etc/zeyple/keys\n# ADD https://raw.github.com/infertux/zeyple/master/zeyple/zeyple.py /usr/local/bin/zeyple.py\nADD ./configs/zeyple/zeyple.py /usr/local/bin/zeyple.py\nRUN chmod 744 /usr/local/bin/zeyple.py \\\n && chown zeyple: /usr/local/bin/zeyple.py\nADD https://raw.github.com/infertux/zeyple/master/zeyple/zeyple.conf.example /etc/zeyple.conf\n# ADD ./emailserver/config/zeyple/zeyple.conf.example /etc/zeyple.conf\nRUN touch /var/log/zeyple.log \\\n && chown zeyple: /var/log/zeyple.log\nRUN chown -R zeyple /etc/zeyple /usr/local/bin/zeyple.py\n#  COPY Changing dovecot congiguration files permission\nCOPY ./configs/Dovecot /etc/dovecot/\n# RUN chgrp dovecot /etc/dovecot/dovecot-sql.conf.ext\n# RUN chmod o= /etc/dovecot/dovecot-sql.conf.ext\n#  changes accoring to url : https://www.linode.com/docs/email/postfix/email-with-postfix-dovecot-and-mariadb-on-centos-7/\nCOPY ./configs/Postfix /etc/postfix/\n# RUN chmod o= /etc/postfix/mariadb-sql/mysql-virtual_*.cf\n# RUN chgrp postfix /etc/postfix/mariadb-sql/mysql-virtual_*.cf\n#  Changing sql configuration files permissions \n# RUN chmod o= /etc/postfix/sql/mysql_virtual_*.cf\n# RUN chgrp postfix /etc/postfix/sql/mysql_virtual_*.cf\n#  Changing ldap configuration files permissions \nRUN chmod o= /etc/postfix/ldap/*.cf\nRUN chgrp postfix /etc/postfix/ldap/*.cf\n#  Adding sieve file to /var/mail\nCOPY ./configs/sieve /var/mail/sieve\nRUN groupadd -g 5000 vmail \\\n && useradd -g vmail -u 5000 vmail -d /var/mail\nRUN chown -R vmail:vmail /var/mail\nRUN chown -R postfix /etc/postfix\nRUN chmod -R o-rwx /etc/postfix\nRUN chmod -R 755 /etc/postfix\nRUN chown -R vmail:dovecot /etc/dovecot\nRUN chmod -R o-rwx /etc/dovecot\nCOPY ./configs/Rspamd/rspamd.sh /\nRUN ./rspamd.sh // Error : /bin/sh: 1: ./rspamd.sh: Permission denied , bellow line introduced\nRUN chmod +x ./rspamd.sh\nRUN ./rspamd.sh 2> /dev/null || true\nCOPY ./configs/Rspamd /etc/rspamd/\n# RUN mkdir /var/lib/rspamd/dkim/\t//error :/rspamd/...dkim/': No such file or directory\nRUN mkdir -p /var/lib/rspamd/dkim\nRUN rspamadm dkim_keygen -b 1024 -s 2018 -d $DOMAIN -k /var/lib/rspamd/dkim/2018.key > /var/lib/rspamd/dkim/2018.txt\nRUN chown -R _rspamd:_rspamd /var/lib/rspamd/dkim\nRUN chmod 440 /var/lib/rspamd/dkim/*\nRUN cp -R /etc/rspamd/local.d/dkim_signing.conf /etc/rspamd/local.d/arc.conf\nCOPY ./configs/sieve /sieve\nCOPY ./configs/init_sys.sh /bin/\n# COPY ./configs/.env /bin/\nRUN chmod +x /bin/init_sys.sh\n# RUN chmod 755 /bin/.env\n#  Adding pod start commands to the email image\nADD ./configs/pod_start.sh /bin/pod_start.sh\nRUN chmod +x /bin/pod_start.sh\n#  install filebeat to send alarms to ELK stack in copper hub\nRUN curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.7.1-linux-x86_64.tar.gz\nRUN tar xzvf filebeat-6.7.1-linux-x86_64.tar.gz\nRUN cd filebeat-6.7.1-linux-x86_64\n#  coppy local filebeat configuration file\nADD ./configs/filebeat/filebeat.yml /filebeat-6.7.1-linux-x86_64/filebeat.yml\n# RUN chown root filebeat.yml\n# RUN ./filebeat -e\n#  postfixlog analyser \nCOPY ./configs/logAnalyze/pflogsumm /usr/local/bin/pflogsumm\nRUN chown bin:bin /usr/local/bin/pflogsumm\nRUN chmod 755 /usr/local/bin/pflogsumm\n#  copying virus sh file\n# RUN mkdir /agent\n# RUN chmod 755 /agent\n# COPY ./emailserver/configs/clamAV/init_refresh.sh /agent/\n# RUN chmod +x /agent/init_refresh.sh\n#  Antivirus with amavisd-new and clamAV\nRUN apt-get -y install clamav-daemon clamav\nCOPY ./configs/clamAV/antivirus.conf /etc/rspamd/override.d/\n#  Install Telegraf\nRUN wget https://dl.influxdata.com/telegraf/releases/telegraf_${TELEGRAF_VERSION}_amd64.deb \\\n && dpkg -i telegraf_${TELEGRAF_VERSION}_amd64.deb \\\n && rm telegraf_${TELEGRAF_VERSION}_amd64.deb\n#  Configure Telegraf\nCOPY ./configs/telegraf/telegraf.conf /etc/telegraf/telegraf.conf\nCOPY ./configs/telegraf/init.sh /etc/init.d/telegraf\n#  Cleanup\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\nCOPY ./configs/telegraf/entrypoint.sh entrypoint.sh\nRUN chmod 755 entrypoint.sh\n# RUN init_sys.sh\nENTRYPOINT [\"init_sys.sh\"]\n# ENTRYPOINT [\"entrypoint.sh\"]\n# CMD [\"telegraf\"]\n# CMD service postfix start\n# ENTRYPOINT [\"tail\", \"-f\", \"/dev/null\"]\n","injectedSmells":[],"originalDockerfileHash":"41fa1c9c1b8e2a1c7c1e758ed32b8a2f","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  From debian:stretch-slim\n#  From debian:stretch\nFROM ubuntu:18.04\nMAINTAINER Lanka Software Foundation <support@opensource.lk> \nARG DEBIAN_FRONTEND=noninteractive\nENV TELEGRAF_VERSION=\"1.8.1-1\"\nRUN apt-get update --fix-missing \\\n && apt-get -y purge exim4*\nRUN apt-get -y upgrade\nRUN apt-get install apt-utils -y\n#   installing netstat command\nRUN apt-get install net-tools -y\n#   installing ping command\nRUN apt-get install iputils-ping -y\n#   install mail until for testing functions\nRUN apt-get install mailutils -y\n#   installing lsof command\nRUN apt-get install lsof -y\nRUN apt-get install telnet -y\nRUN apt-get install nano -y\nRUN apt-get install letsencrypt openssl -y\n#  postfix-mysql was used to connect with a mysql datbase\n#  RUN apt-get -y install postfix postfix-mysql postfix-pcre libsasl2-modules\n#  postfix-ldap required to connect with ldap services\nRUN apt-get install postfix postfix-ldap postfix-pcre postfix-policyd-spf-python libsasl2-modules -y\nRUN apt-get install rsyslog fetchmail libdbi-perl libdbd-pg-perl libdbd-mysql-perl liblockfile-simple-perl -y\n#  RUN apt-get -y install dovecot-core dovecot-imapd dovecot-pop3d dovecot-lmtpd dovecot-mysql dovecot-sieve dnsutils\n#   changing for modifications\n#  RUN apt-get -y install dovecot-core dovecot-imapd dovecot-pop3d dovecot-lmtpd dovecot-mysql dovecot-sieve dnsutils dovecot-managesieved\nRUN apt-get install dovecot-core dovecot-imapd dovecot-pop3d dovecot-lmtpd dovecot-mysql dovecot-ldap dnsutils -y\n#  RUN apt-get install -y mail-stack-delivery // this was used instead of dovecto one by one installation\nRUN apt-get install dovecot-sieve dovecot-managesieved -y\n#   installing ldap utils for testing perposes\nRUN apt-get install ldap-utils curl -y\n#  RUN apt-get -y install gnupg python-gpgme dovecot-managesieved sudo\n#   Following changed introduced to above installation due to python-gpgme not installed in 18.04 ubuntu \n#  RUN apt-get -y install gnupg dovecot-managesieved sudo\nRUN apt-get install gnupg software-properties-common -y\n#   Above two lines used instead of line with python-gpgme\nRUN adduser --system --no-create-home --group --home /etc/zeyple --disabled-login zeyple\nRUN mkdir -p /etc/zeyple/keys \\\n && chmod 700 /etc/zeyple/keys \\\n && chown zeyple: /etc/zeyple/keys\n#  ADD https://raw.github.com/infertux/zeyple/master/zeyple/zeyple.py /usr/local/bin/zeyple.py\nADD ./configs/zeyple/zeyple.py /usr/local/bin/zeyple.py\nRUN chmod 744 /usr/local/bin/zeyple.py \\\n && chown zeyple: /usr/local/bin/zeyple.py\nADD https://raw.github.com/infertux/zeyple/master/zeyple/zeyple.conf.example /etc/zeyple.conf\n#  ADD ./emailserver/config/zeyple/zeyple.conf.example /etc/zeyple.conf\nRUN touch /var/log/zeyple.log \\\n && chown zeyple: /var/log/zeyple.log\nRUN chown -R zeyple /etc/zeyple /usr/local/bin/zeyple.py\n#   COPY Changing dovecot congiguration files permission\nCOPY ./configs/Dovecot /etc/dovecot/\n#  RUN chgrp dovecot /etc/dovecot/dovecot-sql.conf.ext\n#  RUN chmod o= /etc/dovecot/dovecot-sql.conf.ext\n#   changes accoring to url : https://www.linode.com/docs/email/postfix/email-with-postfix-dovecot-and-mariadb-on-centos-7/\nCOPY ./configs/Postfix /etc/postfix/\n#  RUN chmod o= /etc/postfix/mariadb-sql/mysql-virtual_*.cf\n#  RUN chgrp postfix /etc/postfix/mariadb-sql/mysql-virtual_*.cf\n#   Changing sql configuration files permissions \n#  RUN chmod o= /etc/postfix/sql/mysql_virtual_*.cf\n#  RUN chgrp postfix /etc/postfix/sql/mysql_virtual_*.cf\n#   Changing ldap configuration files permissions \nRUN chmod o= /etc/postfix/ldap/*.cf\nRUN chgrp postfix /etc/postfix/ldap/*.cf\n#   Adding sieve file to /var/mail\nCOPY ./configs/sieve /var/mail/sieve\nRUN groupadd -g 5000 vmail \\\n && useradd -g vmail -u 5000 vmail -d /var/mail\nRUN chown -R vmail:vmail /var/mail\nRUN chown -R postfix /etc/postfix\nRUN chmod -R o-rwx /etc/postfix\nRUN chmod -R 755 /etc/postfix\nRUN chown -R vmail:dovecot /etc/dovecot\nRUN chmod -R o-rwx /etc/dovecot\nCOPY ./configs/Rspamd/rspamd.sh /\nRUN ./rspamd.sh // Error : /bin/sh: 1: ./rspamd.sh: Permission denied , bellow line introduced\nRUN chmod +x ./rspamd.sh\nRUN ./rspamd.sh 2> /dev/null || true\nCOPY ./configs/Rspamd /etc/rspamd/\n#  RUN mkdir /var/lib/rspamd/dkim/\t//error :/rspamd/...dkim/': No such file or directory\nRUN mkdir -p /var/lib/rspamd/dkim\nRUN rspamadm dkim_keygen -b 1024 -s 2018 -d $DOMAIN -k /var/lib/rspamd/dkim/2018.key > /var/lib/rspamd/dkim/2018.txt\nRUN chown -R _rspamd:_rspamd /var/lib/rspamd/dkim\nRUN chmod 440 /var/lib/rspamd/dkim/*\nRUN cp -R /etc/rspamd/local.d/dkim_signing.conf /etc/rspamd/local.d/arc.conf\nCOPY ./configs/sieve /sieve\nCOPY ./configs/init_sys.sh /bin/\n#  COPY ./configs/.env /bin/\nRUN chmod +x /bin/init_sys.sh\n#  RUN chmod 755 /bin/.env\n#   Adding pod start commands to the email image\nADD ./configs/pod_start.sh /bin/pod_start.sh\nRUN chmod +x /bin/pod_start.sh\n#   install filebeat to send alarms to ELK stack in copper hub\nRUN curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.7.1-linux-x86_64.tar.gz\nRUN tar xzvf filebeat-6.7.1-linux-x86_64.tar.gz\nRUN cd filebeat-6.7.1-linux-x86_64\n#   coppy local filebeat configuration file\nADD ./configs/filebeat/filebeat.yml /filebeat-6.7.1-linux-x86_64/filebeat.yml\n#  RUN chown root filebeat.yml\n#  RUN ./filebeat -e\n#   postfixlog analyser \nCOPY ./configs/logAnalyze/pflogsumm /usr/local/bin/pflogsumm\nRUN chown bin:bin /usr/local/bin/pflogsumm\nRUN chmod 755 /usr/local/bin/pflogsumm\n#   copying virus sh file\n#  RUN mkdir /agent\n#  RUN chmod 755 /agent\n#  COPY ./emailserver/configs/clamAV/init_refresh.sh /agent/\n#  RUN chmod +x /agent/init_refresh.sh\n#   Antivirus with amavisd-new and clamAV\nRUN apt-get install clamav-daemon clamav -y\nCOPY ./configs/clamAV/antivirus.conf /etc/rspamd/override.d/\n#   Install Telegraf\nRUN wget https://dl.influxdata.com/telegraf/releases/telegraf_${TELEGRAF_VERSION}_amd64.deb \\\n && dpkg -i telegraf_${TELEGRAF_VERSION}_amd64.deb \\\n && rm telegraf_${TELEGRAF_VERSION}_amd64.deb\n#   Configure Telegraf\nCOPY ./configs/telegraf/telegraf.conf /etc/telegraf/telegraf.conf\nCOPY ./configs/telegraf/init.sh /etc/init.d/telegraf\n#   Cleanup\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\nCOPY ./configs/telegraf/entrypoint.sh entrypoint.sh\nRUN chmod 755 entrypoint.sh\n#  RUN init_sys.sh\nENTRYPOINT [\"init_sys.sh\"]\n#  ENTRYPOINT [\"entrypoint.sh\"]\n#  CMD [\"telegraf\"]\n#  CMD service postfix start\n#  ENTRYPOINT [\"tail\", \"-f\", \"/dev/null\"]\n","originalDockerfileUglifiedHash":"488bc5433cb65382db9a210045713bed","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/20f2d616c5e9d2911d787ac8337ab4d8dbc2394d.dockerfile"}