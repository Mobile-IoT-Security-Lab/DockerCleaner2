{"seed":3927117588,"processedDockerfileHash":"79c053ee647a7ff6cec2629504743863","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM openjdk:jdk\n#   grab gosu for easy step-down from root\nENV GOSU_VERSION=\"1.7\"\nRUN set -x \\\n && wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;)\" \\\n && wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;).asc\" \\\n && export GNUPGHOME=\"$( mktemp -d ;)\" \\\n && gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu \\\n && rm -r \"$GNUPGHOME\" /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && gosu nobody true\nRUN set -ex ; key='46095ACC8548582C1A2699A9D27D666CD88E42B4' ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; gpg --export \"$key\" > /etc/apt/trusted.gpg.d/elastic.gpg; rm -r \"$GNUPGHOME\" ; apt-key list\n#   https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-repositories.html\n#   https://www.elastic.co/guide/en/elasticsearch/reference/5.0/deb.html\nRUN set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https wget unzip maven -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && echo 'deb https://artifacts.elastic.co/packages/5.x/apt stable main' > /etc/apt/sources.list.d/elasticsearch.list\nENV ELASTICSEARCH_VERSION=\"5.2.2\"\nENV ELASTICSEARCH_DEB_VERSION=\"5.2.2\"\nRUN set -x \\\n && dpkg-divert --rename /usr/lib/sysctl.d/elasticsearch.conf \\\n && apt-get update \\\n && apt-get install --no-install-recommends \"elasticsearch=$ELASTICSEARCH_DEB_VERSION\" -y \\\n && rm -rf /var/lib/apt/lists/*\nENV PATH=\"/usr/share/elasticsearch/bin:$PATH\"\nWORKDIR /usr/share/elasticsearch\nRUN set -ex \\\n && for path in ./data ./logs ./config ./config/scripts; do mkdir -p \"$path\" ;chown -R elasticsearch:elasticsearch \"$path\" ; done\nCOPY settings ./config\nVOLUME /usr/share/elasticsearch/data\nCOPY docker-entrypoint.sh /\n#  RUN apt-get update && \\\n#    apt-get install -y --no-install-recommands wget unzip && \\\n#    wget -c \"https://github.com/medcl/elasticsearch-analysis-ik/archive/master.zip\" && \\\n#    unzip master.zip && \\\n#   Add x-pack plugin\n#   RUN bin/elasticsearch-plugin install x-pack --batch\n#   Add ICU analysis plugin <https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-icu.html>\nRUN bin/elasticsearch-plugin install analysis-icu\n#   Add Chinese analysis plugin <https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-smartcn.html>\nRUN bin/elasticsearch-plugin install analysis-smartcn\n#   Add Japanese (kuromoji) analysis plugin <https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-kuromoji.html>\nRUN bin/elasticsearch-plugin install analysis-kuromoji\n#   Add phonetic analysis plugin <https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-phonetic.html#analysis-phonetic-install>\nRUN bin/elasticsearch-plugin install analysis-phonetic\n#   RUN bin/elasticsearch-plugin install discovery-multicast\nRUN bin/elasticsearch-plugin install analysis-stempel\nRUN bin/elasticsearch-plugin install analysis-ukrainian\nRUN bin/elasticsearch-plugin install discovery-file\nRUN bin/elasticsearch-plugin install ingest-attachment\n#   RUN bin/elasticsearch-plugin install ingest-geoip\nRUN bin/elasticsearch-plugin install ingest-user-agent\nRUN bin/elasticsearch-plugin install mapper-attachments\nRUN bin/elasticsearch-plugin install mapper-size\nRUN bin/elasticsearch-plugin install mapper-murmur3\nRUN bin/elasticsearch-plugin install lang-javascript\nRUN bin/elasticsearch-plugin install lang-python\nRUN bin/elasticsearch-plugin install repository-hdfs\nRUN bin/elasticsearch-plugin install repository-s3\nRUN bin/elasticsearch-plugin install repository-azure\nRUN bin/elasticsearch-plugin install repository-gcs\nRUN bin/elasticsearch-plugin install store-smb\nRUN bin/elasticsearch-plugin install discovery-ec2\nRUN bin/elasticsearch-plugin install discovery-azure-classic\nRUN bin/elasticsearch-plugin install discovery-gce\n#  #####################################\n#   install Chinese ik analyzer\n#   <http://www.cnblogs.com/hunttown/p/5450635.html>\n#  #####################################\n#   COPY analysis-ik /usr/share/elasticsearch/plugins\n#  COPY extend.yml /tmp\nCOPY config /tmp/config\nRUN cd /tmp \\\n && wget -c https://github.com/medcl/elasticsearch-analysis-ik/archive/master.zip \\\n && unzip master.zip\nRUN cd /tmp/elasticsearch-analysis-ik-master \\\n && mvn package\nRUN unzip /tmp/elasticsearch-analysis-ik-master/target/releases/elasticsearch-analysis-ik-5.2.2.zip -d /usr/share/elasticsearch/plugins/ik\n#  RUN echo 'index.analysis.analyzer.ik.type : \"analysis-ik\"' >> /usr/share/elasticsearch/config/elasticsearch.yml\n#  RUN cat /tmp/extend.yml >> /usr/share/elasticsearch/config/elasticsearch.yml\n#   RUN cp /usr/share/elasticsearch/plugins/ik/http*.jar /usr/share/elasticsearch/lib\nRUN cp -rf /tmp/config/* /usr/share/elasticsearch/plugins/ik/config/\n#  ###################################\n#   clean cache and tmp files\n#  ###################################\nRUN apt-get clean \\\n && rm -rf /tmp/* /var/tmp/*\nEXPOSE 9200/tcp 9300/tcp\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nCMD [\"elasticsearch\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM openjdk:jdk\n#  grab gosu for easy step-down from root\nENV GOSU_VERSION=\"1.7\"\nRUN set -x \\\n && wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;)\" \\\n && wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;).asc\" \\\n && export GNUPGHOME=\"$( mktemp -d ;)\" \\\n && gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu \\\n && rm -r \"$GNUPGHOME\" /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && gosu nobody true\nRUN set -ex ; key='46095ACC8548582C1A2699A9D27D666CD88E42B4' ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; gpg --export \"$key\" > /etc/apt/trusted.gpg.d/elastic.gpg; rm -r \"$GNUPGHOME\" ; apt-key list\n#  https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-repositories.html\n#  https://www.elastic.co/guide/en/elasticsearch/reference/5.0/deb.html\nRUN set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https wget unzip maven -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && echo 'deb https://artifacts.elastic.co/packages/5.x/apt stable main' > /etc/apt/sources.list.d/elasticsearch.list\nENV ELASTICSEARCH_VERSION=\"5.2.2\"\nENV ELASTICSEARCH_DEB_VERSION=\"5.2.2\"\nRUN set -x \\\n && dpkg-divert --rename /usr/lib/sysctl.d/elasticsearch.conf \\\n && apt-get update \\\n && apt-get install --no-install-recommends \"elasticsearch=$ELASTICSEARCH_DEB_VERSION\" -y \\\n && rm -rf /var/lib/apt/lists/*\nENV PATH=\"/usr/share/elasticsearch/bin:$PATH\"\nWORKDIR /usr/share/elasticsearch\nRUN set -ex \\\n && for path in ./data ./logs ./config ./config/scripts; do mkdir -p \"$path\" ;chown -R elasticsearch:elasticsearch \"$path\" ; done\nCOPY settings ./config\nVOLUME /usr/share/elasticsearch/data\nCOPY docker-entrypoint.sh /\n# RUN apt-get update && \\\n#   apt-get install -y --no-install-recommands wget unzip && \\\n#   wget -c \"https://github.com/medcl/elasticsearch-analysis-ik/archive/master.zip\" && \\\n#   unzip master.zip && \\\n#  Add x-pack plugin\n#  RUN bin/elasticsearch-plugin install x-pack --batch\n#  Add ICU analysis plugin <https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-icu.html>\nRUN bin/elasticsearch-plugin install analysis-icu\n#  Add Chinese analysis plugin <https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-smartcn.html>\nRUN bin/elasticsearch-plugin install analysis-smartcn\n#  Add Japanese (kuromoji) analysis plugin <https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-kuromoji.html>\nRUN bin/elasticsearch-plugin install analysis-kuromoji\n#  Add phonetic analysis plugin <https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-phonetic.html#analysis-phonetic-install>\nRUN bin/elasticsearch-plugin install analysis-phonetic\n#  RUN bin/elasticsearch-plugin install discovery-multicast\nRUN bin/elasticsearch-plugin install analysis-stempel\nRUN bin/elasticsearch-plugin install analysis-ukrainian\nRUN bin/elasticsearch-plugin install discovery-file\nRUN bin/elasticsearch-plugin install ingest-attachment\n#  RUN bin/elasticsearch-plugin install ingest-geoip\nRUN bin/elasticsearch-plugin install ingest-user-agent\nRUN bin/elasticsearch-plugin install mapper-attachments\nRUN bin/elasticsearch-plugin install mapper-size\nRUN bin/elasticsearch-plugin install mapper-murmur3\nRUN bin/elasticsearch-plugin install lang-javascript\nRUN bin/elasticsearch-plugin install lang-python\nRUN bin/elasticsearch-plugin install repository-hdfs\nRUN bin/elasticsearch-plugin install repository-s3\nRUN bin/elasticsearch-plugin install repository-azure\nRUN bin/elasticsearch-plugin install repository-gcs\nRUN bin/elasticsearch-plugin install store-smb\nRUN bin/elasticsearch-plugin install discovery-ec2\nRUN bin/elasticsearch-plugin install discovery-azure-classic\nRUN bin/elasticsearch-plugin install discovery-gce\n# #####################################\n#  install Chinese ik analyzer\n#  <http://www.cnblogs.com/hunttown/p/5450635.html>\n# #####################################\n#  COPY analysis-ik /usr/share/elasticsearch/plugins\n# COPY extend.yml /tmp\nCOPY config /tmp/config\nRUN cd /tmp \\\n && wget -c https://github.com/medcl/elasticsearch-analysis-ik/archive/master.zip \\\n && unzip master.zip\nRUN cd /tmp/elasticsearch-analysis-ik-master \\\n && mvn package\nRUN unzip /tmp/elasticsearch-analysis-ik-master/target/releases/elasticsearch-analysis-ik-5.2.2.zip -d /usr/share/elasticsearch/plugins/ik\n# RUN echo 'index.analysis.analyzer.ik.type : \"analysis-ik\"' >> /usr/share/elasticsearch/config/elasticsearch.yml\n# RUN cat /tmp/extend.yml >> /usr/share/elasticsearch/config/elasticsearch.yml\n#  RUN cp /usr/share/elasticsearch/plugins/ik/http*.jar /usr/share/elasticsearch/lib\nRUN cp -rf /tmp/config/* /usr/share/elasticsearch/plugins/ik/config/\n# ###################################\n#  clean cache and tmp files\n# ###################################\nRUN apt-get clean \\\n && rm -rf /tmp/* /var/tmp/*\nEXPOSE 9200/tcp 9300/tcp\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nCMD [\"elasticsearch\"]\n","injectedSmells":[],"originalDockerfileHash":"bb44a8bb8ea5b58f87eff138ea130f14","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM openjdk:jdk\n#   grab gosu for easy step-down from root\nENV GOSU_VERSION=\"1.7\"\nRUN set -x \\\n && wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;)\" \\\n && wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;).asc\" \\\n && export GNUPGHOME=\"$( mktemp -d ;)\" \\\n && gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu \\\n && rm -r \"$GNUPGHOME\" /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && gosu nobody true\nRUN set -ex ; key='46095ACC8548582C1A2699A9D27D666CD88E42B4' ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; gpg --export \"$key\" > /etc/apt/trusted.gpg.d/elastic.gpg; rm -r \"$GNUPGHOME\" ; apt-key list\n#   https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-repositories.html\n#   https://www.elastic.co/guide/en/elasticsearch/reference/5.0/deb.html\nRUN set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https wget unzip maven -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && echo 'deb https://artifacts.elastic.co/packages/5.x/apt stable main' > /etc/apt/sources.list.d/elasticsearch.list\nENV ELASTICSEARCH_VERSION=\"5.2.2\"\nENV ELASTICSEARCH_DEB_VERSION=\"5.2.2\"\nRUN set -x \\\n && dpkg-divert --rename /usr/lib/sysctl.d/elasticsearch.conf \\\n && apt-get update \\\n && apt-get install --no-install-recommends \"elasticsearch=$ELASTICSEARCH_DEB_VERSION\" -y \\\n && rm -rf /var/lib/apt/lists/*\nENV PATH=\"/usr/share/elasticsearch/bin:$PATH\"\nWORKDIR /usr/share/elasticsearch\nRUN set -ex \\\n && for path in ./data ./logs ./config ./config/scripts; do mkdir -p \"$path\" ;chown -R elasticsearch:elasticsearch \"$path\" ; done\nCOPY settings ./config\nVOLUME /usr/share/elasticsearch/data\nCOPY docker-entrypoint.sh /\n#  RUN apt-get update && \\\n#    apt-get install -y --no-install-recommands wget unzip && \\\n#    wget -c \"https://github.com/medcl/elasticsearch-analysis-ik/archive/master.zip\" && \\\n#    unzip master.zip && \\\n#   Add x-pack plugin\n#   RUN bin/elasticsearch-plugin install x-pack --batch\n#   Add ICU analysis plugin <https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-icu.html>\nRUN bin/elasticsearch-plugin install analysis-icu\n#   Add Chinese analysis plugin <https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-smartcn.html>\nRUN bin/elasticsearch-plugin install analysis-smartcn\n#   Add Japanese (kuromoji) analysis plugin <https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-kuromoji.html>\nRUN bin/elasticsearch-plugin install analysis-kuromoji\n#   Add phonetic analysis plugin <https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-phonetic.html#analysis-phonetic-install>\nRUN bin/elasticsearch-plugin install analysis-phonetic\n#   RUN bin/elasticsearch-plugin install discovery-multicast\nRUN bin/elasticsearch-plugin install analysis-stempel\nRUN bin/elasticsearch-plugin install analysis-ukrainian\nRUN bin/elasticsearch-plugin install discovery-file\nRUN bin/elasticsearch-plugin install ingest-attachment\n#   RUN bin/elasticsearch-plugin install ingest-geoip\nRUN bin/elasticsearch-plugin install ingest-user-agent\nRUN bin/elasticsearch-plugin install mapper-attachments\nRUN bin/elasticsearch-plugin install mapper-size\nRUN bin/elasticsearch-plugin install mapper-murmur3\nRUN bin/elasticsearch-plugin install lang-javascript\nRUN bin/elasticsearch-plugin install lang-python\nRUN bin/elasticsearch-plugin install repository-hdfs\nRUN bin/elasticsearch-plugin install repository-s3\nRUN bin/elasticsearch-plugin install repository-azure\nRUN bin/elasticsearch-plugin install repository-gcs\nRUN bin/elasticsearch-plugin install store-smb\nRUN bin/elasticsearch-plugin install discovery-ec2\nRUN bin/elasticsearch-plugin install discovery-azure-classic\nRUN bin/elasticsearch-plugin install discovery-gce\n#  #####################################\n#   install Chinese ik analyzer\n#   <http://www.cnblogs.com/hunttown/p/5450635.html>\n#  #####################################\n#   COPY analysis-ik /usr/share/elasticsearch/plugins\n#  COPY extend.yml /tmp\nCOPY config /tmp/config\nRUN cd /tmp \\\n && wget -c https://github.com/medcl/elasticsearch-analysis-ik/archive/master.zip \\\n && unzip master.zip\nRUN cd /tmp/elasticsearch-analysis-ik-master \\\n && mvn package\nRUN unzip /tmp/elasticsearch-analysis-ik-master/target/releases/elasticsearch-analysis-ik-5.2.2.zip -d /usr/share/elasticsearch/plugins/ik\n#  RUN echo 'index.analysis.analyzer.ik.type : \"analysis-ik\"' >> /usr/share/elasticsearch/config/elasticsearch.yml\n#  RUN cat /tmp/extend.yml >> /usr/share/elasticsearch/config/elasticsearch.yml\n#   RUN cp /usr/share/elasticsearch/plugins/ik/http*.jar /usr/share/elasticsearch/lib\nRUN cp -rf /tmp/config/* /usr/share/elasticsearch/plugins/ik/config/\n#  ###################################\n#   clean cache and tmp files\n#  ###################################\nRUN apt-get clean \\\n && rm -rf /tmp/* /var/tmp/*\nEXPOSE 9200/tcp 9300/tcp\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nCMD [\"elasticsearch\"]\n","originalDockerfileUglifiedHash":"f6c67b08e05ac2b139df3de4bbb37c04","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/f0c047fc33174693a8e8d8d829ce998b9f7a5d1f.dockerfile"}