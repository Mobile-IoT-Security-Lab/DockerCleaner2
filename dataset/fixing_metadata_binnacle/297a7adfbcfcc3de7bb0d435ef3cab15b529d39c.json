{"seed":554007178,"processedDockerfileHash":"234a50b519e286363ede809b0a1d805d","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-pip","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   Shinken Docker installation using pip (latest)\nFROM debian:wheezy\nMAINTAINER Rohit Gupta\n#   Install Shinken, Nagios plugins, apache2 and supervisord\nRUN apt-get update \\\n && apt-get install --no-install-recommends python-pip python-pycurl python-cherrypy3 nagios-plugins libsys-statistics-linux-perl apache2 libapache2-mod-proxy-html supervisor python-dev python-cairo python-crypto libssl-dev inotify-tools ntp -y\nRUN useradd --create-home shinken \\\n && pip install shinken==2.4.3 pymongo==4.3.3 requests==2.28.2 arrow==1.2.3 bottle==0.12.8 > =3.0.3 \\\n && update-rc.d -f apache2 remove \\\n && update-rc.d -f shinken remove\n#   Install shinken modules from shinken.io\nRUN chown -R shinken:shinken /etc/shinken/ \\\n && su - shinken -c 'shinken --init' \\\n && su - shinken -c 'shinken install webui2' \\\n && su - shinken -c 'shinken install auth-htpasswd' \\\n && su - shinken -c 'shinken install sqlitedb' \\\n && su - shinken -c 'shinken install pickle-retention-file-scheduler' \\\n && su - shinken -c 'shinken install booster-nrpe' \\\n && su - shinken -c 'shinken install logstore-sqlite' \\\n && su - shinken -c 'shinken install livestatus' \\\n && su - shinken -c 'shinken install graphite' \\\n && su - shinken -c 'shinken install ui-graphite'\n#   Install Graphite\nRUN pip install Twisted==11.1.0 \\\n && pip install flup==1.0.2 \\\n && pip install django==1.5.10 \\\n && pip install django-tagging==0.3.2 \\\n && pip install https://github.com/graphite-project/ceres/tarball/master \\\n && pip install whisper==0.9.12 \\\n && pip install carbon==0.9.12 \\\n && pip install graphite-web==0.9.12 \\\n && pip install gunicorn==19.1.1\n#   Install and configure thruk\nRUN gpg --keyserver keys.gnupg.net --recv-keys F8C1CA08A57B9ED7 \\\n && gpg --armor --export F8C1CA08A57B9ED7 | apt-key add - \\\n && echo 'deb http://labs.consol.de/repo/stable/debian wheezy main' >> /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends thruk -y \\\n && apt-get clean\nCOPY thruk/thruk_local.conf /etc/thruk/thruk_local.conf\n#   Install check_nrpe plugin\nCOPY nrpe-2.15.tar.gz /usr/src/\nRUN cd /usr/src/nrpe-2.15/ \\\n && ./configure --with-nagios-user=shinken --with-nagios-group=shinken --with-nrpe-user=shinken --with-nrpe-group=shinken --with-ssl=/usr/bin/openssl --with-ssl-lib=/usr/lib/x86_64-linux-gnu \\\n && make all \\\n && make install-plugin \\\n && mv /usr/local/nagios/libexec/check_nrpe /usr/lib/nagios/plugins/check_nrpe \\\n && cd / \\\n && rm -rf /usr/src/nrpe-2.15\n#   Configure apache\nCOPY shinken/shinken_apache.conf /etc/apache2/conf.d/shinken_apache.conf\nRUN ln -sf /etc/apache2/mods-available/proxy* /etc/apache2/mods-enabled/\n#   Configure Shinken modules\nCOPY shinken/shinken.cfg /etc/shinken/shinken.cfg\nCOPY shinken/broker-master.cfg /etc/shinken/brokers/broker-master.cfg\nCOPY shinken/poller-master.cfg /etc/shinken/pollers/poller-master.cfg\nCOPY shinken/scheduler-master.cfg /etc/shinken/schedulers/scheduler-master.cfg\nCOPY shinken/webui2.cfg /etc/shinken/modules/webui2.cfg\nCOPY shinken/webui2_worldmap.cfg /var/lib/shinken/modules/webui2/plugins/worldmap/plugin.cfg\nCOPY shinken/livestatus.cfg /etc/shinken/modules/livestatus.cfg\nCOPY shinken/graphite.cfg /etc/shinken/modules/graphite.cfg\nCOPY shinken/ui-graphite.cfg /etc/shinken/modules/ui-graphite.cfg\nRUN mkdir -p /etc/shinken/custom_configs /usr/local/custom_plugins \\\n && ln -sf /etc/shinken/custom_configs/htpasswd.users /etc/shinken/htpasswd.users \\\n && rm -f /etc/thruk/htpasswd \\\n && ln -sf /etc/shinken/htpasswd.users /etc/thruk/htpasswd \\\n && chown -R shinken:shinken /etc/shinken/\n#   Configure graphite\nCOPY graphite/carbon.conf /opt/graphite/conf/\nCOPY graphite/storage-schemas.conf /opt/graphite/conf/\nCOPY graphite/storage-aggregation.conf /opt/graphite/conf/\nCOPY graphite/local_settings.py /opt/graphite/webapp/graphite/local_settings.py\nRUN mkdir -p /var/log/graphite \\\n && cd /opt/graphite/webapp/graphite/ \\\n && python manage.py syncdb --noinput\n#   Add shinken config watcher to restart arbiter, when changes happen\nCOPY shinken/watch_shinken_config.sh /usr/bin/watch_shinken_config.sh\nRUN chmod 755 /usr/bin/watch_shinken_config.sh\n#   Copy extra NRPE plugins and fix permissions\nCOPY extra_plugins/* /usr/lib/nagios/plugins/\nRUN cd /usr/lib/nagios/plugins/ \\\n && chmod a+x * \\\n && chmod u+s check_apt restart_service check_ping check_icmp check_fping apt_update\n#   Define mountable directories\nVOLUME [\"/etc/shinken/custom_configs\", \"/usr/local/custom_plugins\"]\n#   configure supervisor\nCOPY supervisor/conf.d/* /etc/supervisor/conf.d/\n#   Expost port 80 (apache2)\nEXPOSE 80/tcp\n#   Default docker process\nCMD [\"supervisord\", \"-c\", \"/etc/supervisor/supervisord.conf\", \"-n\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  Shinken Docker installation using pip (latest)\nFROM debian:wheezy\nMAINTAINER Rohit Gupta\n#  Install Shinken, Nagios plugins, apache2 and supervisord\nRUN apt-get update \\\n && apt-get install python-pip python-pycurl python-cherrypy3 nagios-plugins libsys-statistics-linux-perl apache2 libapache2-mod-proxy-html supervisor python-dev python-cairo python-crypto libssl-dev inotify-tools ntp -y\nRUN useradd --create-home shinken \\\n && pip install shinken pymongo requests arrow bottle==0.12.8 > =3.0.3 \\\n && update-rc.d -f apache2 remove \\\n && update-rc.d -f shinken remove\n#  Install shinken modules from shinken.io\nRUN chown -R shinken:shinken /etc/shinken/ \\\n && su - shinken -c 'shinken --init' \\\n && su - shinken -c 'shinken install webui2' \\\n && su - shinken -c 'shinken install auth-htpasswd' \\\n && su - shinken -c 'shinken install sqlitedb' \\\n && su - shinken -c 'shinken install pickle-retention-file-scheduler' \\\n && su - shinken -c 'shinken install booster-nrpe' \\\n && su - shinken -c 'shinken install logstore-sqlite' \\\n && su - shinken -c 'shinken install livestatus' \\\n && su - shinken -c 'shinken install graphite' \\\n && su - shinken -c 'shinken install ui-graphite'\n#  Install Graphite\nRUN pip install Twisted==11.1.0 \\\n && pip install flup==1.0.2 \\\n && pip install django==1.5.10 \\\n && pip install django-tagging==0.3.2 \\\n && pip install https://github.com/graphite-project/ceres/tarball/master \\\n && pip install whisper==0.9.12 \\\n && pip install carbon==0.9.12 \\\n && pip install graphite-web==0.9.12 \\\n && pip install gunicorn==19.1.1\n#  Install and configure thruk\nRUN gpg --keyserver keys.gnupg.net --recv-keys F8C1CA08A57B9ED7 \\\n && gpg --armor --export F8C1CA08A57B9ED7 | apt-key add - \\\n && echo 'deb http://labs.consol.de/repo/stable/debian wheezy main' >> /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install thruk -y \\\n && apt-get clean\nADD thruk/thruk_local.conf /etc/thruk/thruk_local.conf\n#  Install check_nrpe plugin\nADD nrpe-2.15.tar.gz /usr/src/\nRUN cd /usr/src/nrpe-2.15/ \\\n && ./configure --with-nagios-user=shinken --with-nagios-group=shinken --with-nrpe-user=shinken --with-nrpe-group=shinken --with-ssl=/usr/bin/openssl --with-ssl-lib=/usr/lib/x86_64-linux-gnu \\\n && make all \\\n && make install-plugin \\\n && mv /usr/local/nagios/libexec/check_nrpe /usr/lib/nagios/plugins/check_nrpe \\\n && cd / \\\n && rm -rf /usr/src/nrpe-2.15\n#  Configure apache\nADD shinken/shinken_apache.conf /etc/apache2/conf.d/shinken_apache.conf\nRUN ln -sf /etc/apache2/mods-available/proxy* /etc/apache2/mods-enabled/\n#  Configure Shinken modules\nADD shinken/shinken.cfg /etc/shinken/shinken.cfg\nADD shinken/broker-master.cfg /etc/shinken/brokers/broker-master.cfg\nADD shinken/poller-master.cfg /etc/shinken/pollers/poller-master.cfg\nADD shinken/scheduler-master.cfg /etc/shinken/schedulers/scheduler-master.cfg\nCOPY shinken/webui2.cfg /etc/shinken/modules/webui2.cfg\nCOPY shinken/webui2_worldmap.cfg /var/lib/shinken/modules/webui2/plugins/worldmap/plugin.cfg\nADD shinken/livestatus.cfg /etc/shinken/modules/livestatus.cfg\nADD shinken/graphite.cfg /etc/shinken/modules/graphite.cfg\nADD shinken/ui-graphite.cfg /etc/shinken/modules/ui-graphite.cfg\nRUN mkdir -p /etc/shinken/custom_configs /usr/local/custom_plugins \\\n && ln -sf /etc/shinken/custom_configs/htpasswd.users /etc/shinken/htpasswd.users \\\n && rm -f /etc/thruk/htpasswd \\\n && ln -sf /etc/shinken/htpasswd.users /etc/thruk/htpasswd \\\n && chown -R shinken:shinken /etc/shinken/\n#  Configure graphite\nADD graphite/carbon.conf /opt/graphite/conf/\nADD graphite/storage-schemas.conf /opt/graphite/conf/\nADD graphite/storage-aggregation.conf /opt/graphite/conf/\nADD graphite/local_settings.py /opt/graphite/webapp/graphite/local_settings.py\nRUN mkdir -p /var/log/graphite \\\n && cd /opt/graphite/webapp/graphite/ \\\n && python manage.py syncdb --noinput\n#  Add shinken config watcher to restart arbiter, when changes happen\nADD shinken/watch_shinken_config.sh /usr/bin/watch_shinken_config.sh\nRUN chmod 755 /usr/bin/watch_shinken_config.sh\n#  Copy extra NRPE plugins and fix permissions\nADD extra_plugins/* /usr/lib/nagios/plugins/\nRUN cd /usr/lib/nagios/plugins/ \\\n && chmod a+x * \\\n && chmod u+s check_apt restart_service check_ping check_icmp check_fping apt_update\n#  Define mountable directories\nVOLUME [\"/etc/shinken/custom_configs\", \"/usr/local/custom_plugins\"]\n#  configure supervisor\nADD supervisor/conf.d/* /etc/supervisor/conf.d/\n#  Expost port 80 (apache2)\nEXPOSE 80/tcp\n#  Default docker process\nCMD [\"supervisord\", \"-c\", \"/etc/supervisor/supervisord.conf\", \"-n\"]\n","injectedSmells":[],"originalDockerfileHash":"8596969b67a692cb11300eca21057a8a","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   Shinken Docker installation using pip (latest)\nFROM debian:wheezy\nMAINTAINER Rohit Gupta\n#   Install Shinken, Nagios plugins, apache2 and supervisord\nRUN apt-get update \\\n && apt-get install python-pip python-pycurl python-cherrypy3 nagios-plugins libsys-statistics-linux-perl apache2 libapache2-mod-proxy-html supervisor python-dev python-cairo python-crypto libssl-dev inotify-tools ntp -y\nRUN useradd --create-home shinken \\\n && pip install shinken pymongo requests arrow bottle==0.12.8 > =3.0.3 \\\n && update-rc.d -f apache2 remove \\\n && update-rc.d -f shinken remove\n#   Install shinken modules from shinken.io\nRUN chown -R shinken:shinken /etc/shinken/ \\\n && su - shinken -c 'shinken --init' \\\n && su - shinken -c 'shinken install webui2' \\\n && su - shinken -c 'shinken install auth-htpasswd' \\\n && su - shinken -c 'shinken install sqlitedb' \\\n && su - shinken -c 'shinken install pickle-retention-file-scheduler' \\\n && su - shinken -c 'shinken install booster-nrpe' \\\n && su - shinken -c 'shinken install logstore-sqlite' \\\n && su - shinken -c 'shinken install livestatus' \\\n && su - shinken -c 'shinken install graphite' \\\n && su - shinken -c 'shinken install ui-graphite'\n#   Install Graphite\nRUN pip install Twisted==11.1.0 \\\n && pip install flup==1.0.2 \\\n && pip install django==1.5.10 \\\n && pip install django-tagging==0.3.2 \\\n && pip install https://github.com/graphite-project/ceres/tarball/master \\\n && pip install whisper==0.9.12 \\\n && pip install carbon==0.9.12 \\\n && pip install graphite-web==0.9.12 \\\n && pip install gunicorn==19.1.1\n#   Install and configure thruk\nRUN gpg --keyserver keys.gnupg.net --recv-keys F8C1CA08A57B9ED7 \\\n && gpg --armor --export F8C1CA08A57B9ED7 | apt-key add - \\\n && echo 'deb http://labs.consol.de/repo/stable/debian wheezy main' >> /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install thruk -y \\\n && apt-get clean\nADD thruk/thruk_local.conf /etc/thruk/thruk_local.conf\n#   Install check_nrpe plugin\nADD nrpe-2.15.tar.gz /usr/src/\nRUN cd /usr/src/nrpe-2.15/ \\\n && ./configure --with-nagios-user=shinken --with-nagios-group=shinken --with-nrpe-user=shinken --with-nrpe-group=shinken --with-ssl=/usr/bin/openssl --with-ssl-lib=/usr/lib/x86_64-linux-gnu \\\n && make all \\\n && make install-plugin \\\n && mv /usr/local/nagios/libexec/check_nrpe /usr/lib/nagios/plugins/check_nrpe \\\n && cd / \\\n && rm -rf /usr/src/nrpe-2.15\n#   Configure apache\nADD shinken/shinken_apache.conf /etc/apache2/conf.d/shinken_apache.conf\nRUN ln -sf /etc/apache2/mods-available/proxy* /etc/apache2/mods-enabled/\n#   Configure Shinken modules\nADD shinken/shinken.cfg /etc/shinken/shinken.cfg\nADD shinken/broker-master.cfg /etc/shinken/brokers/broker-master.cfg\nADD shinken/poller-master.cfg /etc/shinken/pollers/poller-master.cfg\nADD shinken/scheduler-master.cfg /etc/shinken/schedulers/scheduler-master.cfg\nCOPY shinken/webui2.cfg /etc/shinken/modules/webui2.cfg\nCOPY shinken/webui2_worldmap.cfg /var/lib/shinken/modules/webui2/plugins/worldmap/plugin.cfg\nADD shinken/livestatus.cfg /etc/shinken/modules/livestatus.cfg\nADD shinken/graphite.cfg /etc/shinken/modules/graphite.cfg\nADD shinken/ui-graphite.cfg /etc/shinken/modules/ui-graphite.cfg\nRUN mkdir -p /etc/shinken/custom_configs /usr/local/custom_plugins \\\n && ln -sf /etc/shinken/custom_configs/htpasswd.users /etc/shinken/htpasswd.users \\\n && rm -f /etc/thruk/htpasswd \\\n && ln -sf /etc/shinken/htpasswd.users /etc/thruk/htpasswd \\\n && chown -R shinken:shinken /etc/shinken/\n#   Configure graphite\nADD graphite/carbon.conf /opt/graphite/conf/\nADD graphite/storage-schemas.conf /opt/graphite/conf/\nADD graphite/storage-aggregation.conf /opt/graphite/conf/\nADD graphite/local_settings.py /opt/graphite/webapp/graphite/local_settings.py\nRUN mkdir -p /var/log/graphite \\\n && cd /opt/graphite/webapp/graphite/ \\\n && python manage.py syncdb --noinput\n#   Add shinken config watcher to restart arbiter, when changes happen\nADD shinken/watch_shinken_config.sh /usr/bin/watch_shinken_config.sh\nRUN chmod 755 /usr/bin/watch_shinken_config.sh\n#   Copy extra NRPE plugins and fix permissions\nADD extra_plugins/* /usr/lib/nagios/plugins/\nRUN cd /usr/lib/nagios/plugins/ \\\n && chmod a+x * \\\n && chmod u+s check_apt restart_service check_ping check_icmp check_fping apt_update\n#   Define mountable directories\nVOLUME [\"/etc/shinken/custom_configs\", \"/usr/local/custom_plugins\"]\n#   configure supervisor\nADD supervisor/conf.d/* /etc/supervisor/conf.d/\n#   Expost port 80 (apache2)\nEXPOSE 80/tcp\n#   Default docker process\nCMD [\"supervisord\", \"-c\", \"/etc/supervisor/supervisord.conf\", \"-n\"]\n","originalDockerfileUglifiedHash":"ae5c330f8da3c2d0e7f07d155215da35","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/297a7adfbcfcc3de7bb0d435ef3cab15b529d39c.dockerfile"}