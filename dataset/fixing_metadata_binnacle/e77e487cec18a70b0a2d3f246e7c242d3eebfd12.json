{"seed":375201015,"processedDockerfileHash":"e0152e5eb4224b6828adca7ddb3ee28c","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   Clone from the Fedora 24 image\nFROM registry.fedoraproject.org/fedora:24\nMAINTAINER Jan Pazdziora\n#   Workaround 1615948\nRUN ln -s /bin/false /usr/sbin/systemd-machine-id-setup\nRUN dnf upgrade -y nss sssd-client \\\n && dnf install -y freeipa-server freeipa-server-dns freeipa-server-trust-ad patch \\\n && dnf clean all\nRUN groupadd -g 288 kdcproxy ; useradd -u 288 -g 288 -c 'IPA KDC Proxy User' -d '/var/lib/kdcproxy' -s '/sbin/nologin' kdcproxy\n#   debug: RUN test $( getent passwd | grep -E \"^(dirsrv:x:389|kdcproxy:x:288|pkiuser:x:17):\" | wc -l ) -eq 3\n#   Container image which runs systemd\n#   debug: RUN ! test -f /etc/machine-id\n#   debug: RUN test -z \"$container\"\nENV container=\"oci\"\nENTRYPOINT [\"/usr/sbin/init\"]\nSTOPSIGNAL RTMIN+3\n#   test-addon: VOLUME [ \"/var/log/journal\" ]\n#   test: systemd-container-failed.sh auditd.service proc-fs-nfsd.mount TRAVIS:systemd-firstboot.service var-lib-nfs-rpc_pipefs.mount\n#   Minimize the systemd setup\nRUN find /etc/systemd/system /usr/lib/systemd/system/{basic,multi-user,sysinit}.target.wants -type l | xargs rm -v\nCOPY patches/minimal-fedora-24.patch /root/\nRUN patch --verbose -p0 --fuzz=0 < /root/minimal-fedora-24.patch\n#   debug: RUN ! find /etc/systemd/system /usr/lib/systemd/system/{basic,multi-user,sysinit}.target.wants /etc/tmpfiles.d -type f | grep .\nCOPY container-ipa.target /usr/lib/systemd/system/\nRUN systemctl set-default container-ipa.target\nRUN rmdir -v /etc/systemd/system/multi-user.target.wants \\\n && mkdir /etc/systemd/system/container-ipa.target.wants \\\n && ln -s /etc/systemd/system/container-ipa.target.wants /etc/systemd/system/multi-user.target.wants\nRUN rm -rf /run/lock/opencryptoki\nRUN echo 0123456789abcdef0000000000000000 > /etc/machine-id \\\n && systemd-tmpfiles --remove --create \\\n && echo -n > /etc/machine-id\nRUN rm -v /var/lib/systemd/random-seed\n#   test-addon: VOLUME [ \"/var/log/journal\" ]\n#   test: systemd-container-diff.sh list-dependencies-fedora-24.out docker-diff-minimal-fedora-23.exceptions docker-diff-minimal-fedora-23.out\n#   Prepare for basic ipa-server-install in container\n#   Address failing fedora-domainname.service in the ipa-client-install step\nRUN mv /usr/bin/domainname /usr/bin/domainname.orig\nCOPY hostnamectl-wrapper /usr/bin/domainname\nCOPY patches/ipa-fedora-24.patch /root\nRUN set -o pipefail ; patch --verbose -p0 --fuzz=0 < /root/ipa-fedora-24.patch | tee /dev/stderr | sed -n 's/^patching file //;T;/\\.py$/p' | xargs python -m compileall\n#   Avoid /usr/lib/python3.5/site-packages/SSSDConfig/__pycache__ changes in runtime\nRUN python3 -c 'import SSSDConfig'\nRUN mv /usr/sbin/ipa-join /usr/sbin/ipa-join.orig\nCOPY ipa-join /usr/sbin/ipa-join\n#   Workaround 1601180\n#   debug: RUN ! test -f /usr/share/authconfig/__pycache__/authinfo.cpython-35.pyc\nRUN authconfig --help > /dev/null\n#   debug: RUN test -f /usr/share/authconfig/__pycache__/authinfo.cpython-35.pyc\n#   test-addon: VOLUME [ \"/var/log/journal\" ]\n#  # # test: systemd-container-ipa-server-install.sh\n#   Move configuration and data to data volume\nCOPY patches/ipa-data-fedora-24.patch /root\nRUN set -o pipefail ; patch --verbose -p0 --fuzz=0 < /root/ipa-data-fedora-24.patch | tee /dev/stderr | sed -n 's/^patching file //;T;/\\.py$/p' | while read i ; do if test -z \"${i##*/authconfig/*}\" ; then python3 -m compileall $i ; else python -m compileall $i ; fi ; done\nRUN mv /etc/dirsrv/schema /usr/share/dirsrv/schema \\\n && ln -s /usr/share/dirsrv/schema /etc/dirsrv/schema\nCOPY utils/prepare-volume-template utils/populate-volume-from-template utils/extract-rpm-upgrade-scriptlets /usr/local/bin/\nCOPY volume-data-list volume-tmp-list volume-data-autoupdate /etc/\nRUN /usr/local/bin/prepare-volume-template /etc/volume-data-list /data\nRUN /usr/local/bin/prepare-volume-template /etc/volume-tmp-list /tmp\nRUN /usr/local/bin/extract-rpm-upgrade-scriptlets\nRUN echo 2.0 > /etc/volume-version\nVOLUME [ \"/tmp\", \"/run\", \"/data\", \"/var/log/journal\" ]\nCOPY init-data-minimal /usr/local/sbin/init\nENTRYPOINT [\"/usr/local/sbin/init\"]\n#   test: systemd-container-ipa-server-install-data.sh docker-diff-minimal-fedora-23.out\n#   Configure master/replica upon the first invocation\nCOPY init-data /usr/local/sbin/init\nCOPY ipa-server-configure-first systemctl-exit-with-status ipa-volume-upgrade-* /usr/sbin/\nCOPY ipa-server-configure-first.service ipa-server-upgrade.service ipa-server-update-self-ip-address.service /usr/lib/systemd/system/\nRUN ln -sv /usr/lib/systemd/system/ipa-server-configure-first.service /data-template/etc/systemd/system/container-ipa.target.wants/ipa-server-configure-first.service\nCOPY exit-status.conf /usr/lib/systemd/system/systemd-poweroff.service.d/\nEXPOSE 53/udp 53/tcp 80/tcp 443/tcp 389/tcp 636/tcp 88/tcp 464/tcp 88/udp 464/udp 123/udp 7389/tcp 9443/tcp 9444/tcp 9445/tcp\nRUN uuidgen > /data-template/build-id\n#   Invocation:\n#   docker run -ti -v /sys/fs/cgroup:/sys/fs/cgroup:ro --tmpfs /run --tmpfs /tmp -v /opt/ipa-data:/data:Z -h ipa.example.test ${NAME} [ options ]\n#   Atomic specific bits\nCOPY install.sh uninstall.sh /bin/\nCOPY atomic-install-help /usr/share/ipa/\n#   For atomic, we run INSTALL --privileged but install.sh will start another unprivileged container.\n#   We do it this way to be able to set hostname for the unprivileged container.\nLABEL install=\"'docker run -ti --rm --privileged -v /:/host -e HOST=/host -e DATADIR=/var/lib/${NAME} -e NAME=${NAME} -e IMAGE=${IMAGE} ${IMAGE} /bin/install.sh'\"\nLABEL run=\"'docker run ${RUN_OPTS} --name ${NAME} -v /var/lib/${NAME}:/data:Z -v /sys/fs/cgroup:/sys/fs/cgroup:ro --tmpfs /run --tmpfs /tmp -v /dev/urandom:/dev/random:ro ${IMAGE}'\"\nLABEL RUN_OPTS_FILE=\"'/var/lib/${NAME}/docker-run-opts'\"\nLABEL stop=\"'docker stop ${NAME}'\"\nLABEL uninstall=\"'docker run --rm --privileged -v /:/host -e HOST=/host -e DATADIR=/var/lib/${NAME} ${IMAGE} /bin/uninstall.sh'\"\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  Clone from the Fedora 24 image\nFROM registry.fedoraproject.org/fedora:24\nMAINTAINER Jan Pazdziora\n#  Workaround 1615948\nRUN ln -s /bin/false /usr/sbin/systemd-machine-id-setup\nRUN dnf upgrade -y nss sssd-client \\\n && dnf install -y freeipa-server freeipa-server-dns freeipa-server-trust-ad patch \\\n && dnf clean all\nRUN groupadd -g 288 kdcproxy ; useradd -u 288 -g 288 -c 'IPA KDC Proxy User' -d '/var/lib/kdcproxy' -s '/sbin/nologin' kdcproxy\n#  debug: RUN test $( getent passwd | grep -E \"^(dirsrv:x:389|kdcproxy:x:288|pkiuser:x:17):\" | wc -l ) -eq 3\n#  Container image which runs systemd\n#  debug: RUN ! test -f /etc/machine-id\n#  debug: RUN test -z \"$container\"\nENV container=\"oci\"\nENTRYPOINT [\"/usr/sbin/init\"]\nSTOPSIGNAL RTMIN+3\n#  test-addon: VOLUME [ \"/var/log/journal\" ]\n#  test: systemd-container-failed.sh auditd.service proc-fs-nfsd.mount TRAVIS:systemd-firstboot.service var-lib-nfs-rpc_pipefs.mount\n#  Minimize the systemd setup\nRUN find /etc/systemd/system /usr/lib/systemd/system/{basic,multi-user,sysinit}.target.wants -type l | xargs rm -v\nCOPY patches/minimal-fedora-24.patch /root/\nRUN patch --verbose -p0 --fuzz=0 < /root/minimal-fedora-24.patch\n#  debug: RUN ! find /etc/systemd/system /usr/lib/systemd/system/{basic,multi-user,sysinit}.target.wants /etc/tmpfiles.d -type f | grep .\nCOPY container-ipa.target /usr/lib/systemd/system/\nRUN systemctl set-default container-ipa.target\nRUN rmdir -v /etc/systemd/system/multi-user.target.wants \\\n && mkdir /etc/systemd/system/container-ipa.target.wants \\\n && ln -s /etc/systemd/system/container-ipa.target.wants /etc/systemd/system/multi-user.target.wants\nRUN rm -rf /run/lock/opencryptoki\nRUN echo 0123456789abcdef0000000000000000 > /etc/machine-id \\\n && systemd-tmpfiles --remove --create \\\n && echo -n > /etc/machine-id\nRUN rm -v /var/lib/systemd/random-seed\n#  test-addon: VOLUME [ \"/var/log/journal\" ]\n#  test: systemd-container-diff.sh list-dependencies-fedora-24.out docker-diff-minimal-fedora-23.exceptions docker-diff-minimal-fedora-23.out\n#  Prepare for basic ipa-server-install in container\n#  Address failing fedora-domainname.service in the ipa-client-install step\nRUN mv /usr/bin/domainname /usr/bin/domainname.orig\nADD hostnamectl-wrapper /usr/bin/domainname\nCOPY patches/ipa-fedora-24.patch /root\nRUN set -o pipefail ; patch --verbose -p0 --fuzz=0 < /root/ipa-fedora-24.patch | tee /dev/stderr | sed -n 's/^patching file //;T;/\\.py$/p' | xargs python -m compileall\n#  Avoid /usr/lib/python3.5/site-packages/SSSDConfig/__pycache__ changes in runtime\nRUN python3 -c 'import SSSDConfig'\nRUN mv /usr/sbin/ipa-join /usr/sbin/ipa-join.orig\nCOPY ipa-join /usr/sbin/ipa-join\n#  Workaround 1601180\n#  debug: RUN ! test -f /usr/share/authconfig/__pycache__/authinfo.cpython-35.pyc\nRUN authconfig --help > /dev/null\n#  debug: RUN test -f /usr/share/authconfig/__pycache__/authinfo.cpython-35.pyc\n#  test-addon: VOLUME [ \"/var/log/journal\" ]\n# # # test: systemd-container-ipa-server-install.sh\n#  Move configuration and data to data volume\nCOPY patches/ipa-data-fedora-24.patch /root\nRUN set -o pipefail ; patch --verbose -p0 --fuzz=0 < /root/ipa-data-fedora-24.patch | tee /dev/stderr | sed -n 's/^patching file //;T;/\\.py$/p' | while read i ; do if test -z \"${i##*/authconfig/*}\" ; then python3 -m compileall $i ; else python -m compileall $i ; fi ; done\nRUN mv /etc/dirsrv/schema /usr/share/dirsrv/schema \\\n && ln -s /usr/share/dirsrv/schema /etc/dirsrv/schema\nCOPY utils/prepare-volume-template utils/populate-volume-from-template utils/extract-rpm-upgrade-scriptlets /usr/local/bin/\nCOPY volume-data-list volume-tmp-list volume-data-autoupdate /etc/\nRUN /usr/local/bin/prepare-volume-template /etc/volume-data-list /data\nRUN /usr/local/bin/prepare-volume-template /etc/volume-tmp-list /tmp\nRUN /usr/local/bin/extract-rpm-upgrade-scriptlets\nRUN echo 2.0 > /etc/volume-version\nVOLUME [ \"/tmp\", \"/run\", \"/data\", \"/var/log/journal\" ]\nCOPY init-data-minimal /usr/local/sbin/init\nENTRYPOINT [\"/usr/local/sbin/init\"]\n#  test: systemd-container-ipa-server-install-data.sh docker-diff-minimal-fedora-23.out\n#  Configure master/replica upon the first invocation\nCOPY init-data /usr/local/sbin/init\nCOPY ipa-server-configure-first systemctl-exit-with-status ipa-volume-upgrade-* /usr/sbin/\nCOPY ipa-server-configure-first.service ipa-server-upgrade.service ipa-server-update-self-ip-address.service /usr/lib/systemd/system/\nRUN ln -sv /usr/lib/systemd/system/ipa-server-configure-first.service /data-template/etc/systemd/system/container-ipa.target.wants/ipa-server-configure-first.service\nCOPY exit-status.conf /usr/lib/systemd/system/systemd-poweroff.service.d/\nEXPOSE 53/udp 53/tcp 80/tcp 443/tcp 389/tcp 636/tcp 88/tcp 464/tcp 88/udp 464/udp 123/udp 7389/tcp 9443/tcp 9444/tcp 9445/tcp\nRUN uuidgen > /data-template/build-id\n#  Invocation:\n#  docker run -ti -v /sys/fs/cgroup:/sys/fs/cgroup:ro --tmpfs /run --tmpfs /tmp -v /opt/ipa-data:/data:Z -h ipa.example.test ${NAME} [ options ]\n#  Atomic specific bits\nCOPY install.sh uninstall.sh /bin/\nCOPY atomic-install-help /usr/share/ipa/\n#  For atomic, we run INSTALL --privileged but install.sh will start another unprivileged container.\n#  We do it this way to be able to set hostname for the unprivileged container.\nLABEL install=\"'docker run -ti --rm --privileged -v /:/host -e HOST=/host -e DATADIR=/var/lib/${NAME} -e NAME=${NAME} -e IMAGE=${IMAGE} ${IMAGE} /bin/install.sh'\"\nLABEL run=\"'docker run ${RUN_OPTS} --name ${NAME} -v /var/lib/${NAME}:/data:Z -v /sys/fs/cgroup:/sys/fs/cgroup:ro --tmpfs /run --tmpfs /tmp -v /dev/urandom:/dev/random:ro ${IMAGE}'\"\nLABEL RUN_OPTS_FILE=\"'/var/lib/${NAME}/docker-run-opts'\"\nLABEL stop=\"'docker stop ${NAME}'\"\nLABEL uninstall=\"'docker run --rm --privileged -v /:/host -e HOST=/host -e DATADIR=/var/lib/${NAME} ${IMAGE} /bin/uninstall.sh'\"\n","injectedSmells":[],"originalDockerfileHash":"4644f176a1f75bf7b6c72d86165d1cf7","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   Clone from the Fedora 24 image\nFROM registry.fedoraproject.org/fedora:24\nMAINTAINER Jan Pazdziora\n#   Workaround 1615948\nRUN ln -s /bin/false /usr/sbin/systemd-machine-id-setup\nRUN dnf upgrade -y nss sssd-client \\\n && dnf install -y freeipa-server freeipa-server-dns freeipa-server-trust-ad patch \\\n && dnf clean all\nRUN groupadd -g 288 kdcproxy ; useradd -u 288 -g 288 -c 'IPA KDC Proxy User' -d '/var/lib/kdcproxy' -s '/sbin/nologin' kdcproxy\n#   debug: RUN test $( getent passwd | grep -E \"^(dirsrv:x:389|kdcproxy:x:288|pkiuser:x:17):\" | wc -l ) -eq 3\n#   Container image which runs systemd\n#   debug: RUN ! test -f /etc/machine-id\n#   debug: RUN test -z \"$container\"\nENV container=\"oci\"\nENTRYPOINT [\"/usr/sbin/init\"]\nSTOPSIGNAL RTMIN+3\n#   test-addon: VOLUME [ \"/var/log/journal\" ]\n#   test: systemd-container-failed.sh auditd.service proc-fs-nfsd.mount TRAVIS:systemd-firstboot.service var-lib-nfs-rpc_pipefs.mount\n#   Minimize the systemd setup\nRUN find /etc/systemd/system /usr/lib/systemd/system/{basic,multi-user,sysinit}.target.wants -type l | xargs rm -v\nCOPY patches/minimal-fedora-24.patch /root/\nRUN patch --verbose -p0 --fuzz=0 < /root/minimal-fedora-24.patch\n#   debug: RUN ! find /etc/systemd/system /usr/lib/systemd/system/{basic,multi-user,sysinit}.target.wants /etc/tmpfiles.d -type f | grep .\nCOPY container-ipa.target /usr/lib/systemd/system/\nRUN systemctl set-default container-ipa.target\nRUN rmdir -v /etc/systemd/system/multi-user.target.wants \\\n && mkdir /etc/systemd/system/container-ipa.target.wants \\\n && ln -s /etc/systemd/system/container-ipa.target.wants /etc/systemd/system/multi-user.target.wants\nRUN rm -rf /run/lock/opencryptoki\nRUN echo 0123456789abcdef0000000000000000 > /etc/machine-id \\\n && systemd-tmpfiles --remove --create \\\n && echo -n > /etc/machine-id\nRUN rm -v /var/lib/systemd/random-seed\n#   test-addon: VOLUME [ \"/var/log/journal\" ]\n#   test: systemd-container-diff.sh list-dependencies-fedora-24.out docker-diff-minimal-fedora-23.exceptions docker-diff-minimal-fedora-23.out\n#   Prepare for basic ipa-server-install in container\n#   Address failing fedora-domainname.service in the ipa-client-install step\nRUN mv /usr/bin/domainname /usr/bin/domainname.orig\nADD hostnamectl-wrapper /usr/bin/domainname\nCOPY patches/ipa-fedora-24.patch /root\nRUN set -o pipefail ; patch --verbose -p0 --fuzz=0 < /root/ipa-fedora-24.patch | tee /dev/stderr | sed -n 's/^patching file //;T;/\\.py$/p' | xargs python -m compileall\n#   Avoid /usr/lib/python3.5/site-packages/SSSDConfig/__pycache__ changes in runtime\nRUN python3 -c 'import SSSDConfig'\nRUN mv /usr/sbin/ipa-join /usr/sbin/ipa-join.orig\nCOPY ipa-join /usr/sbin/ipa-join\n#   Workaround 1601180\n#   debug: RUN ! test -f /usr/share/authconfig/__pycache__/authinfo.cpython-35.pyc\nRUN authconfig --help > /dev/null\n#   debug: RUN test -f /usr/share/authconfig/__pycache__/authinfo.cpython-35.pyc\n#   test-addon: VOLUME [ \"/var/log/journal\" ]\n#  # # test: systemd-container-ipa-server-install.sh\n#   Move configuration and data to data volume\nCOPY patches/ipa-data-fedora-24.patch /root\nRUN set -o pipefail ; patch --verbose -p0 --fuzz=0 < /root/ipa-data-fedora-24.patch | tee /dev/stderr | sed -n 's/^patching file //;T;/\\.py$/p' | while read i ; do if test -z \"${i##*/authconfig/*}\" ; then python3 -m compileall $i ; else python -m compileall $i ; fi ; done\nRUN mv /etc/dirsrv/schema /usr/share/dirsrv/schema \\\n && ln -s /usr/share/dirsrv/schema /etc/dirsrv/schema\nCOPY utils/prepare-volume-template utils/populate-volume-from-template utils/extract-rpm-upgrade-scriptlets /usr/local/bin/\nCOPY volume-data-list volume-tmp-list volume-data-autoupdate /etc/\nRUN /usr/local/bin/prepare-volume-template /etc/volume-data-list /data\nRUN /usr/local/bin/prepare-volume-template /etc/volume-tmp-list /tmp\nRUN /usr/local/bin/extract-rpm-upgrade-scriptlets\nRUN echo 2.0 > /etc/volume-version\nVOLUME [ \"/tmp\", \"/run\", \"/data\", \"/var/log/journal\" ]\nCOPY init-data-minimal /usr/local/sbin/init\nENTRYPOINT [\"/usr/local/sbin/init\"]\n#   test: systemd-container-ipa-server-install-data.sh docker-diff-minimal-fedora-23.out\n#   Configure master/replica upon the first invocation\nCOPY init-data /usr/local/sbin/init\nCOPY ipa-server-configure-first systemctl-exit-with-status ipa-volume-upgrade-* /usr/sbin/\nCOPY ipa-server-configure-first.service ipa-server-upgrade.service ipa-server-update-self-ip-address.service /usr/lib/systemd/system/\nRUN ln -sv /usr/lib/systemd/system/ipa-server-configure-first.service /data-template/etc/systemd/system/container-ipa.target.wants/ipa-server-configure-first.service\nCOPY exit-status.conf /usr/lib/systemd/system/systemd-poweroff.service.d/\nEXPOSE 53/udp 53/tcp 80/tcp 443/tcp 389/tcp 636/tcp 88/tcp 464/tcp 88/udp 464/udp 123/udp 7389/tcp 9443/tcp 9444/tcp 9445/tcp\nRUN uuidgen > /data-template/build-id\n#   Invocation:\n#   docker run -ti -v /sys/fs/cgroup:/sys/fs/cgroup:ro --tmpfs /run --tmpfs /tmp -v /opt/ipa-data:/data:Z -h ipa.example.test ${NAME} [ options ]\n#   Atomic specific bits\nCOPY install.sh uninstall.sh /bin/\nCOPY atomic-install-help /usr/share/ipa/\n#   For atomic, we run INSTALL --privileged but install.sh will start another unprivileged container.\n#   We do it this way to be able to set hostname for the unprivileged container.\nLABEL install=\"'docker run -ti --rm --privileged -v /:/host -e HOST=/host -e DATADIR=/var/lib/${NAME} -e NAME=${NAME} -e IMAGE=${IMAGE} ${IMAGE} /bin/install.sh'\"\nLABEL run=\"'docker run ${RUN_OPTS} --name ${NAME} -v /var/lib/${NAME}:/data:Z -v /sys/fs/cgroup:/sys/fs/cgroup:ro --tmpfs /run --tmpfs /tmp -v /dev/urandom:/dev/random:ro ${IMAGE}'\"\nLABEL RUN_OPTS_FILE=\"'/var/lib/${NAME}/docker-run-opts'\"\nLABEL stop=\"'docker stop ${NAME}'\"\nLABEL uninstall=\"'docker run --rm --privileged -v /:/host -e HOST=/host -e DATADIR=/var/lib/${NAME} ${IMAGE} /bin/uninstall.sh'\"\n","originalDockerfileUglifiedHash":"38f43ed618475b282d054d571b1769de","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/e77e487cec18a70b0a2d3f246e7c242d3eebfd12.dockerfile"}