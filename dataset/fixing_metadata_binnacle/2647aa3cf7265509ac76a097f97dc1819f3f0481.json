{"seed":3316903805,"processedDockerfileHash":"c3323e7c35f12ceb4f27ed33abac12e6","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apk","have-a-healthcheck"],"processedDockerfile":"ARG PG_VERSION\n#  ###########################\n#   Build tools binaries in separate image\n#  ###########################\nARG GO_VERSION=1.12.6\nFROM golang:${GO_VERSION}-alpine AS tools\nENV TOOLS_VERSION=\"0.6.0\"\nRUN apk update \\\n && apk add git --no-cache \\\n && mkdir -p ${GOPATH}/src/github.com/timescale/ \\\n && cd ${GOPATH}/src/github.com/timescale/ \\\n && git clone https://github.com/timescale/timescaledb-tune.git \\\n && git clone https://github.com/timescale/timescaledb-parallel-copy.git \\\n && cd timescaledb-tune/cmd/timescaledb-tune \\\n && git fetch \\\n && git checkout --quiet $( git describe --abbrev=0 ;) \\\n && go get -d -v \\\n && go build -o /go/bin/timescaledb-tune \\\n && cd ${GOPATH}/src/github.com/timescale/timescaledb-parallel-copy/cmd/timescaledb-parallel-copy \\\n && git fetch \\\n && git checkout --quiet $( git describe --abbrev=0 ;) \\\n && go get -d -v \\\n && go build -o /go/bin/timescaledb-parallel-copy\n#  ###########################\n#   Build old versions in a separate stage\n#  ###########################\nARG PG_VERSION\nFROM bitnami/postgresql:${PG_VERSION} AS oldversions\nARG PG_VERSION\nUSER 0\nRUN set -ex \\\n && mkdir -p /var/lib/apt/lists/partial \\\n && apt-get update \\\n && apt-get install --no-install-recommends build-essential libssl-dev git dpkg-dev gcc libc-dev make cmake wget -y \\\n && mkdir -p /build/ \\\n && git clone https://github.com/timescale/timescaledb /build/timescaledb \\\n && cd /build/timescaledb \\\n && echo \"if [ \\\"$( echo ${PG_VERSION} | cut -c1-2 ;)\\\" != \\\"11\\\" ] || [ \"${OLD_VERSION}\" \\> \"1.0.1\" ]; then cd /build/timescaledb \\\n && rm -fr build \\\n && git reset HEAD --hard \\\n && git fetch \\\n && git checkout ${OLD_VERSION} \\\n && ./bootstrap -DPROJECT_INSTALL_METHOD=\\\"docker\\\" \\\n && cd build \\\n && make install; fi\" > ./build_old.sh \\\n && chmod +x ./build_old.sh\n#  ####\n#   Add the latest previous version to the end of the list for each new build\n#  ####\nRUN OLD_VERSION=1.1.0 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.1.1 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.2.0 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.2.1 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.2.2 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.3.0 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.3.1 /build/timescaledb/build_old.sh\n#   Cleanup\nRUN echo $( pg_config --pkglibdir ;) \\\n && rm -f $( pg_config --sharedir ;)/extension/timescaledb--*--*.sql \\\n && rm -f $( pg_config --sharedir ;)/extension/timescaledb*mock*.sql \\\n && KEEP_NUM_VERSIONS=5 \\\n && rm -f $( ls -1 $( pg_config --pkglibdir ;)/timescaledb-*.so | head -n -${KEEP_NUM_VERSIONS} ;) \\\n && rm -f $( ls -1 $( pg_config --sharedir ;)/extension/timescaledb-*.sql | head -n -${KEEP_NUM_VERSIONS} ;) \\\n && cd ~ \\\n && apt-get autoremove --purge -y build-essential libssl-dev dpkg-dev gcc libc-dev make cmake \\\n && apt-get clean -y \\\n && rm -rf \"${HOME}/.cache\" /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#  ###########################\n#   Now build image and copy in tools\n#  ###########################\nARG PG_VERSION\nFROM bitnami/postgresql:${PG_VERSION}\nARG PG_VERSION\nMAINTAINER Timescale https://www.timescale.com\nENV TIMESCALEDB_VERSION=\"1.3.2\"\nCOPY docker-entrypoint-initdb.d/* /docker-entrypoint-initdb.d/\nCOPY --from=tools /go/bin/* /usr/local/bin/\nCOPY --from=oldversions /opt/bitnami/postgresql/lib/timescaledb-*.so /usr/local/lib/postgresql/\nCOPY --from=oldversions /opt/bitnami/postgresql/share/extension/timescaledb--*.sql /usr/local/share/postgresql/extension/\nUSER 0\nRUN set -ex \\\n && mkdir -p /var/lib/apt/lists/partial \\\n && apt-get update \\\n && apt-get install --no-install-recommends build-essential libssl-dev git dpkg-dev gcc libc-dev make cmake wget -y \\\n && mkdir -p /build/ \\\n && git clone https://github.com/timescale/timescaledb /build/timescaledb \\\n && cd /build/timescaledb \\\n && rm -fr build \\\n && git checkout ${TIMESCALEDB_VERSION} \\\n && ./bootstrap -DPROJECT_INSTALL_METHOD=\"docker\" \\\n && cd build \\\n && make install \\\n && cd ~ \\\n && apt-get autoremove --purge -y build-essential libssl-dev dpkg-dev gcc libc-dev make cmake \\\n && apt-get clean -y \\\n && rm -rf \"${HOME}/.cache\" /var/lib/apt/lists/* /tmp/* /var/tmp/*\nRUN sed -r -i \"s/[#]*\\s*(shared_preload_libraries)\\s*=\\s*'(.*)'/\\1 = 'timescaledb,\\2'/;s/,'/'/\" /opt/bitnami/postgresql/share/postgresql.conf.sample\nUSER 1001\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"ARG PG_VERSION\n# ###########################\n#  Build tools binaries in separate image\n# ###########################\nARG GO_VERSION=1.12.6\nFROM golang:${GO_VERSION}-alpine AS tools\nENV TOOLS_VERSION=\"0.6.0\"\nRUN apk update \\\n && apk add --no-cache git \\\n && mkdir -p ${GOPATH}/src/github.com/timescale/ \\\n && cd ${GOPATH}/src/github.com/timescale/ \\\n && git clone https://github.com/timescale/timescaledb-tune.git \\\n && git clone https://github.com/timescale/timescaledb-parallel-copy.git \\\n && cd timescaledb-tune/cmd/timescaledb-tune \\\n && git fetch \\\n && git checkout --quiet $( git describe --abbrev=0 ;) \\\n && go get -d -v \\\n && go build -o /go/bin/timescaledb-tune \\\n && cd ${GOPATH}/src/github.com/timescale/timescaledb-parallel-copy/cmd/timescaledb-parallel-copy \\\n && git fetch \\\n && git checkout --quiet $( git describe --abbrev=0 ;) \\\n && go get -d -v \\\n && go build -o /go/bin/timescaledb-parallel-copy\n# ###########################\n#  Build old versions in a separate stage\n# ###########################\nARG PG_VERSION\nFROM bitnami/postgresql:${PG_VERSION} AS oldversions\nARG PG_VERSION\nUSER 0\nRUN set -ex \\\n && mkdir -p /var/lib/apt/lists/partial \\\n && apt-get update \\\n && apt-get install build-essential libssl-dev git dpkg-dev gcc libc-dev make cmake wget -y \\\n && mkdir -p /build/ \\\n && git clone https://github.com/timescale/timescaledb /build/timescaledb \\\n && cd /build/timescaledb \\\n && echo \"if [ \\\"$( echo ${PG_VERSION} | cut -c1-2 ;)\\\" != \\\"11\\\" ] || [ \"${OLD_VERSION}\" \\> \"1.0.1\" ]; then cd /build/timescaledb \\\n && rm -fr build \\\n && git reset HEAD --hard \\\n && git fetch \\\n && git checkout ${OLD_VERSION} \\\n && ./bootstrap -DPROJECT_INSTALL_METHOD=\\\"docker\\\" \\\n && cd build \\\n && make install; fi\" > ./build_old.sh \\\n && chmod +x ./build_old.sh\n# ####\n#  Add the latest previous version to the end of the list for each new build\n# ####\nRUN OLD_VERSION=1.1.0 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.1.1 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.2.0 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.2.1 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.2.2 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.3.0 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.3.1 /build/timescaledb/build_old.sh\n#  Cleanup\nRUN echo $( pg_config --pkglibdir ;) \\\n && rm -f $( pg_config --sharedir ;)/extension/timescaledb--*--*.sql \\\n && rm -f $( pg_config --sharedir ;)/extension/timescaledb*mock*.sql \\\n && KEEP_NUM_VERSIONS=5 \\\n && rm -f $( ls -1 $( pg_config --pkglibdir ;)/timescaledb-*.so | head -n -${KEEP_NUM_VERSIONS} ;) \\\n && rm -f $( ls -1 $( pg_config --sharedir ;)/extension/timescaledb-*.sql | head -n -${KEEP_NUM_VERSIONS} ;) \\\n && cd ~ \\\n && apt-get autoremove --purge -y build-essential libssl-dev dpkg-dev gcc libc-dev make cmake \\\n && apt-get clean -y \\\n && rm -rf \"${HOME}/.cache\" /var/lib/apt/lists/* /tmp/* /var/tmp/*\n# ###########################\n#  Now build image and copy in tools\n# ###########################\nARG PG_VERSION\nFROM bitnami/postgresql:${PG_VERSION}\nARG PG_VERSION\nMAINTAINER Timescale https://www.timescale.com\nENV TIMESCALEDB_VERSION=\"1.3.2\"\nCOPY docker-entrypoint-initdb.d/* /docker-entrypoint-initdb.d/\nCOPY --from=tools /go/bin/* /usr/local/bin/\nCOPY --from=oldversions /opt/bitnami/postgresql/lib/timescaledb-*.so /usr/local/lib/postgresql/\nCOPY --from=oldversions /opt/bitnami/postgresql/share/extension/timescaledb--*.sql /usr/local/share/postgresql/extension/\nUSER 0\nRUN set -ex \\\n && mkdir -p /var/lib/apt/lists/partial \\\n && apt-get update \\\n && apt-get install build-essential libssl-dev git dpkg-dev gcc libc-dev make cmake wget -y \\\n && mkdir -p /build/ \\\n && git clone https://github.com/timescale/timescaledb /build/timescaledb \\\n && cd /build/timescaledb \\\n && rm -fr build \\\n && git checkout ${TIMESCALEDB_VERSION} \\\n && ./bootstrap -DPROJECT_INSTALL_METHOD=\"docker\" \\\n && cd build \\\n && make install \\\n && cd ~ \\\n && apt-get autoremove --purge -y build-essential libssl-dev dpkg-dev gcc libc-dev make cmake \\\n && apt-get clean -y \\\n && rm -rf \"${HOME}/.cache\" /var/lib/apt/lists/* /tmp/* /var/tmp/*\nRUN sed -r -i \"s/[#]*\\s*(shared_preload_libraries)\\s*=\\s*'(.*)'/\\1 = 'timescaledb,\\2'/;s/,'/'/\" /opt/bitnami/postgresql/share/postgresql.conf.sample\nUSER 1001\n","injectedSmells":[],"originalDockerfileHash":"0d9d6803995b0cb696b5b34ac5b3ef7d","successfullyInjectedSmells":[],"originalDockerfileUglified":"ARG PG_VERSION\n#  ###########################\n#   Build tools binaries in separate image\n#  ###########################\nARG GO_VERSION=1.12.6\nFROM golang:${GO_VERSION}-alpine AS tools\nENV TOOLS_VERSION=\"0.6.0\"\nRUN apk update \\\n && apk add --no-cache git \\\n && mkdir -p ${GOPATH}/src/github.com/timescale/ \\\n && cd ${GOPATH}/src/github.com/timescale/ \\\n && git clone https://github.com/timescale/timescaledb-tune.git \\\n && git clone https://github.com/timescale/timescaledb-parallel-copy.git \\\n && cd timescaledb-tune/cmd/timescaledb-tune \\\n && git fetch \\\n && git checkout --quiet $( git describe --abbrev=0 ;) \\\n && go get -d -v \\\n && go build -o /go/bin/timescaledb-tune \\\n && cd ${GOPATH}/src/github.com/timescale/timescaledb-parallel-copy/cmd/timescaledb-parallel-copy \\\n && git fetch \\\n && git checkout --quiet $( git describe --abbrev=0 ;) \\\n && go get -d -v \\\n && go build -o /go/bin/timescaledb-parallel-copy\n#  ###########################\n#   Build old versions in a separate stage\n#  ###########################\nARG PG_VERSION\nFROM bitnami/postgresql:${PG_VERSION} AS oldversions\nARG PG_VERSION\nUSER 0\nRUN set -ex \\\n && mkdir -p /var/lib/apt/lists/partial \\\n && apt-get update \\\n && apt-get install build-essential libssl-dev git dpkg-dev gcc libc-dev make cmake wget -y \\\n && mkdir -p /build/ \\\n && git clone https://github.com/timescale/timescaledb /build/timescaledb \\\n && cd /build/timescaledb \\\n && echo \"if [ \\\"$( echo ${PG_VERSION} | cut -c1-2 ;)\\\" != \\\"11\\\" ] || [ \"${OLD_VERSION}\" \\> \"1.0.1\" ]; then cd /build/timescaledb \\\n && rm -fr build \\\n && git reset HEAD --hard \\\n && git fetch \\\n && git checkout ${OLD_VERSION} \\\n && ./bootstrap -DPROJECT_INSTALL_METHOD=\\\"docker\\\" \\\n && cd build \\\n && make install; fi\" > ./build_old.sh \\\n && chmod +x ./build_old.sh\n#  ####\n#   Add the latest previous version to the end of the list for each new build\n#  ####\nRUN OLD_VERSION=1.1.0 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.1.1 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.2.0 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.2.1 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.2.2 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.3.0 /build/timescaledb/build_old.sh\nRUN OLD_VERSION=1.3.1 /build/timescaledb/build_old.sh\n#   Cleanup\nRUN echo $( pg_config --pkglibdir ;) \\\n && rm -f $( pg_config --sharedir ;)/extension/timescaledb--*--*.sql \\\n && rm -f $( pg_config --sharedir ;)/extension/timescaledb*mock*.sql \\\n && KEEP_NUM_VERSIONS=5 \\\n && rm -f $( ls -1 $( pg_config --pkglibdir ;)/timescaledb-*.so | head -n -${KEEP_NUM_VERSIONS} ;) \\\n && rm -f $( ls -1 $( pg_config --sharedir ;)/extension/timescaledb-*.sql | head -n -${KEEP_NUM_VERSIONS} ;) \\\n && cd ~ \\\n && apt-get autoremove --purge -y build-essential libssl-dev dpkg-dev gcc libc-dev make cmake \\\n && apt-get clean -y \\\n && rm -rf \"${HOME}/.cache\" /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#  ###########################\n#   Now build image and copy in tools\n#  ###########################\nARG PG_VERSION\nFROM bitnami/postgresql:${PG_VERSION}\nARG PG_VERSION\nMAINTAINER Timescale https://www.timescale.com\nENV TIMESCALEDB_VERSION=\"1.3.2\"\nCOPY docker-entrypoint-initdb.d/* /docker-entrypoint-initdb.d/\nCOPY --from=tools /go/bin/* /usr/local/bin/\nCOPY --from=oldversions /opt/bitnami/postgresql/lib/timescaledb-*.so /usr/local/lib/postgresql/\nCOPY --from=oldversions /opt/bitnami/postgresql/share/extension/timescaledb--*.sql /usr/local/share/postgresql/extension/\nUSER 0\nRUN set -ex \\\n && mkdir -p /var/lib/apt/lists/partial \\\n && apt-get update \\\n && apt-get install build-essential libssl-dev git dpkg-dev gcc libc-dev make cmake wget -y \\\n && mkdir -p /build/ \\\n && git clone https://github.com/timescale/timescaledb /build/timescaledb \\\n && cd /build/timescaledb \\\n && rm -fr build \\\n && git checkout ${TIMESCALEDB_VERSION} \\\n && ./bootstrap -DPROJECT_INSTALL_METHOD=\"docker\" \\\n && cd build \\\n && make install \\\n && cd ~ \\\n && apt-get autoremove --purge -y build-essential libssl-dev dpkg-dev gcc libc-dev make cmake \\\n && apt-get clean -y \\\n && rm -rf \"${HOME}/.cache\" /var/lib/apt/lists/* /tmp/* /var/tmp/*\nRUN sed -r -i \"s/[#]*\\s*(shared_preload_libraries)\\s*=\\s*'(.*)'/\\1 = 'timescaledb,\\2'/;s/,'/'/\" /opt/bitnami/postgresql/share/postgresql.conf.sample\nUSER 1001\n","originalDockerfileUglifiedHash":"8d2ac363ca8514d78c282581299e2e08","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/2647aa3cf7265509ac76a097f97dc1819f3f0481.dockerfile"}