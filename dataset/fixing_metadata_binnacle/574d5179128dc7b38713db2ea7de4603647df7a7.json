{"seed":1311477941,"processedDockerfileHash":"c241a40948b85971b83f215d7e7ca94f","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","have-a-healthcheck","have-a-user"],"processedDockerfile":"#\n#   Yahoo! Open NSFW Web Service\n#   Not Suitable for Work (NSFW) classification using deep neural network Caffe models\n#   Adapted from https://github.com/loretoparisi/nsfwaas\n#   @see https://github.com/loretoparisi/nsfwaas\n#   @see https://github.com/yahoo/open_nsfw\n#\n#   Copyright (c) 2018 Loreto Parisi - https://github.com/loretoparisi/docker\n#\nFROM ubuntu:16.04\n#   To build for GPU\n#   FROM nvidia/cuda:8.0-cudnn6-devel-ubuntu16.04\nMAINTAINER Loreto Parisi loretoparisi@gmail.com\n#   Based on CAFFE's CPU container\nRUN apt-get update \\\n && apt-get install --no-install-recommends build-essential=12.1ubuntu2 cmake=3.5.1-1ubuntu3 git=1:2.7.4-0ubuntu1.10 wget=1.17.1-1ubuntu1.5 libatlas-base-dev=3.10.2-9 libboost-all-dev=1.58.0.1ubuntu1 libgflags-dev=2.1.2-3 libgoogle-glog-dev=0.3.4-0.1 libhdf5-serial-dev=1.8.16+docs-4ubuntu1.1 libleveldb-dev=1.18-5 liblmdb-dev=0.9.17-3 libopencv-dev=2.4.9.1+dfsg-1.5ubuntu1.1 libprotobuf-dev=2.6.1-1.3 libsnappy-dev=1.1.3-2 protobuf-compiler=2.6.1-1.3 python-dev=2.7.12-1~16.04 python-setuptools=20.7.0-1 python-numpy=1:1.11.0-1ubuntu1 python-pip=8.1.1-2ubuntu0.6 python-scipy=0.17.0-1 cython=0.23.4-0ubuntu5 python-skimage=0.10.1-2build1 python-matplotlib=1.5.1-1ubuntu1 ipython=2.4.1-1 python-h5py=2.6.0-1 python-leveldb=0~svn68-2build4 python-networkx=1.11-1ubuntu1 python-nose=1.3.7-1 python-pandas=0.17.1-3ubuntu2 python-dateutil=2.4.2-1 python-protobuf=2.6.1-1.3 python-gflags=1.5.1-2 python-yaml=3.11-3build1 python-pil=3.1.2-0ubuntu1.6 python-six=1.10.0-3 python-flask=0.10.1-2ubuntu0.1 python-tornado=4.2.1-1ubuntu3.1 apache2=2.4.18-2ubuntu3.17 libapache2-mod-wsgi=4.3.0-1.1ubuntu1 supervisor=3.2.0-2ubuntu0.2 -y \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#   Build Caffe\nENV CAFFE_ROOT=\"/opt/caffe\"\nWORKDIR $CAFFE_ROOT\n#   FIXME: clone a specific git tag and use ARG instead of ENV once DockerHub supports this.\nENV CLONE_TAG=\"master\"\nRUN pip install pip==23.1 --upgrade\nRUN git clone -b ${CLONE_TAG} --depth 1 https://github.com/BVLC/caffe.git . \\\n && for req in $( cat python/requirements.txt ;) pydot; do pip install $req ; done \\\n && mkdir build \\\n && cd build \\\n && cmake -DCPU_ONLY=1 .. \\\n && make -j\"$( nproc ;)\"\nENV PYCAFFE_ROOT=\"$CAFFE_ROOT/python\"\nENV PYTHONPATH=\"$PYCAFFE_ROOT:$PYTHONPATH\"\nENV PATH=\"$CAFFE_ROOT/build/tools:$PYCAFFE_ROOT:$PATH\"\nRUN echo \"$CAFFE_ROOT/build/lib\" >> /etc/ld.so.conf.d/caffe.conf \\\n && ldconfig\n#   Web Server config\nARG PORT\nARG DIST\nENV PORT=\"$PORT\"\nENV DIST=\"$DIST\"\nWORKDIR /workspace\n#   Copy the model and deploy the app server\n#  RUN git clone https://github.com/yahoo/open_nsfw.git\nCOPY open_nsfw /workspace/open_nsfw\nCOPY nsfwnet.py /workspace/\nCOPY nsfwaas.py /workspace/\n#   Set up Apache\nRUN a2enmod wsgi\nRUN a2dissite 000*\n#   copy virtual host and replace port\nCOPY nsfwaas.conf /workspace/nsfwaas.conf\nRUN sed \"s/$PORT/$PORT/g\" /workspace/nsfwaas.conf > /etc/apache2/sites-available/nsfwaas.conf\nRUN sed -i \"s/80/$PORT/g\" /etc/apache2/ports.conf\nCOPY config.py /workspace/\nRUN a2ensite nsfwaas\n#   Configure supervisord\nRUN mkdir -p /var/lock/apache2 /var/run/apache2 /var/log/supervisor\nCOPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf\n#   Expose the webserver\nEXPOSE $PORT\n#   Start supervisord\nCMD [\"/usr/bin/supervisord\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#\n#  Yahoo! Open NSFW Web Service\n#  Not Suitable for Work (NSFW) classification using deep neural network Caffe models\n#  Adapted from https://github.com/loretoparisi/nsfwaas\n#  @see https://github.com/loretoparisi/nsfwaas\n#  @see https://github.com/yahoo/open_nsfw\n#\n#  Copyright (c) 2018 Loreto Parisi - https://github.com/loretoparisi/docker\n#\nFROM ubuntu:16.04\n#  To build for GPU\n#  FROM nvidia/cuda:8.0-cudnn6-devel-ubuntu16.04\nMAINTAINER Loreto Parisi loretoparisi@gmail.com\n#  Based on CAFFE's CPU container\nRUN apt-get update \\\n && apt-get install --no-install-recommends build-essential cmake git wget libatlas-base-dev libboost-all-dev libgflags-dev libgoogle-glog-dev libhdf5-serial-dev libleveldb-dev liblmdb-dev libopencv-dev libprotobuf-dev libsnappy-dev protobuf-compiler python-dev python-setuptools python-numpy python-pip python-scipy cython python-skimage python-matplotlib ipython python-h5py python-leveldb python-networkx python-nose python-pandas python-dateutil python-protobuf python-gflags python-yaml python-pil python-six python-flask python-tornado apache2 libapache2-mod-wsgi supervisor -y \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#  Build Caffe\nENV CAFFE_ROOT=\"/opt/caffe\"\nWORKDIR $CAFFE_ROOT\n#  FIXME: clone a specific git tag and use ARG instead of ENV once DockerHub supports this.\nENV CLONE_TAG=\"master\"\nRUN pip install pip --upgrade\nRUN git clone -b ${CLONE_TAG} --depth 1 https://github.com/BVLC/caffe.git . \\\n && for req in $( cat python/requirements.txt ;) pydot; do pip install $req ; done \\\n && mkdir build \\\n && cd build \\\n && cmake -DCPU_ONLY=1 .. \\\n && make -j\"$( nproc ;)\"\nENV PYCAFFE_ROOT=\"$CAFFE_ROOT/python\"\nENV PYTHONPATH=\"$PYCAFFE_ROOT:$PYTHONPATH\"\nENV PATH=\"$CAFFE_ROOT/build/tools:$PYCAFFE_ROOT:$PATH\"\nRUN echo \"$CAFFE_ROOT/build/lib\" >> /etc/ld.so.conf.d/caffe.conf \\\n && ldconfig\n#  Web Server config\nARG PORT\nARG DIST\nENV PORT=\"$PORT\"\nENV DIST=\"$DIST\"\nWORKDIR /workspace\n#  Copy the model and deploy the app server\n# RUN git clone https://github.com/yahoo/open_nsfw.git\nCOPY open_nsfw /workspace/open_nsfw\nCOPY nsfwnet.py /workspace/\nCOPY nsfwaas.py /workspace/\n#  Set up Apache\nRUN a2enmod wsgi\nRUN a2dissite 000*\n#  copy virtual host and replace port\nCOPY nsfwaas.conf /workspace/nsfwaas.conf\nRUN sed \"s/$PORT/$PORT/g\" /workspace/nsfwaas.conf > /etc/apache2/sites-available/nsfwaas.conf\nRUN sed -i \"s/80/$PORT/g\" /etc/apache2/ports.conf\nCOPY config.py /workspace/\nRUN a2ensite nsfwaas\n#  Configure supervisord\nRUN mkdir -p /var/lock/apache2 /var/run/apache2 /var/log/supervisor\nCOPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf\n#  Expose the webserver\nEXPOSE $PORT\n#  Start supervisord\nCMD [\"/usr/bin/supervisord\"]\n","injectedSmells":[],"originalDockerfileHash":"08424ef8898bb6ebe1d3e9184e2b90b5","successfullyInjectedSmells":[],"originalDockerfileUglified":"#\n#   Yahoo! Open NSFW Web Service\n#   Not Suitable for Work (NSFW) classification using deep neural network Caffe models\n#   Adapted from https://github.com/loretoparisi/nsfwaas\n#   @see https://github.com/loretoparisi/nsfwaas\n#   @see https://github.com/yahoo/open_nsfw\n#\n#   Copyright (c) 2018 Loreto Parisi - https://github.com/loretoparisi/docker\n#\nFROM ubuntu:16.04\n#   To build for GPU\n#   FROM nvidia/cuda:8.0-cudnn6-devel-ubuntu16.04\nMAINTAINER Loreto Parisi loretoparisi@gmail.com\n#   Based on CAFFE's CPU container\nRUN apt-get update \\\n && apt-get install --no-install-recommends build-essential cmake git wget libatlas-base-dev libboost-all-dev libgflags-dev libgoogle-glog-dev libhdf5-serial-dev libleveldb-dev liblmdb-dev libopencv-dev libprotobuf-dev libsnappy-dev protobuf-compiler python-dev python-setuptools python-numpy python-pip python-scipy cython python-skimage python-matplotlib ipython python-h5py python-leveldb python-networkx python-nose python-pandas python-dateutil python-protobuf python-gflags python-yaml python-pil python-six python-flask python-tornado apache2 libapache2-mod-wsgi supervisor -y \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#   Build Caffe\nENV CAFFE_ROOT=\"/opt/caffe\"\nWORKDIR $CAFFE_ROOT\n#   FIXME: clone a specific git tag and use ARG instead of ENV once DockerHub supports this.\nENV CLONE_TAG=\"master\"\nRUN pip install pip --upgrade\nRUN git clone -b ${CLONE_TAG} --depth 1 https://github.com/BVLC/caffe.git . \\\n && for req in $( cat python/requirements.txt ;) pydot; do pip install $req ; done \\\n && mkdir build \\\n && cd build \\\n && cmake -DCPU_ONLY=1 .. \\\n && make -j\"$( nproc ;)\"\nENV PYCAFFE_ROOT=\"$CAFFE_ROOT/python\"\nENV PYTHONPATH=\"$PYCAFFE_ROOT:$PYTHONPATH\"\nENV PATH=\"$CAFFE_ROOT/build/tools:$PYCAFFE_ROOT:$PATH\"\nRUN echo \"$CAFFE_ROOT/build/lib\" >> /etc/ld.so.conf.d/caffe.conf \\\n && ldconfig\n#   Web Server config\nARG PORT\nARG DIST\nENV PORT=\"$PORT\"\nENV DIST=\"$DIST\"\nWORKDIR /workspace\n#   Copy the model and deploy the app server\n#  RUN git clone https://github.com/yahoo/open_nsfw.git\nCOPY open_nsfw /workspace/open_nsfw\nCOPY nsfwnet.py /workspace/\nCOPY nsfwaas.py /workspace/\n#   Set up Apache\nRUN a2enmod wsgi\nRUN a2dissite 000*\n#   copy virtual host and replace port\nCOPY nsfwaas.conf /workspace/nsfwaas.conf\nRUN sed \"s/$PORT/$PORT/g\" /workspace/nsfwaas.conf > /etc/apache2/sites-available/nsfwaas.conf\nRUN sed -i \"s/80/$PORT/g\" /etc/apache2/ports.conf\nCOPY config.py /workspace/\nRUN a2ensite nsfwaas\n#   Configure supervisord\nRUN mkdir -p /var/lock/apache2 /var/run/apache2 /var/log/supervisor\nCOPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf\n#   Expose the webserver\nEXPOSE $PORT\n#   Start supervisord\nCMD [\"/usr/bin/supervisord\"]\n","originalDockerfileUglifiedHash":"477a06ee71e4e4368bc38caaff4640c2","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/574d5179128dc7b38713db2ea7de4603647df7a7.dockerfile"}