{"seed":1737590231,"processedDockerfileHash":"8adba307c80f28c281f47a6e096b6b7a","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM ruby:2.6.3-alpine AS builder\nENV PREFIX=\"/usr/local\"\n#   Runtime dependencies\nRUN apk add cairo=1.16.0-r3 freetype=2.10.0-r1 fribidi=1.0.5-r2 glib=2.60.4-r0 graphite2=1.3.13-r1 icu-libs=64.2-r1 libbz2=1.0.6-r7 libgcc=8.3.0-r0 libltdl=2.4.6-r6 libgomp=8.3.0-r0 pngquant=2.12.3-r0 sudo=1.9.5p2-r0 tini=0.18.0-r0\n#   Build dependencies\nRUN apk add autoconf=2.69-r2 automake=1.16.1-r0 build-base=0.5-r1 bzip2-dev=1.0.6-r7 cairo-dev=1.16.0-r3 fribidi-dev=1.0.5-r2 freetype-dev=2.10.0-r1 ghostscript-dev=9.27-r5 glib-dev=2.60.4-r0 gobject-introspection-dev=1.60.2-r0 graphite2-dev=1.3.13-r1 icu-dev=64.2-r1 libtool=2.4.6-r6\nENV JEMALLOC_VERSION=\"3.6.0\"\nRUN mkdir /tmp/jemalloc \\\n && cd /tmp/jemalloc \\\n && wget -O jemalloc.tar.bz2 https://github.com/jemalloc/jemalloc/releases/download/$JEMALLOC_VERSION/jemalloc-$JEMALLOC_VERSION.tar.bz2 \\\n && tar xjf jemalloc.tar.bz2 \\\n && cd jemalloc-$JEMALLOC_VERSION \\\n && ./configure \\\n && make -j \\\n && mv lib/libjemalloc.so.1 /usr/lib \\\n && rm -rf /tmp/jemalloc\nENV HARFBUZZ_VERSION=\"2.4.0\"\nRUN mkdir /tmp/harfbuzz \\\n && cd /tmp/harfbuzz \\\n && wget -O harfbuzz.tar.bz2 https://www.freedesktop.org/software/harfbuzz/release/harfbuzz-$HARFBUZZ_VERSION.tar.bz2 \\\n && tar xjf harfbuzz.tar.bz2 \\\n && cd harfbuzz-$HARFBUZZ_VERSION \\\n && ./configure --prefix=$PREFIX --with-glib --with-gobject --with-graphite2 --with-icu \\\n && make -j all \\\n && make -j install \\\n && rm -rf /tmp/harfbuzz\nENV RAQM_VERSION=\"0.5.0\"\nRUN mkdir /tmp/raqm \\\n && cd /tmp/raqm \\\n && wget -O raqm.tar.gz https://github.com/HOST-Oman/libraqm/releases/download/v$RAQM_VERSION/raqm-$RAQM_VERSION.tar.gz \\\n && tar xzf raqm.tar.gz \\\n && cd raqm-$RAQM_VERSION \\\n && ./configure --prefix=$PREFIX \\\n && make -j all \\\n && make -j install \\\n && rm -rf /tmp/raqm\nENV LIBPNG_VERSION=\"1.6.37\"\nRUN mkdir /tmp/libpng \\\n && cd /tmp/libpng \\\n && wget -O libpng.tar.gz https://prdownloads.sourceforge.net/libpng/libpng-$LIBPNG_VERSION.tar.gz?downlolad \\\n && tar xzf libpng.tar.gz \\\n && cd libpng-$LIBPNG_VERSION \\\n && ./configure --prefix=$PREFIX \\\n && make -j all \\\n && make -j install \\\n && rm -rf /tmp/libpng\nENV IMAGE_MAGICK_VERSION=\"7.0.8-42\"\nRUN mkdir /tmp/imagemagick \\\n && cd /tmp/imagemagick \\\n && wget -O ImageMagick.tar.gz https://github.com/ImageMagick/ImageMagick/archive/$IMAGE_MAGICK_VERSION.tar.gz \\\n && tar xzf ImageMagick.tar.gz \\\n && cd ImageMagick-${IMAGE_MAGICK_VERSION} \\\n && ./configure --prefix=$PREFIX --enable-static --enable-bounds-checking --enable-hugepages --with-modules --without-magick-plus-plus \\\n && make -j all \\\n && make -j install \\\n && rm -rf /tmp/imagemagick\nCOPY policy.xml /usr/local/etc/ImageMagick-7/\nCOPY Gemfile /var/www/letter-avatars/Gemfile\nCOPY Gemfile.lock /var/www/letter-avatars/Gemfile.lock\nCOPY fonts/Roboto-Medium /var/www/letter-avatars/Roboto-Medium\nCOPY fonts/NotoSansDisplay-Medium.ttf /var/www/letter-avatars/NotoSansDisplay-Medium.ttf\nCOPY fonts/NotoSansMono-Medium.ttf /var/www/letter-avatars/NotoSansMono-Medium.ttf\nCOPY fonts/NotoSansMonoCJKsc-Regular.otf /var/www/letter-avatars/NotoSansMonoCJKsc-Regular.otf\nCOPY fonts/NotoSansArabic-Medium.ttf /var/www/letter-avatars/NotoSansArabic-Medium.ttf\nCOPY fonts/NotoSansDevanagari-Medium.ttf /var/www/letter-avatars/NotoSansDevanagari-Medium.ttf\nCOPY fonts/NotoSansBengali-Medium.ttf /var/www/letter-avatars/NotoSansBengali-Medium.ttf\nCOPY fonts/NotoSansJavanese-Regular.ttf /var/www/letter-avatars/NotoSansJavanese-Regular.ttf\nCOPY fonts/NotoSansTelugu-Regular.ttf /var/www/letter-avatars/NotoSansTelugu-Regular.ttf\nCOPY fonts/NotoSansThai-Medium.ttf /var/www/letter-avatars/NotoSansThai-Medium.ttf\nCOPY fonts/NotoSansHebrew-Medium.ttf /var/www/letter-avatars/NotoSansHebrew-Medium.ttf\nCOPY fonts/NotoSansArmenian-Medium.ttf /var/www/letter-avatars/NotoSansArmenian-Medium.ttf\nRUN adduser -s /bin/bash -u 9001 -D web \\\n && cd /var/www/letter-avatars \\\n && chown -R web . \\\n && sudo -E -u web bundle install --deployment --verbose\nRUN apk del autoconf automake build-base bzip2-dev cairo-dev fribidi-dev freetype-dev ghostscript-dev glib-dev gobject-introspection-dev graphite2-dev icu-dev libtool \\\n && rm -rf /var/cache/apk/*\nFROM builder\nCOPY config.ru /var/www/letter-avatars/config.ru\nCOPY lib /var/www/letter-avatars/lib\nCOPY unicorn.conf.rb /var/www/letter-avatars/unicorn.conf.rb\nENTRYPOINT [\"/sbin/tini\", \"--\", \"sudo\", \"-E\", \"-u\", \"web\", \"/bin/sh\", \"-c\", \"cd\", \"/var/www/letter-avatars\", \"&&\", \"exec\", \"bundle\", \"exec\", \"unicorn\", \"-E\", \"production\", \"-c\", \"/var/www/letter-avatars/unicorn.conf.rb\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ruby:2.6.3-alpine AS builder\nENV PREFIX=\"/usr/local\"\n#  Runtime dependencies\nRUN apk add cairo freetype fribidi glib graphite2 icu-libs libbz2 libgcc libltdl libgomp pngquant sudo tini\n#  Build dependencies\nRUN apk add autoconf automake build-base bzip2-dev cairo-dev fribidi-dev freetype-dev ghostscript-dev glib-dev gobject-introspection-dev graphite2-dev icu-dev libtool\nENV JEMALLOC_VERSION=\"3.6.0\"\nRUN mkdir /tmp/jemalloc \\\n && cd /tmp/jemalloc \\\n && wget -O jemalloc.tar.bz2 https://github.com/jemalloc/jemalloc/releases/download/$JEMALLOC_VERSION/jemalloc-$JEMALLOC_VERSION.tar.bz2 \\\n && tar xjf jemalloc.tar.bz2 \\\n && cd jemalloc-$JEMALLOC_VERSION \\\n && ./configure \\\n && make -j \\\n && mv lib/libjemalloc.so.1 /usr/lib \\\n && rm -rf /tmp/jemalloc\nENV HARFBUZZ_VERSION=\"2.4.0\"\nRUN mkdir /tmp/harfbuzz \\\n && cd /tmp/harfbuzz \\\n && wget -O harfbuzz.tar.bz2 https://www.freedesktop.org/software/harfbuzz/release/harfbuzz-$HARFBUZZ_VERSION.tar.bz2 \\\n && tar xjf harfbuzz.tar.bz2 \\\n && cd harfbuzz-$HARFBUZZ_VERSION \\\n && ./configure --prefix=$PREFIX --with-glib --with-gobject --with-graphite2 --with-icu \\\n && make -j all \\\n && make -j install \\\n && rm -rf /tmp/harfbuzz\nENV RAQM_VERSION=\"0.5.0\"\nRUN mkdir /tmp/raqm \\\n && cd /tmp/raqm \\\n && wget -O raqm.tar.gz https://github.com/HOST-Oman/libraqm/releases/download/v$RAQM_VERSION/raqm-$RAQM_VERSION.tar.gz \\\n && tar xzf raqm.tar.gz \\\n && cd raqm-$RAQM_VERSION \\\n && ./configure --prefix=$PREFIX \\\n && make -j all \\\n && make -j install \\\n && rm -rf /tmp/raqm\nENV LIBPNG_VERSION=\"1.6.37\"\nRUN mkdir /tmp/libpng \\\n && cd /tmp/libpng \\\n && wget -O libpng.tar.gz https://prdownloads.sourceforge.net/libpng/libpng-$LIBPNG_VERSION.tar.gz?downlolad \\\n && tar xzf libpng.tar.gz \\\n && cd libpng-$LIBPNG_VERSION \\\n && ./configure --prefix=$PREFIX \\\n && make -j all \\\n && make -j install \\\n && rm -rf /tmp/libpng\nENV IMAGE_MAGICK_VERSION=\"7.0.8-42\"\nRUN mkdir /tmp/imagemagick \\\n && cd /tmp/imagemagick \\\n && wget -O ImageMagick.tar.gz https://github.com/ImageMagick/ImageMagick/archive/$IMAGE_MAGICK_VERSION.tar.gz \\\n && tar xzf ImageMagick.tar.gz \\\n && cd ImageMagick-${IMAGE_MAGICK_VERSION} \\\n && ./configure --prefix=$PREFIX --enable-static --enable-bounds-checking --enable-hugepages --with-modules --without-magick-plus-plus \\\n && make -j all \\\n && make -j install \\\n && rm -rf /tmp/imagemagick\nADD policy.xml /usr/local/etc/ImageMagick-7/\nADD Gemfile /var/www/letter-avatars/Gemfile\nADD Gemfile.lock /var/www/letter-avatars/Gemfile.lock\nADD fonts/Roboto-Medium /var/www/letter-avatars/Roboto-Medium\nADD fonts/NotoSansDisplay-Medium.ttf /var/www/letter-avatars/NotoSansDisplay-Medium.ttf\nADD fonts/NotoSansMono-Medium.ttf /var/www/letter-avatars/NotoSansMono-Medium.ttf\nADD fonts/NotoSansMonoCJKsc-Regular.otf /var/www/letter-avatars/NotoSansMonoCJKsc-Regular.otf\nADD fonts/NotoSansArabic-Medium.ttf /var/www/letter-avatars/NotoSansArabic-Medium.ttf\nADD fonts/NotoSansDevanagari-Medium.ttf /var/www/letter-avatars/NotoSansDevanagari-Medium.ttf\nADD fonts/NotoSansBengali-Medium.ttf /var/www/letter-avatars/NotoSansBengali-Medium.ttf\nADD fonts/NotoSansJavanese-Regular.ttf /var/www/letter-avatars/NotoSansJavanese-Regular.ttf\nADD fonts/NotoSansTelugu-Regular.ttf /var/www/letter-avatars/NotoSansTelugu-Regular.ttf\nADD fonts/NotoSansThai-Medium.ttf /var/www/letter-avatars/NotoSansThai-Medium.ttf\nADD fonts/NotoSansHebrew-Medium.ttf /var/www/letter-avatars/NotoSansHebrew-Medium.ttf\nADD fonts/NotoSansArmenian-Medium.ttf /var/www/letter-avatars/NotoSansArmenian-Medium.ttf\nRUN adduser -s /bin/bash -u 9001 -D web \\\n && cd /var/www/letter-avatars \\\n && chown -R web . \\\n && sudo -E -u web bundle install --deployment --verbose\nRUN apk del autoconf automake build-base bzip2-dev cairo-dev fribidi-dev freetype-dev ghostscript-dev glib-dev gobject-introspection-dev graphite2-dev icu-dev libtool \\\n && rm -rf /var/cache/apk/*\nFROM builder\nADD config.ru /var/www/letter-avatars/config.ru\nADD lib /var/www/letter-avatars/lib\nADD unicorn.conf.rb /var/www/letter-avatars/unicorn.conf.rb\nENTRYPOINT [\"/sbin/tini\", \"--\", \"sudo\", \"-E\", \"-u\", \"web\", \"/bin/sh\", \"-c\", \"cd\", \"/var/www/letter-avatars\", \"&&\", \"exec\", \"bundle\", \"exec\", \"unicorn\", \"-E\", \"production\", \"-c\", \"/var/www/letter-avatars/unicorn.conf.rb\"]\n","injectedSmells":[],"originalDockerfileHash":"e79da64406a35507f3b1414b679185d7","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ruby:2.6.3-alpine AS builder\nENV PREFIX=\"/usr/local\"\n#   Runtime dependencies\nRUN apk add cairo freetype fribidi glib graphite2 icu-libs libbz2 libgcc libltdl libgomp pngquant sudo tini\n#   Build dependencies\nRUN apk add autoconf automake build-base bzip2-dev cairo-dev fribidi-dev freetype-dev ghostscript-dev glib-dev gobject-introspection-dev graphite2-dev icu-dev libtool\nENV JEMALLOC_VERSION=\"3.6.0\"\nRUN mkdir /tmp/jemalloc \\\n && cd /tmp/jemalloc \\\n && wget -O jemalloc.tar.bz2 https://github.com/jemalloc/jemalloc/releases/download/$JEMALLOC_VERSION/jemalloc-$JEMALLOC_VERSION.tar.bz2 \\\n && tar xjf jemalloc.tar.bz2 \\\n && cd jemalloc-$JEMALLOC_VERSION \\\n && ./configure \\\n && make -j \\\n && mv lib/libjemalloc.so.1 /usr/lib \\\n && rm -rf /tmp/jemalloc\nENV HARFBUZZ_VERSION=\"2.4.0\"\nRUN mkdir /tmp/harfbuzz \\\n && cd /tmp/harfbuzz \\\n && wget -O harfbuzz.tar.bz2 https://www.freedesktop.org/software/harfbuzz/release/harfbuzz-$HARFBUZZ_VERSION.tar.bz2 \\\n && tar xjf harfbuzz.tar.bz2 \\\n && cd harfbuzz-$HARFBUZZ_VERSION \\\n && ./configure --prefix=$PREFIX --with-glib --with-gobject --with-graphite2 --with-icu \\\n && make -j all \\\n && make -j install \\\n && rm -rf /tmp/harfbuzz\nENV RAQM_VERSION=\"0.5.0\"\nRUN mkdir /tmp/raqm \\\n && cd /tmp/raqm \\\n && wget -O raqm.tar.gz https://github.com/HOST-Oman/libraqm/releases/download/v$RAQM_VERSION/raqm-$RAQM_VERSION.tar.gz \\\n && tar xzf raqm.tar.gz \\\n && cd raqm-$RAQM_VERSION \\\n && ./configure --prefix=$PREFIX \\\n && make -j all \\\n && make -j install \\\n && rm -rf /tmp/raqm\nENV LIBPNG_VERSION=\"1.6.37\"\nRUN mkdir /tmp/libpng \\\n && cd /tmp/libpng \\\n && wget -O libpng.tar.gz https://prdownloads.sourceforge.net/libpng/libpng-$LIBPNG_VERSION.tar.gz?downlolad \\\n && tar xzf libpng.tar.gz \\\n && cd libpng-$LIBPNG_VERSION \\\n && ./configure --prefix=$PREFIX \\\n && make -j all \\\n && make -j install \\\n && rm -rf /tmp/libpng\nENV IMAGE_MAGICK_VERSION=\"7.0.8-42\"\nRUN mkdir /tmp/imagemagick \\\n && cd /tmp/imagemagick \\\n && wget -O ImageMagick.tar.gz https://github.com/ImageMagick/ImageMagick/archive/$IMAGE_MAGICK_VERSION.tar.gz \\\n && tar xzf ImageMagick.tar.gz \\\n && cd ImageMagick-${IMAGE_MAGICK_VERSION} \\\n && ./configure --prefix=$PREFIX --enable-static --enable-bounds-checking --enable-hugepages --with-modules --without-magick-plus-plus \\\n && make -j all \\\n && make -j install \\\n && rm -rf /tmp/imagemagick\nADD policy.xml /usr/local/etc/ImageMagick-7/\nADD Gemfile /var/www/letter-avatars/Gemfile\nADD Gemfile.lock /var/www/letter-avatars/Gemfile.lock\nADD fonts/Roboto-Medium /var/www/letter-avatars/Roboto-Medium\nADD fonts/NotoSansDisplay-Medium.ttf /var/www/letter-avatars/NotoSansDisplay-Medium.ttf\nADD fonts/NotoSansMono-Medium.ttf /var/www/letter-avatars/NotoSansMono-Medium.ttf\nADD fonts/NotoSansMonoCJKsc-Regular.otf /var/www/letter-avatars/NotoSansMonoCJKsc-Regular.otf\nADD fonts/NotoSansArabic-Medium.ttf /var/www/letter-avatars/NotoSansArabic-Medium.ttf\nADD fonts/NotoSansDevanagari-Medium.ttf /var/www/letter-avatars/NotoSansDevanagari-Medium.ttf\nADD fonts/NotoSansBengali-Medium.ttf /var/www/letter-avatars/NotoSansBengali-Medium.ttf\nADD fonts/NotoSansJavanese-Regular.ttf /var/www/letter-avatars/NotoSansJavanese-Regular.ttf\nADD fonts/NotoSansTelugu-Regular.ttf /var/www/letter-avatars/NotoSansTelugu-Regular.ttf\nADD fonts/NotoSansThai-Medium.ttf /var/www/letter-avatars/NotoSansThai-Medium.ttf\nADD fonts/NotoSansHebrew-Medium.ttf /var/www/letter-avatars/NotoSansHebrew-Medium.ttf\nADD fonts/NotoSansArmenian-Medium.ttf /var/www/letter-avatars/NotoSansArmenian-Medium.ttf\nRUN adduser -s /bin/bash -u 9001 -D web \\\n && cd /var/www/letter-avatars \\\n && chown -R web . \\\n && sudo -E -u web bundle install --deployment --verbose\nRUN apk del autoconf automake build-base bzip2-dev cairo-dev fribidi-dev freetype-dev ghostscript-dev glib-dev gobject-introspection-dev graphite2-dev icu-dev libtool \\\n && rm -rf /var/cache/apk/*\nFROM builder\nADD config.ru /var/www/letter-avatars/config.ru\nADD lib /var/www/letter-avatars/lib\nADD unicorn.conf.rb /var/www/letter-avatars/unicorn.conf.rb\nENTRYPOINT [\"/sbin/tini\", \"--\", \"sudo\", \"-E\", \"-u\", \"web\", \"/bin/sh\", \"-c\", \"cd\", \"/var/www/letter-avatars\", \"&&\", \"exec\", \"bundle\", \"exec\", \"unicorn\", \"-E\", \"production\", \"-c\", \"/var/www/letter-avatars/unicorn.conf.rb\"]\n","originalDockerfileUglifiedHash":"2ab63e9a5ce73ecc55e908a040aac99c","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/2be20ee0fe27565da5b613fc8453ebcc5b4d662d.dockerfile"}