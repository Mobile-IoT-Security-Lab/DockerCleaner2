{"seed":3822428380,"processedDockerfileHash":"82121b79f75080910fdeda04d57b4194","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","have-a-healthcheck","have-a-user"],"processedDockerfile":"#  ####################\n#    Building Stage   #\n#  ####################\nFROM gitlab/gitlab-ce:{IMAGE_TAG} AS builder\nENV GITLAB_DIR=\"/opt/gitlab/embedded/service/gitlab-rails\"\nENV GITLAB_GIT_ZH=\"https://gitlab.com/xhang/gitlab.git\"\n#   Reference:\n#   * https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/config/software/gitlab-rails.rb\n#   * https://gitlab.com/gitlab-org/gitlab-ce/blob/master/.gitlab-ci.yml\nRUN set -xe \\\n && echo \" # Preparing ...\" \\\n && export DEBIAN_FRONTEND=noninteractive \\\n && export SSL_CERT_DIR=/etc/ssl/certs/ \\\n && export GIT_SSL_CAPATH=/etc/ssl/certs/ \\\n && curl -sL https://deb.nodesource.com/setup_8.x | bash - \\\n && curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \\\n && echo \"deb https://dl.yarnpkg.com/debian/ stable main\" | tee /etc/apt/sources.list.d/yarn.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends lsb-release patch nodejs python build-essential yarn cmake -yqq\nRUN set -xe \\\n && echo \" # Generating translation patch ...\" \\\n && cd /tmp \\\n && git clone ${GITLAB_GIT_ZH} gitlab \\\n && cd gitlab \\\n && export IGNORE_DIRS=':!qa :!spec :!features :!.gitignore :!.gitlab :!locale :!app/assets/ :!vendor/assets/' \\\n && git diff --diff-filter=d {COMMIT_UPSTREAM}..{COMMIT_ZH} -- . ${IGNORE_DIRS} > ../zh_CN.diff \\\n && echo \" # Patching ...\" \\\n && patch -d ${GITLAB_DIR} -p1 < ../zh_CN.diff \\\n && echo \" # Copy assets files ...\" \\\n && git checkout {COMMIT_ZH} \\\n && cp -R locale ${GITLAB_DIR}/ \\\n && mkdir -p ${GITLAB_DIR}/app \\\n && cp -R app/assets ${GITLAB_DIR}/app/ \\\n && mkdir -p ${GITLAB_DIR}/vendor \\\n && cp -R vendor/assets ${GITLAB_DIR}/vendor/\nRUN set -xe \\\n && echo \" # Regenerating the assets\" \\\n && cd ${GITLAB_DIR} \\\n && cp config/gitlab.yml.example config/gitlab.yml \\\n && cp config/database.yml.postgresql config/database.yml \\\n && cp config/secrets.yml.example config/secrets.yml \\\n && rm -rf public/assets \\\n && export NODE_ENV=production \\\n && export RAILS_ENV=production \\\n && export SETUP_DB=false \\\n && export USE_DB=false \\\n && export SKIP_STORAGE_VALIDATION=true \\\n && export WEBPACK_REPORT=true \\\n && export NO_COMPRESSION=true \\\n && export NO_PRIVILEGE_DROP=true \\\n && export NODE_OPTIONS=--max-old-space-size=4086 \\\n && yarn install --frozen-lockfile \\\n && bin/bundle install --frozen \\\n && bin/rake gettext:compile \\\n && bin/rake gitlab:assets:compile\nRUN set -xe \\\n && echo \" # Cleaning ...\" \\\n && yarn cache clean \\\n && rm -rf log tmp config/gitlab.yml config/database.yml config/secrets.yml .secret .gitlab_shell_secret .gitlab_workhorse_secret app/assets node_modules \\\n && find /usr/lib/ -name __pycache__ | xargs rm -rf \\\n && rm -rf /tmp/gitlab /tmp/*.diff /root/.cache /var/lib/apt/lists/*\n#  #####################\n#    Production Stage  #\n#  #####################\nFROM gitlab/gitlab-ce:{IMAGE_TAG} AS production\nRUN set -xe \\\n && export DEBIAN_FRONTEND=noninteractive \\\n && apt-get update \\\n && apt-get install --no-install-recommends locales tzdata -yqq \\\n && locale-gen en_US.UTF-8 \\\n && rm -rf /var/lib/apt/lists/*\nENV LANG=\"en_US.UTF-8\" \\\n    LANGUAGE=\"en_US:en\" \\\n    LC_ALL=\"en_US.UTF-8\"\nENV TZ=\"Asia/Shanghai\"\nENV GITLAB_VERSION=\"{COMMIT_UPSTREAM}\"\nENV GITLAB_DIR=\"/opt/gitlab/embedded/service/gitlab-rails\"\nENV GITLAB_GIT_ZH=\"https://gitlab.com/xhang/gitlab.git\"\nENV GITLAB_GIT_COMMIT_UPSTREAM=\"{COMMIT_UPSTREAM}\"\nENV GITLAB_GIT_COMMIT_ZH=\"{COMMIT_ZH}\"\nCOPY --from=builder ${GITLAB_DIR}/app ${GITLAB_DIR}/app\nCOPY --from=builder ${GITLAB_DIR}/public ${GITLAB_DIR}/public\nCOPY --from=builder ${GITLAB_DIR}/config/application.rb ${GITLAB_DIR}/config/application.rb\nCOPY --from=builder ${GITLAB_DIR}/config/initializers ${GITLAB_DIR}/config/initializers\nCOPY --from=builder ${GITLAB_DIR}/config/locales ${GITLAB_DIR}/config/locales\nCOPY --from=builder ${GITLAB_DIR}/lib/gitlab ${GITLAB_DIR}/lib/gitlab\nCOPY --from=builder ${GITLAB_DIR}/locale ${GITLAB_DIR}/locale\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# ####################\n#   Building Stage   #\n# ####################\nFROM gitlab/gitlab-ce:{IMAGE_TAG} AS builder\nENV GITLAB_DIR=\"/opt/gitlab/embedded/service/gitlab-rails\"\nENV GITLAB_GIT_ZH=\"https://gitlab.com/xhang/gitlab.git\"\n#  Reference:\n#  * https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/config/software/gitlab-rails.rb\n#  * https://gitlab.com/gitlab-org/gitlab-ce/blob/master/.gitlab-ci.yml\nRUN set -xe \\\n && echo \" # Preparing ...\" \\\n && export DEBIAN_FRONTEND=noninteractive \\\n && export SSL_CERT_DIR=/etc/ssl/certs/ \\\n && export GIT_SSL_CAPATH=/etc/ssl/certs/ \\\n && curl -sL https://deb.nodesource.com/setup_8.x | bash - \\\n && curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \\\n && echo \"deb https://dl.yarnpkg.com/debian/ stable main\" | tee /etc/apt/sources.list.d/yarn.list \\\n && apt-get update \\\n && apt-get install lsb-release patch nodejs python build-essential yarn cmake -yqq\nRUN set -xe \\\n && echo \" # Generating translation patch ...\" \\\n && cd /tmp \\\n && git clone ${GITLAB_GIT_ZH} gitlab \\\n && cd gitlab \\\n && export IGNORE_DIRS=':!qa :!spec :!features :!.gitignore :!.gitlab :!locale :!app/assets/ :!vendor/assets/' \\\n && git diff --diff-filter=d {COMMIT_UPSTREAM}..{COMMIT_ZH} -- . ${IGNORE_DIRS} > ../zh_CN.diff \\\n && echo \" # Patching ...\" \\\n && patch -d ${GITLAB_DIR} -p1 < ../zh_CN.diff \\\n && echo \" # Copy assets files ...\" \\\n && git checkout {COMMIT_ZH} \\\n && cp -R locale ${GITLAB_DIR}/ \\\n && mkdir -p ${GITLAB_DIR}/app \\\n && cp -R app/assets ${GITLAB_DIR}/app/ \\\n && mkdir -p ${GITLAB_DIR}/vendor \\\n && cp -R vendor/assets ${GITLAB_DIR}/vendor/\nRUN set -xe \\\n && echo \" # Regenerating the assets\" \\\n && cd ${GITLAB_DIR} \\\n && cp config/gitlab.yml.example config/gitlab.yml \\\n && cp config/database.yml.postgresql config/database.yml \\\n && cp config/secrets.yml.example config/secrets.yml \\\n && rm -rf public/assets \\\n && export NODE_ENV=production \\\n && export RAILS_ENV=production \\\n && export SETUP_DB=false \\\n && export USE_DB=false \\\n && export SKIP_STORAGE_VALIDATION=true \\\n && export WEBPACK_REPORT=true \\\n && export NO_COMPRESSION=true \\\n && export NO_PRIVILEGE_DROP=true \\\n && export NODE_OPTIONS=--max-old-space-size=4086 \\\n && yarn install --frozen-lockfile \\\n && bin/bundle install --frozen \\\n && bin/rake gettext:compile \\\n && bin/rake gitlab:assets:compile\nRUN set -xe \\\n && echo \" # Cleaning ...\" \\\n && yarn cache clean \\\n && rm -rf log tmp config/gitlab.yml config/database.yml config/secrets.yml .secret .gitlab_shell_secret .gitlab_workhorse_secret app/assets node_modules \\\n && find /usr/lib/ -name __pycache__ | xargs rm -rf \\\n && rm -rf /tmp/gitlab /tmp/*.diff /root/.cache /var/lib/apt/lists/*\n# #####################\n#   Production Stage  #\n# #####################\nFROM gitlab/gitlab-ce:{IMAGE_TAG} AS production\nRUN set -xe \\\n && export DEBIAN_FRONTEND=noninteractive \\\n && apt-get update \\\n && apt-get install locales tzdata -yqq \\\n && locale-gen en_US.UTF-8 \\\n && rm -rf /var/lib/apt/lists/*\nENV LANG=\"en_US.UTF-8\" \\\n    LANGUAGE=\"en_US:en\" \\\n    LC_ALL=\"en_US.UTF-8\"\nENV TZ=\"Asia/Shanghai\"\nENV GITLAB_VERSION=\"{COMMIT_UPSTREAM}\"\nENV GITLAB_DIR=\"/opt/gitlab/embedded/service/gitlab-rails\"\nENV GITLAB_GIT_ZH=\"https://gitlab.com/xhang/gitlab.git\"\nENV GITLAB_GIT_COMMIT_UPSTREAM=\"{COMMIT_UPSTREAM}\"\nENV GITLAB_GIT_COMMIT_ZH=\"{COMMIT_ZH}\"\nCOPY --from=builder ${GITLAB_DIR}/app ${GITLAB_DIR}/app\nCOPY --from=builder ${GITLAB_DIR}/public ${GITLAB_DIR}/public\nCOPY --from=builder ${GITLAB_DIR}/config/application.rb ${GITLAB_DIR}/config/application.rb\nCOPY --from=builder ${GITLAB_DIR}/config/initializers ${GITLAB_DIR}/config/initializers\nCOPY --from=builder ${GITLAB_DIR}/config/locales ${GITLAB_DIR}/config/locales\nCOPY --from=builder ${GITLAB_DIR}/lib/gitlab ${GITLAB_DIR}/lib/gitlab\nCOPY --from=builder ${GITLAB_DIR}/locale ${GITLAB_DIR}/locale\n","injectedSmells":[],"originalDockerfileHash":"bc8a993cca4e7ff0a6386ccee3d5a0dc","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  ####################\n#    Building Stage   #\n#  ####################\nFROM gitlab/gitlab-ce:{IMAGE_TAG} AS builder\nENV GITLAB_DIR=\"/opt/gitlab/embedded/service/gitlab-rails\"\nENV GITLAB_GIT_ZH=\"https://gitlab.com/xhang/gitlab.git\"\n#   Reference:\n#   * https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/config/software/gitlab-rails.rb\n#   * https://gitlab.com/gitlab-org/gitlab-ce/blob/master/.gitlab-ci.yml\nRUN set -xe \\\n && echo \" # Preparing ...\" \\\n && export DEBIAN_FRONTEND=noninteractive \\\n && export SSL_CERT_DIR=/etc/ssl/certs/ \\\n && export GIT_SSL_CAPATH=/etc/ssl/certs/ \\\n && curl -sL https://deb.nodesource.com/setup_8.x | bash - \\\n && curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \\\n && echo \"deb https://dl.yarnpkg.com/debian/ stable main\" | tee /etc/apt/sources.list.d/yarn.list \\\n && apt-get update \\\n && apt-get install lsb-release patch nodejs python build-essential yarn cmake -yqq\nRUN set -xe \\\n && echo \" # Generating translation patch ...\" \\\n && cd /tmp \\\n && git clone ${GITLAB_GIT_ZH} gitlab \\\n && cd gitlab \\\n && export IGNORE_DIRS=':!qa :!spec :!features :!.gitignore :!.gitlab :!locale :!app/assets/ :!vendor/assets/' \\\n && git diff --diff-filter=d {COMMIT_UPSTREAM}..{COMMIT_ZH} -- . ${IGNORE_DIRS} > ../zh_CN.diff \\\n && echo \" # Patching ...\" \\\n && patch -d ${GITLAB_DIR} -p1 < ../zh_CN.diff \\\n && echo \" # Copy assets files ...\" \\\n && git checkout {COMMIT_ZH} \\\n && cp -R locale ${GITLAB_DIR}/ \\\n && mkdir -p ${GITLAB_DIR}/app \\\n && cp -R app/assets ${GITLAB_DIR}/app/ \\\n && mkdir -p ${GITLAB_DIR}/vendor \\\n && cp -R vendor/assets ${GITLAB_DIR}/vendor/\nRUN set -xe \\\n && echo \" # Regenerating the assets\" \\\n && cd ${GITLAB_DIR} \\\n && cp config/gitlab.yml.example config/gitlab.yml \\\n && cp config/database.yml.postgresql config/database.yml \\\n && cp config/secrets.yml.example config/secrets.yml \\\n && rm -rf public/assets \\\n && export NODE_ENV=production \\\n && export RAILS_ENV=production \\\n && export SETUP_DB=false \\\n && export USE_DB=false \\\n && export SKIP_STORAGE_VALIDATION=true \\\n && export WEBPACK_REPORT=true \\\n && export NO_COMPRESSION=true \\\n && export NO_PRIVILEGE_DROP=true \\\n && export NODE_OPTIONS=--max-old-space-size=4086 \\\n && yarn install --frozen-lockfile \\\n && bin/bundle install --frozen \\\n && bin/rake gettext:compile \\\n && bin/rake gitlab:assets:compile\nRUN set -xe \\\n && echo \" # Cleaning ...\" \\\n && yarn cache clean \\\n && rm -rf log tmp config/gitlab.yml config/database.yml config/secrets.yml .secret .gitlab_shell_secret .gitlab_workhorse_secret app/assets node_modules \\\n && find /usr/lib/ -name __pycache__ | xargs rm -rf \\\n && rm -rf /tmp/gitlab /tmp/*.diff /root/.cache /var/lib/apt/lists/*\n#  #####################\n#    Production Stage  #\n#  #####################\nFROM gitlab/gitlab-ce:{IMAGE_TAG} AS production\nRUN set -xe \\\n && export DEBIAN_FRONTEND=noninteractive \\\n && apt-get update \\\n && apt-get install locales tzdata -yqq \\\n && locale-gen en_US.UTF-8 \\\n && rm -rf /var/lib/apt/lists/*\nENV LANG=\"en_US.UTF-8\" \\\n    LANGUAGE=\"en_US:en\" \\\n    LC_ALL=\"en_US.UTF-8\"\nENV TZ=\"Asia/Shanghai\"\nENV GITLAB_VERSION=\"{COMMIT_UPSTREAM}\"\nENV GITLAB_DIR=\"/opt/gitlab/embedded/service/gitlab-rails\"\nENV GITLAB_GIT_ZH=\"https://gitlab.com/xhang/gitlab.git\"\nENV GITLAB_GIT_COMMIT_UPSTREAM=\"{COMMIT_UPSTREAM}\"\nENV GITLAB_GIT_COMMIT_ZH=\"{COMMIT_ZH}\"\nCOPY --from=builder ${GITLAB_DIR}/app ${GITLAB_DIR}/app\nCOPY --from=builder ${GITLAB_DIR}/public ${GITLAB_DIR}/public\nCOPY --from=builder ${GITLAB_DIR}/config/application.rb ${GITLAB_DIR}/config/application.rb\nCOPY --from=builder ${GITLAB_DIR}/config/initializers ${GITLAB_DIR}/config/initializers\nCOPY --from=builder ${GITLAB_DIR}/config/locales ${GITLAB_DIR}/config/locales\nCOPY --from=builder ${GITLAB_DIR}/lib/gitlab ${GITLAB_DIR}/lib/gitlab\nCOPY --from=builder ${GITLAB_DIR}/locale ${GITLAB_DIR}/locale\n","originalDockerfileUglifiedHash":"29199e42eb75a1523c188280ef8557ff","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/7eaf4ca8189277d909d3a935cf00aa3b25984586.dockerfile"}