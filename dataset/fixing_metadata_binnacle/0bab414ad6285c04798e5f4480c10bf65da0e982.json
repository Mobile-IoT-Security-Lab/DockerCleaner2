{"seed":2328677585,"processedDockerfileHash":"935b20dcb03c84ec56ba8971186cd36b","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM idoall/nginx:1.9\nMAINTAINER lion <lion.net@163.com>\n#   -----------------------------------------------------------------------------\n#   更新 centos\n#   -----------------------------------------------------------------------------\nRUN yum update -y \\\n && yum install -y libjpeg libjpeg-devel libpng curl-devel libpng-devel freetype bzip2-devel freetype-devel libxml2 libxml2-devel pcre-devel ncurses-devel openssl openssl-devel php-mcrypt libmcrypt libmcrypt-devel \\\n && ln -s /usr/lib64/libssl.so /usr/lib/ RUN cd /home/work/_src \\\n && wget http://ftp.gnu.org/gnu/bison/bison-2.6.5.tar.gz \\\n && tar -xvzf bison-2.6.5.tar.gz \\\n && cd bison-2.6.5 \\\n && ./configure \\\n && make \\\n && make install \\\n && cd /home/work/_src \\\n && wget ftp://mcrypt.hellug.gr/pub/crypto/mcrypt/attic/libmcrypt/libmcrypt-2.5.7.tar.gz \\\n && tar -zxvf libmcrypt-2.5.7.tar.gz \\\n && cd libmcrypt-2.5.7 \\\n && ./configure --prefix=/usr/local \\\n && make \\\n && make install \\\n && cd /home/work/_src \\\n && wget http://cn2.php.net/distributions/php-7.1.9.tar.gz \\\n && tar xzvf php-7.1.9.tar.gz \\\n && cd php-7.1.9 \\\n && ./configure --prefix=/home/work/_app/php7.1.9 --with-config-file-path=/home/work/_app/php7.1.9/etc --with-mcrypt=/usr/include --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-gd --with-iconv --with-zlib --enable-xml --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --enable-mbregex --enable-fpm --enable-mbstring --enable-ftp --enable-gd-native-ttf --with-openssl --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --without-pear --with-gettext --enable-session --with-curl --with-jpeg-dir --with-freetype-dir --enable-opcache \\\n && make \\\n && make install \\\n && cp php.ini-production /home/work/_app/php7.1.9/etc/php.ini \\\n && cp /home/work/_app/php7.1.9/etc/php-fpm.conf.default /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n && cp /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf.default /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && mkdir -p /home/work/_logs/php \\\n && sed -i \"s/;date.timezone =.*/date.timezone = Asia\\/Shanghai/\" /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/;session.save_path = .*/session.save_path = \"\\/home\\/work\\/_app\\/php7.1.9\\/session\"/' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i \"s/;error_log = log\\/php-fpm.log/error_log = \\/home\\/work\\/_logs\\/php\\/php-fpm.error.log/\" /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n && sed -i \"s/listen = 127.0.0.1:9000/listen = \\/var\\/run\\/php-fpm.sock/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/user = nobody/user = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/group = nobody/group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.owner = nobody/listen.owner = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.group = work/listen.group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.mode = 0660/listen.mode = 0666/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;access.log = log\\/$pool.access.log/access.log = \\/home\\/work\\/_logs\\/php\\/php.$pool.access.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;slowlog = log\\/$pool.log.slow/slowlog = \\/home\\/work\\/_logs\\/php\\/fpm-php.slow.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;request_slowlog_timeout = 0/request_slowlog_timeout = 10s/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;php_admin_value\\[error_log\\] = \\/var\\/log\\/fpm-php.www.log/php_admin_value\\[error_log\\] = \\/home\\/work\\/_logs\\/php\\/php-fpm.www.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && echo \"<?php phpinfo(); ?>\" > /home/work/_app/nginx/html/index.php \\\n && yum clean all \\\n && rm -rf /home/work/_src/* \\\n && chown -R work:work /home/work/* \\\n && export PATH=$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin\n#   -----------------------------------------------------------------------------\n#   修改 Nginx 的配置文件支持 PHP，并配置默认站点\n#   -----------------------------------------------------------------------------\nCOPY _app/nginx/conf/nginx.conf /home/work/_app/nginx/conf/nginx.conf\nCOPY _app/nginx/conf/conf.d/default.conf /home/work/_app/nginx/conf/conf.d/default.conf\nENV PATH=\"$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin\"\n#   -----------------------------------------------------------------------------\n#   添加执行文件\n#   -----------------------------------------------------------------------------\nCOPY run.sh /\nRUN chmod +x /run.sh\nCMD [\"/run.sh\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM idoall/nginx:1.9\nMAINTAINER lion <lion.net@163.com>\n#  -----------------------------------------------------------------------------\n#  更新 centos\n#  -----------------------------------------------------------------------------\nRUN yum update -y \\\n && yum install -y libjpeg libjpeg-devel libpng curl-devel libpng-devel freetype bzip2-devel freetype-devel libxml2 libxml2-devel pcre-devel ncurses-devel openssl openssl-devel php-mcrypt libmcrypt libmcrypt-devel \\\n && ln -s /usr/lib64/libssl.so /usr/lib/ RUN cd /home/work/_src \\\n && wget http://ftp.gnu.org/gnu/bison/bison-2.6.5.tar.gz \\\n && tar -xvzf bison-2.6.5.tar.gz \\\n && cd bison-2.6.5 \\\n && ./configure \\\n && make \\\n && make install \\\n && cd /home/work/_src \\\n && wget ftp://mcrypt.hellug.gr/pub/crypto/mcrypt/attic/libmcrypt/libmcrypt-2.5.7.tar.gz \\\n && tar -zxvf libmcrypt-2.5.7.tar.gz \\\n && cd libmcrypt-2.5.7 \\\n && ./configure --prefix=/usr/local \\\n && make \\\n && make install \\\n && cd /home/work/_src \\\n && wget http://cn2.php.net/distributions/php-7.1.9.tar.gz \\\n && tar xzvf php-7.1.9.tar.gz \\\n && cd php-7.1.9 \\\n && ./configure --prefix=/home/work/_app/php7.1.9 --with-config-file-path=/home/work/_app/php7.1.9/etc --with-mcrypt=/usr/include --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-gd --with-iconv --with-zlib --enable-xml --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --enable-mbregex --enable-fpm --enable-mbstring --enable-ftp --enable-gd-native-ttf --with-openssl --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --without-pear --with-gettext --enable-session --with-curl --with-jpeg-dir --with-freetype-dir --enable-opcache \\\n && make \\\n && make install \\\n && cp php.ini-production /home/work/_app/php7.1.9/etc/php.ini \\\n && cp /home/work/_app/php7.1.9/etc/php-fpm.conf.default /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n && cp /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf.default /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && mkdir -p /home/work/_logs/php \\\n && sed -i \"s/;date.timezone =.*/date.timezone = Asia\\/Shanghai/\" /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/;session.save_path = .*/session.save_path = \"\\/home\\/work\\/_app\\/php7.1.9\\/session\"/' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i \"s/;error_log = log\\/php-fpm.log/error_log = \\/home\\/work\\/_logs\\/php\\/php-fpm.error.log/\" /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n && sed -i \"s/listen = 127.0.0.1:9000/listen = \\/var\\/run\\/php-fpm.sock/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/user = nobody/user = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/group = nobody/group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.owner = nobody/listen.owner = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.group = work/listen.group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.mode = 0660/listen.mode = 0666/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;access.log = log\\/$pool.access.log/access.log = \\/home\\/work\\/_logs\\/php\\/php.$pool.access.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;slowlog = log\\/$pool.log.slow/slowlog = \\/home\\/work\\/_logs\\/php\\/fpm-php.slow.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;request_slowlog_timeout = 0/request_slowlog_timeout = 10s/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;php_admin_value\\[error_log\\] = \\/var\\/log\\/fpm-php.www.log/php_admin_value\\[error_log\\] = \\/home\\/work\\/_logs\\/php\\/php-fpm.www.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && echo \"<?php phpinfo(); ?>\" > /home/work/_app/nginx/html/index.php \\\n && yum clean all \\\n && rm -rf /home/work/_src/* \\\n && chown -R work:work /home/work/* \\\n && export PATH=$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin\n#  -----------------------------------------------------------------------------\n#  修改 Nginx 的配置文件支持 PHP，并配置默认站点\n#  -----------------------------------------------------------------------------\nADD _app/nginx/conf/nginx.conf /home/work/_app/nginx/conf/nginx.conf\nADD _app/nginx/conf/conf.d/default.conf /home/work/_app/nginx/conf/conf.d/default.conf\nENV PATH=\"$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin\"\n#  -----------------------------------------------------------------------------\n#  添加执行文件\n#  -----------------------------------------------------------------------------\nADD run.sh /\nRUN chmod +x /run.sh\nCMD [\"/run.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"c77dfa77d30f5c093ffdf7a78accccd1","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM idoall/nginx:1.9\nMAINTAINER lion <lion.net@163.com>\n#   -----------------------------------------------------------------------------\n#   更新 centos\n#   -----------------------------------------------------------------------------\nRUN yum update -y \\\n && yum install -y libjpeg libjpeg-devel libpng curl-devel libpng-devel freetype bzip2-devel freetype-devel libxml2 libxml2-devel pcre-devel ncurses-devel openssl openssl-devel php-mcrypt libmcrypt libmcrypt-devel \\\n && ln -s /usr/lib64/libssl.so /usr/lib/ RUN cd /home/work/_src \\\n && wget http://ftp.gnu.org/gnu/bison/bison-2.6.5.tar.gz \\\n && tar -xvzf bison-2.6.5.tar.gz \\\n && cd bison-2.6.5 \\\n && ./configure \\\n && make \\\n && make install \\\n && cd /home/work/_src \\\n && wget ftp://mcrypt.hellug.gr/pub/crypto/mcrypt/attic/libmcrypt/libmcrypt-2.5.7.tar.gz \\\n && tar -zxvf libmcrypt-2.5.7.tar.gz \\\n && cd libmcrypt-2.5.7 \\\n && ./configure --prefix=/usr/local \\\n && make \\\n && make install \\\n && cd /home/work/_src \\\n && wget http://cn2.php.net/distributions/php-7.1.9.tar.gz \\\n && tar xzvf php-7.1.9.tar.gz \\\n && cd php-7.1.9 \\\n && ./configure --prefix=/home/work/_app/php7.1.9 --with-config-file-path=/home/work/_app/php7.1.9/etc --with-mcrypt=/usr/include --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-gd --with-iconv --with-zlib --enable-xml --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --enable-mbregex --enable-fpm --enable-mbstring --enable-ftp --enable-gd-native-ttf --with-openssl --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --without-pear --with-gettext --enable-session --with-curl --with-jpeg-dir --with-freetype-dir --enable-opcache \\\n && make \\\n && make install \\\n && cp php.ini-production /home/work/_app/php7.1.9/etc/php.ini \\\n && cp /home/work/_app/php7.1.9/etc/php-fpm.conf.default /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n && cp /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf.default /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && mkdir -p /home/work/_logs/php \\\n && sed -i \"s/;date.timezone =.*/date.timezone = Asia\\/Shanghai/\" /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i 's/;session.save_path = .*/session.save_path = \"\\/home\\/work\\/_app\\/php7.1.9\\/session\"/' /home/work/_app/php7.1.9/etc/php.ini \\\n && sed -i \"s/;error_log = log\\/php-fpm.log/error_log = \\/home\\/work\\/_logs\\/php\\/php-fpm.error.log/\" /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n && sed -i \"s/listen = 127.0.0.1:9000/listen = \\/var\\/run\\/php-fpm.sock/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/user = nobody/user = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/group = nobody/group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.owner = nobody/listen.owner = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.group = work/listen.group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;listen.mode = 0660/listen.mode = 0666/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;access.log = log\\/$pool.access.log/access.log = \\/home\\/work\\/_logs\\/php\\/php.$pool.access.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;slowlog = log\\/$pool.log.slow/slowlog = \\/home\\/work\\/_logs\\/php\\/fpm-php.slow.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;request_slowlog_timeout = 0/request_slowlog_timeout = 10s/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && sed -i \"s/;php_admin_value\\[error_log\\] = \\/var\\/log\\/fpm-php.www.log/php_admin_value\\[error_log\\] = \\/home\\/work\\/_logs\\/php\\/php-fpm.www.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n && echo \"<?php phpinfo(); ?>\" > /home/work/_app/nginx/html/index.php \\\n && yum clean all \\\n && rm -rf /home/work/_src/* \\\n && chown -R work:work /home/work/* \\\n && export PATH=$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin\n#   -----------------------------------------------------------------------------\n#   修改 Nginx 的配置文件支持 PHP，并配置默认站点\n#   -----------------------------------------------------------------------------\nADD _app/nginx/conf/nginx.conf /home/work/_app/nginx/conf/nginx.conf\nADD _app/nginx/conf/conf.d/default.conf /home/work/_app/nginx/conf/conf.d/default.conf\nENV PATH=\"$PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin\"\n#   -----------------------------------------------------------------------------\n#   添加执行文件\n#   -----------------------------------------------------------------------------\nADD run.sh /\nRUN chmod +x /run.sh\nCMD [\"/run.sh\"]\n","originalDockerfileUglifiedHash":"7cd7efc0516f3481292d98cad92b3735","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/0bab414ad6285c04798e5f4480c10bf65da0e982.dockerfile"}