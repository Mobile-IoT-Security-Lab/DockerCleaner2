{"seed":507919016,"processedDockerfileHash":"749e9e56e5be80bf94bba26bbdbe791b","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM centos\n#   安装工具\nRUN cd / \\\n && yum install -y epel-release \\\n && yum install -y wget vi gcc gcc-c++ autoconf libjpeg libcurl libcurl-devel libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl openssl-devel openldap openldap-devel nss_ldap openldap-clients openldap-servers libxslt libxslt-devel libevent-devel iconv libmcrypt libmcrypt-devel libicu-devel re2c bison bzip2 bzip2-devel unzip ; yum clean all \\\n && ldconfig\n#   安装libzip的安装工具cmake https://cmake.org/files/\nRUN cd / \\\n && wget https://cmake.org/files/v3.12/cmake-3.12.0-rc1.tar.gz \\\n && tar -zxvf cmake-3.12.0-rc1.tar.gz \\\n && cd /cmake-3.12.0-rc1 \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -f /cmake-3.12.0-rc1.tar.gz \\\n && rm -rf /cmake-3.12.0-rc1\n#   安装libzip库 https://libzip.org/download/\nRUN cd / \\\n && wget https://libzip.org/download/libzip-1.5.1.tar.gz \\\n && tar -xf libzip-1.5.1.tar.gz \\\n && cd /libzip* \\\n && mkdir build \\\n && cd build \\\n && cmake .. \\\n && make \\\n && make install \\\n && rm -f /libzip-1.5.1.tar.gz \\\n && rm -rf /libzip-1.5.1\n#   安装ICU库(为了安装intl扩展 owncloud用到)\nRUN cd / \\\n && wget http://download.icu-project.org/files/icu4c/62rc/icu4c-62rc-src.tgz \\\n && tar xf icu4c-62rc-src.tgz \\\n && cd icu/source \\\n && mkdir /usr/local/icu \\\n && ./configure --prefix=/usr/local/icu \\\n && make \\\n && make install \\\n && rm -f /icu4c-62rc-src.tgz \\\n && rm -rf /icu\n#   下载并解压源码包\nRUN cd / \\\n && wget http://jp2.php.net/distributions/php-7.2.6.tar.gz \\\n && tar -zxvf php-7.2.6.tar.gz\n#   编译安装\nRUN cd /php-7.2.6 \\\n && ./configure --prefix=/usr/local/php --with-curl --with-freetype-dir --with-jpeg-dir --with-gd --with-gettext --with-iconv-dir --with-kerberos --with-libdir=lib64 --with-libxml-dir --with-mysqli --with-openssl --with-pcre-regex --with-pdo-mysql --with-pdo-sqlite --with-pear --with-png-dir --with-xmlrpc --with-xsl --with-zlib --with-mhash --with-libzip --enable-fpm --enable-bcmath --enable-libxml --enable-inline-optimization --enable-mbregex --enable-mbstring --enable-opcache --enable-pcntl --enable-shmop --enable-soap --enable-sockets --enable-sysvsem --enable-xml --enable-zip --enable-simplexml --enable-intl \\\n && make \\\n && make install \\\n && cp php.ini-production /usr/local/php/lib/php.ini \\\n && cp sapi/fpm/init.d.php-fpm /usr/local/php/etc/php-fpm \\\n && sed -i 's/ --daemonize//g' /usr/local/php/etc/php-fpm \\\n && chmod +x /usr/local/php/etc/php-fpm \\\n && cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf \\\n && cp /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf \\\n && sed -i 's/^;daemonize = yes/daemonize = no/g' /usr/local/php/etc/php-fpm.conf \\\n && sed -i 's/^listen = 127\\.0\\.0\\.1\\:9000/listen = 9000/g' /usr/local/php/etc/php-fpm.d/www.conf \\\n && rm -rf /php-7.2.6 \\\n && rm -f /php-7.2.6.tar.gz\n#  下载mcrypt扩展\nRUN cd / \\\n && wget http://pecl.php.net/get/mcrypt-1.0.1.tgz \\\n && tar -zxvf mcrypt-1.0.1.tgz \\\n && cd mcrypt-1.0.1 \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && make install \\\n && echo \"extension_dir=/usr/local/php/lib/php/extensions/no-debug-non-zts-20170718/\" >> /usr/local/php/lib/php.ini \\\n && echo \"extension=mcrypt.so\" >> /usr/local/php/lib/php.ini \\\n && rm -rf /mcrypt-1.0.1 \\\n && rm -f /mcrypt-1.0.1.tgz\n#   安装memcached 依赖库igbinary http://pecl.php.net/package/igbinary\nRUN cd / \\\n && wget http://pecl.php.net/get/igbinary-2.0.6.tgz \\\n && tar -zxvf igbinary-2.0.6.tgz \\\n && cd igbinary-2.0.6 \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && make install \\\n && echo \"extension=igbinary.so\" >> /usr/local/php/lib/php.ini \\\n && rm -f /igbinary-2.0.6.tgz \\\n && rm -rf /igbinary-2.0.6\n#   安装memcached 依赖库msgpack http://pecl.php.net/package/msgpack\nRUN cd / \\\n && wget http://pecl.php.net/get/msgpack-2.0.2.tgz \\\n && tar -zxvf msgpack-2.0.2.tgz \\\n && cd msgpack-2.0.2 \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && make install \\\n && echo \"extension=msgpack.so\" >> /usr/local/php/lib/php.ini \\\n && rm -f /msgpack-2.0.2.tgz \\\n && rm -rf /msgpack-2.0.2\n#   安装redis依赖库hiredis https://github.com/redis/hiredis/releases\nRUN cd / \\\n && wget https://github.com/redis/hiredis/archive/v0.13.3.tar.gz \\\n && tar -zxvf v0.13.3.tar.gz \\\n && cd hiredis-0.13.3/ \\\n && make \\\n && make install \\\n && ldconfig \\\n && rm -f /v0.13.3.tar.gz \\\n && rm -rf /hiredis-0.13.3\n#   安装redis https://github.com/phpredis/phpredis/releases\nRUN cd / \\\n && wget https://github.com/phpredis/phpredis/archive/4.1.0RC1.tar.gz \\\n && tar -zxvf 4.1.0RC1.tar.gz \\\n && cd phpredis-4.1.0RC1/ \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && make install \\\n && echo \"extension=redis.so\" >> /usr/local/php/lib/php.ini \\\n && rm -f /4.1.0RC1.tar.gz \\\n && rm -rf /phpredis-4.1.0RC1\n#   安装 http2依赖库 nghttp2   https://github.com/nghttp2/nghttp2/releases/\nRUN cd / \\\n && wget https://github.com/nghttp2/nghttp2/releases/download/v1.32.0/nghttp2-1.32.0.tar.gz \\\n && tar -zxvf nghttp2-1.32.0.tar.gz \\\n && cd nghttp2-1.32.0/ \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -f /nghttp2-1.32.0.tar.gz \\\n && rm -rf /nghttp2-1.32.0\n#   安装swoole https://github.com/swoole/swoole-src/releases\nRUN cd / \\\n && wget https://github.com/swoole/swoole-src/archive/v4.0.0.tar.gz \\\n && tar -zxvf v4.0.0.tar.gz \\\n && cd swoole-src-4.0.0/ \\\n && /usr/local/php/bin/phpize \\\n && ./configure --enable-sockets --enable-openssl --enable-http2 --enable-async-redis --enable-timewheel --enable-mysqlnd --enable-coroutine --with-php-config=/usr/local/php/bin/php-config \\\n && make clean \\\n && make \\\n && make install \\\n && echo \"extension=swoole.so\" >> /usr/local/php/lib/php.ini \\\n && echo \"/usr/local/lib\" >> /etc/ld.so.conf \\\n && ldconfig \\\n && rm -f /v4.0.0.tar.gz \\\n && rm -rf /swoole-src-4.0.0\n#   安装memcached 依赖库 libmemcached  https://launchpad.net/libmemcached/\nRUN cd / \\\n && wget https://launchpad.net/libmemcached/1.0/1.0.18/+download/libmemcached-1.0.18.tar.gz \\\n && tar -zxvf libmemcached-1.0.18.tar.gz \\\n && cd libmemcached-1.0.18 \\\n && ./configure --prefix=/usr/local/libmemcached \\\n && make \\\n && make install \\\n && rm -f /libmemcached-1.0.18.tar.gz \\\n && rm -rf /libmemcached-1.0.18\n#   安装http://pecl.php.net/package/memcached\nRUN cd / \\\n && wget http://pecl.php.net/get/memcached-3.0.4.tgz \\\n && tar -zxvf memcached-3.0.4.tgz \\\n && cd memcached-3.0.4 \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config --with-libmemcached-dir=/usr/local/libmemcached --enable-memcached-igbinary --enable-memcached-json --enable-memcached-msgpack \\\n && make \\\n && make install \\\n && echo \"extension=memcached.so\" >> /usr/local/php/lib/php.ini \\\n && rm -f /memcached-3.0.4.tgz \\\n && rm -rf /memcached-3.0.4\n#   安装 php screw plus  https://codeload.github.com/del-xiong/screw-plus/zip/master\nRUN cd / \\\n && wget https://codeload.github.com/del-xiong/screw-plus/zip/master \\\n && unzip master \\\n && cd /screw-plus-master \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && cp /screw-plus-master/modules/php_screw_plus.so /usr/local/php/lib/php/extensions/no-debug-non-zts-20170718/ \\\n && echo \"extension=php_screw_plus.so\" >> /usr/local/php/lib/php.ini \\\n && cd /screw-plus-master/tools \\\n && make \\\n && rm -f /master\n#  rm -rf /screw-plus-master\n#   创建好挂载目录\nRUN mkdir -p /data/php/log \\\n && mkdir -p /data/nginx/www\n#   设置时区\nRUN cp -f /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n && echo \"Asia/Shanghai\" > /etc/timezone\n#   启动php服务\nRUN chmod +x /usr/local/php/etc/php-fpm \\\n && /usr/local/php/etc/php-fpm start &\n#   设置环境变量\nENV PATH=\"$PATH:/usr/local/php/etc:/usr/local/php/bin\"\n#  设置生成容器时需要执行的脚本\n#  ENTRYPOINT [\"/usr/local/php/sbin/php-fpm\"]\nCMD [\"php-fpm\", \"start\"]\n#  开放9000端口\nEXPOSE 9000/tcp\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM centos\n#  安装工具\nRUN cd / \\\n && yum install -y epel-release \\\n && yum install -y wget vi gcc gcc-c++ autoconf libjpeg libcurl libcurl-devel libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl openssl-devel openldap openldap-devel nss_ldap openldap-clients openldap-servers libxslt libxslt-devel libevent-devel iconv libmcrypt libmcrypt-devel libicu-devel re2c bison bzip2 bzip2-devel unzip ; yum clean all \\\n && ldconfig\n#  安装libzip的安装工具cmake https://cmake.org/files/\nRUN cd / \\\n && wget https://cmake.org/files/v3.12/cmake-3.12.0-rc1.tar.gz \\\n && tar -zxvf cmake-3.12.0-rc1.tar.gz \\\n && cd /cmake-3.12.0-rc1 \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -f /cmake-3.12.0-rc1.tar.gz \\\n && rm -rf /cmake-3.12.0-rc1\n#  安装libzip库 https://libzip.org/download/\nRUN cd / \\\n && wget https://libzip.org/download/libzip-1.5.1.tar.gz \\\n && tar -xf libzip-1.5.1.tar.gz \\\n && cd /libzip* \\\n && mkdir build \\\n && cd build \\\n && cmake .. \\\n && make \\\n && make install \\\n && rm -f /libzip-1.5.1.tar.gz \\\n && rm -rf /libzip-1.5.1\n#  安装ICU库(为了安装intl扩展 owncloud用到)\nRUN cd / \\\n && wget http://download.icu-project.org/files/icu4c/62rc/icu4c-62rc-src.tgz \\\n && tar xf icu4c-62rc-src.tgz \\\n && cd icu/source \\\n && mkdir /usr/local/icu \\\n && ./configure --prefix=/usr/local/icu \\\n && make \\\n && make install \\\n && rm -f /icu4c-62rc-src.tgz \\\n && rm -rf /icu\n#  下载并解压源码包\nRUN cd / \\\n && wget http://jp2.php.net/distributions/php-7.2.6.tar.gz \\\n && tar -zxvf php-7.2.6.tar.gz\n#  编译安装\nRUN cd /php-7.2.6 \\\n && ./configure --prefix=/usr/local/php --with-curl --with-freetype-dir --with-jpeg-dir --with-gd --with-gettext --with-iconv-dir --with-kerberos --with-libdir=lib64 --with-libxml-dir --with-mysqli --with-openssl --with-pcre-regex --with-pdo-mysql --with-pdo-sqlite --with-pear --with-png-dir --with-xmlrpc --with-xsl --with-zlib --with-mhash --with-libzip --enable-fpm --enable-bcmath --enable-libxml --enable-inline-optimization --enable-mbregex --enable-mbstring --enable-opcache --enable-pcntl --enable-shmop --enable-soap --enable-sockets --enable-sysvsem --enable-xml --enable-zip --enable-simplexml --enable-intl \\\n && make \\\n && make install \\\n && cp php.ini-production /usr/local/php/lib/php.ini \\\n && cp sapi/fpm/init.d.php-fpm /usr/local/php/etc/php-fpm \\\n && sed -i 's/ --daemonize//g' /usr/local/php/etc/php-fpm \\\n && chmod +x /usr/local/php/etc/php-fpm \\\n && cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf \\\n && cp /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf \\\n && sed -i 's/^;daemonize = yes/daemonize = no/g' /usr/local/php/etc/php-fpm.conf \\\n && sed -i 's/^listen = 127\\.0\\.0\\.1\\:9000/listen = 9000/g' /usr/local/php/etc/php-fpm.d/www.conf \\\n && rm -rf /php-7.2.6 \\\n && rm -f /php-7.2.6.tar.gz\n# 下载mcrypt扩展\nRUN cd / \\\n && wget http://pecl.php.net/get/mcrypt-1.0.1.tgz \\\n && tar -zxvf mcrypt-1.0.1.tgz \\\n && cd mcrypt-1.0.1 \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && make install \\\n && echo \"extension_dir=/usr/local/php/lib/php/extensions/no-debug-non-zts-20170718/\" >> /usr/local/php/lib/php.ini \\\n && echo \"extension=mcrypt.so\" >> /usr/local/php/lib/php.ini \\\n && rm -rf /mcrypt-1.0.1 \\\n && rm -f /mcrypt-1.0.1.tgz\n#  安装memcached 依赖库igbinary http://pecl.php.net/package/igbinary\nRUN cd / \\\n && wget http://pecl.php.net/get/igbinary-2.0.6.tgz \\\n && tar -zxvf igbinary-2.0.6.tgz \\\n && cd igbinary-2.0.6 \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && make install \\\n && echo \"extension=igbinary.so\" >> /usr/local/php/lib/php.ini \\\n && rm -f /igbinary-2.0.6.tgz \\\n && rm -rf /igbinary-2.0.6\n#  安装memcached 依赖库msgpack http://pecl.php.net/package/msgpack\nRUN cd / \\\n && wget http://pecl.php.net/get/msgpack-2.0.2.tgz \\\n && tar -zxvf msgpack-2.0.2.tgz \\\n && cd msgpack-2.0.2 \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && make install \\\n && echo \"extension=msgpack.so\" >> /usr/local/php/lib/php.ini \\\n && rm -f /msgpack-2.0.2.tgz \\\n && rm -rf /msgpack-2.0.2\n#  安装redis依赖库hiredis https://github.com/redis/hiredis/releases\nRUN cd / \\\n && wget https://github.com/redis/hiredis/archive/v0.13.3.tar.gz \\\n && tar -zxvf v0.13.3.tar.gz \\\n && cd hiredis-0.13.3/ \\\n && make \\\n && make install \\\n && ldconfig \\\n && rm -f /v0.13.3.tar.gz \\\n && rm -rf /hiredis-0.13.3\n#  安装redis https://github.com/phpredis/phpredis/releases\nRUN cd / \\\n && wget https://github.com/phpredis/phpredis/archive/4.1.0RC1.tar.gz \\\n && tar -zxvf 4.1.0RC1.tar.gz \\\n && cd phpredis-4.1.0RC1/ \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && make install \\\n && echo \"extension=redis.so\" >> /usr/local/php/lib/php.ini \\\n && rm -f /4.1.0RC1.tar.gz \\\n && rm -rf /phpredis-4.1.0RC1\n#  安装 http2依赖库 nghttp2   https://github.com/nghttp2/nghttp2/releases/\nRUN cd / \\\n && wget https://github.com/nghttp2/nghttp2/releases/download/v1.32.0/nghttp2-1.32.0.tar.gz \\\n && tar -zxvf nghttp2-1.32.0.tar.gz \\\n && cd nghttp2-1.32.0/ \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -f /nghttp2-1.32.0.tar.gz \\\n && rm -rf /nghttp2-1.32.0\n#  安装swoole https://github.com/swoole/swoole-src/releases\nRUN cd / \\\n && wget https://github.com/swoole/swoole-src/archive/v4.0.0.tar.gz \\\n && tar -zxvf v4.0.0.tar.gz \\\n && cd swoole-src-4.0.0/ \\\n && /usr/local/php/bin/phpize \\\n && ./configure --enable-sockets --enable-openssl --enable-http2 --enable-async-redis --enable-timewheel --enable-mysqlnd --enable-coroutine --with-php-config=/usr/local/php/bin/php-config \\\n && make clean \\\n && make \\\n && make install \\\n && echo \"extension=swoole.so\" >> /usr/local/php/lib/php.ini \\\n && echo \"/usr/local/lib\" >> /etc/ld.so.conf \\\n && ldconfig \\\n && rm -f /v4.0.0.tar.gz \\\n && rm -rf /swoole-src-4.0.0\n#  安装memcached 依赖库 libmemcached  https://launchpad.net/libmemcached/\nRUN cd / \\\n && wget https://launchpad.net/libmemcached/1.0/1.0.18/+download/libmemcached-1.0.18.tar.gz \\\n && tar -zxvf libmemcached-1.0.18.tar.gz \\\n && cd libmemcached-1.0.18 \\\n && ./configure --prefix=/usr/local/libmemcached \\\n && make \\\n && make install \\\n && rm -f /libmemcached-1.0.18.tar.gz \\\n && rm -rf /libmemcached-1.0.18\n#  安装http://pecl.php.net/package/memcached\nRUN cd / \\\n && wget http://pecl.php.net/get/memcached-3.0.4.tgz \\\n && tar -zxvf memcached-3.0.4.tgz \\\n && cd memcached-3.0.4 \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config --with-libmemcached-dir=/usr/local/libmemcached --enable-memcached-igbinary --enable-memcached-json --enable-memcached-msgpack \\\n && make \\\n && make install \\\n && echo \"extension=memcached.so\" >> /usr/local/php/lib/php.ini \\\n && rm -f /memcached-3.0.4.tgz \\\n && rm -rf /memcached-3.0.4\n#  安装 php screw plus  https://codeload.github.com/del-xiong/screw-plus/zip/master\nRUN cd / \\\n && wget https://codeload.github.com/del-xiong/screw-plus/zip/master \\\n && unzip master \\\n && cd /screw-plus-master \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && cp /screw-plus-master/modules/php_screw_plus.so /usr/local/php/lib/php/extensions/no-debug-non-zts-20170718/ \\\n && echo \"extension=php_screw_plus.so\" >> /usr/local/php/lib/php.ini \\\n && cd /screw-plus-master/tools \\\n && make \\\n && rm -f /master\n# rm -rf /screw-plus-master\n#  创建好挂载目录\nRUN mkdir -p /data/php/log \\\n && mkdir -p /data/nginx/www\n#  设置时区\nRUN cp -f /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n && echo \"Asia/Shanghai\" > /etc/timezone\n#  启动php服务\nRUN chmod +x /usr/local/php/etc/php-fpm \\\n && /usr/local/php/etc/php-fpm start &\n#  设置环境变量\nENV PATH=\"$PATH:/usr/local/php/etc:/usr/local/php/bin\"\n# 设置生成容器时需要执行的脚本\n# ENTRYPOINT [\"/usr/local/php/sbin/php-fpm\"]\nCMD [\"php-fpm\", \"start\"]\n# 开放9000端口\nEXPOSE 9000/tcp\n","injectedSmells":[],"originalDockerfileHash":"680fa53209b3bfa356b39a461e463aa8","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM centos\n#   安装工具\nRUN cd / \\\n && yum install -y epel-release \\\n && yum install -y wget vi gcc gcc-c++ autoconf libjpeg libcurl libcurl-devel libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl openssl-devel openldap openldap-devel nss_ldap openldap-clients openldap-servers libxslt libxslt-devel libevent-devel iconv libmcrypt libmcrypt-devel libicu-devel re2c bison bzip2 bzip2-devel unzip ; yum clean all \\\n && ldconfig\n#   安装libzip的安装工具cmake https://cmake.org/files/\nRUN cd / \\\n && wget https://cmake.org/files/v3.12/cmake-3.12.0-rc1.tar.gz \\\n && tar -zxvf cmake-3.12.0-rc1.tar.gz \\\n && cd /cmake-3.12.0-rc1 \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -f /cmake-3.12.0-rc1.tar.gz \\\n && rm -rf /cmake-3.12.0-rc1\n#   安装libzip库 https://libzip.org/download/\nRUN cd / \\\n && wget https://libzip.org/download/libzip-1.5.1.tar.gz \\\n && tar -xf libzip-1.5.1.tar.gz \\\n && cd /libzip* \\\n && mkdir build \\\n && cd build \\\n && cmake .. \\\n && make \\\n && make install \\\n && rm -f /libzip-1.5.1.tar.gz \\\n && rm -rf /libzip-1.5.1\n#   安装ICU库(为了安装intl扩展 owncloud用到)\nRUN cd / \\\n && wget http://download.icu-project.org/files/icu4c/62rc/icu4c-62rc-src.tgz \\\n && tar xf icu4c-62rc-src.tgz \\\n && cd icu/source \\\n && mkdir /usr/local/icu \\\n && ./configure --prefix=/usr/local/icu \\\n && make \\\n && make install \\\n && rm -f /icu4c-62rc-src.tgz \\\n && rm -rf /icu\n#   下载并解压源码包\nRUN cd / \\\n && wget http://jp2.php.net/distributions/php-7.2.6.tar.gz \\\n && tar -zxvf php-7.2.6.tar.gz\n#   编译安装\nRUN cd /php-7.2.6 \\\n && ./configure --prefix=/usr/local/php --with-curl --with-freetype-dir --with-jpeg-dir --with-gd --with-gettext --with-iconv-dir --with-kerberos --with-libdir=lib64 --with-libxml-dir --with-mysqli --with-openssl --with-pcre-regex --with-pdo-mysql --with-pdo-sqlite --with-pear --with-png-dir --with-xmlrpc --with-xsl --with-zlib --with-mhash --with-libzip --enable-fpm --enable-bcmath --enable-libxml --enable-inline-optimization --enable-mbregex --enable-mbstring --enable-opcache --enable-pcntl --enable-shmop --enable-soap --enable-sockets --enable-sysvsem --enable-xml --enable-zip --enable-simplexml --enable-intl \\\n && make \\\n && make install \\\n && cp php.ini-production /usr/local/php/lib/php.ini \\\n && cp sapi/fpm/init.d.php-fpm /usr/local/php/etc/php-fpm \\\n && sed -i 's/ --daemonize//g' /usr/local/php/etc/php-fpm \\\n && chmod +x /usr/local/php/etc/php-fpm \\\n && cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf \\\n && cp /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf \\\n && sed -i 's/^;daemonize = yes/daemonize = no/g' /usr/local/php/etc/php-fpm.conf \\\n && sed -i 's/^listen = 127\\.0\\.0\\.1\\:9000/listen = 9000/g' /usr/local/php/etc/php-fpm.d/www.conf \\\n && rm -rf /php-7.2.6 \\\n && rm -f /php-7.2.6.tar.gz\n#  下载mcrypt扩展\nRUN cd / \\\n && wget http://pecl.php.net/get/mcrypt-1.0.1.tgz \\\n && tar -zxvf mcrypt-1.0.1.tgz \\\n && cd mcrypt-1.0.1 \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && make install \\\n && echo \"extension_dir=/usr/local/php/lib/php/extensions/no-debug-non-zts-20170718/\" >> /usr/local/php/lib/php.ini \\\n && echo \"extension=mcrypt.so\" >> /usr/local/php/lib/php.ini \\\n && rm -rf /mcrypt-1.0.1 \\\n && rm -f /mcrypt-1.0.1.tgz\n#   安装memcached 依赖库igbinary http://pecl.php.net/package/igbinary\nRUN cd / \\\n && wget http://pecl.php.net/get/igbinary-2.0.6.tgz \\\n && tar -zxvf igbinary-2.0.6.tgz \\\n && cd igbinary-2.0.6 \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && make install \\\n && echo \"extension=igbinary.so\" >> /usr/local/php/lib/php.ini \\\n && rm -f /igbinary-2.0.6.tgz \\\n && rm -rf /igbinary-2.0.6\n#   安装memcached 依赖库msgpack http://pecl.php.net/package/msgpack\nRUN cd / \\\n && wget http://pecl.php.net/get/msgpack-2.0.2.tgz \\\n && tar -zxvf msgpack-2.0.2.tgz \\\n && cd msgpack-2.0.2 \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && make install \\\n && echo \"extension=msgpack.so\" >> /usr/local/php/lib/php.ini \\\n && rm -f /msgpack-2.0.2.tgz \\\n && rm -rf /msgpack-2.0.2\n#   安装redis依赖库hiredis https://github.com/redis/hiredis/releases\nRUN cd / \\\n && wget https://github.com/redis/hiredis/archive/v0.13.3.tar.gz \\\n && tar -zxvf v0.13.3.tar.gz \\\n && cd hiredis-0.13.3/ \\\n && make \\\n && make install \\\n && ldconfig \\\n && rm -f /v0.13.3.tar.gz \\\n && rm -rf /hiredis-0.13.3\n#   安装redis https://github.com/phpredis/phpredis/releases\nRUN cd / \\\n && wget https://github.com/phpredis/phpredis/archive/4.1.0RC1.tar.gz \\\n && tar -zxvf 4.1.0RC1.tar.gz \\\n && cd phpredis-4.1.0RC1/ \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && make install \\\n && echo \"extension=redis.so\" >> /usr/local/php/lib/php.ini \\\n && rm -f /4.1.0RC1.tar.gz \\\n && rm -rf /phpredis-4.1.0RC1\n#   安装 http2依赖库 nghttp2   https://github.com/nghttp2/nghttp2/releases/\nRUN cd / \\\n && wget https://github.com/nghttp2/nghttp2/releases/download/v1.32.0/nghttp2-1.32.0.tar.gz \\\n && tar -zxvf nghttp2-1.32.0.tar.gz \\\n && cd nghttp2-1.32.0/ \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -f /nghttp2-1.32.0.tar.gz \\\n && rm -rf /nghttp2-1.32.0\n#   安装swoole https://github.com/swoole/swoole-src/releases\nRUN cd / \\\n && wget https://github.com/swoole/swoole-src/archive/v4.0.0.tar.gz \\\n && tar -zxvf v4.0.0.tar.gz \\\n && cd swoole-src-4.0.0/ \\\n && /usr/local/php/bin/phpize \\\n && ./configure --enable-sockets --enable-openssl --enable-http2 --enable-async-redis --enable-timewheel --enable-mysqlnd --enable-coroutine --with-php-config=/usr/local/php/bin/php-config \\\n && make clean \\\n && make \\\n && make install \\\n && echo \"extension=swoole.so\" >> /usr/local/php/lib/php.ini \\\n && echo \"/usr/local/lib\" >> /etc/ld.so.conf \\\n && ldconfig \\\n && rm -f /v4.0.0.tar.gz \\\n && rm -rf /swoole-src-4.0.0\n#   安装memcached 依赖库 libmemcached  https://launchpad.net/libmemcached/\nRUN cd / \\\n && wget https://launchpad.net/libmemcached/1.0/1.0.18/+download/libmemcached-1.0.18.tar.gz \\\n && tar -zxvf libmemcached-1.0.18.tar.gz \\\n && cd libmemcached-1.0.18 \\\n && ./configure --prefix=/usr/local/libmemcached \\\n && make \\\n && make install \\\n && rm -f /libmemcached-1.0.18.tar.gz \\\n && rm -rf /libmemcached-1.0.18\n#   安装http://pecl.php.net/package/memcached\nRUN cd / \\\n && wget http://pecl.php.net/get/memcached-3.0.4.tgz \\\n && tar -zxvf memcached-3.0.4.tgz \\\n && cd memcached-3.0.4 \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config --with-libmemcached-dir=/usr/local/libmemcached --enable-memcached-igbinary --enable-memcached-json --enable-memcached-msgpack \\\n && make \\\n && make install \\\n && echo \"extension=memcached.so\" >> /usr/local/php/lib/php.ini \\\n && rm -f /memcached-3.0.4.tgz \\\n && rm -rf /memcached-3.0.4\n#   安装 php screw plus  https://codeload.github.com/del-xiong/screw-plus/zip/master\nRUN cd / \\\n && wget https://codeload.github.com/del-xiong/screw-plus/zip/master \\\n && unzip master \\\n && cd /screw-plus-master \\\n && /usr/local/php/bin/phpize \\\n && ./configure --with-php-config=/usr/local/php/bin/php-config \\\n && make \\\n && cp /screw-plus-master/modules/php_screw_plus.so /usr/local/php/lib/php/extensions/no-debug-non-zts-20170718/ \\\n && echo \"extension=php_screw_plus.so\" >> /usr/local/php/lib/php.ini \\\n && cd /screw-plus-master/tools \\\n && make \\\n && rm -f /master\n#  rm -rf /screw-plus-master\n#   创建好挂载目录\nRUN mkdir -p /data/php/log \\\n && mkdir -p /data/nginx/www\n#   设置时区\nRUN cp -f /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n && echo \"Asia/Shanghai\" > /etc/timezone\n#   启动php服务\nRUN chmod +x /usr/local/php/etc/php-fpm \\\n && /usr/local/php/etc/php-fpm start &\n#   设置环境变量\nENV PATH=\"$PATH:/usr/local/php/etc:/usr/local/php/bin\"\n#  设置生成容器时需要执行的脚本\n#  ENTRYPOINT [\"/usr/local/php/sbin/php-fpm\"]\nCMD [\"php-fpm\", \"start\"]\n#  开放9000端口\nEXPOSE 9000/tcp\n","originalDockerfileUglifiedHash":"b789bb81de1e99169c1b40343189ed31","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/f533842c7a8d319e0c095e1dd65ddba26413ca2b.dockerfile"}