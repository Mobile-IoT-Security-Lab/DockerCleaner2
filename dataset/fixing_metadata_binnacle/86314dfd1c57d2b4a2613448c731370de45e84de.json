{"seed":1624393844,"processedDockerfileHash":"6b2b25286f98a2834a8b9c9569611b86","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM phusion/baseimage:latest\nMAINTAINER Miloš Kozák <milos.kozak@lejmr.com>\n#   Suporting software versions\nARG IREDMAIL_VERSION=0.9.8\n#   Default values changable at startup\nARG DOMAIN=DOMAIN\nARG HOSTNAME=HOSTNAME\n#  ## Installation\n#   Prerequisites\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN echo \"APT::Install-Recommends 0;\" >> /etc/apt/apt.conf.d/01-no-recommends \\\n && echo \"APT::Install-Suggests 0;\" >> /etc/apt/apt.conf.d/01-no-recommends \\\n && apt-get update -q \\\n && apt-get upgrade -y \\\n && apt-get install --no-install-recommends apt-utils=2.6.0 -y -q \\\n && apt-get install --no-install-recommends wget=1.21.3-1ubuntu1 bzip2=1.0.8-5build1 iptables=1.8.7-1ubuntu7 openssl=3.0.8-1ubuntu1 mysql-server=8.0.32-0ubuntu4 netcat memcached=1.6.18-1 tmpreaper=1.6.17 -y -q \\\n && apt-get autoremove -y -q \\\n && apt-get clean -y -q\n#   Install of iRedMail from sources\nWORKDIR /opt/iredmail\nRUN wget -O - https://bitbucket.org/zhb/iredmail/downloads/iRedMail-\"${IREDMAIL_VERSION}\".tar.bz2 | tar xvj --strip-components=1\n#   Generate configuration file\nCOPY ./config-gen /opt/iredmail/config-gen\nRUN sh ./config-gen HOSTNAME DOMAIN > ./config\nRUN mkdir /var/run/mysql \\\n && chown mysql:mysql /var/run/mysql\n#   Initiate automatic installation process\nRUN sed s/$( hostname ;)/$HOSTNAME.$DOMAIN/ /etc/hosts > /tmp/hosts_ \\\n && cat /tmp/hosts_ > /etc/hosts \\\n && rm /tmp/hosts_ \\\n && echo $HOSTNAME > /etc/hostname \\\n && chown mysql:mysql -R /var/lib/mysql \\\n && service mysql start \\\n && IREDMAIL_DEBUG='NO' IREDMAIL_HOSTNAME=\"HOSTNAME.DOMAIN\" CHECK_NEW_IREDMAIL='NO' AUTO_USE_EXISTING_CONFIG_FILE=y AUTO_INSTALL_WITHOUT_CONFIRM=y AUTO_CLEANUP_REMOVE_SENDMAIL=y AUTO_CLEANUP_REMOVE_MOD_PYTHON=y AUTO_CLEANUP_REPLACE_FIREWALL_RULES=n AUTO_CLEANUP_RESTART_IPTABLES=n AUTO_CLEANUP_REPLACE_MYSQL_CONFIG=y AUTO_CLEANUP_RESTART_POSTFIX=n bash iRedMail.sh \\\n && apt-get autoremove -y -q \\\n && apt-get clean -y -q\n#  ## Final configuration\nRUN sed -i '/^Foreground /c Foreground true' /etc/clamav/clamd.conf \\\n && sed -i '/init.d/c pkill -sighup clamd' /etc/logrotate.d/clamav-daemon \\\n && sed -i '/^Foreground /c Foreground true' /etc/clamav/freshclam.conf \\\n && sed -i 's/^bind-address/#bind-address/' /etc/mysql/mysql.conf.d/mysqld.cnf \\\n && sed -i 's/SHOWWARNING[ \\t]*=.*/SHOWWARNING=false/g' /etc/tmpreaper.conf \\\n && install -o amavis -g amavis -m 750 -d /var/lib/amavis/.spamassassin \\\n && install -o amavis -g amavis -m 640 -T /usr/share/spamassassin/user_prefs.template /var/lib/amavis/.spamassassin/user_prefs \\\n && rm -f /etc/ssl/private/iRedMail.key \\\n && rm -f /etc/ssl/certs/iRedMail.crt \\\n && rm -f /var/lib/dkim/DOMAIN.pem\n#   Prepare for the first run\nRUN tar jcf /root/mysql.tar.bz2 /var/lib/mysql \\\n && rm -rf /var/lib/mysql \\\n && tar jcf /root/vmail.tar.bz2 /var/vmail \\\n && rm -rf /var/vmail \\\n && rm -rf /var/lib/clamav/*\nCOPY update.sh /sbin/update-iredmail\n#  ## Startup services\n#   Core Services\nCOPY rc.local /etc/rc.local\nCOPY services/mysql.sh /etc/service/mysql/run\nCOPY services/postfix.sh /etc/service/postfix/run\nCOPY services/amavis.sh /etc/service/amavis/run\nCOPY services/iredapd.sh /etc/service/iredapd/run\nCOPY services/dovecot.sh /etc/service/dovecot/run\n#   Frontend\nCOPY services/memcached.sh /etc/service/memcached/run\nCOPY services/sogo.sh /etc/service/sogo/run\nCOPY services/iredadmin.sh /etc/service/iredadmin/run\nCOPY services/php7-fpm.sh /etc/service/php7-fpm/run\nCOPY services/nginx.sh /etc/service/httpd/run\n#   Enhancement\nCOPY services/fail2ban.sh /etc/service/fail2ban/run\nCOPY services/clamav-daemon.sh /etc/service/clamav-daemon/run\nCOPY services/clamav-freshclam.sh /etc/service/clamav-freshclam/run\nCOPY services/netdata.sh /etc/service/netdata/run\nCOPY services/mlmmjadmin.sh /etc/service/mlmmjadmin/run\n#  ## Purge some packets and save disk space\nRUN apt-get purge -y -q dialog apt-utils augeas-tools \\\n && apt-get autoremove -y -q \\\n && apt-get clean -y -q \\\n && rm -rf /var/lib/apt/lists/*\n#   Open Ports:\n#   Apache: 80/tcp, 443/tcp Postfix: 25/tcp, 587/tcp\n#   Dovecot: 110/tcp, 143/tcp, 993/tcp, 995/tcp\nEXPOSE 80/tcp 443/tcp 25/tcp 587/tcp 110/tcp 143/tcp 993/tcp 995/tcp\n#   Default values changable at startup\nENV SOGO_WORKERS=\"2\"\nENV TZ=\"Etc/UTC\"\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM phusion/baseimage:latest\nMAINTAINER Miloš Kozák <milos.kozak@lejmr.com>\n#  Suporting software versions\nARG IREDMAIL_VERSION=0.9.8\n#  Default values changable at startup\nARG DOMAIN=DOMAIN\nARG HOSTNAME=HOSTNAME\n# ## Installation\n#  Prerequisites\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN echo \"APT::Install-Recommends 0;\" >> /etc/apt/apt.conf.d/01-no-recommends \\\n && echo \"APT::Install-Suggests 0;\" >> /etc/apt/apt.conf.d/01-no-recommends \\\n && apt-get update -q \\\n && apt-get upgrade -y \\\n && apt-get install apt-utils -y -q \\\n && apt-get install wget bzip2 iptables openssl mysql-server netcat memcached tmpreaper -y -q \\\n && apt-get autoremove -y -q \\\n && apt-get clean -y -q\n#  Install of iRedMail from sources\nWORKDIR /opt/iredmail\nRUN wget -O - https://bitbucket.org/zhb/iredmail/downloads/iRedMail-\"${IREDMAIL_VERSION}\".tar.bz2 | tar xvj --strip-components=1\n#  Generate configuration file\nCOPY ./config-gen /opt/iredmail/config-gen\nRUN sh ./config-gen HOSTNAME DOMAIN > ./config\nRUN mkdir /var/run/mysql \\\n && chown mysql:mysql /var/run/mysql\n#  Initiate automatic installation process\nRUN sed s/$( hostname ;)/$HOSTNAME.$DOMAIN/ /etc/hosts > /tmp/hosts_ \\\n && cat /tmp/hosts_ > /etc/hosts \\\n && rm /tmp/hosts_ \\\n && echo $HOSTNAME > /etc/hostname \\\n && chown mysql:mysql -R /var/lib/mysql \\\n && service mysql start \\\n && IREDMAIL_DEBUG='NO' IREDMAIL_HOSTNAME=\"HOSTNAME.DOMAIN\" CHECK_NEW_IREDMAIL='NO' AUTO_USE_EXISTING_CONFIG_FILE=y AUTO_INSTALL_WITHOUT_CONFIRM=y AUTO_CLEANUP_REMOVE_SENDMAIL=y AUTO_CLEANUP_REMOVE_MOD_PYTHON=y AUTO_CLEANUP_REPLACE_FIREWALL_RULES=n AUTO_CLEANUP_RESTART_IPTABLES=n AUTO_CLEANUP_REPLACE_MYSQL_CONFIG=y AUTO_CLEANUP_RESTART_POSTFIX=n bash iRedMail.sh \\\n && apt-get autoremove -y -q \\\n && apt-get clean -y -q\n# ## Final configuration\nRUN sed -i '/^Foreground /c Foreground true' /etc/clamav/clamd.conf \\\n && sed -i '/init.d/c pkill -sighup clamd' /etc/logrotate.d/clamav-daemon \\\n && sed -i '/^Foreground /c Foreground true' /etc/clamav/freshclam.conf \\\n && sed -i 's/^bind-address/#bind-address/' /etc/mysql/mysql.conf.d/mysqld.cnf \\\n && sed -i 's/SHOWWARNING[ \\t]*=.*/SHOWWARNING=false/g' /etc/tmpreaper.conf \\\n && install -o amavis -g amavis -m 750 -d /var/lib/amavis/.spamassassin \\\n && install -o amavis -g amavis -m 640 -T /usr/share/spamassassin/user_prefs.template /var/lib/amavis/.spamassassin/user_prefs \\\n && rm -f /etc/ssl/private/iRedMail.key \\\n && rm -f /etc/ssl/certs/iRedMail.crt \\\n && rm -f /var/lib/dkim/DOMAIN.pem\n#  Prepare for the first run\nRUN tar jcf /root/mysql.tar.bz2 /var/lib/mysql \\\n && rm -rf /var/lib/mysql \\\n && tar jcf /root/vmail.tar.bz2 /var/vmail \\\n && rm -rf /var/vmail \\\n && rm -rf /var/lib/clamav/*\nADD update.sh /sbin/update-iredmail\n# ## Startup services\n#  Core Services\nADD rc.local /etc/rc.local\nADD services/mysql.sh /etc/service/mysql/run\nADD services/postfix.sh /etc/service/postfix/run\nADD services/amavis.sh /etc/service/amavis/run\nADD services/iredapd.sh /etc/service/iredapd/run\nADD services/dovecot.sh /etc/service/dovecot/run\n#  Frontend\nADD services/memcached.sh /etc/service/memcached/run\nADD services/sogo.sh /etc/service/sogo/run\nADD services/iredadmin.sh /etc/service/iredadmin/run\nADD services/php7-fpm.sh /etc/service/php7-fpm/run\nADD services/nginx.sh /etc/service/httpd/run\n#  Enhancement\nADD services/fail2ban.sh /etc/service/fail2ban/run\nADD services/clamav-daemon.sh /etc/service/clamav-daemon/run\nADD services/clamav-freshclam.sh /etc/service/clamav-freshclam/run\nADD services/netdata.sh /etc/service/netdata/run\nADD services/mlmmjadmin.sh /etc/service/mlmmjadmin/run\n# ## Purge some packets and save disk space\nRUN apt-get purge -y -q dialog apt-utils augeas-tools \\\n && apt-get autoremove -y -q \\\n && apt-get clean -y -q \\\n && rm -rf /var/lib/apt/lists/*\n#  Open Ports:\n#  Apache: 80/tcp, 443/tcp Postfix: 25/tcp, 587/tcp\n#  Dovecot: 110/tcp, 143/tcp, 993/tcp, 995/tcp\nEXPOSE 80/tcp 443/tcp 25/tcp 587/tcp 110/tcp 143/tcp 993/tcp 995/tcp\n#  Default values changable at startup\nENV SOGO_WORKERS=\"2\"\nENV TZ=\"Etc/UTC\"\n","injectedSmells":[],"originalDockerfileHash":"1c6c29d646500aa827aaf78660d24874","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM phusion/baseimage:latest\nMAINTAINER Miloš Kozák <milos.kozak@lejmr.com>\n#   Suporting software versions\nARG IREDMAIL_VERSION=0.9.8\n#   Default values changable at startup\nARG DOMAIN=DOMAIN\nARG HOSTNAME=HOSTNAME\n#  ## Installation\n#   Prerequisites\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN echo \"APT::Install-Recommends 0;\" >> /etc/apt/apt.conf.d/01-no-recommends \\\n && echo \"APT::Install-Suggests 0;\" >> /etc/apt/apt.conf.d/01-no-recommends \\\n && apt-get update -q \\\n && apt-get upgrade -y \\\n && apt-get install apt-utils -y -q \\\n && apt-get install wget bzip2 iptables openssl mysql-server netcat memcached tmpreaper -y -q \\\n && apt-get autoremove -y -q \\\n && apt-get clean -y -q\n#   Install of iRedMail from sources\nWORKDIR /opt/iredmail\nRUN wget -O - https://bitbucket.org/zhb/iredmail/downloads/iRedMail-\"${IREDMAIL_VERSION}\".tar.bz2 | tar xvj --strip-components=1\n#   Generate configuration file\nCOPY ./config-gen /opt/iredmail/config-gen\nRUN sh ./config-gen HOSTNAME DOMAIN > ./config\nRUN mkdir /var/run/mysql \\\n && chown mysql:mysql /var/run/mysql\n#   Initiate automatic installation process\nRUN sed s/$( hostname ;)/$HOSTNAME.$DOMAIN/ /etc/hosts > /tmp/hosts_ \\\n && cat /tmp/hosts_ > /etc/hosts \\\n && rm /tmp/hosts_ \\\n && echo $HOSTNAME > /etc/hostname \\\n && chown mysql:mysql -R /var/lib/mysql \\\n && service mysql start \\\n && IREDMAIL_DEBUG='NO' IREDMAIL_HOSTNAME=\"HOSTNAME.DOMAIN\" CHECK_NEW_IREDMAIL='NO' AUTO_USE_EXISTING_CONFIG_FILE=y AUTO_INSTALL_WITHOUT_CONFIRM=y AUTO_CLEANUP_REMOVE_SENDMAIL=y AUTO_CLEANUP_REMOVE_MOD_PYTHON=y AUTO_CLEANUP_REPLACE_FIREWALL_RULES=n AUTO_CLEANUP_RESTART_IPTABLES=n AUTO_CLEANUP_REPLACE_MYSQL_CONFIG=y AUTO_CLEANUP_RESTART_POSTFIX=n bash iRedMail.sh \\\n && apt-get autoremove -y -q \\\n && apt-get clean -y -q\n#  ## Final configuration\nRUN sed -i '/^Foreground /c Foreground true' /etc/clamav/clamd.conf \\\n && sed -i '/init.d/c pkill -sighup clamd' /etc/logrotate.d/clamav-daemon \\\n && sed -i '/^Foreground /c Foreground true' /etc/clamav/freshclam.conf \\\n && sed -i 's/^bind-address/#bind-address/' /etc/mysql/mysql.conf.d/mysqld.cnf \\\n && sed -i 's/SHOWWARNING[ \\t]*=.*/SHOWWARNING=false/g' /etc/tmpreaper.conf \\\n && install -o amavis -g amavis -m 750 -d /var/lib/amavis/.spamassassin \\\n && install -o amavis -g amavis -m 640 -T /usr/share/spamassassin/user_prefs.template /var/lib/amavis/.spamassassin/user_prefs \\\n && rm -f /etc/ssl/private/iRedMail.key \\\n && rm -f /etc/ssl/certs/iRedMail.crt \\\n && rm -f /var/lib/dkim/DOMAIN.pem\n#   Prepare for the first run\nRUN tar jcf /root/mysql.tar.bz2 /var/lib/mysql \\\n && rm -rf /var/lib/mysql \\\n && tar jcf /root/vmail.tar.bz2 /var/vmail \\\n && rm -rf /var/vmail \\\n && rm -rf /var/lib/clamav/*\nADD update.sh /sbin/update-iredmail\n#  ## Startup services\n#   Core Services\nADD rc.local /etc/rc.local\nADD services/mysql.sh /etc/service/mysql/run\nADD services/postfix.sh /etc/service/postfix/run\nADD services/amavis.sh /etc/service/amavis/run\nADD services/iredapd.sh /etc/service/iredapd/run\nADD services/dovecot.sh /etc/service/dovecot/run\n#   Frontend\nADD services/memcached.sh /etc/service/memcached/run\nADD services/sogo.sh /etc/service/sogo/run\nADD services/iredadmin.sh /etc/service/iredadmin/run\nADD services/php7-fpm.sh /etc/service/php7-fpm/run\nADD services/nginx.sh /etc/service/httpd/run\n#   Enhancement\nADD services/fail2ban.sh /etc/service/fail2ban/run\nADD services/clamav-daemon.sh /etc/service/clamav-daemon/run\nADD services/clamav-freshclam.sh /etc/service/clamav-freshclam/run\nADD services/netdata.sh /etc/service/netdata/run\nADD services/mlmmjadmin.sh /etc/service/mlmmjadmin/run\n#  ## Purge some packets and save disk space\nRUN apt-get purge -y -q dialog apt-utils augeas-tools \\\n && apt-get autoremove -y -q \\\n && apt-get clean -y -q \\\n && rm -rf /var/lib/apt/lists/*\n#   Open Ports:\n#   Apache: 80/tcp, 443/tcp Postfix: 25/tcp, 587/tcp\n#   Dovecot: 110/tcp, 143/tcp, 993/tcp, 995/tcp\nEXPOSE 80/tcp 443/tcp 25/tcp 587/tcp 110/tcp 143/tcp 993/tcp 995/tcp\n#   Default values changable at startup\nENV SOGO_WORKERS=\"2\"\nENV TZ=\"Etc/UTC\"\n","originalDockerfileUglifiedHash":"5e3f7e5217187e1622ad9f518cbf7db8","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/86314dfd1c57d2b4a2613448c731370de45e84de.dockerfile"}