{"seed":229161801,"processedDockerfileHash":"30faf362a324f8fc2aef966f176a3f3e","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   Copyright (C) 2018 VyOS maintainers and contributors\n#\n#   This program is free software; you can redistribute it and/or modify\n#   in order to easy exprort images built to \"external\" world\n#   it under the terms of the GNU General Public License version 2 or later as\n#   published by the Free Software Foundation.\n#\n#   This program is distributed in the hope that it will be useful,\n#   but WITHOUT ANY WARRANTY; without even the implied warranty of\n#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#   GNU General Public License for more details.\n#\n#   You should have received a copy of the GNU General Public License\n#   along with this program.  If not, see <http://www.gnu.org/licenses/>.\n#   Must be run with --privileged flag, recommended to run the container with a\n#   volume mapped in order to easy export images\nFROM multiarch/debian-debootstrap:armhf-jessie-slim\nLABEL authors=\"VyOS Maintainers <maintainers@vyos.io>\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\nCOPY no--check-valid-until /etc/apt/apt.conf.d/\nRUN echo \"deb http://deb.debian.org/debian jessie main\" > /etc/apt/sources.list \\\n && echo \"deb http://security.debian.org/debian-security jessie/updates main\" >> /etc/apt/sources.list\n#   Standard shell should be bash not dash\nRUN echo \"dash dash/sh boolean false\" | debconf-set-selections \\\n && dpkg-reconfigure dash\nRUN apt-get update \\\n && apt-get install --no-install-recommends dialog apt-utils locales -y\nRUN echo \"en_US.UTF-8 UTF-8\" > /etc/locale.gen \\\n && locale-gen\nENV LANG=\"en_US.utf8\"\nRUN apt-get update \\\n && apt-get install --no-install-recommends vim git curl make sudo mc pbuilder devscripts squashfs-tools autoconf automake dpkg-dev genisoimage lsb-release fakechroot libtool libapt-pkg-dev parted kpartx quilt python3-lxml python3-setuptools python3-nose python3-coverage python3-sphinx python3-pystache pkg-config debhelper jq -y\n#\n#   Setup Debian Jessie Backports repository\n#\nCOPY no--check-valid-until /etc/apt/apt.conf.d/\nRUN echo \"deb http://archive.debian.org/debian/ jessie-backports main\" > /etc/apt/sources.list.d/jessie-backports.list\nRUN apt-get update \\\n && apt-get install --no-install-recommends jessie-backports python3-git python3-pip -y -t\nRUN echo \"deb http://deb.debian.org/debian buster main\" > /etc/apt/sources.list.d/buster.list\nRUN apt-get update \\\n && apt-get install --no-install-recommends golang gosu -y\nRUN rm -f /etc/apt/sources.list.d/buster.list\n#   Package needed for mdns-repeater\nRUN apt-get update \\\n && apt-get install --no-install-recommends jessie-backports dh-systemd -y -t\n#\n#   Remove Debian Jessie Backports repository\n#\nRUN rm -f /etc/apt/sources.list.d/jessie-backports.list /etc/apt/apt.conf.d/no--check-valid-until\n#\n#   Building libvyosconf requires a full configured OPAM/OCaml setup\n#\nRUN apt-get update \\\n && apt-get install --no-install-recommends libffi-dev libpcre3-dev -y\nRUN curl https://raw.githubusercontent.com/ocaml/opam/2.0.2/shell/install.sh --output /tmp/opam_install.sh \\\n && sed -i 's/read BINDIR/BINDIR=\"\"/' /tmp/opam_install.sh \\\n && sh /tmp/opam_install.sh \\\n && opam init --root=/opt/opam --comp=4.07.0 --disable-sandboxing\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && opam install -y oasis\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && opam install -y fileutils lwt lwt_ppx lwt_log ocplib-endian ounit pcre ppx_deriving_yojson sha toml xml-light batteries ocaml-protoc ctypes-foreign menhir\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && opam install -y ctypes\n#   Build VyConf which is required to build libvyosconfig\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && opam pin add vyconf https://github.com/vyos/vyconf.git#51d79a3f -y\n#   Build libvyosconfig\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && git clone https://github.com/vyos/libvyosconfig.git \\\n && cd libvyosconfig \\\n && git checkout 9a80a5d3 \\\n && dpkg-buildpackage -uc -us -tc -b \\\n && dpkg -i ../libvyosconfig0_*_armhf.deb\n#   Packages needed for vyatta-cfg\nRUN apt-get update \\\n && apt-get install --no-install-recommends libglib2.0-dev libperl-dev libboost-filesystem-dev -y\n#   Packages needed for vyatta-iproute\nRUN apt-get update \\\n && apt-get install --no-install-recommends libatm1-dev libdb-dev iptables-dev -y\n#   Packages needed for vyatta-webgui\nRUN apt-get update \\\n && apt-get install --no-install-recommends libexpat1-dev subversion -y\n#   Packages needed for pmacct\nRUN apt-get update \\\n && apt-get install --no-install-recommends libpcap-dev libpq-dev libmysqlclient-dev libgeoip-dev librabbitmq-dev libjansson-dev librdkafka-dev libnetfilter-log-dev -y\n#   Pavkages needed for wireguard\nRUN apt-get update \\\n && apt-get install --no-install-recommends libmnl-dev -y\n#   Packages needed for kernel\nRUN apt-get update \\\n && apt-get install --no-install-recommends kernel-package libncurses5-dev flex bison libelf-dev -y\n#   Packages needed for vyos-accel-ppp\nRUN apt-get update \\\n && apt-get install --no-install-recommends cdbs cmake liblua5.1-dev -y\n#   Prerequisites for building rtrlib\n#   see http://docs.frrouting.org/projects/dev-guide/en/latest/building-frr-for-debian8.html\nRUN apt-get update \\\n && apt-get install --no-install-recommends doxygen libssh-dev libssl-dev -y\n#   Build rtrlib release 0.6.3\nRUN export RTRLIB_VERSION=\"0.6.3\" \\\n && wget -P /tmp https://github.com/rtrlib/rtrlib/archive/v${RTRLIB_VERSION}.tar.gz \\\n && tar xf /tmp/v${RTRLIB_VERSION}.tar.gz -C /tmp \\\n && cd /tmp/rtrlib-${RTRLIB_VERSION} \\\n && dpkg-buildpackage -uc -us -tc -b \\\n && dpkg -i ../librtr*_armhf.deb ../librtr*_all.deb\n#\n#   Setup VyOS Debian repository\n#\nCOPY vyos-dev.key /tmp/vyos-dev.key\nRUN apt-key add /tmp/vyos-dev.key\nRUN echo \"deb http://dev.packages.vyos.net/repositories/current/debian/ current main\" > /etc/apt/sources.list.d/vyos.list\n#   Packages needed to build frr itself\n#   libyang-dev packages are hsoted on dev.packages.vyos.net see\n#   https://github.com/FRRouting/frr/blob/master/doc/developer/building-libyang.rst\n#   for more info\nRUN apt-get update \\\n && apt-get install --no-install-recommends libyang-dev libyang0.16 chrpath install-info libjson-c-dev libpython3-dev python3-dev python3-pytest texinfo -y\n#\n#   Cleanup VyOS Debian Repository\n#\nRUN rm -f /etc/apt/sources.list.d/vyos.list\n#   Packages needed for conntrack-tools\nRUN apt-get update \\\n && apt-get install --no-install-recommends libnetfilter-conntrack-dev libnetfilter-cthelper0-dev libnetfilter-cttimeout-dev libnetfilter-queue-dev -y\n#   Packages needed for hvinfo\nRUN apt-get update \\\n && apt-get install --no-install-recommends gnat gprbuild -y\n#   Packages needed for vyos-1x\nRUN apt-get update \\\n && apt-get install --no-install-recommends whois -y\n#   Packages needed for ipaddrcheck\nRUN apt-get update \\\n && apt-get install --no-install-recommends check -y\n#   As there is no Debian Jessie/Stretch package for libcidr available but this\n#   is required for ipaddrcheck we have to build it from source\nRUN git clone https://github.com/wikimedia/analytics-libcidr.git \\\n && cd analytics-libcidr \\\n && git checkout 026c611d90a1 \\\n && dpkg-buildpackage -uc -us -tc -b \\\n && dpkg -i ../libcidr*.deb\n#   Packages needed for lldpd\nRUN apt-get update \\\n && apt-get install --no-install-recommends libbsd-dev libevent-dev -y\n#   Packages needed for vyatta-quagga\nRUN apt-get update \\\n && apt-get install --no-install-recommends libpam-dev libcap-dev libsnmp-dev gawk -y\n#   Packages needed for vyos-strongswan\nRUN apt-get update \\\n && apt-get install --no-install-recommends libkrb5-dev libssl-dev libxml2-dev systemd libcurl4-openssl-dev libgcrypt20-dev libgmp3-dev libldap2-dev libsqlite3-dev dh-apparmor gperf libsystemd-dev python3-stdeb python-setuptools -y\n#   Packages needed for vyos-opennhrp\nRUN apt-get update \\\n && apt-get install --no-install-recommends libc-ares-dev -y\n#   Packages needed for ddclient\nRUN apt-get update \\\n && apt-get install --no-install-recommends xmlto -y\n#   Packages needed for keepalived\nRUN apt-get update \\\n && apt-get install --no-install-recommends libnl-3-200 libnl-3-dev libnl-nf-3-200 libnl-nf-3-dev libipset-dev libnl-genl-3-200 libnl-genl-3-dev libpopt-dev -y\n#   Packages needed for net-snmp\nRUN apt-get update \\\n && apt-get install --no-install-recommends python-all python2.7-dev libmysqld-dev -y\n#   Update live-build\nRUN echo 'deb http://ftp.debian.org/debian stretch main' | tee -a /etc/apt/sources.list.d/stretch.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends stretch live-build -y -t \\\n && rm -f /etc/apt/sources.list.d/stretch.list \\\n && apt-get update \\\n && rm -rf /var/lib/apt/lists/*\n#   Install packer\nRUN export LATEST=\"$( curl -s https://checkpoint-api.hashicorp.com/v1/check/packer | jq -r -M '.current_version' ;)\" ; echo \"url https://releases.hashicorp.com/packer/\"$LATEST\"/packer_\"$LATEST\"_linux_arm.zip\" | curl -K- | gzip -d > /usr/bin/packer \\\n && chmod +x /usr/bin/packer\n#   Allow password-less 'sudo' for all users in group 'sudo'\nRUN sed \"s/^%sudo.*/%sudo\\tALL=(ALL) NOPASSWD:ALL/g\" -i /etc/sudoers \\\n && chmod a+s /usr/sbin/useradd /usr/sbin/groupadd /usr/sbin/gosu /usr/sbin/usermod\n#   Ensure sure all users have access to our OCAM installation\nRUN echo \"$( opam env --root=/opt/opam --set-root ;)\" >> /etc/skel/.bashrc\n#   Cleanup\nRUN rm -rf /tmp/*\nCOPY entrypoint.sh /usr/local/bin/entrypoint.sh\nENTRYPOINT [\"/usr/local/bin/entrypoint.sh\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  Copyright (C) 2018 VyOS maintainers and contributors\n#\n#  This program is free software; you can redistribute it and/or modify\n#  in order to easy exprort images built to \"external\" world\n#  it under the terms of the GNU General Public License version 2 or later as\n#  published by the Free Software Foundation.\n#\n#  This program is distributed in the hope that it will be useful,\n#  but WITHOUT ANY WARRANTY; without even the implied warranty of\n#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#  GNU General Public License for more details.\n#\n#  You should have received a copy of the GNU General Public License\n#  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n#  Must be run with --privileged flag, recommended to run the container with a\n#  volume mapped in order to easy export images\nFROM multiarch/debian-debootstrap:armhf-jessie-slim\nLABEL authors=\"VyOS Maintainers <maintainers@vyos.io>\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\nCOPY no--check-valid-until /etc/apt/apt.conf.d/\nRUN echo \"deb http://deb.debian.org/debian jessie main\" > /etc/apt/sources.list \\\n && echo \"deb http://security.debian.org/debian-security jessie/updates main\" >> /etc/apt/sources.list\n#  Standard shell should be bash not dash\nRUN echo \"dash dash/sh boolean false\" | debconf-set-selections \\\n && dpkg-reconfigure dash\nRUN apt-get update \\\n && apt-get install dialog apt-utils locales -y\nRUN echo \"en_US.UTF-8 UTF-8\" > /etc/locale.gen \\\n && locale-gen\nENV LANG=\"en_US.utf8\"\nRUN apt-get update \\\n && apt-get install vim git curl make sudo mc pbuilder devscripts squashfs-tools autoconf automake dpkg-dev genisoimage lsb-release fakechroot libtool libapt-pkg-dev parted kpartx quilt python3-lxml python3-setuptools python3-nose python3-coverage python3-sphinx python3-pystache pkg-config debhelper jq -y\n#\n#  Setup Debian Jessie Backports repository\n#\nCOPY no--check-valid-until /etc/apt/apt.conf.d/\nRUN echo \"deb http://archive.debian.org/debian/ jessie-backports main\" > /etc/apt/sources.list.d/jessie-backports.list\nRUN apt-get update \\\n && apt-get install jessie-backports python3-git python3-pip -y -t\nRUN echo \"deb http://deb.debian.org/debian buster main\" > /etc/apt/sources.list.d/buster.list\nRUN apt-get update \\\n && apt-get install golang gosu -y\nRUN rm -f /etc/apt/sources.list.d/buster.list\n#  Package needed for mdns-repeater\nRUN apt-get update \\\n && apt-get install jessie-backports dh-systemd -y -t\n#\n#  Remove Debian Jessie Backports repository\n#\nRUN rm -f /etc/apt/sources.list.d/jessie-backports.list /etc/apt/apt.conf.d/no--check-valid-until\n#\n#  Building libvyosconf requires a full configured OPAM/OCaml setup\n#\nRUN apt-get update \\\n && apt-get install libffi-dev libpcre3-dev -y\nRUN curl https://raw.githubusercontent.com/ocaml/opam/2.0.2/shell/install.sh --output /tmp/opam_install.sh \\\n && sed -i 's/read BINDIR/BINDIR=\"\"/' /tmp/opam_install.sh \\\n && sh /tmp/opam_install.sh \\\n && opam init --root=/opt/opam --comp=4.07.0 --disable-sandboxing\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && opam install -y oasis\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && opam install -y fileutils lwt lwt_ppx lwt_log ocplib-endian ounit pcre ppx_deriving_yojson sha toml xml-light batteries ocaml-protoc ctypes-foreign menhir\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && opam install -y ctypes\n#  Build VyConf which is required to build libvyosconfig\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && opam pin add vyconf https://github.com/vyos/vyconf.git#51d79a3f -y\n#  Build libvyosconfig\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && git clone https://github.com/vyos/libvyosconfig.git \\\n && cd libvyosconfig \\\n && git checkout 9a80a5d3 \\\n && dpkg-buildpackage -uc -us -tc -b \\\n && dpkg -i ../libvyosconfig0_*_armhf.deb\n#  Packages needed for vyatta-cfg\nRUN apt-get update \\\n && apt-get install libglib2.0-dev libperl-dev libboost-filesystem-dev -y\n#  Packages needed for vyatta-iproute\nRUN apt-get update \\\n && apt-get install libatm1-dev libdb-dev iptables-dev -y\n#  Packages needed for vyatta-webgui\nRUN apt-get update \\\n && apt-get install libexpat1-dev subversion -y\n#  Packages needed for pmacct\nRUN apt-get update \\\n && apt-get install libpcap-dev libpq-dev libmysqlclient-dev libgeoip-dev librabbitmq-dev libjansson-dev librdkafka-dev libnetfilter-log-dev -y\n#  Pavkages needed for wireguard\nRUN apt-get update \\\n && apt-get install libmnl-dev -y\n#  Packages needed for kernel\nRUN apt-get update \\\n && apt-get install kernel-package libncurses5-dev flex bison libelf-dev -y\n#  Packages needed for vyos-accel-ppp\nRUN apt-get update \\\n && apt-get install cdbs cmake liblua5.1-dev -y\n#  Prerequisites for building rtrlib\n#  see http://docs.frrouting.org/projects/dev-guide/en/latest/building-frr-for-debian8.html\nRUN apt-get update \\\n && apt-get install doxygen libssh-dev libssl-dev -y\n#  Build rtrlib release 0.6.3\nRUN export RTRLIB_VERSION=\"0.6.3\" \\\n && wget -P /tmp https://github.com/rtrlib/rtrlib/archive/v${RTRLIB_VERSION}.tar.gz \\\n && tar xf /tmp/v${RTRLIB_VERSION}.tar.gz -C /tmp \\\n && cd /tmp/rtrlib-${RTRLIB_VERSION} \\\n && dpkg-buildpackage -uc -us -tc -b \\\n && dpkg -i ../librtr*_armhf.deb ../librtr*_all.deb\n#\n#  Setup VyOS Debian repository\n#\nCOPY vyos-dev.key /tmp/vyos-dev.key\nRUN apt-key add /tmp/vyos-dev.key\nRUN echo \"deb http://dev.packages.vyos.net/repositories/current/debian/ current main\" > /etc/apt/sources.list.d/vyos.list\n#  Packages needed to build frr itself\n#  libyang-dev packages are hsoted on dev.packages.vyos.net see\n#  https://github.com/FRRouting/frr/blob/master/doc/developer/building-libyang.rst\n#  for more info\nRUN apt-get update \\\n && apt-get install libyang-dev libyang0.16 chrpath install-info libjson-c-dev libpython3-dev python3-dev python3-pytest texinfo -y\n#\n#  Cleanup VyOS Debian Repository\n#\nRUN rm -f /etc/apt/sources.list.d/vyos.list\n#  Packages needed for conntrack-tools\nRUN apt-get update \\\n && apt-get install libnetfilter-conntrack-dev libnetfilter-cthelper0-dev libnetfilter-cttimeout-dev libnetfilter-queue-dev -y\n#  Packages needed for hvinfo\nRUN apt-get update \\\n && apt-get install gnat gprbuild -y\n#  Packages needed for vyos-1x\nRUN apt-get update \\\n && apt-get install whois -y\n#  Packages needed for ipaddrcheck\nRUN apt-get update \\\n && apt-get install check -y\n#  As there is no Debian Jessie/Stretch package for libcidr available but this\n#  is required for ipaddrcheck we have to build it from source\nRUN git clone https://github.com/wikimedia/analytics-libcidr.git \\\n && cd analytics-libcidr \\\n && git checkout 026c611d90a1 \\\n && dpkg-buildpackage -uc -us -tc -b \\\n && dpkg -i ../libcidr*.deb\n#  Packages needed for lldpd\nRUN apt-get update \\\n && apt-get install libbsd-dev libevent-dev -y\n#  Packages needed for vyatta-quagga\nRUN apt-get update \\\n && apt-get install libpam-dev libcap-dev libsnmp-dev gawk -y\n#  Packages needed for vyos-strongswan\nRUN apt-get update \\\n && apt-get install libkrb5-dev libssl-dev libxml2-dev systemd libcurl4-openssl-dev libgcrypt20-dev libgmp3-dev libldap2-dev libsqlite3-dev dh-apparmor gperf libsystemd-dev python3-stdeb python-setuptools -y\n#  Packages needed for vyos-opennhrp\nRUN apt-get update \\\n && apt-get install libc-ares-dev -y\n#  Packages needed for ddclient\nRUN apt-get update \\\n && apt-get install xmlto -y\n#  Packages needed for keepalived\nRUN apt-get update \\\n && apt-get install libnl-3-200 libnl-3-dev libnl-nf-3-200 libnl-nf-3-dev libipset-dev libnl-genl-3-200 libnl-genl-3-dev libpopt-dev -y\n#  Packages needed for net-snmp\nRUN apt-get update \\\n && apt-get install python-all python2.7-dev libmysqld-dev -y\n#  Update live-build\nRUN echo 'deb http://ftp.debian.org/debian stretch main' | tee -a /etc/apt/sources.list.d/stretch.list \\\n && apt-get update \\\n && apt-get install stretch live-build -y -t \\\n && rm -f /etc/apt/sources.list.d/stretch.list \\\n && apt-get update \\\n && rm -rf /var/lib/apt/lists/*\n#  Install packer\nRUN export LATEST=\"$( curl -s https://checkpoint-api.hashicorp.com/v1/check/packer | jq -r -M '.current_version' ;)\" ; echo \"url https://releases.hashicorp.com/packer/\"$LATEST\"/packer_\"$LATEST\"_linux_arm.zip\" | curl -K- | gzip -d > /usr/bin/packer \\\n && chmod +x /usr/bin/packer\n#  Allow password-less 'sudo' for all users in group 'sudo'\nRUN sed \"s/^%sudo.*/%sudo\\tALL=(ALL) NOPASSWD:ALL/g\" -i /etc/sudoers \\\n && chmod a+s /usr/sbin/useradd /usr/sbin/groupadd /usr/sbin/gosu /usr/sbin/usermod\n#  Ensure sure all users have access to our OCAM installation\nRUN echo \"$( opam env --root=/opt/opam --set-root ;)\" >> /etc/skel/.bashrc\n#  Cleanup\nRUN rm -rf /tmp/*\nCOPY entrypoint.sh /usr/local/bin/entrypoint.sh\nENTRYPOINT [\"/usr/local/bin/entrypoint.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"605f1bb10d97f31c17b22a1f0da8bb49","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   Copyright (C) 2018 VyOS maintainers and contributors\n#\n#   This program is free software; you can redistribute it and/or modify\n#   in order to easy exprort images built to \"external\" world\n#   it under the terms of the GNU General Public License version 2 or later as\n#   published by the Free Software Foundation.\n#\n#   This program is distributed in the hope that it will be useful,\n#   but WITHOUT ANY WARRANTY; without even the implied warranty of\n#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#   GNU General Public License for more details.\n#\n#   You should have received a copy of the GNU General Public License\n#   along with this program.  If not, see <http://www.gnu.org/licenses/>.\n#   Must be run with --privileged flag, recommended to run the container with a\n#   volume mapped in order to easy export images\nFROM multiarch/debian-debootstrap:armhf-jessie-slim\nLABEL authors=\"VyOS Maintainers <maintainers@vyos.io>\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\nCOPY no--check-valid-until /etc/apt/apt.conf.d/\nRUN echo \"deb http://deb.debian.org/debian jessie main\" > /etc/apt/sources.list \\\n && echo \"deb http://security.debian.org/debian-security jessie/updates main\" >> /etc/apt/sources.list\n#   Standard shell should be bash not dash\nRUN echo \"dash dash/sh boolean false\" | debconf-set-selections \\\n && dpkg-reconfigure dash\nRUN apt-get update \\\n && apt-get install dialog apt-utils locales -y\nRUN echo \"en_US.UTF-8 UTF-8\" > /etc/locale.gen \\\n && locale-gen\nENV LANG=\"en_US.utf8\"\nRUN apt-get update \\\n && apt-get install vim git curl make sudo mc pbuilder devscripts squashfs-tools autoconf automake dpkg-dev genisoimage lsb-release fakechroot libtool libapt-pkg-dev parted kpartx quilt python3-lxml python3-setuptools python3-nose python3-coverage python3-sphinx python3-pystache pkg-config debhelper jq -y\n#\n#   Setup Debian Jessie Backports repository\n#\nCOPY no--check-valid-until /etc/apt/apt.conf.d/\nRUN echo \"deb http://archive.debian.org/debian/ jessie-backports main\" > /etc/apt/sources.list.d/jessie-backports.list\nRUN apt-get update \\\n && apt-get install jessie-backports python3-git python3-pip -y -t\nRUN echo \"deb http://deb.debian.org/debian buster main\" > /etc/apt/sources.list.d/buster.list\nRUN apt-get update \\\n && apt-get install golang gosu -y\nRUN rm -f /etc/apt/sources.list.d/buster.list\n#   Package needed for mdns-repeater\nRUN apt-get update \\\n && apt-get install jessie-backports dh-systemd -y -t\n#\n#   Remove Debian Jessie Backports repository\n#\nRUN rm -f /etc/apt/sources.list.d/jessie-backports.list /etc/apt/apt.conf.d/no--check-valid-until\n#\n#   Building libvyosconf requires a full configured OPAM/OCaml setup\n#\nRUN apt-get update \\\n && apt-get install libffi-dev libpcre3-dev -y\nRUN curl https://raw.githubusercontent.com/ocaml/opam/2.0.2/shell/install.sh --output /tmp/opam_install.sh \\\n && sed -i 's/read BINDIR/BINDIR=\"\"/' /tmp/opam_install.sh \\\n && sh /tmp/opam_install.sh \\\n && opam init --root=/opt/opam --comp=4.07.0 --disable-sandboxing\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && opam install -y oasis\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && opam install -y fileutils lwt lwt_ppx lwt_log ocplib-endian ounit pcre ppx_deriving_yojson sha toml xml-light batteries ocaml-protoc ctypes-foreign menhir\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && opam install -y ctypes\n#   Build VyConf which is required to build libvyosconfig\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && opam pin add vyconf https://github.com/vyos/vyconf.git#51d79a3f -y\n#   Build libvyosconfig\nRUN eval $( opam env --root=/opt/opam --set-root ;) \\\n && git clone https://github.com/vyos/libvyosconfig.git \\\n && cd libvyosconfig \\\n && git checkout 9a80a5d3 \\\n && dpkg-buildpackage -uc -us -tc -b \\\n && dpkg -i ../libvyosconfig0_*_armhf.deb\n#   Packages needed for vyatta-cfg\nRUN apt-get update \\\n && apt-get install libglib2.0-dev libperl-dev libboost-filesystem-dev -y\n#   Packages needed for vyatta-iproute\nRUN apt-get update \\\n && apt-get install libatm1-dev libdb-dev iptables-dev -y\n#   Packages needed for vyatta-webgui\nRUN apt-get update \\\n && apt-get install libexpat1-dev subversion -y\n#   Packages needed for pmacct\nRUN apt-get update \\\n && apt-get install libpcap-dev libpq-dev libmysqlclient-dev libgeoip-dev librabbitmq-dev libjansson-dev librdkafka-dev libnetfilter-log-dev -y\n#   Pavkages needed for wireguard\nRUN apt-get update \\\n && apt-get install libmnl-dev -y\n#   Packages needed for kernel\nRUN apt-get update \\\n && apt-get install kernel-package libncurses5-dev flex bison libelf-dev -y\n#   Packages needed for vyos-accel-ppp\nRUN apt-get update \\\n && apt-get install cdbs cmake liblua5.1-dev -y\n#   Prerequisites for building rtrlib\n#   see http://docs.frrouting.org/projects/dev-guide/en/latest/building-frr-for-debian8.html\nRUN apt-get update \\\n && apt-get install doxygen libssh-dev libssl-dev -y\n#   Build rtrlib release 0.6.3\nRUN export RTRLIB_VERSION=\"0.6.3\" \\\n && wget -P /tmp https://github.com/rtrlib/rtrlib/archive/v${RTRLIB_VERSION}.tar.gz \\\n && tar xf /tmp/v${RTRLIB_VERSION}.tar.gz -C /tmp \\\n && cd /tmp/rtrlib-${RTRLIB_VERSION} \\\n && dpkg-buildpackage -uc -us -tc -b \\\n && dpkg -i ../librtr*_armhf.deb ../librtr*_all.deb\n#\n#   Setup VyOS Debian repository\n#\nCOPY vyos-dev.key /tmp/vyos-dev.key\nRUN apt-key add /tmp/vyos-dev.key\nRUN echo \"deb http://dev.packages.vyos.net/repositories/current/debian/ current main\" > /etc/apt/sources.list.d/vyos.list\n#   Packages needed to build frr itself\n#   libyang-dev packages are hsoted on dev.packages.vyos.net see\n#   https://github.com/FRRouting/frr/blob/master/doc/developer/building-libyang.rst\n#   for more info\nRUN apt-get update \\\n && apt-get install libyang-dev libyang0.16 chrpath install-info libjson-c-dev libpython3-dev python3-dev python3-pytest texinfo -y\n#\n#   Cleanup VyOS Debian Repository\n#\nRUN rm -f /etc/apt/sources.list.d/vyos.list\n#   Packages needed for conntrack-tools\nRUN apt-get update \\\n && apt-get install libnetfilter-conntrack-dev libnetfilter-cthelper0-dev libnetfilter-cttimeout-dev libnetfilter-queue-dev -y\n#   Packages needed for hvinfo\nRUN apt-get update \\\n && apt-get install gnat gprbuild -y\n#   Packages needed for vyos-1x\nRUN apt-get update \\\n && apt-get install whois -y\n#   Packages needed for ipaddrcheck\nRUN apt-get update \\\n && apt-get install check -y\n#   As there is no Debian Jessie/Stretch package for libcidr available but this\n#   is required for ipaddrcheck we have to build it from source\nRUN git clone https://github.com/wikimedia/analytics-libcidr.git \\\n && cd analytics-libcidr \\\n && git checkout 026c611d90a1 \\\n && dpkg-buildpackage -uc -us -tc -b \\\n && dpkg -i ../libcidr*.deb\n#   Packages needed for lldpd\nRUN apt-get update \\\n && apt-get install libbsd-dev libevent-dev -y\n#   Packages needed for vyatta-quagga\nRUN apt-get update \\\n && apt-get install libpam-dev libcap-dev libsnmp-dev gawk -y\n#   Packages needed for vyos-strongswan\nRUN apt-get update \\\n && apt-get install libkrb5-dev libssl-dev libxml2-dev systemd libcurl4-openssl-dev libgcrypt20-dev libgmp3-dev libldap2-dev libsqlite3-dev dh-apparmor gperf libsystemd-dev python3-stdeb python-setuptools -y\n#   Packages needed for vyos-opennhrp\nRUN apt-get update \\\n && apt-get install libc-ares-dev -y\n#   Packages needed for ddclient\nRUN apt-get update \\\n && apt-get install xmlto -y\n#   Packages needed for keepalived\nRUN apt-get update \\\n && apt-get install libnl-3-200 libnl-3-dev libnl-nf-3-200 libnl-nf-3-dev libipset-dev libnl-genl-3-200 libnl-genl-3-dev libpopt-dev -y\n#   Packages needed for net-snmp\nRUN apt-get update \\\n && apt-get install python-all python2.7-dev libmysqld-dev -y\n#   Update live-build\nRUN echo 'deb http://ftp.debian.org/debian stretch main' | tee -a /etc/apt/sources.list.d/stretch.list \\\n && apt-get update \\\n && apt-get install stretch live-build -y -t \\\n && rm -f /etc/apt/sources.list.d/stretch.list \\\n && apt-get update \\\n && rm -rf /var/lib/apt/lists/*\n#   Install packer\nRUN export LATEST=\"$( curl -s https://checkpoint-api.hashicorp.com/v1/check/packer | jq -r -M '.current_version' ;)\" ; echo \"url https://releases.hashicorp.com/packer/\"$LATEST\"/packer_\"$LATEST\"_linux_arm.zip\" | curl -K- | gzip -d > /usr/bin/packer \\\n && chmod +x /usr/bin/packer\n#   Allow password-less 'sudo' for all users in group 'sudo'\nRUN sed \"s/^%sudo.*/%sudo\\tALL=(ALL) NOPASSWD:ALL/g\" -i /etc/sudoers \\\n && chmod a+s /usr/sbin/useradd /usr/sbin/groupadd /usr/sbin/gosu /usr/sbin/usermod\n#   Ensure sure all users have access to our OCAM installation\nRUN echo \"$( opam env --root=/opt/opam --set-root ;)\" >> /etc/skel/.bashrc\n#   Cleanup\nRUN rm -rf /tmp/*\nCOPY entrypoint.sh /usr/local/bin/entrypoint.sh\nENTRYPOINT [\"/usr/local/bin/entrypoint.sh\"]\n","originalDockerfileUglifiedHash":"d8eeb284d50cc4043b4f17f86992f76a","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/71b5b8bf3a03a2875230c1b1a4240ad5988c8314.dockerfile"}