{"seed":2846696644,"processedDockerfileHash":"c52023f1718338c4ec551b7bef9246e8","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM phusion/baseimage:0.9.19\n#   container settings\nENV LANG=\"en_US.UTF-8\"\nENV LC_ALL=\"en_US.UTF-8\"\nENV ENVIRONMENT=\"PROD\"\nARG SOURCE_COMMIT\nENV SOURCE_COMMIT=\"${SOURCE_COMMIT}\"\nARG DOCKER_TAG\nENV DOCKER_TAG=\"${DOCKER_TAG}\"\n#   python app settings\nENV LOG_LEVEL=\"INFO\"\nENV PIPENV_VENV_IN_PROJECT=\"1\"\nENV APP_ROOT=\"/app\"\n#   jussi settings\nENV APP_CMD=\"jussi.serve\"\nENV JUSSI_SERVER_HOST=\"0.0.0.0\"\nENV JUSSI_SERVER_PORT=\"9000\"\nENV JUSSI_MONITOR_PORT=\"7777\"\n#   all nginx env vars must also be changed in service/nginx/nginx.conf\nENV NGINX_SERVER_PORT=\"8080\"\nRUN apt-get update \\\n && apt-get install --no-install-recommends build-essential checkinstall daemontools git libbz2-dev libc6-dev libffi-dev libgdbm-dev libmysqlclient-dev libncursesw5-dev libreadline-gplv2-dev libsqlite3-dev libssl-dev libxml2-dev libxslt-dev nginx nginx-extras make lua-zlib runit tk-dev wget -y \\\n && apt-get clean\nRUN wget https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tar.xz \\\n && tar xvf Python-3.6.5.tar.xz \\\n && cd Python-3.6.5/ \\\n && ./configure \\\n && make altinstall \\\n && cd .. \\\n && rm -rf Python-3.6.5.tar.xz Python-3.6.5/\n#   nginx\nRUN mkdir -p /var/lib/nginx/body \\\n && mkdir -p /var/lib/nginx/scgi \\\n && mkdir -p /var/lib/nginx/uwsgi \\\n && mkdir -p /var/lib/nginx/fastcgi \\\n && mkdir -p /var/lib/nginx/proxy \\\n && chown -R www-data:www-data /var/lib/nginx \\\n && mkdir -p /var/log/nginx \\\n && touch /var/log/nginx/access.log \\\n && touch /var/log/nginx/access.json \\\n && touch /var/log/nginx/error.log \\\n && chown www-data:www-data /var/log/nginx/* \\\n && touch /var/run/nginx.pid \\\n && chown www-data:www-data /var/run/nginx.pid \\\n && mkdir -p /var/www/.cache \\\n && chown www-data:www-data /var/www/.cache\nRUN python3.6 -m pip install --upgrade pip \\\n && python3.6 -m pip install pipenv\nCOPY . /app\nRUN mv /app/service/* /etc/service \\\n && chmod +x /etc/service/*/run\nWORKDIR /app\nRUN pipenv install --dev\nRUN chown -R www-data . \\\n && apt-get remove -y build-essential libffi-dev libssl-dev git make checkinstall \\\n && apt-get clean \\\n && apt-get autoremove -y \\\n && rm -rf /root/.cache /var/lib/apt/lists/* /tmp/* /var/tmp/* /var/cache/* /usr/include /usr/local/include\nRUN pipenv run pytest\nEXPOSE ${NGINX_SERVER_PORT}\nEXPOSE ${JUSSI_MONITOR_PORT}\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM phusion/baseimage:0.9.19\n#  container settings\nENV LANG=\"en_US.UTF-8\"\nENV LC_ALL=\"en_US.UTF-8\"\nENV ENVIRONMENT=\"PROD\"\nARG SOURCE_COMMIT\nENV SOURCE_COMMIT=\"${SOURCE_COMMIT}\"\nARG DOCKER_TAG\nENV DOCKER_TAG=\"${DOCKER_TAG}\"\n#  python app settings\nENV LOG_LEVEL=\"INFO\"\nENV PIPENV_VENV_IN_PROJECT=\"1\"\nENV APP_ROOT=\"/app\"\n#  jussi settings\nENV APP_CMD=\"jussi.serve\"\nENV JUSSI_SERVER_HOST=\"0.0.0.0\"\nENV JUSSI_SERVER_PORT=\"9000\"\nENV JUSSI_MONITOR_PORT=\"7777\"\n#  all nginx env vars must also be changed in service/nginx/nginx.conf\nENV NGINX_SERVER_PORT=\"8080\"\nRUN apt-get update \\\n && apt-get install build-essential checkinstall daemontools git libbz2-dev libc6-dev libffi-dev libgdbm-dev libmysqlclient-dev libncursesw5-dev libreadline-gplv2-dev libsqlite3-dev libssl-dev libxml2-dev libxslt-dev nginx nginx-extras make lua-zlib runit tk-dev wget -y \\\n && apt-get clean\nRUN wget https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tar.xz \\\n && tar xvf Python-3.6.5.tar.xz \\\n && cd Python-3.6.5/ \\\n && ./configure \\\n && make altinstall \\\n && cd .. \\\n && rm -rf Python-3.6.5.tar.xz Python-3.6.5/\n#  nginx\nRUN mkdir -p /var/lib/nginx/body \\\n && mkdir -p /var/lib/nginx/scgi \\\n && mkdir -p /var/lib/nginx/uwsgi \\\n && mkdir -p /var/lib/nginx/fastcgi \\\n && mkdir -p /var/lib/nginx/proxy \\\n && chown -R www-data:www-data /var/lib/nginx \\\n && mkdir -p /var/log/nginx \\\n && touch /var/log/nginx/access.log \\\n && touch /var/log/nginx/access.json \\\n && touch /var/log/nginx/error.log \\\n && chown www-data:www-data /var/log/nginx/* \\\n && touch /var/run/nginx.pid \\\n && chown www-data:www-data /var/run/nginx.pid \\\n && mkdir -p /var/www/.cache \\\n && chown www-data:www-data /var/www/.cache\nRUN python3.6 -m pip install --upgrade pip \\\n && python3.6 -m pip install pipenv\nCOPY . /app\nRUN mv /app/service/* /etc/service \\\n && chmod +x /etc/service/*/run\nWORKDIR /app\nRUN pipenv install --dev\nRUN chown -R www-data . \\\n && apt-get remove -y build-essential libffi-dev libssl-dev git make checkinstall \\\n && apt-get clean \\\n && apt-get autoremove -y \\\n && rm -rf /root/.cache /var/lib/apt/lists/* /tmp/* /var/tmp/* /var/cache/* /usr/include /usr/local/include\nRUN pipenv run pytest\nEXPOSE ${NGINX_SERVER_PORT}\nEXPOSE ${JUSSI_MONITOR_PORT}\n","injectedSmells":[],"originalDockerfileHash":"919ac7ec76cd3a2e4024fd96a9ad24c4","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM phusion/baseimage:0.9.19\n#   container settings\nENV LANG=\"en_US.UTF-8\"\nENV LC_ALL=\"en_US.UTF-8\"\nENV ENVIRONMENT=\"PROD\"\nARG SOURCE_COMMIT\nENV SOURCE_COMMIT=\"${SOURCE_COMMIT}\"\nARG DOCKER_TAG\nENV DOCKER_TAG=\"${DOCKER_TAG}\"\n#   python app settings\nENV LOG_LEVEL=\"INFO\"\nENV PIPENV_VENV_IN_PROJECT=\"1\"\nENV APP_ROOT=\"/app\"\n#   jussi settings\nENV APP_CMD=\"jussi.serve\"\nENV JUSSI_SERVER_HOST=\"0.0.0.0\"\nENV JUSSI_SERVER_PORT=\"9000\"\nENV JUSSI_MONITOR_PORT=\"7777\"\n#   all nginx env vars must also be changed in service/nginx/nginx.conf\nENV NGINX_SERVER_PORT=\"8080\"\nRUN apt-get update \\\n && apt-get install build-essential checkinstall daemontools git libbz2-dev libc6-dev libffi-dev libgdbm-dev libmysqlclient-dev libncursesw5-dev libreadline-gplv2-dev libsqlite3-dev libssl-dev libxml2-dev libxslt-dev nginx nginx-extras make lua-zlib runit tk-dev wget -y \\\n && apt-get clean\nRUN wget https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tar.xz \\\n && tar xvf Python-3.6.5.tar.xz \\\n && cd Python-3.6.5/ \\\n && ./configure \\\n && make altinstall \\\n && cd .. \\\n && rm -rf Python-3.6.5.tar.xz Python-3.6.5/\n#   nginx\nRUN mkdir -p /var/lib/nginx/body \\\n && mkdir -p /var/lib/nginx/scgi \\\n && mkdir -p /var/lib/nginx/uwsgi \\\n && mkdir -p /var/lib/nginx/fastcgi \\\n && mkdir -p /var/lib/nginx/proxy \\\n && chown -R www-data:www-data /var/lib/nginx \\\n && mkdir -p /var/log/nginx \\\n && touch /var/log/nginx/access.log \\\n && touch /var/log/nginx/access.json \\\n && touch /var/log/nginx/error.log \\\n && chown www-data:www-data /var/log/nginx/* \\\n && touch /var/run/nginx.pid \\\n && chown www-data:www-data /var/run/nginx.pid \\\n && mkdir -p /var/www/.cache \\\n && chown www-data:www-data /var/www/.cache\nRUN python3.6 -m pip install --upgrade pip \\\n && python3.6 -m pip install pipenv\nCOPY . /app\nRUN mv /app/service/* /etc/service \\\n && chmod +x /etc/service/*/run\nWORKDIR /app\nRUN pipenv install --dev\nRUN chown -R www-data . \\\n && apt-get remove -y build-essential libffi-dev libssl-dev git make checkinstall \\\n && apt-get clean \\\n && apt-get autoremove -y \\\n && rm -rf /root/.cache /var/lib/apt/lists/* /tmp/* /var/tmp/* /var/cache/* /usr/include /usr/local/include\nRUN pipenv run pytest\nEXPOSE ${NGINX_SERVER_PORT}\nEXPOSE ${JUSSI_MONITOR_PORT}\n","originalDockerfileUglifiedHash":"ff4c5e1636bf8d0543843f270d171087","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/168639e445590bd6b2c60ce21a20440585790370.dockerfile"}