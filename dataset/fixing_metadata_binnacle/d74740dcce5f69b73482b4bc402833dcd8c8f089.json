{"seed":1211028400,"processedDockerfileHash":"76f8a4a68e41c249176cb56b3ba00d0a","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-copy-instead-of-add","have-a-user"],"processedDockerfile":"FROM jdeathe/centos-ssh:2.5.1\n#   Use the form ([{fqdn}-]{package-name}|[{fqdn}-]{provider-name})\nARG PACKAGE_NAME=\"app\"\nARG PACKAGE_PATH=\"/opt/${PACKAGE_NAME}\"\nARG PACKAGE_RELEASE_VERSION=\"0.11.0\"\nARG RELEASE_VERSION=\"3.2.0\"\n#   ------------------------------------------------------------------------------\n#   - Base install of required packages\n#   ------------------------------------------------------------------------------\nRUN rpm --rebuilddb \\\n && yum -y install --setopt=tsflags=nodocs --disableplugin=fastestmirror elinks-0.12-0.37.pre6.el7.0.1 httpd24u-2.4.39-1.ius.centos7 httpd24u-tools-2.4.39-1.ius.centos7 httpd24u-mod_ssl-2.4.39-1.ius.centos7 php72u-cli-7.2.16-1.ius.centos7 php72u-common-7.2.16-1.ius.centos7 php72u-fpm-7.2.16-1.ius.centos7 php72u-fpm-httpd-7.2.16-1.ius.centos7 php72u-opcache-7.2.16-1.ius.centos7 php72u-pecl-memcached-3.0.4-2.ius.centos7 php72u-pecl-redis-3.1.6-2.ius.centos7 \\\n && yum versionlock add elinks httpd24u* php72u* \\\n && rm -rf /var/cache/yum/* \\\n && yum clean all \\\n && /bin/find /usr/share -type f -regextype posix-extended -regex '.*\\.(jpg|png)$' -delete\n#   ------------------------------------------------------------------------------\n#   Copy files into place\n#   ------------------------------------------------------------------------------\nCOPY src /\n#   ------------------------------------------------------------------------------\n#   Provisioning\n#   - Add default system users\n#   - Limit threads for the application user\n#   - Disable Apache directory indexes and welcome page\n#   - Disable Apache language based content negotiation\n#   - Custom Apache configuration\n#   - Disable all Apache modules and enable the minimum\n#   - Disable SSL\n#   - Disable the default SSL Virtual Host\n#   - Global PHP configuration changes\n#   - Replace placeholders with values in systemd service unit template\n#   - Set permissions\n#   ------------------------------------------------------------------------------\nRUN useradd -r -M -d /var/www/app -s /sbin/nologin app \\\n && useradd -r -M -d /var/www/app -s /sbin/nologin -G apache,app app-www \\\n && usermod -a -G app-www app \\\n && usermod -a -G app-www,app apache \\\n && usermod -L app \\\n && usermod -L app-www \\\n && { printf -- '\\n@apache\\tsoft\\tnproc\\t%s\\n@apache\\thard\\tnproc\\t%s\\n' '85' '170' ; } >> /etc/security/limits.conf \\\n && cp -pf /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.default \\\n && sed -i -e '/^KeepAlive .*$/d' -e '/^MaxKeepAliveRequests .*$/d' -e '/^KeepAliveTimeout .*$/d' -e '/^ServerSignature On$/d' -e '/^ServerTokens OS$/d' -e 's~^NameVirtualHost \\(.*\\)$~#NameVirtualHost \\1~g' -e 's~^User .*$~User ${APACHE_RUN_USER}~g' -e 's~^Group .*$~Group ${APACHE_RUN_GROUP}~g' -e 's~^DocumentRoot \\(.*\\)$~#DocumentRoot \\1~g' -e 's~^IndexOptions \\(.*\\)$~#IndexOptions \\1~g' -e 's~^IndexIgnore \\(.*\\)$~#IndexIgnore \\1~g' -e 's~^AddIconByEncoding \\(.*\\)$~#AddIconByEncoding \\1~g' -e 's~^AddIconByType \\(.*\\)$~#AddIconByType \\1~g' -e 's~^AddIcon \\(.*\\)$~#AddIcon \\1~g' -e 's~^DefaultIcon \\(.*\\)$~#DefaultIcon \\1~g' -e 's~^ReadmeName \\(.*\\)$~#ReadmeName \\1~g' -e 's~^HeaderName \\(.*\\)$~#HeaderName \\1~g' -e 's~^\\(Alias /icons/ \".*\"\\)$~#\\1~' -e '/<Directory \"\\/var\\/www\\/icons\">/,/#<\\/Directory>/ s~^~#~' -e 's~^LanguagePriority \\(.*\\)$~#LanguagePriority \\1~g' -e 's~^ForceLanguagePriority \\(.*\\)$~#ForceLanguagePriority \\1~g' -e 's~^AddLanguage \\(.*\\)$~#AddLanguage \\1~g' /etc/httpd/conf/httpd.conf \\\n && truncate -s 0 /etc/httpd/conf.d/autoindex.conf \\\n && chmod 444 /etc/httpd/conf.d/autoindex.conf \\\n && truncate -s 0 /etc/httpd/conf.d/welcome.conf \\\n && chmod 444 /etc/httpd/conf.d/welcome.conf \\\n && { printf -- '\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\\\\\n%s%s\\\\\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n' '#' '# Custom configuration' '#' 'KeepAlive On' 'MaxKeepAliveRequests 200' 'KeepAliveTimeout 2' 'LogFormat ' ' \"%{X-Forwarded-For}i %l %u %t \\\"%r\\\" %>s %b' ' \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" ' ' forwarded_for_combined' 'ExtendedStatus Off' 'Listen 8443' 'Options -Indexes' 'ServerSignature Off' 'ServerTokens Prod' 'TraceEnable Off' 'UseCanonicalName On' 'UseCanonicalPhysicalPort On' ; } >> /etc/httpd/conf/httpd.conf \\\n && sed -i -e 's~^\\(LoadModule .*\\)$~#\\1~g' -e 's~^#\\(LoadModule mime_module .*\\)$~\\1~' -e 's~^#\\(LoadModule log_config_module .*\\)$~\\1~' -e 's~^#\\(LoadModule setenvif_module .*\\)$~\\1~' -e 's~^#\\(LoadModule status_module .*\\)$~\\1~' -e 's~^#\\(LoadModule authz_host_module .*\\)$~\\1~' -e 's~^#\\(LoadModule dir_module .*\\)$~\\1~' -e 's~^#\\(LoadModule alias_module .*\\)$~\\1~' -e 's~^#\\(LoadModule expires_module .*\\)$~\\1~' -e 's~^#\\(LoadModule deflate_module .*\\)$~\\1~' -e 's~^#\\(LoadModule headers_module .*\\)$~\\1~' -e 's~^#\\(LoadModule alias_module .*\\)$~\\1~' -e 's~^#\\(LoadModule version_module .*\\)$~\\1~' /etc/httpd/conf.modules.d/00-base.conf /etc/httpd/conf.modules.d/00-dav.conf /etc/httpd/conf.modules.d/00-lua.conf /etc/httpd/conf.modules.d/00-proxy.conf /etc/httpd/conf.modules.d/00-ssl.conf /etc/httpd/conf.modules.d/00-systemd.conf \\\n && sed -ri -e '/<VirtualHost _default_:443>/,/<\\/VirtualHost>/ s~^~#~' -e 's~(SSLSessionCacheTimeout.*)$~\\1\\n\\nSSLUseStapling on\\nSSLStaplingCache shmcb:/run/httpd/sslstaplingcache(512000)\\nSSLStaplingResponderTimeout 5\\nSSLStaplingReturnResponderErrors off~' /etc/httpd/conf.d/ssl.conf \\\n && cat /etc/httpd/conf.d/ssl.conf > /etc/httpd/conf.d/ssl.conf.off \\\n && truncate -s 0 /etc/httpd/conf.d/ssl.conf \\\n && chmod 644 /etc/httpd/conf.d/ssl.conf \\\n && cp -pf /etc/php-fpm.conf /etc/php-fpm.conf.default \\\n && cp -pf /etc/php-fpm.d/www.conf /etc/php-fpm.d/www.conf.default \\\n && cp -pf /etc/httpd/conf.d/php-fpm.conf /etc/httpd/conf.d/php-fpm.conf.default \\\n && sed -e 's~^; .*$~~' -e 's~^;*$~~' -e '/^$/d' -e 's~^\\[~\\n\\[~g' /etc/php.ini > /etc/php.d/00-php.ini.default \\\n && sed -r -e 's~^;(user_ini.filename =)$~\\1~g' -e 's~^;(cgi.fix_pathinfo=1)$~\\1~g' -e 's~^;(date.timezone =)$~\\1 UTC~g' -e 's~^(expose_php = )On$~\\1Off~g' -e 's~^;(realpath_cache_size = ).*$~\\14096k~' -e 's~^;(realpath_cache_ttl = ).*$~\\1600~' -e 's~^;?(session.name = ).*$~\\1\"${PHP_OPTIONS_SESSION_NAME:-PHPSESSID}\"~' -e 's~^;?(session.save_handler = ).*$~\\1\"${PHP_OPTIONS_SESSION_SAVE_HANDLER:-files}\"~' -e 's~^;?(session.save_path = ).*$~\\1\"${PHP_OPTIONS_SESSION_SAVE_PATH:-/var/lib/php/session}\"~' /etc/php.d/00-php.ini.default > /etc/php.d/00-php.ini \\\n && sed -e 's~^; .*$~~' -e 's~^;*$~~' -e '/^$/d' -e 's~^\\[~\\n\\[~g' /etc/php.d/10-opcache.ini > /etc/php.d/10-opcache.ini.default \\\n && sed -e 's~^;\\(opcache.enable_cli=\\).*$~\\11~g' -e 's~^\\(opcache.max_accelerated_files=\\).*$~\\132531~g' -e 's~^;\\(opcache.validate_timestamps=\\).*$~\\10~g' /etc/php.d/10-opcache.ini.default > /etc/php.d/10-opcache.ini \\\n && if [[ ${RELEASE_VERSION%%.*} -ge 3 ]] ; then sed -r -i -e 's~^(error_log) *=.*$~\\1 = /dev/stderr~' -e 's~^;?(systemd_interval = ).*$~\\10~' /etc/php-fpm.conf ; else sed -r -i -e 's~^(error_log) *=.*$~\\1 = /dev/stderr~' /etc/php-fpm.conf ; fi \\\n && sed -i -e 's~^\\[www\\]$~[{{APACHE_RUN_USER}}]~' -e 's~^user = php-fpm$~user = {{APACHE_RUN_USER}}~' -e 's~^group = php-fpm$~group = {{APACHE_RUN_GROUP}}~' -e 's~^listen = 127.0.0.1:9000$~;listen = 127.0.0.1:9000~' -e 's~^;listen = /run/php-fpm/www.sock$~listen = /run/php-fpm/{{APACHE_RUN_USER}}.sock~' -e 's~^;listen.owner = root$~listen.owner = {{APACHE_RUN_USER}}~' -e 's~^;listen.group = root$~listen.group = {{APACHE_RUN_GROUP}}~' -e 's~^pm.max_children = 50$~pm.max_children = 64~' -e 's~^slowlog = /var/log/php-fpm/www-slow.log$~slowlog = /var/log/php-fpm/{{APACHE_RUN_USER}}-slow.log~' -e 's~^\\(php_admin_value\\[error_log\\].*\\)$~;\\1~' -e 's~^\\(php_admin_flag\\[log_errors\\].*\\)$~;\\1~' -e 's~^\\(php_value\\[session.save_handler\\].*\\)$~;\\1~' -e 's~^\\(php_value\\[session.save_path\\].*\\)$~;\\1~' -e 's~^\\(php_value\\[soap.wsdl_cache_dir\\].*\\)$~;\\1~' -e 's~^;\\(pm.status_path = \\).*$~\\1/status~' /etc/php-fpm.d/www.conf \\\n && cat /etc/php-fpm.d/www.conf > /etc/php-fpm.d/www.conf.template \\\n && sed -i -e 's~^\\([ \\t]*\\)\\(SetHandler \"proxy:fcgi:.*\\)$~\\1#\\2~' -e 's~^\\([ \\t]*\\)#\\(SetHandler \"proxy:unix:.*\\)$~\\1\\2~' /etc/httpd/conf.d/php-fpm.conf \\\n && sed -i -e \"s~{{RELEASE_VERSION}}~${RELEASE_VERSION}~g\" /etc/systemd/system/centos-ssh-apache-php@.service \\\n && chmod 700 /usr/{bin/healthcheck,sbin/{httpd-{bootstrap,wrapper},php-fpm-wrapper}}\n#   ------------------------------------------------------------------------------\n#   Package installation\n#   ------------------------------------------------------------------------------\nRUN mkdir -p -m 750 ${PACKAGE_PATH} \\\n && curl -Ls https://github.com/jdeathe/php-hello-world/archive/${PACKAGE_RELEASE_VERSION}.tar.gz | tar -xzpf - --strip-components=1 --exclude=\"*.gitkeep\" -C ${PACKAGE_PATH} \\\n && sed -i -e 's~^description =.*$~description = \"This CentOS / Apache / PHP-FPM (FastCGI) service is running in a container.\"~' ${PACKAGE_PATH}/etc/views/index.ini \\\n && mv ${PACKAGE_PATH}/public ${PACKAGE_PATH}/public_html \\\n && $( if [[ -f /usr/share/php-pecl-apc/apc.php ]] ; then cp /usr/share/php-pecl-apc/apc.php ${PACKAGE_PATH}/public_html/_apc.php ; fi ;) \\\n && chown -R app:app-www ${PACKAGE_PATH} \\\n && find ${PACKAGE_PATH} -type d -exec chmod 750 {} + \\\n && find ${PACKAGE_PATH}/var -type d -exec chmod 770 {} + \\\n && find ${PACKAGE_PATH} -type f -exec chmod 640 {} + \\\n && find ${PACKAGE_PATH}/bin -type f -exec chmod 750 {} +\nEXPOSE 80/tcp 443/tcp 8443/tcp\n#   ------------------------------------------------------------------------------\n#   Set default environment variables used to configure the service container\n#   ------------------------------------------------------------------------------\nENV APACHE_AUTOSTART_HTTPD_BOOTSTRAP=\"true\" \\\n    APACHE_AUTOSTART_HTTPD_WRAPPER=\"true\" \\\n    APACHE_AUTOSTART_PHP_FPM_WRAPPER=\"true\" \\\n    APACHE_CONTENT_ROOT=\"/var/www/${PACKAGE_NAME}\" \\\n    APACHE_CUSTOM_LOG_FORMAT=\"combined\" \\\n    APACHE_CUSTOM_LOG_LOCATION=\"var/log/apache_access_log\" \\\n    APACHE_ERROR_LOG_LOCATION=\"var/log/apache_error_log\" \\\n    APACHE_ERROR_LOG_LEVEL=\"warn\" \\\n    APACHE_EXTENDED_STATUS_ENABLED=\"false\" \\\n    APACHE_HEADER_X_SERVICE_UID=\"{{HOSTNAME}}\" \\\n    APACHE_LOAD_MODULES=\"\" \\\n    APACHE_MOD_SSL_ENABLED=\"false\" \\\n    APACHE_MPM=\"prefork\" \\\n    APACHE_OPERATING_MODE=\"production\" \\\n    APACHE_PUBLIC_DIRECTORY=\"public_html\" \\\n    APACHE_RUN_GROUP=\"app-www\" \\\n    APACHE_RUN_USER=\"app-www\" \\\n    APACHE_SERVER_ALIAS=\"\" \\\n    APACHE_SERVER_NAME=\"\" \\\n    APACHE_SSL_CERTIFICATE=\"\" \\\n    APACHE_SSL_CIPHER_SUITE=\"ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS\" \\\n    APACHE_SSL_PROTOCOL=\"All -SSLv2 -SSLv3\" \\\n    APACHE_SYSTEM_USER=\"app\" \\\n    PACKAGE_PATH=\"${PACKAGE_PATH}\" \\\n    PHP_OPTIONS_DATE_TIMEZONE=\"UTC\" \\\n    PHP_OPTIONS_SESSION_NAME=\"PHPSESSID\" \\\n    PHP_OPTIONS_SESSION_SAVE_HANDLER=\"files\" \\\n    PHP_OPTIONS_SESSION_SAVE_PATH=\"var/session\" \\\n    SSH_AUTOSTART_SSHD=\"false\" \\\n    SSH_AUTOSTART_SSHD_BOOTSTRAP=\"false\" \\\n    SSH_AUTOSTART_SUPERVISOR_STDOUT=\"false\"\n#   ------------------------------------------------------------------------------\n#   Set image metadata\n#   ------------------------------------------------------------------------------\nLABEL maintainer=\"James Deathe <james.deathe@gmail.com>\" \\\n      install=\"docker run --rm --privileged --volume /:/media/root jdeathe/centos-ssh-apache-php:${RELEASE_VERSION} /usr/sbin/scmi install --chroot=/media/root --name=\\${NAME} --tag=${RELEASE_VERSION}\" \\\n      uninstall=\"docker run --rm --privileged --volume /:/media/root jdeathe/centos-ssh-apache-php:${RELEASE_VERSION} /usr/sbin/scmi uninstall --chroot=/media/root --name=\\${NAME} --tag=${RELEASE_VERSION}\" \\\n      org.deathe.name=\"centos-ssh-apache-php\" \\\n      org.deathe.version=\"${RELEASE_VERSION}\" \\\n      org.deathe.release=\"jdeathe/centos-ssh-apache-php:${RELEASE_VERSION}\" \\\n      org.deathe.license=\"MIT\" \\\n      org.deathe.vendor=\"jdeathe\" \\\n      org.deathe.url=\"https://github.com/jdeathe/centos-ssh-apache-php\" \\\n      org.deathe.description=\"CentOS-7 7.5.1804 x86_64 - IUS Apache 2.4, IUS PHP-FPM 7.2, PHP memcached 3.0, Zend Opcache 7.2.\"\nHEALTHCHECK --interval=1s --timeout=1s --retries=10 CMD [\"/usr/bin/healthcheck\"]\nCMD [\"/usr/bin/supervisord\", \"--configuration=/etc/supervisord.conf\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n","originalDockerfile":"FROM jdeathe/centos-ssh:2.5.1\n#  Use the form ([{fqdn}-]{package-name}|[{fqdn}-]{provider-name})\nARG PACKAGE_NAME=\"app\"\nARG PACKAGE_PATH=\"/opt/${PACKAGE_NAME}\"\nARG PACKAGE_RELEASE_VERSION=\"0.11.0\"\nARG RELEASE_VERSION=\"3.2.0\"\n#  ------------------------------------------------------------------------------\n#  - Base install of required packages\n#  ------------------------------------------------------------------------------\nRUN rpm --rebuilddb \\\n && yum -y install --setopt=tsflags=nodocs --disableplugin=fastestmirror elinks-0.12-0.37.pre6.el7.0.1 httpd24u-2.4.39-1.ius.centos7 httpd24u-tools-2.4.39-1.ius.centos7 httpd24u-mod_ssl-2.4.39-1.ius.centos7 php72u-cli-7.2.16-1.ius.centos7 php72u-common-7.2.16-1.ius.centos7 php72u-fpm-7.2.16-1.ius.centos7 php72u-fpm-httpd-7.2.16-1.ius.centos7 php72u-opcache-7.2.16-1.ius.centos7 php72u-pecl-memcached-3.0.4-2.ius.centos7 php72u-pecl-redis-3.1.6-2.ius.centos7 \\\n && yum versionlock add elinks httpd24u* php72u* \\\n && rm -rf /var/cache/yum/* \\\n && yum clean all \\\n && /bin/find /usr/share -type f -regextype posix-extended -regex '.*\\.(jpg|png)$' -delete\n#  ------------------------------------------------------------------------------\n#  Copy files into place\n#  ------------------------------------------------------------------------------\nADD src /\n#  ------------------------------------------------------------------------------\n#  Provisioning\n#  - Add default system users\n#  - Limit threads for the application user\n#  - Disable Apache directory indexes and welcome page\n#  - Disable Apache language based content negotiation\n#  - Custom Apache configuration\n#  - Disable all Apache modules and enable the minimum\n#  - Disable SSL\n#  - Disable the default SSL Virtual Host\n#  - Global PHP configuration changes\n#  - Replace placeholders with values in systemd service unit template\n#  - Set permissions\n#  ------------------------------------------------------------------------------\nRUN useradd -r -M -d /var/www/app -s /sbin/nologin app \\\n && useradd -r -M -d /var/www/app -s /sbin/nologin -G apache,app app-www \\\n && usermod -a -G app-www app \\\n && usermod -a -G app-www,app apache \\\n && usermod -L app \\\n && usermod -L app-www \\\n && { printf -- '\\n@apache\\tsoft\\tnproc\\t%s\\n@apache\\thard\\tnproc\\t%s\\n' '85' '170' ; } >> /etc/security/limits.conf \\\n && cp -pf /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.default \\\n && sed -i -e '/^KeepAlive .*$/d' -e '/^MaxKeepAliveRequests .*$/d' -e '/^KeepAliveTimeout .*$/d' -e '/^ServerSignature On$/d' -e '/^ServerTokens OS$/d' -e 's~^NameVirtualHost \\(.*\\)$~#NameVirtualHost \\1~g' -e 's~^User .*$~User ${APACHE_RUN_USER}~g' -e 's~^Group .*$~Group ${APACHE_RUN_GROUP}~g' -e 's~^DocumentRoot \\(.*\\)$~#DocumentRoot \\1~g' -e 's~^IndexOptions \\(.*\\)$~#IndexOptions \\1~g' -e 's~^IndexIgnore \\(.*\\)$~#IndexIgnore \\1~g' -e 's~^AddIconByEncoding \\(.*\\)$~#AddIconByEncoding \\1~g' -e 's~^AddIconByType \\(.*\\)$~#AddIconByType \\1~g' -e 's~^AddIcon \\(.*\\)$~#AddIcon \\1~g' -e 's~^DefaultIcon \\(.*\\)$~#DefaultIcon \\1~g' -e 's~^ReadmeName \\(.*\\)$~#ReadmeName \\1~g' -e 's~^HeaderName \\(.*\\)$~#HeaderName \\1~g' -e 's~^\\(Alias /icons/ \".*\"\\)$~#\\1~' -e '/<Directory \"\\/var\\/www\\/icons\">/,/#<\\/Directory>/ s~^~#~' -e 's~^LanguagePriority \\(.*\\)$~#LanguagePriority \\1~g' -e 's~^ForceLanguagePriority \\(.*\\)$~#ForceLanguagePriority \\1~g' -e 's~^AddLanguage \\(.*\\)$~#AddLanguage \\1~g' /etc/httpd/conf/httpd.conf \\\n && truncate -s 0 /etc/httpd/conf.d/autoindex.conf \\\n && chmod 444 /etc/httpd/conf.d/autoindex.conf \\\n && truncate -s 0 /etc/httpd/conf.d/welcome.conf \\\n && chmod 444 /etc/httpd/conf.d/welcome.conf \\\n && { printf -- '\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\\\\\n%s%s\\\\\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n' '#' '# Custom configuration' '#' 'KeepAlive On' 'MaxKeepAliveRequests 200' 'KeepAliveTimeout 2' 'LogFormat ' ' \"%{X-Forwarded-For}i %l %u %t \\\"%r\\\" %>s %b' ' \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" ' ' forwarded_for_combined' 'ExtendedStatus Off' 'Listen 8443' 'Options -Indexes' 'ServerSignature Off' 'ServerTokens Prod' 'TraceEnable Off' 'UseCanonicalName On' 'UseCanonicalPhysicalPort On' ; } >> /etc/httpd/conf/httpd.conf \\\n && sed -i -e 's~^\\(LoadModule .*\\)$~#\\1~g' -e 's~^#\\(LoadModule mime_module .*\\)$~\\1~' -e 's~^#\\(LoadModule log_config_module .*\\)$~\\1~' -e 's~^#\\(LoadModule setenvif_module .*\\)$~\\1~' -e 's~^#\\(LoadModule status_module .*\\)$~\\1~' -e 's~^#\\(LoadModule authz_host_module .*\\)$~\\1~' -e 's~^#\\(LoadModule dir_module .*\\)$~\\1~' -e 's~^#\\(LoadModule alias_module .*\\)$~\\1~' -e 's~^#\\(LoadModule expires_module .*\\)$~\\1~' -e 's~^#\\(LoadModule deflate_module .*\\)$~\\1~' -e 's~^#\\(LoadModule headers_module .*\\)$~\\1~' -e 's~^#\\(LoadModule alias_module .*\\)$~\\1~' -e 's~^#\\(LoadModule version_module .*\\)$~\\1~' /etc/httpd/conf.modules.d/00-base.conf /etc/httpd/conf.modules.d/00-dav.conf /etc/httpd/conf.modules.d/00-lua.conf /etc/httpd/conf.modules.d/00-proxy.conf /etc/httpd/conf.modules.d/00-ssl.conf /etc/httpd/conf.modules.d/00-systemd.conf \\\n && sed -ri -e '/<VirtualHost _default_:443>/,/<\\/VirtualHost>/ s~^~#~' -e 's~(SSLSessionCacheTimeout.*)$~\\1\\n\\nSSLUseStapling on\\nSSLStaplingCache shmcb:/run/httpd/sslstaplingcache(512000)\\nSSLStaplingResponderTimeout 5\\nSSLStaplingReturnResponderErrors off~' /etc/httpd/conf.d/ssl.conf \\\n && cat /etc/httpd/conf.d/ssl.conf > /etc/httpd/conf.d/ssl.conf.off \\\n && truncate -s 0 /etc/httpd/conf.d/ssl.conf \\\n && chmod 644 /etc/httpd/conf.d/ssl.conf \\\n && cp -pf /etc/php-fpm.conf /etc/php-fpm.conf.default \\\n && cp -pf /etc/php-fpm.d/www.conf /etc/php-fpm.d/www.conf.default \\\n && cp -pf /etc/httpd/conf.d/php-fpm.conf /etc/httpd/conf.d/php-fpm.conf.default \\\n && sed -e 's~^; .*$~~' -e 's~^;*$~~' -e '/^$/d' -e 's~^\\[~\\n\\[~g' /etc/php.ini > /etc/php.d/00-php.ini.default \\\n && sed -r -e 's~^;(user_ini.filename =)$~\\1~g' -e 's~^;(cgi.fix_pathinfo=1)$~\\1~g' -e 's~^;(date.timezone =)$~\\1 UTC~g' -e 's~^(expose_php = )On$~\\1Off~g' -e 's~^;(realpath_cache_size = ).*$~\\14096k~' -e 's~^;(realpath_cache_ttl = ).*$~\\1600~' -e 's~^;?(session.name = ).*$~\\1\"${PHP_OPTIONS_SESSION_NAME:-PHPSESSID}\"~' -e 's~^;?(session.save_handler = ).*$~\\1\"${PHP_OPTIONS_SESSION_SAVE_HANDLER:-files}\"~' -e 's~^;?(session.save_path = ).*$~\\1\"${PHP_OPTIONS_SESSION_SAVE_PATH:-/var/lib/php/session}\"~' /etc/php.d/00-php.ini.default > /etc/php.d/00-php.ini \\\n && sed -e 's~^; .*$~~' -e 's~^;*$~~' -e '/^$/d' -e 's~^\\[~\\n\\[~g' /etc/php.d/10-opcache.ini > /etc/php.d/10-opcache.ini.default \\\n && sed -e 's~^;\\(opcache.enable_cli=\\).*$~\\11~g' -e 's~^\\(opcache.max_accelerated_files=\\).*$~\\132531~g' -e 's~^;\\(opcache.validate_timestamps=\\).*$~\\10~g' /etc/php.d/10-opcache.ini.default > /etc/php.d/10-opcache.ini \\\n && if [[ ${RELEASE_VERSION%%.*} -ge 3 ]] ; then sed -r -i -e 's~^(error_log) *=.*$~\\1 = /dev/stderr~' -e 's~^;?(systemd_interval = ).*$~\\10~' /etc/php-fpm.conf ; else sed -r -i -e 's~^(error_log) *=.*$~\\1 = /dev/stderr~' /etc/php-fpm.conf ; fi \\\n && sed -i -e 's~^\\[www\\]$~[{{APACHE_RUN_USER}}]~' -e 's~^user = php-fpm$~user = {{APACHE_RUN_USER}}~' -e 's~^group = php-fpm$~group = {{APACHE_RUN_GROUP}}~' -e 's~^listen = 127.0.0.1:9000$~;listen = 127.0.0.1:9000~' -e 's~^;listen = /run/php-fpm/www.sock$~listen = /run/php-fpm/{{APACHE_RUN_USER}}.sock~' -e 's~^;listen.owner = root$~listen.owner = {{APACHE_RUN_USER}}~' -e 's~^;listen.group = root$~listen.group = {{APACHE_RUN_GROUP}}~' -e 's~^pm.max_children = 50$~pm.max_children = 64~' -e 's~^slowlog = /var/log/php-fpm/www-slow.log$~slowlog = /var/log/php-fpm/{{APACHE_RUN_USER}}-slow.log~' -e 's~^\\(php_admin_value\\[error_log\\].*\\)$~;\\1~' -e 's~^\\(php_admin_flag\\[log_errors\\].*\\)$~;\\1~' -e 's~^\\(php_value\\[session.save_handler\\].*\\)$~;\\1~' -e 's~^\\(php_value\\[session.save_path\\].*\\)$~;\\1~' -e 's~^\\(php_value\\[soap.wsdl_cache_dir\\].*\\)$~;\\1~' -e 's~^;\\(pm.status_path = \\).*$~\\1/status~' /etc/php-fpm.d/www.conf \\\n && cat /etc/php-fpm.d/www.conf > /etc/php-fpm.d/www.conf.template \\\n && sed -i -e 's~^\\([ \\t]*\\)\\(SetHandler \"proxy:fcgi:.*\\)$~\\1#\\2~' -e 's~^\\([ \\t]*\\)#\\(SetHandler \"proxy:unix:.*\\)$~\\1\\2~' /etc/httpd/conf.d/php-fpm.conf \\\n && sed -i -e \"s~{{RELEASE_VERSION}}~${RELEASE_VERSION}~g\" /etc/systemd/system/centos-ssh-apache-php@.service \\\n && chmod 700 /usr/{bin/healthcheck,sbin/{httpd-{bootstrap,wrapper},php-fpm-wrapper}}\n#  ------------------------------------------------------------------------------\n#  Package installation\n#  ------------------------------------------------------------------------------\nRUN mkdir -p -m 750 ${PACKAGE_PATH} \\\n && curl -Ls https://github.com/jdeathe/php-hello-world/archive/${PACKAGE_RELEASE_VERSION}.tar.gz | tar -xzpf - --strip-components=1 --exclude=\"*.gitkeep\" -C ${PACKAGE_PATH} \\\n && sed -i -e 's~^description =.*$~description = \"This CentOS / Apache / PHP-FPM (FastCGI) service is running in a container.\"~' ${PACKAGE_PATH}/etc/views/index.ini \\\n && mv ${PACKAGE_PATH}/public ${PACKAGE_PATH}/public_html \\\n && $( if [[ -f /usr/share/php-pecl-apc/apc.php ]] ; then cp /usr/share/php-pecl-apc/apc.php ${PACKAGE_PATH}/public_html/_apc.php ; fi ;) \\\n && chown -R app:app-www ${PACKAGE_PATH} \\\n && find ${PACKAGE_PATH} -type d -exec chmod 750 {} + \\\n && find ${PACKAGE_PATH}/var -type d -exec chmod 770 {} + \\\n && find ${PACKAGE_PATH} -type f -exec chmod 640 {} + \\\n && find ${PACKAGE_PATH}/bin -type f -exec chmod 750 {} +\nEXPOSE 80/tcp 443/tcp 8443/tcp\n#  ------------------------------------------------------------------------------\n#  Set default environment variables used to configure the service container\n#  ------------------------------------------------------------------------------\nENV APACHE_AUTOSTART_HTTPD_BOOTSTRAP=\"true\" \\\n    APACHE_AUTOSTART_HTTPD_WRAPPER=\"true\" \\\n    APACHE_AUTOSTART_PHP_FPM_WRAPPER=\"true\" \\\n    APACHE_CONTENT_ROOT=\"/var/www/${PACKAGE_NAME}\" \\\n    APACHE_CUSTOM_LOG_FORMAT=\"combined\" \\\n    APACHE_CUSTOM_LOG_LOCATION=\"var/log/apache_access_log\" \\\n    APACHE_ERROR_LOG_LOCATION=\"var/log/apache_error_log\" \\\n    APACHE_ERROR_LOG_LEVEL=\"warn\" \\\n    APACHE_EXTENDED_STATUS_ENABLED=\"false\" \\\n    APACHE_HEADER_X_SERVICE_UID=\"{{HOSTNAME}}\" \\\n    APACHE_LOAD_MODULES=\"\" \\\n    APACHE_MOD_SSL_ENABLED=\"false\" \\\n    APACHE_MPM=\"prefork\" \\\n    APACHE_OPERATING_MODE=\"production\" \\\n    APACHE_PUBLIC_DIRECTORY=\"public_html\" \\\n    APACHE_RUN_GROUP=\"app-www\" \\\n    APACHE_RUN_USER=\"app-www\" \\\n    APACHE_SERVER_ALIAS=\"\" \\\n    APACHE_SERVER_NAME=\"\" \\\n    APACHE_SSL_CERTIFICATE=\"\" \\\n    APACHE_SSL_CIPHER_SUITE=\"ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS\" \\\n    APACHE_SSL_PROTOCOL=\"All -SSLv2 -SSLv3\" \\\n    APACHE_SYSTEM_USER=\"app\" \\\n    PACKAGE_PATH=\"${PACKAGE_PATH}\" \\\n    PHP_OPTIONS_DATE_TIMEZONE=\"UTC\" \\\n    PHP_OPTIONS_SESSION_NAME=\"PHPSESSID\" \\\n    PHP_OPTIONS_SESSION_SAVE_HANDLER=\"files\" \\\n    PHP_OPTIONS_SESSION_SAVE_PATH=\"var/session\" \\\n    SSH_AUTOSTART_SSHD=\"false\" \\\n    SSH_AUTOSTART_SSHD_BOOTSTRAP=\"false\" \\\n    SSH_AUTOSTART_SUPERVISOR_STDOUT=\"false\"\n#  ------------------------------------------------------------------------------\n#  Set image metadata\n#  ------------------------------------------------------------------------------\nLABEL maintainer=\"James Deathe <james.deathe@gmail.com>\" \\\n      install=\"docker run --rm --privileged --volume /:/media/root jdeathe/centos-ssh-apache-php:${RELEASE_VERSION} /usr/sbin/scmi install --chroot=/media/root --name=\\${NAME} --tag=${RELEASE_VERSION}\" \\\n      uninstall=\"docker run --rm --privileged --volume /:/media/root jdeathe/centos-ssh-apache-php:${RELEASE_VERSION} /usr/sbin/scmi uninstall --chroot=/media/root --name=\\${NAME} --tag=${RELEASE_VERSION}\" \\\n      org.deathe.name=\"centos-ssh-apache-php\" \\\n      org.deathe.version=\"${RELEASE_VERSION}\" \\\n      org.deathe.release=\"jdeathe/centos-ssh-apache-php:${RELEASE_VERSION}\" \\\n      org.deathe.license=\"MIT\" \\\n      org.deathe.vendor=\"jdeathe\" \\\n      org.deathe.url=\"https://github.com/jdeathe/centos-ssh-apache-php\" \\\n      org.deathe.description=\"CentOS-7 7.5.1804 x86_64 - IUS Apache 2.4, IUS PHP-FPM 7.2, PHP memcached 3.0, Zend Opcache 7.2.\"\nHEALTHCHECK --interval=1s --timeout=1s --retries=10 CMD [\"/usr/bin/healthcheck\"]\nCMD [\"/usr/bin/supervisord\", \"--configuration=/etc/supervisord.conf\"]\n","injectedSmells":[],"originalDockerfileHash":"aa6c270a33f1c242587eca54482ed3b0","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM jdeathe/centos-ssh:2.5.1\n#   Use the form ([{fqdn}-]{package-name}|[{fqdn}-]{provider-name})\nARG PACKAGE_NAME=\"app\"\nARG PACKAGE_PATH=\"/opt/${PACKAGE_NAME}\"\nARG PACKAGE_RELEASE_VERSION=\"0.11.0\"\nARG RELEASE_VERSION=\"3.2.0\"\n#   ------------------------------------------------------------------------------\n#   - Base install of required packages\n#   ------------------------------------------------------------------------------\nRUN rpm --rebuilddb \\\n && yum -y install --setopt=tsflags=nodocs --disableplugin=fastestmirror elinks-0.12-0.37.pre6.el7.0.1 httpd24u-2.4.39-1.ius.centos7 httpd24u-tools-2.4.39-1.ius.centos7 httpd24u-mod_ssl-2.4.39-1.ius.centos7 php72u-cli-7.2.16-1.ius.centos7 php72u-common-7.2.16-1.ius.centos7 php72u-fpm-7.2.16-1.ius.centos7 php72u-fpm-httpd-7.2.16-1.ius.centos7 php72u-opcache-7.2.16-1.ius.centos7 php72u-pecl-memcached-3.0.4-2.ius.centos7 php72u-pecl-redis-3.1.6-2.ius.centos7 \\\n && yum versionlock add elinks httpd24u* php72u* \\\n && rm -rf /var/cache/yum/* \\\n && yum clean all \\\n && /bin/find /usr/share -type f -regextype posix-extended -regex '.*\\.(jpg|png)$' -delete\n#   ------------------------------------------------------------------------------\n#   Copy files into place\n#   ------------------------------------------------------------------------------\nADD src /\n#   ------------------------------------------------------------------------------\n#   Provisioning\n#   - Add default system users\n#   - Limit threads for the application user\n#   - Disable Apache directory indexes and welcome page\n#   - Disable Apache language based content negotiation\n#   - Custom Apache configuration\n#   - Disable all Apache modules and enable the minimum\n#   - Disable SSL\n#   - Disable the default SSL Virtual Host\n#   - Global PHP configuration changes\n#   - Replace placeholders with values in systemd service unit template\n#   - Set permissions\n#   ------------------------------------------------------------------------------\nRUN useradd -r -M -d /var/www/app -s /sbin/nologin app \\\n && useradd -r -M -d /var/www/app -s /sbin/nologin -G apache,app app-www \\\n && usermod -a -G app-www app \\\n && usermod -a -G app-www,app apache \\\n && usermod -L app \\\n && usermod -L app-www \\\n && { printf -- '\\n@apache\\tsoft\\tnproc\\t%s\\n@apache\\thard\\tnproc\\t%s\\n' '85' '170' ; } >> /etc/security/limits.conf \\\n && cp -pf /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.default \\\n && sed -i -e '/^KeepAlive .*$/d' -e '/^MaxKeepAliveRequests .*$/d' -e '/^KeepAliveTimeout .*$/d' -e '/^ServerSignature On$/d' -e '/^ServerTokens OS$/d' -e 's~^NameVirtualHost \\(.*\\)$~#NameVirtualHost \\1~g' -e 's~^User .*$~User ${APACHE_RUN_USER}~g' -e 's~^Group .*$~Group ${APACHE_RUN_GROUP}~g' -e 's~^DocumentRoot \\(.*\\)$~#DocumentRoot \\1~g' -e 's~^IndexOptions \\(.*\\)$~#IndexOptions \\1~g' -e 's~^IndexIgnore \\(.*\\)$~#IndexIgnore \\1~g' -e 's~^AddIconByEncoding \\(.*\\)$~#AddIconByEncoding \\1~g' -e 's~^AddIconByType \\(.*\\)$~#AddIconByType \\1~g' -e 's~^AddIcon \\(.*\\)$~#AddIcon \\1~g' -e 's~^DefaultIcon \\(.*\\)$~#DefaultIcon \\1~g' -e 's~^ReadmeName \\(.*\\)$~#ReadmeName \\1~g' -e 's~^HeaderName \\(.*\\)$~#HeaderName \\1~g' -e 's~^\\(Alias /icons/ \".*\"\\)$~#\\1~' -e '/<Directory \"\\/var\\/www\\/icons\">/,/#<\\/Directory>/ s~^~#~' -e 's~^LanguagePriority \\(.*\\)$~#LanguagePriority \\1~g' -e 's~^ForceLanguagePriority \\(.*\\)$~#ForceLanguagePriority \\1~g' -e 's~^AddLanguage \\(.*\\)$~#AddLanguage \\1~g' /etc/httpd/conf/httpd.conf \\\n && truncate -s 0 /etc/httpd/conf.d/autoindex.conf \\\n && chmod 444 /etc/httpd/conf.d/autoindex.conf \\\n && truncate -s 0 /etc/httpd/conf.d/welcome.conf \\\n && chmod 444 /etc/httpd/conf.d/welcome.conf \\\n && { printf -- '\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\\\\\n%s%s\\\\\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n' '#' '# Custom configuration' '#' 'KeepAlive On' 'MaxKeepAliveRequests 200' 'KeepAliveTimeout 2' 'LogFormat ' ' \"%{X-Forwarded-For}i %l %u %t \\\"%r\\\" %>s %b' ' \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" ' ' forwarded_for_combined' 'ExtendedStatus Off' 'Listen 8443' 'Options -Indexes' 'ServerSignature Off' 'ServerTokens Prod' 'TraceEnable Off' 'UseCanonicalName On' 'UseCanonicalPhysicalPort On' ; } >> /etc/httpd/conf/httpd.conf \\\n && sed -i -e 's~^\\(LoadModule .*\\)$~#\\1~g' -e 's~^#\\(LoadModule mime_module .*\\)$~\\1~' -e 's~^#\\(LoadModule log_config_module .*\\)$~\\1~' -e 's~^#\\(LoadModule setenvif_module .*\\)$~\\1~' -e 's~^#\\(LoadModule status_module .*\\)$~\\1~' -e 's~^#\\(LoadModule authz_host_module .*\\)$~\\1~' -e 's~^#\\(LoadModule dir_module .*\\)$~\\1~' -e 's~^#\\(LoadModule alias_module .*\\)$~\\1~' -e 's~^#\\(LoadModule expires_module .*\\)$~\\1~' -e 's~^#\\(LoadModule deflate_module .*\\)$~\\1~' -e 's~^#\\(LoadModule headers_module .*\\)$~\\1~' -e 's~^#\\(LoadModule alias_module .*\\)$~\\1~' -e 's~^#\\(LoadModule version_module .*\\)$~\\1~' /etc/httpd/conf.modules.d/00-base.conf /etc/httpd/conf.modules.d/00-dav.conf /etc/httpd/conf.modules.d/00-lua.conf /etc/httpd/conf.modules.d/00-proxy.conf /etc/httpd/conf.modules.d/00-ssl.conf /etc/httpd/conf.modules.d/00-systemd.conf \\\n && sed -ri -e '/<VirtualHost _default_:443>/,/<\\/VirtualHost>/ s~^~#~' -e 's~(SSLSessionCacheTimeout.*)$~\\1\\n\\nSSLUseStapling on\\nSSLStaplingCache shmcb:/run/httpd/sslstaplingcache(512000)\\nSSLStaplingResponderTimeout 5\\nSSLStaplingReturnResponderErrors off~' /etc/httpd/conf.d/ssl.conf \\\n && cat /etc/httpd/conf.d/ssl.conf > /etc/httpd/conf.d/ssl.conf.off \\\n && truncate -s 0 /etc/httpd/conf.d/ssl.conf \\\n && chmod 644 /etc/httpd/conf.d/ssl.conf \\\n && cp -pf /etc/php-fpm.conf /etc/php-fpm.conf.default \\\n && cp -pf /etc/php-fpm.d/www.conf /etc/php-fpm.d/www.conf.default \\\n && cp -pf /etc/httpd/conf.d/php-fpm.conf /etc/httpd/conf.d/php-fpm.conf.default \\\n && sed -e 's~^; .*$~~' -e 's~^;*$~~' -e '/^$/d' -e 's~^\\[~\\n\\[~g' /etc/php.ini > /etc/php.d/00-php.ini.default \\\n && sed -r -e 's~^;(user_ini.filename =)$~\\1~g' -e 's~^;(cgi.fix_pathinfo=1)$~\\1~g' -e 's~^;(date.timezone =)$~\\1 UTC~g' -e 's~^(expose_php = )On$~\\1Off~g' -e 's~^;(realpath_cache_size = ).*$~\\14096k~' -e 's~^;(realpath_cache_ttl = ).*$~\\1600~' -e 's~^;?(session.name = ).*$~\\1\"${PHP_OPTIONS_SESSION_NAME:-PHPSESSID}\"~' -e 's~^;?(session.save_handler = ).*$~\\1\"${PHP_OPTIONS_SESSION_SAVE_HANDLER:-files}\"~' -e 's~^;?(session.save_path = ).*$~\\1\"${PHP_OPTIONS_SESSION_SAVE_PATH:-/var/lib/php/session}\"~' /etc/php.d/00-php.ini.default > /etc/php.d/00-php.ini \\\n && sed -e 's~^; .*$~~' -e 's~^;*$~~' -e '/^$/d' -e 's~^\\[~\\n\\[~g' /etc/php.d/10-opcache.ini > /etc/php.d/10-opcache.ini.default \\\n && sed -e 's~^;\\(opcache.enable_cli=\\).*$~\\11~g' -e 's~^\\(opcache.max_accelerated_files=\\).*$~\\132531~g' -e 's~^;\\(opcache.validate_timestamps=\\).*$~\\10~g' /etc/php.d/10-opcache.ini.default > /etc/php.d/10-opcache.ini \\\n && if [[ ${RELEASE_VERSION%%.*} -ge 3 ]] ; then sed -r -i -e 's~^(error_log) *=.*$~\\1 = /dev/stderr~' -e 's~^;?(systemd_interval = ).*$~\\10~' /etc/php-fpm.conf ; else sed -r -i -e 's~^(error_log) *=.*$~\\1 = /dev/stderr~' /etc/php-fpm.conf ; fi \\\n && sed -i -e 's~^\\[www\\]$~[{{APACHE_RUN_USER}}]~' -e 's~^user = php-fpm$~user = {{APACHE_RUN_USER}}~' -e 's~^group = php-fpm$~group = {{APACHE_RUN_GROUP}}~' -e 's~^listen = 127.0.0.1:9000$~;listen = 127.0.0.1:9000~' -e 's~^;listen = /run/php-fpm/www.sock$~listen = /run/php-fpm/{{APACHE_RUN_USER}}.sock~' -e 's~^;listen.owner = root$~listen.owner = {{APACHE_RUN_USER}}~' -e 's~^;listen.group = root$~listen.group = {{APACHE_RUN_GROUP}}~' -e 's~^pm.max_children = 50$~pm.max_children = 64~' -e 's~^slowlog = /var/log/php-fpm/www-slow.log$~slowlog = /var/log/php-fpm/{{APACHE_RUN_USER}}-slow.log~' -e 's~^\\(php_admin_value\\[error_log\\].*\\)$~;\\1~' -e 's~^\\(php_admin_flag\\[log_errors\\].*\\)$~;\\1~' -e 's~^\\(php_value\\[session.save_handler\\].*\\)$~;\\1~' -e 's~^\\(php_value\\[session.save_path\\].*\\)$~;\\1~' -e 's~^\\(php_value\\[soap.wsdl_cache_dir\\].*\\)$~;\\1~' -e 's~^;\\(pm.status_path = \\).*$~\\1/status~' /etc/php-fpm.d/www.conf \\\n && cat /etc/php-fpm.d/www.conf > /etc/php-fpm.d/www.conf.template \\\n && sed -i -e 's~^\\([ \\t]*\\)\\(SetHandler \"proxy:fcgi:.*\\)$~\\1#\\2~' -e 's~^\\([ \\t]*\\)#\\(SetHandler \"proxy:unix:.*\\)$~\\1\\2~' /etc/httpd/conf.d/php-fpm.conf \\\n && sed -i -e \"s~{{RELEASE_VERSION}}~${RELEASE_VERSION}~g\" /etc/systemd/system/centos-ssh-apache-php@.service \\\n && chmod 700 /usr/{bin/healthcheck,sbin/{httpd-{bootstrap,wrapper},php-fpm-wrapper}}\n#   ------------------------------------------------------------------------------\n#   Package installation\n#   ------------------------------------------------------------------------------\nRUN mkdir -p -m 750 ${PACKAGE_PATH} \\\n && curl -Ls https://github.com/jdeathe/php-hello-world/archive/${PACKAGE_RELEASE_VERSION}.tar.gz | tar -xzpf - --strip-components=1 --exclude=\"*.gitkeep\" -C ${PACKAGE_PATH} \\\n && sed -i -e 's~^description =.*$~description = \"This CentOS / Apache / PHP-FPM (FastCGI) service is running in a container.\"~' ${PACKAGE_PATH}/etc/views/index.ini \\\n && mv ${PACKAGE_PATH}/public ${PACKAGE_PATH}/public_html \\\n && $( if [[ -f /usr/share/php-pecl-apc/apc.php ]] ; then cp /usr/share/php-pecl-apc/apc.php ${PACKAGE_PATH}/public_html/_apc.php ; fi ;) \\\n && chown -R app:app-www ${PACKAGE_PATH} \\\n && find ${PACKAGE_PATH} -type d -exec chmod 750 {} + \\\n && find ${PACKAGE_PATH}/var -type d -exec chmod 770 {} + \\\n && find ${PACKAGE_PATH} -type f -exec chmod 640 {} + \\\n && find ${PACKAGE_PATH}/bin -type f -exec chmod 750 {} +\nEXPOSE 80/tcp 443/tcp 8443/tcp\n#   ------------------------------------------------------------------------------\n#   Set default environment variables used to configure the service container\n#   ------------------------------------------------------------------------------\nENV APACHE_AUTOSTART_HTTPD_BOOTSTRAP=\"true\" \\\n    APACHE_AUTOSTART_HTTPD_WRAPPER=\"true\" \\\n    APACHE_AUTOSTART_PHP_FPM_WRAPPER=\"true\" \\\n    APACHE_CONTENT_ROOT=\"/var/www/${PACKAGE_NAME}\" \\\n    APACHE_CUSTOM_LOG_FORMAT=\"combined\" \\\n    APACHE_CUSTOM_LOG_LOCATION=\"var/log/apache_access_log\" \\\n    APACHE_ERROR_LOG_LOCATION=\"var/log/apache_error_log\" \\\n    APACHE_ERROR_LOG_LEVEL=\"warn\" \\\n    APACHE_EXTENDED_STATUS_ENABLED=\"false\" \\\n    APACHE_HEADER_X_SERVICE_UID=\"{{HOSTNAME}}\" \\\n    APACHE_LOAD_MODULES=\"\" \\\n    APACHE_MOD_SSL_ENABLED=\"false\" \\\n    APACHE_MPM=\"prefork\" \\\n    APACHE_OPERATING_MODE=\"production\" \\\n    APACHE_PUBLIC_DIRECTORY=\"public_html\" \\\n    APACHE_RUN_GROUP=\"app-www\" \\\n    APACHE_RUN_USER=\"app-www\" \\\n    APACHE_SERVER_ALIAS=\"\" \\\n    APACHE_SERVER_NAME=\"\" \\\n    APACHE_SSL_CERTIFICATE=\"\" \\\n    APACHE_SSL_CIPHER_SUITE=\"ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS\" \\\n    APACHE_SSL_PROTOCOL=\"All -SSLv2 -SSLv3\" \\\n    APACHE_SYSTEM_USER=\"app\" \\\n    PACKAGE_PATH=\"${PACKAGE_PATH}\" \\\n    PHP_OPTIONS_DATE_TIMEZONE=\"UTC\" \\\n    PHP_OPTIONS_SESSION_NAME=\"PHPSESSID\" \\\n    PHP_OPTIONS_SESSION_SAVE_HANDLER=\"files\" \\\n    PHP_OPTIONS_SESSION_SAVE_PATH=\"var/session\" \\\n    SSH_AUTOSTART_SSHD=\"false\" \\\n    SSH_AUTOSTART_SSHD_BOOTSTRAP=\"false\" \\\n    SSH_AUTOSTART_SUPERVISOR_STDOUT=\"false\"\n#   ------------------------------------------------------------------------------\n#   Set image metadata\n#   ------------------------------------------------------------------------------\nLABEL maintainer=\"James Deathe <james.deathe@gmail.com>\" \\\n      install=\"docker run --rm --privileged --volume /:/media/root jdeathe/centos-ssh-apache-php:${RELEASE_VERSION} /usr/sbin/scmi install --chroot=/media/root --name=\\${NAME} --tag=${RELEASE_VERSION}\" \\\n      uninstall=\"docker run --rm --privileged --volume /:/media/root jdeathe/centos-ssh-apache-php:${RELEASE_VERSION} /usr/sbin/scmi uninstall --chroot=/media/root --name=\\${NAME} --tag=${RELEASE_VERSION}\" \\\n      org.deathe.name=\"centos-ssh-apache-php\" \\\n      org.deathe.version=\"${RELEASE_VERSION}\" \\\n      org.deathe.release=\"jdeathe/centos-ssh-apache-php:${RELEASE_VERSION}\" \\\n      org.deathe.license=\"MIT\" \\\n      org.deathe.vendor=\"jdeathe\" \\\n      org.deathe.url=\"https://github.com/jdeathe/centos-ssh-apache-php\" \\\n      org.deathe.description=\"CentOS-7 7.5.1804 x86_64 - IUS Apache 2.4, IUS PHP-FPM 7.2, PHP memcached 3.0, Zend Opcache 7.2.\"\nHEALTHCHECK --interval=1s --timeout=1s --retries=10 CMD [\"/usr/bin/healthcheck\"]\nCMD [\"/usr/bin/supervisord\", \"--configuration=/etc/supervisord.conf\"]\n","originalDockerfileUglifiedHash":"d13e9f193c5ef21d151f0295ad6c8787","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/d74740dcce5f69b73482b4bc402833dcd8c8f089.dockerfile"}