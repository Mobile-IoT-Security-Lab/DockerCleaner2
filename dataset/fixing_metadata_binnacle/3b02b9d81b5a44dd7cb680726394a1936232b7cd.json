{"seed":275360806,"processedDockerfileHash":"916bc083ddec7015f2b178b1c4de4087","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM golang:1.9-stretch AS builder\nENV IMAGEMAGICK_VERSION=\"7.0.7-14\"\nRUN apt-get update \\\n && apt-get install --no-install-recommends build-essential libpng-dev libjpeg-dev libwebp-dev libexif-dev liblzma-dev libtiff-dev libopenjp2-7-dev liblcms2-dev libxml2-dev zlib1g-dev ca-certificates gpg pkg-config wget -y\nENV GOSU_VERSION=\"1.10\"\nRUN set -ex ; fetchDeps='ca-certificates wget' ; apt-get update ; apt-get install --no-install-recommends $fetchDeps -y ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; chmod +x /usr/local/bin/gosu ; gosu nobody true\nRUN mkdir /build \\\n && cd /build \\\n && wget https://github.com/ImageMagick/ImageMagick/archive/${IMAGEMAGICK_VERSION}.tar.gz \\\n && tar zxf ${IMAGEMAGICK_VERSION}.tar.gz \\\n && cd ImageMagick-${IMAGEMAGICK_VERSION} \\\n && ./configure --prefix=/usr --enable-shared --disable-openmp --disable-hdri --disable-largefile --disable-static --with-bzlib --with-jpeg --with-jp2 --with-lcms --with-png --with-tiff --with-webp --with-xml --with-zlib --with-quantum-depth=8 --without-dot --without-dps --without-fpx --without-freetype --without-gslib --without-magick-plus-plus --without-perl --without-wmf --without-x\nRUN cd /build/ImageMagick-${IMAGEMAGICK_VERSION} \\\n && make \\\n && make install\nCOPY . /go/src/github.com/pressly/imgry\nWORKDIR /go/src/github.com/pressly/imgry\nRUN make dist\nFROM debian:stretch-slim\nRUN apt-get update \\\n && apt-get install --no-install-recommends ca-certificates libpng16-16 libjpeg62-turbo libwebp6 libexif12 lzma libtiff5 libopenjp2-7 liblcms2-2 libxml2 zlib1g -y \\\n && rm -rf /var/lib/apt/lists/*\nCOPY --from=builder /usr/etc/ImageMagick-7 /usr/etc/ImageMagick-7\nCOPY --from=builder /usr/include/ImageMagick-7 /usr/include/ImageMagick-7\nCOPY --from=builder /usr/lib/* /usr/lib/\nRUN ldconfig\nCOPY --from=builder /usr/local/bin/gosu /usr/local/bin/gosu\nCOPY --from=builder /go/src/github.com/pressly/imgry/bin/imgry-server /bin/imgry-server\nCOPY --from=builder /go/src/github.com/pressly/imgry/scripts/docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\nEXPOSE 4446/tcp\nCMD [\"/bin/imgry-server\", \"-config=/imgry.conf\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM golang:1.9-stretch AS builder\nENV IMAGEMAGICK_VERSION=\"7.0.7-14\"\nRUN apt-get update \\\n && apt-get install --no-install-recommends build-essential libpng-dev libjpeg-dev libwebp-dev libexif-dev liblzma-dev libtiff-dev libopenjp2-7-dev liblcms2-dev libxml2-dev zlib1g-dev ca-certificates gpg pkg-config wget -y\nENV GOSU_VERSION=\"1.10\"\nRUN set -ex ; fetchDeps='ca-certificates wget' ; apt-get update ; apt-get install --no-install-recommends $fetchDeps -y ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; chmod +x /usr/local/bin/gosu ; gosu nobody true\nRUN mkdir /build \\\n && cd /build \\\n && wget https://github.com/ImageMagick/ImageMagick/archive/${IMAGEMAGICK_VERSION}.tar.gz \\\n && tar zxf ${IMAGEMAGICK_VERSION}.tar.gz \\\n && cd ImageMagick-${IMAGEMAGICK_VERSION} \\\n && ./configure --prefix=/usr --enable-shared --disable-openmp --disable-hdri --disable-largefile --disable-static --with-bzlib --with-jpeg --with-jp2 --with-lcms --with-png --with-tiff --with-webp --with-xml --with-zlib --with-quantum-depth=8 --without-dot --without-dps --without-fpx --without-freetype --without-gslib --without-magick-plus-plus --without-perl --without-wmf --without-x\nRUN cd /build/ImageMagick-${IMAGEMAGICK_VERSION} \\\n && make \\\n && make install\nADD . /go/src/github.com/pressly/imgry\nWORKDIR /go/src/github.com/pressly/imgry\nRUN make dist\nFROM debian:stretch-slim\nRUN apt-get update \\\n && apt-get install --no-install-recommends ca-certificates libpng16-16 libjpeg62-turbo libwebp6 libexif12 lzma libtiff5 libopenjp2-7 liblcms2-2 libxml2 zlib1g -y \\\n && rm -rf /var/lib/apt/lists/*\nCOPY --from=builder /usr/etc/ImageMagick-7 /usr/etc/ImageMagick-7\nCOPY --from=builder /usr/include/ImageMagick-7 /usr/include/ImageMagick-7\nCOPY --from=builder /usr/lib/* /usr/lib/\nRUN ldconfig\nCOPY --from=builder /usr/local/bin/gosu /usr/local/bin/gosu\nCOPY --from=builder /go/src/github.com/pressly/imgry/bin/imgry-server /bin/imgry-server\nCOPY --from=builder /go/src/github.com/pressly/imgry/scripts/docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\nEXPOSE 4446/tcp\nCMD [\"/bin/imgry-server\", \"-config=/imgry.conf\"]\n","injectedSmells":[],"originalDockerfileHash":"f0b369e73894f32f4495f64a1069ac26","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM golang:1.9-stretch AS builder\nENV IMAGEMAGICK_VERSION=\"7.0.7-14\"\nRUN apt-get update \\\n && apt-get install --no-install-recommends build-essential libpng-dev libjpeg-dev libwebp-dev libexif-dev liblzma-dev libtiff-dev libopenjp2-7-dev liblcms2-dev libxml2-dev zlib1g-dev ca-certificates gpg pkg-config wget -y\nENV GOSU_VERSION=\"1.10\"\nRUN set -ex ; fetchDeps='ca-certificates wget' ; apt-get update ; apt-get install --no-install-recommends $fetchDeps -y ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; chmod +x /usr/local/bin/gosu ; gosu nobody true\nRUN mkdir /build \\\n && cd /build \\\n && wget https://github.com/ImageMagick/ImageMagick/archive/${IMAGEMAGICK_VERSION}.tar.gz \\\n && tar zxf ${IMAGEMAGICK_VERSION}.tar.gz \\\n && cd ImageMagick-${IMAGEMAGICK_VERSION} \\\n && ./configure --prefix=/usr --enable-shared --disable-openmp --disable-hdri --disable-largefile --disable-static --with-bzlib --with-jpeg --with-jp2 --with-lcms --with-png --with-tiff --with-webp --with-xml --with-zlib --with-quantum-depth=8 --without-dot --without-dps --without-fpx --without-freetype --without-gslib --without-magick-plus-plus --without-perl --without-wmf --without-x\nRUN cd /build/ImageMagick-${IMAGEMAGICK_VERSION} \\\n && make \\\n && make install\nADD . /go/src/github.com/pressly/imgry\nWORKDIR /go/src/github.com/pressly/imgry\nRUN make dist\nFROM debian:stretch-slim\nRUN apt-get update \\\n && apt-get install --no-install-recommends ca-certificates libpng16-16 libjpeg62-turbo libwebp6 libexif12 lzma libtiff5 libopenjp2-7 liblcms2-2 libxml2 zlib1g -y \\\n && rm -rf /var/lib/apt/lists/*\nCOPY --from=builder /usr/etc/ImageMagick-7 /usr/etc/ImageMagick-7\nCOPY --from=builder /usr/include/ImageMagick-7 /usr/include/ImageMagick-7\nCOPY --from=builder /usr/lib/* /usr/lib/\nRUN ldconfig\nCOPY --from=builder /usr/local/bin/gosu /usr/local/bin/gosu\nCOPY --from=builder /go/src/github.com/pressly/imgry/bin/imgry-server /bin/imgry-server\nCOPY --from=builder /go/src/github.com/pressly/imgry/scripts/docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\nEXPOSE 4446/tcp\nCMD [\"/bin/imgry-server\", \"-config=/imgry.conf\"]\n","originalDockerfileUglifiedHash":"f0b369e73894f32f4495f64a1069ac26","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/3b02b9d81b5a44dd7cb680726394a1936232b7cd.dockerfile"}