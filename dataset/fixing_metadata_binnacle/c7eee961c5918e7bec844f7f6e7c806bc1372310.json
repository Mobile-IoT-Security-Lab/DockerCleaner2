{"seed":3201210079,"processedDockerfileHash":"000b01294cf16e0179b8d27c89291237","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM ubuntu:19.04 AS builder\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN sed -i \"s/# deb-src/deb-src/g\" /etc/apt/sources.list\nRUN :\nRUN apt-get -yy upgrade\nENV BUILD_DEPS=\"git autoconf pkg-config libssl-dev libpam0g-dev  libx11-dev libxfixes-dev libxrandr-dev nasm xsltproc flex  bison libxml2-dev dpkg-dev libcap-dev\"\nRUN (apt-get update ;apt-get install --no-install-recommends sudo apt-utils software-properties-common $BUILD_DEPS -yy )\nWORKDIR /tmp\nRUN apt-get source pulseaudio\nRUN apt-get build-dep -yy pulseaudio\nRUN ls\nWORKDIR /tmp/pulseaudio-12.2\nRUN dpkg-buildpackage -rfakeroot -uc -b\nWORKDIR /tmp\nRUN git clone --branch v0.9.7 --recursive https://github.com/neutrinolabs/xrdp.git\nWORKDIR /tmp/xrdp\nRUN ./bootstrap\nRUN ./configure\nRUN make\nRUN make install\nWORKDIR /tmp/xrdp/sesman/chansrv/pulse\nRUN sed -i \"s/\\/tmp\\/pulseaudio\\-10\\.0/\\/tmp\\/pulseaudio\\-12\\.2/g\" Makefile\nRUN make\nRUN mkdir -p /tmp/so\nRUN cp *.so /tmp/so\nFROM ubuntu:19.04\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV DBUS_SESSION_BUS_ADDRESS=\"/dev/null\"\nENV LANG=\"en_GB.UTF-8\"\nENV LANGUAGE=\"en_GB:GB\"\nENV LC_ALL=\"en_GB.UTF-8\"\nRUN cd /root \\\n && sed -i 's/^#\\s*\\(deb.*partner\\)$/\\1/g' /etc/apt/sources.list \\\n && apt-get update -y \\\n && (apt-get update ;apt-get install --no-install-recommends locales -yqq ) \\\n && echo 'LANG=\"en_GB.UTF-8\"' > /etc/default/locale \\\n && echo 'LANGUAGE=\"en_GB:en\"' >> /etc/default/locale \\\n && echo 'LC_ALL=\"en_GB.UTF-8\"' >> /etc/default/locale \\\n && locale-gen en_GB.UTF-8 \\\n && update-locale LANG=en_GB.UTF-8 \\\n && (apt-get update ;apt-get install --no-install-recommends mate-desktop-environment-core mate-themes mate-accessibility-profiles mate-applet-appmenu mate-applet-brisk-menu mate-applets mate-applets-common mate-calc mate-calc-common mate-dock-applet mate-hud mate-indicator-applet mate-indicator-applet-common mate-menu mate-notification-daemon mate-notification-daemon-common mate-utils mate-utils-common mate-window-applets-common mate-window-buttons-applet mate-window-menu-applet mate-window-title-applet ubuntu-mate-icon-themes ubuntu-mate-themes tightvncserver pulseaudio uuid-runtime -yqq ) \\\n && (apt-get update ;apt-get install --no-install-recommends supervisor sudo tzdata vim mc ca-certificates xterm curl wget epiphany-browser -yqq ) \\\n && ln -fs /usr/share/zoneinfo/Europe/London /etc/localtime \\\n && dpkg-reconfigure -f noninteractive tzdata \\\n && (apt-get update ;apt-get install --no-install-recommends git libxfont-dev xserver-xorg-core libx11-dev libxfixes-dev libssl-dev libpam0g-dev libtool libjpeg-dev flex bison gettext autoconf libxml-parser-perl libfuse-dev xsltproc libxrandr-dev python-libxml2 nasm xserver-xorg-dev fuse build-essential pkg-config -y ) \\\n && cd /root \\\n && git clone -b devel https://github.com/neutrinolabs/xrdp.git \\\n && git clone -b devel https://github.com/neutrinolabs/xorgxrdp.git \\\n && cd /root/xrdp \\\n && ./bootstrap \\\n && ./configure --enable-fuse --enable-jpeg \\\n && make \\\n && make install \\\n && cd /root/xorgxrdp \\\n && ./bootstrap \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -R /root/xrdp \\\n && rm -R /root/xorgxrdp \\\n && apt-get -y purge git libxfont-dev libx11-dev libxfixes-dev libssl-dev libpam0g-dev libtool libjpeg-dev flex bison gettext autoconf libxml-parser-perl libfuse-dev xsltproc libxrandr-dev python-libxml2 nasm xserver-xorg-dev build-essential pkg-config \\\n && apt-get -y autoclean \\\n && apt-get -y autoremove \\\n && apt-get -y purge $( dpkg --get-selections | grep deinstall | sed s/deinstall//g ;) \\\n && rm -rf /var/lib/apt/lists/* \\\n && echo \"mate-session\" > /etc/skel/.xsession \\\n && sed -i '/TerminalServerUsers/d' /etc/xrdp/sesman.ini \\\n && sed -i '/TerminalServerAdmins/d' /etc/xrdp/sesman.ini \\\n && sed -i -e '/DisconnectedTimeLimit=/ s/=.*/=300/' /etc/xrdp/sesman.ini \\\n && sed -i -e '/IdleTimeLimit=/ s/=.*/=300/' /etc/xrdp/sesman.ini \\\n && xrdp-keygen xrdp auto \\\n && mkdir -p /var/run/xrdp \\\n && chmod 2775 /var/run/xrdp \\\n && mkdir -p /var/run/xrdp/sockdir \\\n && chmod 3777 /var/run/xrdp/sockdir \\\n && echo \"[program:sshd]\" > /etc/supervisor/conf.d/sshd.conf \\\n && echo \"command=/usr/sbin/sshd -D\" >> /etc/supervisor/conf.d/sshd.conf \\\n && echo \"stdout_logfile=/var/log/supervisor/%(program_name)s.log\" >> /etc/supervisor/conf.d/sshd.conf \\\n && echo \"stderr_logfile=/var/log/supervisor/%(program_name)s.log\" >> /etc/supervisor/conf.d/sshd.conf \\\n && echo \"autorestart=true\" >> /etc/supervisor/conf.d/sshd.conf \\\n && echo \"[program:xrdp-sesman]\" > /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"command=/usr/local/sbin/xrdp-sesman --nodaemon\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"process_name = xrdp-sesman\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"[program:xrdp]\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"command=/usr/local/sbin/xrdp -nodaemon\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"process_name = xrdp\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && mkdir /var/run/dbus \\\n && mkdir -p /var/lib/xrdp-pulseaudio-installer\nCOPY xrdp.ini /etc/xrdp/xrdp.ini\nCOPY asound.conf /etc/asound.conf\nCOPY --from=builder /tmp/so/module-xrdp-source.so /var/lib/xrdp-pulseaudio-installer\nCOPY --from=builder /tmp/so/module-xrdp-sink.so /var/lib/xrdp-pulseaudio-installer\nCOPY startup.sh /root/startup.sh\nCMD [\"/bin/bash\", \"/root/startup.sh\"]\nEXPOSE 3389/tcp\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ubuntu:19.04 AS builder\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN sed -i \"s/# deb-src/deb-src/g\" /etc/apt/sources.list\nRUN apt-get update -y\nRUN apt-get -yy upgrade\nENV BUILD_DEPS=\"git autoconf pkg-config libssl-dev libpam0g-dev  libx11-dev libxfixes-dev libxrandr-dev nasm xsltproc flex  bison libxml2-dev dpkg-dev libcap-dev\"\nRUN apt-get install sudo apt-utils software-properties-common $BUILD_DEPS -yy\nWORKDIR /tmp\nRUN apt-get source pulseaudio\nRUN apt-get build-dep -yy pulseaudio\nRUN ls\nWORKDIR /tmp/pulseaudio-12.2\nRUN dpkg-buildpackage -rfakeroot -uc -b\nWORKDIR /tmp\nRUN git clone --branch v0.9.7 --recursive https://github.com/neutrinolabs/xrdp.git\nWORKDIR /tmp/xrdp\nRUN ./bootstrap\nRUN ./configure\nRUN make\nRUN make install\nWORKDIR /tmp/xrdp/sesman/chansrv/pulse\nRUN sed -i \"s/\\/tmp\\/pulseaudio\\-10\\.0/\\/tmp\\/pulseaudio\\-12\\.2/g\" Makefile\nRUN make\nRUN mkdir -p /tmp/so\nRUN cp *.so /tmp/so\nFROM ubuntu:19.04\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV DBUS_SESSION_BUS_ADDRESS=\"/dev/null\"\nENV LANG=\"en_GB.UTF-8\"\nENV LANGUAGE=\"en_GB:GB\"\nENV LC_ALL=\"en_GB.UTF-8\"\nRUN cd /root \\\n && sed -i 's/^#\\s*\\(deb.*partner\\)$/\\1/g' /etc/apt/sources.list \\\n && apt-get update -y \\\n && apt-get install locales -yqq \\\n && echo 'LANG=\"en_GB.UTF-8\"' > /etc/default/locale \\\n && echo 'LANGUAGE=\"en_GB:en\"' >> /etc/default/locale \\\n && echo 'LC_ALL=\"en_GB.UTF-8\"' >> /etc/default/locale \\\n && locale-gen en_GB.UTF-8 \\\n && update-locale LANG=en_GB.UTF-8 \\\n && apt-get install mate-desktop-environment-core mate-themes mate-accessibility-profiles mate-applet-appmenu mate-applet-brisk-menu mate-applets mate-applets-common mate-calc mate-calc-common mate-dock-applet mate-hud mate-indicator-applet mate-indicator-applet-common mate-menu mate-notification-daemon mate-notification-daemon-common mate-utils mate-utils-common mate-window-applets-common mate-window-buttons-applet mate-window-menu-applet mate-window-title-applet ubuntu-mate-icon-themes ubuntu-mate-themes tightvncserver pulseaudio uuid-runtime -yqq \\\n && apt-get install --no-install-recommends supervisor sudo tzdata vim mc ca-certificates xterm curl wget epiphany-browser -yqq \\\n && ln -fs /usr/share/zoneinfo/Europe/London /etc/localtime \\\n && dpkg-reconfigure -f noninteractive tzdata \\\n && apt-get install git libxfont-dev xserver-xorg-core libx11-dev libxfixes-dev libssl-dev libpam0g-dev libtool libjpeg-dev flex bison gettext autoconf libxml-parser-perl libfuse-dev xsltproc libxrandr-dev python-libxml2 nasm xserver-xorg-dev fuse build-essential pkg-config -y \\\n && cd /root \\\n && git clone -b devel https://github.com/neutrinolabs/xrdp.git \\\n && git clone -b devel https://github.com/neutrinolabs/xorgxrdp.git \\\n && cd /root/xrdp \\\n && ./bootstrap \\\n && ./configure --enable-fuse --enable-jpeg \\\n && make \\\n && make install \\\n && cd /root/xorgxrdp \\\n && ./bootstrap \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -R /root/xrdp \\\n && rm -R /root/xorgxrdp \\\n && apt-get -y purge git libxfont-dev libx11-dev libxfixes-dev libssl-dev libpam0g-dev libtool libjpeg-dev flex bison gettext autoconf libxml-parser-perl libfuse-dev xsltproc libxrandr-dev python-libxml2 nasm xserver-xorg-dev build-essential pkg-config \\\n && apt-get -y autoclean \\\n && apt-get -y autoremove \\\n && apt-get -y purge $( dpkg --get-selections | grep deinstall | sed s/deinstall//g ;) \\\n && rm -rf /var/lib/apt/lists/* \\\n && echo \"mate-session\" > /etc/skel/.xsession \\\n && sed -i '/TerminalServerUsers/d' /etc/xrdp/sesman.ini \\\n && sed -i '/TerminalServerAdmins/d' /etc/xrdp/sesman.ini \\\n && sed -i -e '/DisconnectedTimeLimit=/ s/=.*/=300/' /etc/xrdp/sesman.ini \\\n && sed -i -e '/IdleTimeLimit=/ s/=.*/=300/' /etc/xrdp/sesman.ini \\\n && xrdp-keygen xrdp auto \\\n && mkdir -p /var/run/xrdp \\\n && chmod 2775 /var/run/xrdp \\\n && mkdir -p /var/run/xrdp/sockdir \\\n && chmod 3777 /var/run/xrdp/sockdir \\\n && echo \"[program:sshd]\" > /etc/supervisor/conf.d/sshd.conf \\\n && echo \"command=/usr/sbin/sshd -D\" >> /etc/supervisor/conf.d/sshd.conf \\\n && echo \"stdout_logfile=/var/log/supervisor/%(program_name)s.log\" >> /etc/supervisor/conf.d/sshd.conf \\\n && echo \"stderr_logfile=/var/log/supervisor/%(program_name)s.log\" >> /etc/supervisor/conf.d/sshd.conf \\\n && echo \"autorestart=true\" >> /etc/supervisor/conf.d/sshd.conf \\\n && echo \"[program:xrdp-sesman]\" > /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"command=/usr/local/sbin/xrdp-sesman --nodaemon\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"process_name = xrdp-sesman\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"[program:xrdp]\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"command=/usr/local/sbin/xrdp -nodaemon\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"process_name = xrdp\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && mkdir /var/run/dbus \\\n && mkdir -p /var/lib/xrdp-pulseaudio-installer\nADD xrdp.ini /etc/xrdp/xrdp.ini\nADD asound.conf /etc/asound.conf\nCOPY --from=builder /tmp/so/module-xrdp-source.so /var/lib/xrdp-pulseaudio-installer\nCOPY --from=builder /tmp/so/module-xrdp-sink.so /var/lib/xrdp-pulseaudio-installer\nADD startup.sh /root/startup.sh\nCMD [\"/bin/bash\", \"/root/startup.sh\"]\nEXPOSE 3389/tcp\n","injectedSmells":[],"originalDockerfileHash":"4fe0cf2e1bc9111783a9359fbece96df","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:19.04 AS builder\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN sed -i \"s/# deb-src/deb-src/g\" /etc/apt/sources.list\nRUN apt-get update -y\nRUN apt-get -yy upgrade\nENV BUILD_DEPS=\"git autoconf pkg-config libssl-dev libpam0g-dev  libx11-dev libxfixes-dev libxrandr-dev nasm xsltproc flex  bison libxml2-dev dpkg-dev libcap-dev\"\nRUN apt-get install sudo apt-utils software-properties-common $BUILD_DEPS -yy\nWORKDIR /tmp\nRUN apt-get source pulseaudio\nRUN apt-get build-dep -yy pulseaudio\nRUN ls\nWORKDIR /tmp/pulseaudio-12.2\nRUN dpkg-buildpackage -rfakeroot -uc -b\nWORKDIR /tmp\nRUN git clone --branch v0.9.7 --recursive https://github.com/neutrinolabs/xrdp.git\nWORKDIR /tmp/xrdp\nRUN ./bootstrap\nRUN ./configure\nRUN make\nRUN make install\nWORKDIR /tmp/xrdp/sesman/chansrv/pulse\nRUN sed -i \"s/\\/tmp\\/pulseaudio\\-10\\.0/\\/tmp\\/pulseaudio\\-12\\.2/g\" Makefile\nRUN make\nRUN mkdir -p /tmp/so\nRUN cp *.so /tmp/so\nFROM ubuntu:19.04\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV DBUS_SESSION_BUS_ADDRESS=\"/dev/null\"\nENV LANG=\"en_GB.UTF-8\"\nENV LANGUAGE=\"en_GB:GB\"\nENV LC_ALL=\"en_GB.UTF-8\"\nRUN cd /root \\\n && sed -i 's/^#\\s*\\(deb.*partner\\)$/\\1/g' /etc/apt/sources.list \\\n && apt-get update -y \\\n && apt-get install locales -yqq \\\n && echo 'LANG=\"en_GB.UTF-8\"' > /etc/default/locale \\\n && echo 'LANGUAGE=\"en_GB:en\"' >> /etc/default/locale \\\n && echo 'LC_ALL=\"en_GB.UTF-8\"' >> /etc/default/locale \\\n && locale-gen en_GB.UTF-8 \\\n && update-locale LANG=en_GB.UTF-8 \\\n && apt-get install mate-desktop-environment-core mate-themes mate-accessibility-profiles mate-applet-appmenu mate-applet-brisk-menu mate-applets mate-applets-common mate-calc mate-calc-common mate-dock-applet mate-hud mate-indicator-applet mate-indicator-applet-common mate-menu mate-notification-daemon mate-notification-daemon-common mate-utils mate-utils-common mate-window-applets-common mate-window-buttons-applet mate-window-menu-applet mate-window-title-applet ubuntu-mate-icon-themes ubuntu-mate-themes tightvncserver pulseaudio uuid-runtime -yqq \\\n && apt-get install --no-install-recommends supervisor sudo tzdata vim mc ca-certificates xterm curl wget epiphany-browser -yqq \\\n && ln -fs /usr/share/zoneinfo/Europe/London /etc/localtime \\\n && dpkg-reconfigure -f noninteractive tzdata \\\n && apt-get install git libxfont-dev xserver-xorg-core libx11-dev libxfixes-dev libssl-dev libpam0g-dev libtool libjpeg-dev flex bison gettext autoconf libxml-parser-perl libfuse-dev xsltproc libxrandr-dev python-libxml2 nasm xserver-xorg-dev fuse build-essential pkg-config -y \\\n && cd /root \\\n && git clone -b devel https://github.com/neutrinolabs/xrdp.git \\\n && git clone -b devel https://github.com/neutrinolabs/xorgxrdp.git \\\n && cd /root/xrdp \\\n && ./bootstrap \\\n && ./configure --enable-fuse --enable-jpeg \\\n && make \\\n && make install \\\n && cd /root/xorgxrdp \\\n && ./bootstrap \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -R /root/xrdp \\\n && rm -R /root/xorgxrdp \\\n && apt-get -y purge git libxfont-dev libx11-dev libxfixes-dev libssl-dev libpam0g-dev libtool libjpeg-dev flex bison gettext autoconf libxml-parser-perl libfuse-dev xsltproc libxrandr-dev python-libxml2 nasm xserver-xorg-dev build-essential pkg-config \\\n && apt-get -y autoclean \\\n && apt-get -y autoremove \\\n && apt-get -y purge $( dpkg --get-selections | grep deinstall | sed s/deinstall//g ;) \\\n && rm -rf /var/lib/apt/lists/* \\\n && echo \"mate-session\" > /etc/skel/.xsession \\\n && sed -i '/TerminalServerUsers/d' /etc/xrdp/sesman.ini \\\n && sed -i '/TerminalServerAdmins/d' /etc/xrdp/sesman.ini \\\n && sed -i -e '/DisconnectedTimeLimit=/ s/=.*/=300/' /etc/xrdp/sesman.ini \\\n && sed -i -e '/IdleTimeLimit=/ s/=.*/=300/' /etc/xrdp/sesman.ini \\\n && xrdp-keygen xrdp auto \\\n && mkdir -p /var/run/xrdp \\\n && chmod 2775 /var/run/xrdp \\\n && mkdir -p /var/run/xrdp/sockdir \\\n && chmod 3777 /var/run/xrdp/sockdir \\\n && echo \"[program:sshd]\" > /etc/supervisor/conf.d/sshd.conf \\\n && echo \"command=/usr/sbin/sshd -D\" >> /etc/supervisor/conf.d/sshd.conf \\\n && echo \"stdout_logfile=/var/log/supervisor/%(program_name)s.log\" >> /etc/supervisor/conf.d/sshd.conf \\\n && echo \"stderr_logfile=/var/log/supervisor/%(program_name)s.log\" >> /etc/supervisor/conf.d/sshd.conf \\\n && echo \"autorestart=true\" >> /etc/supervisor/conf.d/sshd.conf \\\n && echo \"[program:xrdp-sesman]\" > /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"command=/usr/local/sbin/xrdp-sesman --nodaemon\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"process_name = xrdp-sesman\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"[program:xrdp]\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"command=/usr/local/sbin/xrdp -nodaemon\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && echo \"process_name = xrdp\" >> /etc/supervisor/conf.d/xrdp.conf \\\n && mkdir /var/run/dbus \\\n && mkdir -p /var/lib/xrdp-pulseaudio-installer\nADD xrdp.ini /etc/xrdp/xrdp.ini\nADD asound.conf /etc/asound.conf\nCOPY --from=builder /tmp/so/module-xrdp-source.so /var/lib/xrdp-pulseaudio-installer\nCOPY --from=builder /tmp/so/module-xrdp-sink.so /var/lib/xrdp-pulseaudio-installer\nADD startup.sh /root/startup.sh\nCMD [\"/bin/bash\", \"/root/startup.sh\"]\nEXPOSE 3389/tcp\n","originalDockerfileUglifiedHash":"4fe0cf2e1bc9111783a9359fbece96df","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/c7eee961c5918e7bec844f7f6e7c806bc1372310.dockerfile"}