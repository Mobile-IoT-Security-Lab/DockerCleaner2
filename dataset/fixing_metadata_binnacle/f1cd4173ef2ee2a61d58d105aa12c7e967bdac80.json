{"seed":1806865078,"processedDockerfileHash":"f185a33f5d41aa57b56301c9f57bda4a","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apt-get","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM php:7.1-apache\n#   Install apt packages\n#\n#   Required for php extensions\n#   * gd: libpng-dev\n#   * imagick: libmagickwand-dev\n#   * imap: libc-client-dev, libkrb5-dev\n#   * intl: libicu-dev\n#   * mcrypt: libmcrypt-dev\n#   * soap: libxml2-dev\n#   * zip: zlib1g-dev\n#\n#   Used in the build process\n#   * git\n#   * mysql-client\n#   * sudo\n#   * unzip\n#   * zip\n#   * node 9.x (from nodesource repository)\n#\n#   iproute2 is required to get host ip from container\nRUN curl -sL https://deb.nodesource.com/setup_9.x | bash \\\n && apt-get update \\\n && apt-get install --no-install-recommends git=1:2.20.1-2+deb10u8 iproute2=4.20.0-2+deb10u1 libc-client-dev libicu-dev=63.1-6+deb10u3 libjpeg62-turbo-dev=1:1.5.2-2+deb10u1 libkrb5-dev=1.17-3+deb10u5 libmagickwand-dev=8:6.9.10.23+dfsg-2.1+deb10u4 libmcrypt-dev=2.5.8-3.4 libpng-dev=1.6.36-6 libxml2-dev=2.9.4+dfsg1-7+deb10u5 msmtp-mta=1.8.3-1 mysql-client nodejs=10.24.0~dfsg-1~deb10u3 sudo=1.8.27-1+deb10u5 unzip=6.0-23+deb10u3 zip=3.0-11+b1 zlib1g-dev=1:1.2.11.dfsg-1+deb10u2 -y \\\n && rm -r /var/lib/apt/lists/*\n#   Install php extensions (curl, json, mbstring, openssl, posix, phar\n#   are installed already and don't need to be specified here)\nRUN docker-php-ext-install bcmath \\\n && docker-php-ext-configure gd --with-jpeg-dir=/usr/include/ --with-png-dir=/usr/include/ \\\n && docker-php-ext-install gd \\\n && docker-php-ext-install gettext \\\n && docker-php-ext-configure imap --with-kerberos --with-imap-ssl \\\n && docker-php-ext-install imap \\\n && docker-php-ext-install intl \\\n && docker-php-ext-install mcrypt \\\n && docker-php-ext-install mysqli \\\n && docker-php-ext-install opcache \\\n && docker-php-ext-install pdo_mysql \\\n && docker-php-ext-install soap \\\n && docker-php-ext-install zip\n#   Install and enable imagick PECL extensions\nRUN pecl install imagick \\\n && docker-php-ext-enable imagick\n#   Install xdebug PECL extension\nRUN pecl install xdebug\nRUN a2enmod rewrite\nRUN a2enmod headers\nARG BUILDKIT_UID=1000\nARG BUILDKIT_GID=$BUILDKIT_UID\nRUN addgroup --gid=$BUILDKIT_GID buildkit\nRUN useradd --home-dir /buildkit --create-home --uid $BUILDKIT_UID --gid $BUILDKIT_GID buildkit\nCOPY sudo /etc/sudoers.d/buildkit\nUSER buildkit\nWORKDIR /buildkit\nENV PATH=\"/buildkit/bin:${PATH}\"\nRUN git clone https://github.com/civicrm/civicrm-buildkit.git buildkit-tmp\nRUN mv buildkit-tmp/* buildkit-tmp/.git* .\nRUN rmdir buildkit-tmp\n#   Need to create this before we configure apache, otherwise it will complain\nRUN mkdir -p .amp/apache.d\nRUN mkdir -p .cache/bower\nRUN mkdir .composer\nRUN mkdir .drush\nRUN mkdir .npm\nRUN civi-download-tools\nRUN civibuild cache-warmup\nCOPY --chown=buildkit:buildkit amp.services.yml /buildkit/.amp/services.yml\nCOPY buildkit.ini /usr/local/etc/php/conf.d/buildkit.ini\nCOPY msmtprc /etc/msmtprc\nCOPY apache.conf /etc/apache2/conf-enabled/buildkit.conf\nRUN rm /buildkit/app/civicrm.settings.d/100-mail.php\nCOPY civibuild.conf /buildkit/app/civibuild.conf\nCOPY apache24-vhost.php /buildkit/build/.amp/apache24-vhost.php\nUSER root\nCOPY ./docker-civicrm-entrypoint /usr/local/bin\nENTRYPOINT [\"docker-civicrm-entrypoint\"]\nCMD [\"apache2-foreground\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n","originalDockerfile":"FROM php:7.1-apache\n#  Install apt packages\n#\n#  Required for php extensions\n#  * gd: libpng-dev\n#  * imagick: libmagickwand-dev\n#  * imap: libc-client-dev, libkrb5-dev\n#  * intl: libicu-dev\n#  * mcrypt: libmcrypt-dev\n#  * soap: libxml2-dev\n#  * zip: zlib1g-dev\n#\n#  Used in the build process\n#  * git\n#  * mysql-client\n#  * sudo\n#  * unzip\n#  * zip\n#  * node 9.x (from nodesource repository)\n#\n#  iproute2 is required to get host ip from container\nRUN curl -sL https://deb.nodesource.com/setup_9.x | bash \\\n && apt-get update \\\n && apt-get install --no-install-recommends git iproute2 libc-client-dev libicu-dev libjpeg62-turbo-dev libkrb5-dev libmagickwand-dev libmcrypt-dev libpng-dev libxml2-dev msmtp-mta mysql-client nodejs sudo unzip zip zlib1g-dev -y \\\n && rm -r /var/lib/apt/lists/*\n#  Install php extensions (curl, json, mbstring, openssl, posix, phar\n#  are installed already and don't need to be specified here)\nRUN docker-php-ext-install bcmath \\\n && docker-php-ext-configure gd --with-jpeg-dir=/usr/include/ --with-png-dir=/usr/include/ \\\n && docker-php-ext-install gd \\\n && docker-php-ext-install gettext \\\n && docker-php-ext-configure imap --with-kerberos --with-imap-ssl \\\n && docker-php-ext-install imap \\\n && docker-php-ext-install intl \\\n && docker-php-ext-install mcrypt \\\n && docker-php-ext-install mysqli \\\n && docker-php-ext-install opcache \\\n && docker-php-ext-install pdo_mysql \\\n && docker-php-ext-install soap \\\n && docker-php-ext-install zip\n#  Install and enable imagick PECL extensions\nRUN pecl install imagick \\\n && docker-php-ext-enable imagick\n#  Install xdebug PECL extension\nRUN pecl install xdebug\nRUN a2enmod rewrite\nRUN a2enmod headers\nARG BUILDKIT_UID=1000\nARG BUILDKIT_GID=$BUILDKIT_UID\nRUN addgroup --gid=$BUILDKIT_GID buildkit\nRUN useradd --home-dir /buildkit --create-home --uid $BUILDKIT_UID --gid $BUILDKIT_GID buildkit\nCOPY sudo /etc/sudoers.d/buildkit\nUSER buildkit\nWORKDIR /buildkit\nENV PATH=\"/buildkit/bin:${PATH}\"\nRUN git clone https://github.com/civicrm/civicrm-buildkit.git buildkit-tmp\nRUN mv buildkit-tmp/* buildkit-tmp/.git* .\nRUN rmdir buildkit-tmp\n#  Need to create this before we configure apache, otherwise it will complain\nRUN mkdir -p .amp/apache.d\nRUN mkdir -p .cache/bower\nRUN mkdir .composer\nRUN mkdir .drush\nRUN mkdir .npm\nRUN civi-download-tools\nRUN civibuild cache-warmup\nCOPY --chown=buildkit:buildkit amp.services.yml /buildkit/.amp/services.yml\nCOPY buildkit.ini /usr/local/etc/php/conf.d/buildkit.ini\nCOPY msmtprc /etc/msmtprc\nCOPY apache.conf /etc/apache2/conf-enabled/buildkit.conf\nRUN rm /buildkit/app/civicrm.settings.d/100-mail.php\nCOPY civibuild.conf /buildkit/app/civibuild.conf\nCOPY apache24-vhost.php /buildkit/build/.amp/apache24-vhost.php\nUSER root\nCOPY ./docker-civicrm-entrypoint /usr/local/bin\nENTRYPOINT [\"docker-civicrm-entrypoint\"]\nCMD [\"apache2-foreground\"]\n","injectedSmells":[],"originalDockerfileHash":"991b3b4b1c6a62f1c3844c976bb292b6","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM php:7.1-apache\n#   Install apt packages\n#\n#   Required for php extensions\n#   * gd: libpng-dev\n#   * imagick: libmagickwand-dev\n#   * imap: libc-client-dev, libkrb5-dev\n#   * intl: libicu-dev\n#   * mcrypt: libmcrypt-dev\n#   * soap: libxml2-dev\n#   * zip: zlib1g-dev\n#\n#   Used in the build process\n#   * git\n#   * mysql-client\n#   * sudo\n#   * unzip\n#   * zip\n#   * node 9.x (from nodesource repository)\n#\n#   iproute2 is required to get host ip from container\nRUN curl -sL https://deb.nodesource.com/setup_9.x | bash \\\n && apt-get update \\\n && apt-get install --no-install-recommends git iproute2 libc-client-dev libicu-dev libjpeg62-turbo-dev libkrb5-dev libmagickwand-dev libmcrypt-dev libpng-dev libxml2-dev msmtp-mta mysql-client nodejs sudo unzip zip zlib1g-dev -y \\\n && rm -r /var/lib/apt/lists/*\n#   Install php extensions (curl, json, mbstring, openssl, posix, phar\n#   are installed already and don't need to be specified here)\nRUN docker-php-ext-install bcmath \\\n && docker-php-ext-configure gd --with-jpeg-dir=/usr/include/ --with-png-dir=/usr/include/ \\\n && docker-php-ext-install gd \\\n && docker-php-ext-install gettext \\\n && docker-php-ext-configure imap --with-kerberos --with-imap-ssl \\\n && docker-php-ext-install imap \\\n && docker-php-ext-install intl \\\n && docker-php-ext-install mcrypt \\\n && docker-php-ext-install mysqli \\\n && docker-php-ext-install opcache \\\n && docker-php-ext-install pdo_mysql \\\n && docker-php-ext-install soap \\\n && docker-php-ext-install zip\n#   Install and enable imagick PECL extensions\nRUN pecl install imagick \\\n && docker-php-ext-enable imagick\n#   Install xdebug PECL extension\nRUN pecl install xdebug\nRUN a2enmod rewrite\nRUN a2enmod headers\nARG BUILDKIT_UID=1000\nARG BUILDKIT_GID=$BUILDKIT_UID\nRUN addgroup --gid=$BUILDKIT_GID buildkit\nRUN useradd --home-dir /buildkit --create-home --uid $BUILDKIT_UID --gid $BUILDKIT_GID buildkit\nCOPY sudo /etc/sudoers.d/buildkit\nUSER buildkit\nWORKDIR /buildkit\nENV PATH=\"/buildkit/bin:${PATH}\"\nRUN git clone https://github.com/civicrm/civicrm-buildkit.git buildkit-tmp\nRUN mv buildkit-tmp/* buildkit-tmp/.git* .\nRUN rmdir buildkit-tmp\n#   Need to create this before we configure apache, otherwise it will complain\nRUN mkdir -p .amp/apache.d\nRUN mkdir -p .cache/bower\nRUN mkdir .composer\nRUN mkdir .drush\nRUN mkdir .npm\nRUN civi-download-tools\nRUN civibuild cache-warmup\nCOPY --chown=buildkit:buildkit amp.services.yml /buildkit/.amp/services.yml\nCOPY buildkit.ini /usr/local/etc/php/conf.d/buildkit.ini\nCOPY msmtprc /etc/msmtprc\nCOPY apache.conf /etc/apache2/conf-enabled/buildkit.conf\nRUN rm /buildkit/app/civicrm.settings.d/100-mail.php\nCOPY civibuild.conf /buildkit/app/civibuild.conf\nCOPY apache24-vhost.php /buildkit/build/.amp/apache24-vhost.php\nUSER root\nCOPY ./docker-civicrm-entrypoint /usr/local/bin\nENTRYPOINT [\"docker-civicrm-entrypoint\"]\nCMD [\"apache2-foreground\"]\n","originalDockerfileUglifiedHash":"3cc0abd1d0a479d9f682adf8682a51db","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/f1cd4173ef2ee2a61d58d105aa12c7e967bdac80.dockerfile"}