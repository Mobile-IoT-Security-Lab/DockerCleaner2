{"seed":248762998,"processedDockerfileHash":"71737c6bbb0f63e013cf323799313be7","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["have-a-healthcheck","have-a-user"],"processedDockerfile":"#  ##############################################################################\n#\n#  IMAGE:   Redmine\n#  VERSION: 4.0.3\n#\n#  ##############################################################################\nFROM ruby:2.6-slim-stretch\n#  ##############################################################################\n#  MAINTAINER\n#  ##############################################################################\nMAINTAINER LiuMiao <liumiaocn@outlook.com>\nRUN groupadd -r redmine \\\n && useradd -r -g redmine redmine\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends ca-certificates wget unzip bzr git mercurial openssh-client subversion gsfonts imagemagick -y ; rm -rf /var/lib/apt/lists/*\nRUN set -eux ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends dirmngr gnupg -y ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; export GOSU_VERSION='1.11' ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; chmod +x /usr/local/bin/gosu ; gosu nobody true ; export TINI_VERSION='0.18.0' ; wget -O /usr/local/bin/tini \"https://github.com/krallin/tini/releases/download/v$TINI_VERSION/tini-$dpkgArch\" ; wget -O /usr/local/bin/tini.asc \"https://github.com/krallin/tini/releases/download/v$TINI_VERSION/tini-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 6380DC428747F6C393FEACA59A84159D7001A4E5 ; gpg --batch --verify /usr/local/bin/tini.asc /usr/local/bin/tini ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" /usr/local/bin/tini.asc ; chmod +x /usr/local/bin/tini ; tini -h ; apt-mark auto '.*' > /dev/null; [ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false\nENV RAILS_ENV=\"production\"\nWORKDIR /usr/src/redmine\n#   https://github.com/docker-library/redmine/issues/138#issuecomment-438834176\n#   (bundler needs this for running as an arbitrary user)\nENV HOME=\"/home/redmine\"\nRUN set -eux ; [ ! -d \"$HOME\" ] ; mkdir -p \"$HOME\" ; chown redmine:redmine \"$HOME\" ; chmod 1777 \"$HOME\"\nENV REDMINE_VERSION=\"4.0.0\"\nENV REDMINE_DOWNLOAD_MD5=\"619675f04df3c960e334377e485581ca\"\nRUN wget -O redmine.tar.gz \"https://www.redmine.org/releases/redmine-${REDMINE_VERSION}.tar.gz\" \\\n && echo \"$REDMINE_DOWNLOAD_MD5 redmine.tar.gz\" | md5sum -c - \\\n && tar -xvf redmine.tar.gz --strip-components=1 \\\n && rm redmine.tar.gz files/delete.me log/delete.me \\\n && mkdir -p log public/plugin_assets sqlite tmp/pdf tmp/pids \\\n && chown -R redmine:redmine ./ \\\n && echo 'config.logger = Logger.new(STDOUT)' > config/additional_environment.rb \\\n && chmod -R ugo=rwX config db sqlite \\\n && find log tmp -type d -exec chmod 1777 '{}' +\nRUN set -eux ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends dpkg-dev gcc libmagickcore-dev libmagickwand-dev libmariadbclient-dev libpq-dev libsqlite3-dev make patch libssl1.0-dev -y ; rm -rf /var/lib/apt/lists/* ; wget -O freetds.tar.bz2 'http://www.freetds.org/files/stable/freetds-1.00.91.tar.bz2' ; echo '8d71f9f29be0fe0637e443dd3807b3fd *freetds.tar.bz2' | md5sum -c - ; mkdir freetds ; tar -xf freetds.tar.bz2 -C freetds --strip-components=1 ; rm freetds.tar.bz2 ; (cd freetds \\\n && gnuArch=\"$( dpkg-architecture --query DEB_BUILD_GNU_TYPE ;)\" \\\n && ./configure --build=\"$gnuArch\" --enable-silent-rules \\\n && make -j \"$( nproc ;)\" \\\n && make -C src install \\\n && make -C include install ) ; rm -rf freetds ; gosu redmine bundle config build.tiny_tds --enable-system-freetds ; gosu redmine bundle install --without development test ; for adapter in mysql2 postgresql sqlserver sqlite3; do echo \"$RAILS_ENV:\" > ./config/database.yml;echo \" adapter: $adapter\" >> ./config/database.yml;gosu redmine bundle install --without development test ;cp Gemfile.lock \"Gemfile.lock.${adapter}\" ; done ; rm ./config/database.yml ; chmod -R ugo=rwX Gemfile.lock \"$GEM_HOME\" ; rm -rf ~redmine/.bundle ; apt-mark auto '.*' > /dev/null; [ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark ; find /usr/local -type f -executable -exec ldd '{}' ';' | awk '/=>/ { print $(NF-1) }' | sort -u | grep -v '^/usr/local/' | xargs -r dpkg-query --search | cut -d: -f1 | sort -u | xargs -r apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false\nCOPY themes.tar.gz /usr/src/redmine/public/\n#   install thems\nRUN cd /usr/src/redmine/public/themes \\\n && wget https://github.com/mrliptontea/PurpleMine2/archive/v2.5.0.zip \\\n && wget https://github.com/akabekobeko/redmine-theme-minimalflat2/archive/v1.6.0.zip \\\n && unzip v2.5.0.zip \\\n && unzip v1.6.0.zip \\\n && rm v1.6.0.zip v2.5.0.zip \\\n && cd /usr/src/redmine/public/themes/PurpleMine2-2.5.0/stylesheets \\\n && sed -i s/36266b/438972/g *.css \\\n && sed -i s/614ba6/11aa87/g *.css \\\n && cd /usr/src/redmine/public/ \\\n && tar xvpf themes.tar.gz \\\n && rm themes.tar.gz\nVOLUME /usr/src/redmine/files\nCOPY docker-entrypoint.sh /\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nEXPOSE 3000/tcp\nCMD [\"rails\", \"server\", \"-b\", \"0.0.0.0\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# ##############################################################################\n#\n# IMAGE:   Redmine\n# VERSION: 4.0.3\n#\n# ##############################################################################\nFROM ruby:2.6-slim-stretch\n# ##############################################################################\n# MAINTAINER\n# ##############################################################################\nMAINTAINER LiuMiao <liumiaocn@outlook.com>\nRUN groupadd -r redmine \\\n && useradd -r -g redmine redmine\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends ca-certificates wget unzip bzr git mercurial openssh-client subversion gsfonts imagemagick -y ; rm -rf /var/lib/apt/lists/*\nRUN set -eux ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends dirmngr gnupg -y ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; export GOSU_VERSION='1.11' ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; chmod +x /usr/local/bin/gosu ; gosu nobody true ; export TINI_VERSION='0.18.0' ; wget -O /usr/local/bin/tini \"https://github.com/krallin/tini/releases/download/v$TINI_VERSION/tini-$dpkgArch\" ; wget -O /usr/local/bin/tini.asc \"https://github.com/krallin/tini/releases/download/v$TINI_VERSION/tini-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 6380DC428747F6C393FEACA59A84159D7001A4E5 ; gpg --batch --verify /usr/local/bin/tini.asc /usr/local/bin/tini ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" /usr/local/bin/tini.asc ; chmod +x /usr/local/bin/tini ; tini -h ; apt-mark auto '.*' > /dev/null; [ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false\nENV RAILS_ENV=\"production\"\nWORKDIR /usr/src/redmine\n#  https://github.com/docker-library/redmine/issues/138#issuecomment-438834176\n#  (bundler needs this for running as an arbitrary user)\nENV HOME=\"/home/redmine\"\nRUN set -eux ; [ ! -d \"$HOME\" ] ; mkdir -p \"$HOME\" ; chown redmine:redmine \"$HOME\" ; chmod 1777 \"$HOME\"\nENV REDMINE_VERSION=\"4.0.0\"\nENV REDMINE_DOWNLOAD_MD5=\"619675f04df3c960e334377e485581ca\"\nRUN wget -O redmine.tar.gz \"https://www.redmine.org/releases/redmine-${REDMINE_VERSION}.tar.gz\" \\\n && echo \"$REDMINE_DOWNLOAD_MD5 redmine.tar.gz\" | md5sum -c - \\\n && tar -xvf redmine.tar.gz --strip-components=1 \\\n && rm redmine.tar.gz files/delete.me log/delete.me \\\n && mkdir -p log public/plugin_assets sqlite tmp/pdf tmp/pids \\\n && chown -R redmine:redmine ./ \\\n && echo 'config.logger = Logger.new(STDOUT)' > config/additional_environment.rb \\\n && chmod -R ugo=rwX config db sqlite \\\n && find log tmp -type d -exec chmod 1777 '{}' +\nRUN set -eux ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends dpkg-dev gcc libmagickcore-dev libmagickwand-dev libmariadbclient-dev libpq-dev libsqlite3-dev make patch libssl1.0-dev -y ; rm -rf /var/lib/apt/lists/* ; wget -O freetds.tar.bz2 'http://www.freetds.org/files/stable/freetds-1.00.91.tar.bz2' ; echo '8d71f9f29be0fe0637e443dd3807b3fd *freetds.tar.bz2' | md5sum -c - ; mkdir freetds ; tar -xf freetds.tar.bz2 -C freetds --strip-components=1 ; rm freetds.tar.bz2 ; (cd freetds \\\n && gnuArch=\"$( dpkg-architecture --query DEB_BUILD_GNU_TYPE ;)\" \\\n && ./configure --build=\"$gnuArch\" --enable-silent-rules \\\n && make -j \"$( nproc ;)\" \\\n && make -C src install \\\n && make -C include install ) ; rm -rf freetds ; gosu redmine bundle config build.tiny_tds --enable-system-freetds ; gosu redmine bundle install --without development test ; for adapter in mysql2 postgresql sqlserver sqlite3; do echo \"$RAILS_ENV:\" > ./config/database.yml;echo \" adapter: $adapter\" >> ./config/database.yml;gosu redmine bundle install --without development test ;cp Gemfile.lock \"Gemfile.lock.${adapter}\" ; done ; rm ./config/database.yml ; chmod -R ugo=rwX Gemfile.lock \"$GEM_HOME\" ; rm -rf ~redmine/.bundle ; apt-mark auto '.*' > /dev/null; [ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark ; find /usr/local -type f -executable -exec ldd '{}' ';' | awk '/=>/ { print $(NF-1) }' | sort -u | grep -v '^/usr/local/' | xargs -r dpkg-query --search | cut -d: -f1 | sort -u | xargs -r apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false\nCOPY themes.tar.gz /usr/src/redmine/public/\n#  install thems\nRUN cd /usr/src/redmine/public/themes \\\n && wget https://github.com/mrliptontea/PurpleMine2/archive/v2.5.0.zip \\\n && wget https://github.com/akabekobeko/redmine-theme-minimalflat2/archive/v1.6.0.zip \\\n && unzip v2.5.0.zip \\\n && unzip v1.6.0.zip \\\n && rm v1.6.0.zip v2.5.0.zip \\\n && cd /usr/src/redmine/public/themes/PurpleMine2-2.5.0/stylesheets \\\n && sed -i s/36266b/438972/g *.css \\\n && sed -i s/614ba6/11aa87/g *.css \\\n && cd /usr/src/redmine/public/ \\\n && tar xvpf themes.tar.gz \\\n && rm themes.tar.gz\nVOLUME /usr/src/redmine/files\nCOPY docker-entrypoint.sh /\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nEXPOSE 3000/tcp\nCMD [\"rails\", \"server\", \"-b\", \"0.0.0.0\"]\n","injectedSmells":[],"originalDockerfileHash":"3f190c0a01602be31a66a0010ed3d276","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  ##############################################################################\n#\n#  IMAGE:   Redmine\n#  VERSION: 4.0.3\n#\n#  ##############################################################################\nFROM ruby:2.6-slim-stretch\n#  ##############################################################################\n#  MAINTAINER\n#  ##############################################################################\nMAINTAINER LiuMiao <liumiaocn@outlook.com>\nRUN groupadd -r redmine \\\n && useradd -r -g redmine redmine\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends ca-certificates wget unzip bzr git mercurial openssh-client subversion gsfonts imagemagick -y ; rm -rf /var/lib/apt/lists/*\nRUN set -eux ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends dirmngr gnupg -y ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; export GOSU_VERSION='1.11' ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; chmod +x /usr/local/bin/gosu ; gosu nobody true ; export TINI_VERSION='0.18.0' ; wget -O /usr/local/bin/tini \"https://github.com/krallin/tini/releases/download/v$TINI_VERSION/tini-$dpkgArch\" ; wget -O /usr/local/bin/tini.asc \"https://github.com/krallin/tini/releases/download/v$TINI_VERSION/tini-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 6380DC428747F6C393FEACA59A84159D7001A4E5 ; gpg --batch --verify /usr/local/bin/tini.asc /usr/local/bin/tini ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" /usr/local/bin/tini.asc ; chmod +x /usr/local/bin/tini ; tini -h ; apt-mark auto '.*' > /dev/null; [ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false\nENV RAILS_ENV=\"production\"\nWORKDIR /usr/src/redmine\n#   https://github.com/docker-library/redmine/issues/138#issuecomment-438834176\n#   (bundler needs this for running as an arbitrary user)\nENV HOME=\"/home/redmine\"\nRUN set -eux ; [ ! -d \"$HOME\" ] ; mkdir -p \"$HOME\" ; chown redmine:redmine \"$HOME\" ; chmod 1777 \"$HOME\"\nENV REDMINE_VERSION=\"4.0.0\"\nENV REDMINE_DOWNLOAD_MD5=\"619675f04df3c960e334377e485581ca\"\nRUN wget -O redmine.tar.gz \"https://www.redmine.org/releases/redmine-${REDMINE_VERSION}.tar.gz\" \\\n && echo \"$REDMINE_DOWNLOAD_MD5 redmine.tar.gz\" | md5sum -c - \\\n && tar -xvf redmine.tar.gz --strip-components=1 \\\n && rm redmine.tar.gz files/delete.me log/delete.me \\\n && mkdir -p log public/plugin_assets sqlite tmp/pdf tmp/pids \\\n && chown -R redmine:redmine ./ \\\n && echo 'config.logger = Logger.new(STDOUT)' > config/additional_environment.rb \\\n && chmod -R ugo=rwX config db sqlite \\\n && find log tmp -type d -exec chmod 1777 '{}' +\nRUN set -eux ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends dpkg-dev gcc libmagickcore-dev libmagickwand-dev libmariadbclient-dev libpq-dev libsqlite3-dev make patch libssl1.0-dev -y ; rm -rf /var/lib/apt/lists/* ; wget -O freetds.tar.bz2 'http://www.freetds.org/files/stable/freetds-1.00.91.tar.bz2' ; echo '8d71f9f29be0fe0637e443dd3807b3fd *freetds.tar.bz2' | md5sum -c - ; mkdir freetds ; tar -xf freetds.tar.bz2 -C freetds --strip-components=1 ; rm freetds.tar.bz2 ; (cd freetds \\\n && gnuArch=\"$( dpkg-architecture --query DEB_BUILD_GNU_TYPE ;)\" \\\n && ./configure --build=\"$gnuArch\" --enable-silent-rules \\\n && make -j \"$( nproc ;)\" \\\n && make -C src install \\\n && make -C include install ) ; rm -rf freetds ; gosu redmine bundle config build.tiny_tds --enable-system-freetds ; gosu redmine bundle install --without development test ; for adapter in mysql2 postgresql sqlserver sqlite3; do echo \"$RAILS_ENV:\" > ./config/database.yml;echo \" adapter: $adapter\" >> ./config/database.yml;gosu redmine bundle install --without development test ;cp Gemfile.lock \"Gemfile.lock.${adapter}\" ; done ; rm ./config/database.yml ; chmod -R ugo=rwX Gemfile.lock \"$GEM_HOME\" ; rm -rf ~redmine/.bundle ; apt-mark auto '.*' > /dev/null; [ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark ; find /usr/local -type f -executable -exec ldd '{}' ';' | awk '/=>/ { print $(NF-1) }' | sort -u | grep -v '^/usr/local/' | xargs -r dpkg-query --search | cut -d: -f1 | sort -u | xargs -r apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false\nCOPY themes.tar.gz /usr/src/redmine/public/\n#   install thems\nRUN cd /usr/src/redmine/public/themes \\\n && wget https://github.com/mrliptontea/PurpleMine2/archive/v2.5.0.zip \\\n && wget https://github.com/akabekobeko/redmine-theme-minimalflat2/archive/v1.6.0.zip \\\n && unzip v2.5.0.zip \\\n && unzip v1.6.0.zip \\\n && rm v1.6.0.zip v2.5.0.zip \\\n && cd /usr/src/redmine/public/themes/PurpleMine2-2.5.0/stylesheets \\\n && sed -i s/36266b/438972/g *.css \\\n && sed -i s/614ba6/11aa87/g *.css \\\n && cd /usr/src/redmine/public/ \\\n && tar xvpf themes.tar.gz \\\n && rm themes.tar.gz\nVOLUME /usr/src/redmine/files\nCOPY docker-entrypoint.sh /\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nEXPOSE 3000/tcp\nCMD [\"rails\", \"server\", \"-b\", \"0.0.0.0\"]\n","originalDockerfileUglifiedHash":"79656ef53877290324357950317e09f1","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/77c6c01e28f4270b86bed75cd041184f6b6afbf5.dockerfile"}