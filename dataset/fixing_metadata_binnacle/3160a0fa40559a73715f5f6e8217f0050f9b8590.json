{"seed":2182157704,"processedDockerfileHash":"61f5569610b876743bbff19a6fa242eb","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apt-get","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM python:2-slim\nRUN groupadd -r snuba \\\n && useradd -r -g snuba snuba\nRUN mkdir -p /usr/src/snuba\nWORKDIR /usr/src/snuba\nENV PIP_DISABLE_PIP_VERSION_CHECK=\"on\" \\\n    PYTHONDONTWRITEBYTECODE=\"1\"\n#   these are required all the way through, and removing them will cause bad things\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends libexpat1=2.2.6-2+deb10u6 libffi6=3.2.1-9 liblz4-1=1.8.3-1+deb10u1 libpcre3=2:8.39-12 -y ; rm -rf /var/lib/apt/lists/*\n#   grab gosu for easy step-down from root\nENV GOSU_VERSION=\"1.11\"\nRUN set -ex ; LIBRDKAFKA_VERSION=0.11.5 ; buildDeps=' bzip2 dirmngr git g++ gcc libc6-dev liblz4-dev libpcre3-dev gnupg make wget ' ; apt-get update ; apt-get install --no-install-recommends libexpat1=2.2.6-2+deb10u6 libffi6=3.2.1-9 liblz4-1=1.8.3-1+deb10u1 libpcre3=2:8.39-12 $buildDeps -y ; rm -rf /var/lib/apt/lists/* ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;)\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;).asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for key in B42F6819007F00F88E364FD4036A9C25BF357DD4; do gpg --batch --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys \"$key\" || gpg --batch --keyserver hkp://ipv4.pool.sks-keyservers.net --recv-keys \"$key\" || gpg --batch --keyserver hkp://pgp.mit.edu:80 --recv-keys \"$key\" ; done ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; chmod +x /usr/local/bin/gosu ; gosu nobody true ; mkdir -p /usr/src/librdkafka ; cd /usr/src/librdkafka ; wget -O v${LIBRDKAFKA_VERSION}.tar.gz https://github.com/edenhill/librdkafka/archive/v${LIBRDKAFKA_VERSION}.tar.gz ; tar xf v${LIBRDKAFKA_VERSION}.tar.gz --strip-components=1 ; ./configure --prefix=/usr ; make ; PREFIX=/usr make install ; rm -r /usr/src/librdkafka ; cd ; wget https://bitbucket.org/pypy/pypy/downloads/pypy2-v6.0.0-linux64.tar.bz2 ; [ \"$( sha256sum pypy2-v6.0.0-linux64.tar.bz2 ;)\" = '6cbf942ba7c90f504d8d6a2e45d4244e3bf146c8722d64e9410b85eac6b5af67 pypy2-v6.0.0-linux64.tar.bz2' ] ; tar xf pypy2-v6.0.0-linux64.tar.bz2 ; rm -rf pypy2-v6.0.0-linux64.tar.bz2 ; mv pypy2-v6.0.0-linux64 /pypy ; wget http://security.debian.org/debian-security/pool/updates/main/o/openssl/libssl1.0.0_1.0.1t-1+deb8u11_amd64.deb ; DEBIAN_FRONTEND=noninteractive dpkg -i libssl1.0.0_1.0.1t-1+deb8u11_amd64.deb ; rm -rf libssl1.0.0_1.0.1t-1+deb8u11_amd64.deb ; wget https://bootstrap.pypa.io/get-pip.py ; /pypy/bin/pypy get-pip.py ; rm -rf get-pip.py ; apt-get purge -y --auto-remove $buildDeps\nCOPY snuba ./snuba/\nCOPY setup.py Makefile README.md MANIFEST.in ./\nRUN chown -R snuba:snuba /usr/src/snuba/\nRUN set -ex ; buildDeps=' git gcc libc6-dev liblz4-dev libpcre3-dev make ' ; apt-get update ; apt-get install --no-install-recommends $buildDeps -y ; rm -rf /var/lib/apt/lists/* ; make install-python-dependencies ; snuba --help ; PATH=/pypy/bin:$PATH make install-python-dependencies ; /pypy/bin/snuba --help ; rm -rf ~/.cache/pip ; apt-get purge -y --auto-remove $buildDeps\nENV CLICKHOUSE_SERVER=\"clickhouse-server:9000\"\nENV FLASK_DEBUG=\"0\"\nARG SNUBA_VERSION_SHA\nENV SNUBA_RELEASE=\"$SNUBA_VERSION_SHA\"\nEXPOSE 1218/tcp\nCOPY docker_entrypoint.sh ./\nENTRYPOINT [\"./docker_entrypoint.sh\"]\nCMD [\"api\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM python:2-slim\nRUN groupadd -r snuba \\\n && useradd -r -g snuba snuba\nRUN mkdir -p /usr/src/snuba\nWORKDIR /usr/src/snuba\nENV PIP_DISABLE_PIP_VERSION_CHECK=\"on\" \\\n    PYTHONDONTWRITEBYTECODE=\"1\"\n#  these are required all the way through, and removing them will cause bad things\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends libexpat1 libffi6 liblz4-1 libpcre3 -y ; rm -rf /var/lib/apt/lists/*\n#  grab gosu for easy step-down from root\nENV GOSU_VERSION=\"1.11\"\nRUN set -ex ; LIBRDKAFKA_VERSION=0.11.5 ; buildDeps=' bzip2 dirmngr git g++ gcc libc6-dev liblz4-dev libpcre3-dev gnupg make wget ' ; apt-get update ; apt-get install --no-install-recommends libexpat1 libffi6 liblz4-1 libpcre3 $buildDeps -y ; rm -rf /var/lib/apt/lists/* ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;)\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;).asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for key in B42F6819007F00F88E364FD4036A9C25BF357DD4; do gpg --batch --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys \"$key\" || gpg --batch --keyserver hkp://ipv4.pool.sks-keyservers.net --recv-keys \"$key\" || gpg --batch --keyserver hkp://pgp.mit.edu:80 --recv-keys \"$key\" ; done ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; chmod +x /usr/local/bin/gosu ; gosu nobody true ; mkdir -p /usr/src/librdkafka ; cd /usr/src/librdkafka ; wget -O v${LIBRDKAFKA_VERSION}.tar.gz https://github.com/edenhill/librdkafka/archive/v${LIBRDKAFKA_VERSION}.tar.gz ; tar xf v${LIBRDKAFKA_VERSION}.tar.gz --strip-components=1 ; ./configure --prefix=/usr ; make ; PREFIX=/usr make install ; rm -r /usr/src/librdkafka ; cd ; wget https://bitbucket.org/pypy/pypy/downloads/pypy2-v6.0.0-linux64.tar.bz2 ; [ \"$( sha256sum pypy2-v6.0.0-linux64.tar.bz2 ;)\" = '6cbf942ba7c90f504d8d6a2e45d4244e3bf146c8722d64e9410b85eac6b5af67 pypy2-v6.0.0-linux64.tar.bz2' ] ; tar xf pypy2-v6.0.0-linux64.tar.bz2 ; rm -rf pypy2-v6.0.0-linux64.tar.bz2 ; mv pypy2-v6.0.0-linux64 /pypy ; wget http://security.debian.org/debian-security/pool/updates/main/o/openssl/libssl1.0.0_1.0.1t-1+deb8u11_amd64.deb ; DEBIAN_FRONTEND=noninteractive dpkg -i libssl1.0.0_1.0.1t-1+deb8u11_amd64.deb ; rm -rf libssl1.0.0_1.0.1t-1+deb8u11_amd64.deb ; wget https://bootstrap.pypa.io/get-pip.py ; /pypy/bin/pypy get-pip.py ; rm -rf get-pip.py ; apt-get purge -y --auto-remove $buildDeps\nCOPY snuba ./snuba/\nCOPY setup.py Makefile README.md MANIFEST.in ./\nRUN chown -R snuba:snuba /usr/src/snuba/\nRUN set -ex ; buildDeps=' git gcc libc6-dev liblz4-dev libpcre3-dev make ' ; apt-get update ; apt-get install --no-install-recommends $buildDeps -y ; rm -rf /var/lib/apt/lists/* ; make install-python-dependencies ; snuba --help ; PATH=/pypy/bin:$PATH make install-python-dependencies ; /pypy/bin/snuba --help ; rm -rf ~/.cache/pip ; apt-get purge -y --auto-remove $buildDeps\nENV CLICKHOUSE_SERVER=\"clickhouse-server:9000\"\nENV FLASK_DEBUG=\"0\"\nARG SNUBA_VERSION_SHA\nENV SNUBA_RELEASE=\"$SNUBA_VERSION_SHA\"\nEXPOSE 1218/tcp\nCOPY docker_entrypoint.sh ./\nENTRYPOINT [\"./docker_entrypoint.sh\"]\nCMD [\"api\"]\n","injectedSmells":[],"originalDockerfileHash":"3cdc1953134179f10d9830ff82111588","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM python:2-slim\nRUN groupadd -r snuba \\\n && useradd -r -g snuba snuba\nRUN mkdir -p /usr/src/snuba\nWORKDIR /usr/src/snuba\nENV PIP_DISABLE_PIP_VERSION_CHECK=\"on\" \\\n    PYTHONDONTWRITEBYTECODE=\"1\"\n#   these are required all the way through, and removing them will cause bad things\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends libexpat1 libffi6 liblz4-1 libpcre3 -y ; rm -rf /var/lib/apt/lists/*\n#   grab gosu for easy step-down from root\nENV GOSU_VERSION=\"1.11\"\nRUN set -ex ; LIBRDKAFKA_VERSION=0.11.5 ; buildDeps=' bzip2 dirmngr git g++ gcc libc6-dev liblz4-dev libpcre3-dev gnupg make wget ' ; apt-get update ; apt-get install --no-install-recommends libexpat1 libffi6 liblz4-1 libpcre3 $buildDeps -y ; rm -rf /var/lib/apt/lists/* ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;)\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;).asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for key in B42F6819007F00F88E364FD4036A9C25BF357DD4; do gpg --batch --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys \"$key\" || gpg --batch --keyserver hkp://ipv4.pool.sks-keyservers.net --recv-keys \"$key\" || gpg --batch --keyserver hkp://pgp.mit.edu:80 --recv-keys \"$key\" ; done ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; chmod +x /usr/local/bin/gosu ; gosu nobody true ; mkdir -p /usr/src/librdkafka ; cd /usr/src/librdkafka ; wget -O v${LIBRDKAFKA_VERSION}.tar.gz https://github.com/edenhill/librdkafka/archive/v${LIBRDKAFKA_VERSION}.tar.gz ; tar xf v${LIBRDKAFKA_VERSION}.tar.gz --strip-components=1 ; ./configure --prefix=/usr ; make ; PREFIX=/usr make install ; rm -r /usr/src/librdkafka ; cd ; wget https://bitbucket.org/pypy/pypy/downloads/pypy2-v6.0.0-linux64.tar.bz2 ; [ \"$( sha256sum pypy2-v6.0.0-linux64.tar.bz2 ;)\" = '6cbf942ba7c90f504d8d6a2e45d4244e3bf146c8722d64e9410b85eac6b5af67 pypy2-v6.0.0-linux64.tar.bz2' ] ; tar xf pypy2-v6.0.0-linux64.tar.bz2 ; rm -rf pypy2-v6.0.0-linux64.tar.bz2 ; mv pypy2-v6.0.0-linux64 /pypy ; wget http://security.debian.org/debian-security/pool/updates/main/o/openssl/libssl1.0.0_1.0.1t-1+deb8u11_amd64.deb ; DEBIAN_FRONTEND=noninteractive dpkg -i libssl1.0.0_1.0.1t-1+deb8u11_amd64.deb ; rm -rf libssl1.0.0_1.0.1t-1+deb8u11_amd64.deb ; wget https://bootstrap.pypa.io/get-pip.py ; /pypy/bin/pypy get-pip.py ; rm -rf get-pip.py ; apt-get purge -y --auto-remove $buildDeps\nCOPY snuba ./snuba/\nCOPY setup.py Makefile README.md MANIFEST.in ./\nRUN chown -R snuba:snuba /usr/src/snuba/\nRUN set -ex ; buildDeps=' git gcc libc6-dev liblz4-dev libpcre3-dev make ' ; apt-get update ; apt-get install --no-install-recommends $buildDeps -y ; rm -rf /var/lib/apt/lists/* ; make install-python-dependencies ; snuba --help ; PATH=/pypy/bin:$PATH make install-python-dependencies ; /pypy/bin/snuba --help ; rm -rf ~/.cache/pip ; apt-get purge -y --auto-remove $buildDeps\nENV CLICKHOUSE_SERVER=\"clickhouse-server:9000\"\nENV FLASK_DEBUG=\"0\"\nARG SNUBA_VERSION_SHA\nENV SNUBA_RELEASE=\"$SNUBA_VERSION_SHA\"\nEXPOSE 1218/tcp\nCOPY docker_entrypoint.sh ./\nENTRYPOINT [\"./docker_entrypoint.sh\"]\nCMD [\"api\"]\n","originalDockerfileUglifiedHash":"de18b0a55e05572e435045d101b81e50","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/3160a0fa40559a73715f5f6e8217f0050f9b8590.dockerfile"}