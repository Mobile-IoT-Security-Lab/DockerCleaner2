{"seed":130348755,"processedDockerfileHash":"4fa575b85be558b5f98ee40c44420fdc","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM alpine:3.9\nLABEL repository.hub=\"alexmasterov/alpine-nginx-tarantool\" \\\n      repository.url=\"https://github.com/AlexMasterov/dockerfiles\" \\\n      maintainer=\"Alex Masterov <alex.masterow@gmail.com>\"\nARG NGINX_VERSION=1.17.0\nARG NGINX_CONFIG=/etc/nginx\nARG LUAJIT_BRANCH=tarantool-1.7\nARG LUAROCKS_TAG=3.1.2\nARG DEVELKIT_MODULE_TAG=v0.3.1rc1\nARG LUA_MODULE_TAG=v0.10.15\nARG TARANTOOL_UPSTREAM_TAG=v2.7.1\nENV LUAJIT_LIB=\"/usr/local/lib\" \\\n    LUAJIT_INC=\"/usr/local/include/luajit-2.1\"\nRUN set -x \\\n && apk add tini=0.18.0-r0 --update \\\n && addgroup -g 82 -S nginx \\\n && adduser -u 82 -S -D -h /var/cache/nginx -s /sbin/nologin -G nginx nginx\nRUN set -x \\\n && apk add cmake=3.13.0-r0 curl=7.64.0-r5 g++=8.3.0-r0 gcc=8.3.0-r0 git=2.20.4-r0 linux-headers=4.18.13-r1 make=4.2.1-r2 openssl-dev=1.1.1k-r0 pcre-dev=8.42-r2 zlib-dev=1.2.11-r1 --virtual .nginx-build-dependencies \\\n && : \"---------- Build flags ----------\" \\\n && export LDFLAGS=\"-Wl,-O2 -Wl,--hash-style=both -pie\" \\\n && export CFLAGS=\"-O2 -march=native -fstack-protector-strong -fpic -fpie\" \\\n && export MAKEFLAGS=\"-j $( expr $( getconf _NPROCESSORS_ONLN ;) + 1 ;)\" \\\n && : \"---------- LuaJIT ----------\" \\\n && apk add libgcc=8.3.0-r0 --virtual .luajit-runtime-dependencies \\\n && git clone -b ${LUAJIT_BRANCH} --depth 1 https://github.com/tarantool/luajit.git /tmp/luajit \\\n && cd /tmp/luajit \\\n && make CFLAGS+=\"-fPIC\" XCFLAGS+=\"-DLUAJIT_ENABLE_GC64\" \\\n && make install \\\n && ln -sf /usr/local/bin/luajit-2.1.0-beta3 /usr/local/bin/lua \\\n && : \"---------- LuaRocks ----------\" \\\n && git clone -b ${LUAROCKS_TAG} --depth 1 https://github.com/luarocks/luarocks.git /tmp/luarocks \\\n && cd /tmp/luarocks \\\n && ./configure --with-lua-bin=/usr/local/bin --with-lua-include=/usr/local/include/luajit-2.1 \\\n && make build \\\n && make install \\\n && : \"---------- Nginx Development Kit ----------\" \\\n && DEVELKIT_MODULE_DIR=\"/tmp/devel-kit\" \\\n && DEVELKIT_MODULE_GIT=\"https://github.com/simpl/ngx_devel_kit.git\" \\\n && git clone -o ${DEVELKIT_MODULE_TAG} --depth 1 ${DEVELKIT_MODULE_GIT} ${DEVELKIT_MODULE_DIR} \\\n && : \"---------- Nginx Lua Module ----------\" \\\n && LUA_MODULE_DIR=\"/tmp/lua-module\" \\\n && LUA_MODULE_GIT=\"https://github.com/openresty/lua-nginx-module.git\" \\\n && git clone -o ${LUA_MODULE_TAG} --depth 1 ${LUA_MODULE_GIT} ${LUA_MODULE_DIR} \\\n && : \"---------- Nginx Tarantool Module ----------\" \\\n && TARANTOOL_UPSTREAM_GIT=\"https://github.com/tarantool/nginx_upstream_module.git\" \\\n && TARANTOOL_UPSTREAM_DIR=\"/tmp/nginx_upstream_module\" \\\n && git clone -o ${TARANTOOL_UPSTREAM_TAG} --depth 1 ${TARANTOOL_UPSTREAM_GIT} ${TARANTOOL_UPSTREAM_DIR} \\\n && git clone --single-branch --depth 1 https://github.com/lloyd/yajl.git /tmp/yajl \\\n && cd /tmp/yajl \\\n && cmake -DCMAKE_BUILD_TYPE=Release . \\\n && make \\\n && make install \\\n && : \"---------- Msgpuck ----------\" \\\n && git clone --depth 1 https://github.com/rtsisyk/msgpuck.git /tmp/msgpuck \\\n && cd /tmp/msgpuck \\\n && cmake -DCMAKE_BUILD_TYPE=Release . \\\n && make \\\n && make install \\\n && : \"---------- Nginx ----------\" \\\n && NGINX_SOURCE=\"https://nginx.org/download/nginx-${NGINX_VERSION}.tar.gz\" \\\n && curl -fSL --connect-timeout 30 ${NGINX_SOURCE} | tar xz -C /tmp \\\n && cd /tmp/nginx-${NGINX_VERSION} \\\n && ./configure --prefix=${NGINX_CONFIG} --conf-path=${NGINX_CONFIG}/nginx.conf --modules-path=/usr/lib/nginx/modules --sbin-path=/usr/sbin/nginx --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --without-http_autoindex_module --without-http_ssi_module --without-mail_imap_module --without-mail_pop3_module --without-mail_smtp_module --with-file-aio --with-http_auth_request_module --with-http_dav_module --with-http_degradation_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_v2_module --with-pcre --with-pcre-jit --with-stream --with-stream_ssl_module --with-threads --with-cc-opt=\"-flto\" --add-module=${DEVELKIT_MODULE_DIR} --add-module=${LUA_MODULE_DIR} \\\n && make \\\n && make install \\\n && runtimeDeps=\"$( scanelf --needed --nobanner --recursive /usr/sbin/nginx /usr/lib/nginx/modules/*.so | awk '{ gsub(/,/, \"\\nso:\", $2); print \"so:\" $2 }' | sort -u | xargs -r apk info --installed | sort -u ;)\" \\\n && apk add ${runtimeDeps} --virtual .nginx-runtime-dependencies \\\n && : \"---------- Removing build dependencies, clean temporary files ----------\" \\\n && apk del .nginx-build-dependencies \\\n && rm -rf /var/cache/apk/* /var/tmp/* /tmp/*\nENTRYPOINT [\"tini\", \"--\"]\nCMD [\"nginx\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM alpine:3.9\nLABEL repository.hub=\"alexmasterov/alpine-nginx-tarantool\" \\\n      repository.url=\"https://github.com/AlexMasterov/dockerfiles\" \\\n      maintainer=\"Alex Masterov <alex.masterow@gmail.com>\"\nARG NGINX_VERSION=1.17.0\nARG NGINX_CONFIG=/etc/nginx\nARG LUAJIT_BRANCH=tarantool-1.7\nARG LUAROCKS_TAG=3.1.2\nARG DEVELKIT_MODULE_TAG=v0.3.1rc1\nARG LUA_MODULE_TAG=v0.10.15\nARG TARANTOOL_UPSTREAM_TAG=v2.7.1\nENV LUAJIT_LIB=\"/usr/local/lib\" \\\n    LUAJIT_INC=\"/usr/local/include/luajit-2.1\"\nRUN set -x \\\n && apk add --update tini \\\n && addgroup -g 82 -S nginx \\\n && adduser -u 82 -S -D -h /var/cache/nginx -s /sbin/nologin -G nginx nginx\nRUN set -x \\\n && apk add --virtual .nginx-build-dependencies cmake curl g++ gcc git linux-headers make openssl-dev pcre-dev zlib-dev \\\n && : \"---------- Build flags ----------\" \\\n && export LDFLAGS=\"-Wl,-O2 -Wl,--hash-style=both -pie\" \\\n && export CFLAGS=\"-O2 -march=native -fstack-protector-strong -fpic -fpie\" \\\n && export MAKEFLAGS=\"-j $( expr $( getconf _NPROCESSORS_ONLN ;) + 1 ;)\" \\\n && : \"---------- LuaJIT ----------\" \\\n && apk add --virtual .luajit-runtime-dependencies libgcc \\\n && git clone -b ${LUAJIT_BRANCH} --depth 1 https://github.com/tarantool/luajit.git /tmp/luajit \\\n && cd /tmp/luajit \\\n && make CFLAGS+=\"-fPIC\" XCFLAGS+=\"-DLUAJIT_ENABLE_GC64\" \\\n && make install \\\n && ln -sf /usr/local/bin/luajit-2.1.0-beta3 /usr/local/bin/lua \\\n && : \"---------- LuaRocks ----------\" \\\n && git clone -b ${LUAROCKS_TAG} --depth 1 https://github.com/luarocks/luarocks.git /tmp/luarocks \\\n && cd /tmp/luarocks \\\n && ./configure --with-lua-bin=/usr/local/bin --with-lua-include=/usr/local/include/luajit-2.1 \\\n && make build \\\n && make install \\\n && : \"---------- Nginx Development Kit ----------\" \\\n && DEVELKIT_MODULE_DIR=\"/tmp/devel-kit\" \\\n && DEVELKIT_MODULE_GIT=\"https://github.com/simpl/ngx_devel_kit.git\" \\\n && git clone -o ${DEVELKIT_MODULE_TAG} --depth 1 ${DEVELKIT_MODULE_GIT} ${DEVELKIT_MODULE_DIR} \\\n && : \"---------- Nginx Lua Module ----------\" \\\n && LUA_MODULE_DIR=\"/tmp/lua-module\" \\\n && LUA_MODULE_GIT=\"https://github.com/openresty/lua-nginx-module.git\" \\\n && git clone -o ${LUA_MODULE_TAG} --depth 1 ${LUA_MODULE_GIT} ${LUA_MODULE_DIR} \\\n && : \"---------- Nginx Tarantool Module ----------\" \\\n && TARANTOOL_UPSTREAM_GIT=\"https://github.com/tarantool/nginx_upstream_module.git\" \\\n && TARANTOOL_UPSTREAM_DIR=\"/tmp/nginx_upstream_module\" \\\n && git clone -o ${TARANTOOL_UPSTREAM_TAG} --depth 1 ${TARANTOOL_UPSTREAM_GIT} ${TARANTOOL_UPSTREAM_DIR} \\\n && git clone --single-branch --depth 1 https://github.com/lloyd/yajl.git /tmp/yajl \\\n && cd /tmp/yajl \\\n && cmake -DCMAKE_BUILD_TYPE=Release . \\\n && make \\\n && make install \\\n && : \"---------- Msgpuck ----------\" \\\n && git clone --depth 1 https://github.com/rtsisyk/msgpuck.git /tmp/msgpuck \\\n && cd /tmp/msgpuck \\\n && cmake -DCMAKE_BUILD_TYPE=Release . \\\n && make \\\n && make install \\\n && : \"---------- Nginx ----------\" \\\n && NGINX_SOURCE=\"https://nginx.org/download/nginx-${NGINX_VERSION}.tar.gz\" \\\n && curl -fSL --connect-timeout 30 ${NGINX_SOURCE} | tar xz -C /tmp \\\n && cd /tmp/nginx-${NGINX_VERSION} \\\n && ./configure --prefix=${NGINX_CONFIG} --conf-path=${NGINX_CONFIG}/nginx.conf --modules-path=/usr/lib/nginx/modules --sbin-path=/usr/sbin/nginx --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --without-http_autoindex_module --without-http_ssi_module --without-mail_imap_module --without-mail_pop3_module --without-mail_smtp_module --with-file-aio --with-http_auth_request_module --with-http_dav_module --with-http_degradation_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_v2_module --with-pcre --with-pcre-jit --with-stream --with-stream_ssl_module --with-threads --with-cc-opt=\"-flto\" --add-module=${DEVELKIT_MODULE_DIR} --add-module=${LUA_MODULE_DIR} \\\n && make \\\n && make install \\\n && runtimeDeps=\"$( scanelf --needed --nobanner --recursive /usr/sbin/nginx /usr/lib/nginx/modules/*.so | awk '{ gsub(/,/, \"\\nso:\", $2); print \"so:\" $2 }' | sort -u | xargs -r apk info --installed | sort -u ;)\" \\\n && apk add --virtual .nginx-runtime-dependencies ${runtimeDeps} \\\n && : \"---------- Removing build dependencies, clean temporary files ----------\" \\\n && apk del .nginx-build-dependencies \\\n && rm -rf /var/cache/apk/* /var/tmp/* /tmp/*\nENTRYPOINT [\"tini\", \"--\"]\nCMD [\"nginx\"]\n","injectedSmells":[],"originalDockerfileHash":"e20d39b06a79f99ec9e9159107c4f6d3","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM alpine:3.9\nLABEL repository.hub=\"alexmasterov/alpine-nginx-tarantool\" \\\n      repository.url=\"https://github.com/AlexMasterov/dockerfiles\" \\\n      maintainer=\"Alex Masterov <alex.masterow@gmail.com>\"\nARG NGINX_VERSION=1.17.0\nARG NGINX_CONFIG=/etc/nginx\nARG LUAJIT_BRANCH=tarantool-1.7\nARG LUAROCKS_TAG=3.1.2\nARG DEVELKIT_MODULE_TAG=v0.3.1rc1\nARG LUA_MODULE_TAG=v0.10.15\nARG TARANTOOL_UPSTREAM_TAG=v2.7.1\nENV LUAJIT_LIB=\"/usr/local/lib\" \\\n    LUAJIT_INC=\"/usr/local/include/luajit-2.1\"\nRUN set -x \\\n && apk add --update tini \\\n && addgroup -g 82 -S nginx \\\n && adduser -u 82 -S -D -h /var/cache/nginx -s /sbin/nologin -G nginx nginx\nRUN set -x \\\n && apk add --virtual .nginx-build-dependencies cmake curl g++ gcc git linux-headers make openssl-dev pcre-dev zlib-dev \\\n && : \"---------- Build flags ----------\" \\\n && export LDFLAGS=\"-Wl,-O2 -Wl,--hash-style=both -pie\" \\\n && export CFLAGS=\"-O2 -march=native -fstack-protector-strong -fpic -fpie\" \\\n && export MAKEFLAGS=\"-j $( expr $( getconf _NPROCESSORS_ONLN ;) + 1 ;)\" \\\n && : \"---------- LuaJIT ----------\" \\\n && apk add --virtual .luajit-runtime-dependencies libgcc \\\n && git clone -b ${LUAJIT_BRANCH} --depth 1 https://github.com/tarantool/luajit.git /tmp/luajit \\\n && cd /tmp/luajit \\\n && make CFLAGS+=\"-fPIC\" XCFLAGS+=\"-DLUAJIT_ENABLE_GC64\" \\\n && make install \\\n && ln -sf /usr/local/bin/luajit-2.1.0-beta3 /usr/local/bin/lua \\\n && : \"---------- LuaRocks ----------\" \\\n && git clone -b ${LUAROCKS_TAG} --depth 1 https://github.com/luarocks/luarocks.git /tmp/luarocks \\\n && cd /tmp/luarocks \\\n && ./configure --with-lua-bin=/usr/local/bin --with-lua-include=/usr/local/include/luajit-2.1 \\\n && make build \\\n && make install \\\n && : \"---------- Nginx Development Kit ----------\" \\\n && DEVELKIT_MODULE_DIR=\"/tmp/devel-kit\" \\\n && DEVELKIT_MODULE_GIT=\"https://github.com/simpl/ngx_devel_kit.git\" \\\n && git clone -o ${DEVELKIT_MODULE_TAG} --depth 1 ${DEVELKIT_MODULE_GIT} ${DEVELKIT_MODULE_DIR} \\\n && : \"---------- Nginx Lua Module ----------\" \\\n && LUA_MODULE_DIR=\"/tmp/lua-module\" \\\n && LUA_MODULE_GIT=\"https://github.com/openresty/lua-nginx-module.git\" \\\n && git clone -o ${LUA_MODULE_TAG} --depth 1 ${LUA_MODULE_GIT} ${LUA_MODULE_DIR} \\\n && : \"---------- Nginx Tarantool Module ----------\" \\\n && TARANTOOL_UPSTREAM_GIT=\"https://github.com/tarantool/nginx_upstream_module.git\" \\\n && TARANTOOL_UPSTREAM_DIR=\"/tmp/nginx_upstream_module\" \\\n && git clone -o ${TARANTOOL_UPSTREAM_TAG} --depth 1 ${TARANTOOL_UPSTREAM_GIT} ${TARANTOOL_UPSTREAM_DIR} \\\n && git clone --single-branch --depth 1 https://github.com/lloyd/yajl.git /tmp/yajl \\\n && cd /tmp/yajl \\\n && cmake -DCMAKE_BUILD_TYPE=Release . \\\n && make \\\n && make install \\\n && : \"---------- Msgpuck ----------\" \\\n && git clone --depth 1 https://github.com/rtsisyk/msgpuck.git /tmp/msgpuck \\\n && cd /tmp/msgpuck \\\n && cmake -DCMAKE_BUILD_TYPE=Release . \\\n && make \\\n && make install \\\n && : \"---------- Nginx ----------\" \\\n && NGINX_SOURCE=\"https://nginx.org/download/nginx-${NGINX_VERSION}.tar.gz\" \\\n && curl -fSL --connect-timeout 30 ${NGINX_SOURCE} | tar xz -C /tmp \\\n && cd /tmp/nginx-${NGINX_VERSION} \\\n && ./configure --prefix=${NGINX_CONFIG} --conf-path=${NGINX_CONFIG}/nginx.conf --modules-path=/usr/lib/nginx/modules --sbin-path=/usr/sbin/nginx --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --without-http_autoindex_module --without-http_ssi_module --without-mail_imap_module --without-mail_pop3_module --without-mail_smtp_module --with-file-aio --with-http_auth_request_module --with-http_dav_module --with-http_degradation_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_v2_module --with-pcre --with-pcre-jit --with-stream --with-stream_ssl_module --with-threads --with-cc-opt=\"-flto\" --add-module=${DEVELKIT_MODULE_DIR} --add-module=${LUA_MODULE_DIR} \\\n && make \\\n && make install \\\n && runtimeDeps=\"$( scanelf --needed --nobanner --recursive /usr/sbin/nginx /usr/lib/nginx/modules/*.so | awk '{ gsub(/,/, \"\\nso:\", $2); print \"so:\" $2 }' | sort -u | xargs -r apk info --installed | sort -u ;)\" \\\n && apk add --virtual .nginx-runtime-dependencies ${runtimeDeps} \\\n && : \"---------- Removing build dependencies, clean temporary files ----------\" \\\n && apk del .nginx-build-dependencies \\\n && rm -rf /var/cache/apk/* /var/tmp/* /tmp/*\nENTRYPOINT [\"tini\", \"--\"]\nCMD [\"nginx\"]\n","originalDockerfileUglifiedHash":"e20d39b06a79f99ec9e9159107c4f6d3","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/0d8fd87805ae759f897f7e658cadf5c0bfa64ae6.dockerfile"}