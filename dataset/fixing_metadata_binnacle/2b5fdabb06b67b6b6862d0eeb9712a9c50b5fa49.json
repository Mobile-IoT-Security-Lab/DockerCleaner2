{"seed":679327397,"processedDockerfileHash":"3ccad4120e8ee5ca3405caa4efcc775c","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apt-get","use-copy-instead-of-add","have-a-healthcheck"],"processedDockerfile":"FROM ubuntu:14.04\nMAINTAINER Dan Liew <daniel.liew@imperial.ac.uk>\n#   FIXME: Docker doesn't currently offer a way to\n#   squash the layers from within a Dockerfile so\n#   the resulting image is unnecessarily large!\nENV LLVM_VERSION=\"3.4\" \\\n    SOLVERS=\"STP:Z3\" \\\n    STP_VERSION=\"master\" \\\n    DISABLE_ASSERTIONS=\"0\" \\\n    ENABLE_OPTIMIZED=\"1\" \\\n    KLEE_UCLIBC=\"klee_uclibc_v1.0.0\" \\\n    KLEE_SRC=\"/home/klee/klee_src\" \\\n    COVERAGE=\"0\" \\\n    BUILD_DIR=\"/home/klee/klee_build\"\nRUN apt-get update \\\n && apt-get install --no-install-recommends llvm=1:3.4-0ubuntu1 libcap-dev=1:2.24-0ubuntu2 git=1:1.9.1-1ubuntu0.10 subversion=1.8.8-1ubuntu3.3 cmake3=3.5.1-1ubuntu3~14.04.1 make=3.81-8.2ubuntu3 libboost-program-options-dev=1.54.0.1ubuntu1 python3=3.4.0-0ubuntu2 python3-dev=3.4.0-0ubuntu2 python3-pip=1.5.4-1ubuntu4 perl=5.18.2-2ubuntu1.7 flex=2.5.35-10.1ubuntu2 bison=2:3.0.2.dfsg-2 libncurses-dev zlib1g-dev=1:1.2.8.dfsg-1ubuntu1.1 patch=2.7.1-4ubuntu2.4 wget=1.15-1ubuntu1.14.04.5 unzip=6.0-9ubuntu1.5 binutils=2.24-5ubuntu14.2 clang-${LLVM_VERSION} llvm-${LLVM_VERSION} llvm-${LLVM_VERSION}-dev llvm-${LLVM_VERSION}-runtime -y \\\n && pip3 install -U lit tabulate \\\n && update-alternatives --install /usr/bin/python python /usr/bin/python3 50 \\\n && (wget -O - http://download.opensuse.org/repositories/home:delcypher:z3/xUbuntu_14.04/Release.key | apt-key add - ) \\\n && echo 'deb http://download.opensuse.org/repositories/home:/delcypher:/z3/xUbuntu_14.04/ /' >> /etc/apt/sources.list.d/z3.list \\\n && apt-get update\n#   Create ``klee`` user for container with password ``klee``.\n#   and give it password-less sudo access (temporarily so we can use the TravisCI scripts)\nRUN useradd -m klee \\\n && echo klee:klee | chpasswd \\\n && cp /etc/sudoers /etc/sudoers.bak \\\n && echo 'klee ALL=(root) NOPASSWD: ALL' >> /etc/sudoers\nUSER klee\nWORKDIR /home/klee\n#   Copy across source files needed for build\nRUN mkdir ${KLEE_SRC}\nCOPY configure LICENSE.TXT Makefile Makefile.* README.md MetaSMT.mk TODO.txt ${KLEE_SRC}/\nCOPY .travis ${KLEE_SRC}/.travis/\nCOPY autoconf ${KLEE_SRC}/autoconf/\nCOPY docs ${KLEE_SRC}/docs/\nCOPY include ${KLEE_SRC}/include/\nCOPY lib ${KLEE_SRC}/lib/\nCOPY runtime ${KLEE_SRC}/runtime/\nCOPY scripts ${KLEE_SRC}/scripts/\nCOPY test ${KLEE_SRC}/test/\nCOPY tools ${KLEE_SRC}/tools/\nCOPY unittests ${KLEE_SRC}/unittests/\nCOPY utils ${KLEE_SRC}/utils/\n#   Set klee user to be owner\nRUN sudo chown --recursive klee: ${KLEE_SRC}\n#   Create build directory\nRUN mkdir -p ${BUILD_DIR}\n#   Build/Install SMT solvers (use TravisCI script)\nRUN cd ${BUILD_DIR} \\\n && ${KLEE_SRC}/.travis/solvers.sh\n#   Install testing utils (use TravisCI script)\nRUN cd ${BUILD_DIR} \\\n && mkdir testing-utils \\\n && cd testing-utils \\\n && ${KLEE_SRC}/.travis/testing-utils.sh\n#   FIXME: This is a nasty hack so KLEE's configure and build finds\n#   LLVM's headers file, libraries and tools\nRUN sudo mkdir -p /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin \\\n && sudo ln -s /usr/bin/llvm-config /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-config \\\n && sudo ln -s /usr/bin/llvm-dis /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-dis \\\n && sudo ln -s /usr/bin/llvm-as /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-as \\\n && sudo ln -s /usr/bin/llvm-link /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-link \\\n && sudo ln -s /usr/bin/llvm-ar /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-ar \\\n && sudo ln -s /usr/bin/opt /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/opt \\\n && sudo ln -s /usr/bin/lli /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/lli \\\n && sudo mkdir -p /usr/lib/llvm-${LLVM_VERSION}/build/include \\\n && sudo ln -s /usr/include/llvm-${LLVM_VERSION}/llvm /usr/lib/llvm-${LLVM_VERSION}/build/include/llvm \\\n && sudo ln -s /usr/include/llvm-c-${LLVM_VERSION}/llvm-c /usr/lib/llvm-${LLVM_VERSION}/build/include/llvm-c \\\n && for static_lib in /usr/lib/llvm-${LLVM_VERSION}/lib/*.a; do sudo ln -s ${static_lib} /usr/lib/`basename ${static_lib} ` ; done\n#   FIXME: This is **really gross**. The Official Ubuntu LLVM packages don't ship\n#   with ``FileCheck`` or the ``not`` tools so we have to hack building these\n#   into KLEE's build system in order for the tests to pass\nRUN cd ${KLEE_SRC}/tools \\\n && for tool in FileCheck not; do svn export http://llvm.org/svn/llvm-project/llvm/branches/release_34/utils/${tool} ${tool} ;sed -i 's/^USEDLIBS.*$/LINK_COMPONENTS = support/' ${tool}/Makefile ; done \\\n && sed -i '0,/^PARALLEL_DIRS/a PARALLEL_DIRS += FileCheck not' Makefile\n#   FIXME: The current TravisCI script expects clang-${LLVM_VERSION} to exist\nRUN sudo ln -s /usr/bin/clang /usr/bin/clang-${LLVM_VERSION} \\\n && sudo ln -s /usr/bin/clang++ /usr/bin/clang++-${LLVM_VERSION}\n#   Build KLEE (use TravisCI script)\nRUN cd ${BUILD_DIR} \\\n && ${KLEE_SRC}/.travis/klee.sh\n#   Revoke password-less sudo and Set up sudo access for the ``klee`` user so it\n#   requires a password\nUSER root\nRUN mv /etc/sudoers.bak /etc/sudoers \\\n && echo 'klee ALL=(root) ALL' >> /etc/sudoers\nUSER klee\n#   Add KLEE binary directory to PATH\nRUN echo 'export PATH=$PATH:'${BUILD_DIR}'/klee/Release+Asserts/bin' >> /home/klee/.bashrc\n#   Link klee to /usr/bin so that it can be used by docker run\nUSER root\nRUN for exec in ${BUILD_DIR}/klee/Release+Asserts/bin/*; do ln -s ${exec} /usr/bin/`basename ${exec} ` ; done\n#   Link klee to the libkleeRuntest library needed by docker run\nRUN ln -s ${BUILD_DIR}/klee/Release+Asserts/lib/libkleeRuntest.so /usr/lib/libkleeRuntest.so.1.0\nUSER klee\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ubuntu:14.04\nMAINTAINER Dan Liew <daniel.liew@imperial.ac.uk>\n#  FIXME: Docker doesn't currently offer a way to\n#  squash the layers from within a Dockerfile so\n#  the resulting image is unnecessarily large!\nENV LLVM_VERSION=\"3.4\" \\\n    SOLVERS=\"STP:Z3\" \\\n    STP_VERSION=\"master\" \\\n    DISABLE_ASSERTIONS=\"0\" \\\n    ENABLE_OPTIMIZED=\"1\" \\\n    KLEE_UCLIBC=\"klee_uclibc_v1.0.0\" \\\n    KLEE_SRC=\"/home/klee/klee_src\" \\\n    COVERAGE=\"0\" \\\n    BUILD_DIR=\"/home/klee/klee_build\"\nRUN apt-get update \\\n && apt-get install --no-install-recommends llvm libcap-dev git subversion cmake3 make libboost-program-options-dev python3 python3-dev python3-pip perl flex bison libncurses-dev zlib1g-dev patch wget unzip binutils clang-${LLVM_VERSION} llvm-${LLVM_VERSION} llvm-${LLVM_VERSION}-dev llvm-${LLVM_VERSION}-runtime -y \\\n && pip3 install -U lit tabulate \\\n && update-alternatives --install /usr/bin/python python /usr/bin/python3 50 \\\n && (wget -O - http://download.opensuse.org/repositories/home:delcypher:z3/xUbuntu_14.04/Release.key | apt-key add - ) \\\n && echo 'deb http://download.opensuse.org/repositories/home:/delcypher:/z3/xUbuntu_14.04/ /' >> /etc/apt/sources.list.d/z3.list \\\n && apt-get update\n#  Create ``klee`` user for container with password ``klee``.\n#  and give it password-less sudo access (temporarily so we can use the TravisCI scripts)\nRUN useradd -m klee \\\n && echo klee:klee | chpasswd \\\n && cp /etc/sudoers /etc/sudoers.bak \\\n && echo 'klee ALL=(root) NOPASSWD: ALL' >> /etc/sudoers\nUSER klee\nWORKDIR /home/klee\n#  Copy across source files needed for build\nRUN mkdir ${KLEE_SRC}\nADD configure LICENSE.TXT Makefile Makefile.* README.md MetaSMT.mk TODO.txt ${KLEE_SRC}/\nADD .travis ${KLEE_SRC}/.travis/\nADD autoconf ${KLEE_SRC}/autoconf/\nADD docs ${KLEE_SRC}/docs/\nADD include ${KLEE_SRC}/include/\nADD lib ${KLEE_SRC}/lib/\nADD runtime ${KLEE_SRC}/runtime/\nADD scripts ${KLEE_SRC}/scripts/\nADD test ${KLEE_SRC}/test/\nADD tools ${KLEE_SRC}/tools/\nADD unittests ${KLEE_SRC}/unittests/\nADD utils ${KLEE_SRC}/utils/\n#  Set klee user to be owner\nRUN sudo chown --recursive klee: ${KLEE_SRC}\n#  Create build directory\nRUN mkdir -p ${BUILD_DIR}\n#  Build/Install SMT solvers (use TravisCI script)\nRUN cd ${BUILD_DIR} \\\n && ${KLEE_SRC}/.travis/solvers.sh\n#  Install testing utils (use TravisCI script)\nRUN cd ${BUILD_DIR} \\\n && mkdir testing-utils \\\n && cd testing-utils \\\n && ${KLEE_SRC}/.travis/testing-utils.sh\n#  FIXME: This is a nasty hack so KLEE's configure and build finds\n#  LLVM's headers file, libraries and tools\nRUN sudo mkdir -p /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin \\\n && sudo ln -s /usr/bin/llvm-config /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-config \\\n && sudo ln -s /usr/bin/llvm-dis /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-dis \\\n && sudo ln -s /usr/bin/llvm-as /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-as \\\n && sudo ln -s /usr/bin/llvm-link /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-link \\\n && sudo ln -s /usr/bin/llvm-ar /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-ar \\\n && sudo ln -s /usr/bin/opt /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/opt \\\n && sudo ln -s /usr/bin/lli /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/lli \\\n && sudo mkdir -p /usr/lib/llvm-${LLVM_VERSION}/build/include \\\n && sudo ln -s /usr/include/llvm-${LLVM_VERSION}/llvm /usr/lib/llvm-${LLVM_VERSION}/build/include/llvm \\\n && sudo ln -s /usr/include/llvm-c-${LLVM_VERSION}/llvm-c /usr/lib/llvm-${LLVM_VERSION}/build/include/llvm-c \\\n && for static_lib in /usr/lib/llvm-${LLVM_VERSION}/lib/*.a; do sudo ln -s ${static_lib} /usr/lib/`basename ${static_lib} ` ; done\n#  FIXME: This is **really gross**. The Official Ubuntu LLVM packages don't ship\n#  with ``FileCheck`` or the ``not`` tools so we have to hack building these\n#  into KLEE's build system in order for the tests to pass\nRUN cd ${KLEE_SRC}/tools \\\n && for tool in FileCheck not; do svn export http://llvm.org/svn/llvm-project/llvm/branches/release_34/utils/${tool} ${tool} ;sed -i 's/^USEDLIBS.*$/LINK_COMPONENTS = support/' ${tool}/Makefile ; done \\\n && sed -i '0,/^PARALLEL_DIRS/a PARALLEL_DIRS += FileCheck not' Makefile\n#  FIXME: The current TravisCI script expects clang-${LLVM_VERSION} to exist\nRUN sudo ln -s /usr/bin/clang /usr/bin/clang-${LLVM_VERSION} \\\n && sudo ln -s /usr/bin/clang++ /usr/bin/clang++-${LLVM_VERSION}\n#  Build KLEE (use TravisCI script)\nRUN cd ${BUILD_DIR} \\\n && ${KLEE_SRC}/.travis/klee.sh\n#  Revoke password-less sudo and Set up sudo access for the ``klee`` user so it\n#  requires a password\nUSER root\nRUN mv /etc/sudoers.bak /etc/sudoers \\\n && echo 'klee ALL=(root) ALL' >> /etc/sudoers\nUSER klee\n#  Add KLEE binary directory to PATH\nRUN echo 'export PATH=$PATH:'${BUILD_DIR}'/klee/Release+Asserts/bin' >> /home/klee/.bashrc\n#  Link klee to /usr/bin so that it can be used by docker run\nUSER root\nRUN for exec in ${BUILD_DIR}/klee/Release+Asserts/bin/*; do ln -s ${exec} /usr/bin/`basename ${exec} ` ; done\n#  Link klee to the libkleeRuntest library needed by docker run\nRUN ln -s ${BUILD_DIR}/klee/Release+Asserts/lib/libkleeRuntest.so /usr/lib/libkleeRuntest.so.1.0\nUSER klee\n","injectedSmells":[],"originalDockerfileHash":"0e2d7f9516a40e76663f3030287db6a5","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:14.04\nMAINTAINER Dan Liew <daniel.liew@imperial.ac.uk>\n#   FIXME: Docker doesn't currently offer a way to\n#   squash the layers from within a Dockerfile so\n#   the resulting image is unnecessarily large!\nENV LLVM_VERSION=\"3.4\" \\\n    SOLVERS=\"STP:Z3\" \\\n    STP_VERSION=\"master\" \\\n    DISABLE_ASSERTIONS=\"0\" \\\n    ENABLE_OPTIMIZED=\"1\" \\\n    KLEE_UCLIBC=\"klee_uclibc_v1.0.0\" \\\n    KLEE_SRC=\"/home/klee/klee_src\" \\\n    COVERAGE=\"0\" \\\n    BUILD_DIR=\"/home/klee/klee_build\"\nRUN apt-get update \\\n && apt-get install --no-install-recommends llvm libcap-dev git subversion cmake3 make libboost-program-options-dev python3 python3-dev python3-pip perl flex bison libncurses-dev zlib1g-dev patch wget unzip binutils clang-${LLVM_VERSION} llvm-${LLVM_VERSION} llvm-${LLVM_VERSION}-dev llvm-${LLVM_VERSION}-runtime -y \\\n && pip3 install -U lit tabulate \\\n && update-alternatives --install /usr/bin/python python /usr/bin/python3 50 \\\n && (wget -O - http://download.opensuse.org/repositories/home:delcypher:z3/xUbuntu_14.04/Release.key | apt-key add - ) \\\n && echo 'deb http://download.opensuse.org/repositories/home:/delcypher:/z3/xUbuntu_14.04/ /' >> /etc/apt/sources.list.d/z3.list \\\n && apt-get update\n#   Create ``klee`` user for container with password ``klee``.\n#   and give it password-less sudo access (temporarily so we can use the TravisCI scripts)\nRUN useradd -m klee \\\n && echo klee:klee | chpasswd \\\n && cp /etc/sudoers /etc/sudoers.bak \\\n && echo 'klee ALL=(root) NOPASSWD: ALL' >> /etc/sudoers\nUSER klee\nWORKDIR /home/klee\n#   Copy across source files needed for build\nRUN mkdir ${KLEE_SRC}\nADD configure LICENSE.TXT Makefile Makefile.* README.md MetaSMT.mk TODO.txt ${KLEE_SRC}/\nADD .travis ${KLEE_SRC}/.travis/\nADD autoconf ${KLEE_SRC}/autoconf/\nADD docs ${KLEE_SRC}/docs/\nADD include ${KLEE_SRC}/include/\nADD lib ${KLEE_SRC}/lib/\nADD runtime ${KLEE_SRC}/runtime/\nADD scripts ${KLEE_SRC}/scripts/\nADD test ${KLEE_SRC}/test/\nADD tools ${KLEE_SRC}/tools/\nADD unittests ${KLEE_SRC}/unittests/\nADD utils ${KLEE_SRC}/utils/\n#   Set klee user to be owner\nRUN sudo chown --recursive klee: ${KLEE_SRC}\n#   Create build directory\nRUN mkdir -p ${BUILD_DIR}\n#   Build/Install SMT solvers (use TravisCI script)\nRUN cd ${BUILD_DIR} \\\n && ${KLEE_SRC}/.travis/solvers.sh\n#   Install testing utils (use TravisCI script)\nRUN cd ${BUILD_DIR} \\\n && mkdir testing-utils \\\n && cd testing-utils \\\n && ${KLEE_SRC}/.travis/testing-utils.sh\n#   FIXME: This is a nasty hack so KLEE's configure and build finds\n#   LLVM's headers file, libraries and tools\nRUN sudo mkdir -p /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin \\\n && sudo ln -s /usr/bin/llvm-config /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-config \\\n && sudo ln -s /usr/bin/llvm-dis /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-dis \\\n && sudo ln -s /usr/bin/llvm-as /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-as \\\n && sudo ln -s /usr/bin/llvm-link /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-link \\\n && sudo ln -s /usr/bin/llvm-ar /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/llvm-ar \\\n && sudo ln -s /usr/bin/opt /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/opt \\\n && sudo ln -s /usr/bin/lli /usr/lib/llvm-${LLVM_VERSION}/build/Release/bin/lli \\\n && sudo mkdir -p /usr/lib/llvm-${LLVM_VERSION}/build/include \\\n && sudo ln -s /usr/include/llvm-${LLVM_VERSION}/llvm /usr/lib/llvm-${LLVM_VERSION}/build/include/llvm \\\n && sudo ln -s /usr/include/llvm-c-${LLVM_VERSION}/llvm-c /usr/lib/llvm-${LLVM_VERSION}/build/include/llvm-c \\\n && for static_lib in /usr/lib/llvm-${LLVM_VERSION}/lib/*.a; do sudo ln -s ${static_lib} /usr/lib/`basename ${static_lib} ` ; done\n#   FIXME: This is **really gross**. The Official Ubuntu LLVM packages don't ship\n#   with ``FileCheck`` or the ``not`` tools so we have to hack building these\n#   into KLEE's build system in order for the tests to pass\nRUN cd ${KLEE_SRC}/tools \\\n && for tool in FileCheck not; do svn export http://llvm.org/svn/llvm-project/llvm/branches/release_34/utils/${tool} ${tool} ;sed -i 's/^USEDLIBS.*$/LINK_COMPONENTS = support/' ${tool}/Makefile ; done \\\n && sed -i '0,/^PARALLEL_DIRS/a PARALLEL_DIRS += FileCheck not' Makefile\n#   FIXME: The current TravisCI script expects clang-${LLVM_VERSION} to exist\nRUN sudo ln -s /usr/bin/clang /usr/bin/clang-${LLVM_VERSION} \\\n && sudo ln -s /usr/bin/clang++ /usr/bin/clang++-${LLVM_VERSION}\n#   Build KLEE (use TravisCI script)\nRUN cd ${BUILD_DIR} \\\n && ${KLEE_SRC}/.travis/klee.sh\n#   Revoke password-less sudo and Set up sudo access for the ``klee`` user so it\n#   requires a password\nUSER root\nRUN mv /etc/sudoers.bak /etc/sudoers \\\n && echo 'klee ALL=(root) ALL' >> /etc/sudoers\nUSER klee\n#   Add KLEE binary directory to PATH\nRUN echo 'export PATH=$PATH:'${BUILD_DIR}'/klee/Release+Asserts/bin' >> /home/klee/.bashrc\n#   Link klee to /usr/bin so that it can be used by docker run\nUSER root\nRUN for exec in ${BUILD_DIR}/klee/Release+Asserts/bin/*; do ln -s ${exec} /usr/bin/`basename ${exec} ` ; done\n#   Link klee to the libkleeRuntest library needed by docker run\nRUN ln -s ${BUILD_DIR}/klee/Release+Asserts/lib/libkleeRuntest.so /usr/lib/libkleeRuntest.so.1.0\nUSER klee\n","originalDockerfileUglifiedHash":"8bc72c4b2b84ec4965d9c65b801de485","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/2b5fdabb06b67b6b6862d0eeb9712a9c50b5fa49.dockerfile"}