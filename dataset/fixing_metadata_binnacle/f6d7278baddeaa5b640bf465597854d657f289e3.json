{"seed":1362644037,"processedDockerfileHash":"928ce5eca6e9cfc57d4c10339b1de793","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM alpine\nRUN apk update \\\n && apk add build-base=0.5-r3 python3-dev=3.10.11-r0 --no-cache --virtual .build-deps \\\n && apk add apache2=2.4.57-r0 curl=7.88.1-r1 git=2.38.4-r1 libcap=2.66-r0 libffi-dev=3.4.4-r0 linux-headers=5.19.5-r0 openssl-dev=3.0.8-r3 php7 php7-apache2 php7-curl php7-mysqli php7-mbstring php7-phar php7-json php7-zip py-bottle py-mysqldb py-pillow py-pip python3=3.10.11-r0 tzdata=2023c-r0 --no-cache \\\n && pip3 install --upgrade pip \\\n && pip3 install python-miio pymysql \\\n && apk del .build-deps \\\n && rm -f /var/cache/apk/*\n#  ##########################################################################\n#   Copy dustcloud Data\nENV DUSTCLOUD=\"/opt/dustcloud\"\nENV WWWDATA=\"$DUSTCLOUD/www\"\nENV GITDIR=\"/gitdata\"\nRUN git clone --depth 1 https://github.com/dgiese/dustcloud.git $GITDIR \\\n && cd /gitdata \\\n && mkdir -p $DUSTCLOUD \\\n && cp -r $GITDIR/dustcloud/www $DUSTCLOUD \\\n && cp $GITDIR/devices/xiaomi.vacuum.gen1/mapextractor/extractor.py $DUSTCLOUD/map_extractor.py \\\n && cp $GITDIR/dustcloud/server.py $DUSTCLOUD/server.py.master \\\n && cp $GITDIR/dustcloud/build_map.py $DUSTCLOUD/build_map.py \\\n && cp $GITDIR/dustcloud/config.sample.ini $DUSTCLOUD/config.master.ini \\\n && echo 'su -c \"python3 $DUSTCLOUD/server.py --enable-live-map\" -s /bin/sh - apache' > $DUSTCLOUD/server.sh \\\n && chmod +x $DUSTCLOUD/server.sh \\\n && echo \"<?php phpinfo(); ?>\" > $WWWDATA/public/info.php \\\n && rm -rf $GITDIR\n#   Change vars in server.py.master\nRUN sed -i -e \"s/cmd_server.run(host=\\\"localhost\\\", port=cmd_server_port)/cmd_server.run(host=\\\"0.0.0.0\\\", port={{CMDSERVER_PORT}})/g\" $DUSTCLOUD/server.py.master \\\n && sed -i -e \"s/cloud_server_address = ('ott.io.mi.com', 80)/cloud_server_address = ('{{CLOUD_SERVER_ADDRESS}}', 80)/g\" $DUSTCLOUD/server.py.master\n#  ##########################################################################\n#   Customization config.master.ini\nRUN sed -i -e \"s/ip = 10.0.0.1/ip = {{CLOUDSERVERIP}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/host = 127.0.0.1/host = {{MYSQLSERVER}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/database = dustcloud/database = {{MYSQLDB}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/username = dustcloud/username = {{MYSQLUSER}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/password = dustcloud/password = {{MYSQLPW}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s@cmd.server = http://localhost:1121/@cmd.server = http://{{CMDSERVER}}:{{CMDSERVER_PORT}}/@g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/debug = true/debug = {{DEBUG}}/g\" $DUSTCLOUD/config.master.ini\n#  ##########################################################################\n#   Install composer\nRUN cd $WWWDATA \\\n && curl https://raw.githubusercontent.com/composer/getcomposer.org/master/web/installer | php -- \\\n && php composer.phar install\n#  ##########################################################################\n#   Customization for PHP and Apache\nENV APACHE_PORT=\"81\"\nRUN mkdir /run/apache2 \\\n && sed -i -e \"s/Listen 80/Listen ${APACHE_PORT}/g\" /etc/apache2/httpd.conf \\\n && sed -i -e \"s@/var/www/localhost/htdocs@$WWWDATA/public@g\" /etc/apache2/httpd.conf \\\n && sed -i -e \"s/error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT/error_reporting = E_ALL/g\" /etc/php7/php.ini \\\n && sed -i -e \"s/display_errors = Off/display_errors = On/g\" /etc/php7/php.ini \\\n && sed -i -e \"s@;date.timezone =@date.timezone = \\\"{{TZ}}\\\"@g\" /etc/php7/php.ini \\\n && sed -i -e \"s/;extension=curl/extension=curl/g\" /etc/php7/php.ini\n#   allow python to bind ports < 1024\nRUN setcap CAP_NET_BIND_SERVICE=+eip /usr/bin/python3.6\n#  ##########################################################################\n#   Start script\nRUN mkdir /bootstrap\nCOPY start.sh /bootstrap/\nRUN chmod +x /bootstrap/start.sh\n#  ##########################################################################\n#   change permission\nRUN chgrp -R apache $DUSTCLOUD \\\n && chown -R apache $DUSTCLOUD\nWORKDIR $DUSTCLOUD\nEXPOSE 80/tcp\nEXPOSE 81/tcp\nEXPOSE 8053/udp\nEXPOSE 1121/tcp\nCMD [\"/bootstrap/start.sh\"]\n#   Build-time metadata as defined at http://label-schema.org\nENV VERSION=\"v1.4.0\"\nARG BUILD_DATE\nARG VCS_REF\nARG BRANCH\nLABEL org.label-schema.build-date=\"$BUILD_DATE\" \\\n      org.label-schema.name=\"dustcloud\" \\\n      org.label-schema.description=\"Image for Xiaomi Mi Robot Vacuum dustcloud project (https://github.com/dgiese/dustcloud)\" \\\n      org.label-schema.url=\"https://github.com/JackGruber/docker_dustcloud\" \\\n      org.label-schema.vcs-ref=\"$VCS_REF\" \\\n      org.label-schema.vcs-url=\"https://github.com/JackGruber/docker_dustcloud.git\" \\\n      org.label-schema.version=\"$BRANCH $VERSION\" \\\n      org.label-schema.schema-version=\"1.0\"\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM alpine\nRUN apk update \\\n && apk add --no-cache --virtual .build-deps build-base python3-dev \\\n && apk add --no-cache apache2 curl git libcap libffi-dev linux-headers openssl-dev php7 php7-apache2 php7-curl php7-mysqli php7-mbstring php7-phar php7-json php7-zip py-bottle py-mysqldb py-pillow py-pip python3 tzdata \\\n && pip3 install --upgrade pip \\\n && pip3 install python-miio pymysql \\\n && apk del .build-deps \\\n && rm -f /var/cache/apk/*\n# ##########################################################################\n#  Copy dustcloud Data\nENV DUSTCLOUD=\"/opt/dustcloud\"\nENV WWWDATA=\"$DUSTCLOUD/www\"\nENV GITDIR=\"/gitdata\"\nRUN git clone --depth 1 https://github.com/dgiese/dustcloud.git $GITDIR \\\n && cd /gitdata \\\n && mkdir -p $DUSTCLOUD \\\n && cp -r $GITDIR/dustcloud/www $DUSTCLOUD \\\n && cp $GITDIR/devices/xiaomi.vacuum.gen1/mapextractor/extractor.py $DUSTCLOUD/map_extractor.py \\\n && cp $GITDIR/dustcloud/server.py $DUSTCLOUD/server.py.master \\\n && cp $GITDIR/dustcloud/build_map.py $DUSTCLOUD/build_map.py \\\n && cp $GITDIR/dustcloud/config.sample.ini $DUSTCLOUD/config.master.ini \\\n && echo 'su -c \"python3 $DUSTCLOUD/server.py --enable-live-map\" -s /bin/sh - apache' > $DUSTCLOUD/server.sh \\\n && chmod +x $DUSTCLOUD/server.sh \\\n && echo \"<?php phpinfo(); ?>\" > $WWWDATA/public/info.php \\\n && rm -rf $GITDIR\n#  Change vars in server.py.master\nRUN sed -i -e \"s/cmd_server.run(host=\\\"localhost\\\", port=cmd_server_port)/cmd_server.run(host=\\\"0.0.0.0\\\", port={{CMDSERVER_PORT}})/g\" $DUSTCLOUD/server.py.master \\\n && sed -i -e \"s/cloud_server_address = ('ott.io.mi.com', 80)/cloud_server_address = ('{{CLOUD_SERVER_ADDRESS}}', 80)/g\" $DUSTCLOUD/server.py.master\n# ##########################################################################\n#  Customization config.master.ini\nRUN sed -i -e \"s/ip = 10.0.0.1/ip = {{CLOUDSERVERIP}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/host = 127.0.0.1/host = {{MYSQLSERVER}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/database = dustcloud/database = {{MYSQLDB}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/username = dustcloud/username = {{MYSQLUSER}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/password = dustcloud/password = {{MYSQLPW}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s@cmd.server = http://localhost:1121/@cmd.server = http://{{CMDSERVER}}:{{CMDSERVER_PORT}}/@g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/debug = true/debug = {{DEBUG}}/g\" $DUSTCLOUD/config.master.ini\n# ##########################################################################\n#  Install composer\nRUN cd $WWWDATA \\\n && curl https://raw.githubusercontent.com/composer/getcomposer.org/master/web/installer | php -- \\\n && php composer.phar install\n# ##########################################################################\n#  Customization for PHP and Apache\nENV APACHE_PORT=\"81\"\nRUN mkdir /run/apache2 \\\n && sed -i -e \"s/Listen 80/Listen ${APACHE_PORT}/g\" /etc/apache2/httpd.conf \\\n && sed -i -e \"s@/var/www/localhost/htdocs@$WWWDATA/public@g\" /etc/apache2/httpd.conf \\\n && sed -i -e \"s/error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT/error_reporting = E_ALL/g\" /etc/php7/php.ini \\\n && sed -i -e \"s/display_errors = Off/display_errors = On/g\" /etc/php7/php.ini \\\n && sed -i -e \"s@;date.timezone =@date.timezone = \\\"{{TZ}}\\\"@g\" /etc/php7/php.ini \\\n && sed -i -e \"s/;extension=curl/extension=curl/g\" /etc/php7/php.ini\n#  allow python to bind ports < 1024\nRUN setcap CAP_NET_BIND_SERVICE=+eip /usr/bin/python3.6\n# ##########################################################################\n#  Start script\nRUN mkdir /bootstrap\nADD start.sh /bootstrap/\nRUN chmod +x /bootstrap/start.sh\n# ##########################################################################\n#  change permission\nRUN chgrp -R apache $DUSTCLOUD \\\n && chown -R apache $DUSTCLOUD\nWORKDIR $DUSTCLOUD\nEXPOSE 80/tcp\nEXPOSE 81/tcp\nEXPOSE 8053/udp\nEXPOSE 1121/tcp\nCMD [\"/bootstrap/start.sh\"]\n#  Build-time metadata as defined at http://label-schema.org\nENV VERSION=\"v1.4.0\"\nARG BUILD_DATE\nARG VCS_REF\nARG BRANCH\nLABEL org.label-schema.build-date=\"$BUILD_DATE\" \\\n      org.label-schema.name=\"dustcloud\" \\\n      org.label-schema.description=\"Image for Xiaomi Mi Robot Vacuum dustcloud project (https://github.com/dgiese/dustcloud)\" \\\n      org.label-schema.url=\"https://github.com/JackGruber/docker_dustcloud\" \\\n      org.label-schema.vcs-ref=\"$VCS_REF\" \\\n      org.label-schema.vcs-url=\"https://github.com/JackGruber/docker_dustcloud.git\" \\\n      org.label-schema.version=\"$BRANCH $VERSION\" \\\n      org.label-schema.schema-version=\"1.0\"\n","injectedSmells":[],"originalDockerfileHash":"4a4fc85a3b1e49ec8c8cabe751384c45","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM alpine\nRUN apk update \\\n && apk add --no-cache --virtual .build-deps build-base python3-dev \\\n && apk add --no-cache apache2 curl git libcap libffi-dev linux-headers openssl-dev php7 php7-apache2 php7-curl php7-mysqli php7-mbstring php7-phar php7-json php7-zip py-bottle py-mysqldb py-pillow py-pip python3 tzdata \\\n && pip3 install --upgrade pip \\\n && pip3 install python-miio pymysql \\\n && apk del .build-deps \\\n && rm -f /var/cache/apk/*\n#  ##########################################################################\n#   Copy dustcloud Data\nENV DUSTCLOUD=\"/opt/dustcloud\"\nENV WWWDATA=\"$DUSTCLOUD/www\"\nENV GITDIR=\"/gitdata\"\nRUN git clone --depth 1 https://github.com/dgiese/dustcloud.git $GITDIR \\\n && cd /gitdata \\\n && mkdir -p $DUSTCLOUD \\\n && cp -r $GITDIR/dustcloud/www $DUSTCLOUD \\\n && cp $GITDIR/devices/xiaomi.vacuum.gen1/mapextractor/extractor.py $DUSTCLOUD/map_extractor.py \\\n && cp $GITDIR/dustcloud/server.py $DUSTCLOUD/server.py.master \\\n && cp $GITDIR/dustcloud/build_map.py $DUSTCLOUD/build_map.py \\\n && cp $GITDIR/dustcloud/config.sample.ini $DUSTCLOUD/config.master.ini \\\n && echo 'su -c \"python3 $DUSTCLOUD/server.py --enable-live-map\" -s /bin/sh - apache' > $DUSTCLOUD/server.sh \\\n && chmod +x $DUSTCLOUD/server.sh \\\n && echo \"<?php phpinfo(); ?>\" > $WWWDATA/public/info.php \\\n && rm -rf $GITDIR\n#   Change vars in server.py.master\nRUN sed -i -e \"s/cmd_server.run(host=\\\"localhost\\\", port=cmd_server_port)/cmd_server.run(host=\\\"0.0.0.0\\\", port={{CMDSERVER_PORT}})/g\" $DUSTCLOUD/server.py.master \\\n && sed -i -e \"s/cloud_server_address = ('ott.io.mi.com', 80)/cloud_server_address = ('{{CLOUD_SERVER_ADDRESS}}', 80)/g\" $DUSTCLOUD/server.py.master\n#  ##########################################################################\n#   Customization config.master.ini\nRUN sed -i -e \"s/ip = 10.0.0.1/ip = {{CLOUDSERVERIP}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/host = 127.0.0.1/host = {{MYSQLSERVER}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/database = dustcloud/database = {{MYSQLDB}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/username = dustcloud/username = {{MYSQLUSER}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/password = dustcloud/password = {{MYSQLPW}}/g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s@cmd.server = http://localhost:1121/@cmd.server = http://{{CMDSERVER}}:{{CMDSERVER_PORT}}/@g\" $DUSTCLOUD/config.master.ini \\\n && sed -i -e \"s/debug = true/debug = {{DEBUG}}/g\" $DUSTCLOUD/config.master.ini\n#  ##########################################################################\n#   Install composer\nRUN cd $WWWDATA \\\n && curl https://raw.githubusercontent.com/composer/getcomposer.org/master/web/installer | php -- \\\n && php composer.phar install\n#  ##########################################################################\n#   Customization for PHP and Apache\nENV APACHE_PORT=\"81\"\nRUN mkdir /run/apache2 \\\n && sed -i -e \"s/Listen 80/Listen ${APACHE_PORT}/g\" /etc/apache2/httpd.conf \\\n && sed -i -e \"s@/var/www/localhost/htdocs@$WWWDATA/public@g\" /etc/apache2/httpd.conf \\\n && sed -i -e \"s/error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT/error_reporting = E_ALL/g\" /etc/php7/php.ini \\\n && sed -i -e \"s/display_errors = Off/display_errors = On/g\" /etc/php7/php.ini \\\n && sed -i -e \"s@;date.timezone =@date.timezone = \\\"{{TZ}}\\\"@g\" /etc/php7/php.ini \\\n && sed -i -e \"s/;extension=curl/extension=curl/g\" /etc/php7/php.ini\n#   allow python to bind ports < 1024\nRUN setcap CAP_NET_BIND_SERVICE=+eip /usr/bin/python3.6\n#  ##########################################################################\n#   Start script\nRUN mkdir /bootstrap\nADD start.sh /bootstrap/\nRUN chmod +x /bootstrap/start.sh\n#  ##########################################################################\n#   change permission\nRUN chgrp -R apache $DUSTCLOUD \\\n && chown -R apache $DUSTCLOUD\nWORKDIR $DUSTCLOUD\nEXPOSE 80/tcp\nEXPOSE 81/tcp\nEXPOSE 8053/udp\nEXPOSE 1121/tcp\nCMD [\"/bootstrap/start.sh\"]\n#   Build-time metadata as defined at http://label-schema.org\nENV VERSION=\"v1.4.0\"\nARG BUILD_DATE\nARG VCS_REF\nARG BRANCH\nLABEL org.label-schema.build-date=\"$BUILD_DATE\" \\\n      org.label-schema.name=\"dustcloud\" \\\n      org.label-schema.description=\"Image for Xiaomi Mi Robot Vacuum dustcloud project (https://github.com/dgiese/dustcloud)\" \\\n      org.label-schema.url=\"https://github.com/JackGruber/docker_dustcloud\" \\\n      org.label-schema.vcs-ref=\"$VCS_REF\" \\\n      org.label-schema.vcs-url=\"https://github.com/JackGruber/docker_dustcloud.git\" \\\n      org.label-schema.version=\"$BRANCH $VERSION\" \\\n      org.label-schema.schema-version=\"1.0\"\n","originalDockerfileUglifiedHash":"afb4861776c62544caae6dbd55d86cc3","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/f6d7278baddeaa5b640bf465597854d657f289e3.dockerfile"}