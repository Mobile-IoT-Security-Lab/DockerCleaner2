{"seed":2190113203,"processedDockerfileHash":"a7acd29075da4efd1380ff3aa4bf6077","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["have-a-healthcheck","have-a-user"],"processedDockerfile":"# syntax = docker/dockerfile:experimental\n#   https://sources.debian.org/src/php7.2/7.2.4-1/debian/control/\nARG PHP_VERSION=7.2.19\nFROM --platform=$TARGETPLATFORM php:${PHP_VERSION}-fpm-stretch\nLABEL maintainer=\"khs1994-docker/lnmp <khs1994@khs1994.com>\"\nENV TZ=\"Asia/Shanghai\"\nENV PHP_EXTENSION=\"bcmath  bz2  calendar  enchant  exif  gd  gettext  gmp  imap  intl  mysqli  pcntl  pdo_pgsql  pdo_mysql  pgsql  sockets  sysvmsg  sysvsem  sysvshm  xmlrpc  xsl  zip\"\nENV PECL_EXTENSION=\"mongodb  igbinary  redis  memcached  xdebug  yaml  swoole\"\nARG DEB_URL=deb.debian.org\nARG DEB_SECURITY_URL=security.debian.org/debian-security\nRUN sed -i \"s!deb.debian.org!${DEB_URL}!g\" /etc/apt/sources.list \\\n && sed -i \"s!security.debian.org/debian-security!${DEB_SECURITY_URL}!g\" /etc/apt/sources.list \\\n && set -xe \\\n && buildDeps=\" wget unzip libfreetype6-dev libjpeg62-turbo-dev libpng-dev libsasl2-dev libssl-dev libmemcached-dev libpq-dev libzip-dev zlib1g-dev libyaml-dev libxmlrpc-epi-dev libbz2-dev libexif-dev libgmp-dev libicu-dev libwebp-dev libxpm-dev libenchant-dev libxslt1-dev libc-client2007e-dev libkrb5-dev \" \\\n && runDeps=\" libfreetype6 libjpeg62-turbo libpng16-16 libssl1.1 libmemcached11 libmemcachedutil2 libpq5 libzip4 zlib1g libyaml-0-2 libxslt1.1 libxmlrpc-epi0 libbz2-1.0 libexif12 libgmp10 libicu57 libxpm4 libwebp6 libenchant1c2a libc-client2007e libkrb5-3 \" \\\n && apt-get update \\\n && apt-get install --no-install-recommends $buildDeps $runDeps -y \\\n && rm -r /var/lib/apt/lists/* \\\n && docker-php-ext-configure zip --with-libzip \\\n && docker-php-ext-configure gd --disable-gd-jis-conv --with-freetype-dir=/usr --with-jpeg-dir=/usr --with-png-dir=/usr --with-webp-dir=/usr --with-xpm-dir=/usr \\\n && docker-php-ext-configure imap --with-kerberos --with-imap-ssl \\\n && docker-php-ext-install $PHP_EXTENSION \\\n && for extension in ${PHP_EXTENSION}; do strip --strip-all $( php-config --extension-dir ;)/$( echo ${extension} | cut -d '-' -f 1 ;).so ; done \\\n && for extension in $PECL_EXTENSION; do pecl install $extension \\\n && docker-php-ext-enable $( echo ${extension} | cut -d '-' -f 1 ;) || echo \"pecl ${extension} install error\" \\\n && rm -rf /usr/local/lib/php/doc/$( echo ${extension} | cut -d '-' -f 1 ;) \\\n && rm -rf /usr/local/lib/php/test/$( echo ${extension} | cut -d '-' -f 1 ;) \\\n && rm -rf /usr/local/include/php/ext/$( echo ${extension} | cut -d '-' -f 1 ;) \\\n && strip --strip-all $( php-config --extension-dir ;)/$( echo ${extension} | cut -d '-' -f 1 ;).so ; done \\\n && docker-php-ext-enable opcache \\\n && apt-get purge -y --auto-remove $buildDeps \\\n && rm -rf /tmp/* \\\n && rm -rf /usr/local/lib/php/.registry/.channel.pecl.php.net/* \\\n && mv /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini.default \\\n && mkdir -p /var/log/php-fpm \\\n && ln -sf /dev/stdout /var/log/php-fpm/access.log \\\n && ln -sf /dev/stderr /var/log/php-fpm/error.log \\\n && ln -sf /dev/stderr /var/log/php-fpm/xdebug-remote.log \\\n && chmod -R 777 /var/log/php-fpm\n#   install composer\nENV COMPOSER_ALLOW_SUPERUSER=\"1\" \\\n    COMPOSER_HOME=\"/tmp\" \\\n    COMPOSER_VERSION=\"1.8.6\" \\\n    PS1=\"[\\u@\\h \\w]# \"\n#   https://github.com/composer/docker\nRUN --mount=type=bind,target=/opt/bin/composer,source=/usr/bin/composer,from=arm32v7/composer:1.8.6 echo \"memory_limit=-1\" > \"$PHP_INI_DIR/conf.d/memory-limit.ini\" \\\n && echo \"date.timezone=${PHP_TIMEZONE:-PRC}\" > \"$PHP_INI_DIR/conf.d/date_timezone.ini\" \\\n && curl -fsSL https://raw.githubusercontent.com/composer/docker/master/1.8/docker-entrypoint.sh > /docker-entrypoint.composer.sh \\\n && chmod +x /docker-entrypoint.composer.sh \\\n && cp -a /opt/bin/composer /usr/bin/composer \\\n && composer --ansi --version --no-interaction \\\n && composer config -g repo.packagist composer https://packagist.laravel-china.org \\\n && composer global require --prefer-dist \"laravel/installer\" \\\n && composer global require --prefer-dist \"friendsofphp/php-cs-fixer\" \\\n && curl -fsSL http://get.sensiolabs.org/sami.phar > /usr/local/bin/sami \\\n && chmod +x /usr/local/bin/sami \\\n && ln -sf /tmp/vendor/bin/* /usr/local/bin \\\n && rm -rf /tmp/cache /tmp/installer.php /tmp/*.pub /tmp/composer.lock\nWORKDIR /app\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n","originalDockerfile":"# syntax = docker/dockerfile:experimental\n#  https://sources.debian.org/src/php7.2/7.2.4-1/debian/control/\nARG PHP_VERSION=7.2.19\nFROM --platform=$TARGETPLATFORM php:${PHP_VERSION}-fpm-stretch\nLABEL maintainer=\"khs1994-docker/lnmp <khs1994@khs1994.com>\"\nENV TZ=\"Asia/Shanghai\"\nENV PHP_EXTENSION=\"bcmath  bz2  calendar  enchant  exif  gd  gettext  gmp  imap  intl  mysqli  pcntl  pdo_pgsql  pdo_mysql  pgsql  sockets  sysvmsg  sysvsem  sysvshm  xmlrpc  xsl  zip\"\nENV PECL_EXTENSION=\"mongodb  igbinary  redis  memcached  xdebug  yaml  swoole\"\nARG DEB_URL=deb.debian.org\nARG DEB_SECURITY_URL=security.debian.org/debian-security\nRUN sed -i \"s!deb.debian.org!${DEB_URL}!g\" /etc/apt/sources.list \\\n && sed -i \"s!security.debian.org/debian-security!${DEB_SECURITY_URL}!g\" /etc/apt/sources.list \\\n && set -xe \\\n && buildDeps=\" wget unzip libfreetype6-dev libjpeg62-turbo-dev libpng-dev libsasl2-dev libssl-dev libmemcached-dev libpq-dev libzip-dev zlib1g-dev libyaml-dev libxmlrpc-epi-dev libbz2-dev libexif-dev libgmp-dev libicu-dev libwebp-dev libxpm-dev libenchant-dev libxslt1-dev libc-client2007e-dev libkrb5-dev \" \\\n && runDeps=\" libfreetype6 libjpeg62-turbo libpng16-16 libssl1.1 libmemcached11 libmemcachedutil2 libpq5 libzip4 zlib1g libyaml-0-2 libxslt1.1 libxmlrpc-epi0 libbz2-1.0 libexif12 libgmp10 libicu57 libxpm4 libwebp6 libenchant1c2a libc-client2007e libkrb5-3 \" \\\n && apt-get update \\\n && apt-get install --no-install-recommends $buildDeps $runDeps -y \\\n && rm -r /var/lib/apt/lists/* \\\n && docker-php-ext-configure zip --with-libzip \\\n && docker-php-ext-configure gd --disable-gd-jis-conv --with-freetype-dir=/usr --with-jpeg-dir=/usr --with-png-dir=/usr --with-webp-dir=/usr --with-xpm-dir=/usr \\\n && docker-php-ext-configure imap --with-kerberos --with-imap-ssl \\\n && docker-php-ext-install $PHP_EXTENSION \\\n && for extension in ${PHP_EXTENSION}; do strip --strip-all $( php-config --extension-dir ;)/$( echo ${extension} | cut -d '-' -f 1 ;).so ; done \\\n && for extension in $PECL_EXTENSION; do pecl install $extension \\\n && docker-php-ext-enable $( echo ${extension} | cut -d '-' -f 1 ;) || echo \"pecl ${extension} install error\" \\\n && rm -rf /usr/local/lib/php/doc/$( echo ${extension} | cut -d '-' -f 1 ;) \\\n && rm -rf /usr/local/lib/php/test/$( echo ${extension} | cut -d '-' -f 1 ;) \\\n && rm -rf /usr/local/include/php/ext/$( echo ${extension} | cut -d '-' -f 1 ;) \\\n && strip --strip-all $( php-config --extension-dir ;)/$( echo ${extension} | cut -d '-' -f 1 ;).so ; done \\\n && docker-php-ext-enable opcache \\\n && apt-get purge -y --auto-remove $buildDeps \\\n && rm -rf /tmp/* \\\n && rm -rf /usr/local/lib/php/.registry/.channel.pecl.php.net/* \\\n && mv /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini.default \\\n && mkdir -p /var/log/php-fpm \\\n && ln -sf /dev/stdout /var/log/php-fpm/access.log \\\n && ln -sf /dev/stderr /var/log/php-fpm/error.log \\\n && ln -sf /dev/stderr /var/log/php-fpm/xdebug-remote.log \\\n && chmod -R 777 /var/log/php-fpm\n#  install composer\nENV COMPOSER_ALLOW_SUPERUSER=\"1\" \\\n    COMPOSER_HOME=\"/tmp\" \\\n    COMPOSER_VERSION=\"1.8.6\" \\\n    PS1=\"[\\u@\\h \\w]# \"\n#  https://github.com/composer/docker\nRUN --mount=type=bind,target=/opt/bin/composer,source=/usr/bin/composer,from=arm32v7/composer:1.8.6 echo \"memory_limit=-1\" > \"$PHP_INI_DIR/conf.d/memory-limit.ini\" \\\n && echo \"date.timezone=${PHP_TIMEZONE:-PRC}\" > \"$PHP_INI_DIR/conf.d/date_timezone.ini\" \\\n && curl -fsSL https://raw.githubusercontent.com/composer/docker/master/1.8/docker-entrypoint.sh > /docker-entrypoint.composer.sh \\\n && chmod +x /docker-entrypoint.composer.sh \\\n && cp -a /opt/bin/composer /usr/bin/composer \\\n && composer --ansi --version --no-interaction \\\n && composer config -g repo.packagist composer https://packagist.laravel-china.org \\\n && composer global require --prefer-dist \"laravel/installer\" \\\n && composer global require --prefer-dist \"friendsofphp/php-cs-fixer\" \\\n && curl -fsSL http://get.sensiolabs.org/sami.phar > /usr/local/bin/sami \\\n && chmod +x /usr/local/bin/sami \\\n && ln -sf /tmp/vendor/bin/* /usr/local/bin \\\n && rm -rf /tmp/cache /tmp/installer.php /tmp/*.pub /tmp/composer.lock\nWORKDIR /app\n","injectedSmells":[],"originalDockerfileHash":"17d9ae95816bb7ec829eb93a828a79b3","successfullyInjectedSmells":[],"originalDockerfileUglified":"# syntax = docker/dockerfile:experimental\n#   https://sources.debian.org/src/php7.2/7.2.4-1/debian/control/\nARG PHP_VERSION=7.2.19\nFROM --platform=$TARGETPLATFORM php:${PHP_VERSION}-fpm-stretch\nLABEL maintainer=\"khs1994-docker/lnmp <khs1994@khs1994.com>\"\nENV TZ=\"Asia/Shanghai\"\nENV PHP_EXTENSION=\"bcmath  bz2  calendar  enchant  exif  gd  gettext  gmp  imap  intl  mysqli  pcntl  pdo_pgsql  pdo_mysql  pgsql  sockets  sysvmsg  sysvsem  sysvshm  xmlrpc  xsl  zip\"\nENV PECL_EXTENSION=\"mongodb  igbinary  redis  memcached  xdebug  yaml  swoole\"\nARG DEB_URL=deb.debian.org\nARG DEB_SECURITY_URL=security.debian.org/debian-security\nRUN sed -i \"s!deb.debian.org!${DEB_URL}!g\" /etc/apt/sources.list \\\n && sed -i \"s!security.debian.org/debian-security!${DEB_SECURITY_URL}!g\" /etc/apt/sources.list \\\n && set -xe \\\n && buildDeps=\" wget unzip libfreetype6-dev libjpeg62-turbo-dev libpng-dev libsasl2-dev libssl-dev libmemcached-dev libpq-dev libzip-dev zlib1g-dev libyaml-dev libxmlrpc-epi-dev libbz2-dev libexif-dev libgmp-dev libicu-dev libwebp-dev libxpm-dev libenchant-dev libxslt1-dev libc-client2007e-dev libkrb5-dev \" \\\n && runDeps=\" libfreetype6 libjpeg62-turbo libpng16-16 libssl1.1 libmemcached11 libmemcachedutil2 libpq5 libzip4 zlib1g libyaml-0-2 libxslt1.1 libxmlrpc-epi0 libbz2-1.0 libexif12 libgmp10 libicu57 libxpm4 libwebp6 libenchant1c2a libc-client2007e libkrb5-3 \" \\\n && apt-get update \\\n && apt-get install --no-install-recommends $buildDeps $runDeps -y \\\n && rm -r /var/lib/apt/lists/* \\\n && docker-php-ext-configure zip --with-libzip \\\n && docker-php-ext-configure gd --disable-gd-jis-conv --with-freetype-dir=/usr --with-jpeg-dir=/usr --with-png-dir=/usr --with-webp-dir=/usr --with-xpm-dir=/usr \\\n && docker-php-ext-configure imap --with-kerberos --with-imap-ssl \\\n && docker-php-ext-install $PHP_EXTENSION \\\n && for extension in ${PHP_EXTENSION}; do strip --strip-all $( php-config --extension-dir ;)/$( echo ${extension} | cut -d '-' -f 1 ;).so ; done \\\n && for extension in $PECL_EXTENSION; do pecl install $extension \\\n && docker-php-ext-enable $( echo ${extension} | cut -d '-' -f 1 ;) || echo \"pecl ${extension} install error\" \\\n && rm -rf /usr/local/lib/php/doc/$( echo ${extension} | cut -d '-' -f 1 ;) \\\n && rm -rf /usr/local/lib/php/test/$( echo ${extension} | cut -d '-' -f 1 ;) \\\n && rm -rf /usr/local/include/php/ext/$( echo ${extension} | cut -d '-' -f 1 ;) \\\n && strip --strip-all $( php-config --extension-dir ;)/$( echo ${extension} | cut -d '-' -f 1 ;).so ; done \\\n && docker-php-ext-enable opcache \\\n && apt-get purge -y --auto-remove $buildDeps \\\n && rm -rf /tmp/* \\\n && rm -rf /usr/local/lib/php/.registry/.channel.pecl.php.net/* \\\n && mv /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini.default \\\n && mkdir -p /var/log/php-fpm \\\n && ln -sf /dev/stdout /var/log/php-fpm/access.log \\\n && ln -sf /dev/stderr /var/log/php-fpm/error.log \\\n && ln -sf /dev/stderr /var/log/php-fpm/xdebug-remote.log \\\n && chmod -R 777 /var/log/php-fpm\n#   install composer\nENV COMPOSER_ALLOW_SUPERUSER=\"1\" \\\n    COMPOSER_HOME=\"/tmp\" \\\n    COMPOSER_VERSION=\"1.8.6\" \\\n    PS1=\"[\\u@\\h \\w]# \"\n#   https://github.com/composer/docker\nRUN --mount=type=bind,target=/opt/bin/composer,source=/usr/bin/composer,from=arm32v7/composer:1.8.6 echo \"memory_limit=-1\" > \"$PHP_INI_DIR/conf.d/memory-limit.ini\" \\\n && echo \"date.timezone=${PHP_TIMEZONE:-PRC}\" > \"$PHP_INI_DIR/conf.d/date_timezone.ini\" \\\n && curl -fsSL https://raw.githubusercontent.com/composer/docker/master/1.8/docker-entrypoint.sh > /docker-entrypoint.composer.sh \\\n && chmod +x /docker-entrypoint.composer.sh \\\n && cp -a /opt/bin/composer /usr/bin/composer \\\n && composer --ansi --version --no-interaction \\\n && composer config -g repo.packagist composer https://packagist.laravel-china.org \\\n && composer global require --prefer-dist \"laravel/installer\" \\\n && composer global require --prefer-dist \"friendsofphp/php-cs-fixer\" \\\n && curl -fsSL http://get.sensiolabs.org/sami.phar > /usr/local/bin/sami \\\n && chmod +x /usr/local/bin/sami \\\n && ln -sf /tmp/vendor/bin/* /usr/local/bin \\\n && rm -rf /tmp/cache /tmp/installer.php /tmp/*.pub /tmp/composer.lock\nWORKDIR /app\n","originalDockerfileUglifiedHash":"cecf7ad995ca953387f291a8179e2bb9","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/2b5ca9a19e566514f36ef3f6b9f364d798d29d2a.dockerfile"}