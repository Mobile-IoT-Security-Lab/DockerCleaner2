{"seed":2964958212,"processedDockerfileHash":"4b67c83994938465a2f996b47d64746b","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM debian\nRUN apt-get update \\\n && apt-get install --no-install-recommends openssh-server=1:9.0p1-1ubuntu8 sudo=1.9.13p1-1ubuntu2 procps=2:4.0.3-1ubuntu1 net-tools=2.10-0.1ubuntu3 nano=7.2-1 vim=2:9.0.1000-4ubuntu2 -y\nRUN mkdir /run/sshd\nRUN useradd -m admin\nRUN usermod -a -G sudo admin\nRUN echo \"admin:test\" | chpasswd\nCOPY ./sshkey.pub /home/admin/.ssh/authorized_keys\nEXPOSE 22/tcp\nRUN apt-get install --no-install-recommends rsync=3.2.7-1 -y\nEXPOSE 873/tcp\nRUN echo \" lock file = /var/run/rsync.lock log file = /var/log/rsyncd.log pid file = /var/run/rsyncd.pid \" > /etc/rsyncd.conf\n#  RUN echo \". /root/entrypoint.sh\" >> /root/.profile\n#  RUN echo \". /root/entrypoint.sh\" >> /root/.bashrc\nRUN apt-get install --no-install-recommends nginx=1.22.0-1ubuntu3 -y\nEXPOSE 80/tcp\nEXPOSE 443/tcp\nRUN apt-get install --no-install-recommends php-fpm=2:8.1+92ubuntu1 php-pgsql=2:8.1+92ubuntu1 php-zip=2:8.1+92ubuntu1 php-intl=2:8.1+92ubuntu1 -y\nRUN mkdir /run/php\nRUN apt-get install --no-install-recommends openssl=3.0.8-1ubuntu1\nRUN openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/selfsigned.key -out /etc/ssl/certs/selfsigned.crt -subj '/CN=monsitessl.fr/O=My Company Name LTD./C=US'\nRUN openssl dhparam -out /etc/nginx/dhparam.pem 1024\nRUN echo \" ssl_certificate /etc/ssl/certs/selfsigned.crt; ssl_certificate_key /etc/ssl/private/selfsigned.key;\" > /etc/nginx/snippets/selfsigned.conf\nCOPY ./nginx/ssl/ssl-params.conf /etc/nginx/snippets/ssl-params.conf\nRUN apt-get install --no-install-recommends ufw=0.36.1-4.1 -y\n#  RUN sudo iptables -t filter -F\n#  RUN sudo iptables -t filter -X\n#  RUN ufw enable\n#  RUN ufw default deny ingoing\n#  RUN ufw allow 80\n#  RUN ufw allow 443\n#  RUN ufw allow 22\n#  RUN ufw allow 25\n#  RUN ufw reload\nRUN apt-get install --no-install-recommends fail2ban=1.0.2-1 -y\nRUN mkdir /run/fail2ban\nRUN rm /etc/fail2ban/jail.d/defaults-debian.conf\nCOPY ./fail2ban/jail.local /etc/fail2ban/jail.d/my-jail.conf\nCOPY ./fail2ban/monfiltre.conf /etc/fail2ban/filter.d/monfiltre.conf\nRUN apt-get install --no-install-recommends postgresql=15+248 -y\nRUN useradd -m dev1\n#   Install Postfix.\nRUN echo \"postfix postfix/main_mailer_type string Internet site\" > preseed.txt\nRUN echo \"postfix postfix/mailname string mail.example.com\" >> preseed.txt\n#   Use Mailbox format.\nRUN debconf-set-selections preseed.txt\nRUN DEBIAN_FRONTEND=noninteractive apt-get install -q -y postfix mailutils\nRUN mkdir -p /var/spool/postfix\nRUN DEBIAN_FRONTEND=noninteractive apt-get install -q -y proftpd\nRUN mkdir /run/proftpd\nCOPY ./postgres/init.sh /opt/.init_db.sh\nCOPY ./ufw/init.sh /opt/.init_ufw.sh\nCOPY ./nginx/www /var/www\nCOPY ./nginx/vhost /etc/nginx/sites-available\nRUN ln -s /etc/nginx/sites-available/monsite.fr /etc/nginx/sites-enabled/monsite.fr\nRUN ln -s /etc/nginx/sites-available/monsitephp.fr /etc/nginx/sites-enabled/monsitephp.fr\nRUN ln -s /etc/nginx/sites-available/monsitessl.fr /etc/nginx/sites-enabled/monsitessl.fr\nCOPY ./entrypoint.sh /opt/.entrypoint.sh\nWORKDIR /root\nRUN chmod +x /opt/.entrypoint.sh\nENTRYPOINT [\"/opt/.entrypoint.sh\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM debian\nRUN apt-get update \\\n && apt-get install openssh-server sudo procps net-tools nano vim -y\nRUN mkdir /run/sshd\nRUN useradd -m admin\nRUN usermod -a -G sudo admin\nRUN echo \"admin:test\" | chpasswd\nCOPY ./sshkey.pub /home/admin/.ssh/authorized_keys\nEXPOSE 22/tcp\nRUN apt-get install rsync -y\nEXPOSE 873/tcp\nRUN echo \" lock file = /var/run/rsync.lock log file = /var/log/rsyncd.log pid file = /var/run/rsyncd.pid \" > /etc/rsyncd.conf\n# RUN echo \". /root/entrypoint.sh\" >> /root/.profile\n# RUN echo \". /root/entrypoint.sh\" >> /root/.bashrc\nRUN apt-get install nginx -y\nEXPOSE 80/tcp\nEXPOSE 443/tcp\nRUN apt-get install php-fpm php-pgsql php-zip php-intl -y\nRUN mkdir /run/php\nRUN apt-get install openssl\nRUN openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/selfsigned.key -out /etc/ssl/certs/selfsigned.crt -subj '/CN=monsitessl.fr/O=My Company Name LTD./C=US'\nRUN openssl dhparam -out /etc/nginx/dhparam.pem 1024\nRUN echo \" ssl_certificate /etc/ssl/certs/selfsigned.crt; ssl_certificate_key /etc/ssl/private/selfsigned.key;\" > /etc/nginx/snippets/selfsigned.conf\nCOPY ./nginx/ssl/ssl-params.conf /etc/nginx/snippets/ssl-params.conf\nRUN apt-get install ufw -y\n# RUN sudo iptables -t filter -F\n# RUN sudo iptables -t filter -X\n# RUN ufw enable\n# RUN ufw default deny ingoing\n# RUN ufw allow 80\n# RUN ufw allow 443\n# RUN ufw allow 22\n# RUN ufw allow 25\n# RUN ufw reload\nRUN apt-get install fail2ban -y\nRUN mkdir /run/fail2ban\nRUN rm /etc/fail2ban/jail.d/defaults-debian.conf\nCOPY ./fail2ban/jail.local /etc/fail2ban/jail.d/my-jail.conf\nCOPY ./fail2ban/monfiltre.conf /etc/fail2ban/filter.d/monfiltre.conf\nRUN apt-get install postgresql -y\nRUN useradd -m dev1\n#  Install Postfix.\nRUN echo \"postfix postfix/main_mailer_type string Internet site\" > preseed.txt\nRUN echo \"postfix postfix/mailname string mail.example.com\" >> preseed.txt\n#  Use Mailbox format.\nRUN debconf-set-selections preseed.txt\nRUN DEBIAN_FRONTEND=noninteractive apt-get install -q -y postfix mailutils\nRUN mkdir -p /var/spool/postfix\nRUN DEBIAN_FRONTEND=noninteractive apt-get install -q -y proftpd\nRUN mkdir /run/proftpd\nCOPY ./postgres/init.sh /opt/.init_db.sh\nCOPY ./ufw/init.sh /opt/.init_ufw.sh\nCOPY ./nginx/www /var/www\nCOPY ./nginx/vhost /etc/nginx/sites-available\nRUN ln -s /etc/nginx/sites-available/monsite.fr /etc/nginx/sites-enabled/monsite.fr\nRUN ln -s /etc/nginx/sites-available/monsitephp.fr /etc/nginx/sites-enabled/monsitephp.fr\nRUN ln -s /etc/nginx/sites-available/monsitessl.fr /etc/nginx/sites-enabled/monsitessl.fr\nCOPY ./entrypoint.sh /opt/.entrypoint.sh\nWORKDIR /root\nRUN chmod +x /opt/.entrypoint.sh\nENTRYPOINT [\"/opt/.entrypoint.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"00744aecfb692766b1844505b0b9ac04","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM debian\nRUN apt-get update \\\n && apt-get install openssh-server sudo procps net-tools nano vim -y\nRUN mkdir /run/sshd\nRUN useradd -m admin\nRUN usermod -a -G sudo admin\nRUN echo \"admin:test\" | chpasswd\nCOPY ./sshkey.pub /home/admin/.ssh/authorized_keys\nEXPOSE 22/tcp\nRUN apt-get install rsync -y\nEXPOSE 873/tcp\nRUN echo \" lock file = /var/run/rsync.lock log file = /var/log/rsyncd.log pid file = /var/run/rsyncd.pid \" > /etc/rsyncd.conf\n#  RUN echo \". /root/entrypoint.sh\" >> /root/.profile\n#  RUN echo \". /root/entrypoint.sh\" >> /root/.bashrc\nRUN apt-get install nginx -y\nEXPOSE 80/tcp\nEXPOSE 443/tcp\nRUN apt-get install php-fpm php-pgsql php-zip php-intl -y\nRUN mkdir /run/php\nRUN apt-get install openssl\nRUN openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/selfsigned.key -out /etc/ssl/certs/selfsigned.crt -subj '/CN=monsitessl.fr/O=My Company Name LTD./C=US'\nRUN openssl dhparam -out /etc/nginx/dhparam.pem 1024\nRUN echo \" ssl_certificate /etc/ssl/certs/selfsigned.crt; ssl_certificate_key /etc/ssl/private/selfsigned.key;\" > /etc/nginx/snippets/selfsigned.conf\nCOPY ./nginx/ssl/ssl-params.conf /etc/nginx/snippets/ssl-params.conf\nRUN apt-get install ufw -y\n#  RUN sudo iptables -t filter -F\n#  RUN sudo iptables -t filter -X\n#  RUN ufw enable\n#  RUN ufw default deny ingoing\n#  RUN ufw allow 80\n#  RUN ufw allow 443\n#  RUN ufw allow 22\n#  RUN ufw allow 25\n#  RUN ufw reload\nRUN apt-get install fail2ban -y\nRUN mkdir /run/fail2ban\nRUN rm /etc/fail2ban/jail.d/defaults-debian.conf\nCOPY ./fail2ban/jail.local /etc/fail2ban/jail.d/my-jail.conf\nCOPY ./fail2ban/monfiltre.conf /etc/fail2ban/filter.d/monfiltre.conf\nRUN apt-get install postgresql -y\nRUN useradd -m dev1\n#   Install Postfix.\nRUN echo \"postfix postfix/main_mailer_type string Internet site\" > preseed.txt\nRUN echo \"postfix postfix/mailname string mail.example.com\" >> preseed.txt\n#   Use Mailbox format.\nRUN debconf-set-selections preseed.txt\nRUN DEBIAN_FRONTEND=noninteractive apt-get install -q -y postfix mailutils\nRUN mkdir -p /var/spool/postfix\nRUN DEBIAN_FRONTEND=noninteractive apt-get install -q -y proftpd\nRUN mkdir /run/proftpd\nCOPY ./postgres/init.sh /opt/.init_db.sh\nCOPY ./ufw/init.sh /opt/.init_ufw.sh\nCOPY ./nginx/www /var/www\nCOPY ./nginx/vhost /etc/nginx/sites-available\nRUN ln -s /etc/nginx/sites-available/monsite.fr /etc/nginx/sites-enabled/monsite.fr\nRUN ln -s /etc/nginx/sites-available/monsitephp.fr /etc/nginx/sites-enabled/monsitephp.fr\nRUN ln -s /etc/nginx/sites-available/monsitessl.fr /etc/nginx/sites-enabled/monsitessl.fr\nCOPY ./entrypoint.sh /opt/.entrypoint.sh\nWORKDIR /root\nRUN chmod +x /opt/.entrypoint.sh\nENTRYPOINT [\"/opt/.entrypoint.sh\"]\n","originalDockerfileUglifiedHash":"a65cbde2e2a6e4af46038fb70c90f0f7","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/69a2957aa5820f27b06af4cbddbcd6425d43ba9c.dockerfile"}