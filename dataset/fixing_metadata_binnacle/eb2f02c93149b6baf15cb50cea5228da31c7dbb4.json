{"seed":1206769694,"processedDockerfileHash":"cf811a4b834f99dd855ddd1123eb7c11","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","use-copy-instead-of-add","do-not-have-secrets","have-a-user"],"processedDockerfile":"FROM continuumio/miniconda3\n#  ##############\n#   ENVIRONMENT #\n#  ##############\n# A secret has been removed here. Please do not provide secrets from the Dockerfile as these will leak into the metadata of the resulting docker image. To provide secrets the --secret flag of the docker build command can be used (https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information).\nENV TETHYS_HOME=\"/usr/lib/tethys\" \\\n    TETHYS_PORT=\"8000\" \\\n    TETHYS_PUBLIC_HOST=\"127.0.0.1\" \\\n    TETHYS_DB_USERNAME=\"tethys_default\" \\\n    TETHYS_DB_HOST=\"db\" \\\n    TETHYS_DB_PORT=\"5432\" \\\n    TETHYS_SUPER_USER=\"\" \\\n    TETHYS_SUPER_USER_EMAIL=\"\" \\\n    TETHYS_SUPER_USER_PASS=\"\"\n#   Misc\nENV ALLOWED_HOSTS=\"\\\"['localhost', '127.0.0.1']\\\"\" \\\n    BASH_PROFILE=\".bashrc\" \\\n    CONDA_HOME=\"/opt/conda\" \\\n    CONDA_ENV_NAME=\"tethys\" \\\n    ASGI_PROCESSES=\"4\" \\\n    CLIENT_MAX_BODY_SIZE=\"75M\"\n#  ########\n#   SETUP #\n#  ########\nRUN mkdir -p \"${TETHYS_HOME}/src\"\nWORKDIR ${TETHYS_HOME}\n#   Speed up APT installs\nRUN echo \"force-unsafe-io\" > /etc/dpkg/dpkg.cfg.d/02apt-speedup; echo \"Acquire::http {No-Cache=True;};\" > /etc/apt/apt.conf.d/no-cache\n#   Install APT packages\nRUN apt-get update \\\n && apt-get install --no-install-recommends wget=1.21.3-1ubuntu1 gnupg2=2.2.40-1ubuntu2 -y \\\n && wget -O - https://repo.saltstack.com/apt/debian/9/amd64/latest/SALTSTACK-GPG-KEY.pub | apt-key add - \\\n && echo \"deb http://repo.saltstack.com/apt/debian/9/amd64/latest stretch main\" > /etc/apt/sources.list.d/saltstack.list\nRUN apt-get update \\\n && apt-get install --no-install-recommends bzip2=1.0.8-5build1 git=1:2.39.2-1ubuntu1 nginx=1.22.0-1ubuntu3 supervisor=4.2.1-1ubuntu1 gcc=4:12.2.0-3ubuntu1 salt-minion procps=2:4.0.3-1ubuntu1 pv=1.6.20-1 -y\nRUN rm -f /etc/nginx/sites-enabled/default\n#   Setup Conda Environment\nCOPY environment.yml ${TETHYS_HOME}/src/\nWORKDIR ${TETHYS_HOME}/src\nRUN ${CONDA_HOME}/bin/conda env create -n \"${CONDA_ENV_NAME}\" -f \"environment.yml\"\n#  ##########\n#   INSTALL #\n#  ##########\n#  Setup Nginx User:\nRUN groupadd www ; useradd -r -u 1011 -g www www ; sed -i 's/^user.*/user www www;/' /etc/nginx/nginx.conf\n#   ADD files from repo\nCOPY --chown=www:www resources ${TETHYS_HOME}/src/resources/\nCOPY --chown=www:www templates ${TETHYS_HOME}/src/templates/\nCOPY --chown=www:www tethys_apps ${TETHYS_HOME}/src/tethys_apps/\nCOPY --chown=www:www tethys_compute ${TETHYS_HOME}/src/tethys_compute/\nCOPY --chown=www:www tethys_config ${TETHYS_HOME}/src/tethys_config/\nCOPY --chown=www:www tethys_gizmos ${TETHYS_HOME}/src/tethys_gizmos/\nCOPY --chown=www:www tethys_portal ${TETHYS_HOME}/src/tethys_portal/\nCOPY --chown=www:www tethys_quotas ${TETHYS_HOME}/src/tethys_quotas/\nCOPY --chown=www:www tethys_sdk ${TETHYS_HOME}/src/tethys_sdk/\nCOPY --chown=www:www tethys_services ${TETHYS_HOME}/src/tethys_services/\nCOPY --chown=www:www README.rst ${TETHYS_HOME}/src/\nCOPY --chown=www:www *.py ${TETHYS_HOME}/src/\n#   Remove any apps that may have been installed in tethysapp\nRUN rm -rf ${TETHYS_HOME}/src/tethys_apps/tethysapp ; mkdir -p ${TETHYS_HOME}/src/tethys_apps/tethysapp\nCOPY --chown=www:www tethys_apps/tethysapp/__init__.py ${TETHYS_HOME}/src/tethys_apps/tethysapp/\n#   Run Installer\nRUN /bin/bash -c '. ${CONDA_HOME}/bin/activate ${CONDA_ENV_NAME} ; python setup.py develop'\nRUN mkdir ${TETHYS_HOME}/workspaces ${TETHYS_HOME}/apps ${TETHYS_HOME}/static\n#   Add static files\nCOPY --chown=www:www static ${TETHYS_HOME}/src/static/\n#   Generate Inital Settings Files\nRUN /bin/bash -c '. ${CONDA_HOME}/bin/activate ${CONDA_ENV_NAME} ; tethys gen settings --production --allowed-host \"${ALLOWED_HOSTS}\" --db-username ${TETHYS_DB_USERNAME} --db-password ${TETHYS_DB_PASSWORD} --db-port ${TETHYS_DB_PORT} --overwrite ; sed -i -e \"s:#TETHYS_WORKSPACES_ROOT = .*$:TETHYS_WORKSPACES_ROOT = \\\"/usr/lib/tethys/workspaces\\\":\" ${TETHYS_HOME}/src/tethys_portal/settings.py ; tethys gen nginx --overwrite ; tethys gen nginx_service --overwrite ; tethys gen asgi_service --overwrite ; tethys manage collectstatic'\n#  ###########\n#   CLEAN UP #\n#  ###########\nRUN apt-get -y remove wget gcc gnupg2 ; apt-get -y autoremove ; apt-get -y clean\n#  ########################\n#   CONFIGURE  ENVIRONMENT#\n#  ########################\nENV PATH=\"${CONDA_HOME}/miniconda/envs/tethys/bin:$PATH \"\nVOLUME [\"${TETHYS_HOME}/workspaces\", \"${TETHYS_HOME}/keys\"]\nEXPOSE 80/tcp\n#  ##############*\n#   COPY IN SALT #\n#  ##############*\nCOPY docker/salt/ /srv/salt/\nCOPY docker/run.sh ${TETHYS_HOME}/\n#  #######\n#   RUN! #\n#  #######\nWORKDIR ${TETHYS_HOME}\n#   Create Salt configuration based on ENVs\nCMD bash run.sh\nHEALTHCHECK --start-period=240s CMD ps $( cat $( grep 'pidfile=.*' /etc/supervisor/supervisord.conf | awk -F'=' '{print $2}' | awk '{print $1}' ;) ;) > /dev/null\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n","originalDockerfile":"FROM continuumio/miniconda3\n# ##############\n#  ENVIRONMENT #\n# ##############\nENV TETHYS_HOME=\"/usr/lib/tethys\" \\\n    TETHYS_PORT=\"8000\" \\\n    TETHYS_PUBLIC_HOST=\"127.0.0.1\" \\\n    TETHYS_DB_USERNAME=\"tethys_default\" \\\n    TETHYS_DB_PASSWORD=\"pass\" \\\n    TETHYS_DB_HOST=\"db\" \\\n    TETHYS_DB_PORT=\"5432\" \\\n    TETHYS_SUPER_USER=\"\" \\\n    TETHYS_SUPER_USER_EMAIL=\"\" \\\n    TETHYS_SUPER_USER_PASS=\"\"\n#  Misc\nENV ALLOWED_HOSTS=\"\\\"['localhost', '127.0.0.1']\\\"\" \\\n    BASH_PROFILE=\".bashrc\" \\\n    CONDA_HOME=\"/opt/conda\" \\\n    CONDA_ENV_NAME=\"tethys\" \\\n    ASGI_PROCESSES=\"4\" \\\n    CLIENT_MAX_BODY_SIZE=\"75M\"\n# ########\n#  SETUP #\n# ########\nRUN mkdir -p \"${TETHYS_HOME}/src\"\nWORKDIR ${TETHYS_HOME}\n#  Speed up APT installs\nRUN echo \"force-unsafe-io\" > /etc/dpkg/dpkg.cfg.d/02apt-speedup; echo \"Acquire::http {No-Cache=True;};\" > /etc/apt/apt.conf.d/no-cache\n#  Install APT packages\nRUN apt-get update \\\n && apt-get install wget gnupg2 -y \\\n && wget -O - https://repo.saltstack.com/apt/debian/9/amd64/latest/SALTSTACK-GPG-KEY.pub | apt-key add - \\\n && echo \"deb http://repo.saltstack.com/apt/debian/9/amd64/latest stretch main\" > /etc/apt/sources.list.d/saltstack.list\nRUN apt-get update \\\n && apt-get install bzip2 git nginx supervisor gcc salt-minion procps pv -y\nRUN rm -f /etc/nginx/sites-enabled/default\n#  Setup Conda Environment\nADD environment.yml ${TETHYS_HOME}/src/\nWORKDIR ${TETHYS_HOME}/src\nRUN ${CONDA_HOME}/bin/conda env create -n \"${CONDA_ENV_NAME}\" -f \"environment.yml\"\n# ##########\n#  INSTALL #\n# ##########\n# Setup Nginx User:\nRUN groupadd www ; useradd -r -u 1011 -g www www ; sed -i 's/^user.*/user www www;/' /etc/nginx/nginx.conf\n#  ADD files from repo\nADD --chown=www:www resources ${TETHYS_HOME}/src/resources/\nADD --chown=www:www templates ${TETHYS_HOME}/src/templates/\nADD --chown=www:www tethys_apps ${TETHYS_HOME}/src/tethys_apps/\nADD --chown=www:www tethys_compute ${TETHYS_HOME}/src/tethys_compute/\nADD --chown=www:www tethys_config ${TETHYS_HOME}/src/tethys_config/\nADD --chown=www:www tethys_gizmos ${TETHYS_HOME}/src/tethys_gizmos/\nADD --chown=www:www tethys_portal ${TETHYS_HOME}/src/tethys_portal/\nADD --chown=www:www tethys_quotas ${TETHYS_HOME}/src/tethys_quotas/\nADD --chown=www:www tethys_sdk ${TETHYS_HOME}/src/tethys_sdk/\nADD --chown=www:www tethys_services ${TETHYS_HOME}/src/tethys_services/\nADD --chown=www:www README.rst ${TETHYS_HOME}/src/\nADD --chown=www:www *.py ${TETHYS_HOME}/src/\n#  Remove any apps that may have been installed in tethysapp\nRUN rm -rf ${TETHYS_HOME}/src/tethys_apps/tethysapp ; mkdir -p ${TETHYS_HOME}/src/tethys_apps/tethysapp\nADD --chown=www:www tethys_apps/tethysapp/__init__.py ${TETHYS_HOME}/src/tethys_apps/tethysapp/\n#  Run Installer\nRUN /bin/bash -c '. ${CONDA_HOME}/bin/activate ${CONDA_ENV_NAME} ; python setup.py develop'\nRUN mkdir ${TETHYS_HOME}/workspaces ${TETHYS_HOME}/apps ${TETHYS_HOME}/static\n#  Add static files\nADD --chown=www:www static ${TETHYS_HOME}/src/static/\n#  Generate Inital Settings Files\nRUN /bin/bash -c '. ${CONDA_HOME}/bin/activate ${CONDA_ENV_NAME} ; tethys gen settings --production --allowed-host \"${ALLOWED_HOSTS}\" --db-username ${TETHYS_DB_USERNAME} --db-password ${TETHYS_DB_PASSWORD} --db-port ${TETHYS_DB_PORT} --overwrite ; sed -i -e \"s:#TETHYS_WORKSPACES_ROOT = .*$:TETHYS_WORKSPACES_ROOT = \\\"/usr/lib/tethys/workspaces\\\":\" ${TETHYS_HOME}/src/tethys_portal/settings.py ; tethys gen nginx --overwrite ; tethys gen nginx_service --overwrite ; tethys gen asgi_service --overwrite ; tethys manage collectstatic'\n# ###########\n#  CLEAN UP #\n# ###########\nRUN apt-get -y remove wget gcc gnupg2 ; apt-get -y autoremove ; apt-get -y clean\n# ########################\n#  CONFIGURE  ENVIRONMENT#\n# ########################\nENV PATH=\"${CONDA_HOME}/miniconda/envs/tethys/bin:$PATH \"\nVOLUME [\"${TETHYS_HOME}/workspaces\", \"${TETHYS_HOME}/keys\"]\nEXPOSE 80/tcp\n# ##############*\n#  COPY IN SALT #\n# ##############*\nADD docker/salt/ /srv/salt/\nADD docker/run.sh ${TETHYS_HOME}/\n# #######\n#  RUN! #\n# #######\nWORKDIR ${TETHYS_HOME}\n#  Create Salt configuration based on ENVs\nCMD bash run.sh\nHEALTHCHECK --start-period=240s CMD ps $( cat $( grep 'pidfile=.*' /etc/supervisor/supervisord.conf | awk -F'=' '{print $2}' | awk '{print $1}' ;) ;) > /dev/null\n","injectedSmells":[],"originalDockerfileHash":"64ed7f0f0a0ec52e5308463d47edd81e","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM continuumio/miniconda3\n#  ##############\n#   ENVIRONMENT #\n#  ##############\nENV TETHYS_HOME=\"/usr/lib/tethys\" \\\n    TETHYS_PORT=\"8000\" \\\n    TETHYS_PUBLIC_HOST=\"127.0.0.1\" \\\n    TETHYS_DB_USERNAME=\"tethys_default\" \\\n    TETHYS_DB_PASSWORD=\"pass\" \\\n    TETHYS_DB_HOST=\"db\" \\\n    TETHYS_DB_PORT=\"5432\" \\\n    TETHYS_SUPER_USER=\"\" \\\n    TETHYS_SUPER_USER_EMAIL=\"\" \\\n    TETHYS_SUPER_USER_PASS=\"\"\n#   Misc\nENV ALLOWED_HOSTS=\"\\\"['localhost', '127.0.0.1']\\\"\" \\\n    BASH_PROFILE=\".bashrc\" \\\n    CONDA_HOME=\"/opt/conda\" \\\n    CONDA_ENV_NAME=\"tethys\" \\\n    ASGI_PROCESSES=\"4\" \\\n    CLIENT_MAX_BODY_SIZE=\"75M\"\n#  ########\n#   SETUP #\n#  ########\nRUN mkdir -p \"${TETHYS_HOME}/src\"\nWORKDIR ${TETHYS_HOME}\n#   Speed up APT installs\nRUN echo \"force-unsafe-io\" > /etc/dpkg/dpkg.cfg.d/02apt-speedup; echo \"Acquire::http {No-Cache=True;};\" > /etc/apt/apt.conf.d/no-cache\n#   Install APT packages\nRUN apt-get update \\\n && apt-get install wget gnupg2 -y \\\n && wget -O - https://repo.saltstack.com/apt/debian/9/amd64/latest/SALTSTACK-GPG-KEY.pub | apt-key add - \\\n && echo \"deb http://repo.saltstack.com/apt/debian/9/amd64/latest stretch main\" > /etc/apt/sources.list.d/saltstack.list\nRUN apt-get update \\\n && apt-get install bzip2 git nginx supervisor gcc salt-minion procps pv -y\nRUN rm -f /etc/nginx/sites-enabled/default\n#   Setup Conda Environment\nADD environment.yml ${TETHYS_HOME}/src/\nWORKDIR ${TETHYS_HOME}/src\nRUN ${CONDA_HOME}/bin/conda env create -n \"${CONDA_ENV_NAME}\" -f \"environment.yml\"\n#  ##########\n#   INSTALL #\n#  ##########\n#  Setup Nginx User:\nRUN groupadd www ; useradd -r -u 1011 -g www www ; sed -i 's/^user.*/user www www;/' /etc/nginx/nginx.conf\n#   ADD files from repo\nADD --chown=www:www resources ${TETHYS_HOME}/src/resources/\nADD --chown=www:www templates ${TETHYS_HOME}/src/templates/\nADD --chown=www:www tethys_apps ${TETHYS_HOME}/src/tethys_apps/\nADD --chown=www:www tethys_compute ${TETHYS_HOME}/src/tethys_compute/\nADD --chown=www:www tethys_config ${TETHYS_HOME}/src/tethys_config/\nADD --chown=www:www tethys_gizmos ${TETHYS_HOME}/src/tethys_gizmos/\nADD --chown=www:www tethys_portal ${TETHYS_HOME}/src/tethys_portal/\nADD --chown=www:www tethys_quotas ${TETHYS_HOME}/src/tethys_quotas/\nADD --chown=www:www tethys_sdk ${TETHYS_HOME}/src/tethys_sdk/\nADD --chown=www:www tethys_services ${TETHYS_HOME}/src/tethys_services/\nADD --chown=www:www README.rst ${TETHYS_HOME}/src/\nADD --chown=www:www *.py ${TETHYS_HOME}/src/\n#   Remove any apps that may have been installed in tethysapp\nRUN rm -rf ${TETHYS_HOME}/src/tethys_apps/tethysapp ; mkdir -p ${TETHYS_HOME}/src/tethys_apps/tethysapp\nADD --chown=www:www tethys_apps/tethysapp/__init__.py ${TETHYS_HOME}/src/tethys_apps/tethysapp/\n#   Run Installer\nRUN /bin/bash -c '. ${CONDA_HOME}/bin/activate ${CONDA_ENV_NAME} ; python setup.py develop'\nRUN mkdir ${TETHYS_HOME}/workspaces ${TETHYS_HOME}/apps ${TETHYS_HOME}/static\n#   Add static files\nADD --chown=www:www static ${TETHYS_HOME}/src/static/\n#   Generate Inital Settings Files\nRUN /bin/bash -c '. ${CONDA_HOME}/bin/activate ${CONDA_ENV_NAME} ; tethys gen settings --production --allowed-host \"${ALLOWED_HOSTS}\" --db-username ${TETHYS_DB_USERNAME} --db-password ${TETHYS_DB_PASSWORD} --db-port ${TETHYS_DB_PORT} --overwrite ; sed -i -e \"s:#TETHYS_WORKSPACES_ROOT = .*$:TETHYS_WORKSPACES_ROOT = \\\"/usr/lib/tethys/workspaces\\\":\" ${TETHYS_HOME}/src/tethys_portal/settings.py ; tethys gen nginx --overwrite ; tethys gen nginx_service --overwrite ; tethys gen asgi_service --overwrite ; tethys manage collectstatic'\n#  ###########\n#   CLEAN UP #\n#  ###########\nRUN apt-get -y remove wget gcc gnupg2 ; apt-get -y autoremove ; apt-get -y clean\n#  ########################\n#   CONFIGURE  ENVIRONMENT#\n#  ########################\nENV PATH=\"${CONDA_HOME}/miniconda/envs/tethys/bin:$PATH \"\nVOLUME [\"${TETHYS_HOME}/workspaces\", \"${TETHYS_HOME}/keys\"]\nEXPOSE 80/tcp\n#  ##############*\n#   COPY IN SALT #\n#  ##############*\nADD docker/salt/ /srv/salt/\nADD docker/run.sh ${TETHYS_HOME}/\n#  #######\n#   RUN! #\n#  #######\nWORKDIR ${TETHYS_HOME}\n#   Create Salt configuration based on ENVs\nCMD bash run.sh\nHEALTHCHECK --start-period=240s CMD ps $( cat $( grep 'pidfile=.*' /etc/supervisor/supervisord.conf | awk -F'=' '{print $2}' | awk '{print $1}' ;) ;) > /dev/null\n","originalDockerfileUglifiedHash":"c3402f15119c8b9f6d579c98dd761949","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/eb2f02c93149b6baf15cb50cea5228da31c7dbb4.dockerfile"}