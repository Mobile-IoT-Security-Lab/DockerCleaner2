{"seed":3987722040,"processedDockerfileHash":"f4ab129f32d7ac77adc58b40a5d183e9","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-pip","have-a-healthcheck"],"processedDockerfile":"FROM quay.io/mapstory/python-gdal:2.7.x-2.2.x\nLABEL maintainer=\"Tyler Battle <tbattle@boundlessgeo.com>\"\nENV MEDIA_ROOT=\"/var/lib/mapstory/media\"\nENV STATIC_ROOT=\"/var/lib/mapstory/static\"\nENV APP_PATH=\"/srv/mapstory\"\nENV TMP=\"/tmp\"\nENV DJANGO_PORT=\"8000\"\nENV PYTHONUNBUFFERED=\"0\"\nENV MISSING_THUMBNAIL=\"/static/mapstory/img/missing_thumb.png\"\nWORKDIR $TMP\n#   Add CA cert for self signing\nCOPY docker/nginx/ca.crt /usr/local/share/ca-certificates/\nCOPY docker/nginx/cacerts/Certificates_v5.3_DoD.pem.crt /usr/local/share/ca-certificates/\nCOPY docker/nginx/cacerts/comodorsacertificationauthority.crt /usr/local/share/ca-certificates/\nCOPY docker/nginx/cacerts/comodorsadomainvalidationsecureserverca.crt /usr/local/share/ca-certificates/\nRUN set -ex \\\n && update-ca-certificates\n#   Install tools\nRUN set -ex \\\n && apt-get update \\\n && apt-get install --no-install-recommends unzip -y \\\n && rm -rf /var/lib/apt/lists/*\n#   Install WSGI server and python tools\nRUN set -ex \\\n && pip install coveralls==3.3.1 gunicorn==20.1.0 paver==1.3.4 pycodestyle==2.10.0 \"pylint>=1.9,<2\" \"pylint-django>=0.11.1,<2\" --no-cache-dir\n#   Install misc libs\nRUN set -ex \\\n && apt-get update \\\n && apt-get install --no-install-recommends libgeos-dev libjpeg-dev libxml2-dev -y \\\n && rm -rf /var/lib/apt/lists/*\n#   Install phantomjs\nENV QT_QPA_PLATFORM=\"minimal\"\nRUN set -ex \\\n && echo \"deb http://ftp.debian.org/debian jessie-backports main\" >> /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends phantomjs -y \\\n && rm -rf /var/lib/apt/lists/*\n#   Install Node and related tools\nRUN set -ex \\\n && curl -sL https://deb.nodesource.com/setup_6.x | /bin/bash - \\\n && curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \\\n && echo \"deb https://dl.yarnpkg.com/debian/ stable main\" | tee /etc/apt/sources.list.d/yarn.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends nodejs yarn -y \\\n && yarn global add bower grunt gulp-cli webpack@^3.10.0 \\\n && yarn cache clean \\\n && rm -rf /var/lib/apt/lists/*\n#  RUN mkdir -p $MEDIA_ROOT && chown www-data $MEDIA_ROOT\n#  RUN mkdir -p $STATIC_ROOT && chown www-data $STATIC_ROOT\n#   Setup user and paths\nRUN set -ex \\\n && adduser --disabled-password --gecos '' mapstory \\\n && mkdir -p $APP_PATH/deps \\\n && chown -R mapstory $APP_PATH \\\n && mkdir -p $MEDIA_ROOT \\\n && chown mapstory $MEDIA_ROOT \\\n && mkdir -p $STATIC_ROOT \\\n && chown mapstory $STATIC_ROOT\nWORKDIR $APP_PATH\nRUN pip install celery==4.1.0\n#   Copy in dependencies\nCOPY --chown=mapstory:mapstory deps ./deps\n#   Install dependencies from requirements.txt\nCOPY --chown=mapstory:mapstory requirements.txt ./\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY epsg_extra /usr/local/lib/python2.7/dist-packages/pyproj/data/\n#   The httplib2 python library uses its own CA certificates.\n#   Add the system and self-signed CAs.\nRUN cat /etc/ssl/certs/ca-certificates.crt >> /usr/local/lib/python2.7/site-packages/httplib2/cacerts.txt\n#   Override the version of awesome-slugify\n#   Using HEAD as of 2018-01-09\n#   The version isn't changed, so it has trouble differentiation from the version in pypy. Thus this manual update.\nRUN pip install git+git://github.com/dimka665/awesome-slugify@a6563949965bcddd976b7b3fb0babf76e3b490f7#egg==wesome-slugify --no-cache-dir -U\n#   Copy in the code\nCOPY --chown=mapstory:mapstory mapstory ./mapstory\nCOPY --chown=mapstory:mapstory ./*.py ./\nCOPY --chown=mapstory:mapstory docker/django/run.sh $APP_PATH/docker/django/\nRUN ln -s $APP_PATH/docker/django/run.sh /opt/run.sh\nRUN set -ex \\\n && chown -R mapstory:mapstory $STATIC_ROOT \\\n && chown -R mapstory:mapstory $MEDIA_ROOT \\\n && mkdir -p $APP_PATH/cover \\\n && chown -R mapstory:mapstory $APP_PATH/cover\nUSER mapstory\nWORKDIR $APP_PATH/mapstory/static\nRUN set -ex \\\n && /opt/run.sh --collect-static \\\n && yarn cache clean \\\n && rm -rf ~/.cache/bower \\\n && rm -rf /tmp/phantomjs\nWORKDIR $APP_PATH\nVOLUME $STATIC_ROOT\nVOLUME $MEDIA_ROOT\nVOLUME $APP_PATH/cover\nEXPOSE $DJANGO_PORT\nENTRYPOINT [\"/opt/run.sh\"]\nCMD [\"--init-db\", \"--reindex\", \"--serve\"]\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM quay.io/mapstory/python-gdal:2.7.x-2.2.x\nLABEL maintainer=\"Tyler Battle <tbattle@boundlessgeo.com>\"\nENV MEDIA_ROOT=\"/var/lib/mapstory/media\"\nENV STATIC_ROOT=\"/var/lib/mapstory/static\"\nENV APP_PATH=\"/srv/mapstory\"\nENV TMP=\"/tmp\"\nENV DJANGO_PORT=\"8000\"\nENV PYTHONUNBUFFERED=\"0\"\nENV MISSING_THUMBNAIL=\"/static/mapstory/img/missing_thumb.png\"\nWORKDIR $TMP\n#  Add CA cert for self signing\nCOPY docker/nginx/ca.crt /usr/local/share/ca-certificates/\nCOPY docker/nginx/cacerts/Certificates_v5.3_DoD.pem.crt /usr/local/share/ca-certificates/\nCOPY docker/nginx/cacerts/comodorsacertificationauthority.crt /usr/local/share/ca-certificates/\nCOPY docker/nginx/cacerts/comodorsadomainvalidationsecureserverca.crt /usr/local/share/ca-certificates/\nRUN set -ex \\\n && update-ca-certificates\n#  Install tools\nRUN set -ex \\\n && apt-get update \\\n && apt-get install --no-install-recommends unzip -y \\\n && rm -rf /var/lib/apt/lists/*\n#  Install WSGI server and python tools\nRUN set -ex \\\n && pip install coveralls gunicorn paver pycodestyle \"pylint>=1.9,<2\" \"pylint-django>=0.11.1,<2\" --no-cache-dir\n#  Install misc libs\nRUN set -ex \\\n && apt-get update \\\n && apt-get install --no-install-recommends libgeos-dev libjpeg-dev libxml2-dev -y \\\n && rm -rf /var/lib/apt/lists/*\n#  Install phantomjs\nENV QT_QPA_PLATFORM=\"minimal\"\nRUN set -ex \\\n && echo \"deb http://ftp.debian.org/debian jessie-backports main\" >> /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends phantomjs -y \\\n && rm -rf /var/lib/apt/lists/*\n#  Install Node and related tools\nRUN set -ex \\\n && curl -sL https://deb.nodesource.com/setup_6.x | /bin/bash - \\\n && curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \\\n && echo \"deb https://dl.yarnpkg.com/debian/ stable main\" | tee /etc/apt/sources.list.d/yarn.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends nodejs yarn -y \\\n && yarn global add bower grunt gulp-cli webpack@^3.10.0 \\\n && yarn cache clean \\\n && rm -rf /var/lib/apt/lists/*\n# RUN mkdir -p $MEDIA_ROOT && chown www-data $MEDIA_ROOT\n# RUN mkdir -p $STATIC_ROOT && chown www-data $STATIC_ROOT\n#  Setup user and paths\nRUN set -ex \\\n && adduser --disabled-password --gecos '' mapstory \\\n && mkdir -p $APP_PATH/deps \\\n && chown -R mapstory $APP_PATH \\\n && mkdir -p $MEDIA_ROOT \\\n && chown mapstory $MEDIA_ROOT \\\n && mkdir -p $STATIC_ROOT \\\n && chown mapstory $STATIC_ROOT\nWORKDIR $APP_PATH\nRUN pip install celery==4.1.0\n#  Copy in dependencies\nCOPY --chown=mapstory:mapstory deps ./deps\n#  Install dependencies from requirements.txt\nCOPY --chown=mapstory:mapstory requirements.txt ./\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY epsg_extra /usr/local/lib/python2.7/dist-packages/pyproj/data/\n#  The httplib2 python library uses its own CA certificates.\n#  Add the system and self-signed CAs.\nRUN cat /etc/ssl/certs/ca-certificates.crt >> /usr/local/lib/python2.7/site-packages/httplib2/cacerts.txt\n#  Override the version of awesome-slugify\n#  Using HEAD as of 2018-01-09\n#  The version isn't changed, so it has trouble differentiation from the version in pypy. Thus this manual update.\nRUN pip install git+git://github.com/dimka665/awesome-slugify@a6563949965bcddd976b7b3fb0babf76e3b490f7#egg==wesome-slugify --no-cache-dir -U\n#  Copy in the code\nCOPY --chown=mapstory:mapstory mapstory ./mapstory\nCOPY --chown=mapstory:mapstory ./*.py ./\nCOPY --chown=mapstory:mapstory docker/django/run.sh $APP_PATH/docker/django/\nRUN ln -s $APP_PATH/docker/django/run.sh /opt/run.sh\nRUN set -ex \\\n && chown -R mapstory:mapstory $STATIC_ROOT \\\n && chown -R mapstory:mapstory $MEDIA_ROOT \\\n && mkdir -p $APP_PATH/cover \\\n && chown -R mapstory:mapstory $APP_PATH/cover\nUSER mapstory\nWORKDIR $APP_PATH/mapstory/static\nRUN set -ex \\\n && /opt/run.sh --collect-static \\\n && yarn cache clean \\\n && rm -rf ~/.cache/bower \\\n && rm -rf /tmp/phantomjs\nWORKDIR $APP_PATH\nVOLUME $STATIC_ROOT\nVOLUME $MEDIA_ROOT\nVOLUME $APP_PATH/cover\nEXPOSE $DJANGO_PORT\nENTRYPOINT [\"/opt/run.sh\"]\nCMD [\"--init-db\", \"--reindex\", \"--serve\"]\n","injectedSmells":[],"originalDockerfileHash":"69533f3bc941862627bd78eaedafcf38","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM quay.io/mapstory/python-gdal:2.7.x-2.2.x\nLABEL maintainer=\"Tyler Battle <tbattle@boundlessgeo.com>\"\nENV MEDIA_ROOT=\"/var/lib/mapstory/media\"\nENV STATIC_ROOT=\"/var/lib/mapstory/static\"\nENV APP_PATH=\"/srv/mapstory\"\nENV TMP=\"/tmp\"\nENV DJANGO_PORT=\"8000\"\nENV PYTHONUNBUFFERED=\"0\"\nENV MISSING_THUMBNAIL=\"/static/mapstory/img/missing_thumb.png\"\nWORKDIR $TMP\n#   Add CA cert for self signing\nCOPY docker/nginx/ca.crt /usr/local/share/ca-certificates/\nCOPY docker/nginx/cacerts/Certificates_v5.3_DoD.pem.crt /usr/local/share/ca-certificates/\nCOPY docker/nginx/cacerts/comodorsacertificationauthority.crt /usr/local/share/ca-certificates/\nCOPY docker/nginx/cacerts/comodorsadomainvalidationsecureserverca.crt /usr/local/share/ca-certificates/\nRUN set -ex \\\n && update-ca-certificates\n#   Install tools\nRUN set -ex \\\n && apt-get update \\\n && apt-get install --no-install-recommends unzip -y \\\n && rm -rf /var/lib/apt/lists/*\n#   Install WSGI server and python tools\nRUN set -ex \\\n && pip install coveralls gunicorn paver pycodestyle \"pylint>=1.9,<2\" \"pylint-django>=0.11.1,<2\" --no-cache-dir\n#   Install misc libs\nRUN set -ex \\\n && apt-get update \\\n && apt-get install --no-install-recommends libgeos-dev libjpeg-dev libxml2-dev -y \\\n && rm -rf /var/lib/apt/lists/*\n#   Install phantomjs\nENV QT_QPA_PLATFORM=\"minimal\"\nRUN set -ex \\\n && echo \"deb http://ftp.debian.org/debian jessie-backports main\" >> /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends phantomjs -y \\\n && rm -rf /var/lib/apt/lists/*\n#   Install Node and related tools\nRUN set -ex \\\n && curl -sL https://deb.nodesource.com/setup_6.x | /bin/bash - \\\n && curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \\\n && echo \"deb https://dl.yarnpkg.com/debian/ stable main\" | tee /etc/apt/sources.list.d/yarn.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends nodejs yarn -y \\\n && yarn global add bower grunt gulp-cli webpack@^3.10.0 \\\n && yarn cache clean \\\n && rm -rf /var/lib/apt/lists/*\n#  RUN mkdir -p $MEDIA_ROOT && chown www-data $MEDIA_ROOT\n#  RUN mkdir -p $STATIC_ROOT && chown www-data $STATIC_ROOT\n#   Setup user and paths\nRUN set -ex \\\n && adduser --disabled-password --gecos '' mapstory \\\n && mkdir -p $APP_PATH/deps \\\n && chown -R mapstory $APP_PATH \\\n && mkdir -p $MEDIA_ROOT \\\n && chown mapstory $MEDIA_ROOT \\\n && mkdir -p $STATIC_ROOT \\\n && chown mapstory $STATIC_ROOT\nWORKDIR $APP_PATH\nRUN pip install celery==4.1.0\n#   Copy in dependencies\nCOPY --chown=mapstory:mapstory deps ./deps\n#   Install dependencies from requirements.txt\nCOPY --chown=mapstory:mapstory requirements.txt ./\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY epsg_extra /usr/local/lib/python2.7/dist-packages/pyproj/data/\n#   The httplib2 python library uses its own CA certificates.\n#   Add the system and self-signed CAs.\nRUN cat /etc/ssl/certs/ca-certificates.crt >> /usr/local/lib/python2.7/site-packages/httplib2/cacerts.txt\n#   Override the version of awesome-slugify\n#   Using HEAD as of 2018-01-09\n#   The version isn't changed, so it has trouble differentiation from the version in pypy. Thus this manual update.\nRUN pip install git+git://github.com/dimka665/awesome-slugify@a6563949965bcddd976b7b3fb0babf76e3b490f7#egg==wesome-slugify --no-cache-dir -U\n#   Copy in the code\nCOPY --chown=mapstory:mapstory mapstory ./mapstory\nCOPY --chown=mapstory:mapstory ./*.py ./\nCOPY --chown=mapstory:mapstory docker/django/run.sh $APP_PATH/docker/django/\nRUN ln -s $APP_PATH/docker/django/run.sh /opt/run.sh\nRUN set -ex \\\n && chown -R mapstory:mapstory $STATIC_ROOT \\\n && chown -R mapstory:mapstory $MEDIA_ROOT \\\n && mkdir -p $APP_PATH/cover \\\n && chown -R mapstory:mapstory $APP_PATH/cover\nUSER mapstory\nWORKDIR $APP_PATH/mapstory/static\nRUN set -ex \\\n && /opt/run.sh --collect-static \\\n && yarn cache clean \\\n && rm -rf ~/.cache/bower \\\n && rm -rf /tmp/phantomjs\nWORKDIR $APP_PATH\nVOLUME $STATIC_ROOT\nVOLUME $MEDIA_ROOT\nVOLUME $APP_PATH/cover\nEXPOSE $DJANGO_PORT\nENTRYPOINT [\"/opt/run.sh\"]\nCMD [\"--init-db\", \"--reindex\", \"--serve\"]\n","originalDockerfileUglifiedHash":"a911a89b412afccd281e82472bcbf295","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/5a80e03c396b9f4174505e710ea7e3a9c6089904.dockerfile"}