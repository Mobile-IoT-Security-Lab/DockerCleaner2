{"seed":1956729129,"processedDockerfileHash":"4ef13fbc0ef9bbd340cf1ac743dd14d1","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"#\n#                      ##        .\n#                ## ## ##       ==\n#             ## ## ## ##      ===\n#         /\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\\___/ ===\n#    ~~~ {~~ ~~~~ ~~~ ~~~~ ~~ ~ /  ===- ~~~\n#         \\______ o          __/\n#           \\    \\        __/\n#            \\____\\______/\n#\n#            |          |\n#         __ |  __   __ | _  __   _\n#        /  \\| /  \\ /   |/  / _\\ |\n#        \\__/| \\__/ \\__ |\\_ \\__  |\n#\n#   Dockerfile for ISPConfig with MariaDB database\n#\n#   https://www.howtoforge.com/tutorial/perfect-server-debian-8-jessie-apache-bind-dovecot-ispconfig-3/\n#\nFROM debian:stretch-slim\nMAINTAINER Jeremie Robert <appydo@gmail.com> version: 0.2\n#   Let the container know that there is no tty\nENV DEBIAN_FRONTEND=\"noninteractive\"\n#   --- 1 Preliminary\nRUN apt-get update -y \\\n && apt-get -y upgrade \\\n && (apt-get update ;apt-get install --no-install-recommends rsyslog rsyslog-relp logrotate supervisor screenfetch -y )\n#   Create the log file to be able to run tail\nRUN touch /var/log/cron.log /var/log/auth.log\n#   --- 2 Install the SSH server\nRUN (apt-get update ;apt-get install --no-install-recommends ssh openssh-server rsync -y )\n#   --- 3 Install a shell text editor\nRUN (apt-get update ;apt-get install --no-install-recommends nano vim-nox -y )\n#   --- 5 Update Your Debian Installation\nCOPY ./etc/apt/sources.list /etc/apt/sources.list\nRUN : \\\n && apt-get -y upgrade\n#   --- 6 Change The Default Shell\nRUN echo \"dash dash/sh boolean no\" | debconf-set-selections \\\n && dpkg-reconfigure dash\n#   --- 7 Synchronize the System Clock\n#   RUN apt-get -y install ntp ntpdate\n#   --- 8 Install Postfix, Dovecot, MySQL, phpMyAdmin, rkhunter, binutils\nRUN echo 'mysql-server mysql-server/root_password password pass' | debconf-set-selections \\\n && echo 'mysql-server mysql-server/root_password_again password pass' | debconf-set-selections \\\n && echo 'mariadb-server mariadb-server/root_password password pass' | debconf-set-selections \\\n && echo 'mariadb-server mariadb-server/root_password_again password pass' | debconf-set-selections\nRUN (apt-get update ;apt-get install --no-install-recommends postfix postfix-mysql postfix-doc mariadb-client mariadb-server openssl getmail4 rkhunter binutils dovecot-imapd dovecot-pop3d dovecot-mysql dovecot-sieve dovecot-lmtpd sudo -y )\nCOPY ./etc/postfix/master.cf /etc/postfix/master.cf\nRUN mv /etc/mysql/mariadb.conf.d/50-server.cnf /etc/mysql/mariadb.conf.d/50-server.cnf.backup\nCOPY ./etc/mysql/mariadb.conf.d/50-server.cnf /etc/mysql/mariadb.conf.d/50-server.cnf\n#   RUN apt-get -y install expect\nRUN mv /etc/mysql/debian.cnf /etc/mysql/debian.cnf.backup\nCOPY ./etc/mysql/debian.cnf /etc/mysql/debian.cnf\nCOPY ./etc/security/limits.conf /etc/security/limits.conf\nRUN mkdir -p /etc/systemd/system/mysql.service.d/\nCOPY ./etc/systemd/system/mysql.service.d/limits.conf /etc/systemd/system/mysql.service.d/limits.conf\n#   --- 9 Install Amavisd-new, SpamAssassin And Clamav\nRUN (apt-get update ;apt-get install --no-install-recommends amavisd-new spamassassin clamav clamav-daemon zoo unzip bzip2 arj nomarch lzop cabextract apt-listchanges libnet-ldap-perl libauthen-sasl-perl clamav-docs daemon libio-string-perl libio-socket-ssl-perl libnet-ident-perl zip libnet-dns-perl -y )\nCOPY ./etc/clamav/clamd.conf /etc/clamav/clamd.conf\nRUN service spamassassin stop \\\n && systemctl disable spamassassin\n#   --- 9.1 Install Metronome XMPP Server\nRUN echo \"deb http://packages.prosody.im/debian jessie main\" > /etc/apt/sources.list.d/metronome.list\nRUN wget http://prosody.im/files/prosody-debian-packages.key -O - | apt-key add -\nRUN apt-get update -qq \\\n && (apt-get update ;apt-get install --no-install-recommends git lua5.1 liblua5.1-0-dev lua-filesystem libidn11-dev libssl-dev lua-zlib lua-expat lua-event lua-bitop lua-socket lua-sec luarocks luarocks -y -qq )\nRUN luarocks install lpc\nRUN adduser --no-create-home --disabled-login --gecos 'Metronome' metronome\nRUN cd /opt \\\n && git clone https://github.com/maranda/metronome.git metronome\nRUN cd /opt/metronome \\\n && ./configure --ostype=debian --prefix=/usr \\\n && make \\\n && make install\n#   --- 10 Install Apache2, PHP5, phpMyAdmin, FCGI, suExec, Pear, And mcrypt\nRUN echo 'phpmyadmin phpmyadmin/dbconfig-install boolean true' | debconf-set-selections \\\n && echo 'phpmyadmin phpmyadmin/mysql/admin-pass password pass' | debconf-set-selections \\\n && echo 'phpmyadmin phpmyadmin/reconfigure-webserver multiselect apache2' | debconf-set-selections\nRUN service mysql start \\\n && (apt-get update ;apt-get install --no-install-recommends apache2 apache2-doc apache2-utils libapache2-mod-php php7.0 php7.0-common php7.0-gd php7.0-mysql php7.0-imap phpmyadmin php7.0-cli php7.0-cgi libapache2-mod-fcgid apache2-suexec-pristine php-pear php7.0-mcrypt mcrypt imagemagick libruby libapache2-mod-python php7.0-curl php7.0-intl php7.0-pspell php7.0-recode php7.0-sqlite3 php7.0-tidy php7.0-xmlrpc php7.0-xsl memcached php-memcache php-imagick php-gettext php7.0-zip php7.0-mbstring memcached libapache2-mod-passenger php7.0-soap -y )\nRUN a2enmod suexec rewrite ssl actions include dav_fs dav auth_digest cgi\n#   --- 11 Install Let's Encrypt\nRUN (apt-get update ;apt-get install --no-install-recommends certbot -y )\n#   --- 12 Opcode and PHP-FPM\nRUN (apt-get update ;apt-get install --no-install-recommends php7.0-fpm php7.0-opcache php-apcu -y )\nRUN a2enmod actions proxy_fcgi alias\n#   php5 fpm (non-free)\n#   RUN apt-get -y install libapache2-mod-fastcgi php5-fpm\n#   RUN a2enmod actions fastcgi alias\n#   --- 13 Install Mailman\nRUN echo 'mailman mailman/default_server_language en' | debconf-set-selections\nRUN (apt-get update ;apt-get install --no-install-recommends mailman -y )\n#   RUN [\"/usr/lib/mailman/bin/newlist\", \"-q\", \"mailman\", \"mail@mail.com\", \"pass\"]\nCOPY ./etc/aliases /etc/aliases\nRUN newaliases\nRUN ln -s /etc/mailman/apache.conf /etc/apache2/conf-enabled/mailman.conf\n#   --- 14 Install PureFTPd And Quota\n#   RUN apt-get -y install pure-ftpd-common pure-ftpd-mysql quota quotatool\n#   --- 14 Install PureFTPd And Quota\n#   install package building helpers\nRUN (apt-get update ;apt-get install --no-install-recommends dpkg-dev debhelper openbsd-inetd debian-keyring -qq -y --force-yes )\n#   install dependancies\nRUN apt-get -y -qq build-dep pure-ftpd\n#   build from source\nRUN mkdir /tmp/pure-ftpd-mysql/ \\\n && cd /tmp/pure-ftpd-mysql/ \\\n && apt-get -qq source pure-ftpd-mysql \\\n && cd pure-ftpd-* \\\n && sed -i '/^optflags=/ s/$/ --without-capabilities/g' ./debian/rules \\\n && dpkg-buildpackage -b -uc > /tmp/pureftpd-build-stdout.txt 2> /tmp/pureftpd-build-stderr.txt\n#   install the new deb files\nRUN dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-common*.deb \\\n && dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-mysql*.deb\n#   Prevent pure-ftpd upgrading\nRUN apt-mark hold pure-ftpd-common pure-ftpd-mysql\n#   setup ftpgroup and ftpuser\nRUN groupadd ftpgroup \\\n && useradd -g ftpgroup -d /dev/null -s /etc ftpuser\nRUN apt-get update -qq \\\n && (apt-get update ;apt-get install --no-install-recommends quota quotatool -y -qq )\n#  RUN /bin/bash -c 'sed -i \"s/{{ SSLCERT_ORGANIZATION }}/${SSLCERT_ORGANIZATION}/g;s/{{ SSLCERT_UNITNAME }}/${SSLCERT_UNITNAME}/g;s/{{ SSLCERT_EMAIL }}/${SSLCERT_EMAIL}/g;s/{{ SSLCERT_LOCALITY }}/${SSLCERT_LOCALITY}/g;s/{{ SSLCERT_STATE }}/${SSLCERT_STATE}/g;s/{{ SSLCERT_COUNTRY }}/${SSLCERT_COUNTRY}/g;s/{{ SSLCERT_CN }}/${FQDN}/g\" /root/config/openssl.cnf'\n#  RUN openssl req -x509 -nodes -days 7300 -newkey rsa:4096 -config /root/config/openssl.cnf -keyout /etc/ssl/private/pure-ftpd.pem -out /etc/ssl/private/pure-ftpd.pem\n#  RUN chmod 600 /etc/ssl/private/pure-ftpd.pem\n#   install package building helpers\n#   RUN apt-get -y --force-yes install dpkg-dev debhelper openbsd-inetd\n#   install dependancies\n#   RUN apt-get -y build-dep pure-ftpd\n#   build from source\n#   RUN mkdir /tmp/pure-ftpd-mysql/ && \\\n#      cd /tmp/pure-ftpd-mysql/ && \\\n#      apt-get source pure-ftpd-mysql && \\\n#      cd pure-ftpd-* && \\\n#      sed -i '/^optflags=/ s/$/ --without-capabilities/g' ./debian/rules && \\\n#      dpkg-buildpackage -b -uc\n#   install the new deb files\n#   RUN dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-common*.deb\n#   RUN dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-mysql*.deb\n#   Prevent pure-ftpd upgrading\n#   RUN apt-mark hold pure-ftpd-common pure-ftpd-mysql\n#   setup ftpgroup and ftpuser\n#   RUN groupadd ftpgroup\n#   RUN useradd -g ftpgroup -d /dev/null -s /etc ftpuser\n#   RUN apt-get -y install quota quotatool\nCOPY ./etc/default/pure-ftpd-common /etc/default/pure-ftpd-common\nRUN echo 1 > /etc/pure-ftpd/conf/TLS \\\n && mkdir -p /etc/ssl/private/\n#   RUN openssl req -x509 -nodes -days 7300 -newkey rsa:2048 -keyout /etc/ssl/private/pure-ftpd.pem -out /etc/ssl/private/pure-ftpd.pem\n#   RUN chmod 600 /etc/ssl/private/pure-ftpd.pem\n#   --- 15 Install BIND DNS Server\nRUN (apt-get update ;apt-get install --no-install-recommends bind9 dnsutils haveged -y )\n#   --- 16 Install Vlogger, Webalizer, And AWStats\nRUN (apt-get update ;apt-get install --no-install-recommends vlogger webalizer awstats geoip-database libclass-dbi-mysql-perl -y )\nCOPY etc/cron.d/awstats /etc/cron.d/\n#   --- 17 Install Jailkit\nRUN (apt-get update ;apt-get install --no-install-recommends build-essential autoconf automake libtool flex bison debhelper binutils -y )\nRUN cd /tmp \\\n && wget http://olivier.sessink.nl/jailkit/jailkit-2.19.tar.gz \\\n && tar xvfz jailkit-2.19.tar.gz \\\n && cd jailkit-2.19 \\\n && echo 5 > debian/compat \\\n && ./debian/rules binary \\\n && cd /tmp \\\n && dpkg -i jailkit_2.19-1_*.deb\n#   --- 18 Install fail2ban\nRUN (apt-get update ;apt-get install --no-install-recommends fail2ban -y )\nCOPY ./etc/fail2ban/jail.local /etc/fail2ban/jail.local\nCOPY ./etc/fail2ban/filter.d/pureftpd.conf /etc/fail2ban/filter.d/pureftpd.conf\nCOPY ./etc/fail2ban/filter.d/dovecot-pop3imap.conf /etc/fail2ban/filter.d/dovecot-pop3imap.conf\nRUN echo \"ignoreregex =\" >> /etc/fail2ban/filter.d/postfix-sasl.conf\n#   --- 19 Install RoundCube\n#   RUN apt-get -y install squirrelmail\n#   ADD ./etc/apache2/conf-enabled/squirrelmail.conf /etc/apache2/conf-enabled/squirrelmail.conf\n#   ADD ./etc/squirrelmail/config.php /etc/squirrelmail/config.php\n#   RUN mkdir /var/lib/squirrelmail/tmp\n#   RUN chown www-data /var/lib/squirrelmail/tmp\nRUN service mysql start \\\n && (apt-get update ;apt-get install --no-install-recommends roundcube roundcube-core roundcube-mysql roundcube-plugins -y )\nCOPY ./etc/apache2/conf-enabled/roundcube.conf /etc/apache2/conf-enabled/roundcube.conf\nCOPY ./etc/roundcube/config.inc.php /etc/roundcube/config.inc.php\n#   --- 20 Install ISPConfig 3\nRUN cd /root \\\n && wget http://www.ispconfig.org/downloads/ISPConfig-3-stable.tar.gz \\\n && tar xfz ISPConfig-3-stable.tar.gz\n#   RUN [\"/bin/bash\", \"-c\", \"cat /tmp/install_ispconfig.txt | php -q /tmp/ispconfig3_install/install/install.php\"]\n#   RUN sed -i -e\"s/^bind-address\\s*=\\s*127.0.0.1/bind-address = 0.0.0.0/\" /etc/mysql/my.cnf\n#   RUN sed -i -e \"s/upload_max_filesize\\s*=\\s*2M/upload_max_filesize = 100M/g\" /etc/php5/fpm/php.ini\n#   RUN sed -i -e \"s/post_max_size\\s*=\\s*8M/post_max_size = 100M/g\" /etc/php5/fpm/php.ini\n#   ADD ./etc/mysql/my.cnf /etc/mysql/my.cnf\nCOPY ./etc/clamav/clamd.conf /etc/clamav/clamd.conf\nRUN echo \"export TERM=xterm\" >> /root/.bashrc\nEXPOSE 20/tcp 21/tcp 22/tcp 53/tcp 80/tcp 443/tcp 953/tcp 8080/tcp 30000/tcp 30001/tcp 30002/tcp 30003/tcp 30004/tcp 30005/tcp 30006/tcp 30007/tcp 30008/tcp 30009/tcp 3306/tcp\n#   ISPCONFIG Initialization and Startup Script\nCOPY ./start.sh /start.sh\nCOPY ./supervisord.conf /etc/supervisor/supervisord.conf\nCOPY ./etc/cron.daily/sql_backup.sh /etc/cron.daily/sql_backup.sh\nCOPY ./autoinstall.ini /root/ispconfig3_install/install/autoinstall.ini\nRUN mkdir -p /var/run/sshd /var/log/supervisor /var/run/supervisor\nRUN mv /bin/systemctl /bin/systemctloriginal\nCOPY ./bin/systemctl /bin/systemctl\nRUN chmod 755 /start.sh /bin/systemctl\nRUN mkdir -p /var/backup/sql\nRUN freshclam\n#   CLEANING\nRUN apt-get autoremove -y \\\n && apt-get clean \\\n && rm -rf /tmp/*\nVOLUME [\"/var/www/\",\"/var/mail/\",\"/var/backup/\",\"/var/lib/mysql\",\"/var/log/\"]\nCMD [\"/bin/bash\", \"/start.sh\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#\n#                     ##        .\n#               ## ## ##       ==\n#            ## ## ## ##      ===\n#        /\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\\___/ ===\n#   ~~~ {~~ ~~~~ ~~~ ~~~~ ~~ ~ /  ===- ~~~\n#        \\______ o          __/\n#          \\    \\        __/\n#           \\____\\______/\n#\n#           |          |\n#        __ |  __   __ | _  __   _\n#       /  \\| /  \\ /   |/  / _\\ |\n#       \\__/| \\__/ \\__ |\\_ \\__  |\n#\n#  Dockerfile for ISPConfig with MariaDB database\n#\n#  https://www.howtoforge.com/tutorial/perfect-server-debian-8-jessie-apache-bind-dovecot-ispconfig-3/\n#\nFROM debian:stretch-slim\nMAINTAINER Jeremie Robert <appydo@gmail.com> version: 0.2\n#  Let the container know that there is no tty\nENV DEBIAN_FRONTEND=\"noninteractive\"\n#  --- 1 Preliminary\nRUN apt-get update -y \\\n && apt-get -y upgrade \\\n && apt-get install rsyslog rsyslog-relp logrotate supervisor screenfetch -y\n#  Create the log file to be able to run tail\nRUN touch /var/log/cron.log /var/log/auth.log\n#  --- 2 Install the SSH server\nRUN apt-get install ssh openssh-server rsync -y\n#  --- 3 Install a shell text editor\nRUN apt-get install nano vim-nox -y\n#  --- 5 Update Your Debian Installation\nADD ./etc/apt/sources.list /etc/apt/sources.list\nRUN apt-get update -y \\\n && apt-get -y upgrade\n#  --- 6 Change The Default Shell\nRUN echo \"dash dash/sh boolean no\" | debconf-set-selections \\\n && dpkg-reconfigure dash\n#  --- 7 Synchronize the System Clock\n#  RUN apt-get -y install ntp ntpdate\n#  --- 8 Install Postfix, Dovecot, MySQL, phpMyAdmin, rkhunter, binutils\nRUN echo 'mysql-server mysql-server/root_password password pass' | debconf-set-selections \\\n && echo 'mysql-server mysql-server/root_password_again password pass' | debconf-set-selections \\\n && echo 'mariadb-server mariadb-server/root_password password pass' | debconf-set-selections \\\n && echo 'mariadb-server mariadb-server/root_password_again password pass' | debconf-set-selections\nRUN apt-get install postfix postfix-mysql postfix-doc mariadb-client mariadb-server openssl getmail4 rkhunter binutils dovecot-imapd dovecot-pop3d dovecot-mysql dovecot-sieve dovecot-lmtpd sudo -y\nADD ./etc/postfix/master.cf /etc/postfix/master.cf\nRUN mv /etc/mysql/mariadb.conf.d/50-server.cnf /etc/mysql/mariadb.conf.d/50-server.cnf.backup\nADD ./etc/mysql/mariadb.conf.d/50-server.cnf /etc/mysql/mariadb.conf.d/50-server.cnf\n#  RUN apt-get -y install expect\nRUN mv /etc/mysql/debian.cnf /etc/mysql/debian.cnf.backup\nADD ./etc/mysql/debian.cnf /etc/mysql/debian.cnf\nADD ./etc/security/limits.conf /etc/security/limits.conf\nRUN mkdir -p /etc/systemd/system/mysql.service.d/\nADD ./etc/systemd/system/mysql.service.d/limits.conf /etc/systemd/system/mysql.service.d/limits.conf\n#  --- 9 Install Amavisd-new, SpamAssassin And Clamav\nRUN apt-get install amavisd-new spamassassin clamav clamav-daemon zoo unzip bzip2 arj nomarch lzop cabextract apt-listchanges libnet-ldap-perl libauthen-sasl-perl clamav-docs daemon libio-string-perl libio-socket-ssl-perl libnet-ident-perl zip libnet-dns-perl -y\nADD ./etc/clamav/clamd.conf /etc/clamav/clamd.conf\nRUN service spamassassin stop \\\n && systemctl disable spamassassin\n#  --- 9.1 Install Metronome XMPP Server\nRUN echo \"deb http://packages.prosody.im/debian jessie main\" > /etc/apt/sources.list.d/metronome.list\nRUN wget http://prosody.im/files/prosody-debian-packages.key -O - | apt-key add -\nRUN apt-get update -qq \\\n && apt-get install git lua5.1 liblua5.1-0-dev lua-filesystem libidn11-dev libssl-dev lua-zlib lua-expat lua-event lua-bitop lua-socket lua-sec luarocks luarocks -y -qq\nRUN luarocks install lpc\nRUN adduser --no-create-home --disabled-login --gecos 'Metronome' metronome\nRUN cd /opt \\\n && git clone https://github.com/maranda/metronome.git metronome\nRUN cd /opt/metronome \\\n && ./configure --ostype=debian --prefix=/usr \\\n && make \\\n && make install\n#  --- 10 Install Apache2, PHP5, phpMyAdmin, FCGI, suExec, Pear, And mcrypt\nRUN echo 'phpmyadmin phpmyadmin/dbconfig-install boolean true' | debconf-set-selections \\\n && echo 'phpmyadmin phpmyadmin/mysql/admin-pass password pass' | debconf-set-selections \\\n && echo 'phpmyadmin phpmyadmin/reconfigure-webserver multiselect apache2' | debconf-set-selections\nRUN service mysql start \\\n && apt-get install apache2 apache2-doc apache2-utils libapache2-mod-php php7.0 php7.0-common php7.0-gd php7.0-mysql php7.0-imap phpmyadmin php7.0-cli php7.0-cgi libapache2-mod-fcgid apache2-suexec-pristine php-pear php7.0-mcrypt mcrypt imagemagick libruby libapache2-mod-python php7.0-curl php7.0-intl php7.0-pspell php7.0-recode php7.0-sqlite3 php7.0-tidy php7.0-xmlrpc php7.0-xsl memcached php-memcache php-imagick php-gettext php7.0-zip php7.0-mbstring memcached libapache2-mod-passenger php7.0-soap -y\nRUN a2enmod suexec rewrite ssl actions include dav_fs dav auth_digest cgi\n#  --- 11 Install Let's Encrypt\nRUN apt-get install certbot -y\n#  --- 12 Opcode and PHP-FPM\nRUN apt-get install php7.0-fpm php7.0-opcache php-apcu -y\nRUN a2enmod actions proxy_fcgi alias\n#  php5 fpm (non-free)\n#  RUN apt-get -y install libapache2-mod-fastcgi php5-fpm\n#  RUN a2enmod actions fastcgi alias\n#  --- 13 Install Mailman\nRUN echo 'mailman mailman/default_server_language en' | debconf-set-selections\nRUN apt-get install mailman -y\n#  RUN [\"/usr/lib/mailman/bin/newlist\", \"-q\", \"mailman\", \"mail@mail.com\", \"pass\"]\nADD ./etc/aliases /etc/aliases\nRUN newaliases\nRUN ln -s /etc/mailman/apache.conf /etc/apache2/conf-enabled/mailman.conf\n#  --- 14 Install PureFTPd And Quota\n#  RUN apt-get -y install pure-ftpd-common pure-ftpd-mysql quota quotatool\n#  --- 14 Install PureFTPd And Quota\n#  install package building helpers\nRUN apt-get install dpkg-dev debhelper openbsd-inetd debian-keyring -qq -y --force-yes\n#  install dependancies\nRUN apt-get -y -qq build-dep pure-ftpd\n#  build from source\nRUN mkdir /tmp/pure-ftpd-mysql/ \\\n && cd /tmp/pure-ftpd-mysql/ \\\n && apt-get -qq source pure-ftpd-mysql \\\n && cd pure-ftpd-* \\\n && sed -i '/^optflags=/ s/$/ --without-capabilities/g' ./debian/rules \\\n && dpkg-buildpackage -b -uc > /tmp/pureftpd-build-stdout.txt 2> /tmp/pureftpd-build-stderr.txt\n#  install the new deb files\nRUN dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-common*.deb \\\n && dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-mysql*.deb\n#  Prevent pure-ftpd upgrading\nRUN apt-mark hold pure-ftpd-common pure-ftpd-mysql\n#  setup ftpgroup and ftpuser\nRUN groupadd ftpgroup \\\n && useradd -g ftpgroup -d /dev/null -s /etc ftpuser\nRUN apt-get update -qq \\\n && apt-get install quota quotatool -y -qq\n# RUN /bin/bash -c 'sed -i \"s/{{ SSLCERT_ORGANIZATION }}/${SSLCERT_ORGANIZATION}/g;s/{{ SSLCERT_UNITNAME }}/${SSLCERT_UNITNAME}/g;s/{{ SSLCERT_EMAIL }}/${SSLCERT_EMAIL}/g;s/{{ SSLCERT_LOCALITY }}/${SSLCERT_LOCALITY}/g;s/{{ SSLCERT_STATE }}/${SSLCERT_STATE}/g;s/{{ SSLCERT_COUNTRY }}/${SSLCERT_COUNTRY}/g;s/{{ SSLCERT_CN }}/${FQDN}/g\" /root/config/openssl.cnf'\n# RUN openssl req -x509 -nodes -days 7300 -newkey rsa:4096 -config /root/config/openssl.cnf -keyout /etc/ssl/private/pure-ftpd.pem -out /etc/ssl/private/pure-ftpd.pem\n# RUN chmod 600 /etc/ssl/private/pure-ftpd.pem\n#  install package building helpers\n#  RUN apt-get -y --force-yes install dpkg-dev debhelper openbsd-inetd\n#  install dependancies\n#  RUN apt-get -y build-dep pure-ftpd\n#  build from source\n#  RUN mkdir /tmp/pure-ftpd-mysql/ && \\\n#     cd /tmp/pure-ftpd-mysql/ && \\\n#     apt-get source pure-ftpd-mysql && \\\n#     cd pure-ftpd-* && \\\n#     sed -i '/^optflags=/ s/$/ --without-capabilities/g' ./debian/rules && \\\n#     dpkg-buildpackage -b -uc\n#  install the new deb files\n#  RUN dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-common*.deb\n#  RUN dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-mysql*.deb\n#  Prevent pure-ftpd upgrading\n#  RUN apt-mark hold pure-ftpd-common pure-ftpd-mysql\n#  setup ftpgroup and ftpuser\n#  RUN groupadd ftpgroup\n#  RUN useradd -g ftpgroup -d /dev/null -s /etc ftpuser\n#  RUN apt-get -y install quota quotatool\nADD ./etc/default/pure-ftpd-common /etc/default/pure-ftpd-common\nRUN echo 1 > /etc/pure-ftpd/conf/TLS \\\n && mkdir -p /etc/ssl/private/\n#  RUN openssl req -x509 -nodes -days 7300 -newkey rsa:2048 -keyout /etc/ssl/private/pure-ftpd.pem -out /etc/ssl/private/pure-ftpd.pem\n#  RUN chmod 600 /etc/ssl/private/pure-ftpd.pem\n#  --- 15 Install BIND DNS Server\nRUN apt-get install bind9 dnsutils haveged -y\n#  --- 16 Install Vlogger, Webalizer, And AWStats\nRUN apt-get install vlogger webalizer awstats geoip-database libclass-dbi-mysql-perl -y\nADD etc/cron.d/awstats /etc/cron.d/\n#  --- 17 Install Jailkit\nRUN apt-get install build-essential autoconf automake libtool flex bison debhelper binutils -y\nRUN cd /tmp \\\n && wget http://olivier.sessink.nl/jailkit/jailkit-2.19.tar.gz \\\n && tar xvfz jailkit-2.19.tar.gz \\\n && cd jailkit-2.19 \\\n && echo 5 > debian/compat \\\n && ./debian/rules binary \\\n && cd /tmp \\\n && dpkg -i jailkit_2.19-1_*.deb\n#  --- 18 Install fail2ban\nRUN apt-get install fail2ban -y\nADD ./etc/fail2ban/jail.local /etc/fail2ban/jail.local\nADD ./etc/fail2ban/filter.d/pureftpd.conf /etc/fail2ban/filter.d/pureftpd.conf\nADD ./etc/fail2ban/filter.d/dovecot-pop3imap.conf /etc/fail2ban/filter.d/dovecot-pop3imap.conf\nRUN echo \"ignoreregex =\" >> /etc/fail2ban/filter.d/postfix-sasl.conf\n#  --- 19 Install RoundCube\n#  RUN apt-get -y install squirrelmail\n#  ADD ./etc/apache2/conf-enabled/squirrelmail.conf /etc/apache2/conf-enabled/squirrelmail.conf\n#  ADD ./etc/squirrelmail/config.php /etc/squirrelmail/config.php\n#  RUN mkdir /var/lib/squirrelmail/tmp\n#  RUN chown www-data /var/lib/squirrelmail/tmp\nRUN service mysql start \\\n && apt-get install roundcube roundcube-core roundcube-mysql roundcube-plugins -y\nADD ./etc/apache2/conf-enabled/roundcube.conf /etc/apache2/conf-enabled/roundcube.conf\nADD ./etc/roundcube/config.inc.php /etc/roundcube/config.inc.php\n#  --- 20 Install ISPConfig 3\nRUN cd /root \\\n && wget http://www.ispconfig.org/downloads/ISPConfig-3-stable.tar.gz \\\n && tar xfz ISPConfig-3-stable.tar.gz\n#  RUN [\"/bin/bash\", \"-c\", \"cat /tmp/install_ispconfig.txt | php -q /tmp/ispconfig3_install/install/install.php\"]\n#  RUN sed -i -e\"s/^bind-address\\s*=\\s*127.0.0.1/bind-address = 0.0.0.0/\" /etc/mysql/my.cnf\n#  RUN sed -i -e \"s/upload_max_filesize\\s*=\\s*2M/upload_max_filesize = 100M/g\" /etc/php5/fpm/php.ini\n#  RUN sed -i -e \"s/post_max_size\\s*=\\s*8M/post_max_size = 100M/g\" /etc/php5/fpm/php.ini\n#  ADD ./etc/mysql/my.cnf /etc/mysql/my.cnf\nADD ./etc/clamav/clamd.conf /etc/clamav/clamd.conf\nRUN echo \"export TERM=xterm\" >> /root/.bashrc\nEXPOSE 20/tcp 21/tcp 22/tcp 53/tcp 80/tcp 443/tcp 953/tcp 8080/tcp 30000/tcp 30001/tcp 30002/tcp 30003/tcp 30004/tcp 30005/tcp 30006/tcp 30007/tcp 30008/tcp 30009/tcp 3306/tcp\n#  ISPCONFIG Initialization and Startup Script\nADD ./start.sh /start.sh\nADD ./supervisord.conf /etc/supervisor/supervisord.conf\nADD ./etc/cron.daily/sql_backup.sh /etc/cron.daily/sql_backup.sh\nADD ./autoinstall.ini /root/ispconfig3_install/install/autoinstall.ini\nRUN mkdir -p /var/run/sshd /var/log/supervisor /var/run/supervisor\nRUN mv /bin/systemctl /bin/systemctloriginal\nADD ./bin/systemctl /bin/systemctl\nRUN chmod 755 /start.sh /bin/systemctl\nRUN mkdir -p /var/backup/sql\nRUN freshclam\n#  CLEANING\nRUN apt-get autoremove -y \\\n && apt-get clean \\\n && rm -rf /tmp/*\nVOLUME [\"/var/www/\",\"/var/mail/\",\"/var/backup/\",\"/var/lib/mysql\",\"/var/log/\"]\nCMD [\"/bin/bash\", \"/start.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"a99a53685432473d745c66ac74a15129","successfullyInjectedSmells":[],"originalDockerfileUglified":"#\n#                      ##        .\n#                ## ## ##       ==\n#             ## ## ## ##      ===\n#         /\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\\___/ ===\n#    ~~~ {~~ ~~~~ ~~~ ~~~~ ~~ ~ /  ===- ~~~\n#         \\______ o          __/\n#           \\    \\        __/\n#            \\____\\______/\n#\n#            |          |\n#         __ |  __   __ | _  __   _\n#        /  \\| /  \\ /   |/  / _\\ |\n#        \\__/| \\__/ \\__ |\\_ \\__  |\n#\n#   Dockerfile for ISPConfig with MariaDB database\n#\n#   https://www.howtoforge.com/tutorial/perfect-server-debian-8-jessie-apache-bind-dovecot-ispconfig-3/\n#\nFROM debian:stretch-slim\nMAINTAINER Jeremie Robert <appydo@gmail.com> version: 0.2\n#   Let the container know that there is no tty\nENV DEBIAN_FRONTEND=\"noninteractive\"\n#   --- 1 Preliminary\nRUN apt-get update -y \\\n && apt-get -y upgrade \\\n && apt-get install rsyslog rsyslog-relp logrotate supervisor screenfetch -y\n#   Create the log file to be able to run tail\nRUN touch /var/log/cron.log /var/log/auth.log\n#   --- 2 Install the SSH server\nRUN apt-get install ssh openssh-server rsync -y\n#   --- 3 Install a shell text editor\nRUN apt-get install nano vim-nox -y\n#   --- 5 Update Your Debian Installation\nADD ./etc/apt/sources.list /etc/apt/sources.list\nRUN apt-get update -y \\\n && apt-get -y upgrade\n#   --- 6 Change The Default Shell\nRUN echo \"dash dash/sh boolean no\" | debconf-set-selections \\\n && dpkg-reconfigure dash\n#   --- 7 Synchronize the System Clock\n#   RUN apt-get -y install ntp ntpdate\n#   --- 8 Install Postfix, Dovecot, MySQL, phpMyAdmin, rkhunter, binutils\nRUN echo 'mysql-server mysql-server/root_password password pass' | debconf-set-selections \\\n && echo 'mysql-server mysql-server/root_password_again password pass' | debconf-set-selections \\\n && echo 'mariadb-server mariadb-server/root_password password pass' | debconf-set-selections \\\n && echo 'mariadb-server mariadb-server/root_password_again password pass' | debconf-set-selections\nRUN apt-get install postfix postfix-mysql postfix-doc mariadb-client mariadb-server openssl getmail4 rkhunter binutils dovecot-imapd dovecot-pop3d dovecot-mysql dovecot-sieve dovecot-lmtpd sudo -y\nADD ./etc/postfix/master.cf /etc/postfix/master.cf\nRUN mv /etc/mysql/mariadb.conf.d/50-server.cnf /etc/mysql/mariadb.conf.d/50-server.cnf.backup\nADD ./etc/mysql/mariadb.conf.d/50-server.cnf /etc/mysql/mariadb.conf.d/50-server.cnf\n#   RUN apt-get -y install expect\nRUN mv /etc/mysql/debian.cnf /etc/mysql/debian.cnf.backup\nADD ./etc/mysql/debian.cnf /etc/mysql/debian.cnf\nADD ./etc/security/limits.conf /etc/security/limits.conf\nRUN mkdir -p /etc/systemd/system/mysql.service.d/\nADD ./etc/systemd/system/mysql.service.d/limits.conf /etc/systemd/system/mysql.service.d/limits.conf\n#   --- 9 Install Amavisd-new, SpamAssassin And Clamav\nRUN apt-get install amavisd-new spamassassin clamav clamav-daemon zoo unzip bzip2 arj nomarch lzop cabextract apt-listchanges libnet-ldap-perl libauthen-sasl-perl clamav-docs daemon libio-string-perl libio-socket-ssl-perl libnet-ident-perl zip libnet-dns-perl -y\nADD ./etc/clamav/clamd.conf /etc/clamav/clamd.conf\nRUN service spamassassin stop \\\n && systemctl disable spamassassin\n#   --- 9.1 Install Metronome XMPP Server\nRUN echo \"deb http://packages.prosody.im/debian jessie main\" > /etc/apt/sources.list.d/metronome.list\nRUN wget http://prosody.im/files/prosody-debian-packages.key -O - | apt-key add -\nRUN apt-get update -qq \\\n && apt-get install git lua5.1 liblua5.1-0-dev lua-filesystem libidn11-dev libssl-dev lua-zlib lua-expat lua-event lua-bitop lua-socket lua-sec luarocks luarocks -y -qq\nRUN luarocks install lpc\nRUN adduser --no-create-home --disabled-login --gecos 'Metronome' metronome\nRUN cd /opt \\\n && git clone https://github.com/maranda/metronome.git metronome\nRUN cd /opt/metronome \\\n && ./configure --ostype=debian --prefix=/usr \\\n && make \\\n && make install\n#   --- 10 Install Apache2, PHP5, phpMyAdmin, FCGI, suExec, Pear, And mcrypt\nRUN echo 'phpmyadmin phpmyadmin/dbconfig-install boolean true' | debconf-set-selections \\\n && echo 'phpmyadmin phpmyadmin/mysql/admin-pass password pass' | debconf-set-selections \\\n && echo 'phpmyadmin phpmyadmin/reconfigure-webserver multiselect apache2' | debconf-set-selections\nRUN service mysql start \\\n && apt-get install apache2 apache2-doc apache2-utils libapache2-mod-php php7.0 php7.0-common php7.0-gd php7.0-mysql php7.0-imap phpmyadmin php7.0-cli php7.0-cgi libapache2-mod-fcgid apache2-suexec-pristine php-pear php7.0-mcrypt mcrypt imagemagick libruby libapache2-mod-python php7.0-curl php7.0-intl php7.0-pspell php7.0-recode php7.0-sqlite3 php7.0-tidy php7.0-xmlrpc php7.0-xsl memcached php-memcache php-imagick php-gettext php7.0-zip php7.0-mbstring memcached libapache2-mod-passenger php7.0-soap -y\nRUN a2enmod suexec rewrite ssl actions include dav_fs dav auth_digest cgi\n#   --- 11 Install Let's Encrypt\nRUN apt-get install certbot -y\n#   --- 12 Opcode and PHP-FPM\nRUN apt-get install php7.0-fpm php7.0-opcache php-apcu -y\nRUN a2enmod actions proxy_fcgi alias\n#   php5 fpm (non-free)\n#   RUN apt-get -y install libapache2-mod-fastcgi php5-fpm\n#   RUN a2enmod actions fastcgi alias\n#   --- 13 Install Mailman\nRUN echo 'mailman mailman/default_server_language en' | debconf-set-selections\nRUN apt-get install mailman -y\n#   RUN [\"/usr/lib/mailman/bin/newlist\", \"-q\", \"mailman\", \"mail@mail.com\", \"pass\"]\nADD ./etc/aliases /etc/aliases\nRUN newaliases\nRUN ln -s /etc/mailman/apache.conf /etc/apache2/conf-enabled/mailman.conf\n#   --- 14 Install PureFTPd And Quota\n#   RUN apt-get -y install pure-ftpd-common pure-ftpd-mysql quota quotatool\n#   --- 14 Install PureFTPd And Quota\n#   install package building helpers\nRUN apt-get install dpkg-dev debhelper openbsd-inetd debian-keyring -qq -y --force-yes\n#   install dependancies\nRUN apt-get -y -qq build-dep pure-ftpd\n#   build from source\nRUN mkdir /tmp/pure-ftpd-mysql/ \\\n && cd /tmp/pure-ftpd-mysql/ \\\n && apt-get -qq source pure-ftpd-mysql \\\n && cd pure-ftpd-* \\\n && sed -i '/^optflags=/ s/$/ --without-capabilities/g' ./debian/rules \\\n && dpkg-buildpackage -b -uc > /tmp/pureftpd-build-stdout.txt 2> /tmp/pureftpd-build-stderr.txt\n#   install the new deb files\nRUN dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-common*.deb \\\n && dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-mysql*.deb\n#   Prevent pure-ftpd upgrading\nRUN apt-mark hold pure-ftpd-common pure-ftpd-mysql\n#   setup ftpgroup and ftpuser\nRUN groupadd ftpgroup \\\n && useradd -g ftpgroup -d /dev/null -s /etc ftpuser\nRUN apt-get update -qq \\\n && apt-get install quota quotatool -y -qq\n#  RUN /bin/bash -c 'sed -i \"s/{{ SSLCERT_ORGANIZATION }}/${SSLCERT_ORGANIZATION}/g;s/{{ SSLCERT_UNITNAME }}/${SSLCERT_UNITNAME}/g;s/{{ SSLCERT_EMAIL }}/${SSLCERT_EMAIL}/g;s/{{ SSLCERT_LOCALITY }}/${SSLCERT_LOCALITY}/g;s/{{ SSLCERT_STATE }}/${SSLCERT_STATE}/g;s/{{ SSLCERT_COUNTRY }}/${SSLCERT_COUNTRY}/g;s/{{ SSLCERT_CN }}/${FQDN}/g\" /root/config/openssl.cnf'\n#  RUN openssl req -x509 -nodes -days 7300 -newkey rsa:4096 -config /root/config/openssl.cnf -keyout /etc/ssl/private/pure-ftpd.pem -out /etc/ssl/private/pure-ftpd.pem\n#  RUN chmod 600 /etc/ssl/private/pure-ftpd.pem\n#   install package building helpers\n#   RUN apt-get -y --force-yes install dpkg-dev debhelper openbsd-inetd\n#   install dependancies\n#   RUN apt-get -y build-dep pure-ftpd\n#   build from source\n#   RUN mkdir /tmp/pure-ftpd-mysql/ && \\\n#      cd /tmp/pure-ftpd-mysql/ && \\\n#      apt-get source pure-ftpd-mysql && \\\n#      cd pure-ftpd-* && \\\n#      sed -i '/^optflags=/ s/$/ --without-capabilities/g' ./debian/rules && \\\n#      dpkg-buildpackage -b -uc\n#   install the new deb files\n#   RUN dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-common*.deb\n#   RUN dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-mysql*.deb\n#   Prevent pure-ftpd upgrading\n#   RUN apt-mark hold pure-ftpd-common pure-ftpd-mysql\n#   setup ftpgroup and ftpuser\n#   RUN groupadd ftpgroup\n#   RUN useradd -g ftpgroup -d /dev/null -s /etc ftpuser\n#   RUN apt-get -y install quota quotatool\nADD ./etc/default/pure-ftpd-common /etc/default/pure-ftpd-common\nRUN echo 1 > /etc/pure-ftpd/conf/TLS \\\n && mkdir -p /etc/ssl/private/\n#   RUN openssl req -x509 -nodes -days 7300 -newkey rsa:2048 -keyout /etc/ssl/private/pure-ftpd.pem -out /etc/ssl/private/pure-ftpd.pem\n#   RUN chmod 600 /etc/ssl/private/pure-ftpd.pem\n#   --- 15 Install BIND DNS Server\nRUN apt-get install bind9 dnsutils haveged -y\n#   --- 16 Install Vlogger, Webalizer, And AWStats\nRUN apt-get install vlogger webalizer awstats geoip-database libclass-dbi-mysql-perl -y\nADD etc/cron.d/awstats /etc/cron.d/\n#   --- 17 Install Jailkit\nRUN apt-get install build-essential autoconf automake libtool flex bison debhelper binutils -y\nRUN cd /tmp \\\n && wget http://olivier.sessink.nl/jailkit/jailkit-2.19.tar.gz \\\n && tar xvfz jailkit-2.19.tar.gz \\\n && cd jailkit-2.19 \\\n && echo 5 > debian/compat \\\n && ./debian/rules binary \\\n && cd /tmp \\\n && dpkg -i jailkit_2.19-1_*.deb\n#   --- 18 Install fail2ban\nRUN apt-get install fail2ban -y\nADD ./etc/fail2ban/jail.local /etc/fail2ban/jail.local\nADD ./etc/fail2ban/filter.d/pureftpd.conf /etc/fail2ban/filter.d/pureftpd.conf\nADD ./etc/fail2ban/filter.d/dovecot-pop3imap.conf /etc/fail2ban/filter.d/dovecot-pop3imap.conf\nRUN echo \"ignoreregex =\" >> /etc/fail2ban/filter.d/postfix-sasl.conf\n#   --- 19 Install RoundCube\n#   RUN apt-get -y install squirrelmail\n#   ADD ./etc/apache2/conf-enabled/squirrelmail.conf /etc/apache2/conf-enabled/squirrelmail.conf\n#   ADD ./etc/squirrelmail/config.php /etc/squirrelmail/config.php\n#   RUN mkdir /var/lib/squirrelmail/tmp\n#   RUN chown www-data /var/lib/squirrelmail/tmp\nRUN service mysql start \\\n && apt-get install roundcube roundcube-core roundcube-mysql roundcube-plugins -y\nADD ./etc/apache2/conf-enabled/roundcube.conf /etc/apache2/conf-enabled/roundcube.conf\nADD ./etc/roundcube/config.inc.php /etc/roundcube/config.inc.php\n#   --- 20 Install ISPConfig 3\nRUN cd /root \\\n && wget http://www.ispconfig.org/downloads/ISPConfig-3-stable.tar.gz \\\n && tar xfz ISPConfig-3-stable.tar.gz\n#   RUN [\"/bin/bash\", \"-c\", \"cat /tmp/install_ispconfig.txt | php -q /tmp/ispconfig3_install/install/install.php\"]\n#   RUN sed -i -e\"s/^bind-address\\s*=\\s*127.0.0.1/bind-address = 0.0.0.0/\" /etc/mysql/my.cnf\n#   RUN sed -i -e \"s/upload_max_filesize\\s*=\\s*2M/upload_max_filesize = 100M/g\" /etc/php5/fpm/php.ini\n#   RUN sed -i -e \"s/post_max_size\\s*=\\s*8M/post_max_size = 100M/g\" /etc/php5/fpm/php.ini\n#   ADD ./etc/mysql/my.cnf /etc/mysql/my.cnf\nADD ./etc/clamav/clamd.conf /etc/clamav/clamd.conf\nRUN echo \"export TERM=xterm\" >> /root/.bashrc\nEXPOSE 20/tcp 21/tcp 22/tcp 53/tcp 80/tcp 443/tcp 953/tcp 8080/tcp 30000/tcp 30001/tcp 30002/tcp 30003/tcp 30004/tcp 30005/tcp 30006/tcp 30007/tcp 30008/tcp 30009/tcp 3306/tcp\n#   ISPCONFIG Initialization and Startup Script\nADD ./start.sh /start.sh\nADD ./supervisord.conf /etc/supervisor/supervisord.conf\nADD ./etc/cron.daily/sql_backup.sh /etc/cron.daily/sql_backup.sh\nADD ./autoinstall.ini /root/ispconfig3_install/install/autoinstall.ini\nRUN mkdir -p /var/run/sshd /var/log/supervisor /var/run/supervisor\nRUN mv /bin/systemctl /bin/systemctloriginal\nADD ./bin/systemctl /bin/systemctl\nRUN chmod 755 /start.sh /bin/systemctl\nRUN mkdir -p /var/backup/sql\nRUN freshclam\n#   CLEANING\nRUN apt-get autoremove -y \\\n && apt-get clean \\\n && rm -rf /tmp/*\nVOLUME [\"/var/www/\",\"/var/mail/\",\"/var/backup/\",\"/var/lib/mysql\",\"/var/log/\"]\nCMD [\"/bin/bash\", \"/start.sh\"]\n","originalDockerfileUglifiedHash":"6aa51a9091d635db6dd0cd946400d4b2","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/ef7d7894bae73e0696a06ee6e338a6a4abf01a9d.dockerfile"}