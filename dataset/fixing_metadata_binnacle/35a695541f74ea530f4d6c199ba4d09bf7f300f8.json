{"seed":2234061909,"processedDockerfileHash":"2c244349e57ccd46cd088d4f904585c2","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"#\n#  --------------------------------------------------------------------------\n#   Image Setup\n#  --------------------------------------------------------------------------\n#\nARG PHP_VERSION=${PHP_VERSION}\nFROM php:${PHP_VERSION}-alpine\nLABEL maintainer=\"Mahmoud Zalt <mahmoud@zalt.me>\"\nRUN apk add wget curl git build-base libmemcached-dev libmcrypt-dev libxml2-dev zlib-dev autoconf cyrus-sasl-dev libgsasl-dev supervisor --update\nRUN docker-php-ext-install mysqli mbstring pdo pdo_mysql tokenizer xml pcntl\nRUN pecl channel-update pecl.php.net \\\n && pecl install memcached mcrypt-1.0.1 \\\n && docker-php-ext-enable memcached\n#  Install BCMath package:\nARG INSTALL_BCMATH=false\nRUN if [ ${INSTALL_BCMATH} = true ] ; then docker-php-ext-install bcmath ; fi\n#   Install PostgreSQL drivers:\nARG INSTALL_PGSQL=false\nRUN if [ ${INSTALL_PGSQL} = true ] ; then apk add postgresql-dev --update \\\n && docker-php-ext-install pdo_pgsql ; fi\n#  ##########################################################################\n#   PHP Memcached:\n#  ##########################################################################\nARG INSTALL_MEMCACHED=false\nRUN if [ ${INSTALL_MEMCACHED} = true ] ; then if [ $( php -r \"echo PHP_MAJOR_VERSION;\" ;) = \"5\" ] ; then curl -L -o /tmp/memcached.tar.gz \"https://github.com/php-memcached-dev/php-memcached/archive/2.2.0.tar.gz\" ; else curl -L -o /tmp/memcached.tar.gz \"https://github.com/php-memcached-dev/php-memcached/archive/php7.tar.gz\" ; fi \\\n && mkdir -p memcached \\\n && tar -C memcached -zxvf /tmp/memcached.tar.gz --strip 1 \\\n && (cd memcached \\\n && phpize \\\n && ./configure \\\n && make -j$( nproc ;) \\\n && make install ) \\\n && rm -r memcached \\\n && rm /tmp/memcached.tar.gz \\\n && docker-php-ext-enable memcached ; fi\nRUN rm /var/cache/apk/* \\\n && mkdir -p /var/www\n#\n#  --------------------------------------------------------------------------\n#   Optional Supervisord Configuration\n#  --------------------------------------------------------------------------\n#\n#   Modify the ./supervisor.conf file to match your App's requirements.\n#   Make sure you rebuild your container with every change.\n#\nCOPY supervisord.conf /etc/supervisord.conf\nENTRYPOINT [\"/usr/bin/supervisord\", \"-n\", \"-c\", \"/etc/supervisord.conf\"]\n#\n#  --------------------------------------------------------------------------\n#   Optional Software's Installation\n#  --------------------------------------------------------------------------\n#\n#   If you need to modify this image, feel free to do it right here.\n#\n#   -- Your awesome modifications go here -- #\n#\n#  --------------------------------------------------------------------------\n#   Check PHP version\n#  --------------------------------------------------------------------------\n#\nRUN php -v | head -n 1 | grep -q \"PHP ${PHP_VERSION}.\"\n#\n#  --------------------------------------------------------------------------\n#   Final Touch\n#  --------------------------------------------------------------------------\n#\nWORKDIR /etc/supervisor/conf.d/\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n","originalDockerfile":"#\n# --------------------------------------------------------------------------\n#  Image Setup\n# --------------------------------------------------------------------------\n#\nARG PHP_VERSION=${PHP_VERSION}\nFROM php:${PHP_VERSION}-alpine\nLABEL maintainer=\"Mahmoud Zalt <mahmoud@zalt.me>\"\nRUN apk --update add wget curl git build-base libmemcached-dev libmcrypt-dev libxml2-dev zlib-dev autoconf cyrus-sasl-dev libgsasl-dev supervisor\nRUN docker-php-ext-install mysqli mbstring pdo pdo_mysql tokenizer xml pcntl\nRUN pecl channel-update pecl.php.net \\\n && pecl install memcached mcrypt-1.0.1 \\\n && docker-php-ext-enable memcached\n# Install BCMath package:\nARG INSTALL_BCMATH=false\nRUN if [ ${INSTALL_BCMATH} = true ] ; then docker-php-ext-install bcmath ; fi\n#  Install PostgreSQL drivers:\nARG INSTALL_PGSQL=false\nRUN if [ ${INSTALL_PGSQL} = true ] ; then apk --update add postgresql-dev \\\n && docker-php-ext-install pdo_pgsql ; fi\n# ##########################################################################\n#  PHP Memcached:\n# ##########################################################################\nARG INSTALL_MEMCACHED=false\nRUN if [ ${INSTALL_MEMCACHED} = true ] ; then if [ $( php -r \"echo PHP_MAJOR_VERSION;\" ;) = \"5\" ] ; then curl -L -o /tmp/memcached.tar.gz \"https://github.com/php-memcached-dev/php-memcached/archive/2.2.0.tar.gz\" ; else curl -L -o /tmp/memcached.tar.gz \"https://github.com/php-memcached-dev/php-memcached/archive/php7.tar.gz\" ; fi \\\n && mkdir -p memcached \\\n && tar -C memcached -zxvf /tmp/memcached.tar.gz --strip 1 \\\n && (cd memcached \\\n && phpize \\\n && ./configure \\\n && make -j$( nproc ;) \\\n && make install ) \\\n && rm -r memcached \\\n && rm /tmp/memcached.tar.gz \\\n && docker-php-ext-enable memcached ; fi\nRUN rm /var/cache/apk/* \\\n && mkdir -p /var/www\n#\n# --------------------------------------------------------------------------\n#  Optional Supervisord Configuration\n# --------------------------------------------------------------------------\n#\n#  Modify the ./supervisor.conf file to match your App's requirements.\n#  Make sure you rebuild your container with every change.\n#\nCOPY supervisord.conf /etc/supervisord.conf\nENTRYPOINT [\"/usr/bin/supervisord\", \"-n\", \"-c\", \"/etc/supervisord.conf\"]\n#\n# --------------------------------------------------------------------------\n#  Optional Software's Installation\n# --------------------------------------------------------------------------\n#\n#  If you need to modify this image, feel free to do it right here.\n#\n#  -- Your awesome modifications go here -- #\n#\n# --------------------------------------------------------------------------\n#  Check PHP version\n# --------------------------------------------------------------------------\n#\nRUN php -v | head -n 1 | grep -q \"PHP ${PHP_VERSION}.\"\n#\n# --------------------------------------------------------------------------\n#  Final Touch\n# --------------------------------------------------------------------------\n#\nWORKDIR /etc/supervisor/conf.d/\n","injectedSmells":[],"originalDockerfileHash":"93c850cd11468d8fb5303cdc85291455","successfullyInjectedSmells":[],"originalDockerfileUglified":"#\n#  --------------------------------------------------------------------------\n#   Image Setup\n#  --------------------------------------------------------------------------\n#\nARG PHP_VERSION=${PHP_VERSION}\nFROM php:${PHP_VERSION}-alpine\nLABEL maintainer=\"Mahmoud Zalt <mahmoud@zalt.me>\"\nRUN apk --update add wget curl git build-base libmemcached-dev libmcrypt-dev libxml2-dev zlib-dev autoconf cyrus-sasl-dev libgsasl-dev supervisor\nRUN docker-php-ext-install mysqli mbstring pdo pdo_mysql tokenizer xml pcntl\nRUN pecl channel-update pecl.php.net \\\n && pecl install memcached mcrypt-1.0.1 \\\n && docker-php-ext-enable memcached\n#  Install BCMath package:\nARG INSTALL_BCMATH=false\nRUN if [ ${INSTALL_BCMATH} = true ] ; then docker-php-ext-install bcmath ; fi\n#   Install PostgreSQL drivers:\nARG INSTALL_PGSQL=false\nRUN if [ ${INSTALL_PGSQL} = true ] ; then apk --update add postgresql-dev \\\n && docker-php-ext-install pdo_pgsql ; fi\n#  ##########################################################################\n#   PHP Memcached:\n#  ##########################################################################\nARG INSTALL_MEMCACHED=false\nRUN if [ ${INSTALL_MEMCACHED} = true ] ; then if [ $( php -r \"echo PHP_MAJOR_VERSION;\" ;) = \"5\" ] ; then curl -L -o /tmp/memcached.tar.gz \"https://github.com/php-memcached-dev/php-memcached/archive/2.2.0.tar.gz\" ; else curl -L -o /tmp/memcached.tar.gz \"https://github.com/php-memcached-dev/php-memcached/archive/php7.tar.gz\" ; fi \\\n && mkdir -p memcached \\\n && tar -C memcached -zxvf /tmp/memcached.tar.gz --strip 1 \\\n && (cd memcached \\\n && phpize \\\n && ./configure \\\n && make -j$( nproc ;) \\\n && make install ) \\\n && rm -r memcached \\\n && rm /tmp/memcached.tar.gz \\\n && docker-php-ext-enable memcached ; fi\nRUN rm /var/cache/apk/* \\\n && mkdir -p /var/www\n#\n#  --------------------------------------------------------------------------\n#   Optional Supervisord Configuration\n#  --------------------------------------------------------------------------\n#\n#   Modify the ./supervisor.conf file to match your App's requirements.\n#   Make sure you rebuild your container with every change.\n#\nCOPY supervisord.conf /etc/supervisord.conf\nENTRYPOINT [\"/usr/bin/supervisord\", \"-n\", \"-c\", \"/etc/supervisord.conf\"]\n#\n#  --------------------------------------------------------------------------\n#   Optional Software's Installation\n#  --------------------------------------------------------------------------\n#\n#   If you need to modify this image, feel free to do it right here.\n#\n#   -- Your awesome modifications go here -- #\n#\n#  --------------------------------------------------------------------------\n#   Check PHP version\n#  --------------------------------------------------------------------------\n#\nRUN php -v | head -n 1 | grep -q \"PHP ${PHP_VERSION}.\"\n#\n#  --------------------------------------------------------------------------\n#   Final Touch\n#  --------------------------------------------------------------------------\n#\nWORKDIR /etc/supervisor/conf.d/\n","originalDockerfileUglifiedHash":"5aa8057deddeb7b003cb877ce3153b32","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/35a695541f74ea530f4d6c199ba4d09bf7f300f8.dockerfile"}