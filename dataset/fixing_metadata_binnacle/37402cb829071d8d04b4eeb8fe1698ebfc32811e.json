{"seed":1857714580,"processedDockerfileHash":"c3c1e05545ea5bcd94f5bf9f345031c6","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM ubuntu:14.04\nENV DEBIAN_FRONTEND=\"noninteractive\"\n#   Install Cozy tools and dependencies.\nRUN echo \"deb http://ppa.launchpad.net/nginx/stable/ubuntu trusty main\" >> /etc/apt/sources.list \\\n && apt-key adv --keyserver keyserver.ubuntu.com --recv-keys C300EE8C \\\n && apt-get update --quiet \\\n && apt-get install --no-install-recommends build-essential=11.6ubuntu6 couchdb=1.5.0-0ubuntu1 curl=7.35.0-1ubuntu2.20 git=1:1.9.1-1ubuntu0.10 imagemagick=8:6.7.7.10-6ubuntu3.13 language-pack-en=1:14.04+20160720 libffi6=3.1~rc1+r3.0.13-12ubuntu0.2 libffi-dev=3.1~rc1+r3.0.13-12ubuntu0.2 libssl-dev=1.0.1f-1ubuntu2.27 libxml2-dev=2.9.1+dfsg1-3ubuntu4.13 libxslt1-dev=1.1.28-2ubuntu0.2 libjpeg-dev=8c-2ubuntu8 lsof=4.86+dfsg-1ubuntu2 nginx=1.4.6-1ubuntu3.9 postfix=2.11.0-1ubuntu1.2 pwgen=2.06-1ubuntu4 python-dev=2.7.5-5ubuntu3 python-pip=1.5.4-1ubuntu4 python-setuptools=3.3-1ubuntu2 python-software-properties=0.92.37.8 software-properties-common=0.92.37.8 sqlite3=3.8.2-1ubuntu2.2 wget=1.15-1ubuntu1.14.04.5 --quiet --yes\nRUN update-locale LANG=en_US.UTF-8\nRUN pip install supervisor==4.2.5 virtualenv==20.21.0\n#   Install NodeJS 4.2.X LTS\nRUN curl -sL https://deb.nodesource.com/setup_4.x | bash -\nRUN apt-get install --no-install-recommends nodejs=0.10.25~dfsg2-2ubuntu1.2 -y\n#   Install CoffeeScript, Cozy Monitor and Cozy Controller via NPM.\nRUN npm install coffee-script@1.12.7 cozy-controller@2.5.10 cozy-monitor@1.4.5 -g\n#   Create Cozy users, without home directories.\nRUN useradd -M cozy \\\n && useradd -M cozy-data-system \\\n && useradd -M cozy-home\n#   Configure CouchDB.\nRUN mkdir /etc/cozy \\\n && chown -hR cozy /etc/cozy\nRUN pwgen -1 > /etc/cozy/couchdb.login \\\n && pwgen -1 >> /etc/cozy/couchdb.login \\\n && chown cozy-data-system /etc/cozy/couchdb.login \\\n && chmod 640 /etc/cozy/couchdb.login\nRUN mkdir /var/run/couchdb \\\n && chown -hR couchdb /var/run/couchdb \\\n && su - couchdb -c 'couchdb -b' \\\n && sleep 5 \\\n && while ! curl -s 127.0.0.1:5984 ; do sleep 5 ; done \\\n && curl -s -X PUT 127.0.0.1:5984/_config/admins/$( head -n1 /etc/cozy/couchdb.login ;) -d \"\\\"$( tail -n1 /etc/cozy/couchdb.login ;)\\\"\"\n#   Configure Supervisor.\nCOPY supervisor/supervisord.conf /etc/supervisord.conf\nRUN mkdir -p /var/log/supervisor \\\n && chmod 777 /var/log/supervisor \\\n && /usr/local/bin/supervisord -c /etc/supervisord.conf\n#   Start up background services and install the Cozy platform apps.\nENV NODE_ENV=\"production\"\nRUN su - couchdb -c 'couchdb -b' \\\n && sleep 5 \\\n && while ! curl -s 127.0.0.1:5984 ; do sleep 5 ; done \\\n && cozy-controller &; sleep 5 \\\n && while ! curl -s 127.0.0.1:9002 ; do sleep 5 ; done \\\n && cozy-monitor install data-system \\\n && cozy-monitor install home \\\n && cozy-monitor install proxy \\\n && curl -X POST http://localhost:9103/api/instance -H \"Content-Type: application/json\" -d '{\"background\":\"background-07\"}' \\\n && for app in calendar contacts photos emails files sync; do cozy-monitor install $app ; done\n#   Configure Nginx and check its configuration by restarting the service.\nCOPY nginx/nginx.conf /etc/nginx/nginx.conf\nCOPY nginx/cozy /etc/nginx/sites-available/cozy\nCOPY nginx/cozy-ssl /etc/nginx/sites-available/cozy-ssl\nRUN chmod 0644 /etc/nginx/sites-available/cozy /etc/nginx/sites-available/cozy-ssl \\\n && rm /etc/nginx/sites-enabled/default \\\n && ln -s /etc/nginx/sites-available/cozy /etc/nginx/sites-enabled/cozy\nRUN nginx -t\n#   Configure Postfix with default parameters.\nENV DISABLE_SSL=\"false\"\nENV POSTFIX_DOMAIN=\"mydomain.net\"\nRUN echo \"postfix postfix/mailname string $POSTFIX_DOMAIN\" | debconf-set-selections \\\n && echo \"postfix postfix/main_mailer_type select Internet Site\" | debconf-set-selections \\\n && echo \"postfix postfix/destinations string $POSTFIX_DOMAIN, localhost.localdomain, localhost \" | debconf-set-selections \\\n && cp /etc/services /var/spool/postfix/etc/ \\\n && cp /etc/resolv.conf /var/spool/postfix/etc \\\n && postfix check\n#   Import Supervisor configuration files.\nCOPY supervisor/cozy-controller.conf /etc/supervisor/conf.d/cozy-controller.conf\nCOPY supervisor/cozy-init.conf /etc/supervisor/conf.d/cozy-init.conf\nCOPY supervisor/couchdb.conf /etc/supervisor/conf.d/couchdb.conf\nCOPY supervisor/nginx.conf /etc/supervisor/conf.d/nginx.conf\nCOPY supervisor/postfix.conf /etc/supervisor/conf.d/postfix.conf\nCOPY cozy-init /etc/init.d/cozy-init\nRUN chmod 0644 /etc/supervisor/conf.d/*\n#   Clean APT cache for a lighter image.\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\nEXPOSE 80/tcp 443/tcp\nVOLUME [\"/var/lib/couchdb\", \"/etc/cozy\", \"/usr/local/cozy\", \"/usr/local/var/cozy/\"]\nCMD [\"/usr/local/bin/supervisord\", \"-n\", \"-c\", \"/etc/supervisord.conf\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ubuntu:14.04\nENV DEBIAN_FRONTEND=\"noninteractive\"\n#  Install Cozy tools and dependencies.\nRUN echo \"deb http://ppa.launchpad.net/nginx/stable/ubuntu trusty main\" >> /etc/apt/sources.list \\\n && apt-key adv --keyserver keyserver.ubuntu.com --recv-keys C300EE8C \\\n && apt-get update --quiet \\\n && apt-get install build-essential couchdb curl git imagemagick language-pack-en libffi6 libffi-dev libssl-dev libxml2-dev libxslt1-dev libjpeg-dev lsof nginx postfix pwgen python-dev python-pip python-setuptools python-software-properties software-properties-common sqlite3 wget --quiet --yes\nRUN update-locale LANG=en_US.UTF-8\nRUN pip install supervisor virtualenv\n#  Install NodeJS 4.2.X LTS\nRUN curl -sL https://deb.nodesource.com/setup_4.x | bash -\nRUN apt-get install nodejs -y\n#  Install CoffeeScript, Cozy Monitor and Cozy Controller via NPM.\nRUN npm install coffee-script cozy-controller cozy-monitor -g\n#  Create Cozy users, without home directories.\nRUN useradd -M cozy \\\n && useradd -M cozy-data-system \\\n && useradd -M cozy-home\n#  Configure CouchDB.\nRUN mkdir /etc/cozy \\\n && chown -hR cozy /etc/cozy\nRUN pwgen -1 > /etc/cozy/couchdb.login \\\n && pwgen -1 >> /etc/cozy/couchdb.login \\\n && chown cozy-data-system /etc/cozy/couchdb.login \\\n && chmod 640 /etc/cozy/couchdb.login\nRUN mkdir /var/run/couchdb \\\n && chown -hR couchdb /var/run/couchdb \\\n && su - couchdb -c 'couchdb -b' \\\n && sleep 5 \\\n && while ! curl -s 127.0.0.1:5984 ; do sleep 5 ; done \\\n && curl -s -X PUT 127.0.0.1:5984/_config/admins/$( head -n1 /etc/cozy/couchdb.login ;) -d \"\\\"$( tail -n1 /etc/cozy/couchdb.login ;)\\\"\"\n#  Configure Supervisor.\nADD supervisor/supervisord.conf /etc/supervisord.conf\nRUN mkdir -p /var/log/supervisor \\\n && chmod 777 /var/log/supervisor \\\n && /usr/local/bin/supervisord -c /etc/supervisord.conf\n#  Start up background services and install the Cozy platform apps.\nENV NODE_ENV=\"production\"\nRUN su - couchdb -c 'couchdb -b' \\\n && sleep 5 \\\n && while ! curl -s 127.0.0.1:5984 ; do sleep 5 ; done \\\n && cozy-controller &; sleep 5 \\\n && while ! curl -s 127.0.0.1:9002 ; do sleep 5 ; done \\\n && cozy-monitor install data-system \\\n && cozy-monitor install home \\\n && cozy-monitor install proxy \\\n && curl -X POST http://localhost:9103/api/instance -H \"Content-Type: application/json\" -d '{\"background\":\"background-07\"}' \\\n && for app in calendar contacts photos emails files sync; do cozy-monitor install $app ; done\n#  Configure Nginx and check its configuration by restarting the service.\nADD nginx/nginx.conf /etc/nginx/nginx.conf\nADD nginx/cozy /etc/nginx/sites-available/cozy\nADD nginx/cozy-ssl /etc/nginx/sites-available/cozy-ssl\nRUN chmod 0644 /etc/nginx/sites-available/cozy /etc/nginx/sites-available/cozy-ssl \\\n && rm /etc/nginx/sites-enabled/default \\\n && ln -s /etc/nginx/sites-available/cozy /etc/nginx/sites-enabled/cozy\nRUN nginx -t\n#  Configure Postfix with default parameters.\nENV DISABLE_SSL=\"false\"\nENV POSTFIX_DOMAIN=\"mydomain.net\"\nRUN echo \"postfix postfix/mailname string $POSTFIX_DOMAIN\" | debconf-set-selections \\\n && echo \"postfix postfix/main_mailer_type select Internet Site\" | debconf-set-selections \\\n && echo \"postfix postfix/destinations string $POSTFIX_DOMAIN, localhost.localdomain, localhost \" | debconf-set-selections \\\n && cp /etc/services /var/spool/postfix/etc/ \\\n && cp /etc/resolv.conf /var/spool/postfix/etc \\\n && postfix check\n#  Import Supervisor configuration files.\nADD supervisor/cozy-controller.conf /etc/supervisor/conf.d/cozy-controller.conf\nADD supervisor/cozy-init.conf /etc/supervisor/conf.d/cozy-init.conf\nADD supervisor/couchdb.conf /etc/supervisor/conf.d/couchdb.conf\nADD supervisor/nginx.conf /etc/supervisor/conf.d/nginx.conf\nADD supervisor/postfix.conf /etc/supervisor/conf.d/postfix.conf\nADD cozy-init /etc/init.d/cozy-init\nRUN chmod 0644 /etc/supervisor/conf.d/*\n#  Clean APT cache for a lighter image.\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\nEXPOSE 80/tcp 443/tcp\nVOLUME [\"/var/lib/couchdb\", \"/etc/cozy\", \"/usr/local/cozy\", \"/usr/local/var/cozy/\"]\nCMD [\"/usr/local/bin/supervisord\", \"-n\", \"-c\", \"/etc/supervisord.conf\"]\n","injectedSmells":[],"originalDockerfileHash":"e6dd9cac323d1a5888dc76a86eba7994","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:14.04\nENV DEBIAN_FRONTEND=\"noninteractive\"\n#   Install Cozy tools and dependencies.\nRUN echo \"deb http://ppa.launchpad.net/nginx/stable/ubuntu trusty main\" >> /etc/apt/sources.list \\\n && apt-key adv --keyserver keyserver.ubuntu.com --recv-keys C300EE8C \\\n && apt-get update --quiet \\\n && apt-get install build-essential couchdb curl git imagemagick language-pack-en libffi6 libffi-dev libssl-dev libxml2-dev libxslt1-dev libjpeg-dev lsof nginx postfix pwgen python-dev python-pip python-setuptools python-software-properties software-properties-common sqlite3 wget --quiet --yes\nRUN update-locale LANG=en_US.UTF-8\nRUN pip install supervisor virtualenv\n#   Install NodeJS 4.2.X LTS\nRUN curl -sL https://deb.nodesource.com/setup_4.x | bash -\nRUN apt-get install nodejs -y\n#   Install CoffeeScript, Cozy Monitor and Cozy Controller via NPM.\nRUN npm install coffee-script cozy-controller cozy-monitor -g\n#   Create Cozy users, without home directories.\nRUN useradd -M cozy \\\n && useradd -M cozy-data-system \\\n && useradd -M cozy-home\n#   Configure CouchDB.\nRUN mkdir /etc/cozy \\\n && chown -hR cozy /etc/cozy\nRUN pwgen -1 > /etc/cozy/couchdb.login \\\n && pwgen -1 >> /etc/cozy/couchdb.login \\\n && chown cozy-data-system /etc/cozy/couchdb.login \\\n && chmod 640 /etc/cozy/couchdb.login\nRUN mkdir /var/run/couchdb \\\n && chown -hR couchdb /var/run/couchdb \\\n && su - couchdb -c 'couchdb -b' \\\n && sleep 5 \\\n && while ! curl -s 127.0.0.1:5984 ; do sleep 5 ; done \\\n && curl -s -X PUT 127.0.0.1:5984/_config/admins/$( head -n1 /etc/cozy/couchdb.login ;) -d \"\\\"$( tail -n1 /etc/cozy/couchdb.login ;)\\\"\"\n#   Configure Supervisor.\nADD supervisor/supervisord.conf /etc/supervisord.conf\nRUN mkdir -p /var/log/supervisor \\\n && chmod 777 /var/log/supervisor \\\n && /usr/local/bin/supervisord -c /etc/supervisord.conf\n#   Start up background services and install the Cozy platform apps.\nENV NODE_ENV=\"production\"\nRUN su - couchdb -c 'couchdb -b' \\\n && sleep 5 \\\n && while ! curl -s 127.0.0.1:5984 ; do sleep 5 ; done \\\n && cozy-controller &; sleep 5 \\\n && while ! curl -s 127.0.0.1:9002 ; do sleep 5 ; done \\\n && cozy-monitor install data-system \\\n && cozy-monitor install home \\\n && cozy-monitor install proxy \\\n && curl -X POST http://localhost:9103/api/instance -H \"Content-Type: application/json\" -d '{\"background\":\"background-07\"}' \\\n && for app in calendar contacts photos emails files sync; do cozy-monitor install $app ; done\n#   Configure Nginx and check its configuration by restarting the service.\nADD nginx/nginx.conf /etc/nginx/nginx.conf\nADD nginx/cozy /etc/nginx/sites-available/cozy\nADD nginx/cozy-ssl /etc/nginx/sites-available/cozy-ssl\nRUN chmod 0644 /etc/nginx/sites-available/cozy /etc/nginx/sites-available/cozy-ssl \\\n && rm /etc/nginx/sites-enabled/default \\\n && ln -s /etc/nginx/sites-available/cozy /etc/nginx/sites-enabled/cozy\nRUN nginx -t\n#   Configure Postfix with default parameters.\nENV DISABLE_SSL=\"false\"\nENV POSTFIX_DOMAIN=\"mydomain.net\"\nRUN echo \"postfix postfix/mailname string $POSTFIX_DOMAIN\" | debconf-set-selections \\\n && echo \"postfix postfix/main_mailer_type select Internet Site\" | debconf-set-selections \\\n && echo \"postfix postfix/destinations string $POSTFIX_DOMAIN, localhost.localdomain, localhost \" | debconf-set-selections \\\n && cp /etc/services /var/spool/postfix/etc/ \\\n && cp /etc/resolv.conf /var/spool/postfix/etc \\\n && postfix check\n#   Import Supervisor configuration files.\nADD supervisor/cozy-controller.conf /etc/supervisor/conf.d/cozy-controller.conf\nADD supervisor/cozy-init.conf /etc/supervisor/conf.d/cozy-init.conf\nADD supervisor/couchdb.conf /etc/supervisor/conf.d/couchdb.conf\nADD supervisor/nginx.conf /etc/supervisor/conf.d/nginx.conf\nADD supervisor/postfix.conf /etc/supervisor/conf.d/postfix.conf\nADD cozy-init /etc/init.d/cozy-init\nRUN chmod 0644 /etc/supervisor/conf.d/*\n#   Clean APT cache for a lighter image.\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\nEXPOSE 80/tcp 443/tcp\nVOLUME [\"/var/lib/couchdb\", \"/etc/cozy\", \"/usr/local/cozy\", \"/usr/local/var/cozy/\"]\nCMD [\"/usr/local/bin/supervisord\", \"-n\", \"-c\", \"/etc/supervisord.conf\"]\n","originalDockerfileUglifiedHash":"3ba8f79520fd6ba8ae5a54cb6e10c892","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/37402cb829071d8d04b4eeb8fe1698ebfc32811e.dockerfile"}