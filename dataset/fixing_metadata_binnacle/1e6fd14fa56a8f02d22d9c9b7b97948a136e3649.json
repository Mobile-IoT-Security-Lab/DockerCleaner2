{"seed":2036391651,"processedDockerfileHash":"db74431fbec753a7b4e6ae76e4e991fe","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   upstream https://github.com/docker-library/postgres\n#   vim:set ft=dockerfile:\nFROM alpine:3.5\n#   Container variables\nENV TERM=\"xterm\" \\\n    LANG=\"en_US.UTF-8\" \\\n    LANGUAGE=\"en_US.UTF-8\" \\\n    LC_ALL=\"en_US.UTF-8\" \\\n    TIMEZONE=\"Asia/Shanghai\"\n#   Set timezone and locales\nRUN set -ex \\\n && apk update \\\n && apk upgrade \\\n && apk add tzdata=2016i-r0 \\\n && echo \"${TIMEZONE}\" > /etc/TZ \\\n && ln -sf /usr/share/zoneinfo/${TIMEZONE} /etc/localtime \\\n && apk add ca-certificates=20161130-r1 apache2-utils=2.4.35-r0 \\\n && rm -f /var/cache/apk/*.tar.gz\n#   alpine includes \"postgres\" user/group in base install\n#     /etc/passwd:22:postgres:x:70:70::/var/lib/postgresql:/bin/sh\n#     /etc/group:34:postgres:x:70:\n#   the home directory for the postgres user, however, is not created by default\n#   see https://github.com/docker-library/postgres/issues/274\nRUN set -ex ; postgresHome=\"$( getent passwd postgres ;)\" ; postgresHome=\"$( echo \"$postgresHome\" | cut -d: -f6 ;)\" ; [ \"$postgresHome\" = '/var/lib/postgresql' ] ; mkdir -p \"$postgresHome\" ; chown -R postgres:postgres \"$postgresHome\"\n#   su-exec (gosu-compatible) is installed further down\n#   make the \"en_US.UTF-8\" locale so postgres will be utf-8 enabled by default\n#   alpine doesn't require explicit locale-file generation\n#  ENV LANG en_US.utf8\nRUN mkdir /docker-entrypoint-initdb.d\nENV PG_MAJOR=\"9.4\"\nENV PG_VERSION=\"9.4.15\"\nENV PG_SHA256=\"12bfb3c7e8e45515ef921ad365e122682a5c4935dcc0032644433af2de31acc4\"\nRUN set -ex \\\n && apk add ca-certificates=20161130-r1 openssl=1.0.2q-r0 tar=1.29-r1 --no-cache --virtual .fetch-deps \\\n && wget -O postgresql.tar.bz2 \"https://ftp.postgresql.org/pub/source/v$PG_VERSION/postgresql-$PG_VERSION.tar.bz2\" \\\n && echo \"$PG_SHA256 *postgresql.tar.bz2\" | sha256sum -c - \\\n && mkdir -p /usr/src/postgresql \\\n && tar --extract --file postgresql.tar.bz2 --directory /usr/src/postgresql --strip-components 1 \\\n && rm postgresql.tar.bz2 \\\n && apk add bison=3.0.4-r0 coreutils=8.26-r0 dpkg-dev=1.18.10-r0 dpkg=1.18.10-r0 flex=2.6.1-r1 gcc=6.2.1-r1 libc-dev=0.7-r1 libedit-dev=20150325.3.1-r3 libxml2-dev=2.9.8-r1 libxslt-dev=1.1.29-r1 make=4.2.1-r0 openssl-dev=1.0.2q-r0 perl=5.24.4-r1 perl-ipc-run=0.94-r0 util-linux-dev=2.28.2-r1 zlib-dev=1.2.11-r0 --no-cache --virtual .build-deps \\\n && cd /usr/src/postgresql \\\n && awk '$1 == \"#define\" \\\n && $2 == \"DEFAULT_PGSOCKET_DIR\" \\\n && $3 == \"\\\"/tmp\\\"\" { $3 = \"\\\"/var/run/postgresql\\\"\"; print; next } { print }' src/include/pg_config_manual.h > src/include/pg_config_manual.h.new \\\n && grep '/var/run/postgresql' src/include/pg_config_manual.h.new \\\n && mv src/include/pg_config_manual.h.new src/include/pg_config_manual.h \\\n && gnuArch=\"$( dpkg-architecture --query DEB_BUILD_GNU_TYPE ;)\" \\\n && wget -O config/config.guess 'https://git.savannah.gnu.org/cgit/config.git/plain/config.guess?id=7d3d27baf8107b630586c962c057e22149653deb' \\\n && wget -O config/config.sub 'https://git.savannah.gnu.org/cgit/config.git/plain/config.sub?id=7d3d27baf8107b630586c962c057e22149653deb' \\\n && ./configure --build=\"$gnuArch\" --enable-integer-datetimes --enable-thread-safety --enable-tap-tests --disable-rpath --with-uuid=e2fs --with-gnu-ld --with-pgport=5432 --with-system-tzdata=/usr/share/zoneinfo --prefix=/usr/local --with-includes=/usr/local/include --with-libraries=/usr/local/lib --with-openssl --with-libxml --with-libxslt \\\n && make -j \"$( nproc ;)\" world \\\n && make install-world \\\n && make -C contrib install \\\n && runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" \\\n && apk add bash=4.3.46-r5 su-exec=0.2-r0 tzdata=2016i-r0 $runDeps --no-cache --virtual .postgresql-rundeps \\\n && apk del .fetch-deps .build-deps \\\n && cd / \\\n && rm -rf /usr/src/postgresql /usr/local/share/doc /usr/local/share/man \\\n && find /usr/local -name '*.a' -delete\n#   make the sample config easier to munge (and \"correct by default\")\nRUN sed -ri \"s!^#?(listen_addresses)\\s*=\\s*\\S+.*!\\1 = '*'!\" /usr/local/share/postgresql/postgresql.conf.sample\nRUN mkdir -p /var/run/postgresql \\\n && chown -R postgres:postgres /var/run/postgresql \\\n && chmod 2777 /var/run/postgresql\nENV PGDATA=\"/var/lib/postgresql/data\"\nRUN mkdir -p \"$PGDATA\" \\\n && chown -R postgres:postgres \"$PGDATA\" \\\n && chmod 777 \"$PGDATA\"\nVOLUME /var/lib/postgresql/data\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN ln -s usr/local/bin/docker-entrypoint.sh /\nENTRYPOINT [\"docker-entrypoint.sh\"]\nEXPOSE 5432/tcp\nCMD [\"postgres\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  upstream https://github.com/docker-library/postgres\n#  vim:set ft=dockerfile:\nFROM alpine:3.5\n#  Container variables\nENV TERM=\"xterm\" \\\n    LANG=\"en_US.UTF-8\" \\\n    LANGUAGE=\"en_US.UTF-8\" \\\n    LC_ALL=\"en_US.UTF-8\" \\\n    TIMEZONE=\"Asia/Shanghai\"\n#  Set timezone and locales\nRUN set -ex \\\n && apk update \\\n && apk upgrade \\\n && apk add tzdata \\\n && echo \"${TIMEZONE}\" > /etc/TZ \\\n && ln -sf /usr/share/zoneinfo/${TIMEZONE} /etc/localtime \\\n && apk add ca-certificates apache2-utils \\\n && rm -f /var/cache/apk/*.tar.gz\n#  alpine includes \"postgres\" user/group in base install\n#    /etc/passwd:22:postgres:x:70:70::/var/lib/postgresql:/bin/sh\n#    /etc/group:34:postgres:x:70:\n#  the home directory for the postgres user, however, is not created by default\n#  see https://github.com/docker-library/postgres/issues/274\nRUN set -ex ; postgresHome=\"$( getent passwd postgres ;)\" ; postgresHome=\"$( echo \"$postgresHome\" | cut -d: -f6 ;)\" ; [ \"$postgresHome\" = '/var/lib/postgresql' ] ; mkdir -p \"$postgresHome\" ; chown -R postgres:postgres \"$postgresHome\"\n#  su-exec (gosu-compatible) is installed further down\n#  make the \"en_US.UTF-8\" locale so postgres will be utf-8 enabled by default\n#  alpine doesn't require explicit locale-file generation\n# ENV LANG en_US.utf8\nRUN mkdir /docker-entrypoint-initdb.d\nENV PG_MAJOR=\"9.4\"\nENV PG_VERSION=\"9.4.15\"\nENV PG_SHA256=\"12bfb3c7e8e45515ef921ad365e122682a5c4935dcc0032644433af2de31acc4\"\nRUN set -ex \\\n && apk add --no-cache --virtual .fetch-deps ca-certificates openssl tar \\\n && wget -O postgresql.tar.bz2 \"https://ftp.postgresql.org/pub/source/v$PG_VERSION/postgresql-$PG_VERSION.tar.bz2\" \\\n && echo \"$PG_SHA256 *postgresql.tar.bz2\" | sha256sum -c - \\\n && mkdir -p /usr/src/postgresql \\\n && tar --extract --file postgresql.tar.bz2 --directory /usr/src/postgresql --strip-components 1 \\\n && rm postgresql.tar.bz2 \\\n && apk add --no-cache --virtual .build-deps bison coreutils dpkg-dev dpkg flex gcc libc-dev libedit-dev libxml2-dev libxslt-dev make openssl-dev perl perl-ipc-run util-linux-dev zlib-dev \\\n && cd /usr/src/postgresql \\\n && awk '$1 == \"#define\" \\\n && $2 == \"DEFAULT_PGSOCKET_DIR\" \\\n && $3 == \"\\\"/tmp\\\"\" { $3 = \"\\\"/var/run/postgresql\\\"\"; print; next } { print }' src/include/pg_config_manual.h > src/include/pg_config_manual.h.new \\\n && grep '/var/run/postgresql' src/include/pg_config_manual.h.new \\\n && mv src/include/pg_config_manual.h.new src/include/pg_config_manual.h \\\n && gnuArch=\"$( dpkg-architecture --query DEB_BUILD_GNU_TYPE ;)\" \\\n && wget -O config/config.guess 'https://git.savannah.gnu.org/cgit/config.git/plain/config.guess?id=7d3d27baf8107b630586c962c057e22149653deb' \\\n && wget -O config/config.sub 'https://git.savannah.gnu.org/cgit/config.git/plain/config.sub?id=7d3d27baf8107b630586c962c057e22149653deb' \\\n && ./configure --build=\"$gnuArch\" --enable-integer-datetimes --enable-thread-safety --enable-tap-tests --disable-rpath --with-uuid=e2fs --with-gnu-ld --with-pgport=5432 --with-system-tzdata=/usr/share/zoneinfo --prefix=/usr/local --with-includes=/usr/local/include --with-libraries=/usr/local/lib --with-openssl --with-libxml --with-libxslt \\\n && make -j \"$( nproc ;)\" world \\\n && make install-world \\\n && make -C contrib install \\\n && runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" \\\n && apk add --no-cache --virtual .postgresql-rundeps $runDeps bash su-exec tzdata \\\n && apk del .fetch-deps .build-deps \\\n && cd / \\\n && rm -rf /usr/src/postgresql /usr/local/share/doc /usr/local/share/man \\\n && find /usr/local -name '*.a' -delete\n#  make the sample config easier to munge (and \"correct by default\")\nRUN sed -ri \"s!^#?(listen_addresses)\\s*=\\s*\\S+.*!\\1 = '*'!\" /usr/local/share/postgresql/postgresql.conf.sample\nRUN mkdir -p /var/run/postgresql \\\n && chown -R postgres:postgres /var/run/postgresql \\\n && chmod 2777 /var/run/postgresql\nENV PGDATA=\"/var/lib/postgresql/data\"\nRUN mkdir -p \"$PGDATA\" \\\n && chown -R postgres:postgres \"$PGDATA\" \\\n && chmod 777 \"$PGDATA\"\nVOLUME /var/lib/postgresql/data\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN ln -s usr/local/bin/docker-entrypoint.sh /\nENTRYPOINT [\"docker-entrypoint.sh\"]\nEXPOSE 5432/tcp\nCMD [\"postgres\"]\n","injectedSmells":[],"originalDockerfileHash":"f9abe3fac0a51832175c4df87960dee3","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   upstream https://github.com/docker-library/postgres\n#   vim:set ft=dockerfile:\nFROM alpine:3.5\n#   Container variables\nENV TERM=\"xterm\" \\\n    LANG=\"en_US.UTF-8\" \\\n    LANGUAGE=\"en_US.UTF-8\" \\\n    LC_ALL=\"en_US.UTF-8\" \\\n    TIMEZONE=\"Asia/Shanghai\"\n#   Set timezone and locales\nRUN set -ex \\\n && apk update \\\n && apk upgrade \\\n && apk add tzdata \\\n && echo \"${TIMEZONE}\" > /etc/TZ \\\n && ln -sf /usr/share/zoneinfo/${TIMEZONE} /etc/localtime \\\n && apk add ca-certificates apache2-utils \\\n && rm -f /var/cache/apk/*.tar.gz\n#   alpine includes \"postgres\" user/group in base install\n#     /etc/passwd:22:postgres:x:70:70::/var/lib/postgresql:/bin/sh\n#     /etc/group:34:postgres:x:70:\n#   the home directory for the postgres user, however, is not created by default\n#   see https://github.com/docker-library/postgres/issues/274\nRUN set -ex ; postgresHome=\"$( getent passwd postgres ;)\" ; postgresHome=\"$( echo \"$postgresHome\" | cut -d: -f6 ;)\" ; [ \"$postgresHome\" = '/var/lib/postgresql' ] ; mkdir -p \"$postgresHome\" ; chown -R postgres:postgres \"$postgresHome\"\n#   su-exec (gosu-compatible) is installed further down\n#   make the \"en_US.UTF-8\" locale so postgres will be utf-8 enabled by default\n#   alpine doesn't require explicit locale-file generation\n#  ENV LANG en_US.utf8\nRUN mkdir /docker-entrypoint-initdb.d\nENV PG_MAJOR=\"9.4\"\nENV PG_VERSION=\"9.4.15\"\nENV PG_SHA256=\"12bfb3c7e8e45515ef921ad365e122682a5c4935dcc0032644433af2de31acc4\"\nRUN set -ex \\\n && apk add --no-cache --virtual .fetch-deps ca-certificates openssl tar \\\n && wget -O postgresql.tar.bz2 \"https://ftp.postgresql.org/pub/source/v$PG_VERSION/postgresql-$PG_VERSION.tar.bz2\" \\\n && echo \"$PG_SHA256 *postgresql.tar.bz2\" | sha256sum -c - \\\n && mkdir -p /usr/src/postgresql \\\n && tar --extract --file postgresql.tar.bz2 --directory /usr/src/postgresql --strip-components 1 \\\n && rm postgresql.tar.bz2 \\\n && apk add --no-cache --virtual .build-deps bison coreutils dpkg-dev dpkg flex gcc libc-dev libedit-dev libxml2-dev libxslt-dev make openssl-dev perl perl-ipc-run util-linux-dev zlib-dev \\\n && cd /usr/src/postgresql \\\n && awk '$1 == \"#define\" \\\n && $2 == \"DEFAULT_PGSOCKET_DIR\" \\\n && $3 == \"\\\"/tmp\\\"\" { $3 = \"\\\"/var/run/postgresql\\\"\"; print; next } { print }' src/include/pg_config_manual.h > src/include/pg_config_manual.h.new \\\n && grep '/var/run/postgresql' src/include/pg_config_manual.h.new \\\n && mv src/include/pg_config_manual.h.new src/include/pg_config_manual.h \\\n && gnuArch=\"$( dpkg-architecture --query DEB_BUILD_GNU_TYPE ;)\" \\\n && wget -O config/config.guess 'https://git.savannah.gnu.org/cgit/config.git/plain/config.guess?id=7d3d27baf8107b630586c962c057e22149653deb' \\\n && wget -O config/config.sub 'https://git.savannah.gnu.org/cgit/config.git/plain/config.sub?id=7d3d27baf8107b630586c962c057e22149653deb' \\\n && ./configure --build=\"$gnuArch\" --enable-integer-datetimes --enable-thread-safety --enable-tap-tests --disable-rpath --with-uuid=e2fs --with-gnu-ld --with-pgport=5432 --with-system-tzdata=/usr/share/zoneinfo --prefix=/usr/local --with-includes=/usr/local/include --with-libraries=/usr/local/lib --with-openssl --with-libxml --with-libxslt \\\n && make -j \"$( nproc ;)\" world \\\n && make install-world \\\n && make -C contrib install \\\n && runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" \\\n && apk add --no-cache --virtual .postgresql-rundeps $runDeps bash su-exec tzdata \\\n && apk del .fetch-deps .build-deps \\\n && cd / \\\n && rm -rf /usr/src/postgresql /usr/local/share/doc /usr/local/share/man \\\n && find /usr/local -name '*.a' -delete\n#   make the sample config easier to munge (and \"correct by default\")\nRUN sed -ri \"s!^#?(listen_addresses)\\s*=\\s*\\S+.*!\\1 = '*'!\" /usr/local/share/postgresql/postgresql.conf.sample\nRUN mkdir -p /var/run/postgresql \\\n && chown -R postgres:postgres /var/run/postgresql \\\n && chmod 2777 /var/run/postgresql\nENV PGDATA=\"/var/lib/postgresql/data\"\nRUN mkdir -p \"$PGDATA\" \\\n && chown -R postgres:postgres \"$PGDATA\" \\\n && chmod 777 \"$PGDATA\"\nVOLUME /var/lib/postgresql/data\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN ln -s usr/local/bin/docker-entrypoint.sh /\nENTRYPOINT [\"docker-entrypoint.sh\"]\nEXPOSE 5432/tcp\nCMD [\"postgres\"]\n","originalDockerfileUglifiedHash":"c9060b3919cd8b8b793775f19bc5d609","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/1e6fd14fa56a8f02d22d9c9b7b97948a136e3649.dockerfile"}