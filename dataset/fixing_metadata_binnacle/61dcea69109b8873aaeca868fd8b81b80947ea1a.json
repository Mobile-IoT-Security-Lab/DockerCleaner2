{"seed":3289354040,"processedDockerfileHash":"dc42cf98e22bea2f1e0453568a9d43e7","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","use-copy-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM ubuntu:16.04\nMAINTAINER Menzo Windhouwer <menzo.windhouwer@meertens.knaw.nl>\n#\n#   Configure FLAT\n#\nENV FLAT_NAME=\"flat\"\n#  ENV FLAT_HOST=192.168.99.100\nENV FLAT_HOST=\"localhost\"\nENV FLAT_ICON_DIR=\"/app/flat/data/icons\"\nENV FLAT_TIMEOUT=\"150\"\nENV CMD_EXTENSION=\"cmdi\"\nENV FLAT_NAMESPACE=\"lat\"\n#\n#   Setup workdir\n#\nRUN mkdir -p /app/flat/lib \\\n && mkdir -p /app/flat/bin \\\n && mkdir -p /app/flat/tmp\nWORKDIR /app/flat\nENV HOME=\"/root\"\nENV PATH=\"/app/flat/bin:${PATH}\"\n#   expose ports\nEXPOSE 80/tcp\nEXPOSE 8080/tcp\n#\n#   locale\n#\nENV TZ=\"'Europe/Amsterdam'\"\nRUN echo $TZ > /etc/timezone \\\n && apt-get update \\\n && apt-get install --no-install-recommends tzdata=2021a-0ubuntu0.16.04 -y \\\n && rm /etc/localtime \\\n && ln -snf /usr/share/zoneinfo/$TZ /etc/localtime \\\n && dpkg-reconfigure -f noninteractive tzdata\nRUN apt-get update \\\n && apt-get install --no-install-recommends locales=2.23-0ubuntu11.3 -y \\\n && sed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen \\\n && echo 'LANG=\"en_US.UTF-8\"' > /etc/default/locale \\\n && dpkg-reconfigure --frontend=noninteractive locales \\\n && update-locale LANG=en_US.UTF-8\nENV LANG=\"\\\"en_US.UTF-8\\\"\"\nENV LANGUAGE=\"\\\"en_US.UTF-8\\\"\"\nENV LC_ALL=\"\\\"en_US.UTF-8\\\"\"\n#\n#   Update and install all system libraries\n#\nRUN apt-get update \\\n && apt-get -y dist-upgrade \\\n && apt-get install --no-install-recommends supervisor=3.2.0-2ubuntu0.2 curl=7.47.0-1ubuntu2.19 wget=1.17.1-1ubuntu1.5 openssl=1.0.2g-1ubuntu4.20 apache2=2.4.18-2ubuntu3.17 postgresql=9.5+173ubuntu0.3 unzip=6.0-20ubuntu1.1 ssh=1:7.2p2-4ubuntu2.10 rsync=3.1.1-3ubuntu1.3 git=1:2.7.4-0ubuntu1.10 -y\n#   PHP\nRUN apt-get install --no-install-recommends libapache2-mod-php=1:7.0+35ubuntu6.1 php-gd=1:7.0+35ubuntu6.1 php-pgsql=1:7.0+35ubuntu6.1 php-xsl php-curl=1:7.0+35ubuntu6.1 -y\n#   Java 8\nRUN apt-get install --no-install-recommends software-properties-common=0.96.20.10 python-software-properties=0.96.20.10 -y \\\n && add-apt-repository ppa:webupd8team/java \\\n && apt-get update \\\n && echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true | /usr/bin/debconf-set-selections \\\n && apt-get install --no-install-recommends oracle-java8-installer maven=3.3.9-3 -y\nENV JAVA_HOME=\"\\\"/usr/lib/jvm/java-8-oracle\\\"\"\n#   dev\nRUN apt-get install --no-install-recommends libxml2-utils=2.9.3+dfsg1-1ubuntu0.7 vim=2:7.4.1689-3ubuntu1.5 -y\n#\n#   Configure apache\n#     - set apache ulimit to 1024\nCOPY apache/envvars /etc/apache2/envvars\nCOPY apache/apache2.conf /etc/apache2/apache2.conf\nRUN a2enmod ssl \\\n && a2enmod rewrite \\\n && a2enmod proxy \\\n && a2enmod proxy_http \\\n && a2enmod sed \\\n && sed -i \"s|FLAT_NAME|${FLAT_NAME}|g\" /etc/apache2/apache2.conf\n#\n#   Configure postgres\n#     - initialise databases for fedora and drupal\nCOPY postgresql/wait-postgres.sh /wait-postgres.sh\nCOPY postgresql/wait-sergtsop.sh /wait-sergtsop.sh\nRUN chmod u+x /wait-postgres.sh \\\n && chmod u+x /wait-sergtsop.sh \\\n && /etc/init.d/postgresql start \\\n && /wait-postgres.sh \\\n && su -c \"psql -c \\\"CREATE USER fedora WITH PASSWORD 'fedora'\\\"\" postgres \\\n && su -c \"createdb -O fedora fedora\" postgres \\\n && su -c \"createdb -O fedora proai\" postgres \\\n && su -c \"createdb -O fedora --encoding=UNICODE -T template0 drupal\" postgres \\\n && /etc/init.d/postgresql stop \\\n && /wait-sergtsop.sh\n#\n#   Download packages for the islandora setup\n#     - fedora commons\n#     - proai\n#     - drupal\n#         - tuque\n#     - islandora\n#\nENV FEDORA_HOME=\"/var/www/fedora\"\nENV CATALINA_HOME=\"/var/www/fedora/tomcat\"\nRUN mkdir /tmp/fedora \\\n && cd /tmp/fedora \\\n && wget \"https://github.com/fcrepo3/fcrepo/releases/download/v3.8.1/fcrepo-installer-3.8.1.jar\"\nCOPY fedora/install.properties /tmp/fedora/install.properties\nRUN /etc/init.d/postgresql start \\\n && /wait-postgres.sh \\\n && cd /tmp/fedora \\\n && java -jar fcrepo-installer-3.8.1.jar install.properties \\\n && /etc/init.d/postgresql stop \\\n && /wait-sergtsop.sh\n#   tell fedora about CMDI\nRUN sed -i 's|</mappings>|<mime-mapping><mime-type>application/x-cmdi+xml</mime-type><extension>cmdi</extension></mime-mapping></mappings>|g' /var/www/fedora/server/config/mime-to-extensions.xml\n#\n#   All services are installed, add start script to automatically start required services\n#\nCOPY flat.txt /flat.txt\nCOPY supervisor/start-*.sh /\nRUN chmod u+x /start-*.sh\nCOPY supervisor/*.conf /etc/supervisor/conf.d/\nCOPY supervisor/start.sh /start.sh\nRUN chmod u+x /start.sh\nRUN echo \". /etc/environment\" >> /etc/default/supervisor\nENTRYPOINT /start.sh\n#\n#   starting fedora will initialize required directories\n#\nCOPY fedora/wait-tomcat.sh /wait-tomcat.sh\nRUN chmod u+x /wait-tomcat.sh \\\n && service supervisor start \\\n && /wait-postgres.sh \\\n && supervisorctl start tomcat \\\n && /wait-tomcat.sh \\\n && supervisorctl stop all \\\n && service supervisor stop \\\n && /wait-sergtsop.sh\n#   policies\nRUN rm -v /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-purge-*\nRUN rm -v /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-policy-management-if-not-administrator.xml\nRUN rm -v /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-inactive-or-deleted-objects-or-datastreams-if-not-administrator.xml\nCOPY fedora/deny-deleted-objects-or-datastreams-if-not-administrator.xml /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-deleted-objects-or-datastreams-if-not-administrator.xml\nCOPY fedora/permit-anything-to-localhost.xml /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/permit-anything-to-localhost.xml\nCOPY fedora/deny-unallowed-file-resolution.xml /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-unallowed-file-resolution.xml\nRUN cd /var/www/fedora/data/fedora-xacml-policies/repository-policies/ \\\n && wget https://github.com/Islandora/islandora-xacml-policies/archive/master.zip \\\n && unzip master.zip \\\n && rm master.zip \\\n && mv islandora-xacml-policies-master islandora\n#   authorisation filter\nRUN cd /var/www/fedora/tomcat/webapps/fedora/WEB-INF/lib \\\n && wget \"https://github.com/Islandora/islandora_drupal_filter/releases/download/7.1.10/fcrepo-drupalauthfilter-3.8.1.jar\"\nCOPY fedora/jaas.conf /var/www/fedora/server/config/jaas.conf\nCOPY fedora/filter-drupal.xml /var/www/fedora/server/config/filter-drupal.xml\n#  #Download and configure drupal (via drush)\nRUN mkdir -p /var/www/composer \\\n && cd /var/www/composer \\\n && curl -sS https://getcomposer.org/installer | php \\\n && mv composer.phar composer\nENV COMPOSER_HOME=\"/var/www/composer\"\nRUN $COMPOSER_HOME/composer global require drush/drush:7.*\nRUN cd /var/www/html \\\n && /var/www/composer/vendor/drush/drush/drush -v dl drupal --drupal-project-rename=$FLAT_NAME\n# A secret has been removed here. Please do not provide secrets from the Dockerfile as these will leak into the metadata of the resulting docker image. To provide secrets the --secret flag of the docker build command can be used (https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information).\nRUN service supervisor start \\\n && /wait-postgres.sh \\\n && supervisorctl start tomcat \\\n && /wait-tomcat.sh \\\n && cd /var/www/html/$FLAT_NAME \\\n && export PHP_OPTIONS=\"-d sendmail_path=`which true `\" \\\n && /var/www/composer/vendor/drush/drush/drush site-install standard --site-name=FLAT --account-name=admin --account-pass=admin --db-su=fedora --db-su-pw=fedora --db-url=pgsql://fedora:fedora@localhost/drupal -y \\\n && supervisorctl stop all \\\n && service supervisor stop \\\n && /wait-sergtsop.sh\nRUN mkdir -p /var/www/html/$FLAT_NAME/sites/all/modules/custom \\\n && chown www-data:www-data /var/www/html/$FLAT_NAME/sites/default/files \\\n && chown www-data:www-data /var/www/html/$FLAT_NAME/sites/default/settings.php \\\n && chown www-data:www-data /var/www/html/$FLAT_NAME/sites/all/modules/custom\nCOPY drupal/flat-logo.png /var/www/html/$FLAT_NAME/sites/default/files/flat-logo.png\nCOPY drupal/flat /var/www/html/$FLAT_NAME/sites/all/modules/custom/\nCOPY drupal/flat-logo.php /tmp/\n#   To check accessibility we use a HEAD request using the http(s)?://<user>:<pass>@<host>(:<port>)?/<path>... support of drupal_http_request\n#   however if the username or password does contain funny characters no escaping is supported\n#   this change allows to use rawurlencode, as drupal_http_request will now do a rawurldecode\nRUN sed -i \"s|base64_encode($uri\\['user'\\]|base64_encode(rawurldecode($uri['user'])|g\" /var/www/html/$FLAT_NAME/includes/common.inc \\\n && sed -i \"s| $uri\\['pass'\\] | rawurldecode($uri['pass']) |g\" /var/www/html/$FLAT_NAME/includes/common.inc\nRUN mkdir /tmp/tuque \\\n && cd /tmp/tuque \\\n && wget \"https://github.com/islandora/tuque/archive/1.10.zip\" \\\n && unzip 1.10.zip \\\n && mv /tmp/tuque/tuque-1.10 /var/www/html/$FLAT_NAME/sites/all/libraries/tuque \\\n && sed -i 's|public $verifyPeer = TRUE;|public $verifyPeer = FALSE;|g' /var/www/html/$FLAT_NAME/sites/all/libraries/tuque/HttpConnection.php\nRUN mkdir -p /tmp/islandora \\\n && mkdir -p /var/www/html/$FLAT_NAME/sites/all/modules/contrib \\\n && mkdir -p /var/www/html/$FLAT_NAME/sites/all/themes \\\n && cd /tmp/islandora \\\n && wget \"https://github.com/Islandora/islandora/archive/7.x-1.10.tar.gz\" \\\n && tar -xf 7.x-1.10.tar.gz -C /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ \\\n && cd /tmp/islandora \\\n && wget -O islandora_solution_pack_collection-7.x-1.10.zip \"https://github.com/islandora/islandora_solution_pack_collection/archive/7.x-1.10.zip\" \\\n && unzip islandora_solution_pack_collection-7.x-1.10.zip -d /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ \\\n && cd /tmp/islandora \\\n && wget -O islandora_xacml_editor-7.x-1.10.zip \"https://github.com/Islandora/islandora_xacml_editor/archive/7.x-1.10.zip\" \\\n && unzip islandora_xacml_editor-7.x-1.10.zip -d /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ \\\n && cd /tmp/islandora \\\n && wget -O islandora_solution_pack_compound-7.x-1.10.zip \"https://github.com/Islandora/islandora_solution_pack_compound/archive/7.x-1.10.zip\" \\\n && unzip islandora_solution_pack_compound-7.x-1.10.zip -d /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ \\\n && sed -i 's|function islandora_compound_object_islandora_compoundCModel_islandora_view_object|function islandora_compound_object_islandora_compoundCModel_islandora_view_object_DISABLED_BY_FLAT|g' /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora_solution_pack_compound-7.x-1.10/islandora_compound_object.module\n#   overwrites the collection object view, so we get file details\nCOPY islandora/islandora_basic_collection.module /var/www/html/flat/sites/all/modules/contrib/islandora_solution_pack_collection-7.x-1.10/islandora_basic_collection.module\n#   add CMDI solution pack\nRUN mkdir -p /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora_solution_pack_cmdi\nCOPY flat/islandora_solution_pack_cmdi /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora_solution_pack_cmdi\n#   tell islandora about CMDI\nRUN sed -i \"/\\\"json\\\"/a \\\"cmdi\\\" => \\\"application/x-cmdi+xml\\\",\" /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora-7.x-1.10/includes/mimetype.utils.inc \\\n && sed -i \"/header('Content-type: ' . $datastream/a if ($datastream->ID == 'CMD') {\\nheader('Content-type: ' . 'application/xml');\\n}\" /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora-7.x-1.10/includes/datastream.inc\nRUN mkdir -p /tmp/bootstrap \\\n && cd /tmp/bootstrap \\\n && wget \"https://ftp.drupal.org/files/projects/bootstrap-7.x-3.14.zip\" \\\n && unzip bootstrap-7.x-3.14.zip \\\n && mv /tmp/bootstrap/bootstrap /var/www/html/$FLAT_NAME/sites/all/themes/bootstrap\nRUN cp -r /var/www/html/$FLAT_NAME/sites/all/themes/bootstrap/starterkits/cdn /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme \\\n && cd /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/ \\\n && mv cdn.starterkit flat_bootstrap_theme.info \\\n && echo \";; FLAT settings\" >> flat_bootstrap_theme.info \\\n && echo \"settings[bootstrap_cdn_jsdelivr_theme] = 'flatly'\" >> flat_bootstrap_theme.info \\\n && echo \"settings[bootstrap_fluid_container] = 1\" >> flat_bootstrap_theme.info \\\n && mkdir -p /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/js\n#   determine our own object view\nCOPY islandora/islandora-default.tpl.php /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/templates/islandora-default.tpl.php\n#   overwrite the compound behavior, which does special things for the first member (as being the representative)\nCOPY islandora/template.php /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/template.php\nCOPY islandora/flat.js /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/js/flat.js\nRUN service supervisor start \\\n && /wait-postgres.sh \\\n && supervisorctl start tomcat \\\n && /wait-tomcat.sh \\\n && cd /var/www/html/$FLAT_NAME/ \\\n && /var/www/composer/vendor/drush/drush/drush vset islandora_base_url http://localhost:8080/fedora \\\n && /var/www/composer/vendor/drush/drush/drush en islandora -y \\\n && /var/www/composer/vendor/drush/drush/drush en islandora_xacml_editor -y \\\n && /var/www/composer/vendor/drush/drush/drush en islandora_basic_collection -y \\\n && /var/www/composer/vendor/drush/drush/drush en islandora_compound_object -y \\\n && /var/www/composer/vendor/drush/drush/drush en islandora_cmdi -y \\\n && /var/www/composer/vendor/drush/drush/drush vset islandora_metadata_display cmdi \\\n && /var/www/composer/vendor/drush/drush/drush dl features_extra -y \\\n && /var/www/composer/vendor/drush/drush/drush en flat -y \\\n && /var/www/composer/vendor/drush/drush/drush php-script flat-logo --script-path=/tmp \\\n && /var/www/composer/vendor/drush/drush/drush en jquery_update -y \\\n && /var/www/composer/vendor/drush/drush/drush en bootstrap -y \\\n && /var/www/composer/vendor/drush/drush/drush en flat_bootstrap_theme -y \\\n && /var/www/composer/vendor/drush/drush/drush vset theme_default flat_bootstrap_theme \\\n && supervisorctl stop all \\\n && service supervisor stop \\\n && /wait-sergtsop.sh\n#\n#   Add LAT2FOX\n#\nENV MAVEN_OPTS=\"-Xss10M\"\nRUN cd /tmp \\\n && git clone -b develop https://github.com/TheLanguageArchive/SchemAnon.git SchemAnon \\\n && cd /tmp/SchemAnon \\\n && mvn clean install \\\n && mv target/SchemAnon.jar /app/flat/lib/SchemAnon.jar\nRUN mkdir -p /tmp/LAT2FOX\nCOPY flat/LAT2FOX /tmp/LAT2FOX\nRUN cd /tmp/LAT2FOX \\\n && mvn clean package \\\n && mv target/lat2fox.jar /app/flat/lib/lat2fox.jar\n#\n#   Add FLAT's own scripts, tools and icons\n#\nCOPY flat/scripts/* /app/flat/bin/\nRUN chmod +x /app/flat/bin/*.sh \\\n && mv /app/flat/bin/do-*.sh /app/flat/\nRUN mkdir -p /app/flat/deposit\nCOPY flat/policies /app/flat/deposit/policies\nCOPY flat/policies-private-resources /app/flat/deposit/policies-private-resources\nCOPY flat/policies /app/flat/deposit/policies\nRUN mkdir -p $FLAT_ICON_DIR\nCOPY flat/icons $FLAT_ICON_DIR\n#\n#   Cleanup\n#\n#   clean up APT and /tmp when done.\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ubuntu:16.04\nMAINTAINER Menzo Windhouwer <menzo.windhouwer@meertens.knaw.nl>\n#\n#  Configure FLAT\n#\nENV FLAT_NAME=\"flat\"\n# ENV FLAT_HOST=192.168.99.100\nENV FLAT_HOST=\"localhost\"\nENV FLAT_ICON_DIR=\"/app/flat/data/icons\"\nENV FLAT_TIMEOUT=\"150\"\nENV CMD_EXTENSION=\"cmdi\"\nENV FLAT_NAMESPACE=\"lat\"\n#\n#  Setup workdir\n#\nRUN mkdir -p /app/flat/lib \\\n && mkdir -p /app/flat/bin \\\n && mkdir -p /app/flat/tmp\nWORKDIR /app/flat\nENV HOME=\"/root\"\nENV PATH=\"/app/flat/bin:${PATH}\"\n#  expose ports\nEXPOSE 80/tcp\nEXPOSE 8080/tcp\n#\n#  locale\n#\nENV TZ=\"'Europe/Amsterdam'\"\nRUN echo $TZ > /etc/timezone \\\n && apt-get update \\\n && apt-get install tzdata -y \\\n && rm /etc/localtime \\\n && ln -snf /usr/share/zoneinfo/$TZ /etc/localtime \\\n && dpkg-reconfigure -f noninteractive tzdata\nRUN apt-get update \\\n && apt-get install locales -y \\\n && sed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen \\\n && echo 'LANG=\"en_US.UTF-8\"' > /etc/default/locale \\\n && dpkg-reconfigure --frontend=noninteractive locales \\\n && update-locale LANG=en_US.UTF-8\nENV LANG=\"\\\"en_US.UTF-8\\\"\"\nENV LANGUAGE=\"\\\"en_US.UTF-8\\\"\"\nENV LC_ALL=\"\\\"en_US.UTF-8\\\"\"\n#\n#  Update and install all system libraries\n#\nRUN apt-get update \\\n && apt-get -y dist-upgrade \\\n && apt-get install supervisor curl wget openssl apache2 postgresql unzip ssh rsync git -y\n#  PHP\nRUN apt-get install libapache2-mod-php php-gd php-pgsql php-xsl php-curl -y\n#  Java 8\nRUN apt-get install software-properties-common python-software-properties -y \\\n && add-apt-repository ppa:webupd8team/java \\\n && apt-get update \\\n && echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true | /usr/bin/debconf-set-selections \\\n && apt-get install oracle-java8-installer maven -y\nENV JAVA_HOME=\"\\\"/usr/lib/jvm/java-8-oracle\\\"\"\n#  dev\nRUN apt-get install libxml2-utils vim -y\n#\n#  Configure apache\n#    - set apache ulimit to 1024\nADD apache/envvars /etc/apache2/envvars\nADD apache/apache2.conf /etc/apache2/apache2.conf\nRUN a2enmod ssl \\\n && a2enmod rewrite \\\n && a2enmod proxy \\\n && a2enmod proxy_http \\\n && a2enmod sed \\\n && sed -i \"s|FLAT_NAME|${FLAT_NAME}|g\" /etc/apache2/apache2.conf\n#\n#  Configure postgres\n#    - initialise databases for fedora and drupal\nADD postgresql/wait-postgres.sh /wait-postgres.sh\nADD postgresql/wait-sergtsop.sh /wait-sergtsop.sh\nRUN chmod u+x /wait-postgres.sh \\\n && chmod u+x /wait-sergtsop.sh \\\n && /etc/init.d/postgresql start \\\n && /wait-postgres.sh \\\n && su -c \"psql -c \\\"CREATE USER fedora WITH PASSWORD 'fedora'\\\"\" postgres \\\n && su -c \"createdb -O fedora fedora\" postgres \\\n && su -c \"createdb -O fedora proai\" postgres \\\n && su -c \"createdb -O fedora --encoding=UNICODE -T template0 drupal\" postgres \\\n && /etc/init.d/postgresql stop \\\n && /wait-sergtsop.sh\n#\n#  Download packages for the islandora setup\n#    - fedora commons\n#    - proai\n#    - drupal\n#        - tuque\n#    - islandora\n#\nENV FEDORA_HOME=\"/var/www/fedora\"\nENV CATALINA_HOME=\"/var/www/fedora/tomcat\"\nRUN mkdir /tmp/fedora \\\n && cd /tmp/fedora \\\n && wget \"https://github.com/fcrepo3/fcrepo/releases/download/v3.8.1/fcrepo-installer-3.8.1.jar\"\nADD fedora/install.properties /tmp/fedora/install.properties\nRUN /etc/init.d/postgresql start \\\n && /wait-postgres.sh \\\n && cd /tmp/fedora \\\n && java -jar fcrepo-installer-3.8.1.jar install.properties \\\n && /etc/init.d/postgresql stop \\\n && /wait-sergtsop.sh\n#  tell fedora about CMDI\nRUN sed -i 's|</mappings>|<mime-mapping><mime-type>application/x-cmdi+xml</mime-type><extension>cmdi</extension></mime-mapping></mappings>|g' /var/www/fedora/server/config/mime-to-extensions.xml\n#\n#  All services are installed, add start script to automatically start required services\n#\nADD flat.txt /flat.txt\nADD supervisor/start-*.sh /\nRUN chmod u+x /start-*.sh\nADD supervisor/*.conf /etc/supervisor/conf.d/\nADD supervisor/start.sh /start.sh\nRUN chmod u+x /start.sh\nRUN echo \". /etc/environment\" >> /etc/default/supervisor\nENTRYPOINT /start.sh\n#\n#  starting fedora will initialize required directories\n#\nADD fedora/wait-tomcat.sh /wait-tomcat.sh\nRUN chmod u+x /wait-tomcat.sh \\\n && service supervisor start \\\n && /wait-postgres.sh \\\n && supervisorctl start tomcat \\\n && /wait-tomcat.sh \\\n && supervisorctl stop all \\\n && service supervisor stop \\\n && /wait-sergtsop.sh\n#  policies\nRUN rm -v /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-purge-*\nRUN rm -v /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-policy-management-if-not-administrator.xml\nRUN rm -v /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-inactive-or-deleted-objects-or-datastreams-if-not-administrator.xml\nADD fedora/deny-deleted-objects-or-datastreams-if-not-administrator.xml /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-deleted-objects-or-datastreams-if-not-administrator.xml\nADD fedora/permit-anything-to-localhost.xml /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/permit-anything-to-localhost.xml\nADD fedora/deny-unallowed-file-resolution.xml /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-unallowed-file-resolution.xml\nRUN cd /var/www/fedora/data/fedora-xacml-policies/repository-policies/ \\\n && wget https://github.com/Islandora/islandora-xacml-policies/archive/master.zip \\\n && unzip master.zip \\\n && rm master.zip \\\n && mv islandora-xacml-policies-master islandora\n#  authorisation filter\nRUN cd /var/www/fedora/tomcat/webapps/fedora/WEB-INF/lib \\\n && wget \"https://github.com/Islandora/islandora_drupal_filter/releases/download/7.1.10/fcrepo-drupalauthfilter-3.8.1.jar\"\nADD fedora/jaas.conf /var/www/fedora/server/config/jaas.conf\nADD fedora/filter-drupal.xml /var/www/fedora/server/config/filter-drupal.xml\n# #Download and configure drupal (via drush)\nRUN mkdir -p /var/www/composer \\\n && cd /var/www/composer \\\n && curl -sS https://getcomposer.org/installer | php \\\n && mv composer.phar composer\nENV COMPOSER_HOME=\"/var/www/composer\"\nRUN $COMPOSER_HOME/composer global require drush/drush:7.*\nRUN cd /var/www/html \\\n && /var/www/composer/vendor/drush/drush/drush -v dl drupal --drupal-project-rename=$FLAT_NAME\nENV PGPASSWORD=\"fedora\"\nRUN service supervisor start \\\n && /wait-postgres.sh \\\n && supervisorctl start tomcat \\\n && /wait-tomcat.sh \\\n && cd /var/www/html/$FLAT_NAME \\\n && export PHP_OPTIONS=\"-d sendmail_path=`which true `\" \\\n && /var/www/composer/vendor/drush/drush/drush site-install standard --site-name=FLAT --account-name=admin --account-pass=admin --db-su=fedora --db-su-pw=fedora --db-url=pgsql://fedora:fedora@localhost/drupal -y \\\n && supervisorctl stop all \\\n && service supervisor stop \\\n && /wait-sergtsop.sh\nRUN mkdir -p /var/www/html/$FLAT_NAME/sites/all/modules/custom \\\n && chown www-data:www-data /var/www/html/$FLAT_NAME/sites/default/files \\\n && chown www-data:www-data /var/www/html/$FLAT_NAME/sites/default/settings.php \\\n && chown www-data:www-data /var/www/html/$FLAT_NAME/sites/all/modules/custom\nADD drupal/flat-logo.png /var/www/html/$FLAT_NAME/sites/default/files/flat-logo.png\nADD drupal/flat /var/www/html/$FLAT_NAME/sites/all/modules/custom/\nADD drupal/flat-logo.php /tmp/\n#  To check accessibility we use a HEAD request using the http(s)?://<user>:<pass>@<host>(:<port>)?/<path>... support of drupal_http_request\n#  however if the username or password does contain funny characters no escaping is supported\n#  this change allows to use rawurlencode, as drupal_http_request will now do a rawurldecode\nRUN sed -i \"s|base64_encode($uri\\['user'\\]|base64_encode(rawurldecode($uri['user'])|g\" /var/www/html/$FLAT_NAME/includes/common.inc \\\n && sed -i \"s| $uri\\['pass'\\] | rawurldecode($uri['pass']) |g\" /var/www/html/$FLAT_NAME/includes/common.inc\nRUN mkdir /tmp/tuque \\\n && cd /tmp/tuque \\\n && wget \"https://github.com/islandora/tuque/archive/1.10.zip\" \\\n && unzip 1.10.zip \\\n && mv /tmp/tuque/tuque-1.10 /var/www/html/$FLAT_NAME/sites/all/libraries/tuque \\\n && sed -i 's|public $verifyPeer = TRUE;|public $verifyPeer = FALSE;|g' /var/www/html/$FLAT_NAME/sites/all/libraries/tuque/HttpConnection.php\nRUN mkdir -p /tmp/islandora \\\n && mkdir -p /var/www/html/$FLAT_NAME/sites/all/modules/contrib \\\n && mkdir -p /var/www/html/$FLAT_NAME/sites/all/themes \\\n && cd /tmp/islandora \\\n && wget \"https://github.com/Islandora/islandora/archive/7.x-1.10.tar.gz\" \\\n && tar -xf 7.x-1.10.tar.gz -C /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ \\\n && cd /tmp/islandora \\\n && wget -O islandora_solution_pack_collection-7.x-1.10.zip \"https://github.com/islandora/islandora_solution_pack_collection/archive/7.x-1.10.zip\" \\\n && unzip islandora_solution_pack_collection-7.x-1.10.zip -d /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ \\\n && cd /tmp/islandora \\\n && wget -O islandora_xacml_editor-7.x-1.10.zip \"https://github.com/Islandora/islandora_xacml_editor/archive/7.x-1.10.zip\" \\\n && unzip islandora_xacml_editor-7.x-1.10.zip -d /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ \\\n && cd /tmp/islandora \\\n && wget -O islandora_solution_pack_compound-7.x-1.10.zip \"https://github.com/Islandora/islandora_solution_pack_compound/archive/7.x-1.10.zip\" \\\n && unzip islandora_solution_pack_compound-7.x-1.10.zip -d /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ \\\n && sed -i 's|function islandora_compound_object_islandora_compoundCModel_islandora_view_object|function islandora_compound_object_islandora_compoundCModel_islandora_view_object_DISABLED_BY_FLAT|g' /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora_solution_pack_compound-7.x-1.10/islandora_compound_object.module\n#  overwrites the collection object view, so we get file details\nADD islandora/islandora_basic_collection.module /var/www/html/flat/sites/all/modules/contrib/islandora_solution_pack_collection-7.x-1.10/islandora_basic_collection.module\n#  add CMDI solution pack\nRUN mkdir -p /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora_solution_pack_cmdi\nADD flat/islandora_solution_pack_cmdi /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora_solution_pack_cmdi\n#  tell islandora about CMDI\nRUN sed -i \"/\\\"json\\\"/a \\\"cmdi\\\" => \\\"application/x-cmdi+xml\\\",\" /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora-7.x-1.10/includes/mimetype.utils.inc \\\n && sed -i \"/header('Content-type: ' . $datastream/a if ($datastream->ID == 'CMD') {\\nheader('Content-type: ' . 'application/xml');\\n}\" /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora-7.x-1.10/includes/datastream.inc\nRUN mkdir -p /tmp/bootstrap \\\n && cd /tmp/bootstrap \\\n && wget \"https://ftp.drupal.org/files/projects/bootstrap-7.x-3.14.zip\" \\\n && unzip bootstrap-7.x-3.14.zip \\\n && mv /tmp/bootstrap/bootstrap /var/www/html/$FLAT_NAME/sites/all/themes/bootstrap\nRUN cp -r /var/www/html/$FLAT_NAME/sites/all/themes/bootstrap/starterkits/cdn /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme \\\n && cd /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/ \\\n && mv cdn.starterkit flat_bootstrap_theme.info \\\n && echo \";; FLAT settings\" >> flat_bootstrap_theme.info \\\n && echo \"settings[bootstrap_cdn_jsdelivr_theme] = 'flatly'\" >> flat_bootstrap_theme.info \\\n && echo \"settings[bootstrap_fluid_container] = 1\" >> flat_bootstrap_theme.info \\\n && mkdir -p /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/js\n#  determine our own object view\nADD islandora/islandora-default.tpl.php /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/templates/islandora-default.tpl.php\n#  overwrite the compound behavior, which does special things for the first member (as being the representative)\nADD islandora/template.php /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/template.php\nADD islandora/flat.js /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/js/flat.js\nRUN service supervisor start \\\n && /wait-postgres.sh \\\n && supervisorctl start tomcat \\\n && /wait-tomcat.sh \\\n && cd /var/www/html/$FLAT_NAME/ \\\n && /var/www/composer/vendor/drush/drush/drush vset islandora_base_url http://localhost:8080/fedora \\\n && /var/www/composer/vendor/drush/drush/drush en islandora -y \\\n && /var/www/composer/vendor/drush/drush/drush en islandora_xacml_editor -y \\\n && /var/www/composer/vendor/drush/drush/drush en islandora_basic_collection -y \\\n && /var/www/composer/vendor/drush/drush/drush en islandora_compound_object -y \\\n && /var/www/composer/vendor/drush/drush/drush en islandora_cmdi -y \\\n && /var/www/composer/vendor/drush/drush/drush vset islandora_metadata_display cmdi \\\n && /var/www/composer/vendor/drush/drush/drush dl features_extra -y \\\n && /var/www/composer/vendor/drush/drush/drush en flat -y \\\n && /var/www/composer/vendor/drush/drush/drush php-script flat-logo --script-path=/tmp \\\n && /var/www/composer/vendor/drush/drush/drush en jquery_update -y \\\n && /var/www/composer/vendor/drush/drush/drush en bootstrap -y \\\n && /var/www/composer/vendor/drush/drush/drush en flat_bootstrap_theme -y \\\n && /var/www/composer/vendor/drush/drush/drush vset theme_default flat_bootstrap_theme \\\n && supervisorctl stop all \\\n && service supervisor stop \\\n && /wait-sergtsop.sh\n#\n#  Add LAT2FOX\n#\nENV MAVEN_OPTS=\"-Xss10M\"\nRUN cd /tmp \\\n && git clone -b develop https://github.com/TheLanguageArchive/SchemAnon.git SchemAnon \\\n && cd /tmp/SchemAnon \\\n && mvn clean install \\\n && mv target/SchemAnon.jar /app/flat/lib/SchemAnon.jar\nRUN mkdir -p /tmp/LAT2FOX\nADD flat/LAT2FOX /tmp/LAT2FOX\nRUN cd /tmp/LAT2FOX \\\n && mvn clean package \\\n && mv target/lat2fox.jar /app/flat/lib/lat2fox.jar\n#\n#  Add FLAT's own scripts, tools and icons\n#\nADD flat/scripts/* /app/flat/bin/\nRUN chmod +x /app/flat/bin/*.sh \\\n && mv /app/flat/bin/do-*.sh /app/flat/\nRUN mkdir -p /app/flat/deposit\nADD flat/policies /app/flat/deposit/policies\nADD flat/policies-private-resources /app/flat/deposit/policies-private-resources\nADD flat/policies /app/flat/deposit/policies\nRUN mkdir -p $FLAT_ICON_DIR\nADD flat/icons $FLAT_ICON_DIR\n#\n#  Cleanup\n#\n#  clean up APT and /tmp when done.\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n","injectedSmells":[],"originalDockerfileHash":"9a45895ca42ba55098ed3c9bc40f8f38","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:16.04\nMAINTAINER Menzo Windhouwer <menzo.windhouwer@meertens.knaw.nl>\n#\n#   Configure FLAT\n#\nENV FLAT_NAME=\"flat\"\n#  ENV FLAT_HOST=192.168.99.100\nENV FLAT_HOST=\"localhost\"\nENV FLAT_ICON_DIR=\"/app/flat/data/icons\"\nENV FLAT_TIMEOUT=\"150\"\nENV CMD_EXTENSION=\"cmdi\"\nENV FLAT_NAMESPACE=\"lat\"\n#\n#   Setup workdir\n#\nRUN mkdir -p /app/flat/lib \\\n && mkdir -p /app/flat/bin \\\n && mkdir -p /app/flat/tmp\nWORKDIR /app/flat\nENV HOME=\"/root\"\nENV PATH=\"/app/flat/bin:${PATH}\"\n#   expose ports\nEXPOSE 80/tcp\nEXPOSE 8080/tcp\n#\n#   locale\n#\nENV TZ=\"'Europe/Amsterdam'\"\nRUN echo $TZ > /etc/timezone \\\n && apt-get update \\\n && apt-get install tzdata -y \\\n && rm /etc/localtime \\\n && ln -snf /usr/share/zoneinfo/$TZ /etc/localtime \\\n && dpkg-reconfigure -f noninteractive tzdata\nRUN apt-get update \\\n && apt-get install locales -y \\\n && sed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen \\\n && echo 'LANG=\"en_US.UTF-8\"' > /etc/default/locale \\\n && dpkg-reconfigure --frontend=noninteractive locales \\\n && update-locale LANG=en_US.UTF-8\nENV LANG=\"\\\"en_US.UTF-8\\\"\"\nENV LANGUAGE=\"\\\"en_US.UTF-8\\\"\"\nENV LC_ALL=\"\\\"en_US.UTF-8\\\"\"\n#\n#   Update and install all system libraries\n#\nRUN apt-get update \\\n && apt-get -y dist-upgrade \\\n && apt-get install supervisor curl wget openssl apache2 postgresql unzip ssh rsync git -y\n#   PHP\nRUN apt-get install libapache2-mod-php php-gd php-pgsql php-xsl php-curl -y\n#   Java 8\nRUN apt-get install software-properties-common python-software-properties -y \\\n && add-apt-repository ppa:webupd8team/java \\\n && apt-get update \\\n && echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true | /usr/bin/debconf-set-selections \\\n && apt-get install oracle-java8-installer maven -y\nENV JAVA_HOME=\"\\\"/usr/lib/jvm/java-8-oracle\\\"\"\n#   dev\nRUN apt-get install libxml2-utils vim -y\n#\n#   Configure apache\n#     - set apache ulimit to 1024\nADD apache/envvars /etc/apache2/envvars\nADD apache/apache2.conf /etc/apache2/apache2.conf\nRUN a2enmod ssl \\\n && a2enmod rewrite \\\n && a2enmod proxy \\\n && a2enmod proxy_http \\\n && a2enmod sed \\\n && sed -i \"s|FLAT_NAME|${FLAT_NAME}|g\" /etc/apache2/apache2.conf\n#\n#   Configure postgres\n#     - initialise databases for fedora and drupal\nADD postgresql/wait-postgres.sh /wait-postgres.sh\nADD postgresql/wait-sergtsop.sh /wait-sergtsop.sh\nRUN chmod u+x /wait-postgres.sh \\\n && chmod u+x /wait-sergtsop.sh \\\n && /etc/init.d/postgresql start \\\n && /wait-postgres.sh \\\n && su -c \"psql -c \\\"CREATE USER fedora WITH PASSWORD 'fedora'\\\"\" postgres \\\n && su -c \"createdb -O fedora fedora\" postgres \\\n && su -c \"createdb -O fedora proai\" postgres \\\n && su -c \"createdb -O fedora --encoding=UNICODE -T template0 drupal\" postgres \\\n && /etc/init.d/postgresql stop \\\n && /wait-sergtsop.sh\n#\n#   Download packages for the islandora setup\n#     - fedora commons\n#     - proai\n#     - drupal\n#         - tuque\n#     - islandora\n#\nENV FEDORA_HOME=\"/var/www/fedora\"\nENV CATALINA_HOME=\"/var/www/fedora/tomcat\"\nRUN mkdir /tmp/fedora \\\n && cd /tmp/fedora \\\n && wget \"https://github.com/fcrepo3/fcrepo/releases/download/v3.8.1/fcrepo-installer-3.8.1.jar\"\nADD fedora/install.properties /tmp/fedora/install.properties\nRUN /etc/init.d/postgresql start \\\n && /wait-postgres.sh \\\n && cd /tmp/fedora \\\n && java -jar fcrepo-installer-3.8.1.jar install.properties \\\n && /etc/init.d/postgresql stop \\\n && /wait-sergtsop.sh\n#   tell fedora about CMDI\nRUN sed -i 's|</mappings>|<mime-mapping><mime-type>application/x-cmdi+xml</mime-type><extension>cmdi</extension></mime-mapping></mappings>|g' /var/www/fedora/server/config/mime-to-extensions.xml\n#\n#   All services are installed, add start script to automatically start required services\n#\nADD flat.txt /flat.txt\nADD supervisor/start-*.sh /\nRUN chmod u+x /start-*.sh\nADD supervisor/*.conf /etc/supervisor/conf.d/\nADD supervisor/start.sh /start.sh\nRUN chmod u+x /start.sh\nRUN echo \". /etc/environment\" >> /etc/default/supervisor\nENTRYPOINT /start.sh\n#\n#   starting fedora will initialize required directories\n#\nADD fedora/wait-tomcat.sh /wait-tomcat.sh\nRUN chmod u+x /wait-tomcat.sh \\\n && service supervisor start \\\n && /wait-postgres.sh \\\n && supervisorctl start tomcat \\\n && /wait-tomcat.sh \\\n && supervisorctl stop all \\\n && service supervisor stop \\\n && /wait-sergtsop.sh\n#   policies\nRUN rm -v /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-purge-*\nRUN rm -v /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-policy-management-if-not-administrator.xml\nRUN rm -v /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-inactive-or-deleted-objects-or-datastreams-if-not-administrator.xml\nADD fedora/deny-deleted-objects-or-datastreams-if-not-administrator.xml /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-deleted-objects-or-datastreams-if-not-administrator.xml\nADD fedora/permit-anything-to-localhost.xml /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/permit-anything-to-localhost.xml\nADD fedora/deny-unallowed-file-resolution.xml /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-unallowed-file-resolution.xml\nRUN cd /var/www/fedora/data/fedora-xacml-policies/repository-policies/ \\\n && wget https://github.com/Islandora/islandora-xacml-policies/archive/master.zip \\\n && unzip master.zip \\\n && rm master.zip \\\n && mv islandora-xacml-policies-master islandora\n#   authorisation filter\nRUN cd /var/www/fedora/tomcat/webapps/fedora/WEB-INF/lib \\\n && wget \"https://github.com/Islandora/islandora_drupal_filter/releases/download/7.1.10/fcrepo-drupalauthfilter-3.8.1.jar\"\nADD fedora/jaas.conf /var/www/fedora/server/config/jaas.conf\nADD fedora/filter-drupal.xml /var/www/fedora/server/config/filter-drupal.xml\n#  #Download and configure drupal (via drush)\nRUN mkdir -p /var/www/composer \\\n && cd /var/www/composer \\\n && curl -sS https://getcomposer.org/installer | php \\\n && mv composer.phar composer\nENV COMPOSER_HOME=\"/var/www/composer\"\nRUN $COMPOSER_HOME/composer global require drush/drush:7.*\nRUN cd /var/www/html \\\n && /var/www/composer/vendor/drush/drush/drush -v dl drupal --drupal-project-rename=$FLAT_NAME\nENV PGPASSWORD=\"fedora\"\nRUN service supervisor start \\\n && /wait-postgres.sh \\\n && supervisorctl start tomcat \\\n && /wait-tomcat.sh \\\n && cd /var/www/html/$FLAT_NAME \\\n && export PHP_OPTIONS=\"-d sendmail_path=`which true `\" \\\n && /var/www/composer/vendor/drush/drush/drush site-install standard --site-name=FLAT --account-name=admin --account-pass=admin --db-su=fedora --db-su-pw=fedora --db-url=pgsql://fedora:fedora@localhost/drupal -y \\\n && supervisorctl stop all \\\n && service supervisor stop \\\n && /wait-sergtsop.sh\nRUN mkdir -p /var/www/html/$FLAT_NAME/sites/all/modules/custom \\\n && chown www-data:www-data /var/www/html/$FLAT_NAME/sites/default/files \\\n && chown www-data:www-data /var/www/html/$FLAT_NAME/sites/default/settings.php \\\n && chown www-data:www-data /var/www/html/$FLAT_NAME/sites/all/modules/custom\nADD drupal/flat-logo.png /var/www/html/$FLAT_NAME/sites/default/files/flat-logo.png\nADD drupal/flat /var/www/html/$FLAT_NAME/sites/all/modules/custom/\nADD drupal/flat-logo.php /tmp/\n#   To check accessibility we use a HEAD request using the http(s)?://<user>:<pass>@<host>(:<port>)?/<path>... support of drupal_http_request\n#   however if the username or password does contain funny characters no escaping is supported\n#   this change allows to use rawurlencode, as drupal_http_request will now do a rawurldecode\nRUN sed -i \"s|base64_encode($uri\\['user'\\]|base64_encode(rawurldecode($uri['user'])|g\" /var/www/html/$FLAT_NAME/includes/common.inc \\\n && sed -i \"s| $uri\\['pass'\\] | rawurldecode($uri['pass']) |g\" /var/www/html/$FLAT_NAME/includes/common.inc\nRUN mkdir /tmp/tuque \\\n && cd /tmp/tuque \\\n && wget \"https://github.com/islandora/tuque/archive/1.10.zip\" \\\n && unzip 1.10.zip \\\n && mv /tmp/tuque/tuque-1.10 /var/www/html/$FLAT_NAME/sites/all/libraries/tuque \\\n && sed -i 's|public $verifyPeer = TRUE;|public $verifyPeer = FALSE;|g' /var/www/html/$FLAT_NAME/sites/all/libraries/tuque/HttpConnection.php\nRUN mkdir -p /tmp/islandora \\\n && mkdir -p /var/www/html/$FLAT_NAME/sites/all/modules/contrib \\\n && mkdir -p /var/www/html/$FLAT_NAME/sites/all/themes \\\n && cd /tmp/islandora \\\n && wget \"https://github.com/Islandora/islandora/archive/7.x-1.10.tar.gz\" \\\n && tar -xf 7.x-1.10.tar.gz -C /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ \\\n && cd /tmp/islandora \\\n && wget -O islandora_solution_pack_collection-7.x-1.10.zip \"https://github.com/islandora/islandora_solution_pack_collection/archive/7.x-1.10.zip\" \\\n && unzip islandora_solution_pack_collection-7.x-1.10.zip -d /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ \\\n && cd /tmp/islandora \\\n && wget -O islandora_xacml_editor-7.x-1.10.zip \"https://github.com/Islandora/islandora_xacml_editor/archive/7.x-1.10.zip\" \\\n && unzip islandora_xacml_editor-7.x-1.10.zip -d /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ \\\n && cd /tmp/islandora \\\n && wget -O islandora_solution_pack_compound-7.x-1.10.zip \"https://github.com/Islandora/islandora_solution_pack_compound/archive/7.x-1.10.zip\" \\\n && unzip islandora_solution_pack_compound-7.x-1.10.zip -d /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ \\\n && sed -i 's|function islandora_compound_object_islandora_compoundCModel_islandora_view_object|function islandora_compound_object_islandora_compoundCModel_islandora_view_object_DISABLED_BY_FLAT|g' /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora_solution_pack_compound-7.x-1.10/islandora_compound_object.module\n#   overwrites the collection object view, so we get file details\nADD islandora/islandora_basic_collection.module /var/www/html/flat/sites/all/modules/contrib/islandora_solution_pack_collection-7.x-1.10/islandora_basic_collection.module\n#   add CMDI solution pack\nRUN mkdir -p /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora_solution_pack_cmdi\nADD flat/islandora_solution_pack_cmdi /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora_solution_pack_cmdi\n#   tell islandora about CMDI\nRUN sed -i \"/\\\"json\\\"/a \\\"cmdi\\\" => \\\"application/x-cmdi+xml\\\",\" /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora-7.x-1.10/includes/mimetype.utils.inc \\\n && sed -i \"/header('Content-type: ' . $datastream/a if ($datastream->ID == 'CMD') {\\nheader('Content-type: ' . 'application/xml');\\n}\" /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora-7.x-1.10/includes/datastream.inc\nRUN mkdir -p /tmp/bootstrap \\\n && cd /tmp/bootstrap \\\n && wget \"https://ftp.drupal.org/files/projects/bootstrap-7.x-3.14.zip\" \\\n && unzip bootstrap-7.x-3.14.zip \\\n && mv /tmp/bootstrap/bootstrap /var/www/html/$FLAT_NAME/sites/all/themes/bootstrap\nRUN cp -r /var/www/html/$FLAT_NAME/sites/all/themes/bootstrap/starterkits/cdn /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme \\\n && cd /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/ \\\n && mv cdn.starterkit flat_bootstrap_theme.info \\\n && echo \";; FLAT settings\" >> flat_bootstrap_theme.info \\\n && echo \"settings[bootstrap_cdn_jsdelivr_theme] = 'flatly'\" >> flat_bootstrap_theme.info \\\n && echo \"settings[bootstrap_fluid_container] = 1\" >> flat_bootstrap_theme.info \\\n && mkdir -p /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/js\n#   determine our own object view\nADD islandora/islandora-default.tpl.php /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/templates/islandora-default.tpl.php\n#   overwrite the compound behavior, which does special things for the first member (as being the representative)\nADD islandora/template.php /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/template.php\nADD islandora/flat.js /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/js/flat.js\nRUN service supervisor start \\\n && /wait-postgres.sh \\\n && supervisorctl start tomcat \\\n && /wait-tomcat.sh \\\n && cd /var/www/html/$FLAT_NAME/ \\\n && /var/www/composer/vendor/drush/drush/drush vset islandora_base_url http://localhost:8080/fedora \\\n && /var/www/composer/vendor/drush/drush/drush en islandora -y \\\n && /var/www/composer/vendor/drush/drush/drush en islandora_xacml_editor -y \\\n && /var/www/composer/vendor/drush/drush/drush en islandora_basic_collection -y \\\n && /var/www/composer/vendor/drush/drush/drush en islandora_compound_object -y \\\n && /var/www/composer/vendor/drush/drush/drush en islandora_cmdi -y \\\n && /var/www/composer/vendor/drush/drush/drush vset islandora_metadata_display cmdi \\\n && /var/www/composer/vendor/drush/drush/drush dl features_extra -y \\\n && /var/www/composer/vendor/drush/drush/drush en flat -y \\\n && /var/www/composer/vendor/drush/drush/drush php-script flat-logo --script-path=/tmp \\\n && /var/www/composer/vendor/drush/drush/drush en jquery_update -y \\\n && /var/www/composer/vendor/drush/drush/drush en bootstrap -y \\\n && /var/www/composer/vendor/drush/drush/drush en flat_bootstrap_theme -y \\\n && /var/www/composer/vendor/drush/drush/drush vset theme_default flat_bootstrap_theme \\\n && supervisorctl stop all \\\n && service supervisor stop \\\n && /wait-sergtsop.sh\n#\n#   Add LAT2FOX\n#\nENV MAVEN_OPTS=\"-Xss10M\"\nRUN cd /tmp \\\n && git clone -b develop https://github.com/TheLanguageArchive/SchemAnon.git SchemAnon \\\n && cd /tmp/SchemAnon \\\n && mvn clean install \\\n && mv target/SchemAnon.jar /app/flat/lib/SchemAnon.jar\nRUN mkdir -p /tmp/LAT2FOX\nADD flat/LAT2FOX /tmp/LAT2FOX\nRUN cd /tmp/LAT2FOX \\\n && mvn clean package \\\n && mv target/lat2fox.jar /app/flat/lib/lat2fox.jar\n#\n#   Add FLAT's own scripts, tools and icons\n#\nADD flat/scripts/* /app/flat/bin/\nRUN chmod +x /app/flat/bin/*.sh \\\n && mv /app/flat/bin/do-*.sh /app/flat/\nRUN mkdir -p /app/flat/deposit\nADD flat/policies /app/flat/deposit/policies\nADD flat/policies-private-resources /app/flat/deposit/policies-private-resources\nADD flat/policies /app/flat/deposit/policies\nRUN mkdir -p $FLAT_ICON_DIR\nADD flat/icons $FLAT_ICON_DIR\n#\n#   Cleanup\n#\n#   clean up APT and /tmp when done.\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n","originalDockerfileUglifiedHash":"6f700cfe43408191cb185ef1f0b30579","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/61dcea69109b8873aaeca868fd8b81b80947ea1a.dockerfile"}