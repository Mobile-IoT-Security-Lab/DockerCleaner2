{"seed":3089367165,"processedDockerfileHash":"b1e2e7132c3f98ceda0d10c016128259","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["do-not-use-apt-get-update-alone","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n#   use this file except in compliance with the License. You may obtain a copy of\n#   the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n#   Unless required by applicable law or agreed to in writing, software\n#   distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n#   WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n#   License for the specific language governing permissions and limitations under\n#   the License.\nFROM debian:stretch-slim\nLABEL maintainer=\"CouchDB Developers dev@couchdb.apache.org\"\n#   Add CouchDB user account to make sure the IDs are assigned consistently\nRUN groupadd -g 5984 -r couchdb \\\n && useradd -u 5984 -d /opt/couchdb -g couchdb couchdb\n#   be sure GPG and apt-transport-https are available and functional\nRUN set -ex ; apt-get update ; (apt-get update ;apt-get install --no-install-recommends apt-transport-https ca-certificates dirmngr gnupg -y ) ; rm -rf /var/lib/apt/lists/*\n#   grab gosu for easy step-down from root and tini for signal handling and zombie reaping\n#   see https://github.com/apache/couchdb-docker/pull/28#discussion_r141112407\nENV GOSU_VERSION=\"1.11\"\nENV TINI_VERSION=\"0.18.0\"\nRUN set -ex ; apt-get update ; (apt-get update ;apt-get install --no-install-recommends wget -y ) ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/${GOSU_VERSION}/gosu-$dpkgArch\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for server in $( shuf -e pgpkeys.mit.edu ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 pgp.mit.edu ;); do gpg --batch --keyserver $server --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && break || : ; done ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; chmod +x /usr/local/bin/gosu ; gosu nobody true ; wget -O /usr/local/bin/tini \"https://github.com/krallin/tini/releases/download/v${TINI_VERSION}/tini-$dpkgArch\" ; wget -O /usr/local/bin/tini.asc \"https://github.com/krallin/tini/releases/download/v${TINI_VERSION}/tini-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for server in $( shuf -e pgpkeys.mit.edu ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 pgp.mit.edu ;); do gpg --batch --keyserver $server --recv-keys 595E85A6B1B4779EA4DAAEC70B588DFF0527A9B7 \\\n && break || : ; done ; gpg --batch --verify /usr/local/bin/tini.asc /usr/local/bin/tini ; rm -rf \"$GNUPGHOME\" /usr/local/bin/tini.asc ; chmod +x /usr/local/bin/tini ; apt-get purge -y --auto-remove wget ; tini --version\n#   http://docs.couchdb.org/en/latest/install/unix.html#installing-the-apache-couchdb-packages\nENV GPG_COUCH_KEY=\"8756C4F765C9AC3CB6B85D62379CE192D401AB61\"\nRUN set -xe ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for server in $( shuf -e pgpkeys.mit.edu ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 pgp.mit.edu ;); do gpg --batch --keyserver $server --recv-keys $GPG_COUCH_KEY \\\n && break || : ; done ; gpg --batch --export $GPG_COUCH_KEY > /etc/apt/trusted.gpg.d/couchdb.gpg; command -v gpgconf \\\n && gpgconf --kill all || : ; rm -rf \"$GNUPGHOME\" ; apt-key list\nENV COUCHDB_VERSION=\"2.3.0\"\nRUN echo \"deb https://apache.bintray.com/couchdb-deb stretch main\" > /etc/apt/sources.list.d/couchdb.list\n#   https://github.com/apache/couchdb-pkg/blob/master/debian/README.Debian\nRUN set -xe ; : ; echo \"couchdb couchdb/mode select none\" | debconf-set-selections ; DEBIAN_FRONTEND=noninteractive apt-get install -y --allow-downgrades --allow-remove-essential --allow-change-held-packages couchdb=\"$COUCHDB_VERSION\"~stretch ; rmdir /var/lib/couchdb /var/log/couchdb ; rm /opt/couchdb/data /opt/couchdb/var/log ; mkdir -p /opt/couchdb/data /opt/couchdb/var/log ; chown couchdb:couchdb /opt/couchdb/data /opt/couchdb/var/log ; chmod 777 /opt/couchdb/data /opt/couchdb/var/log ; rm /opt/couchdb/etc/default.d/10-filelog.ini ; rm -rf /var/lib/apt/lists/*\n#   Add configuration\nCOPY 10-docker-default.ini /opt/couchdb/etc/default.d/\nCOPY vm.args /opt/couchdb/etc/\nCOPY docker-entrypoint.sh /usr/local/bin\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\n#   Setup directories and permissions\nRUN find /opt/couchdb !\nVOLUME /opt/couchdb/data\n#   5984: Main CouchDB endpoint\n#   4369: Erlang portmap daemon (epmd)\n#   9100: CouchDB cluster communication port\nEXPOSE 5984/tcp 4369/tcp 9100/tcp\nCMD [\"/opt/couchdb/bin/couchdb\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n#  use this file except in compliance with the License. You may obtain a copy of\n#  the License at\n#\n#    http://www.apache.org/licenses/LICENSE-2.0\n#\n#  Unless required by applicable law or agreed to in writing, software\n#  distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n#  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n#  License for the specific language governing permissions and limitations under\n#  the License.\nFROM debian:stretch-slim\nLABEL maintainer=\"CouchDB Developers dev@couchdb.apache.org\"\n#  Add CouchDB user account to make sure the IDs are assigned consistently\nRUN groupadd -g 5984 -r couchdb \\\n && useradd -u 5984 -d /opt/couchdb -g couchdb couchdb\n#  be sure GPG and apt-transport-https are available and functional\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends apt-transport-https ca-certificates dirmngr gnupg -y ; rm -rf /var/lib/apt/lists/*\n#  grab gosu for easy step-down from root and tini for signal handling and zombie reaping\n#  see https://github.com/apache/couchdb-docker/pull/28#discussion_r141112407\nENV GOSU_VERSION=\"1.11\"\nENV TINI_VERSION=\"0.18.0\"\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends wget -y ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/${GOSU_VERSION}/gosu-$dpkgArch\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for server in $( shuf -e pgpkeys.mit.edu ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 pgp.mit.edu ;); do gpg --batch --keyserver $server --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && break || : ; done ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; chmod +x /usr/local/bin/gosu ; gosu nobody true ; wget -O /usr/local/bin/tini \"https://github.com/krallin/tini/releases/download/v${TINI_VERSION}/tini-$dpkgArch\" ; wget -O /usr/local/bin/tini.asc \"https://github.com/krallin/tini/releases/download/v${TINI_VERSION}/tini-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for server in $( shuf -e pgpkeys.mit.edu ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 pgp.mit.edu ;); do gpg --batch --keyserver $server --recv-keys 595E85A6B1B4779EA4DAAEC70B588DFF0527A9B7 \\\n && break || : ; done ; gpg --batch --verify /usr/local/bin/tini.asc /usr/local/bin/tini ; rm -rf \"$GNUPGHOME\" /usr/local/bin/tini.asc ; chmod +x /usr/local/bin/tini ; apt-get purge -y --auto-remove wget ; tini --version\n#  http://docs.couchdb.org/en/latest/install/unix.html#installing-the-apache-couchdb-packages\nENV GPG_COUCH_KEY=\"8756C4F765C9AC3CB6B85D62379CE192D401AB61\"\nRUN set -xe ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for server in $( shuf -e pgpkeys.mit.edu ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 pgp.mit.edu ;); do gpg --batch --keyserver $server --recv-keys $GPG_COUCH_KEY \\\n && break || : ; done ; gpg --batch --export $GPG_COUCH_KEY > /etc/apt/trusted.gpg.d/couchdb.gpg; command -v gpgconf \\\n && gpgconf --kill all || : ; rm -rf \"$GNUPGHOME\" ; apt-key list\nENV COUCHDB_VERSION=\"2.3.0\"\nRUN echo \"deb https://apache.bintray.com/couchdb-deb stretch main\" > /etc/apt/sources.list.d/couchdb.list\n#  https://github.com/apache/couchdb-pkg/blob/master/debian/README.Debian\nRUN set -xe ; apt-get update ; echo \"couchdb couchdb/mode select none\" | debconf-set-selections ; DEBIAN_FRONTEND=noninteractive apt-get install -y --allow-downgrades --allow-remove-essential --allow-change-held-packages couchdb=\"$COUCHDB_VERSION\"~stretch ; rmdir /var/lib/couchdb /var/log/couchdb ; rm /opt/couchdb/data /opt/couchdb/var/log ; mkdir -p /opt/couchdb/data /opt/couchdb/var/log ; chown couchdb:couchdb /opt/couchdb/data /opt/couchdb/var/log ; chmod 777 /opt/couchdb/data /opt/couchdb/var/log ; rm /opt/couchdb/etc/default.d/10-filelog.ini ; rm -rf /var/lib/apt/lists/*\n#  Add configuration\nCOPY 10-docker-default.ini /opt/couchdb/etc/default.d/\nCOPY vm.args /opt/couchdb/etc/\nCOPY docker-entrypoint.sh /usr/local/bin\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\n#  Setup directories and permissions\nRUN find /opt/couchdb ! ( -user couchdb -group couchdb ) -exec chown -f couchdb:couchdb '{}' +\nVOLUME /opt/couchdb/data\n#  5984: Main CouchDB endpoint\n#  4369: Erlang portmap daemon (epmd)\n#  9100: CouchDB cluster communication port\nEXPOSE 5984/tcp 4369/tcp 9100/tcp\nCMD [\"/opt/couchdb/bin/couchdb\"]\n","injectedSmells":[],"originalDockerfileHash":"b79cc05410f380d163300a47b824007d","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n#   use this file except in compliance with the License. You may obtain a copy of\n#   the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n#   Unless required by applicable law or agreed to in writing, software\n#   distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n#   WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n#   License for the specific language governing permissions and limitations under\n#   the License.\nFROM debian:stretch-slim\nLABEL maintainer=\"CouchDB Developers dev@couchdb.apache.org\"\n#   Add CouchDB user account to make sure the IDs are assigned consistently\nRUN groupadd -g 5984 -r couchdb \\\n && useradd -u 5984 -d /opt/couchdb -g couchdb couchdb\n#   be sure GPG and apt-transport-https are available and functional\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends apt-transport-https ca-certificates dirmngr gnupg -y ; rm -rf /var/lib/apt/lists/*\n#   grab gosu for easy step-down from root and tini for signal handling and zombie reaping\n#   see https://github.com/apache/couchdb-docker/pull/28#discussion_r141112407\nENV GOSU_VERSION=\"1.11\"\nENV TINI_VERSION=\"0.18.0\"\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends wget -y ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/${GOSU_VERSION}/gosu-$dpkgArch\" ; wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for server in $( shuf -e pgpkeys.mit.edu ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 pgp.mit.edu ;); do gpg --batch --keyserver $server --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && break || : ; done ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; chmod +x /usr/local/bin/gosu ; gosu nobody true ; wget -O /usr/local/bin/tini \"https://github.com/krallin/tini/releases/download/v${TINI_VERSION}/tini-$dpkgArch\" ; wget -O /usr/local/bin/tini.asc \"https://github.com/krallin/tini/releases/download/v${TINI_VERSION}/tini-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for server in $( shuf -e pgpkeys.mit.edu ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 pgp.mit.edu ;); do gpg --batch --keyserver $server --recv-keys 595E85A6B1B4779EA4DAAEC70B588DFF0527A9B7 \\\n && break || : ; done ; gpg --batch --verify /usr/local/bin/tini.asc /usr/local/bin/tini ; rm -rf \"$GNUPGHOME\" /usr/local/bin/tini.asc ; chmod +x /usr/local/bin/tini ; apt-get purge -y --auto-remove wget ; tini --version\n#   http://docs.couchdb.org/en/latest/install/unix.html#installing-the-apache-couchdb-packages\nENV GPG_COUCH_KEY=\"8756C4F765C9AC3CB6B85D62379CE192D401AB61\"\nRUN set -xe ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for server in $( shuf -e pgpkeys.mit.edu ha.pool.sks-keyservers.net hkp://p80.pool.sks-keyservers.net:80 pgp.mit.edu ;); do gpg --batch --keyserver $server --recv-keys $GPG_COUCH_KEY \\\n && break || : ; done ; gpg --batch --export $GPG_COUCH_KEY > /etc/apt/trusted.gpg.d/couchdb.gpg; command -v gpgconf \\\n && gpgconf --kill all || : ; rm -rf \"$GNUPGHOME\" ; apt-key list\nENV COUCHDB_VERSION=\"2.3.0\"\nRUN echo \"deb https://apache.bintray.com/couchdb-deb stretch main\" > /etc/apt/sources.list.d/couchdb.list\n#   https://github.com/apache/couchdb-pkg/blob/master/debian/README.Debian\nRUN set -xe ; apt-get update ; echo \"couchdb couchdb/mode select none\" | debconf-set-selections ; DEBIAN_FRONTEND=noninteractive apt-get install -y --allow-downgrades --allow-remove-essential --allow-change-held-packages couchdb=\"$COUCHDB_VERSION\"~stretch ; rmdir /var/lib/couchdb /var/log/couchdb ; rm /opt/couchdb/data /opt/couchdb/var/log ; mkdir -p /opt/couchdb/data /opt/couchdb/var/log ; chown couchdb:couchdb /opt/couchdb/data /opt/couchdb/var/log ; chmod 777 /opt/couchdb/data /opt/couchdb/var/log ; rm /opt/couchdb/etc/default.d/10-filelog.ini ; rm -rf /var/lib/apt/lists/*\n#   Add configuration\nCOPY 10-docker-default.ini /opt/couchdb/etc/default.d/\nCOPY vm.args /opt/couchdb/etc/\nCOPY docker-entrypoint.sh /usr/local/bin\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\n#   Setup directories and permissions\nRUN find /opt/couchdb !\nVOLUME /opt/couchdb/data\n#   5984: Main CouchDB endpoint\n#   4369: Erlang portmap daemon (epmd)\n#   9100: CouchDB cluster communication port\nEXPOSE 5984/tcp 4369/tcp 9100/tcp\nCMD [\"/opt/couchdb/bin/couchdb\"]\n","originalDockerfileUglifiedHash":"94734c1bc84faca193cbf6b434dc49ab","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/710f3c92846c0e226ab137b96077319070596905.dockerfile"}