{"seed":4125745223,"processedDockerfileHash":"85b81d45624971b7b53b61fff6cb793d","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM danielguerra/debian-bro-develop\nMAINTAINER danielguerra, https://github.com/danielguerra\n#   add patches for bro to work with elasticsearch 2.0 (remove . set correct time)\nCOPY /bro-patch /bro-patch\n#   build bro + tools\nRUN buildDeps='build-essential autoconf install-info libgoogle-perftools-dev libcurl3-dev libgeoip-dev libpcap-dev libssl-dev python-dev zlib1g-dev libedit-dev doxygen git-core cmake make g++ gcc libpcre3-dev python-setuptools libsnappy-dev libbz2-dev devscripts libjemalloc-dev libjemalloc1-dbg ' \\\n && set -x \\\n && cd /tmp \\\n && git clone --recursive git://git.bro.org/bro \\\n && patch /tmp/bro/aux/plugins/elasticsearch/src/ElasticSearch.cc /bro-patch/ElasticSearch.cc.patch \\\n && cd /tmp/bro \\\n && ./configure --enable-broker \\\n && make \\\n && make install \\\n && sed -i \"s/127.0.0.1/elasticsearch/g\" /tmp/bro/aux/plugins/elasticsearch/scripts/init.bro \\\n && sed -i \"s/2secs/60secs/g\" /tmp/bro/aux/plugins/elasticsearch/scripts/init.bro \\\n && sed -i \"s/const max_batch_size = 1000/const max_batch_size = 500/g\" /tmp/bro/aux/plugins/elasticsearch/scripts/init.bro \\\n && cd /tmp/bro/aux/plugins/elasticsearch \\\n && ./configure \\\n && make \\\n && make install \\\n && cd /tmp \\\n && git clone --recursive https://github.com/jonschipp/mal-dnssearch.git \\\n && cd /tmp/mal-dnssearch \\\n && make \\\n && apt-get remove -y $buildDeps \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#   add maintance shell scripts\nCOPY /scripts /scripts\n#  add extra bro files\nCOPY /bro-extra /usr/local/bro/share/bro/bro-extra\nRUN echo \"@load bro-extra\" >> /usr/local/bro/share/bro/base/init-default.bro\n#   add bro service\nRUN echo \"bro 1969/tcp # bro pcap feed\" >> /etc/services\n#  fresh intel\nRUN /scripts/update-intel.sh\n#  set the expose ports\nEXPOSE 22/tcp\nEXPOSE 1969/tcp\nEXPOSE 47761/tcp\nEXPOSE 47762/tcp\n#  set default dir\nWORKDIR /tmp\n#  Add geolitecityv6\nRUN wget http://geolite.maxmind.com/download/geoip/database/GeoLiteCityv6-beta/GeoLiteCityv6.dat.gz\nRUN gunzip GeoLiteCityv6.dat.gz\nRUN mv GeoLiteCityv6.dat /usr/share/GeoIP/GeoLiteCityv6.dat\nRUN ln -s /usr/share/GeoIP/GeoLiteCityv6.dat /usr/share/GeoIP/GeoIPCityv6.dat\n#   Do some elasticsearch tweaks (couldnt solve it with mapping :`( )\n#   elastic is not happy about version, type change count/string\nRUN sed -i \"s/version: count \\&log/socks_version: count \\&log/g\" /usr/local/bro/share/bro/base/protocols/socks/main.bro\nRUN sed -i \"s/$version=/$socks_version=/g\" /usr/local/bro/share/bro/base/protocols/socks/main.bro\nRUN sed -i \"s/version: string \\&log/ssl_version: string \\&log/g\" /usr/local/bro/share/bro/base/protocols/ssl/main.bro\nRUN sed -i \"s/$version=/$ssl_version=/g\" /usr/local/bro/share/bro/base/protocols/ssl/main.bro\nRUN sed -i \"s/version: count \\&log/ssh_version: count \\&log/g\" /usr/local/bro/share/bro/base/protocols/ssh/main.bro\nRUN sed -i \"s/$version =/$ssh_version =/g\" /usr/local/bro/share/bro/base/protocols/ssh/main.bro\nRUN sed -i \"s/version: string \\&log/snmp_version: string \\&log/g\" /usr/local/bro/share/bro/base/protocols/snmp/main.bro\nRUN sed -i \"s/$version=/$snmp_version=/g\" /usr/local/bro/share/bro/base/protocols/snmp/main.bro\n#   bro pcap-in tcp services\nCOPY /xinetd /xinetd\n#   add role scripts\nCOPY /role /role\n#   add php scripts\nCOPY /php/index.php /var/www/html/index.php\n#   add supervisor config\nCOPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf\n#  create output dirs\nRUN mkdir /bro /bro/pcap /var/www/html/extract_files\nCMD [\"/role/cmd-bare\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM danielguerra/debian-bro-develop\nMAINTAINER danielguerra, https://github.com/danielguerra\n#  add patches for bro to work with elasticsearch 2.0 (remove . set correct time)\nADD /bro-patch /bro-patch\n#  build bro + tools\nRUN buildDeps='build-essential autoconf install-info libgoogle-perftools-dev libcurl3-dev libgeoip-dev libpcap-dev libssl-dev python-dev zlib1g-dev libedit-dev doxygen git-core cmake make g++ gcc libpcre3-dev python-setuptools libsnappy-dev libbz2-dev devscripts libjemalloc-dev libjemalloc1-dbg ' \\\n && set -x \\\n && cd /tmp \\\n && git clone --recursive git://git.bro.org/bro \\\n && patch /tmp/bro/aux/plugins/elasticsearch/src/ElasticSearch.cc /bro-patch/ElasticSearch.cc.patch \\\n && cd /tmp/bro \\\n && ./configure --enable-broker \\\n && make \\\n && make install \\\n && sed -i \"s/127.0.0.1/elasticsearch/g\" /tmp/bro/aux/plugins/elasticsearch/scripts/init.bro \\\n && sed -i \"s/2secs/60secs/g\" /tmp/bro/aux/plugins/elasticsearch/scripts/init.bro \\\n && sed -i \"s/const max_batch_size = 1000/const max_batch_size = 500/g\" /tmp/bro/aux/plugins/elasticsearch/scripts/init.bro \\\n && cd /tmp/bro/aux/plugins/elasticsearch \\\n && ./configure \\\n && make \\\n && make install \\\n && cd /tmp \\\n && git clone --recursive https://github.com/jonschipp/mal-dnssearch.git \\\n && cd /tmp/mal-dnssearch \\\n && make \\\n && apt-get remove -y $buildDeps \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#  add maintance shell scripts\nADD /scripts /scripts\n# add extra bro files\nADD /bro-extra /usr/local/bro/share/bro/bro-extra\nRUN echo \"@load bro-extra\" >> /usr/local/bro/share/bro/base/init-default.bro\n#  add bro service\nRUN echo \"bro 1969/tcp # bro pcap feed\" >> /etc/services\n# fresh intel\nRUN /scripts/update-intel.sh\n# set the expose ports\nEXPOSE 22/tcp\nEXPOSE 1969/tcp\nEXPOSE 47761/tcp\nEXPOSE 47762/tcp\n# set default dir\nWORKDIR /tmp\n# Add geolitecityv6\nRUN wget http://geolite.maxmind.com/download/geoip/database/GeoLiteCityv6-beta/GeoLiteCityv6.dat.gz\nRUN gunzip GeoLiteCityv6.dat.gz\nRUN mv GeoLiteCityv6.dat /usr/share/GeoIP/GeoLiteCityv6.dat\nRUN ln -s /usr/share/GeoIP/GeoLiteCityv6.dat /usr/share/GeoIP/GeoIPCityv6.dat\n#  Do some elasticsearch tweaks (couldnt solve it with mapping :`( )\n#  elastic is not happy about version, type change count/string\nRUN sed -i \"s/version: count \\&log/socks_version: count \\&log/g\" /usr/local/bro/share/bro/base/protocols/socks/main.bro\nRUN sed -i \"s/$version=/$socks_version=/g\" /usr/local/bro/share/bro/base/protocols/socks/main.bro\nRUN sed -i \"s/version: string \\&log/ssl_version: string \\&log/g\" /usr/local/bro/share/bro/base/protocols/ssl/main.bro\nRUN sed -i \"s/$version=/$ssl_version=/g\" /usr/local/bro/share/bro/base/protocols/ssl/main.bro\nRUN sed -i \"s/version: count \\&log/ssh_version: count \\&log/g\" /usr/local/bro/share/bro/base/protocols/ssh/main.bro\nRUN sed -i \"s/$version =/$ssh_version =/g\" /usr/local/bro/share/bro/base/protocols/ssh/main.bro\nRUN sed -i \"s/version: string \\&log/snmp_version: string \\&log/g\" /usr/local/bro/share/bro/base/protocols/snmp/main.bro\nRUN sed -i \"s/$version=/$snmp_version=/g\" /usr/local/bro/share/bro/base/protocols/snmp/main.bro\n#  bro pcap-in tcp services\nADD /xinetd /xinetd\n#  add role scripts\nADD /role /role\n#  add php scripts\nADD /php/index.php /var/www/html/index.php\n#  add supervisor config\nADD supervisord.conf /etc/supervisor/conf.d/supervisord.conf\n# create output dirs\nRUN mkdir /bro /bro/pcap /var/www/html/extract_files\nCMD [\"/role/cmd-bare\"]\n","injectedSmells":[],"originalDockerfileHash":"ab52ef2a8f4ae274cd9cb2c3f5e9e047","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM danielguerra/debian-bro-develop\nMAINTAINER danielguerra, https://github.com/danielguerra\n#   add patches for bro to work with elasticsearch 2.0 (remove . set correct time)\nADD /bro-patch /bro-patch\n#   build bro + tools\nRUN buildDeps='build-essential autoconf install-info libgoogle-perftools-dev libcurl3-dev libgeoip-dev libpcap-dev libssl-dev python-dev zlib1g-dev libedit-dev doxygen git-core cmake make g++ gcc libpcre3-dev python-setuptools libsnappy-dev libbz2-dev devscripts libjemalloc-dev libjemalloc1-dbg ' \\\n && set -x \\\n && cd /tmp \\\n && git clone --recursive git://git.bro.org/bro \\\n && patch /tmp/bro/aux/plugins/elasticsearch/src/ElasticSearch.cc /bro-patch/ElasticSearch.cc.patch \\\n && cd /tmp/bro \\\n && ./configure --enable-broker \\\n && make \\\n && make install \\\n && sed -i \"s/127.0.0.1/elasticsearch/g\" /tmp/bro/aux/plugins/elasticsearch/scripts/init.bro \\\n && sed -i \"s/2secs/60secs/g\" /tmp/bro/aux/plugins/elasticsearch/scripts/init.bro \\\n && sed -i \"s/const max_batch_size = 1000/const max_batch_size = 500/g\" /tmp/bro/aux/plugins/elasticsearch/scripts/init.bro \\\n && cd /tmp/bro/aux/plugins/elasticsearch \\\n && ./configure \\\n && make \\\n && make install \\\n && cd /tmp \\\n && git clone --recursive https://github.com/jonschipp/mal-dnssearch.git \\\n && cd /tmp/mal-dnssearch \\\n && make \\\n && apt-get remove -y $buildDeps \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#   add maintance shell scripts\nADD /scripts /scripts\n#  add extra bro files\nADD /bro-extra /usr/local/bro/share/bro/bro-extra\nRUN echo \"@load bro-extra\" >> /usr/local/bro/share/bro/base/init-default.bro\n#   add bro service\nRUN echo \"bro 1969/tcp # bro pcap feed\" >> /etc/services\n#  fresh intel\nRUN /scripts/update-intel.sh\n#  set the expose ports\nEXPOSE 22/tcp\nEXPOSE 1969/tcp\nEXPOSE 47761/tcp\nEXPOSE 47762/tcp\n#  set default dir\nWORKDIR /tmp\n#  Add geolitecityv6\nRUN wget http://geolite.maxmind.com/download/geoip/database/GeoLiteCityv6-beta/GeoLiteCityv6.dat.gz\nRUN gunzip GeoLiteCityv6.dat.gz\nRUN mv GeoLiteCityv6.dat /usr/share/GeoIP/GeoLiteCityv6.dat\nRUN ln -s /usr/share/GeoIP/GeoLiteCityv6.dat /usr/share/GeoIP/GeoIPCityv6.dat\n#   Do some elasticsearch tweaks (couldnt solve it with mapping :`( )\n#   elastic is not happy about version, type change count/string\nRUN sed -i \"s/version: count \\&log/socks_version: count \\&log/g\" /usr/local/bro/share/bro/base/protocols/socks/main.bro\nRUN sed -i \"s/$version=/$socks_version=/g\" /usr/local/bro/share/bro/base/protocols/socks/main.bro\nRUN sed -i \"s/version: string \\&log/ssl_version: string \\&log/g\" /usr/local/bro/share/bro/base/protocols/ssl/main.bro\nRUN sed -i \"s/$version=/$ssl_version=/g\" /usr/local/bro/share/bro/base/protocols/ssl/main.bro\nRUN sed -i \"s/version: count \\&log/ssh_version: count \\&log/g\" /usr/local/bro/share/bro/base/protocols/ssh/main.bro\nRUN sed -i \"s/$version =/$ssh_version =/g\" /usr/local/bro/share/bro/base/protocols/ssh/main.bro\nRUN sed -i \"s/version: string \\&log/snmp_version: string \\&log/g\" /usr/local/bro/share/bro/base/protocols/snmp/main.bro\nRUN sed -i \"s/$version=/$snmp_version=/g\" /usr/local/bro/share/bro/base/protocols/snmp/main.bro\n#   bro pcap-in tcp services\nADD /xinetd /xinetd\n#   add role scripts\nADD /role /role\n#   add php scripts\nADD /php/index.php /var/www/html/index.php\n#   add supervisor config\nADD supervisord.conf /etc/supervisor/conf.d/supervisord.conf\n#  create output dirs\nRUN mkdir /bro /bro/pcap /var/www/html/extract_files\nCMD [\"/role/cmd-bare\"]\n","originalDockerfileUglifiedHash":"f3a4c2856865dfa28d3d3eb63dc5a024","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/2f5609f820e2d9f8f1826741e2dcab314b9b7ae8.dockerfile"}