{"seed":3135756151,"processedDockerfileHash":"22fb3d4a14a7ac5da103092e14b8b041","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   vim:set ft=dockerfile:\nFROM debian:stretch-slim\n#   explicitly set user/group IDs\nRUN groupadd -r cassandra --gid=999 \\\n && useradd -r -g cassandra --uid=999 cassandra\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends libjemalloc1 procps iproute2 -y ; if ! command -v gpg > /dev/null; then apt-get install --no-install-recommends dirmngr gnupg -y ; fi ; rm -rf /var/lib/apt/lists/*\n#   grab gosu for easy step-down from root\nENV GOSU_VERSION=\"1.10\"\nRUN set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends ca-certificates wget -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;)\" \\\n && wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;).asc\" \\\n && export GNUPGHOME=\"$( mktemp -d ;)\" \\\n && gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu \\\n && { command -v gpgconf \\\n && gpgconf --kill all || : ; } \\\n && rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && gosu nobody true \\\n && apt-get purge -y --auto-remove ca-certificates wget\n#   https://wiki.apache.org/cassandra/DebianPackaging#Adding_Repository_Keys\nENV GPG_KEYS=\"514A2AD631A57A16DD0047EC749D6EEC0353B12C  A26E528B271F19B9E5D8E19EA278B781FE4B2BDA\"\nRUN set -ex ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for key in $GPG_KEYS; do gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; done ; gpg --batch --export $GPG_KEYS > /etc/apt/trusted.gpg.d/cassandra.gpg; command -v gpgconf \\\n && gpgconf --kill all || : ; rm -rf \"$GNUPGHOME\" ; apt-key list\nENV CASSANDRA_VERSION=\"3.0.18\"\nRUN set -ex ; mkdir -p /usr/share/man/man1/ ; dpkgArch=\"$( dpkg --print-architecture ;)\" ; case \"$dpkgArch\" in (amd64|i386) echo 'deb http://www.apache.org/dist/cassandra/debian 30x main' > /etc/apt/sources.list.d/cassandra.list; apt-get update ;;(*) savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends wget ca-certificates dpkg-dev -y ; apt-mark showmanual | xargs apt-mark auto > /dev/null; apt-mark manual $savedAptMark ; tempDir=\"$( mktemp -d ;)\" ; for pkg in cassandra cassandra-tools; do deb=\"${pkg}_${CASSANDRA_VERSION}_all.deb\" ;wget -O \"$tempDir/$deb\" \"https://www.apache.org/dist/cassandra/debian/pool/main/c/cassandra/$deb\" ; done ; ls -lAFh \"$tempDir\" ; (cd \"$tempDir\" \\\n && dpkg-scanpackages . > Packages) ; grep '^Package: ' \"$tempDir/Packages\" ; echo \"deb [ trusted=yes ] file://$tempDir ./\" > /etc/apt/sources.list.d/temp.list; apt-get -o Acquire::GzipIndexes=false update ;; esac ; apt-get install --no-install-recommends cassandra=\"$CASSANDRA_VERSION\" cassandra-tools=\"$CASSANDRA_VERSION\" -y ; rm -rf /var/lib/apt/lists/* ; if [ -n \"$tempDir\" ] ; then apt-get purge -y --auto-remove ;rm -rf \"$tempDir\" /etc/apt/sources.list.d/temp.list ; fi\nENV CASSANDRA_CONFIG=\"/etc/cassandra\"\nRUN set -ex ; dpkgArch=\"$( dpkg --print-architecture ;)\" ; case \"$dpkgArch\" in (ppc64el) if grep -q -- '^-Xss' \"$CASSANDRA_CONFIG/jvm.options\" ; then grep -- '^-Xss256k$' \"$CASSANDRA_CONFIG/jvm.options\" ;sed -ri 's/^-Xss256k$/-Xss512k/' \"$CASSANDRA_CONFIG/jvm.options\" ;grep -- '^-Xss512k$' \"$CASSANDRA_CONFIG/jvm.options\" ; elif grep -q -- '-Xss256k' \"$CASSANDRA_CONFIG/cassandra-env.sh\" ; then sed -ri 's/-Xss256k/-Xss512k/g' \"$CASSANDRA_CONFIG/cassandra-env.sh\" ;grep -- '-Xss512k' \"$CASSANDRA_CONFIG/cassandra-env.sh\" ; fi ;; esac ; sed -ri 's/^(JVM_PATCH_VERSION)=.*/\\1=25/' \"$CASSANDRA_CONFIG/cassandra-env.sh\"\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh\nENTRYPOINT [\"docker-entrypoint.sh\"]\nRUN mkdir -p /var/lib/cassandra \"$CASSANDRA_CONFIG\" \\\n && chown -R cassandra:cassandra /var/lib/cassandra \"$CASSANDRA_CONFIG\" \\\n && chmod 777 /var/lib/cassandra \"$CASSANDRA_CONFIG\"\nVOLUME /var/lib/cassandra\n#   7000: intra-node communication\n#   7001: TLS intra-node communication\n#   7199: JMX\n#   9042: CQL\n#   9160: thrift service\nEXPOSE 7000/tcp 7001/tcp 7199/tcp 9042/tcp 9160/tcp\nCMD [\"cassandra\", \"-f\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  vim:set ft=dockerfile:\nFROM debian:stretch-slim\n#  explicitly set user/group IDs\nRUN groupadd -r cassandra --gid=999 \\\n && useradd -r -g cassandra --uid=999 cassandra\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends libjemalloc1 procps iproute2 -y ; if ! command -v gpg > /dev/null; then apt-get install --no-install-recommends dirmngr gnupg -y ; fi ; rm -rf /var/lib/apt/lists/*\n#  grab gosu for easy step-down from root\nENV GOSU_VERSION=\"1.10\"\nRUN set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends ca-certificates wget -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;)\" \\\n && wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;).asc\" \\\n && export GNUPGHOME=\"$( mktemp -d ;)\" \\\n && gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu \\\n && { command -v gpgconf \\\n && gpgconf --kill all || : ; } \\\n && rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && gosu nobody true \\\n && apt-get purge -y --auto-remove ca-certificates wget\n#  https://wiki.apache.org/cassandra/DebianPackaging#Adding_Repository_Keys\nENV GPG_KEYS=\"514A2AD631A57A16DD0047EC749D6EEC0353B12C  A26E528B271F19B9E5D8E19EA278B781FE4B2BDA\"\nRUN set -ex ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for key in $GPG_KEYS; do gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; done ; gpg --batch --export $GPG_KEYS > /etc/apt/trusted.gpg.d/cassandra.gpg; command -v gpgconf \\\n && gpgconf --kill all || : ; rm -rf \"$GNUPGHOME\" ; apt-key list\nENV CASSANDRA_VERSION=\"3.0.18\"\nRUN set -ex ; mkdir -p /usr/share/man/man1/ ; dpkgArch=\"$( dpkg --print-architecture ;)\" ; case \"$dpkgArch\" in (amd64|i386) echo 'deb http://www.apache.org/dist/cassandra/debian 30x main' > /etc/apt/sources.list.d/cassandra.list; apt-get update ;;(*) savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends wget ca-certificates dpkg-dev -y ; apt-mark showmanual | xargs apt-mark auto > /dev/null; apt-mark manual $savedAptMark ; tempDir=\"$( mktemp -d ;)\" ; for pkg in cassandra cassandra-tools; do deb=\"${pkg}_${CASSANDRA_VERSION}_all.deb\" ;wget -O \"$tempDir/$deb\" \"https://www.apache.org/dist/cassandra/debian/pool/main/c/cassandra/$deb\" ; done ; ls -lAFh \"$tempDir\" ; (cd \"$tempDir\" \\\n && dpkg-scanpackages . > Packages) ; grep '^Package: ' \"$tempDir/Packages\" ; echo \"deb [ trusted=yes ] file://$tempDir ./\" > /etc/apt/sources.list.d/temp.list; apt-get -o Acquire::GzipIndexes=false update ;; esac ; apt-get install cassandra=\"$CASSANDRA_VERSION\" cassandra-tools=\"$CASSANDRA_VERSION\" -y ; rm -rf /var/lib/apt/lists/* ; if [ -n \"$tempDir\" ] ; then apt-get purge -y --auto-remove ;rm -rf \"$tempDir\" /etc/apt/sources.list.d/temp.list ; fi\nENV CASSANDRA_CONFIG=\"/etc/cassandra\"\nRUN set -ex ; dpkgArch=\"$( dpkg --print-architecture ;)\" ; case \"$dpkgArch\" in (ppc64el) if grep -q -- '^-Xss' \"$CASSANDRA_CONFIG/jvm.options\" ; then grep -- '^-Xss256k$' \"$CASSANDRA_CONFIG/jvm.options\" ;sed -ri 's/^-Xss256k$/-Xss512k/' \"$CASSANDRA_CONFIG/jvm.options\" ;grep -- '^-Xss512k$' \"$CASSANDRA_CONFIG/jvm.options\" ; elif grep -q -- '-Xss256k' \"$CASSANDRA_CONFIG/cassandra-env.sh\" ; then sed -ri 's/-Xss256k/-Xss512k/g' \"$CASSANDRA_CONFIG/cassandra-env.sh\" ;grep -- '-Xss512k' \"$CASSANDRA_CONFIG/cassandra-env.sh\" ; fi ;; esac ; sed -ri 's/^(JVM_PATCH_VERSION)=.*/\\1=25/' \"$CASSANDRA_CONFIG/cassandra-env.sh\"\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh\nENTRYPOINT [\"docker-entrypoint.sh\"]\nRUN mkdir -p /var/lib/cassandra \"$CASSANDRA_CONFIG\" \\\n && chown -R cassandra:cassandra /var/lib/cassandra \"$CASSANDRA_CONFIG\" \\\n && chmod 777 /var/lib/cassandra \"$CASSANDRA_CONFIG\"\nVOLUME /var/lib/cassandra\n#  7000: intra-node communication\n#  7001: TLS intra-node communication\n#  7199: JMX\n#  9042: CQL\n#  9160: thrift service\nEXPOSE 7000/tcp 7001/tcp 7199/tcp 9042/tcp 9160/tcp\nCMD [\"cassandra\", \"-f\"]\n","injectedSmells":[],"originalDockerfileHash":"e4c98f9014450c9d1c5471c6bae7d777","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   vim:set ft=dockerfile:\nFROM debian:stretch-slim\n#   explicitly set user/group IDs\nRUN groupadd -r cassandra --gid=999 \\\n && useradd -r -g cassandra --uid=999 cassandra\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends libjemalloc1 procps iproute2 -y ; if ! command -v gpg > /dev/null; then apt-get install --no-install-recommends dirmngr gnupg -y ; fi ; rm -rf /var/lib/apt/lists/*\n#   grab gosu for easy step-down from root\nENV GOSU_VERSION=\"1.10\"\nRUN set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends ca-certificates wget -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;)\" \\\n && wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;).asc\" \\\n && export GNUPGHOME=\"$( mktemp -d ;)\" \\\n && gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu \\\n && { command -v gpgconf \\\n && gpgconf --kill all || : ; } \\\n && rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && gosu nobody true \\\n && apt-get purge -y --auto-remove ca-certificates wget\n#   https://wiki.apache.org/cassandra/DebianPackaging#Adding_Repository_Keys\nENV GPG_KEYS=\"514A2AD631A57A16DD0047EC749D6EEC0353B12C  A26E528B271F19B9E5D8E19EA278B781FE4B2BDA\"\nRUN set -ex ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for key in $GPG_KEYS; do gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; done ; gpg --batch --export $GPG_KEYS > /etc/apt/trusted.gpg.d/cassandra.gpg; command -v gpgconf \\\n && gpgconf --kill all || : ; rm -rf \"$GNUPGHOME\" ; apt-key list\nENV CASSANDRA_VERSION=\"3.0.18\"\nRUN set -ex ; mkdir -p /usr/share/man/man1/ ; dpkgArch=\"$( dpkg --print-architecture ;)\" ; case \"$dpkgArch\" in (amd64|i386) echo 'deb http://www.apache.org/dist/cassandra/debian 30x main' > /etc/apt/sources.list.d/cassandra.list; apt-get update ;;(*) savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends wget ca-certificates dpkg-dev -y ; apt-mark showmanual | xargs apt-mark auto > /dev/null; apt-mark manual $savedAptMark ; tempDir=\"$( mktemp -d ;)\" ; for pkg in cassandra cassandra-tools; do deb=\"${pkg}_${CASSANDRA_VERSION}_all.deb\" ;wget -O \"$tempDir/$deb\" \"https://www.apache.org/dist/cassandra/debian/pool/main/c/cassandra/$deb\" ; done ; ls -lAFh \"$tempDir\" ; (cd \"$tempDir\" \\\n && dpkg-scanpackages . > Packages) ; grep '^Package: ' \"$tempDir/Packages\" ; echo \"deb [ trusted=yes ] file://$tempDir ./\" > /etc/apt/sources.list.d/temp.list; apt-get -o Acquire::GzipIndexes=false update ;; esac ; apt-get install cassandra=\"$CASSANDRA_VERSION\" cassandra-tools=\"$CASSANDRA_VERSION\" -y ; rm -rf /var/lib/apt/lists/* ; if [ -n \"$tempDir\" ] ; then apt-get purge -y --auto-remove ;rm -rf \"$tempDir\" /etc/apt/sources.list.d/temp.list ; fi\nENV CASSANDRA_CONFIG=\"/etc/cassandra\"\nRUN set -ex ; dpkgArch=\"$( dpkg --print-architecture ;)\" ; case \"$dpkgArch\" in (ppc64el) if grep -q -- '^-Xss' \"$CASSANDRA_CONFIG/jvm.options\" ; then grep -- '^-Xss256k$' \"$CASSANDRA_CONFIG/jvm.options\" ;sed -ri 's/^-Xss256k$/-Xss512k/' \"$CASSANDRA_CONFIG/jvm.options\" ;grep -- '^-Xss512k$' \"$CASSANDRA_CONFIG/jvm.options\" ; elif grep -q -- '-Xss256k' \"$CASSANDRA_CONFIG/cassandra-env.sh\" ; then sed -ri 's/-Xss256k/-Xss512k/g' \"$CASSANDRA_CONFIG/cassandra-env.sh\" ;grep -- '-Xss512k' \"$CASSANDRA_CONFIG/cassandra-env.sh\" ; fi ;; esac ; sed -ri 's/^(JVM_PATCH_VERSION)=.*/\\1=25/' \"$CASSANDRA_CONFIG/cassandra-env.sh\"\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh\nENTRYPOINT [\"docker-entrypoint.sh\"]\nRUN mkdir -p /var/lib/cassandra \"$CASSANDRA_CONFIG\" \\\n && chown -R cassandra:cassandra /var/lib/cassandra \"$CASSANDRA_CONFIG\" \\\n && chmod 777 /var/lib/cassandra \"$CASSANDRA_CONFIG\"\nVOLUME /var/lib/cassandra\n#   7000: intra-node communication\n#   7001: TLS intra-node communication\n#   7199: JMX\n#   9042: CQL\n#   9160: thrift service\nEXPOSE 7000/tcp 7001/tcp 7199/tcp 9042/tcp 9160/tcp\nCMD [\"cassandra\", \"-f\"]\n","originalDockerfileUglifiedHash":"cd90c8fb79cddb0adaa29dd646cb1945","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/1d8c362e7043d7b78836f06256d0ae9b82561af8.dockerfile"}