{"seed":3330010086,"processedDockerfileHash":"4f265d5320ce6fcfa8c1f869bb69796c","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","have-a-healthcheck","have-a-user"],"processedDockerfile":"#\n#   Docker image for Pentaho BA server community edition.\n#\n#   Pull base image\nFROM zhicwu/java:8\n#   Set maintainer\nMAINTAINER Zhichun Wu <zhicwu@gmail.com>\n#   Set environment variables\nENV BISERVER_VERSION=\"7.0\" \\\n    BISERVER_BUILD=\"7.0.0.0-25\" \\\n    PDI_PATCH=\"7.0.0.0.3\" \\\n    BISERVER_HOME=\"/biserver-ce\" \\\n    BISERVER_USER=\"pentaho\" \\\n    KETTLE_HOME=\"/biserver-ce/pentaho-solutions/system/kettle\" \\\n    JNA_VERSION=\"4.2.2\" \\\n    OSHI_VERSION=\"3.2\" \\\n    POSTGRESQL_DRIVER_VERSION=\"9.4.1212\" \\\n    MYSQL_DRIVER_VERSION=\"5.1.41\" \\\n    JTDS_VERSION=\"1.3.1\" \\\n    CASSANDRA_DRIVER_VERSION=\"0.6.3\" \\\n    H2DB_VERSION=\"1.4.193\" \\\n    HSQLDB_VERSION=\"2.3.4\" \\\n    XMLA_PROVIDER_VERSION=\"1.0.0.103\"\n#   Set label\nLABEL java_server=\"Pentaho BA Server $BISERVER_VERSION Community Edition\"\n#   Install vanilla Pentaho server along with minor changes to configuration\nRUN echo \"Download and unpack Pentaho server...\" \\\n && wget --progress=dot:giga http://downloads.sourceforge.net/project/pentaho/Business%20Intelligence%20Server/${BISERVER_VERSION}/pentaho-server-ce-${BISERVER_BUILD}.zip \\\n && unzip -q *.zip \\\n && rm -f *.zip \\\n && mv /pentaho-server $BISERVER_HOME \\\n && ln -s $BISERVER_HOME /pentaho-server \\\n && find $BISERVER_HOME -name \"*.bat\" -delete \\\n && find $BISERVER_HOME -name \"*.exe\" -delete \\\n && mkdir -p $BISERVER_HOME/data/.hsqldb \\\n && /bin/cp -rf $BISERVER_HOME/data/hsqldb/* $BISERVER_HOME/data/.hsqldb/. \\\n && echo \"Install APR for Tomcat...\" \\\n && tar zxf $BISERVER_HOME/tomcat/bin/tomcat-native.tar.gz \\\n && cd tomcat-native*/native \\\n && apt-get update \\\n && apt-get install --no-install-recommends libjna-java libapr1-dev gcc make -y \\\n && ./configure --with-apr=/usr/bin/apr-config --disable-openssl --with-java-home=$JAVA_HOME --prefix=$BISERVER_HOME/tomcat \\\n && make \\\n && make install \\\n && sed -i -e 's|\\(SSLEngine=\"\\).*\\(\"\\)|\\1off\\2|' $BISERVER_HOME/tomcat/conf/server.xml \\\n && cd / \\\n && rm -rf tomcat-native* $BISERVER_HOME/tomcat/bin/tomcat-native.tar.gz \\\n && apt-get autoremove -y libapr1-dev gcc make \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* \\\n && echo \"Update server configuration...\" \\\n && cd $BISERVER_HOME \\\n && sed -i -e 's/\\(exec \".*\"\\) start/\\1 run/' tomcat/bin/startup.sh \\\n && rm -f promptuser.* pentaho-solutions/system/default-content/* \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\">\\n <extension>xlsx</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.template\">\\n <extension>xltx</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.ms-excel.sheet.macroEnabled.12\">\\n <extension>xlsm</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.ms-excel.template.macroEnabled.12\">\\n <extension>xltm</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.ms-excel.addin.macroEnabled.12\">\\n <extension>xlam</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.ms-excel.sheet.binary.macroEnabled.12\">\\n <extension>xlsb</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <extension>xls</extension>\\)|\\1\\n <extension>xlt</extension>\\n <extension>xla</extension>|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <extension>sql</extension>\\)|\\1\\n <extension>txt</extension>\\n <extension>csv</extension>|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\(,csv,\\)|\\1sql,|' pentaho-solutions/system/*.xml \\\n && sed -i -e 's|\\(,xlsx,\\)|\\1xltx,xlsm,xltm,xlam,xlsb,|' pentaho-solutions/system/*.xml \\\n && echo \"Add Pentaho user...\" \\\n && useradd -md $BISERVER_HOME -s /bin/bash $BISERVER_USER\n#   Change work directory\nWORKDIR $BISERVER_HOME\n#   Add latest JDBC drivers and XMLA connector\nRUN echo \"Download and install JDBC drivers...\" \\\n && wget --progress=dot:giga https://jdbc.postgresql.org/download/postgresql-${POSTGRESQL_DRIVER_VERSION}.jar http://central.maven.org/maven2/mysql/mysql-connector-java/${MYSQL_DRIVER_VERSION}/mysql-connector-java-${MYSQL_DRIVER_VERSION}.jar http://central.maven.org/maven2/net/sourceforge/jtds/jtds/${JTDS_VERSION}/jtds-${JTDS_VERSION}.jar http://central.maven.org/maven2/com/github/zhicwu/cassandra-jdbc-driver/${CASSANDRA_DRIVER_VERSION}/cassandra-jdbc-driver-${CASSANDRA_DRIVER_VERSION}-shaded.jar http://central.maven.org/maven2/com/h2database/h2/${H2DB_VERSION}/h2-${H2DB_VERSION}.jar http://central.maven.org/maven2/org/hsqldb/hsqldb/${HSQLDB_VERSION}/hsqldb-${HSQLDB_VERSION}.jar \\\n && wget --progress=dot:giga -O tomcat/webapps/pentaho/docs/xmla-connector.exe https://sourceforge.net/projects/xmlaconnect/files/XMLA_Provider_v${XMLA_PROVIDER_VERSION}.exe/download \\\n && sed -i -e 's|\\( class=\"bannercontent\">.*\\)\\(<br /></td>\\)|\\1<br />To access OLAP cube via Excel/SharePoint, please install <a href=\"xmla-connector.exe\">XMLA Connector</a> from <a href=\"http://www.arquery.com\">Arquery</a>.\\2|' tomcat/webapps/pentaho/docs/InformationMap.jsp \\\n && rm -f tomcat/lib/postgre*.jar tomcat/lib/mysql*.jar tomcat/lib/jtds*.jar tomcat/lib/h2*.jar tomcat/lib/hsqldb*.jar \\\n && mv *.jar $BISERVER_HOME/tomcat/lib/.\n#   Install plugins\nRUN echo \"Download plugins...\" \\\n && wget -P $BISERVER_HOME/tomcat/webapps/pentaho/WEB-INF/lib https://github.com/zhicwu/saiku/releases/download/3.8.8-SNAPSHOT/saiku-olap-util-3.8.8.jar \\\n && wget -O btable.zip https://sourceforge.net/projects/btable/files/Version3.0-3.6/BTable-pentaho7-3.6-STABLE.zip/download \\\n && wget -O saiku-chart-plus.zip http://sourceforge.net/projects/saikuchartplus/files/SaikuChartPlus3/saiku-chart-plus-vSaiku3-plugin-pentaho.zip/download \\\n && wget -O jamon.zip https://sourceforge.net/projects/jamonapi/files/jamonapi/v2_81/jamonall-2.81.zip/download \\\n && wget --progress=dot:giga https://github.com/zhicwu/saiku/releases/download/3.8.8-SNAPSHOT/saiku-plugin-p6-3.8.8.zip https://github.com/zhicwu/cte/releases/download/7.0-SNAPSHOT/cte-7.0-snapshot.zip http://ctools.pentaho.com/files/d3ComponentLibrary/14.06.18/d3ComponentLibrary-14.06.18.zip https://github.com/rpbouman/pash/raw/master/bin/pash.zip \\\n && echo \"Installing plugins...\" \\\n && for i in *.zip; do echo \"Unpacking $i...\" \\\n && unzip -q -d pentaho-solutions/system $i \\\n && rm -f $i ; done \\\n && rm -f pentaho-solutions/system/BTable/resources/datasources/*.cda \\\n && echo \"Update configuration...\" \\\n && sed -i -e 's|\\(<entry key=\"jpeg\" value-ref=\"streamConverter\"/>\\)|\\1<entry key=\"saiku\" value-ref=\"streamConverter\"/>|' pentaho-solutions/system/importExport.xml \\\n && sed -i -e 's|\\(<value>.xcdf</value>\\)|\\1<value>.saiku</value>|' pentaho-solutions/system/importExport.xml \\\n && sed -i -e 's|\\(<value>xcdf</value>\\)|\\1<value>saiku</value>|' pentaho-solutions/system/importExport.xml \\\n && sed -i -e 's|\\(<extension>xcdf</extension>\\)|\\1<extension>saiku</extension>|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && touch pentaho-solutions/system/saiku/ui/js/saiku/plugins/CCC_Chart/cdo.js \\\n && wget -P pentaho-solutions/system/saiku/components/saikuWidget https://github.com/OSBI/saiku/raw/release-3.8/saiku-bi-platform-plugin-p5/src/main/plugin/components/saikuWidget/SaikuWidgetComponent.js \\\n && sed -i -e \"s|\\(: data.query.queryModel.axes.FILTER\\)\\(.*\\)|\\1 == undefined ? [] \\1\\2|\" pentaho-solutions/system/saiku/ui/js/saiku/embed/SaikuEmbed.js \\\n && sed -i -e \"s|\\(: data.query.queryModel.axes.COLUMNS\\)\\(.*\\)|\\1 == undefined ? [] \\1\\2|\" pentaho-solutions/system/saiku/ui/js/saiku/embed/SaikuEmbed.js \\\n && sed -i -e \"s|\\(: data.query.queryModel.axes.ROWS\\)\\(.*\\)|\\1 == undefined ? [] \\1\\2|\" pentaho-solutions/system/saiku/ui/js/saiku/embed/SaikuEmbed.js \\\n && sed -i -e 's|\\(var query = Saiku.tabs._tabs\\[0\\].content.query;\\)|\\1\\nif (query == undefined ) query = Saiku.tabs._tabs[1].content.query;|' pentaho-solutions/system/saiku/ui/js/saiku/plugins/BIServer/plugin.js \\\n && sed -i -e 's|self.template()|\"Error!\"|' pentaho-solutions/system/saiku/ui/saiku.min.js \\\n && sed -i -e 's|http://meteorite.bi/|/|' pentaho-solutions/system/saiku/ui/saiku.min.js \\\n && sed -i -e \"s|\\(request.setRequestHeader('Authorization', auth);\\)|// \\1|\" pentaho-solutions/system/saiku/ui/js/saiku/embed/SaikuEmbed.js \\\n && echo \"Enable JAMon API...\" \\\n && mv pentaho-solutions/system/jamonall-2.81/jamon-2.81.jar tomcat/lib/. \\\n && unzip -q -d tomcat/webapps/jamon pentaho-solutions/system/jamonall-2.81/jamon.war \\\n && rm -rf pentaho-solutions/system/__MACOSX tomcat/webapps/jamon/WEB-INF/lib/hsqldb.jar *.zip \\\n && rm -rf pentaho-solutions/system/jamonall* \\\n && sed -i -e 's|\\(<Engine name=\"Catalina\" defaultHost=\"localhost\">\\)|\\1\\n <Valve className=\"com.jamonapi.http.JAMonTomcatValve\"/>|' tomcat/conf/server.xml\n#   Download patches and dependencies\nRUN echo \"Download patches and dependencies...\" \\\n && wget https://maven.java.net/content/repositories/releases/net/java/dev/jna/jna/$JNA_VERSION/jna-$JNA_VERSION.jar https://maven.java.net/content/repositories/releases/net/java/dev/jna/jna-platform/$JNA_VERSION/jna-platform-$JNA_VERSION.jar http://central.maven.org/maven2/com/github/dblock/oshi-core/$OSHI_VERSION/oshi-core-$OSHI_VERSION.jar \\\n && mv *.jar tomcat/webapps/pentaho/WEB-INF/lib/. \\\n && wget --progress=dot:giga https://github.com/zhicwu/pdi-cluster/releases/download/${PDI_PATCH}/pentaho-kettle-${PDI_PATCH}.jar https://github.com/zhicwu/pdi-cluster/releases/download/${PDI_PATCH}/pentaho-platform-${PDI_PATCH}.jar\n#   Add entry point, tempaltes and cron jobs\nCOPY docker-entrypoint.sh $BISERVER_HOME/docker-entrypoint.sh\nCOPY repository.xml.template $BISERVER_HOME/pentaho-solutions/system/jackrabbit/repository.xml.template\nCOPY purge-old-files.sh /etc/cron.hourly/purge-old-files\n#   Post configuration\nRUN echo \"Post configuration...\" \\\n && chmod 0700 /etc/cron.hourly/* \\\n && chmod +x $BISERVER_HOME/*.sh\nENTRYPOINT [\"/sbin/my_init\", \"--\", \"./docker-entrypoint.sh\"]\n#  VOLUME [\"$BISERVER_HOME/.pentaho\", \"$BISERVER_HOME/data/hsqldb\", \"$BISERVER_HOME/tomcat/logs\", \"$BISERVER_HOME/pentaho-solutions/system/jackrabbit/repository\", \"$BISERVER_HOME/tmp\"]\n#    8080 - HTTP\n#    8009 - AJP\n#   11098 - JMX RMI Registry\n#   44444 - RMI Server\n#  EXPOSE 8080 8009 11098 44444\n#  CMD [\"biserver\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#\n#  Docker image for Pentaho BA server community edition.\n#\n#  Pull base image\nFROM zhicwu/java:8\n#  Set maintainer\nMAINTAINER Zhichun Wu <zhicwu@gmail.com>\n#  Set environment variables\nENV BISERVER_VERSION=\"7.0\" \\\n    BISERVER_BUILD=\"7.0.0.0-25\" \\\n    PDI_PATCH=\"7.0.0.0.3\" \\\n    BISERVER_HOME=\"/biserver-ce\" \\\n    BISERVER_USER=\"pentaho\" \\\n    KETTLE_HOME=\"/biserver-ce/pentaho-solutions/system/kettle\" \\\n    JNA_VERSION=\"4.2.2\" \\\n    OSHI_VERSION=\"3.2\" \\\n    POSTGRESQL_DRIVER_VERSION=\"9.4.1212\" \\\n    MYSQL_DRIVER_VERSION=\"5.1.41\" \\\n    JTDS_VERSION=\"1.3.1\" \\\n    CASSANDRA_DRIVER_VERSION=\"0.6.3\" \\\n    H2DB_VERSION=\"1.4.193\" \\\n    HSQLDB_VERSION=\"2.3.4\" \\\n    XMLA_PROVIDER_VERSION=\"1.0.0.103\"\n#  Set label\nLABEL java_server=\"Pentaho BA Server $BISERVER_VERSION Community Edition\"\n#  Install vanilla Pentaho server along with minor changes to configuration\nRUN echo \"Download and unpack Pentaho server...\" \\\n && wget --progress=dot:giga http://downloads.sourceforge.net/project/pentaho/Business%20Intelligence%20Server/${BISERVER_VERSION}/pentaho-server-ce-${BISERVER_BUILD}.zip \\\n && unzip -q *.zip \\\n && rm -f *.zip \\\n && mv /pentaho-server $BISERVER_HOME \\\n && ln -s $BISERVER_HOME /pentaho-server \\\n && find $BISERVER_HOME -name \"*.bat\" -delete \\\n && find $BISERVER_HOME -name \"*.exe\" -delete \\\n && mkdir -p $BISERVER_HOME/data/.hsqldb \\\n && /bin/cp -rf $BISERVER_HOME/data/hsqldb/* $BISERVER_HOME/data/.hsqldb/. \\\n && echo \"Install APR for Tomcat...\" \\\n && tar zxf $BISERVER_HOME/tomcat/bin/tomcat-native.tar.gz \\\n && cd tomcat-native*/native \\\n && apt-get update \\\n && apt-get install libjna-java libapr1-dev gcc make -y \\\n && ./configure --with-apr=/usr/bin/apr-config --disable-openssl --with-java-home=$JAVA_HOME --prefix=$BISERVER_HOME/tomcat \\\n && make \\\n && make install \\\n && sed -i -e 's|\\(SSLEngine=\"\\).*\\(\"\\)|\\1off\\2|' $BISERVER_HOME/tomcat/conf/server.xml \\\n && cd / \\\n && rm -rf tomcat-native* $BISERVER_HOME/tomcat/bin/tomcat-native.tar.gz \\\n && apt-get autoremove -y libapr1-dev gcc make \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* \\\n && echo \"Update server configuration...\" \\\n && cd $BISERVER_HOME \\\n && sed -i -e 's/\\(exec \".*\"\\) start/\\1 run/' tomcat/bin/startup.sh \\\n && rm -f promptuser.* pentaho-solutions/system/default-content/* \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\">\\n <extension>xlsx</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.template\">\\n <extension>xltx</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.ms-excel.sheet.macroEnabled.12\">\\n <extension>xlsm</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.ms-excel.template.macroEnabled.12\">\\n <extension>xltm</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.ms-excel.addin.macroEnabled.12\">\\n <extension>xlam</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.ms-excel.sheet.binary.macroEnabled.12\">\\n <extension>xlsb</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <extension>xls</extension>\\)|\\1\\n <extension>xlt</extension>\\n <extension>xla</extension>|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <extension>sql</extension>\\)|\\1\\n <extension>txt</extension>\\n <extension>csv</extension>|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\(,csv,\\)|\\1sql,|' pentaho-solutions/system/*.xml \\\n && sed -i -e 's|\\(,xlsx,\\)|\\1xltx,xlsm,xltm,xlam,xlsb,|' pentaho-solutions/system/*.xml \\\n && echo \"Add Pentaho user...\" \\\n && useradd -md $BISERVER_HOME -s /bin/bash $BISERVER_USER\n#  Change work directory\nWORKDIR $BISERVER_HOME\n#  Add latest JDBC drivers and XMLA connector\nRUN echo \"Download and install JDBC drivers...\" \\\n && wget --progress=dot:giga https://jdbc.postgresql.org/download/postgresql-${POSTGRESQL_DRIVER_VERSION}.jar http://central.maven.org/maven2/mysql/mysql-connector-java/${MYSQL_DRIVER_VERSION}/mysql-connector-java-${MYSQL_DRIVER_VERSION}.jar http://central.maven.org/maven2/net/sourceforge/jtds/jtds/${JTDS_VERSION}/jtds-${JTDS_VERSION}.jar http://central.maven.org/maven2/com/github/zhicwu/cassandra-jdbc-driver/${CASSANDRA_DRIVER_VERSION}/cassandra-jdbc-driver-${CASSANDRA_DRIVER_VERSION}-shaded.jar http://central.maven.org/maven2/com/h2database/h2/${H2DB_VERSION}/h2-${H2DB_VERSION}.jar http://central.maven.org/maven2/org/hsqldb/hsqldb/${HSQLDB_VERSION}/hsqldb-${HSQLDB_VERSION}.jar \\\n && wget --progress=dot:giga -O tomcat/webapps/pentaho/docs/xmla-connector.exe https://sourceforge.net/projects/xmlaconnect/files/XMLA_Provider_v${XMLA_PROVIDER_VERSION}.exe/download \\\n && sed -i -e 's|\\( class=\"bannercontent\">.*\\)\\(<br /></td>\\)|\\1<br />To access OLAP cube via Excel/SharePoint, please install <a href=\"xmla-connector.exe\">XMLA Connector</a> from <a href=\"http://www.arquery.com\">Arquery</a>.\\2|' tomcat/webapps/pentaho/docs/InformationMap.jsp \\\n && rm -f tomcat/lib/postgre*.jar tomcat/lib/mysql*.jar tomcat/lib/jtds*.jar tomcat/lib/h2*.jar tomcat/lib/hsqldb*.jar \\\n && mv *.jar $BISERVER_HOME/tomcat/lib/.\n#  Install plugins\nRUN echo \"Download plugins...\" \\\n && wget -P $BISERVER_HOME/tomcat/webapps/pentaho/WEB-INF/lib https://github.com/zhicwu/saiku/releases/download/3.8.8-SNAPSHOT/saiku-olap-util-3.8.8.jar \\\n && wget -O btable.zip https://sourceforge.net/projects/btable/files/Version3.0-3.6/BTable-pentaho7-3.6-STABLE.zip/download \\\n && wget -O saiku-chart-plus.zip http://sourceforge.net/projects/saikuchartplus/files/SaikuChartPlus3/saiku-chart-plus-vSaiku3-plugin-pentaho.zip/download \\\n && wget -O jamon.zip https://sourceforge.net/projects/jamonapi/files/jamonapi/v2_81/jamonall-2.81.zip/download \\\n && wget --progress=dot:giga https://github.com/zhicwu/saiku/releases/download/3.8.8-SNAPSHOT/saiku-plugin-p6-3.8.8.zip https://github.com/zhicwu/cte/releases/download/7.0-SNAPSHOT/cte-7.0-snapshot.zip http://ctools.pentaho.com/files/d3ComponentLibrary/14.06.18/d3ComponentLibrary-14.06.18.zip https://github.com/rpbouman/pash/raw/master/bin/pash.zip \\\n && echo \"Installing plugins...\" \\\n && for i in *.zip; do echo \"Unpacking $i...\" \\\n && unzip -q -d pentaho-solutions/system $i \\\n && rm -f $i ; done \\\n && rm -f pentaho-solutions/system/BTable/resources/datasources/*.cda \\\n && echo \"Update configuration...\" \\\n && sed -i -e 's|\\(<entry key=\"jpeg\" value-ref=\"streamConverter\"/>\\)|\\1<entry key=\"saiku\" value-ref=\"streamConverter\"/>|' pentaho-solutions/system/importExport.xml \\\n && sed -i -e 's|\\(<value>.xcdf</value>\\)|\\1<value>.saiku</value>|' pentaho-solutions/system/importExport.xml \\\n && sed -i -e 's|\\(<value>xcdf</value>\\)|\\1<value>saiku</value>|' pentaho-solutions/system/importExport.xml \\\n && sed -i -e 's|\\(<extension>xcdf</extension>\\)|\\1<extension>saiku</extension>|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && touch pentaho-solutions/system/saiku/ui/js/saiku/plugins/CCC_Chart/cdo.js \\\n && wget -P pentaho-solutions/system/saiku/components/saikuWidget https://github.com/OSBI/saiku/raw/release-3.8/saiku-bi-platform-plugin-p5/src/main/plugin/components/saikuWidget/SaikuWidgetComponent.js \\\n && sed -i -e \"s|\\(: data.query.queryModel.axes.FILTER\\)\\(.*\\)|\\1 == undefined ? [] \\1\\2|\" pentaho-solutions/system/saiku/ui/js/saiku/embed/SaikuEmbed.js \\\n && sed -i -e \"s|\\(: data.query.queryModel.axes.COLUMNS\\)\\(.*\\)|\\1 == undefined ? [] \\1\\2|\" pentaho-solutions/system/saiku/ui/js/saiku/embed/SaikuEmbed.js \\\n && sed -i -e \"s|\\(: data.query.queryModel.axes.ROWS\\)\\(.*\\)|\\1 == undefined ? [] \\1\\2|\" pentaho-solutions/system/saiku/ui/js/saiku/embed/SaikuEmbed.js \\\n && sed -i -e 's|\\(var query = Saiku.tabs._tabs\\[0\\].content.query;\\)|\\1\\nif (query == undefined ) query = Saiku.tabs._tabs[1].content.query;|' pentaho-solutions/system/saiku/ui/js/saiku/plugins/BIServer/plugin.js \\\n && sed -i -e 's|self.template()|\"Error!\"|' pentaho-solutions/system/saiku/ui/saiku.min.js \\\n && sed -i -e 's|http://meteorite.bi/|/|' pentaho-solutions/system/saiku/ui/saiku.min.js \\\n && sed -i -e \"s|\\(request.setRequestHeader('Authorization', auth);\\)|// \\1|\" pentaho-solutions/system/saiku/ui/js/saiku/embed/SaikuEmbed.js \\\n && echo \"Enable JAMon API...\" \\\n && mv pentaho-solutions/system/jamonall-2.81/jamon-2.81.jar tomcat/lib/. \\\n && unzip -q -d tomcat/webapps/jamon pentaho-solutions/system/jamonall-2.81/jamon.war \\\n && rm -rf pentaho-solutions/system/__MACOSX tomcat/webapps/jamon/WEB-INF/lib/hsqldb.jar *.zip \\\n && rm -rf pentaho-solutions/system/jamonall* \\\n && sed -i -e 's|\\(<Engine name=\"Catalina\" defaultHost=\"localhost\">\\)|\\1\\n <Valve className=\"com.jamonapi.http.JAMonTomcatValve\"/>|' tomcat/conf/server.xml\n#  Download patches and dependencies\nRUN echo \"Download patches and dependencies...\" \\\n && wget https://maven.java.net/content/repositories/releases/net/java/dev/jna/jna/$JNA_VERSION/jna-$JNA_VERSION.jar https://maven.java.net/content/repositories/releases/net/java/dev/jna/jna-platform/$JNA_VERSION/jna-platform-$JNA_VERSION.jar http://central.maven.org/maven2/com/github/dblock/oshi-core/$OSHI_VERSION/oshi-core-$OSHI_VERSION.jar \\\n && mv *.jar tomcat/webapps/pentaho/WEB-INF/lib/. \\\n && wget --progress=dot:giga https://github.com/zhicwu/pdi-cluster/releases/download/${PDI_PATCH}/pentaho-kettle-${PDI_PATCH}.jar https://github.com/zhicwu/pdi-cluster/releases/download/${PDI_PATCH}/pentaho-platform-${PDI_PATCH}.jar\n#  Add entry point, tempaltes and cron jobs\nCOPY docker-entrypoint.sh $BISERVER_HOME/docker-entrypoint.sh\nCOPY repository.xml.template $BISERVER_HOME/pentaho-solutions/system/jackrabbit/repository.xml.template\nCOPY purge-old-files.sh /etc/cron.hourly/purge-old-files\n#  Post configuration\nRUN echo \"Post configuration...\" \\\n && chmod 0700 /etc/cron.hourly/* \\\n && chmod +x $BISERVER_HOME/*.sh\nENTRYPOINT [\"/sbin/my_init\", \"--\", \"./docker-entrypoint.sh\"]\n# VOLUME [\"$BISERVER_HOME/.pentaho\", \"$BISERVER_HOME/data/hsqldb\", \"$BISERVER_HOME/tomcat/logs\", \"$BISERVER_HOME/pentaho-solutions/system/jackrabbit/repository\", \"$BISERVER_HOME/tmp\"]\n#   8080 - HTTP\n#   8009 - AJP\n#  11098 - JMX RMI Registry\n#  44444 - RMI Server\n# EXPOSE 8080 8009 11098 44444\n# CMD [\"biserver\"]\n","injectedSmells":[],"originalDockerfileHash":"7b4672b2420081ca33459663c67bebe6","successfullyInjectedSmells":[],"originalDockerfileUglified":"#\n#   Docker image for Pentaho BA server community edition.\n#\n#   Pull base image\nFROM zhicwu/java:8\n#   Set maintainer\nMAINTAINER Zhichun Wu <zhicwu@gmail.com>\n#   Set environment variables\nENV BISERVER_VERSION=\"7.0\" \\\n    BISERVER_BUILD=\"7.0.0.0-25\" \\\n    PDI_PATCH=\"7.0.0.0.3\" \\\n    BISERVER_HOME=\"/biserver-ce\" \\\n    BISERVER_USER=\"pentaho\" \\\n    KETTLE_HOME=\"/biserver-ce/pentaho-solutions/system/kettle\" \\\n    JNA_VERSION=\"4.2.2\" \\\n    OSHI_VERSION=\"3.2\" \\\n    POSTGRESQL_DRIVER_VERSION=\"9.4.1212\" \\\n    MYSQL_DRIVER_VERSION=\"5.1.41\" \\\n    JTDS_VERSION=\"1.3.1\" \\\n    CASSANDRA_DRIVER_VERSION=\"0.6.3\" \\\n    H2DB_VERSION=\"1.4.193\" \\\n    HSQLDB_VERSION=\"2.3.4\" \\\n    XMLA_PROVIDER_VERSION=\"1.0.0.103\"\n#   Set label\nLABEL java_server=\"Pentaho BA Server $BISERVER_VERSION Community Edition\"\n#   Install vanilla Pentaho server along with minor changes to configuration\nRUN echo \"Download and unpack Pentaho server...\" \\\n && wget --progress=dot:giga http://downloads.sourceforge.net/project/pentaho/Business%20Intelligence%20Server/${BISERVER_VERSION}/pentaho-server-ce-${BISERVER_BUILD}.zip \\\n && unzip -q *.zip \\\n && rm -f *.zip \\\n && mv /pentaho-server $BISERVER_HOME \\\n && ln -s $BISERVER_HOME /pentaho-server \\\n && find $BISERVER_HOME -name \"*.bat\" -delete \\\n && find $BISERVER_HOME -name \"*.exe\" -delete \\\n && mkdir -p $BISERVER_HOME/data/.hsqldb \\\n && /bin/cp -rf $BISERVER_HOME/data/hsqldb/* $BISERVER_HOME/data/.hsqldb/. \\\n && echo \"Install APR for Tomcat...\" \\\n && tar zxf $BISERVER_HOME/tomcat/bin/tomcat-native.tar.gz \\\n && cd tomcat-native*/native \\\n && apt-get update \\\n && apt-get install libjna-java libapr1-dev gcc make -y \\\n && ./configure --with-apr=/usr/bin/apr-config --disable-openssl --with-java-home=$JAVA_HOME --prefix=$BISERVER_HOME/tomcat \\\n && make \\\n && make install \\\n && sed -i -e 's|\\(SSLEngine=\"\\).*\\(\"\\)|\\1off\\2|' $BISERVER_HOME/tomcat/conf/server.xml \\\n && cd / \\\n && rm -rf tomcat-native* $BISERVER_HOME/tomcat/bin/tomcat-native.tar.gz \\\n && apt-get autoremove -y libapr1-dev gcc make \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* \\\n && echo \"Update server configuration...\" \\\n && cd $BISERVER_HOME \\\n && sed -i -e 's/\\(exec \".*\"\\) start/\\1 run/' tomcat/bin/startup.sh \\\n && rm -f promptuser.* pentaho-solutions/system/default-content/* \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\">\\n <extension>xlsx</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.template\">\\n <extension>xltx</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.ms-excel.sheet.macroEnabled.12\">\\n <extension>xlsm</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.ms-excel.template.macroEnabled.12\">\\n <extension>xltm</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.ms-excel.addin.macroEnabled.12\">\\n <extension>xlam</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <MimeTypeDefinition mimeType=\"application/vnd.ms-excel\">\\)| <MimeTypeDefinition mimeType=\"application/vnd.ms-excel.sheet.binary.macroEnabled.12\">\\n <extension>xlsb</extension>\\n </MimeTypeDefinition>\\n\\1|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <extension>xls</extension>\\)|\\1\\n <extension>xlt</extension>\\n <extension>xla</extension>|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\( <extension>sql</extension>\\)|\\1\\n <extension>txt</extension>\\n <extension>csv</extension>|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && sed -i -e 's|\\(,csv,\\)|\\1sql,|' pentaho-solutions/system/*.xml \\\n && sed -i -e 's|\\(,xlsx,\\)|\\1xltx,xlsm,xltm,xlam,xlsb,|' pentaho-solutions/system/*.xml \\\n && echo \"Add Pentaho user...\" \\\n && useradd -md $BISERVER_HOME -s /bin/bash $BISERVER_USER\n#   Change work directory\nWORKDIR $BISERVER_HOME\n#   Add latest JDBC drivers and XMLA connector\nRUN echo \"Download and install JDBC drivers...\" \\\n && wget --progress=dot:giga https://jdbc.postgresql.org/download/postgresql-${POSTGRESQL_DRIVER_VERSION}.jar http://central.maven.org/maven2/mysql/mysql-connector-java/${MYSQL_DRIVER_VERSION}/mysql-connector-java-${MYSQL_DRIVER_VERSION}.jar http://central.maven.org/maven2/net/sourceforge/jtds/jtds/${JTDS_VERSION}/jtds-${JTDS_VERSION}.jar http://central.maven.org/maven2/com/github/zhicwu/cassandra-jdbc-driver/${CASSANDRA_DRIVER_VERSION}/cassandra-jdbc-driver-${CASSANDRA_DRIVER_VERSION}-shaded.jar http://central.maven.org/maven2/com/h2database/h2/${H2DB_VERSION}/h2-${H2DB_VERSION}.jar http://central.maven.org/maven2/org/hsqldb/hsqldb/${HSQLDB_VERSION}/hsqldb-${HSQLDB_VERSION}.jar \\\n && wget --progress=dot:giga -O tomcat/webapps/pentaho/docs/xmla-connector.exe https://sourceforge.net/projects/xmlaconnect/files/XMLA_Provider_v${XMLA_PROVIDER_VERSION}.exe/download \\\n && sed -i -e 's|\\( class=\"bannercontent\">.*\\)\\(<br /></td>\\)|\\1<br />To access OLAP cube via Excel/SharePoint, please install <a href=\"xmla-connector.exe\">XMLA Connector</a> from <a href=\"http://www.arquery.com\">Arquery</a>.\\2|' tomcat/webapps/pentaho/docs/InformationMap.jsp \\\n && rm -f tomcat/lib/postgre*.jar tomcat/lib/mysql*.jar tomcat/lib/jtds*.jar tomcat/lib/h2*.jar tomcat/lib/hsqldb*.jar \\\n && mv *.jar $BISERVER_HOME/tomcat/lib/.\n#   Install plugins\nRUN echo \"Download plugins...\" \\\n && wget -P $BISERVER_HOME/tomcat/webapps/pentaho/WEB-INF/lib https://github.com/zhicwu/saiku/releases/download/3.8.8-SNAPSHOT/saiku-olap-util-3.8.8.jar \\\n && wget -O btable.zip https://sourceforge.net/projects/btable/files/Version3.0-3.6/BTable-pentaho7-3.6-STABLE.zip/download \\\n && wget -O saiku-chart-plus.zip http://sourceforge.net/projects/saikuchartplus/files/SaikuChartPlus3/saiku-chart-plus-vSaiku3-plugin-pentaho.zip/download \\\n && wget -O jamon.zip https://sourceforge.net/projects/jamonapi/files/jamonapi/v2_81/jamonall-2.81.zip/download \\\n && wget --progress=dot:giga https://github.com/zhicwu/saiku/releases/download/3.8.8-SNAPSHOT/saiku-plugin-p6-3.8.8.zip https://github.com/zhicwu/cte/releases/download/7.0-SNAPSHOT/cte-7.0-snapshot.zip http://ctools.pentaho.com/files/d3ComponentLibrary/14.06.18/d3ComponentLibrary-14.06.18.zip https://github.com/rpbouman/pash/raw/master/bin/pash.zip \\\n && echo \"Installing plugins...\" \\\n && for i in *.zip; do echo \"Unpacking $i...\" \\\n && unzip -q -d pentaho-solutions/system $i \\\n && rm -f $i ; done \\\n && rm -f pentaho-solutions/system/BTable/resources/datasources/*.cda \\\n && echo \"Update configuration...\" \\\n && sed -i -e 's|\\(<entry key=\"jpeg\" value-ref=\"streamConverter\"/>\\)|\\1<entry key=\"saiku\" value-ref=\"streamConverter\"/>|' pentaho-solutions/system/importExport.xml \\\n && sed -i -e 's|\\(<value>.xcdf</value>\\)|\\1<value>.saiku</value>|' pentaho-solutions/system/importExport.xml \\\n && sed -i -e 's|\\(<value>xcdf</value>\\)|\\1<value>saiku</value>|' pentaho-solutions/system/importExport.xml \\\n && sed -i -e 's|\\(<extension>xcdf</extension>\\)|\\1<extension>saiku</extension>|' pentaho-solutions/system/ImportHandlerMimeTypeDefinitions.xml \\\n && touch pentaho-solutions/system/saiku/ui/js/saiku/plugins/CCC_Chart/cdo.js \\\n && wget -P pentaho-solutions/system/saiku/components/saikuWidget https://github.com/OSBI/saiku/raw/release-3.8/saiku-bi-platform-plugin-p5/src/main/plugin/components/saikuWidget/SaikuWidgetComponent.js \\\n && sed -i -e \"s|\\(: data.query.queryModel.axes.FILTER\\)\\(.*\\)|\\1 == undefined ? [] \\1\\2|\" pentaho-solutions/system/saiku/ui/js/saiku/embed/SaikuEmbed.js \\\n && sed -i -e \"s|\\(: data.query.queryModel.axes.COLUMNS\\)\\(.*\\)|\\1 == undefined ? [] \\1\\2|\" pentaho-solutions/system/saiku/ui/js/saiku/embed/SaikuEmbed.js \\\n && sed -i -e \"s|\\(: data.query.queryModel.axes.ROWS\\)\\(.*\\)|\\1 == undefined ? [] \\1\\2|\" pentaho-solutions/system/saiku/ui/js/saiku/embed/SaikuEmbed.js \\\n && sed -i -e 's|\\(var query = Saiku.tabs._tabs\\[0\\].content.query;\\)|\\1\\nif (query == undefined ) query = Saiku.tabs._tabs[1].content.query;|' pentaho-solutions/system/saiku/ui/js/saiku/plugins/BIServer/plugin.js \\\n && sed -i -e 's|self.template()|\"Error!\"|' pentaho-solutions/system/saiku/ui/saiku.min.js \\\n && sed -i -e 's|http://meteorite.bi/|/|' pentaho-solutions/system/saiku/ui/saiku.min.js \\\n && sed -i -e \"s|\\(request.setRequestHeader('Authorization', auth);\\)|// \\1|\" pentaho-solutions/system/saiku/ui/js/saiku/embed/SaikuEmbed.js \\\n && echo \"Enable JAMon API...\" \\\n && mv pentaho-solutions/system/jamonall-2.81/jamon-2.81.jar tomcat/lib/. \\\n && unzip -q -d tomcat/webapps/jamon pentaho-solutions/system/jamonall-2.81/jamon.war \\\n && rm -rf pentaho-solutions/system/__MACOSX tomcat/webapps/jamon/WEB-INF/lib/hsqldb.jar *.zip \\\n && rm -rf pentaho-solutions/system/jamonall* \\\n && sed -i -e 's|\\(<Engine name=\"Catalina\" defaultHost=\"localhost\">\\)|\\1\\n <Valve className=\"com.jamonapi.http.JAMonTomcatValve\"/>|' tomcat/conf/server.xml\n#   Download patches and dependencies\nRUN echo \"Download patches and dependencies...\" \\\n && wget https://maven.java.net/content/repositories/releases/net/java/dev/jna/jna/$JNA_VERSION/jna-$JNA_VERSION.jar https://maven.java.net/content/repositories/releases/net/java/dev/jna/jna-platform/$JNA_VERSION/jna-platform-$JNA_VERSION.jar http://central.maven.org/maven2/com/github/dblock/oshi-core/$OSHI_VERSION/oshi-core-$OSHI_VERSION.jar \\\n && mv *.jar tomcat/webapps/pentaho/WEB-INF/lib/. \\\n && wget --progress=dot:giga https://github.com/zhicwu/pdi-cluster/releases/download/${PDI_PATCH}/pentaho-kettle-${PDI_PATCH}.jar https://github.com/zhicwu/pdi-cluster/releases/download/${PDI_PATCH}/pentaho-platform-${PDI_PATCH}.jar\n#   Add entry point, tempaltes and cron jobs\nCOPY docker-entrypoint.sh $BISERVER_HOME/docker-entrypoint.sh\nCOPY repository.xml.template $BISERVER_HOME/pentaho-solutions/system/jackrabbit/repository.xml.template\nCOPY purge-old-files.sh /etc/cron.hourly/purge-old-files\n#   Post configuration\nRUN echo \"Post configuration...\" \\\n && chmod 0700 /etc/cron.hourly/* \\\n && chmod +x $BISERVER_HOME/*.sh\nENTRYPOINT [\"/sbin/my_init\", \"--\", \"./docker-entrypoint.sh\"]\n#  VOLUME [\"$BISERVER_HOME/.pentaho\", \"$BISERVER_HOME/data/hsqldb\", \"$BISERVER_HOME/tomcat/logs\", \"$BISERVER_HOME/pentaho-solutions/system/jackrabbit/repository\", \"$BISERVER_HOME/tmp\"]\n#    8080 - HTTP\n#    8009 - AJP\n#   11098 - JMX RMI Registry\n#   44444 - RMI Server\n#  EXPOSE 8080 8009 11098 44444\n#  CMD [\"biserver\"]\n","originalDockerfileUglifiedHash":"5600a0b1c4d5699d4c83ffacc563dc9e","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/6bb6db88034f8526a7d6e8f62287c24193015315.dockerfile"}