{"seed":4121850419,"processedDockerfileHash":"422416c45a1bbf5886ff2dbe78e88e3c","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM alpine:3.8\n#   Install required alpine linux packages.\nRUN apk update\nRUN apk add git=2.18.4-r0 perl=5.26.3-r0 perl-dev=5.26.3-r0 musl-dev=1.1.19-r11 python apache2=2.4.43-r0 gcc=6.4.0-r9 make=4.2.1-r2 perl-app-cpanminus=1.7044-r0 perl-namespace-autoclean=0.28-r0 gdbm=1.13-r1 apache2-dev=2.4.43-r0 curl=7.61.1-r3 apache2-utils=2.4.43-r0 apache2-ssl=2.4.43-r0 shadow=4.5-r0 vim=8.1.1365-r0\n#   Install modperl\nRUN cd /tmp \\\n && wget http://apache.org/dist/perl/mod_perl-2.0.10.tar.gz \\\n && tar -xzf mod_perl-2.0.10.tar.gz \\\n && cd mod_perl-2.0.10/ \\\n && perl Makefile.PL MP_APXS=/usr/bin/apxs \\\n && make \\\n && make install\n#   Load modperl in httpd conf\nRUN echo >> /etc/apache2/httpd.conf \\\n && echo \"LoadModule perl_module /usr/lib/apache2/mod_perl.so\" >> /etc/apache2/httpd.conf\n#   Build Crypt::Rijndael perl module manually because we need to apply a patch\n#   to rijndael.h.\nRUN cd /tmp \\\n && wget https://cpan.metacpan.org/authors/id/L/LE/LEONT/Crypt-Rijndael-1.13.tar.gz \\\n && tar -xzf Crypt-Rijndael-1.13.tar.gz \\\n && cd Crypt-Rijndael-1.13/ \\\n && perl Makefile.PL \\\n && sed -i s/__uint8_t/uint8_t/g rijndael.h \\\n && sed -i s/__uint32_t/uint32_t/g rijndael.h \\\n && make install\n#   Install the remaining required perl modules using cpanm.\nRUN cpanm --notest --no-man-pages --no-wget --curl Moose MooseX::Types MooseX::ConfigFromFile MooseX::Getopt MooseX::Role::Parameterized MooseX::SimpleConfig MooseX::StrictConstructor MooseX::Types::DateTime Time::HiRes Time::Piece Catalyst::Devel Catalyst::Plugin::RequireSSL Catalyst::Plugin::Session::Store::FastMmap JSON Catalyst::View::JSON Template::Plugin::Filter::Minify::CSS Template::Plugin::Filter::Minify::JavaScript Catalyst::Plugin::Cache::FastMmap Catalyst::Plugin::UploadProgress HTML::GenerateUtil Class::Factory JSON::XS Digest Archive::Zip Data::Validate::URI Log::Handler Crypt::OpenPGP Params::Classify Variable::Magic DateTime Class::ISA Catalyst::Authentication::User::Hash Catalyst::Plugin::Session::State::Cookie Catalyst::View::TT Archive::Tar Catalyst::Plugin::ConfigLoader::Environment\n#   Set up deployment dirs.\nRUN mkdir /var/ibexfarm \\\n && git clone https://github.com/addrummond/ibexfarm.git /var/ibexfarm/ibexfarm \\\n && chown -R apache:apache /var/ibexfarm/\n#   Checkout the revision of github.com/addrummond/ibex corresponding to 0.3.9\n#   and create a tarball.\nRUN cd /tmp \\\n && git clone https://github.com/addrummond/ibex \\\n && cd ibex \\\n && git checkout 9e903f9 \\\n && rm -rf .git* \\\n && rm -rf docs \\\n && rm -rf contrib \\\n && rm -f LICENSE README example_lighttpd.conf mkdist.sh server_conf.py \\\n && cd .. \\\n && tar -czf ibex-deploy.tar.gz ibex \\\n && mv ibex-deploy.tar.gz /var/ibexfarm\nRUN touch /etc/apache2/conf.d/httpdpasswd \\\n && chown apache:apache /etc/apache2/conf.d/httpdpasswd\n#   This is the dir apache2 wants to put its PID file in.\nRUN mkdir /run/apache2\n#   Main ibex farm config.\nRUN printf \"---\\nname: IbexFarm\\n\\nurl_prefix: '/'\\n\\nwebmaster_name: 'IBEX_WEBMASTER'\\nwebmaster_email: 'IBEX_WEBMASTER_EMAIL'\\n\\nibex_archive: '/var/ibexfarm/ibex-deploy.tar.gz'\\nibex_archive_root_dir: 'ibex'\\nibex_version: '0.3.9'\\ndeployment_dir: '/ibexdata/deploy'\\ndeployment_www_dir: '/ibexdata/ibexexps'\\n\\nmax_fname_length: 150\\n\\ndirs: [ 'js_includes', 'css_includes', 'data_includes', 'chunk_includes', 'server_state', 'results' ]\\nsync_dirs: [ 'js_includes', 'css_includes', 'data_includes', 'chunk_includes', 'server_state' ]\\ndirs_to_types:\\n js_includes: 'text/javascript'\\n css_includes: 'text/css'\\n data_includes: 'text/javascript'\\n chunk_includes: 'text/html'\\n server_state: 'text/plain'\\n results: 'text/plain'\\noptional_dirs:\\n server_state: 1\\n results: 1\\nwritable: [ 'data_includes/*', 'results/*', 'server_state/*','chunk_includes/*' ]\\n\\nenforce_quotas: 0\\nquota_max_files_in_dir: 500\\nquota_max_file_size: 1048576\\nquota_max_total_size: 1048576\\nquota_record_dir: '/tmp/quota'\\n\\npassword_protect_apache:\\n htpasswd: '/usr/bin/htpasswd'\\n passwd_file: '/etc/apache2/conf.d/httpdpasswd'\\n\\nmax_upload_size_bytes: 1048576\\n\\nexperiment_password_protection: Apache\\n\\ngit_path: '/usr/bin/git'\\ngit_checkout_timeout_seconds: 25\\n\\nevent_log_file: '/dev/stdout'\\n\\nexperiment_base_url: '/ibexexps/'\\n\\npython_hashbang: '/usr/bin/python'\\n\\nconfig_url: 'http://localhost/ajax/config'\\nconfig_permitted_hosts: ['localhost', '::1']\\n\" > /var/ibexfarm/ibexfarm/ibexfarm.yaml\n#  # Choose port Apache listens on based on env var\nRUN sed -i 's/^Listen[\\t ].*/Listen ${IBEXFARM_port}'/ /etc/apache2/httpd.conf\n#  # Append to Apache config\nRUN printf \"ServerName localhost\\n\\nPerlSwitches -I/var/ibexfarm/ibexfarm/lib\\nPerlModule IbexFarm\\n\\n<LocationMatch \\\"^/(?!(?:static/|ibexexps/))\\\">\\n SetHandler modperl\\n PerlResponseHandler IbexFarm\\n</LocationMatch>\\n\\nAlias /static/ /var/ibexfarm/ibexfarm/root/static/\\n<Directory /var/ibexfarm/ibexfarm/root/static/>\\n Options none\\n Require all granted\\n</Directory>\\n<Location /static>\\n SetHandler default-handler\\n</Location>\\n\\nDocumentRoot \\\"/var/www\\\"\\n\\nAddHandler cgi-script .py\\nAlias \"/ibexexps\" \"/ibexdata/ibexexps\"\\n\\n<Directory \\\"/ibexdata/ibexexps\\\" >\\n Options +ExecCGI +FollowSymLinks\\n AllowOverride AuthConfig\\n DirectoryIndex experiment.html\\n Require all granted\\n</Directory>\\n<Directory \\\"/var/www\\\">\\n AllowOverride None\\n Require all granted\\n</Directory>\\n\\nErrorLog /dev/stderr\\nTransferLog /dev/stdout\\n\\nLoadModule cgi_module modules/mod_cgi.so\\nSetEnv IBEXFARM_config_url \\\"${IBEXFARM_config_url}\\\"\\nPerlSetEnv IBEXFARM_host \\\"${IBEXFARM_host}\\\"\\nPerlSetEnv IBEXFARM_url_prefix \\\"${IBEXFARM_url_prefix}\\\"\\nPerlSetEnv IBEXFARM_webmaster_email \\\"${IBEXFARM_webmaster_email}\\\"\\nPerlSetEnv IBEXFARM_webmaster_name \\\"${IBEXFARM_webmaster_name}\\\"\\nPerlSetEnv IBEXFARM_config_secret \\\"${IBEXFARM_config_secret}\\\"\\nPerlSetEnv IBEXFARM_config_url_envvar \\\"${IBEXFARM_config_url_envvar}\\\"\\n\" >> /etc/apache2/httpd.conf\n#   Apache https config\nRUN printf \"LoadModule ssl_module modules/mod_ssl.so\\nLoadModule socache_shmcb_module modules/mod_socache_shmcb.so\\nSSLRandomSeed startup file:/dev/urandom 512\\nSSLRandomSeed connect builtin\\nSSLCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES:!ADH\\nSSLProxyCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES:!ADH\\nSSLHonorCipherOrder on\\nSSLProtocol all -SSLv3\\nSSLProxyProtocol all -SSLv3\\nSSLPassPhraseDialog builtin\\nSSLSessionCache \\\"shmcb:/var/cache/mod_ssl/scache(512000)\\\"\\nSSLSessionCacheTimeout 300\\n<VirtualHost *:443>\\nServerName \\\"${IBEXFARM_host}:443\\\"\\nServerAdmin \\\"${IBEXFARM_webmaster_email}\\\"\\nErrorLog /dev/stderr\\nTransferLog /dev/stdout\\nSSLEngine on\\nSSLCertificateFile /ibexdata/cert.pem\\nSSLCertificateKeyFile /ibexdata/privkey.pem\\nSSLCertificateChainFile /ibexdata/chain.pem\\nCustomLog /dev/stdout \\\"%%t %%h %%{SSL_PROTOCOL}x %%{SSL_CIPHER}x \\\"%%r\\\" %%b\\\"\\n</VirtualHost>\\n\" > /var/ibexfarm/ssl.conf\n#   Create wrapper we use to run httpd, including or not including ssl\n#   config depending on port.\nRUN rm -f /etc/apache2/conf.d/ssl.conf \\\n && echo '#!/bin/sh' > /var/ibexfarm/start.sh \\\n && printf \"rm -f /etc/apache2/conf.d/ssl.conf\\nif [ \\\"$IBEXFARM_port\\\" = \\\"443\\\" ]; then\\n ln -s /var/ibexfarm/ssl.conf /etc/apache2/conf.d/ssl.conf\\nfi\\nexec /usr/sbin/httpd -D FOREGROUND\\n\" >> /var/ibexfarm/start.sh \\\n && chmod +x /var/ibexfarm/start.sh\n#   Fix handling of base URL in Catalyst\nRUN echo 'sub auto : Private { my ($self, $c) = @_; $c->req->base(URI->new(IbexFarm->config->{url_prefix})); }; 1' >> /var/ibexfarm/ibexfarm/lib/IbexFarm/Controller/Root.pm\n#   Fix the id of the apache user and group so we know what they are\n#   when doing chowns in the host system.\nRUN groupmod -g 987654 apache \\\n && usermod -u 987654 apache\nEXPOSE 80/tcp 443/tcp\nENTRYPOINT [\"/var/ibexfarm/start.sh\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM alpine:3.8\n#  Install required alpine linux packages.\nRUN apk update\nRUN apk add git perl perl-dev musl-dev python apache2 gcc make perl-app-cpanminus perl-namespace-autoclean gdbm apache2-dev curl apache2-utils apache2-ssl shadow vim\n#  Install modperl\nRUN cd /tmp \\\n && wget http://apache.org/dist/perl/mod_perl-2.0.10.tar.gz \\\n && tar -xzf mod_perl-2.0.10.tar.gz \\\n && cd mod_perl-2.0.10/ \\\n && perl Makefile.PL MP_APXS=/usr/bin/apxs \\\n && make \\\n && make install\n#  Load modperl in httpd conf\nRUN echo >> /etc/apache2/httpd.conf \\\n && echo \"LoadModule perl_module /usr/lib/apache2/mod_perl.so\" >> /etc/apache2/httpd.conf\n#  Build Crypt::Rijndael perl module manually because we need to apply a patch\n#  to rijndael.h.\nRUN cd /tmp \\\n && wget https://cpan.metacpan.org/authors/id/L/LE/LEONT/Crypt-Rijndael-1.13.tar.gz \\\n && tar -xzf Crypt-Rijndael-1.13.tar.gz \\\n && cd Crypt-Rijndael-1.13/ \\\n && perl Makefile.PL \\\n && sed -i s/__uint8_t/uint8_t/g rijndael.h \\\n && sed -i s/__uint32_t/uint32_t/g rijndael.h \\\n && make install\n#  Install the remaining required perl modules using cpanm.\nRUN cpanm --notest --no-man-pages --no-wget --curl Moose MooseX::Types MooseX::ConfigFromFile MooseX::Getopt MooseX::Role::Parameterized MooseX::SimpleConfig MooseX::StrictConstructor MooseX::Types::DateTime Time::HiRes Time::Piece Catalyst::Devel Catalyst::Plugin::RequireSSL Catalyst::Plugin::Session::Store::FastMmap JSON Catalyst::View::JSON Template::Plugin::Filter::Minify::CSS Template::Plugin::Filter::Minify::JavaScript Catalyst::Plugin::Cache::FastMmap Catalyst::Plugin::UploadProgress HTML::GenerateUtil Class::Factory JSON::XS Digest Archive::Zip Data::Validate::URI Log::Handler Crypt::OpenPGP Params::Classify Variable::Magic DateTime Class::ISA Catalyst::Authentication::User::Hash Catalyst::Plugin::Session::State::Cookie Catalyst::View::TT Archive::Tar Catalyst::Plugin::ConfigLoader::Environment\n#  Set up deployment dirs.\nRUN mkdir /var/ibexfarm \\\n && git clone https://github.com/addrummond/ibexfarm.git /var/ibexfarm/ibexfarm \\\n && chown -R apache:apache /var/ibexfarm/\n#  Checkout the revision of github.com/addrummond/ibex corresponding to 0.3.9\n#  and create a tarball.\nRUN cd /tmp \\\n && git clone https://github.com/addrummond/ibex \\\n && cd ibex \\\n && git checkout 9e903f9 \\\n && rm -rf .git* \\\n && rm -rf docs \\\n && rm -rf contrib \\\n && rm -f LICENSE README example_lighttpd.conf mkdist.sh server_conf.py \\\n && cd .. \\\n && tar -czf ibex-deploy.tar.gz ibex \\\n && mv ibex-deploy.tar.gz /var/ibexfarm\nRUN touch /etc/apache2/conf.d/httpdpasswd \\\n && chown apache:apache /etc/apache2/conf.d/httpdpasswd\n#  This is the dir apache2 wants to put its PID file in.\nRUN mkdir /run/apache2\n#  Main ibex farm config.\nRUN printf \"---\\nname: IbexFarm\\n\\nurl_prefix: '/'\\n\\nwebmaster_name: 'IBEX_WEBMASTER'\\nwebmaster_email: 'IBEX_WEBMASTER_EMAIL'\\n\\nibex_archive: '/var/ibexfarm/ibex-deploy.tar.gz'\\nibex_archive_root_dir: 'ibex'\\nibex_version: '0.3.9'\\ndeployment_dir: '/ibexdata/deploy'\\ndeployment_www_dir: '/ibexdata/ibexexps'\\n\\nmax_fname_length: 150\\n\\ndirs: [ 'js_includes', 'css_includes', 'data_includes', 'chunk_includes', 'server_state', 'results' ]\\nsync_dirs: [ 'js_includes', 'css_includes', 'data_includes', 'chunk_includes', 'server_state' ]\\ndirs_to_types:\\n js_includes: 'text/javascript'\\n css_includes: 'text/css'\\n data_includes: 'text/javascript'\\n chunk_includes: 'text/html'\\n server_state: 'text/plain'\\n results: 'text/plain'\\noptional_dirs:\\n server_state: 1\\n results: 1\\nwritable: [ 'data_includes/*', 'results/*', 'server_state/*','chunk_includes/*' ]\\n\\nenforce_quotas: 0\\nquota_max_files_in_dir: 500\\nquota_max_file_size: 1048576\\nquota_max_total_size: 1048576\\nquota_record_dir: '/tmp/quota'\\n\\npassword_protect_apache:\\n htpasswd: '/usr/bin/htpasswd'\\n passwd_file: '/etc/apache2/conf.d/httpdpasswd'\\n\\nmax_upload_size_bytes: 1048576\\n\\nexperiment_password_protection: Apache\\n\\ngit_path: '/usr/bin/git'\\ngit_checkout_timeout_seconds: 25\\n\\nevent_log_file: '/dev/stdout'\\n\\nexperiment_base_url: '/ibexexps/'\\n\\npython_hashbang: '/usr/bin/python'\\n\\nconfig_url: 'http://localhost/ajax/config'\\nconfig_permitted_hosts: ['localhost', '::1']\\n\" > /var/ibexfarm/ibexfarm/ibexfarm.yaml\n# # Choose port Apache listens on based on env var\nRUN sed -i 's/^Listen[\\t ].*/Listen ${IBEXFARM_port}'/ /etc/apache2/httpd.conf\n# # Append to Apache config\nRUN printf \"ServerName localhost\\n\\nPerlSwitches -I/var/ibexfarm/ibexfarm/lib\\nPerlModule IbexFarm\\n\\n<LocationMatch \\\"^/(?!(?:static/|ibexexps/))\\\">\\n SetHandler modperl\\n PerlResponseHandler IbexFarm\\n</LocationMatch>\\n\\nAlias /static/ /var/ibexfarm/ibexfarm/root/static/\\n<Directory /var/ibexfarm/ibexfarm/root/static/>\\n Options none\\n Require all granted\\n</Directory>\\n<Location /static>\\n SetHandler default-handler\\n</Location>\\n\\nDocumentRoot \\\"/var/www\\\"\\n\\nAddHandler cgi-script .py\\nAlias \"/ibexexps\" \"/ibexdata/ibexexps\"\\n\\n<Directory \\\"/ibexdata/ibexexps\\\" >\\n Options +ExecCGI +FollowSymLinks\\n AllowOverride AuthConfig\\n DirectoryIndex experiment.html\\n Require all granted\\n</Directory>\\n<Directory \\\"/var/www\\\">\\n AllowOverride None\\n Require all granted\\n</Directory>\\n\\nErrorLog /dev/stderr\\nTransferLog /dev/stdout\\n\\nLoadModule cgi_module modules/mod_cgi.so\\nSetEnv IBEXFARM_config_url \\\"${IBEXFARM_config_url}\\\"\\nPerlSetEnv IBEXFARM_host \\\"${IBEXFARM_host}\\\"\\nPerlSetEnv IBEXFARM_url_prefix \\\"${IBEXFARM_url_prefix}\\\"\\nPerlSetEnv IBEXFARM_webmaster_email \\\"${IBEXFARM_webmaster_email}\\\"\\nPerlSetEnv IBEXFARM_webmaster_name \\\"${IBEXFARM_webmaster_name}\\\"\\nPerlSetEnv IBEXFARM_config_secret \\\"${IBEXFARM_config_secret}\\\"\\nPerlSetEnv IBEXFARM_config_url_envvar \\\"${IBEXFARM_config_url_envvar}\\\"\\n\" >> /etc/apache2/httpd.conf\n#  Apache https config\nRUN printf \"LoadModule ssl_module modules/mod_ssl.so\\nLoadModule socache_shmcb_module modules/mod_socache_shmcb.so\\nSSLRandomSeed startup file:/dev/urandom 512\\nSSLRandomSeed connect builtin\\nSSLCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES:!ADH\\nSSLProxyCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES:!ADH\\nSSLHonorCipherOrder on\\nSSLProtocol all -SSLv3\\nSSLProxyProtocol all -SSLv3\\nSSLPassPhraseDialog builtin\\nSSLSessionCache \\\"shmcb:/var/cache/mod_ssl/scache(512000)\\\"\\nSSLSessionCacheTimeout 300\\n<VirtualHost *:443>\\nServerName \\\"${IBEXFARM_host}:443\\\"\\nServerAdmin \\\"${IBEXFARM_webmaster_email}\\\"\\nErrorLog /dev/stderr\\nTransferLog /dev/stdout\\nSSLEngine on\\nSSLCertificateFile /ibexdata/cert.pem\\nSSLCertificateKeyFile /ibexdata/privkey.pem\\nSSLCertificateChainFile /ibexdata/chain.pem\\nCustomLog /dev/stdout \\\"%%t %%h %%{SSL_PROTOCOL}x %%{SSL_CIPHER}x \\\\\"%%r\\\\\" %%b\\\"\\n</VirtualHost>\\n\" > /var/ibexfarm/ssl.conf\n#  Create wrapper we use to run httpd, including or not including ssl\n#  config depending on port.\nRUN rm -f /etc/apache2/conf.d/ssl.conf \\\n && echo '#!/bin/sh' > /var/ibexfarm/start.sh \\\n && printf \"rm -f /etc/apache2/conf.d/ssl.conf\\nif [ \\\"$IBEXFARM_port\\\" = \\\"443\\\" ]; then\\n ln -s /var/ibexfarm/ssl.conf /etc/apache2/conf.d/ssl.conf\\nfi\\nexec /usr/sbin/httpd -D FOREGROUND\\n\" >> /var/ibexfarm/start.sh \\\n && chmod +x /var/ibexfarm/start.sh\n#  Fix handling of base URL in Catalyst\nRUN echo 'sub auto : Private { my ($self, $c) = @_; $c->req->base(URI->new(IbexFarm->config->{url_prefix})); }; 1' >> /var/ibexfarm/ibexfarm/lib/IbexFarm/Controller/Root.pm\n#  Fix the id of the apache user and group so we know what they are\n#  when doing chowns in the host system.\nRUN groupmod -g 987654 apache \\\n && usermod -u 987654 apache\nEXPOSE 80/tcp 443/tcp\nENTRYPOINT [\"/var/ibexfarm/start.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"efabec34d34063214c0d8e40f5ae7233","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM alpine:3.8\n#   Install required alpine linux packages.\nRUN apk update\nRUN apk add git perl perl-dev musl-dev python apache2 gcc make perl-app-cpanminus perl-namespace-autoclean gdbm apache2-dev curl apache2-utils apache2-ssl shadow vim\n#   Install modperl\nRUN cd /tmp \\\n && wget http://apache.org/dist/perl/mod_perl-2.0.10.tar.gz \\\n && tar -xzf mod_perl-2.0.10.tar.gz \\\n && cd mod_perl-2.0.10/ \\\n && perl Makefile.PL MP_APXS=/usr/bin/apxs \\\n && make \\\n && make install\n#   Load modperl in httpd conf\nRUN echo >> /etc/apache2/httpd.conf \\\n && echo \"LoadModule perl_module /usr/lib/apache2/mod_perl.so\" >> /etc/apache2/httpd.conf\n#   Build Crypt::Rijndael perl module manually because we need to apply a patch\n#   to rijndael.h.\nRUN cd /tmp \\\n && wget https://cpan.metacpan.org/authors/id/L/LE/LEONT/Crypt-Rijndael-1.13.tar.gz \\\n && tar -xzf Crypt-Rijndael-1.13.tar.gz \\\n && cd Crypt-Rijndael-1.13/ \\\n && perl Makefile.PL \\\n && sed -i s/__uint8_t/uint8_t/g rijndael.h \\\n && sed -i s/__uint32_t/uint32_t/g rijndael.h \\\n && make install\n#   Install the remaining required perl modules using cpanm.\nRUN cpanm --notest --no-man-pages --no-wget --curl Moose MooseX::Types MooseX::ConfigFromFile MooseX::Getopt MooseX::Role::Parameterized MooseX::SimpleConfig MooseX::StrictConstructor MooseX::Types::DateTime Time::HiRes Time::Piece Catalyst::Devel Catalyst::Plugin::RequireSSL Catalyst::Plugin::Session::Store::FastMmap JSON Catalyst::View::JSON Template::Plugin::Filter::Minify::CSS Template::Plugin::Filter::Minify::JavaScript Catalyst::Plugin::Cache::FastMmap Catalyst::Plugin::UploadProgress HTML::GenerateUtil Class::Factory JSON::XS Digest Archive::Zip Data::Validate::URI Log::Handler Crypt::OpenPGP Params::Classify Variable::Magic DateTime Class::ISA Catalyst::Authentication::User::Hash Catalyst::Plugin::Session::State::Cookie Catalyst::View::TT Archive::Tar Catalyst::Plugin::ConfigLoader::Environment\n#   Set up deployment dirs.\nRUN mkdir /var/ibexfarm \\\n && git clone https://github.com/addrummond/ibexfarm.git /var/ibexfarm/ibexfarm \\\n && chown -R apache:apache /var/ibexfarm/\n#   Checkout the revision of github.com/addrummond/ibex corresponding to 0.3.9\n#   and create a tarball.\nRUN cd /tmp \\\n && git clone https://github.com/addrummond/ibex \\\n && cd ibex \\\n && git checkout 9e903f9 \\\n && rm -rf .git* \\\n && rm -rf docs \\\n && rm -rf contrib \\\n && rm -f LICENSE README example_lighttpd.conf mkdist.sh server_conf.py \\\n && cd .. \\\n && tar -czf ibex-deploy.tar.gz ibex \\\n && mv ibex-deploy.tar.gz /var/ibexfarm\nRUN touch /etc/apache2/conf.d/httpdpasswd \\\n && chown apache:apache /etc/apache2/conf.d/httpdpasswd\n#   This is the dir apache2 wants to put its PID file in.\nRUN mkdir /run/apache2\n#   Main ibex farm config.\nRUN printf \"---\\nname: IbexFarm\\n\\nurl_prefix: '/'\\n\\nwebmaster_name: 'IBEX_WEBMASTER'\\nwebmaster_email: 'IBEX_WEBMASTER_EMAIL'\\n\\nibex_archive: '/var/ibexfarm/ibex-deploy.tar.gz'\\nibex_archive_root_dir: 'ibex'\\nibex_version: '0.3.9'\\ndeployment_dir: '/ibexdata/deploy'\\ndeployment_www_dir: '/ibexdata/ibexexps'\\n\\nmax_fname_length: 150\\n\\ndirs: [ 'js_includes', 'css_includes', 'data_includes', 'chunk_includes', 'server_state', 'results' ]\\nsync_dirs: [ 'js_includes', 'css_includes', 'data_includes', 'chunk_includes', 'server_state' ]\\ndirs_to_types:\\n js_includes: 'text/javascript'\\n css_includes: 'text/css'\\n data_includes: 'text/javascript'\\n chunk_includes: 'text/html'\\n server_state: 'text/plain'\\n results: 'text/plain'\\noptional_dirs:\\n server_state: 1\\n results: 1\\nwritable: [ 'data_includes/*', 'results/*', 'server_state/*','chunk_includes/*' ]\\n\\nenforce_quotas: 0\\nquota_max_files_in_dir: 500\\nquota_max_file_size: 1048576\\nquota_max_total_size: 1048576\\nquota_record_dir: '/tmp/quota'\\n\\npassword_protect_apache:\\n htpasswd: '/usr/bin/htpasswd'\\n passwd_file: '/etc/apache2/conf.d/httpdpasswd'\\n\\nmax_upload_size_bytes: 1048576\\n\\nexperiment_password_protection: Apache\\n\\ngit_path: '/usr/bin/git'\\ngit_checkout_timeout_seconds: 25\\n\\nevent_log_file: '/dev/stdout'\\n\\nexperiment_base_url: '/ibexexps/'\\n\\npython_hashbang: '/usr/bin/python'\\n\\nconfig_url: 'http://localhost/ajax/config'\\nconfig_permitted_hosts: ['localhost', '::1']\\n\" > /var/ibexfarm/ibexfarm/ibexfarm.yaml\n#  # Choose port Apache listens on based on env var\nRUN sed -i 's/^Listen[\\t ].*/Listen ${IBEXFARM_port}'/ /etc/apache2/httpd.conf\n#  # Append to Apache config\nRUN printf \"ServerName localhost\\n\\nPerlSwitches -I/var/ibexfarm/ibexfarm/lib\\nPerlModule IbexFarm\\n\\n<LocationMatch \\\"^/(?!(?:static/|ibexexps/))\\\">\\n SetHandler modperl\\n PerlResponseHandler IbexFarm\\n</LocationMatch>\\n\\nAlias /static/ /var/ibexfarm/ibexfarm/root/static/\\n<Directory /var/ibexfarm/ibexfarm/root/static/>\\n Options none\\n Require all granted\\n</Directory>\\n<Location /static>\\n SetHandler default-handler\\n</Location>\\n\\nDocumentRoot \\\"/var/www\\\"\\n\\nAddHandler cgi-script .py\\nAlias \"/ibexexps\" \"/ibexdata/ibexexps\"\\n\\n<Directory \\\"/ibexdata/ibexexps\\\" >\\n Options +ExecCGI +FollowSymLinks\\n AllowOverride AuthConfig\\n DirectoryIndex experiment.html\\n Require all granted\\n</Directory>\\n<Directory \\\"/var/www\\\">\\n AllowOverride None\\n Require all granted\\n</Directory>\\n\\nErrorLog /dev/stderr\\nTransferLog /dev/stdout\\n\\nLoadModule cgi_module modules/mod_cgi.so\\nSetEnv IBEXFARM_config_url \\\"${IBEXFARM_config_url}\\\"\\nPerlSetEnv IBEXFARM_host \\\"${IBEXFARM_host}\\\"\\nPerlSetEnv IBEXFARM_url_prefix \\\"${IBEXFARM_url_prefix}\\\"\\nPerlSetEnv IBEXFARM_webmaster_email \\\"${IBEXFARM_webmaster_email}\\\"\\nPerlSetEnv IBEXFARM_webmaster_name \\\"${IBEXFARM_webmaster_name}\\\"\\nPerlSetEnv IBEXFARM_config_secret \\\"${IBEXFARM_config_secret}\\\"\\nPerlSetEnv IBEXFARM_config_url_envvar \\\"${IBEXFARM_config_url_envvar}\\\"\\n\" >> /etc/apache2/httpd.conf\n#   Apache https config\nRUN printf \"LoadModule ssl_module modules/mod_ssl.so\\nLoadModule socache_shmcb_module modules/mod_socache_shmcb.so\\nSSLRandomSeed startup file:/dev/urandom 512\\nSSLRandomSeed connect builtin\\nSSLCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES:!ADH\\nSSLProxyCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES:!ADH\\nSSLHonorCipherOrder on\\nSSLProtocol all -SSLv3\\nSSLProxyProtocol all -SSLv3\\nSSLPassPhraseDialog builtin\\nSSLSessionCache \\\"shmcb:/var/cache/mod_ssl/scache(512000)\\\"\\nSSLSessionCacheTimeout 300\\n<VirtualHost *:443>\\nServerName \\\"${IBEXFARM_host}:443\\\"\\nServerAdmin \\\"${IBEXFARM_webmaster_email}\\\"\\nErrorLog /dev/stderr\\nTransferLog /dev/stdout\\nSSLEngine on\\nSSLCertificateFile /ibexdata/cert.pem\\nSSLCertificateKeyFile /ibexdata/privkey.pem\\nSSLCertificateChainFile /ibexdata/chain.pem\\nCustomLog /dev/stdout \\\"%%t %%h %%{SSL_PROTOCOL}x %%{SSL_CIPHER}x \\\"%%r\\\" %%b\\\"\\n</VirtualHost>\\n\" > /var/ibexfarm/ssl.conf\n#   Create wrapper we use to run httpd, including or not including ssl\n#   config depending on port.\nRUN rm -f /etc/apache2/conf.d/ssl.conf \\\n && echo '#!/bin/sh' > /var/ibexfarm/start.sh \\\n && printf \"rm -f /etc/apache2/conf.d/ssl.conf\\nif [ \\\"$IBEXFARM_port\\\" = \\\"443\\\" ]; then\\n ln -s /var/ibexfarm/ssl.conf /etc/apache2/conf.d/ssl.conf\\nfi\\nexec /usr/sbin/httpd -D FOREGROUND\\n\" >> /var/ibexfarm/start.sh \\\n && chmod +x /var/ibexfarm/start.sh\n#   Fix handling of base URL in Catalyst\nRUN echo 'sub auto : Private { my ($self, $c) = @_; $c->req->base(URI->new(IbexFarm->config->{url_prefix})); }; 1' >> /var/ibexfarm/ibexfarm/lib/IbexFarm/Controller/Root.pm\n#   Fix the id of the apache user and group so we know what they are\n#   when doing chowns in the host system.\nRUN groupmod -g 987654 apache \\\n && usermod -u 987654 apache\nEXPOSE 80/tcp 443/tcp\nENTRYPOINT [\"/var/ibexfarm/start.sh\"]\n","originalDockerfileUglifiedHash":"5c32c00c8f07681f7f010f98057ec802","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/c8903301bb89f9417ab83da7959ab410fe793ef3.dockerfile"}