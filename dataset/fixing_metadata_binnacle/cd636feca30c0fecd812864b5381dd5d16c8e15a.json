{"seed":987143754,"processedDockerfileHash":"20b880235090d26929f9f02ac79e5ad7","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   Alpine Linux is not officially supported by the RabbitMQ team -- use at your own risk!\nFROM alpine:3.8\nRUN apk add bash=4.4.19-r1 procps=3.3.15-r0 'su-exec>=0.2' --no-cache\n#   Default to a PGP keyserver that pgp-happy-eyeballs recognizes, but allow for substitutions locally\nARG PGP_KEYSERVER=ha.pool.sks-keyservers.net\n#   If you are building this image locally and are getting `gpg: keyserver receive failed: No data` errors,\n#   run the build with a different PGP_KEYSERVER, e.g. docker build --tag rabbitmq:3.7 --build-arg PGP_KEYSERVER=pgpkeys.eu 3.7/ubuntu\n#   For context, see https://github.com/docker-library/official-images/issues/4252\n#   Using the latest OpenSSL LTS release, with support until September 2023 - https://www.openssl.org/source/\nENV OPENSSL_VERSION=\"1.1.1c\"\nENV OPENSSL_SOURCE_SHA256=\"f6fb3079ad15076154eda9413fed42877d668e7069d9b87396d0804fdb3f4c90\"\n#   https://www.openssl.org/community/omc.html\nENV OPENSSL_PGP_KEY_IDS=\"0x8657ABB260F056B1E5190839D9C4D26D0E604491 0x5B2545DAB21995F4088CEFAA36CEE4DEB00CFE33 0xED230BEC4D4F2518B9D7DF41F0DB4D21C1D35231 0xC1F33DD8CE1D4CC613AF14DA9195C48241FBF7DD 0x7953AC1FBC3DC8B3B292393ED5E9E43F7DF9EE8C 0xE5E52560DD91C556DDBDA5D02064C53641C25E5D\"\n#   Use the latest stable Erlang/OTP release (https://github.com/erlang/otp/tags)\nENV OTP_VERSION=\"22.0.4\"\n#   TODO add PGP checking when the feature will be added to Erlang/OTP's build system\n#   http://erlang.org/pipermail/erlang-questions/2019-January/097067.html\nENV OTP_SOURCE_SHA256=\"71b2fe49ed5ac386ebc189dd2e5f4b95b11b4427936be0e3c5695a903ea9ffcd\"\n#   Install dependencies required to build Erlang/OTP from source\n#   http://erlang.org/doc/installation_guide/INSTALL.html\n#   autoconf: Required to configure Erlang/OTP before compiling\n#   dpkg-dev: Required to set up host & build type when compiling Erlang/OTP\n#   gnupg: Required to verify OpenSSL artefacts\n#   libncurses5-dev: Required for Erlang/OTP new shell & observer_cli - https://github.com/zhongwencool/observer_cli\nRUN set -eux ; apk add autoconf=2.69-r2 ca-certificates=20191127-r2 dpkg-dev=1.18.24-r0 dpkg=1.18.24-r0 gcc=6.4.0-r9 gnupg=2.2.19-r0 libc-dev=0.7.1-r0 linux-headers=4.4.6-r2 make=4.2.1-r2 ncurses-dev=6.1_p20180818-r1 --no-cache --virtual .build-deps ; OPENSSL_SOURCE_URL=\"https://www.openssl.org/source/openssl-$OPENSSL_VERSION.tar.gz\" ; OPENSSL_PATH=\"/usr/local/src/openssl-$OPENSSL_VERSION\" ; OPENSSL_CONFIG_DIR=/usr/local/etc/ssl ; mkdir /usr/local/src ; wget --output-document \"$OPENSSL_PATH.tar.gz.asc\" \"$OPENSSL_SOURCE_URL.asc\" ; wget --output-document \"$OPENSSL_PATH.tar.gz\" \"$OPENSSL_SOURCE_URL\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for key in $OPENSSL_PGP_KEY_IDS; do gpg --batch --keyserver \"$PGP_KEYSERVER\" --recv-keys \"$key\" ; done ; gpg --batch --verify \"$OPENSSL_PATH.tar.gz.asc\" \"$OPENSSL_PATH.tar.gz\" ; gpgconf --kill all ; rm -rf \"$GNUPGHOME\" ; echo \"$OPENSSL_SOURCE_SHA256 *$OPENSSL_PATH.tar.gz\" | sha256sum -c - ; mkdir -p \"$OPENSSL_PATH\" ; tar --extract --file \"$OPENSSL_PATH.tar.gz\" --directory \"$OPENSSL_PATH\" --strip-components 1 ; cd \"$OPENSSL_PATH\" ; MACHINE=\"$( dpkg-architecture --query DEB_BUILD_GNU_CPU ;)\" RELEASE=\"4.x.y-z\" SYSTEM='Linux' BUILD='???' ./config --openssldir=\"$OPENSSL_CONFIG_DIR\" ; make -j \"$( getconf _NPROCESSORS_ONLN ;)\" ; make install_sw install_ssldirs ; cd .. ; rm -rf \"$OPENSSL_PATH\"* ; rmdir \"$OPENSSL_CONFIG_DIR/certs\" \"$OPENSSL_CONFIG_DIR/private\" ; ln -sf /etc/ssl/certs /etc/ssl/private \"$OPENSSL_CONFIG_DIR\" ; openssl version ; OTP_SOURCE_URL=\"https://github.com/erlang/otp/archive/OTP-$OTP_VERSION.tar.gz\" ; OTP_PATH=\"/usr/local/src/otp-$OTP_VERSION\" ; mkdir -p \"$OTP_PATH\" ; wget --output-document \"$OTP_PATH.tar.gz\" \"$OTP_SOURCE_URL\" ; echo \"$OTP_SOURCE_SHA256 *$OTP_PATH.tar.gz\" | sha256sum -c - ; tar --extract --file \"$OTP_PATH.tar.gz\" --directory \"$OTP_PATH\" --strip-components 1 ; cd \"$OTP_PATH\" ; export ERL_TOP=\"$OTP_PATH\" ; ./otp_build autoconf ; CFLAGS=\"$( dpkg-buildflags --get CFLAGS ;)\" ; export CFLAGS ; hostArch=\"$( dpkg-architecture --query DEB_HOST_GNU_TYPE ;)\" ; buildArch=\"$( dpkg-architecture --query DEB_BUILD_GNU_TYPE ;)\" ; dpkgArch=\"$( dpkg --print-architecture ;)\" ; dpkgArch=\"${dpkgArch##*-}\" ; ./configure --host=\"$hostArch\" --build=\"$buildArch\" --disable-dynamic-ssl-lib --disable-hipe --disable-sctp --disable-silent-rules --enable-clock-gettime --enable-hybrid-heap --enable-kernel-poll --enable-shared-zlib --enable-smp-support --enable-threads --with-microstate-accounting=extra --without-common_test --without-debugger --without-dialyzer --without-diameter --without-edoc --without-erl_docgen --without-erl_interface --without-et --without-eunit --without-ftp --without-hipe --without-jinterface --without-megaco --without-observer --without-odbc --without-reltool --without-ssh --without-tftp --without-wx ; make -j \"$( getconf _NPROCESSORS_ONLN ;)\" GEN_OPT_FLGS=\"-O2 -fno-strict-aliasing\" ; make install ; cd .. ; rm -rf \"$OTP_PATH\"* /usr/local/lib/erlang/lib/*/examples /usr/local/lib/erlang/lib/*/src ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add $runDeps --no-cache --virtual .otp-run-deps ; apk del --no-network .build-deps ; openssl version ; erl -noshell -eval 'io:format(\"~p~n~n~p~n~n\", [crypto:supports(), ssl:versions()]), init:stop().'\nENV RABBITMQ_DATA_DIR=\"/var/lib/rabbitmq\"\n#   Create rabbitmq system user & group, fix permissions & allow root user to connect to the RabbitMQ Erlang VM\nRUN set -eux ; addgroup -g 101 -S rabbitmq ; adduser -u 100 -S -h \"$RABBITMQ_DATA_DIR\" -G rabbitmq rabbitmq ; mkdir -p \"$RABBITMQ_DATA_DIR\" /etc/rabbitmq /tmp/rabbitmq-ssl /var/log/rabbitmq ; chown -fR rabbitmq:rabbitmq \"$RABBITMQ_DATA_DIR\" /etc/rabbitmq /tmp/rabbitmq-ssl /var/log/rabbitmq ; chmod 777 \"$RABBITMQ_DATA_DIR\" /etc/rabbitmq /tmp/rabbitmq-ssl /var/log/rabbitmq ; ln -sf \"$RABBITMQ_DATA_DIR/.erlang.cookie\" /root/.erlang.cookie\n#   Use the latest stable RabbitMQ release (https://www.rabbitmq.com/download.html)\nENV RABBITMQ_VERSION=\"3.7.15\"\n#   https://www.rabbitmq.com/signatures.html#importing-gpg\nENV RABBITMQ_PGP_KEY_ID=\"0x0A9AF2115F4687BD29803A206B73A36E6026DFCA\"\nENV RABBITMQ_HOME=\"/opt/rabbitmq\"\n#   Add RabbitMQ to PATH, send all logs to TTY\nENV PATH=\"$RABBITMQ_HOME/sbin:$PATH\" \\\n    RABBITMQ_LOGS=\"-\" \\\n    RABBITMQ_SASL_LOGS=\"-\"\n#   Install RabbitMQ\nRUN set -eux ; apk add ca-certificates=20191127-r2 gnupg=2.2.19-r0 xz=5.2.4-r0 --no-cache --virtual .build-deps ; RABBITMQ_SOURCE_URL=\"https://github.com/rabbitmq/rabbitmq-server/releases/download/v$RABBITMQ_VERSION/rabbitmq-server-generic-unix-$RABBITMQ_VERSION.tar.xz\" ; RABBITMQ_PATH=\"/usr/local/src/rabbitmq-$RABBITMQ_VERSION\" ; wget --output-document \"$RABBITMQ_PATH.tar.xz.asc\" \"$RABBITMQ_SOURCE_URL.asc\" ; wget --output-document \"$RABBITMQ_PATH.tar.xz\" \"$RABBITMQ_SOURCE_URL\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver \"$PGP_KEYSERVER\" --recv-keys \"$RABBITMQ_PGP_KEY_ID\" ; gpg --batch --verify \"$RABBITMQ_PATH.tar.xz.asc\" \"$RABBITMQ_PATH.tar.xz\" ; gpgconf --kill all ; rm -rf \"$GNUPGHOME\" ; mkdir -p \"$RABBITMQ_HOME\" ; tar --extract --file \"$RABBITMQ_PATH.tar.xz\" --directory \"$RABBITMQ_HOME\" --strip-components 1 ; rm -rf \"$RABBITMQ_PATH\"* ; grep -qE '^SYS_PREFIX=\\$\\{RABBITMQ_HOME\\}$' \"$RABBITMQ_HOME/sbin/rabbitmq-defaults\" ; sed -i 's/^SYS_PREFIX=.*$/SYS_PREFIX=/' \"$RABBITMQ_HOME/sbin/rabbitmq-defaults\" ; grep -qE '^SYS_PREFIX=$' \"$RABBITMQ_HOME/sbin/rabbitmq-defaults\" ; chown -R rabbitmq:rabbitmq \"$RABBITMQ_HOME\" ; apk del .build-deps ; [ ! -e \"$RABBITMQ_DATA_DIR/.erlang.cookie\" ] ; su-exec rabbitmq rabbitmqctl help ; su-exec rabbitmq rabbitmqctl list_ciphers ; su-exec rabbitmq rabbitmq-plugins list ; rm \"$RABBITMQ_DATA_DIR/.erlang.cookie\"\n#   Added for backwards compatibility - users can simply COPY custom plugins to /plugins\nRUN ln -sf /opt/rabbitmq/plugins /plugins\n#   set home so that any `--user` knows where to put the erlang cookie\nENV HOME=\"$RABBITMQ_DATA_DIR\"\n#   Hint that the data (a.k.a. home dir) dir should be separate volume\nVOLUME $RABBITMQ_DATA_DIR\n#   warning: the VM is running with native name encoding of latin1 which may cause Elixir to malfunction as it expects utf8. Please ensure your locale is set to UTF-8 (which can be verified by running \"locale\" in your shell)\n#   Setting all environment variables that control language preferences, behaviour differs - https://www.gnu.org/software/gettext/manual/html_node/The-LANGUAGE-variable.html#The-LANGUAGE-variable\n#   https://docs.docker.com/samples/library/ubuntu/#locales\nENV LANG=\"C.UTF-8\" \\\n    LANGUAGE=\"C.UTF-8\" \\\n    LC_ALL=\"C.UTF-8\"\nCOPY docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\nEXPOSE 4369/tcp 5671/tcp 5672/tcp 25672/tcp\nCMD [\"rabbitmq-server\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  Alpine Linux is not officially supported by the RabbitMQ team -- use at your own risk!\nFROM alpine:3.8\nRUN apk add --no-cache 'su-exec>=0.2' bash procps\n#  Default to a PGP keyserver that pgp-happy-eyeballs recognizes, but allow for substitutions locally\nARG PGP_KEYSERVER=ha.pool.sks-keyservers.net\n#  If you are building this image locally and are getting `gpg: keyserver receive failed: No data` errors,\n#  run the build with a different PGP_KEYSERVER, e.g. docker build --tag rabbitmq:3.7 --build-arg PGP_KEYSERVER=pgpkeys.eu 3.7/ubuntu\n#  For context, see https://github.com/docker-library/official-images/issues/4252\n#  Using the latest OpenSSL LTS release, with support until September 2023 - https://www.openssl.org/source/\nENV OPENSSL_VERSION=\"1.1.1c\"\nENV OPENSSL_SOURCE_SHA256=\"f6fb3079ad15076154eda9413fed42877d668e7069d9b87396d0804fdb3f4c90\"\n#  https://www.openssl.org/community/omc.html\nENV OPENSSL_PGP_KEY_IDS=\"0x8657ABB260F056B1E5190839D9C4D26D0E604491 0x5B2545DAB21995F4088CEFAA36CEE4DEB00CFE33 0xED230BEC4D4F2518B9D7DF41F0DB4D21C1D35231 0xC1F33DD8CE1D4CC613AF14DA9195C48241FBF7DD 0x7953AC1FBC3DC8B3B292393ED5E9E43F7DF9EE8C 0xE5E52560DD91C556DDBDA5D02064C53641C25E5D\"\n#  Use the latest stable Erlang/OTP release (https://github.com/erlang/otp/tags)\nENV OTP_VERSION=\"22.0.4\"\n#  TODO add PGP checking when the feature will be added to Erlang/OTP's build system\n#  http://erlang.org/pipermail/erlang-questions/2019-January/097067.html\nENV OTP_SOURCE_SHA256=\"71b2fe49ed5ac386ebc189dd2e5f4b95b11b4427936be0e3c5695a903ea9ffcd\"\n#  Install dependencies required to build Erlang/OTP from source\n#  http://erlang.org/doc/installation_guide/INSTALL.html\n#  autoconf: Required to configure Erlang/OTP before compiling\n#  dpkg-dev: Required to set up host & build type when compiling Erlang/OTP\n#  gnupg: Required to verify OpenSSL artefacts\n#  libncurses5-dev: Required for Erlang/OTP new shell & observer_cli - https://github.com/zhongwencool/observer_cli\nRUN set -eux ; apk add --no-cache --virtual .build-deps autoconf ca-certificates dpkg-dev dpkg gcc gnupg libc-dev linux-headers make ncurses-dev ; OPENSSL_SOURCE_URL=\"https://www.openssl.org/source/openssl-$OPENSSL_VERSION.tar.gz\" ; OPENSSL_PATH=\"/usr/local/src/openssl-$OPENSSL_VERSION\" ; OPENSSL_CONFIG_DIR=/usr/local/etc/ssl ; mkdir /usr/local/src ; wget --output-document \"$OPENSSL_PATH.tar.gz.asc\" \"$OPENSSL_SOURCE_URL.asc\" ; wget --output-document \"$OPENSSL_PATH.tar.gz\" \"$OPENSSL_SOURCE_URL\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for key in $OPENSSL_PGP_KEY_IDS; do gpg --batch --keyserver \"$PGP_KEYSERVER\" --recv-keys \"$key\" ; done ; gpg --batch --verify \"$OPENSSL_PATH.tar.gz.asc\" \"$OPENSSL_PATH.tar.gz\" ; gpgconf --kill all ; rm -rf \"$GNUPGHOME\" ; echo \"$OPENSSL_SOURCE_SHA256 *$OPENSSL_PATH.tar.gz\" | sha256sum -c - ; mkdir -p \"$OPENSSL_PATH\" ; tar --extract --file \"$OPENSSL_PATH.tar.gz\" --directory \"$OPENSSL_PATH\" --strip-components 1 ; cd \"$OPENSSL_PATH\" ; MACHINE=\"$( dpkg-architecture --query DEB_BUILD_GNU_CPU ;)\" RELEASE=\"4.x.y-z\" SYSTEM='Linux' BUILD='???' ./config --openssldir=\"$OPENSSL_CONFIG_DIR\" ; make -j \"$( getconf _NPROCESSORS_ONLN ;)\" ; make install_sw install_ssldirs ; cd .. ; rm -rf \"$OPENSSL_PATH\"* ; rmdir \"$OPENSSL_CONFIG_DIR/certs\" \"$OPENSSL_CONFIG_DIR/private\" ; ln -sf /etc/ssl/certs /etc/ssl/private \"$OPENSSL_CONFIG_DIR\" ; openssl version ; OTP_SOURCE_URL=\"https://github.com/erlang/otp/archive/OTP-$OTP_VERSION.tar.gz\" ; OTP_PATH=\"/usr/local/src/otp-$OTP_VERSION\" ; mkdir -p \"$OTP_PATH\" ; wget --output-document \"$OTP_PATH.tar.gz\" \"$OTP_SOURCE_URL\" ; echo \"$OTP_SOURCE_SHA256 *$OTP_PATH.tar.gz\" | sha256sum -c - ; tar --extract --file \"$OTP_PATH.tar.gz\" --directory \"$OTP_PATH\" --strip-components 1 ; cd \"$OTP_PATH\" ; export ERL_TOP=\"$OTP_PATH\" ; ./otp_build autoconf ; CFLAGS=\"$( dpkg-buildflags --get CFLAGS ;)\" ; export CFLAGS ; hostArch=\"$( dpkg-architecture --query DEB_HOST_GNU_TYPE ;)\" ; buildArch=\"$( dpkg-architecture --query DEB_BUILD_GNU_TYPE ;)\" ; dpkgArch=\"$( dpkg --print-architecture ;)\" ; dpkgArch=\"${dpkgArch##*-}\" ; ./configure --host=\"$hostArch\" --build=\"$buildArch\" --disable-dynamic-ssl-lib --disable-hipe --disable-sctp --disable-silent-rules --enable-clock-gettime --enable-hybrid-heap --enable-kernel-poll --enable-shared-zlib --enable-smp-support --enable-threads --with-microstate-accounting=extra --without-common_test --without-debugger --without-dialyzer --without-diameter --without-edoc --without-erl_docgen --without-erl_interface --without-et --without-eunit --without-ftp --without-hipe --without-jinterface --without-megaco --without-observer --without-odbc --without-reltool --without-ssh --without-tftp --without-wx ; make -j \"$( getconf _NPROCESSORS_ONLN ;)\" GEN_OPT_FLGS=\"-O2 -fno-strict-aliasing\" ; make install ; cd .. ; rm -rf \"$OTP_PATH\"* /usr/local/lib/erlang/lib/*/examples /usr/local/lib/erlang/lib/*/src ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add --no-cache --virtual .otp-run-deps $runDeps ; apk del --no-network .build-deps ; openssl version ; erl -noshell -eval 'io:format(\"~p~n~n~p~n~n\", [crypto:supports(), ssl:versions()]), init:stop().'\nENV RABBITMQ_DATA_DIR=\"/var/lib/rabbitmq\"\n#  Create rabbitmq system user & group, fix permissions & allow root user to connect to the RabbitMQ Erlang VM\nRUN set -eux ; addgroup -g 101 -S rabbitmq ; adduser -u 100 -S -h \"$RABBITMQ_DATA_DIR\" -G rabbitmq rabbitmq ; mkdir -p \"$RABBITMQ_DATA_DIR\" /etc/rabbitmq /tmp/rabbitmq-ssl /var/log/rabbitmq ; chown -fR rabbitmq:rabbitmq \"$RABBITMQ_DATA_DIR\" /etc/rabbitmq /tmp/rabbitmq-ssl /var/log/rabbitmq ; chmod 777 \"$RABBITMQ_DATA_DIR\" /etc/rabbitmq /tmp/rabbitmq-ssl /var/log/rabbitmq ; ln -sf \"$RABBITMQ_DATA_DIR/.erlang.cookie\" /root/.erlang.cookie\n#  Use the latest stable RabbitMQ release (https://www.rabbitmq.com/download.html)\nENV RABBITMQ_VERSION=\"3.7.15\"\n#  https://www.rabbitmq.com/signatures.html#importing-gpg\nENV RABBITMQ_PGP_KEY_ID=\"0x0A9AF2115F4687BD29803A206B73A36E6026DFCA\"\nENV RABBITMQ_HOME=\"/opt/rabbitmq\"\n#  Add RabbitMQ to PATH, send all logs to TTY\nENV PATH=\"$RABBITMQ_HOME/sbin:$PATH\" \\\n    RABBITMQ_LOGS=\"-\" \\\n    RABBITMQ_SASL_LOGS=\"-\"\n#  Install RabbitMQ\nRUN set -eux ; apk add --no-cache --virtual .build-deps ca-certificates gnupg xz ; RABBITMQ_SOURCE_URL=\"https://github.com/rabbitmq/rabbitmq-server/releases/download/v$RABBITMQ_VERSION/rabbitmq-server-generic-unix-$RABBITMQ_VERSION.tar.xz\" ; RABBITMQ_PATH=\"/usr/local/src/rabbitmq-$RABBITMQ_VERSION\" ; wget --output-document \"$RABBITMQ_PATH.tar.xz.asc\" \"$RABBITMQ_SOURCE_URL.asc\" ; wget --output-document \"$RABBITMQ_PATH.tar.xz\" \"$RABBITMQ_SOURCE_URL\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver \"$PGP_KEYSERVER\" --recv-keys \"$RABBITMQ_PGP_KEY_ID\" ; gpg --batch --verify \"$RABBITMQ_PATH.tar.xz.asc\" \"$RABBITMQ_PATH.tar.xz\" ; gpgconf --kill all ; rm -rf \"$GNUPGHOME\" ; mkdir -p \"$RABBITMQ_HOME\" ; tar --extract --file \"$RABBITMQ_PATH.tar.xz\" --directory \"$RABBITMQ_HOME\" --strip-components 1 ; rm -rf \"$RABBITMQ_PATH\"* ; grep -qE '^SYS_PREFIX=\\$\\{RABBITMQ_HOME\\}$' \"$RABBITMQ_HOME/sbin/rabbitmq-defaults\" ; sed -i 's/^SYS_PREFIX=.*$/SYS_PREFIX=/' \"$RABBITMQ_HOME/sbin/rabbitmq-defaults\" ; grep -qE '^SYS_PREFIX=$' \"$RABBITMQ_HOME/sbin/rabbitmq-defaults\" ; chown -R rabbitmq:rabbitmq \"$RABBITMQ_HOME\" ; apk del .build-deps ; [ ! -e \"$RABBITMQ_DATA_DIR/.erlang.cookie\" ] ; su-exec rabbitmq rabbitmqctl help ; su-exec rabbitmq rabbitmqctl list_ciphers ; su-exec rabbitmq rabbitmq-plugins list ; rm \"$RABBITMQ_DATA_DIR/.erlang.cookie\"\n#  Added for backwards compatibility - users can simply COPY custom plugins to /plugins\nRUN ln -sf /opt/rabbitmq/plugins /plugins\n#  set home so that any `--user` knows where to put the erlang cookie\nENV HOME=\"$RABBITMQ_DATA_DIR\"\n#  Hint that the data (a.k.a. home dir) dir should be separate volume\nVOLUME $RABBITMQ_DATA_DIR\n#  warning: the VM is running with native name encoding of latin1 which may cause Elixir to malfunction as it expects utf8. Please ensure your locale is set to UTF-8 (which can be verified by running \"locale\" in your shell)\n#  Setting all environment variables that control language preferences, behaviour differs - https://www.gnu.org/software/gettext/manual/html_node/The-LANGUAGE-variable.html#The-LANGUAGE-variable\n#  https://docs.docker.com/samples/library/ubuntu/#locales\nENV LANG=\"C.UTF-8\" \\\n    LANGUAGE=\"C.UTF-8\" \\\n    LC_ALL=\"C.UTF-8\"\nCOPY docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\nEXPOSE 4369/tcp 5671/tcp 5672/tcp 25672/tcp\nCMD [\"rabbitmq-server\"]\n","injectedSmells":[],"originalDockerfileHash":"026ed1f7cd7b107fc7e98ae03ad69e4a","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   Alpine Linux is not officially supported by the RabbitMQ team -- use at your own risk!\nFROM alpine:3.8\nRUN apk add --no-cache 'su-exec>=0.2' bash procps\n#   Default to a PGP keyserver that pgp-happy-eyeballs recognizes, but allow for substitutions locally\nARG PGP_KEYSERVER=ha.pool.sks-keyservers.net\n#   If you are building this image locally and are getting `gpg: keyserver receive failed: No data` errors,\n#   run the build with a different PGP_KEYSERVER, e.g. docker build --tag rabbitmq:3.7 --build-arg PGP_KEYSERVER=pgpkeys.eu 3.7/ubuntu\n#   For context, see https://github.com/docker-library/official-images/issues/4252\n#   Using the latest OpenSSL LTS release, with support until September 2023 - https://www.openssl.org/source/\nENV OPENSSL_VERSION=\"1.1.1c\"\nENV OPENSSL_SOURCE_SHA256=\"f6fb3079ad15076154eda9413fed42877d668e7069d9b87396d0804fdb3f4c90\"\n#   https://www.openssl.org/community/omc.html\nENV OPENSSL_PGP_KEY_IDS=\"0x8657ABB260F056B1E5190839D9C4D26D0E604491 0x5B2545DAB21995F4088CEFAA36CEE4DEB00CFE33 0xED230BEC4D4F2518B9D7DF41F0DB4D21C1D35231 0xC1F33DD8CE1D4CC613AF14DA9195C48241FBF7DD 0x7953AC1FBC3DC8B3B292393ED5E9E43F7DF9EE8C 0xE5E52560DD91C556DDBDA5D02064C53641C25E5D\"\n#   Use the latest stable Erlang/OTP release (https://github.com/erlang/otp/tags)\nENV OTP_VERSION=\"22.0.4\"\n#   TODO add PGP checking when the feature will be added to Erlang/OTP's build system\n#   http://erlang.org/pipermail/erlang-questions/2019-January/097067.html\nENV OTP_SOURCE_SHA256=\"71b2fe49ed5ac386ebc189dd2e5f4b95b11b4427936be0e3c5695a903ea9ffcd\"\n#   Install dependencies required to build Erlang/OTP from source\n#   http://erlang.org/doc/installation_guide/INSTALL.html\n#   autoconf: Required to configure Erlang/OTP before compiling\n#   dpkg-dev: Required to set up host & build type when compiling Erlang/OTP\n#   gnupg: Required to verify OpenSSL artefacts\n#   libncurses5-dev: Required for Erlang/OTP new shell & observer_cli - https://github.com/zhongwencool/observer_cli\nRUN set -eux ; apk add --no-cache --virtual .build-deps autoconf ca-certificates dpkg-dev dpkg gcc gnupg libc-dev linux-headers make ncurses-dev ; OPENSSL_SOURCE_URL=\"https://www.openssl.org/source/openssl-$OPENSSL_VERSION.tar.gz\" ; OPENSSL_PATH=\"/usr/local/src/openssl-$OPENSSL_VERSION\" ; OPENSSL_CONFIG_DIR=/usr/local/etc/ssl ; mkdir /usr/local/src ; wget --output-document \"$OPENSSL_PATH.tar.gz.asc\" \"$OPENSSL_SOURCE_URL.asc\" ; wget --output-document \"$OPENSSL_PATH.tar.gz\" \"$OPENSSL_SOURCE_URL\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for key in $OPENSSL_PGP_KEY_IDS; do gpg --batch --keyserver \"$PGP_KEYSERVER\" --recv-keys \"$key\" ; done ; gpg --batch --verify \"$OPENSSL_PATH.tar.gz.asc\" \"$OPENSSL_PATH.tar.gz\" ; gpgconf --kill all ; rm -rf \"$GNUPGHOME\" ; echo \"$OPENSSL_SOURCE_SHA256 *$OPENSSL_PATH.tar.gz\" | sha256sum -c - ; mkdir -p \"$OPENSSL_PATH\" ; tar --extract --file \"$OPENSSL_PATH.tar.gz\" --directory \"$OPENSSL_PATH\" --strip-components 1 ; cd \"$OPENSSL_PATH\" ; MACHINE=\"$( dpkg-architecture --query DEB_BUILD_GNU_CPU ;)\" RELEASE=\"4.x.y-z\" SYSTEM='Linux' BUILD='???' ./config --openssldir=\"$OPENSSL_CONFIG_DIR\" ; make -j \"$( getconf _NPROCESSORS_ONLN ;)\" ; make install_sw install_ssldirs ; cd .. ; rm -rf \"$OPENSSL_PATH\"* ; rmdir \"$OPENSSL_CONFIG_DIR/certs\" \"$OPENSSL_CONFIG_DIR/private\" ; ln -sf /etc/ssl/certs /etc/ssl/private \"$OPENSSL_CONFIG_DIR\" ; openssl version ; OTP_SOURCE_URL=\"https://github.com/erlang/otp/archive/OTP-$OTP_VERSION.tar.gz\" ; OTP_PATH=\"/usr/local/src/otp-$OTP_VERSION\" ; mkdir -p \"$OTP_PATH\" ; wget --output-document \"$OTP_PATH.tar.gz\" \"$OTP_SOURCE_URL\" ; echo \"$OTP_SOURCE_SHA256 *$OTP_PATH.tar.gz\" | sha256sum -c - ; tar --extract --file \"$OTP_PATH.tar.gz\" --directory \"$OTP_PATH\" --strip-components 1 ; cd \"$OTP_PATH\" ; export ERL_TOP=\"$OTP_PATH\" ; ./otp_build autoconf ; CFLAGS=\"$( dpkg-buildflags --get CFLAGS ;)\" ; export CFLAGS ; hostArch=\"$( dpkg-architecture --query DEB_HOST_GNU_TYPE ;)\" ; buildArch=\"$( dpkg-architecture --query DEB_BUILD_GNU_TYPE ;)\" ; dpkgArch=\"$( dpkg --print-architecture ;)\" ; dpkgArch=\"${dpkgArch##*-}\" ; ./configure --host=\"$hostArch\" --build=\"$buildArch\" --disable-dynamic-ssl-lib --disable-hipe --disable-sctp --disable-silent-rules --enable-clock-gettime --enable-hybrid-heap --enable-kernel-poll --enable-shared-zlib --enable-smp-support --enable-threads --with-microstate-accounting=extra --without-common_test --without-debugger --without-dialyzer --without-diameter --without-edoc --without-erl_docgen --without-erl_interface --without-et --without-eunit --without-ftp --without-hipe --without-jinterface --without-megaco --without-observer --without-odbc --without-reltool --without-ssh --without-tftp --without-wx ; make -j \"$( getconf _NPROCESSORS_ONLN ;)\" GEN_OPT_FLGS=\"-O2 -fno-strict-aliasing\" ; make install ; cd .. ; rm -rf \"$OTP_PATH\"* /usr/local/lib/erlang/lib/*/examples /usr/local/lib/erlang/lib/*/src ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add --no-cache --virtual .otp-run-deps $runDeps ; apk del --no-network .build-deps ; openssl version ; erl -noshell -eval 'io:format(\"~p~n~n~p~n~n\", [crypto:supports(), ssl:versions()]), init:stop().'\nENV RABBITMQ_DATA_DIR=\"/var/lib/rabbitmq\"\n#   Create rabbitmq system user & group, fix permissions & allow root user to connect to the RabbitMQ Erlang VM\nRUN set -eux ; addgroup -g 101 -S rabbitmq ; adduser -u 100 -S -h \"$RABBITMQ_DATA_DIR\" -G rabbitmq rabbitmq ; mkdir -p \"$RABBITMQ_DATA_DIR\" /etc/rabbitmq /tmp/rabbitmq-ssl /var/log/rabbitmq ; chown -fR rabbitmq:rabbitmq \"$RABBITMQ_DATA_DIR\" /etc/rabbitmq /tmp/rabbitmq-ssl /var/log/rabbitmq ; chmod 777 \"$RABBITMQ_DATA_DIR\" /etc/rabbitmq /tmp/rabbitmq-ssl /var/log/rabbitmq ; ln -sf \"$RABBITMQ_DATA_DIR/.erlang.cookie\" /root/.erlang.cookie\n#   Use the latest stable RabbitMQ release (https://www.rabbitmq.com/download.html)\nENV RABBITMQ_VERSION=\"3.7.15\"\n#   https://www.rabbitmq.com/signatures.html#importing-gpg\nENV RABBITMQ_PGP_KEY_ID=\"0x0A9AF2115F4687BD29803A206B73A36E6026DFCA\"\nENV RABBITMQ_HOME=\"/opt/rabbitmq\"\n#   Add RabbitMQ to PATH, send all logs to TTY\nENV PATH=\"$RABBITMQ_HOME/sbin:$PATH\" \\\n    RABBITMQ_LOGS=\"-\" \\\n    RABBITMQ_SASL_LOGS=\"-\"\n#   Install RabbitMQ\nRUN set -eux ; apk add --no-cache --virtual .build-deps ca-certificates gnupg xz ; RABBITMQ_SOURCE_URL=\"https://github.com/rabbitmq/rabbitmq-server/releases/download/v$RABBITMQ_VERSION/rabbitmq-server-generic-unix-$RABBITMQ_VERSION.tar.xz\" ; RABBITMQ_PATH=\"/usr/local/src/rabbitmq-$RABBITMQ_VERSION\" ; wget --output-document \"$RABBITMQ_PATH.tar.xz.asc\" \"$RABBITMQ_SOURCE_URL.asc\" ; wget --output-document \"$RABBITMQ_PATH.tar.xz\" \"$RABBITMQ_SOURCE_URL\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver \"$PGP_KEYSERVER\" --recv-keys \"$RABBITMQ_PGP_KEY_ID\" ; gpg --batch --verify \"$RABBITMQ_PATH.tar.xz.asc\" \"$RABBITMQ_PATH.tar.xz\" ; gpgconf --kill all ; rm -rf \"$GNUPGHOME\" ; mkdir -p \"$RABBITMQ_HOME\" ; tar --extract --file \"$RABBITMQ_PATH.tar.xz\" --directory \"$RABBITMQ_HOME\" --strip-components 1 ; rm -rf \"$RABBITMQ_PATH\"* ; grep -qE '^SYS_PREFIX=\\$\\{RABBITMQ_HOME\\}$' \"$RABBITMQ_HOME/sbin/rabbitmq-defaults\" ; sed -i 's/^SYS_PREFIX=.*$/SYS_PREFIX=/' \"$RABBITMQ_HOME/sbin/rabbitmq-defaults\" ; grep -qE '^SYS_PREFIX=$' \"$RABBITMQ_HOME/sbin/rabbitmq-defaults\" ; chown -R rabbitmq:rabbitmq \"$RABBITMQ_HOME\" ; apk del .build-deps ; [ ! -e \"$RABBITMQ_DATA_DIR/.erlang.cookie\" ] ; su-exec rabbitmq rabbitmqctl help ; su-exec rabbitmq rabbitmqctl list_ciphers ; su-exec rabbitmq rabbitmq-plugins list ; rm \"$RABBITMQ_DATA_DIR/.erlang.cookie\"\n#   Added for backwards compatibility - users can simply COPY custom plugins to /plugins\nRUN ln -sf /opt/rabbitmq/plugins /plugins\n#   set home so that any `--user` knows where to put the erlang cookie\nENV HOME=\"$RABBITMQ_DATA_DIR\"\n#   Hint that the data (a.k.a. home dir) dir should be separate volume\nVOLUME $RABBITMQ_DATA_DIR\n#   warning: the VM is running with native name encoding of latin1 which may cause Elixir to malfunction as it expects utf8. Please ensure your locale is set to UTF-8 (which can be verified by running \"locale\" in your shell)\n#   Setting all environment variables that control language preferences, behaviour differs - https://www.gnu.org/software/gettext/manual/html_node/The-LANGUAGE-variable.html#The-LANGUAGE-variable\n#   https://docs.docker.com/samples/library/ubuntu/#locales\nENV LANG=\"C.UTF-8\" \\\n    LANGUAGE=\"C.UTF-8\" \\\n    LC_ALL=\"C.UTF-8\"\nCOPY docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\nEXPOSE 4369/tcp 5671/tcp 5672/tcp 25672/tcp\nCMD [\"rabbitmq-server\"]\n","originalDockerfileUglifiedHash":"7e2b7643961da903699b43228659b635","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/cd636feca30c0fecd812864b5381dd5d16c8e15a.dockerfile"}