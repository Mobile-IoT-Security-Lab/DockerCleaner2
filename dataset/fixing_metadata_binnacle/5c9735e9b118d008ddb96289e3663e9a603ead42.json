{"seed":757479081,"processedDockerfileHash":"6b4a8831458b50ea8499be12b58c69ce","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM alpine:3.4\nMAINTAINER janes - https://github.com/hxer\n#   Timezone\nENV TIMEZONE=\"Asia/Shanghai\"\nENV PHP_MEMORY_LIMIT=\"512M\"\nENV MAX_UPLOAD=\"50M\"\nENV PHP_MAX_FILE_UPLOAD=\"200\"\nENV PHP_MAX_POST=\"100M\"\nENV DUMB_INIT_VERSION=\"1.2.0\"\n#   替换为阿里云的源，构建速度更快\n#   RUN sed -i 's#dl-cdn\\.alpinelinux\\.org#mirrors\\.aliyun\\.com#' /etc/apk/repositories\n#   install mysql, apache and php and php extensions, tzdata, wget\nRUN echo \"@community http://dl-cdn.alpinelinux.org/alpine/edge/community\" >> /etc/apk/repositories \\\n && apk update \\\n && apk add mysql=10.1.32-r0 mysql-client=10.1.32-r0 apache2=2.4.33-r0 curl=7.60.0-r1 wget=1.18-r3 tzdata=2016d-r0 php5-apache2=5.6.36-r0 php5-cli=5.6.36-r0 php5-phar=5.6.36-r0 php5-zlib=5.6.36-r0 php5-zip=5.6.36-r0 php5-bz2=5.6.36-r0 php5-ctype=5.6.36-r0 php5-mysqli=5.6.36-r0 php5-mysql=5.6.36-r0 php5-pdo_mysql=5.6.36-r0 php5-opcache=5.6.36-r0 php5-pdo=5.6.36-r0 php5-json=5.6.36-r0 php5-curl=5.6.36-r0 php5-gd=5.6.36-r0 php5-gmp=5.6.36-r0 php5-mcrypt=5.6.36-r0 php5-openssl=5.6.36-r0 php5-dom=5.6.36-r0 php5-xml=5.6.36-r0 php5-iconv=5.6.36-r0 php5-xdebug@community\nRUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/bin --filename=composer\n#   configure timezone, mysql, apache\nRUN cp /usr/share/zoneinfo/${TIMEZONE} /etc/localtime \\\n && echo \"${TIMEZONE}\" > /etc/timezone \\\n && mkdir -p /run/mysqld \\\n && chown -R mysql:mysql /run/mysqld /var/lib/mysql \\\n && mysql_install_db --user=mysql --verbose=1 --basedir=/usr --datadir=/var/lib/mysql --rpm > /dev/null \\\n && sed -i '/skip-external-locking/a log_error = \\/var\\/lib\\/mysql\\/error.log' /etc/mysql/my.cnf \\\n && sed -i '/skip-external-locking/a general_log = ON' /etc/mysql/my.cnf \\\n && sed -i '/skip-external-locking/a general_log_file = \\/var\\/lib\\/mysql\\/query.log' /etc/mysql/my.cnf \\\n && ln -s /usr/lib/libxml2.so.2 /usr/lib/libxml2.so \\\n && sed -i 's#AllowOverride None#AllowOverride All#' /etc/apache2/httpd.conf \\\n && sed -i 's#ServerName www.example.com:80#\\nServerName localhost:80#' /etc/apache2/httpd.conf \\\n && sed -i 's#^DocumentRoot \".*#DocumentRoot \"/www\"#g' /etc/apache2/httpd.conf \\\n && sed -i 's#/var/www/localhost/htdocs#/www#g' /etc/apache2/httpd.conf \\\n && sed -i \"s|;*date.timezone =.*|date.timezone = ${TIMEZONE}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*memory_limit =.*|memory_limit = ${PHP_MEMORY_LIMIT}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*upload_max_filesize =.*|upload_max_filesize = ${MAX_UPLOAD}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*max_file_uploads =.*|max_file_uploads = ${PHP_MAX_FILE_UPLOAD}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*post_max_size =.*|post_max_size = ${PHP_MAX_POST}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*cgi.fix_pathinfo=.*|cgi.fix_pathinfo= 0|i\" /etc/php5/php.ini \\\n && mkdir -p /run/apache2 \\\n && chown -R apache:apache /run/apache2 \\\n && mkdir /www \\\n && echo \"<?php phpinfo(); ?>\" > /www/index.php \\\n && chown -R apache:apache /www\n#   Configure xdebug\nRUN echo \"zend_extension=xdebug.so\" > /etc/php5/conf.d/xdebug.ini \\\n && echo -e \"\\n[XDEBUG]\" >> /etc/php5/conf.d/xdebug.ini \\\n && echo \"xdebug.remote_enable=1\" >> /etc/php5/conf.d/xdebug.ini \\\n && echo \"xdebug.remote_connect_back=1\" >> /etc/php5/conf.d/xdebug.ini \\\n && echo \"xdebug.idekey=PHPSTORM\" >> /etc/php5/conf.d/xdebug.ini \\\n && echo \"xdebug.remote_log=\\\"/tmp/xdebug.log\\\"\" >> /etc/php5/conf.d/xdebug.ini\n#   Start apache\nRUN echo \"#!/bin/sh\" > /start.sh \\\n && echo \"httpd\" >> /start.sh \\\n && echo \"nohup mysqld --skip-grant-tables --bind-address 0.0.0.0 --user mysql > /dev/null 2>&1 &\" >> /start.sh \\\n && echo \"sleep 3 \\\n && mysql -uroot -e \\\"create database db;\\\"\" >> /start.sh \\\n && echo \"tail -f /var/log/apache2/access.log\" >> /start.sh \\\n && chmod u+x /start.sh\n#   Add dumb-init\nRUN wget -O /usr/local/bin/dumb-init https://github.com/Yelp/dumb-init/releases/download/v${DUMB_INIT_VERSION}/dumb-init_${DUMB_INIT_VERSION}_amd64 \\\n && chmod +x /usr/local/bin/dumb-init\nWORKDIR /www\nEXPOSE 80/tcp\nEXPOSE 3306/tcp\n#  VOLUME [\"/www\",\"/var/lib/mysql\",\"/etc/mysql/\"]\nENTRYPOINT [\"/usr/local/bin/dumb-init\", \"/start.sh\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM alpine:3.4\nMAINTAINER janes - https://github.com/hxer\n#  Timezone\nENV TIMEZONE=\"Asia/Shanghai\"\nENV PHP_MEMORY_LIMIT=\"512M\"\nENV MAX_UPLOAD=\"50M\"\nENV PHP_MAX_FILE_UPLOAD=\"200\"\nENV PHP_MAX_POST=\"100M\"\nENV DUMB_INIT_VERSION=\"1.2.0\"\n#  替换为阿里云的源，构建速度更快\n#  RUN sed -i 's#dl-cdn\\.alpinelinux\\.org#mirrors\\.aliyun\\.com#' /etc/apk/repositories\n#  install mysql, apache and php and php extensions, tzdata, wget\nRUN echo \"@community http://dl-cdn.alpinelinux.org/alpine/edge/community\" >> /etc/apk/repositories \\\n && apk update \\\n && apk add mysql mysql-client apache2 curl wget tzdata php5-apache2 php5-cli php5-phar php5-zlib php5-zip php5-bz2 php5-ctype php5-mysqli php5-mysql php5-pdo_mysql php5-opcache php5-pdo php5-json php5-curl php5-gd php5-gmp php5-mcrypt php5-openssl php5-dom php5-xml php5-iconv php5-xdebug@community\nRUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/bin --filename=composer\n#  configure timezone, mysql, apache\nRUN cp /usr/share/zoneinfo/${TIMEZONE} /etc/localtime \\\n && echo \"${TIMEZONE}\" > /etc/timezone \\\n && mkdir -p /run/mysqld \\\n && chown -R mysql:mysql /run/mysqld /var/lib/mysql \\\n && mysql_install_db --user=mysql --verbose=1 --basedir=/usr --datadir=/var/lib/mysql --rpm > /dev/null \\\n && sed -i '/skip-external-locking/a log_error = \\/var\\/lib\\/mysql\\/error.log' /etc/mysql/my.cnf \\\n && sed -i '/skip-external-locking/a general_log = ON' /etc/mysql/my.cnf \\\n && sed -i '/skip-external-locking/a general_log_file = \\/var\\/lib\\/mysql\\/query.log' /etc/mysql/my.cnf \\\n && ln -s /usr/lib/libxml2.so.2 /usr/lib/libxml2.so \\\n && sed -i 's#AllowOverride None#AllowOverride All#' /etc/apache2/httpd.conf \\\n && sed -i 's#ServerName www.example.com:80#\\nServerName localhost:80#' /etc/apache2/httpd.conf \\\n && sed -i 's#^DocumentRoot \".*#DocumentRoot \"/www\"#g' /etc/apache2/httpd.conf \\\n && sed -i 's#/var/www/localhost/htdocs#/www#g' /etc/apache2/httpd.conf \\\n && sed -i \"s|;*date.timezone =.*|date.timezone = ${TIMEZONE}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*memory_limit =.*|memory_limit = ${PHP_MEMORY_LIMIT}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*upload_max_filesize =.*|upload_max_filesize = ${MAX_UPLOAD}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*max_file_uploads =.*|max_file_uploads = ${PHP_MAX_FILE_UPLOAD}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*post_max_size =.*|post_max_size = ${PHP_MAX_POST}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*cgi.fix_pathinfo=.*|cgi.fix_pathinfo= 0|i\" /etc/php5/php.ini \\\n && mkdir -p /run/apache2 \\\n && chown -R apache:apache /run/apache2 \\\n && mkdir /www \\\n && echo \"<?php phpinfo(); ?>\" > /www/index.php \\\n && chown -R apache:apache /www\n#  Configure xdebug\nRUN echo \"zend_extension=xdebug.so\" > /etc/php5/conf.d/xdebug.ini \\\n && echo -e \"\\n[XDEBUG]\" >> /etc/php5/conf.d/xdebug.ini \\\n && echo \"xdebug.remote_enable=1\" >> /etc/php5/conf.d/xdebug.ini \\\n && echo \"xdebug.remote_connect_back=1\" >> /etc/php5/conf.d/xdebug.ini \\\n && echo \"xdebug.idekey=PHPSTORM\" >> /etc/php5/conf.d/xdebug.ini \\\n && echo \"xdebug.remote_log=\\\"/tmp/xdebug.log\\\"\" >> /etc/php5/conf.d/xdebug.ini\n#  Start apache\nRUN echo \"#!/bin/sh\" > /start.sh \\\n && echo \"httpd\" >> /start.sh \\\n && echo \"nohup mysqld --skip-grant-tables --bind-address 0.0.0.0 --user mysql > /dev/null 2>&1 &\" >> /start.sh \\\n && echo \"sleep 3 \\\n && mysql -uroot -e \\\"create database db;\\\"\" >> /start.sh \\\n && echo \"tail -f /var/log/apache2/access.log\" >> /start.sh \\\n && chmod u+x /start.sh\n#  Add dumb-init\nRUN wget -O /usr/local/bin/dumb-init https://github.com/Yelp/dumb-init/releases/download/v${DUMB_INIT_VERSION}/dumb-init_${DUMB_INIT_VERSION}_amd64 \\\n && chmod +x /usr/local/bin/dumb-init\nWORKDIR /www\nEXPOSE 80/tcp\nEXPOSE 3306/tcp\n# VOLUME [\"/www\",\"/var/lib/mysql\",\"/etc/mysql/\"]\nENTRYPOINT [\"/usr/local/bin/dumb-init\", \"/start.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"c6f39b1ed574b473b0418c1e2d2636a9","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM alpine:3.4\nMAINTAINER janes - https://github.com/hxer\n#   Timezone\nENV TIMEZONE=\"Asia/Shanghai\"\nENV PHP_MEMORY_LIMIT=\"512M\"\nENV MAX_UPLOAD=\"50M\"\nENV PHP_MAX_FILE_UPLOAD=\"200\"\nENV PHP_MAX_POST=\"100M\"\nENV DUMB_INIT_VERSION=\"1.2.0\"\n#   替换为阿里云的源，构建速度更快\n#   RUN sed -i 's#dl-cdn\\.alpinelinux\\.org#mirrors\\.aliyun\\.com#' /etc/apk/repositories\n#   install mysql, apache and php and php extensions, tzdata, wget\nRUN echo \"@community http://dl-cdn.alpinelinux.org/alpine/edge/community\" >> /etc/apk/repositories \\\n && apk update \\\n && apk add mysql mysql-client apache2 curl wget tzdata php5-apache2 php5-cli php5-phar php5-zlib php5-zip php5-bz2 php5-ctype php5-mysqli php5-mysql php5-pdo_mysql php5-opcache php5-pdo php5-json php5-curl php5-gd php5-gmp php5-mcrypt php5-openssl php5-dom php5-xml php5-iconv php5-xdebug@community\nRUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/bin --filename=composer\n#   configure timezone, mysql, apache\nRUN cp /usr/share/zoneinfo/${TIMEZONE} /etc/localtime \\\n && echo \"${TIMEZONE}\" > /etc/timezone \\\n && mkdir -p /run/mysqld \\\n && chown -R mysql:mysql /run/mysqld /var/lib/mysql \\\n && mysql_install_db --user=mysql --verbose=1 --basedir=/usr --datadir=/var/lib/mysql --rpm > /dev/null \\\n && sed -i '/skip-external-locking/a log_error = \\/var\\/lib\\/mysql\\/error.log' /etc/mysql/my.cnf \\\n && sed -i '/skip-external-locking/a general_log = ON' /etc/mysql/my.cnf \\\n && sed -i '/skip-external-locking/a general_log_file = \\/var\\/lib\\/mysql\\/query.log' /etc/mysql/my.cnf \\\n && ln -s /usr/lib/libxml2.so.2 /usr/lib/libxml2.so \\\n && sed -i 's#AllowOverride None#AllowOverride All#' /etc/apache2/httpd.conf \\\n && sed -i 's#ServerName www.example.com:80#\\nServerName localhost:80#' /etc/apache2/httpd.conf \\\n && sed -i 's#^DocumentRoot \".*#DocumentRoot \"/www\"#g' /etc/apache2/httpd.conf \\\n && sed -i 's#/var/www/localhost/htdocs#/www#g' /etc/apache2/httpd.conf \\\n && sed -i \"s|;*date.timezone =.*|date.timezone = ${TIMEZONE}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*memory_limit =.*|memory_limit = ${PHP_MEMORY_LIMIT}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*upload_max_filesize =.*|upload_max_filesize = ${MAX_UPLOAD}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*max_file_uploads =.*|max_file_uploads = ${PHP_MAX_FILE_UPLOAD}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*post_max_size =.*|post_max_size = ${PHP_MAX_POST}|i\" /etc/php5/php.ini \\\n && sed -i \"s|;*cgi.fix_pathinfo=.*|cgi.fix_pathinfo= 0|i\" /etc/php5/php.ini \\\n && mkdir -p /run/apache2 \\\n && chown -R apache:apache /run/apache2 \\\n && mkdir /www \\\n && echo \"<?php phpinfo(); ?>\" > /www/index.php \\\n && chown -R apache:apache /www\n#   Configure xdebug\nRUN echo \"zend_extension=xdebug.so\" > /etc/php5/conf.d/xdebug.ini \\\n && echo -e \"\\n[XDEBUG]\" >> /etc/php5/conf.d/xdebug.ini \\\n && echo \"xdebug.remote_enable=1\" >> /etc/php5/conf.d/xdebug.ini \\\n && echo \"xdebug.remote_connect_back=1\" >> /etc/php5/conf.d/xdebug.ini \\\n && echo \"xdebug.idekey=PHPSTORM\" >> /etc/php5/conf.d/xdebug.ini \\\n && echo \"xdebug.remote_log=\\\"/tmp/xdebug.log\\\"\" >> /etc/php5/conf.d/xdebug.ini\n#   Start apache\nRUN echo \"#!/bin/sh\" > /start.sh \\\n && echo \"httpd\" >> /start.sh \\\n && echo \"nohup mysqld --skip-grant-tables --bind-address 0.0.0.0 --user mysql > /dev/null 2>&1 &\" >> /start.sh \\\n && echo \"sleep 3 \\\n && mysql -uroot -e \\\"create database db;\\\"\" >> /start.sh \\\n && echo \"tail -f /var/log/apache2/access.log\" >> /start.sh \\\n && chmod u+x /start.sh\n#   Add dumb-init\nRUN wget -O /usr/local/bin/dumb-init https://github.com/Yelp/dumb-init/releases/download/v${DUMB_INIT_VERSION}/dumb-init_${DUMB_INIT_VERSION}_amd64 \\\n && chmod +x /usr/local/bin/dumb-init\nWORKDIR /www\nEXPOSE 80/tcp\nEXPOSE 3306/tcp\n#  VOLUME [\"/www\",\"/var/lib/mysql\",\"/etc/mysql/\"]\nENTRYPOINT [\"/usr/local/bin/dumb-init\", \"/start.sh\"]\n","originalDockerfileUglifiedHash":"aa7beb1dfb2a297aa9f92ea1df0f35f8","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/5c9735e9b118d008ddb96289e3663e9a603ead42.dockerfile"}