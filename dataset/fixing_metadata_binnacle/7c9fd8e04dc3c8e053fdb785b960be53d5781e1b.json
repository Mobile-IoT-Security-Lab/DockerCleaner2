{"seed":877524033,"processedDockerfileHash":"214b2cd79881162fa7250c9e54a69432","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","use-copy-instead-of-add","have-a-healthcheck"],"processedDockerfile":"#  ##\n#   Ambientum\n#\n#   Repository:    PHP\n#   Image:         CLI/Base\n#   Version:       7.2.x\n#   Strategy:      PHP From PHP-Alpine Repository (CODECASTS) (https://php-alpine.codecasts.rocks)\n#   Base distro:   Alpine 3.8\n#\nFROM alpine:3.8\n#   Repository/Image Maintainer\nLABEL maintainer=\"Diego Hernandes <iamhernandev@gmail.com>\"\n#   Variables for enabling NewRelic\nENV FRAMEWORK=\"laravel\" \\\n    OPCACHE_MODE=\"normal\" \\\n    PHP_MEMORY_LIMIT=\"256M\" \\\n    XDEBUG_ENABLED=\"false\" \\\n    NR_ENABLED=\"false\" \\\n    NR_APP_NAME=\"\" \\\n    NR_LICENSE_KEY=\"\" \\\n    TERM=\"xterm-256color\" \\\n    COLORTERM=\"truecolor\" \\\n    COMPOSER_PROCESS_TIMEOUT=\"1200\"\n#   Add the ENTRYPOINT script\nCOPY start.sh /scripts/start.sh\nCOPY bashrc /home/ambientum/.bashrc\nCOPY bashrc /home/bashrc\n#   Install PHP From DotDeb, Common Extensions, Composer and then cleanup\nRUN echo \"---> Enabling PHP-Alpine\" \\\n && apk add wget=1.20.3-r0 --update \\\n && wget -O /etc/apk/keys/php-alpine.rsa.pub http://php.codecasts.rocks/php-alpine.rsa.pub \\\n && echo \"@php http://php.codecasts.rocks/v3.8/php-7.2\" >> /etc/apk/repositories \\\n && apk add curl=7.61.1-r3 bash=4.4.19-r1 fontconfig=2.12.6-r1 libxrender=0.9.10-r2 libxext=1.3.3-r2 imagemagick=7.0.8.68-r0 nano=2.9.8-r0 vim=8.1.1365-r0 git=2.18.4-r0 unzip=6.0-r6 wget=1.20.3-r0 make=4.2.1-r2 sudo=1.8.23-r4 --update \\\n && echo \"---> Preparing and Installing PHP\" \\\n && apk add php7@php php7-apcu@php php7-bcmath@php php7-bz2@php php7-calendar@php php7-curl@php php7-ctype@php php7-exif@php php7-fpm@php php7-gd@php php7-gmp@php php7-iconv@php php7-imagick@php php7-imap@php php7-intl@php php7-json@php php7-mbstring@php php7-mysqli@php php7-mysqlnd@php php7-pdo_mysql@php php7-mailparse@php php7-memcached@php php7-mongodb@php php7-opcache@php php7-pdo_pgsql@php php7-pgsql@php php7-posix@php php7-redis@php php7-soap@php php7-sodium@php php7-sqlite3@php php7-pdo_sqlite@php php7-xdebug@php php7-xml@php php7-xmlreader@php php7-openssl@php php7-phar@php php7-xsl@php php7-zip@php php7-zlib@php php7-pcntl@php php7-cgi@php php7-phpdbg@php --update \\\n && sudo ln -s /usr/bin/php7 /usr/bin/php \\\n && sudo ln -s /usr/bin/php-cgi7 /usr/bin/php-cgi \\\n && sudo ln -s /usr/sbin/php-fpm7 /usr/sbin/php-fpm \\\n && echo \"---> Installing Composer\" \\\n && curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer \\\n && echo \"---> Cleaning up\" \\\n && rm -rf /tmp/* \\\n && echo \"---> Adding the ambientum user\" \\\n && adduser -D -u 1000 ambientum \\\n && mkdir -p /var/www/app \\\n && chown -R ambientum:ambientum /var/www \\\n && wget -O /tini https://github.com/krallin/tini/releases/download/v0.16.1/tini-static \\\n && chmod +x /tini \\\n && echo \"---> Configuring PHP\" \\\n && echo \"ambientum ALL = ( ALL ) NOPASSWD: ALL\" >> /etc/sudoers \\\n && sed -i \"/user = .*/c\\user = ambientum\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/^group = .*/c\\group = ambientum\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/listen.owner = .*/c\\listen.owner = ambientum\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/listen.group = .*/c\\listen.group = ambientum\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/listen = .*/c\\listen = [::]:9000\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/;access.log = .*/c\\access.log = /proc/self/fd/2\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/;clear_env = .*/c\\clear_env = no\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/;catch_workers_output = .*/c\\catch_workers_output = yes\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/pid = .*/c\\;pid = /run/php/php7.1-fpm.pid\" /etc/php7/php-fpm.conf \\\n && sed -i \"/;daemonize = .*/c\\daemonize = yes\" /etc/php7/php-fpm.conf \\\n && sed -i \"/error_log = .*/c\\error_log = /proc/self/fd/2\" /etc/php7/php-fpm.conf \\\n && sed -i \"/post_max_size = .*/c\\post_max_size = 1000M\" /etc/php7/php.ini \\\n && sed -i \"/upload_max_filesize = .*/c\\upload_max_filesize = 1000M\" /etc/php7/php.ini \\\n && sed -i \"/zend_extension=xdebug/c\\;zend_extension=xdebug\" /etc/php7/conf.d/00_xdebug.ini \\\n && echo \"---> Adding Support for NewRelic\" \\\n && mkdir /tmp/newrelic \\\n && cd /tmp/newrelic \\\n && wget -r -l1 -nd -A\"linux-musl.tar.gz\" https://download.newrelic.com/php_agent/release/ \\\n && gzip -dc newrelic*.tar.gz | tar xf - \\\n && cd newrelic-php5* \\\n && rm -f /usr/lib/php7/modules/newrelic.so \\\n && cp ./agent/x64/newrelic-20170718.so /usr/lib/php7/modules/newrelic.so \\\n && cp ./daemon/newrelic-daemon.x64 /usr/bin/newrelic-daemon \\\n && cp ./scripts/newrelic.ini.template /scripts/newrelic.ini \\\n && mkdir /var/log/newrelic \\\n && chown -R ambientum:ambientum /var/log/newrelic \\\n && chown -R ambientum:ambientum /home/ambientum \\\n && chmod +x /scripts/start.sh \\\n && rm -rf /tmp/*\n#   Define the running user\nUSER ambientum\n#   Application directory\nWORKDIR \"/var/www/app\"\n#   Environment variables\nENV PATH=\"/home/ambientum/.composer/vendor/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\n#   Define the entry point that tries to enable newrelic\nENTRYPOINT [\"/tini\", \"--\", \"/scripts/start.sh\"]\n#   As non daemon and single base image, it may be used as cli container\nCMD [\"/bin/bash\"]\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# ##\n#  Ambientum\n#\n#  Repository:    PHP\n#  Image:         CLI/Base\n#  Version:       7.2.x\n#  Strategy:      PHP From PHP-Alpine Repository (CODECASTS) (https://php-alpine.codecasts.rocks)\n#  Base distro:   Alpine 3.8\n#\nFROM alpine:3.8\n#  Repository/Image Maintainer\nLABEL maintainer=\"Diego Hernandes <iamhernandev@gmail.com>\"\n#  Variables for enabling NewRelic\nENV FRAMEWORK=\"laravel\" \\\n    OPCACHE_MODE=\"normal\" \\\n    PHP_MEMORY_LIMIT=\"256M\" \\\n    XDEBUG_ENABLED=\"false\" \\\n    NR_ENABLED=\"false\" \\\n    NR_APP_NAME=\"\" \\\n    NR_LICENSE_KEY=\"\" \\\n    TERM=\"xterm-256color\" \\\n    COLORTERM=\"truecolor\" \\\n    COMPOSER_PROCESS_TIMEOUT=\"1200\"\n#  Add the ENTRYPOINT script\nADD start.sh /scripts/start.sh\nADD bashrc /home/ambientum/.bashrc\nADD bashrc /home/bashrc\n#  Install PHP From DotDeb, Common Extensions, Composer and then cleanup\nRUN echo \"---> Enabling PHP-Alpine\" \\\n && apk add --update wget \\\n && wget -O /etc/apk/keys/php-alpine.rsa.pub http://php.codecasts.rocks/php-alpine.rsa.pub \\\n && echo \"@php http://php.codecasts.rocks/v3.8/php-7.2\" >> /etc/apk/repositories \\\n && apk add --update curl bash fontconfig libxrender libxext imagemagick nano vim git unzip wget make sudo \\\n && echo \"---> Preparing and Installing PHP\" \\\n && apk add --update php7@php php7-apcu@php php7-bcmath@php php7-bz2@php php7-calendar@php php7-curl@php php7-ctype@php php7-exif@php php7-fpm@php php7-gd@php php7-gmp@php php7-iconv@php php7-imagick@php php7-imap@php php7-intl@php php7-json@php php7-mbstring@php php7-mysqli@php php7-mysqlnd@php php7-pdo_mysql@php php7-mailparse@php php7-memcached@php php7-mongodb@php php7-opcache@php php7-pdo_pgsql@php php7-pgsql@php php7-posix@php php7-redis@php php7-soap@php php7-sodium@php php7-sqlite3@php php7-pdo_sqlite@php php7-xdebug@php php7-xml@php php7-xmlreader@php php7-openssl@php php7-phar@php php7-xsl@php php7-zip@php php7-zlib@php php7-pcntl@php php7-cgi@php php7-phpdbg@php \\\n && sudo ln -s /usr/bin/php7 /usr/bin/php \\\n && sudo ln -s /usr/bin/php-cgi7 /usr/bin/php-cgi \\\n && sudo ln -s /usr/sbin/php-fpm7 /usr/sbin/php-fpm \\\n && echo \"---> Installing Composer\" \\\n && curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer \\\n && echo \"---> Cleaning up\" \\\n && rm -rf /tmp/* \\\n && echo \"---> Adding the ambientum user\" \\\n && adduser -D -u 1000 ambientum \\\n && mkdir -p /var/www/app \\\n && chown -R ambientum:ambientum /var/www \\\n && wget -O /tini https://github.com/krallin/tini/releases/download/v0.16.1/tini-static \\\n && chmod +x /tini \\\n && echo \"---> Configuring PHP\" \\\n && echo \"ambientum ALL = ( ALL ) NOPASSWD: ALL\" >> /etc/sudoers \\\n && sed -i \"/user = .*/c\\user = ambientum\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/^group = .*/c\\group = ambientum\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/listen.owner = .*/c\\listen.owner = ambientum\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/listen.group = .*/c\\listen.group = ambientum\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/listen = .*/c\\listen = [::]:9000\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/;access.log = .*/c\\access.log = /proc/self/fd/2\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/;clear_env = .*/c\\clear_env = no\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/;catch_workers_output = .*/c\\catch_workers_output = yes\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/pid = .*/c\\;pid = /run/php/php7.1-fpm.pid\" /etc/php7/php-fpm.conf \\\n && sed -i \"/;daemonize = .*/c\\daemonize = yes\" /etc/php7/php-fpm.conf \\\n && sed -i \"/error_log = .*/c\\error_log = /proc/self/fd/2\" /etc/php7/php-fpm.conf \\\n && sed -i \"/post_max_size = .*/c\\post_max_size = 1000M\" /etc/php7/php.ini \\\n && sed -i \"/upload_max_filesize = .*/c\\upload_max_filesize = 1000M\" /etc/php7/php.ini \\\n && sed -i \"/zend_extension=xdebug/c\\;zend_extension=xdebug\" /etc/php7/conf.d/00_xdebug.ini \\\n && echo \"---> Adding Support for NewRelic\" \\\n && mkdir /tmp/newrelic \\\n && cd /tmp/newrelic \\\n && wget -r -l1 -nd -A\"linux-musl.tar.gz\" https://download.newrelic.com/php_agent/release/ \\\n && gzip -dc newrelic*.tar.gz | tar xf - \\\n && cd newrelic-php5* \\\n && rm -f /usr/lib/php7/modules/newrelic.so \\\n && cp ./agent/x64/newrelic-20170718.so /usr/lib/php7/modules/newrelic.so \\\n && cp ./daemon/newrelic-daemon.x64 /usr/bin/newrelic-daemon \\\n && cp ./scripts/newrelic.ini.template /scripts/newrelic.ini \\\n && mkdir /var/log/newrelic \\\n && chown -R ambientum:ambientum /var/log/newrelic \\\n && chown -R ambientum:ambientum /home/ambientum \\\n && chmod +x /scripts/start.sh \\\n && rm -rf /tmp/*\n#  Define the running user\nUSER ambientum\n#  Application directory\nWORKDIR \"/var/www/app\"\n#  Environment variables\nENV PATH=\"/home/ambientum/.composer/vendor/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\n#  Define the entry point that tries to enable newrelic\nENTRYPOINT [\"/tini\", \"--\", \"/scripts/start.sh\"]\n#  As non daemon and single base image, it may be used as cli container\nCMD [\"/bin/bash\"]\n","injectedSmells":[],"originalDockerfileHash":"578f17fa0a8b00f987e05f69344df441","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  ##\n#   Ambientum\n#\n#   Repository:    PHP\n#   Image:         CLI/Base\n#   Version:       7.2.x\n#   Strategy:      PHP From PHP-Alpine Repository (CODECASTS) (https://php-alpine.codecasts.rocks)\n#   Base distro:   Alpine 3.8\n#\nFROM alpine:3.8\n#   Repository/Image Maintainer\nLABEL maintainer=\"Diego Hernandes <iamhernandev@gmail.com>\"\n#   Variables for enabling NewRelic\nENV FRAMEWORK=\"laravel\" \\\n    OPCACHE_MODE=\"normal\" \\\n    PHP_MEMORY_LIMIT=\"256M\" \\\n    XDEBUG_ENABLED=\"false\" \\\n    NR_ENABLED=\"false\" \\\n    NR_APP_NAME=\"\" \\\n    NR_LICENSE_KEY=\"\" \\\n    TERM=\"xterm-256color\" \\\n    COLORTERM=\"truecolor\" \\\n    COMPOSER_PROCESS_TIMEOUT=\"1200\"\n#   Add the ENTRYPOINT script\nADD start.sh /scripts/start.sh\nADD bashrc /home/ambientum/.bashrc\nADD bashrc /home/bashrc\n#   Install PHP From DotDeb, Common Extensions, Composer and then cleanup\nRUN echo \"---> Enabling PHP-Alpine\" \\\n && apk add --update wget \\\n && wget -O /etc/apk/keys/php-alpine.rsa.pub http://php.codecasts.rocks/php-alpine.rsa.pub \\\n && echo \"@php http://php.codecasts.rocks/v3.8/php-7.2\" >> /etc/apk/repositories \\\n && apk add --update curl bash fontconfig libxrender libxext imagemagick nano vim git unzip wget make sudo \\\n && echo \"---> Preparing and Installing PHP\" \\\n && apk add --update php7@php php7-apcu@php php7-bcmath@php php7-bz2@php php7-calendar@php php7-curl@php php7-ctype@php php7-exif@php php7-fpm@php php7-gd@php php7-gmp@php php7-iconv@php php7-imagick@php php7-imap@php php7-intl@php php7-json@php php7-mbstring@php php7-mysqli@php php7-mysqlnd@php php7-pdo_mysql@php php7-mailparse@php php7-memcached@php php7-mongodb@php php7-opcache@php php7-pdo_pgsql@php php7-pgsql@php php7-posix@php php7-redis@php php7-soap@php php7-sodium@php php7-sqlite3@php php7-pdo_sqlite@php php7-xdebug@php php7-xml@php php7-xmlreader@php php7-openssl@php php7-phar@php php7-xsl@php php7-zip@php php7-zlib@php php7-pcntl@php php7-cgi@php php7-phpdbg@php \\\n && sudo ln -s /usr/bin/php7 /usr/bin/php \\\n && sudo ln -s /usr/bin/php-cgi7 /usr/bin/php-cgi \\\n && sudo ln -s /usr/sbin/php-fpm7 /usr/sbin/php-fpm \\\n && echo \"---> Installing Composer\" \\\n && curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer \\\n && echo \"---> Cleaning up\" \\\n && rm -rf /tmp/* \\\n && echo \"---> Adding the ambientum user\" \\\n && adduser -D -u 1000 ambientum \\\n && mkdir -p /var/www/app \\\n && chown -R ambientum:ambientum /var/www \\\n && wget -O /tini https://github.com/krallin/tini/releases/download/v0.16.1/tini-static \\\n && chmod +x /tini \\\n && echo \"---> Configuring PHP\" \\\n && echo \"ambientum ALL = ( ALL ) NOPASSWD: ALL\" >> /etc/sudoers \\\n && sed -i \"/user = .*/c\\user = ambientum\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/^group = .*/c\\group = ambientum\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/listen.owner = .*/c\\listen.owner = ambientum\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/listen.group = .*/c\\listen.group = ambientum\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/listen = .*/c\\listen = [::]:9000\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/;access.log = .*/c\\access.log = /proc/self/fd/2\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/;clear_env = .*/c\\clear_env = no\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/;catch_workers_output = .*/c\\catch_workers_output = yes\" /etc/php7/php-fpm.d/www.conf \\\n && sed -i \"/pid = .*/c\\;pid = /run/php/php7.1-fpm.pid\" /etc/php7/php-fpm.conf \\\n && sed -i \"/;daemonize = .*/c\\daemonize = yes\" /etc/php7/php-fpm.conf \\\n && sed -i \"/error_log = .*/c\\error_log = /proc/self/fd/2\" /etc/php7/php-fpm.conf \\\n && sed -i \"/post_max_size = .*/c\\post_max_size = 1000M\" /etc/php7/php.ini \\\n && sed -i \"/upload_max_filesize = .*/c\\upload_max_filesize = 1000M\" /etc/php7/php.ini \\\n && sed -i \"/zend_extension=xdebug/c\\;zend_extension=xdebug\" /etc/php7/conf.d/00_xdebug.ini \\\n && echo \"---> Adding Support for NewRelic\" \\\n && mkdir /tmp/newrelic \\\n && cd /tmp/newrelic \\\n && wget -r -l1 -nd -A\"linux-musl.tar.gz\" https://download.newrelic.com/php_agent/release/ \\\n && gzip -dc newrelic*.tar.gz | tar xf - \\\n && cd newrelic-php5* \\\n && rm -f /usr/lib/php7/modules/newrelic.so \\\n && cp ./agent/x64/newrelic-20170718.so /usr/lib/php7/modules/newrelic.so \\\n && cp ./daemon/newrelic-daemon.x64 /usr/bin/newrelic-daemon \\\n && cp ./scripts/newrelic.ini.template /scripts/newrelic.ini \\\n && mkdir /var/log/newrelic \\\n && chown -R ambientum:ambientum /var/log/newrelic \\\n && chown -R ambientum:ambientum /home/ambientum \\\n && chmod +x /scripts/start.sh \\\n && rm -rf /tmp/*\n#   Define the running user\nUSER ambientum\n#   Application directory\nWORKDIR \"/var/www/app\"\n#   Environment variables\nENV PATH=\"/home/ambientum/.composer/vendor/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\n#   Define the entry point that tries to enable newrelic\nENTRYPOINT [\"/tini\", \"--\", \"/scripts/start.sh\"]\n#   As non daemon and single base image, it may be used as cli container\nCMD [\"/bin/bash\"]\n","originalDockerfileUglifiedHash":"80eb6062f9ba906202c11526ef698c22","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/7c9fd8e04dc3c8e053fdb785b960be53d5781e1b.dockerfile"}