{"seed":1809603579,"processedDockerfileHash":"ffe5869837e9b1ac91c5c33efcf0c78c","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apt-get","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM debian:stretch-slim\nARG NGINX_VERSION=1.17.0\nARG DEB_URL=deb.debian.org\nARG DEB_SECURITY_URL=security.debian.org/debian-security\nARG OPENSSL_URL=https://github.com/openssl/openssl\nARG OPENSSL_BRANCH=OpenSSL_1_1_1a\nRUN set -x ; sed -i \"s!deb.debian.org!${DEB_URL}!g\" /etc/apt/sources.list \\\n && sed -i \"s!security.debian.org/debian-security!${DEB_SECURITY_URL}!g\" /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends patch curl git ca-certificates gcc make libpcre3 libpcre3-dev zlib1g zlib1g-dev libxslt1.1 libxslt1-dev libgd3 libgd-dev libgeoip1 libgeoip-dev libperl5.24 libperl-dev --no-install-suggests -y \\\n && curl -fSL https://nginx.org/download/nginx-$NGINX_VERSION.tar.gz -o nginx.tar.gz \\\n && git clone -b $OPENSSL_BRANCH --depth=1 $OPENSSL_URL /srv/openssl \\\n && cd /srv/openssl \\\n && curl -fsSLO https://raw.githubusercontent.com/hakasenyang/openssl-patch/master/openssl-equal-1.1.1a_ciphers.patch \\\n && patch -p1 < openssl-equal-1.1.1a_ciphers.patch \\\n && cd / \\\n && GPG_KEYS=B0F4253373F8F6F510D42178520A9993A1C052F8 \\\n && CONFIG=\" --with-openssl=/srv/openssl --with-openssl-opt='enable-tls1_3' --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-http_auth_request_module --with-http_xslt_module=dynamic --with-http_image_filter_module=dynamic --with-http_geoip_module=dynamic --with-threads --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-stream_realip_module --with-stream_geoip_module=dynamic --with-http_slice_module --with-mail --with-mail_ssl_module --with-compat --with-file-aio --with-http_v2_module --with-http_v2_hpack_enc \" \\\n && mkdir -p /usr/src \\\n && tar -zxC /usr/src -f nginx.tar.gz \\\n && cd /usr/src/nginx-$NGINX_VERSION \\\n && curl -fsSLO https://raw.githubusercontent.com/hakasenyang/openssl-patch/master/nginx_hpack_push_1.15.3.patch \\\n && patch -p1 < nginx_hpack_push_1.15.3.patch \\\n && ./configure $CONFIG --with-debug \\\n && make \\\n && mv objs/nginx objs/nginx-debug \\\n && mv objs/ngx_http_xslt_filter_module.so objs/ngx_http_xslt_filter_module-debug.so \\\n && mv objs/ngx_http_image_filter_module.so objs/ngx_http_image_filter_module-debug.so \\\n && mv objs/ngx_http_geoip_module.so objs/ngx_http_geoip_module-debug.so \\\n && mv objs/ngx_stream_geoip_module.so objs/ngx_stream_geoip_module-debug.so \\\n && ./configure $CONFIG \\\n && make \\\n && make install \\\n && mkdir /etc/nginx/conf.d/ \\\n && rm -rf /etc/nginx/html/index.html \\\n && install -m755 objs/nginx-debug /usr/sbin/nginx-debug \\\n && install -m755 objs/ngx_http_xslt_filter_module-debug.so /usr/lib/nginx/modules/ngx_http_xslt_filter_module-debug.so \\\n && install -m755 objs/ngx_http_image_filter_module-debug.so /usr/lib/nginx/modules/ngx_http_image_filter_module-debug.so \\\n && install -m755 objs/ngx_http_geoip_module-debug.so /usr/lib/nginx/modules/ngx_http_geoip_module-debug.so \\\n && install -m755 objs/ngx_stream_geoip_module-debug.so /usr/lib/nginx/modules/ngx_stream_geoip_module-debug.so \\\n && ln -s ../../usr/lib/nginx/modules /etc/nginx/modules \\\n && strip /usr/sbin/nginx* \\\n && strip /usr/lib/nginx/modules/*.so\nCOPY nginx.conf /etc/nginx/nginx.conf\nCOPY nginx.vh.default.conf /etc/nginx/conf.d/default.conf\nFROM debian:stretch-slim\nLABEL maintainer=\"khs1994.com nginx With TLSv1.3\"\nCOPY --from=0 /etc/nginx /etc/nginx\nCOPY --from=0 /usr/lib/nginx /usr/lib/nginx\nCOPY --from=0 /usr/sbin/nginx* /usr/sbin/\nCOPY index.html /etc/nginx/html/\nRUN groupadd -r nginx \\\n && useradd -r -g nginx -s /bin/false -M nginx \\\n && mkdir -p /var/log/nginx \\\n && ln -sf /dev/stdout /var/log/nginx/access.log \\\n && ln -sf /dev/stderr /var/log/nginx/error.log \\\n && mkdir -p /var/cache/nginx\nEXPOSE 80/tcp 443/tcp\nSTOPSIGNAL SIGTERM\nCMD [\"nginx\", \"-g\", \"daemon\", \"off\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM debian:stretch-slim\nARG NGINX_VERSION=1.17.0\nARG DEB_URL=deb.debian.org\nARG DEB_SECURITY_URL=security.debian.org/debian-security\nARG OPENSSL_URL=https://github.com/openssl/openssl\nARG OPENSSL_BRANCH=OpenSSL_1_1_1a\nRUN set -x ; sed -i \"s!deb.debian.org!${DEB_URL}!g\" /etc/apt/sources.list \\\n && sed -i \"s!security.debian.org/debian-security!${DEB_SECURITY_URL}!g\" /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends --no-install-suggests -y patch curl git ca-certificates gcc make libpcre3 libpcre3-dev zlib1g zlib1g-dev libxslt1.1 libxslt1-dev libgd3 libgd-dev libgeoip1 libgeoip-dev libperl5.24 libperl-dev \\\n && curl -fSL https://nginx.org/download/nginx-$NGINX_VERSION.tar.gz -o nginx.tar.gz \\\n && git clone -b $OPENSSL_BRANCH --depth=1 $OPENSSL_URL /srv/openssl \\\n && cd /srv/openssl \\\n && curl -fsSLO https://raw.githubusercontent.com/hakasenyang/openssl-patch/master/openssl-equal-1.1.1a_ciphers.patch \\\n && patch -p1 < openssl-equal-1.1.1a_ciphers.patch \\\n && cd / \\\n && GPG_KEYS=B0F4253373F8F6F510D42178520A9993A1C052F8 \\\n && CONFIG=\" --with-openssl=/srv/openssl --with-openssl-opt='enable-tls1_3' --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-http_auth_request_module --with-http_xslt_module=dynamic --with-http_image_filter_module=dynamic --with-http_geoip_module=dynamic --with-threads --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-stream_realip_module --with-stream_geoip_module=dynamic --with-http_slice_module --with-mail --with-mail_ssl_module --with-compat --with-file-aio --with-http_v2_module --with-http_v2_hpack_enc \" \\\n && mkdir -p /usr/src \\\n && tar -zxC /usr/src -f nginx.tar.gz \\\n && cd /usr/src/nginx-$NGINX_VERSION \\\n && curl -fsSLO https://raw.githubusercontent.com/hakasenyang/openssl-patch/master/nginx_hpack_push_1.15.3.patch \\\n && patch -p1 < nginx_hpack_push_1.15.3.patch \\\n && ./configure $CONFIG --with-debug \\\n && make \\\n && mv objs/nginx objs/nginx-debug \\\n && mv objs/ngx_http_xslt_filter_module.so objs/ngx_http_xslt_filter_module-debug.so \\\n && mv objs/ngx_http_image_filter_module.so objs/ngx_http_image_filter_module-debug.so \\\n && mv objs/ngx_http_geoip_module.so objs/ngx_http_geoip_module-debug.so \\\n && mv objs/ngx_stream_geoip_module.so objs/ngx_stream_geoip_module-debug.so \\\n && ./configure $CONFIG \\\n && make \\\n && make install \\\n && mkdir /etc/nginx/conf.d/ \\\n && rm -rf /etc/nginx/html/index.html \\\n && install -m755 objs/nginx-debug /usr/sbin/nginx-debug \\\n && install -m755 objs/ngx_http_xslt_filter_module-debug.so /usr/lib/nginx/modules/ngx_http_xslt_filter_module-debug.so \\\n && install -m755 objs/ngx_http_image_filter_module-debug.so /usr/lib/nginx/modules/ngx_http_image_filter_module-debug.so \\\n && install -m755 objs/ngx_http_geoip_module-debug.so /usr/lib/nginx/modules/ngx_http_geoip_module-debug.so \\\n && install -m755 objs/ngx_stream_geoip_module-debug.so /usr/lib/nginx/modules/ngx_stream_geoip_module-debug.so \\\n && ln -s ../../usr/lib/nginx/modules /etc/nginx/modules \\\n && strip /usr/sbin/nginx* \\\n && strip /usr/lib/nginx/modules/*.so\nCOPY nginx.conf /etc/nginx/nginx.conf\nCOPY nginx.vh.default.conf /etc/nginx/conf.d/default.conf\nFROM debian:stretch-slim\nLABEL maintainer=\"khs1994.com nginx With TLSv1.3\"\nCOPY --from=0 /etc/nginx /etc/nginx\nCOPY --from=0 /usr/lib/nginx /usr/lib/nginx\nCOPY --from=0 /usr/sbin/nginx* /usr/sbin/\nCOPY index.html /etc/nginx/html/\nRUN groupadd -r nginx \\\n && useradd -r -g nginx -s /bin/false -M nginx \\\n && mkdir -p /var/log/nginx \\\n && ln -sf /dev/stdout /var/log/nginx/access.log \\\n && ln -sf /dev/stderr /var/log/nginx/error.log \\\n && mkdir -p /var/cache/nginx\nEXPOSE 80/tcp 443/tcp\nSTOPSIGNAL SIGTERM\nCMD [\"nginx\", \"-g\", \"daemon\", \"off\"]\n","injectedSmells":[],"originalDockerfileHash":"34fa69cf232d6e77b81386036bdc5bfb","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM debian:stretch-slim\nARG NGINX_VERSION=1.17.0\nARG DEB_URL=deb.debian.org\nARG DEB_SECURITY_URL=security.debian.org/debian-security\nARG OPENSSL_URL=https://github.com/openssl/openssl\nARG OPENSSL_BRANCH=OpenSSL_1_1_1a\nRUN set -x ; sed -i \"s!deb.debian.org!${DEB_URL}!g\" /etc/apt/sources.list \\\n && sed -i \"s!security.debian.org/debian-security!${DEB_SECURITY_URL}!g\" /etc/apt/sources.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends patch curl git ca-certificates gcc make libpcre3 libpcre3-dev zlib1g zlib1g-dev libxslt1.1 libxslt1-dev libgd3 libgd-dev libgeoip1 libgeoip-dev libperl5.24 libperl-dev --no-install-suggests -y \\\n && curl -fSL https://nginx.org/download/nginx-$NGINX_VERSION.tar.gz -o nginx.tar.gz \\\n && git clone -b $OPENSSL_BRANCH --depth=1 $OPENSSL_URL /srv/openssl \\\n && cd /srv/openssl \\\n && curl -fsSLO https://raw.githubusercontent.com/hakasenyang/openssl-patch/master/openssl-equal-1.1.1a_ciphers.patch \\\n && patch -p1 < openssl-equal-1.1.1a_ciphers.patch \\\n && cd / \\\n && GPG_KEYS=B0F4253373F8F6F510D42178520A9993A1C052F8 \\\n && CONFIG=\" --with-openssl=/srv/openssl --with-openssl-opt='enable-tls1_3' --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-http_auth_request_module --with-http_xslt_module=dynamic --with-http_image_filter_module=dynamic --with-http_geoip_module=dynamic --with-threads --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-stream_realip_module --with-stream_geoip_module=dynamic --with-http_slice_module --with-mail --with-mail_ssl_module --with-compat --with-file-aio --with-http_v2_module --with-http_v2_hpack_enc \" \\\n && mkdir -p /usr/src \\\n && tar -zxC /usr/src -f nginx.tar.gz \\\n && cd /usr/src/nginx-$NGINX_VERSION \\\n && curl -fsSLO https://raw.githubusercontent.com/hakasenyang/openssl-patch/master/nginx_hpack_push_1.15.3.patch \\\n && patch -p1 < nginx_hpack_push_1.15.3.patch \\\n && ./configure $CONFIG --with-debug \\\n && make \\\n && mv objs/nginx objs/nginx-debug \\\n && mv objs/ngx_http_xslt_filter_module.so objs/ngx_http_xslt_filter_module-debug.so \\\n && mv objs/ngx_http_image_filter_module.so objs/ngx_http_image_filter_module-debug.so \\\n && mv objs/ngx_http_geoip_module.so objs/ngx_http_geoip_module-debug.so \\\n && mv objs/ngx_stream_geoip_module.so objs/ngx_stream_geoip_module-debug.so \\\n && ./configure $CONFIG \\\n && make \\\n && make install \\\n && mkdir /etc/nginx/conf.d/ \\\n && rm -rf /etc/nginx/html/index.html \\\n && install -m755 objs/nginx-debug /usr/sbin/nginx-debug \\\n && install -m755 objs/ngx_http_xslt_filter_module-debug.so /usr/lib/nginx/modules/ngx_http_xslt_filter_module-debug.so \\\n && install -m755 objs/ngx_http_image_filter_module-debug.so /usr/lib/nginx/modules/ngx_http_image_filter_module-debug.so \\\n && install -m755 objs/ngx_http_geoip_module-debug.so /usr/lib/nginx/modules/ngx_http_geoip_module-debug.so \\\n && install -m755 objs/ngx_stream_geoip_module-debug.so /usr/lib/nginx/modules/ngx_stream_geoip_module-debug.so \\\n && ln -s ../../usr/lib/nginx/modules /etc/nginx/modules \\\n && strip /usr/sbin/nginx* \\\n && strip /usr/lib/nginx/modules/*.so\nCOPY nginx.conf /etc/nginx/nginx.conf\nCOPY nginx.vh.default.conf /etc/nginx/conf.d/default.conf\nFROM debian:stretch-slim\nLABEL maintainer=\"khs1994.com nginx With TLSv1.3\"\nCOPY --from=0 /etc/nginx /etc/nginx\nCOPY --from=0 /usr/lib/nginx /usr/lib/nginx\nCOPY --from=0 /usr/sbin/nginx* /usr/sbin/\nCOPY index.html /etc/nginx/html/\nRUN groupadd -r nginx \\\n && useradd -r -g nginx -s /bin/false -M nginx \\\n && mkdir -p /var/log/nginx \\\n && ln -sf /dev/stdout /var/log/nginx/access.log \\\n && ln -sf /dev/stderr /var/log/nginx/error.log \\\n && mkdir -p /var/cache/nginx\nEXPOSE 80/tcp 443/tcp\nSTOPSIGNAL SIGTERM\nCMD [\"nginx\", \"-g\", \"daemon\", \"off\"]\n","originalDockerfileUglifiedHash":"8cf733b14db4b44b5a4a4bc930b862e0","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/75b653a6f5fc6cd16add2e289d0b479ddad915c1.dockerfile"}