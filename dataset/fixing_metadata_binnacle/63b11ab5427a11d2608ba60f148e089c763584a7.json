{"seed":4128768205,"processedDockerfileHash":"e96c1755b2d9b3634555dabea4df4491","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM python:2.7-slim-stretch\nENV GOSU_VERSION=\"1.10\" \\\n    NODE_ENV=\"production\" \\\n    NODE_VERSION=\"8.6.0\" \\\n    YARN_VERSION=\"1.1.0\"\n#   Libraries such as matplotlib require a HOME directory for cache and configuration\nRUN set -ex \\\n && mkdir -p /var/www \\\n && chown www-data:www-data /var/www \\\n && apt-get update \\\n && apt-get install --no-install-recommends gnupg2 -y \\\n && for key in B42F6819007F00F88E364FD4036A9C25BF357DD4 9554F04D7259F04124DE6B476D5A82AC7E37093B 94AE36675C464D64BAFA68DD7434390BDBE9B9C5 FD3A5288F042B6850C66B31F09FE44734EB7990E 71DCFD284A79C3B38668286BC97EC7A07EDE3FC1 DD8F2338BAE7501E3DD5AC78C273792F7D83545D B9AE9905FFD7803F25714661B63B535A4C206CA9 C4F0DFFF4E8C1A8236409D08E73BC641CC11F4C8 56730D5401028683275BD23C23EFEFE93C4CFFFE 6A010C5166006599AA17F08146C2130DFD2497F5; do gpg --keyserver hkp://ipv4.pool.sks-keyservers.net:80 --recv-keys \"$key\" || gpg --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-keys \"$key\" || gpg --keyserver hkp://pgp.mit.edu:80 --recv-keys \"$key\" || gpg --keyserver hkp://keyserver.pgp.com:80 --recv-keys \"$key\" ; done \\\n && apt-get install --no-install-recommends git libev4 libev-dev libevent-dev libxml2-dev libxslt1-dev zlib1g-dev curl build-essential libssl-dev libffi-dev python-dev libpq-dev par2 -y \\\n && ARCH= \\\n && dpkgArch=\"$( dpkg --print-architecture ;)\" \\\n && case \"${dpkgArch##*-}\" in (amd64) ARCH='x64' ;;(ppc64el) ARCH='ppc64le' ;;(*) echo \"unsupported architecture\" ; exit 1 ;; esac \\\n && curl -o /usr/local/bin/gosu -SL \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" \\\n && curl -o /usr/local/bin/gosu.asc -SL \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" \\\n && gpg --verify /usr/local/bin/gosu.asc \\\n && rm /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && curl -SLO \"https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-$ARCH.tar.xz\" \\\n && curl -SLO --compressed \"https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc\" \\\n && gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \\\n && grep \" node-v$NODE_VERSION-linux-$ARCH.tar.xz$\" SHASUMS256.txt | sha256sum -c - \\\n && tar -xJf \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" -C /usr/local --strip-components=1 \\\n && rm \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" SHASUMS256.txt.asc SHASUMS256.txt \\\n && ln -s /usr/local/bin/node /usr/local/bin/nodejs \\\n && curl -fSLO --compressed \"https://yarnpkg.com/downloads/$YARN_VERSION/yarn-v$YARN_VERSION.tar.gz\" \\\n && curl -fSLO --compressed \"https://yarnpkg.com/downloads/$YARN_VERSION/yarn-v$YARN_VERSION.tar.gz.asc\" \\\n && gpg --batch --verify yarn-v$YARN_VERSION.tar.gz.asc yarn-v$YARN_VERSION.tar.gz \\\n && mkdir -p /opt/yarn \\\n && tar -xzf yarn-v$YARN_VERSION.tar.gz -C /opt/yarn --strip-components=1 \\\n && ln -s /opt/yarn/bin/yarn /usr/local/bin/yarn \\\n && ln -s /opt/yarn/bin/yarn /usr/local/bin/yarnpkg \\\n && yarn global add bower \\\n && yarn cache clean \\\n && rm -rf yarn-v$YARN_VERSION.tar.gz.asc yarn-v$YARN_VERSION.tar.gz $HOME/.gnupg $HOME/.cache \\\n && apt-get remove -y curl \\\n && apt-get clean \\\n && apt-get autoremove -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && mkdir -p /code\nWORKDIR /code\nCOPY ./requirements.txt ./\nCOPY ./requirements/ ./requirements/\nCOPY ./addons/bitbucket/requirements.txt ./addons/bitbucket/\nCOPY ./addons/box/requirements.txt ./addons/box/\n#  COPY ./addons/citations/requirements.txt ./addons/citations/\nCOPY ./addons/dataverse/requirements.txt ./addons/dataverse/\nCOPY ./addons/dropbox/requirements.txt ./addons/dropbox/\n#  COPY ./addons/figshare/requirements.txt ./addons/figshare/\n#  COPY ./addons/forward/requirements.txt ./addons/forward/\nCOPY ./addons/github/requirements.txt ./addons/github/\nCOPY ./addons/gitlab/requirements.txt ./addons/gitlab/\n#  COPY ./addons/googledrive/requirements.txt ./addons/googledrive/\nCOPY ./addons/mendeley/requirements.txt ./addons/mendeley/\nCOPY ./addons/onedrive/requirements.txt /code/addons/onedrive/\n#  COPY ./addons/osfstorage/requirements.txt ./addons/osfstorage/\nCOPY ./addons/owncloud/requirements.txt ./addons/owncloud/\nCOPY ./addons/s3/requirements.txt ./addons/s3/\nCOPY ./addons/twofactor/requirements.txt ./addons/twofactor/\n#  COPY ./addons/wiki/requirements.txt ./addons/wiki/\nCOPY ./addons/zotero/requirements.txt ./addons/zotero/\nRUN for reqs_file in /code/requirements.txt /code/requirements/release.txt /code/addons/*/requirements.txt; do pip install /code/requirements/constraints.txt --no-cache-dir -c -r \"$reqs_file\" ; done \\\n && (pip uninstall uritemplate.py --yes || true ) \\\n && pip install uritemplate.py==0.3.0 --no-cache-dir \\\n && python -m compileall /usr/local/lib/python2.7 || true\n#   OSF: Assets\nCOPY ./.bowerrc ./bower.json ./\nRUN bower install --production --allow-root \\\n && bower cache clean --allow-root\nCOPY ./package.json ./.yarnrc ./yarn.lock ./\nRUN yarn install --frozen-lockfile \\\n && yarn cache clean\nCOPY ./tasks/ ./tasks/\nCOPY ./website/settings/ ./website/settings/\nCOPY ./api/base/settings/ ./api/base/settings/\nCOPY ./website/__init__.py ./website/__init__.py\nCOPY ./addons.json ./addons.json\nRUN mv ./website/settings/local-dist.py ./website/settings/local.py \\\n && mv ./api/base/settings/local-dist.py ./api/base/settings/local.py \\\n && sed 's/DEBUG_MODE = True/DEBUG_MODE = False/' -i ./website/settings/local.py\nCOPY ./webpack* ./\nCOPY ./website/static/ ./website/static/\nCOPY ./addons/bitbucket/static/ ./addons/bitbucket/static/\nCOPY ./addons/box/static/ ./addons/box/static/\nCOPY ./addons/citations/static/ ./addons/citations/static/\nCOPY ./addons/dataverse/static/ ./addons/dataverse/static/\nCOPY ./addons/dropbox/static/ ./addons/dropbox/static/\nCOPY ./addons/figshare/static/ ./addons/figshare/static/\nCOPY ./addons/forward/static/ ./addons/forward/static/\nCOPY ./addons/github/static/ ./addons/github/static/\nCOPY ./addons/gitlab/static/ ./addons/gitlab/static/\nCOPY ./addons/googledrive/static/ ./addons/googledrive/static/\nCOPY ./addons/mendeley/static/ ./addons/mendeley/static/\nCOPY ./addons/onedrive/static/ /code/addons/onedrive/static/\nCOPY ./addons/osfstorage/static/ ./addons/osfstorage/static/\nCOPY ./addons/owncloud/static/ ./addons/owncloud/static/\nCOPY ./addons/s3/static/ ./addons/s3/static/\nCOPY ./addons/twofactor/static/ ./addons/twofactor/static/\nCOPY ./addons/wiki/static/ ./addons/wiki/static/\nCOPY ./addons/zotero/static/ ./addons/zotero/static/\nRUN mkdir -p ./website/static/built/ \\\n && invoke build_js_config_files \\\n && yarn run webpack-prod\n#   /OSF: Assets\n#   Admin: Assets\nCOPY ./admin/.bowerrc ./admin/bower.json ./admin/\nRUN cd ./admin \\\n && bower install --production --allow-root \\\n && bower cache clean --allow-root\nCOPY ./admin/package.json ./admin/yarn.lock ./admin/\nRUN cd ./admin \\\n && yarn install --frozen-lockfile \\\n && yarn cache clean\nCOPY ./admin/webpack* ./admin/\nCOPY ./admin/static/ ./admin/static/\nRUN cd ./admin \\\n && yarn run webpack-prod\n#   /Admin: Assets\n#   Copy the rest of the code over\nCOPY ./ ./\nARG GIT_COMMIT\nENV GIT_COMMIT=\"${GIT_COMMIT}\"\nRUN for module in api.base.settings admin.base.settings; do export DJANGO_SETTINGS_MODULE=$module \\\n && python manage.py collectstatic --noinput --no-init-app ; done \\\n && for file in ./website/templates/_log_templates.mako ./website/static/built/nodeCategories.json; do touch $file \\\n && chmod o+w $file ; done \\\n && rm ./website/settings/local.py ./api/base/settings/local.py\nCMD [\"gosu\", \"nobody\", \"invoke\", \"--list\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM python:2.7-slim-stretch\nENV GOSU_VERSION=\"1.10\" \\\n    NODE_ENV=\"production\" \\\n    NODE_VERSION=\"8.6.0\" \\\n    YARN_VERSION=\"1.1.0\"\n#  Libraries such as matplotlib require a HOME directory for cache and configuration\nRUN set -ex \\\n && mkdir -p /var/www \\\n && chown www-data:www-data /var/www \\\n && apt-get update \\\n && apt-get install gnupg2 -y \\\n && for key in B42F6819007F00F88E364FD4036A9C25BF357DD4 9554F04D7259F04124DE6B476D5A82AC7E37093B 94AE36675C464D64BAFA68DD7434390BDBE9B9C5 FD3A5288F042B6850C66B31F09FE44734EB7990E 71DCFD284A79C3B38668286BC97EC7A07EDE3FC1 DD8F2338BAE7501E3DD5AC78C273792F7D83545D B9AE9905FFD7803F25714661B63B535A4C206CA9 C4F0DFFF4E8C1A8236409D08E73BC641CC11F4C8 56730D5401028683275BD23C23EFEFE93C4CFFFE 6A010C5166006599AA17F08146C2130DFD2497F5; do gpg --keyserver hkp://ipv4.pool.sks-keyservers.net:80 --recv-keys \"$key\" || gpg --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-keys \"$key\" || gpg --keyserver hkp://pgp.mit.edu:80 --recv-keys \"$key\" || gpg --keyserver hkp://keyserver.pgp.com:80 --recv-keys \"$key\" ; done \\\n && apt-get install git libev4 libev-dev libevent-dev libxml2-dev libxslt1-dev zlib1g-dev curl build-essential libssl-dev libffi-dev python-dev libpq-dev par2 -y \\\n && ARCH= \\\n && dpkgArch=\"$( dpkg --print-architecture ;)\" \\\n && case \"${dpkgArch##*-}\" in (amd64) ARCH='x64' ;;(ppc64el) ARCH='ppc64le' ;;(*) echo \"unsupported architecture\" ; exit 1 ;; esac \\\n && curl -o /usr/local/bin/gosu -SL \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" \\\n && curl -o /usr/local/bin/gosu.asc -SL \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" \\\n && gpg --verify /usr/local/bin/gosu.asc \\\n && rm /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && curl -SLO \"https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-$ARCH.tar.xz\" \\\n && curl -SLO --compressed \"https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc\" \\\n && gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \\\n && grep \" node-v$NODE_VERSION-linux-$ARCH.tar.xz$\" SHASUMS256.txt | sha256sum -c - \\\n && tar -xJf \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" -C /usr/local --strip-components=1 \\\n && rm \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" SHASUMS256.txt.asc SHASUMS256.txt \\\n && ln -s /usr/local/bin/node /usr/local/bin/nodejs \\\n && curl -fSLO --compressed \"https://yarnpkg.com/downloads/$YARN_VERSION/yarn-v$YARN_VERSION.tar.gz\" \\\n && curl -fSLO --compressed \"https://yarnpkg.com/downloads/$YARN_VERSION/yarn-v$YARN_VERSION.tar.gz.asc\" \\\n && gpg --batch --verify yarn-v$YARN_VERSION.tar.gz.asc yarn-v$YARN_VERSION.tar.gz \\\n && mkdir -p /opt/yarn \\\n && tar -xzf yarn-v$YARN_VERSION.tar.gz -C /opt/yarn --strip-components=1 \\\n && ln -s /opt/yarn/bin/yarn /usr/local/bin/yarn \\\n && ln -s /opt/yarn/bin/yarn /usr/local/bin/yarnpkg \\\n && yarn global add bower \\\n && yarn cache clean \\\n && rm -rf yarn-v$YARN_VERSION.tar.gz.asc yarn-v$YARN_VERSION.tar.gz $HOME/.gnupg $HOME/.cache \\\n && apt-get remove -y curl \\\n && apt-get clean \\\n && apt-get autoremove -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && mkdir -p /code\nWORKDIR /code\nCOPY ./requirements.txt ./\nCOPY ./requirements/ ./requirements/\nCOPY ./addons/bitbucket/requirements.txt ./addons/bitbucket/\nCOPY ./addons/box/requirements.txt ./addons/box/\n# COPY ./addons/citations/requirements.txt ./addons/citations/\nCOPY ./addons/dataverse/requirements.txt ./addons/dataverse/\nCOPY ./addons/dropbox/requirements.txt ./addons/dropbox/\n# COPY ./addons/figshare/requirements.txt ./addons/figshare/\n# COPY ./addons/forward/requirements.txt ./addons/forward/\nCOPY ./addons/github/requirements.txt ./addons/github/\nCOPY ./addons/gitlab/requirements.txt ./addons/gitlab/\n# COPY ./addons/googledrive/requirements.txt ./addons/googledrive/\nCOPY ./addons/mendeley/requirements.txt ./addons/mendeley/\nCOPY ./addons/onedrive/requirements.txt /code/addons/onedrive/\n# COPY ./addons/osfstorage/requirements.txt ./addons/osfstorage/\nCOPY ./addons/owncloud/requirements.txt ./addons/owncloud/\nCOPY ./addons/s3/requirements.txt ./addons/s3/\nCOPY ./addons/twofactor/requirements.txt ./addons/twofactor/\n# COPY ./addons/wiki/requirements.txt ./addons/wiki/\nCOPY ./addons/zotero/requirements.txt ./addons/zotero/\nRUN for reqs_file in /code/requirements.txt /code/requirements/release.txt /code/addons/*/requirements.txt; do pip install /code/requirements/constraints.txt --no-cache-dir -c -r \"$reqs_file\" ; done \\\n && (pip uninstall uritemplate.py --yes || true ) \\\n && pip install uritemplate.py==0.3.0 --no-cache-dir \\\n && python -m compileall /usr/local/lib/python2.7 || true\n#  OSF: Assets\nCOPY ./.bowerrc ./bower.json ./\nRUN bower install --production --allow-root \\\n && bower cache clean --allow-root\nCOPY ./package.json ./.yarnrc ./yarn.lock ./\nRUN yarn install --frozen-lockfile \\\n && yarn cache clean\nCOPY ./tasks/ ./tasks/\nCOPY ./website/settings/ ./website/settings/\nCOPY ./api/base/settings/ ./api/base/settings/\nCOPY ./website/__init__.py ./website/__init__.py\nCOPY ./addons.json ./addons.json\nRUN mv ./website/settings/local-dist.py ./website/settings/local.py \\\n && mv ./api/base/settings/local-dist.py ./api/base/settings/local.py \\\n && sed 's/DEBUG_MODE = True/DEBUG_MODE = False/' -i ./website/settings/local.py\nCOPY ./webpack* ./\nCOPY ./website/static/ ./website/static/\nCOPY ./addons/bitbucket/static/ ./addons/bitbucket/static/\nCOPY ./addons/box/static/ ./addons/box/static/\nCOPY ./addons/citations/static/ ./addons/citations/static/\nCOPY ./addons/dataverse/static/ ./addons/dataverse/static/\nCOPY ./addons/dropbox/static/ ./addons/dropbox/static/\nCOPY ./addons/figshare/static/ ./addons/figshare/static/\nCOPY ./addons/forward/static/ ./addons/forward/static/\nCOPY ./addons/github/static/ ./addons/github/static/\nCOPY ./addons/gitlab/static/ ./addons/gitlab/static/\nCOPY ./addons/googledrive/static/ ./addons/googledrive/static/\nCOPY ./addons/mendeley/static/ ./addons/mendeley/static/\nCOPY ./addons/onedrive/static/ /code/addons/onedrive/static/\nCOPY ./addons/osfstorage/static/ ./addons/osfstorage/static/\nCOPY ./addons/owncloud/static/ ./addons/owncloud/static/\nCOPY ./addons/s3/static/ ./addons/s3/static/\nCOPY ./addons/twofactor/static/ ./addons/twofactor/static/\nCOPY ./addons/wiki/static/ ./addons/wiki/static/\nCOPY ./addons/zotero/static/ ./addons/zotero/static/\nRUN mkdir -p ./website/static/built/ \\\n && invoke build_js_config_files \\\n && yarn run webpack-prod\n#  /OSF: Assets\n#  Admin: Assets\nCOPY ./admin/.bowerrc ./admin/bower.json ./admin/\nRUN cd ./admin \\\n && bower install --production --allow-root \\\n && bower cache clean --allow-root\nCOPY ./admin/package.json ./admin/yarn.lock ./admin/\nRUN cd ./admin \\\n && yarn install --frozen-lockfile \\\n && yarn cache clean\nCOPY ./admin/webpack* ./admin/\nCOPY ./admin/static/ ./admin/static/\nRUN cd ./admin \\\n && yarn run webpack-prod\n#  /Admin: Assets\n#  Copy the rest of the code over\nCOPY ./ ./\nARG GIT_COMMIT\nENV GIT_COMMIT=\"${GIT_COMMIT}\"\nRUN for module in api.base.settings admin.base.settings; do export DJANGO_SETTINGS_MODULE=$module \\\n && python manage.py collectstatic --noinput --no-init-app ; done \\\n && for file in ./website/templates/_log_templates.mako ./website/static/built/nodeCategories.json; do touch $file \\\n && chmod o+w $file ; done \\\n && rm ./website/settings/local.py ./api/base/settings/local.py\nCMD [\"gosu\", \"nobody\", \"invoke\", \"--list\"]\n","injectedSmells":[],"originalDockerfileHash":"9dece6794388f6240625c0a9f61800cd","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM python:2.7-slim-stretch\nENV GOSU_VERSION=\"1.10\" \\\n    NODE_ENV=\"production\" \\\n    NODE_VERSION=\"8.6.0\" \\\n    YARN_VERSION=\"1.1.0\"\n#   Libraries such as matplotlib require a HOME directory for cache and configuration\nRUN set -ex \\\n && mkdir -p /var/www \\\n && chown www-data:www-data /var/www \\\n && apt-get update \\\n && apt-get install gnupg2 -y \\\n && for key in B42F6819007F00F88E364FD4036A9C25BF357DD4 9554F04D7259F04124DE6B476D5A82AC7E37093B 94AE36675C464D64BAFA68DD7434390BDBE9B9C5 FD3A5288F042B6850C66B31F09FE44734EB7990E 71DCFD284A79C3B38668286BC97EC7A07EDE3FC1 DD8F2338BAE7501E3DD5AC78C273792F7D83545D B9AE9905FFD7803F25714661B63B535A4C206CA9 C4F0DFFF4E8C1A8236409D08E73BC641CC11F4C8 56730D5401028683275BD23C23EFEFE93C4CFFFE 6A010C5166006599AA17F08146C2130DFD2497F5; do gpg --keyserver hkp://ipv4.pool.sks-keyservers.net:80 --recv-keys \"$key\" || gpg --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-keys \"$key\" || gpg --keyserver hkp://pgp.mit.edu:80 --recv-keys \"$key\" || gpg --keyserver hkp://keyserver.pgp.com:80 --recv-keys \"$key\" ; done \\\n && apt-get install git libev4 libev-dev libevent-dev libxml2-dev libxslt1-dev zlib1g-dev curl build-essential libssl-dev libffi-dev python-dev libpq-dev par2 -y \\\n && ARCH= \\\n && dpkgArch=\"$( dpkg --print-architecture ;)\" \\\n && case \"${dpkgArch##*-}\" in (amd64) ARCH='x64' ;;(ppc64el) ARCH='ppc64le' ;;(*) echo \"unsupported architecture\" ; exit 1 ;; esac \\\n && curl -o /usr/local/bin/gosu -SL \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" \\\n && curl -o /usr/local/bin/gosu.asc -SL \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" \\\n && gpg --verify /usr/local/bin/gosu.asc \\\n && rm /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && curl -SLO \"https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-$ARCH.tar.xz\" \\\n && curl -SLO --compressed \"https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc\" \\\n && gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \\\n && grep \" node-v$NODE_VERSION-linux-$ARCH.tar.xz$\" SHASUMS256.txt | sha256sum -c - \\\n && tar -xJf \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" -C /usr/local --strip-components=1 \\\n && rm \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" SHASUMS256.txt.asc SHASUMS256.txt \\\n && ln -s /usr/local/bin/node /usr/local/bin/nodejs \\\n && curl -fSLO --compressed \"https://yarnpkg.com/downloads/$YARN_VERSION/yarn-v$YARN_VERSION.tar.gz\" \\\n && curl -fSLO --compressed \"https://yarnpkg.com/downloads/$YARN_VERSION/yarn-v$YARN_VERSION.tar.gz.asc\" \\\n && gpg --batch --verify yarn-v$YARN_VERSION.tar.gz.asc yarn-v$YARN_VERSION.tar.gz \\\n && mkdir -p /opt/yarn \\\n && tar -xzf yarn-v$YARN_VERSION.tar.gz -C /opt/yarn --strip-components=1 \\\n && ln -s /opt/yarn/bin/yarn /usr/local/bin/yarn \\\n && ln -s /opt/yarn/bin/yarn /usr/local/bin/yarnpkg \\\n && yarn global add bower \\\n && yarn cache clean \\\n && rm -rf yarn-v$YARN_VERSION.tar.gz.asc yarn-v$YARN_VERSION.tar.gz $HOME/.gnupg $HOME/.cache \\\n && apt-get remove -y curl \\\n && apt-get clean \\\n && apt-get autoremove -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && mkdir -p /code\nWORKDIR /code\nCOPY ./requirements.txt ./\nCOPY ./requirements/ ./requirements/\nCOPY ./addons/bitbucket/requirements.txt ./addons/bitbucket/\nCOPY ./addons/box/requirements.txt ./addons/box/\n#  COPY ./addons/citations/requirements.txt ./addons/citations/\nCOPY ./addons/dataverse/requirements.txt ./addons/dataverse/\nCOPY ./addons/dropbox/requirements.txt ./addons/dropbox/\n#  COPY ./addons/figshare/requirements.txt ./addons/figshare/\n#  COPY ./addons/forward/requirements.txt ./addons/forward/\nCOPY ./addons/github/requirements.txt ./addons/github/\nCOPY ./addons/gitlab/requirements.txt ./addons/gitlab/\n#  COPY ./addons/googledrive/requirements.txt ./addons/googledrive/\nCOPY ./addons/mendeley/requirements.txt ./addons/mendeley/\nCOPY ./addons/onedrive/requirements.txt /code/addons/onedrive/\n#  COPY ./addons/osfstorage/requirements.txt ./addons/osfstorage/\nCOPY ./addons/owncloud/requirements.txt ./addons/owncloud/\nCOPY ./addons/s3/requirements.txt ./addons/s3/\nCOPY ./addons/twofactor/requirements.txt ./addons/twofactor/\n#  COPY ./addons/wiki/requirements.txt ./addons/wiki/\nCOPY ./addons/zotero/requirements.txt ./addons/zotero/\nRUN for reqs_file in /code/requirements.txt /code/requirements/release.txt /code/addons/*/requirements.txt; do pip install /code/requirements/constraints.txt --no-cache-dir -c -r \"$reqs_file\" ; done \\\n && (pip uninstall uritemplate.py --yes || true ) \\\n && pip install uritemplate.py==0.3.0 --no-cache-dir \\\n && python -m compileall /usr/local/lib/python2.7 || true\n#   OSF: Assets\nCOPY ./.bowerrc ./bower.json ./\nRUN bower install --production --allow-root \\\n && bower cache clean --allow-root\nCOPY ./package.json ./.yarnrc ./yarn.lock ./\nRUN yarn install --frozen-lockfile \\\n && yarn cache clean\nCOPY ./tasks/ ./tasks/\nCOPY ./website/settings/ ./website/settings/\nCOPY ./api/base/settings/ ./api/base/settings/\nCOPY ./website/__init__.py ./website/__init__.py\nCOPY ./addons.json ./addons.json\nRUN mv ./website/settings/local-dist.py ./website/settings/local.py \\\n && mv ./api/base/settings/local-dist.py ./api/base/settings/local.py \\\n && sed 's/DEBUG_MODE = True/DEBUG_MODE = False/' -i ./website/settings/local.py\nCOPY ./webpack* ./\nCOPY ./website/static/ ./website/static/\nCOPY ./addons/bitbucket/static/ ./addons/bitbucket/static/\nCOPY ./addons/box/static/ ./addons/box/static/\nCOPY ./addons/citations/static/ ./addons/citations/static/\nCOPY ./addons/dataverse/static/ ./addons/dataverse/static/\nCOPY ./addons/dropbox/static/ ./addons/dropbox/static/\nCOPY ./addons/figshare/static/ ./addons/figshare/static/\nCOPY ./addons/forward/static/ ./addons/forward/static/\nCOPY ./addons/github/static/ ./addons/github/static/\nCOPY ./addons/gitlab/static/ ./addons/gitlab/static/\nCOPY ./addons/googledrive/static/ ./addons/googledrive/static/\nCOPY ./addons/mendeley/static/ ./addons/mendeley/static/\nCOPY ./addons/onedrive/static/ /code/addons/onedrive/static/\nCOPY ./addons/osfstorage/static/ ./addons/osfstorage/static/\nCOPY ./addons/owncloud/static/ ./addons/owncloud/static/\nCOPY ./addons/s3/static/ ./addons/s3/static/\nCOPY ./addons/twofactor/static/ ./addons/twofactor/static/\nCOPY ./addons/wiki/static/ ./addons/wiki/static/\nCOPY ./addons/zotero/static/ ./addons/zotero/static/\nRUN mkdir -p ./website/static/built/ \\\n && invoke build_js_config_files \\\n && yarn run webpack-prod\n#   /OSF: Assets\n#   Admin: Assets\nCOPY ./admin/.bowerrc ./admin/bower.json ./admin/\nRUN cd ./admin \\\n && bower install --production --allow-root \\\n && bower cache clean --allow-root\nCOPY ./admin/package.json ./admin/yarn.lock ./admin/\nRUN cd ./admin \\\n && yarn install --frozen-lockfile \\\n && yarn cache clean\nCOPY ./admin/webpack* ./admin/\nCOPY ./admin/static/ ./admin/static/\nRUN cd ./admin \\\n && yarn run webpack-prod\n#   /Admin: Assets\n#   Copy the rest of the code over\nCOPY ./ ./\nARG GIT_COMMIT\nENV GIT_COMMIT=\"${GIT_COMMIT}\"\nRUN for module in api.base.settings admin.base.settings; do export DJANGO_SETTINGS_MODULE=$module \\\n && python manage.py collectstatic --noinput --no-init-app ; done \\\n && for file in ./website/templates/_log_templates.mako ./website/static/built/nodeCategories.json; do touch $file \\\n && chmod o+w $file ; done \\\n && rm ./website/settings/local.py ./api/base/settings/local.py\nCMD [\"gosu\", \"nobody\", \"invoke\", \"--list\"]\n","originalDockerfileUglifiedHash":"66b49b46d594f1b411e51fe748252b45","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/63b11ab5427a11d2608ba60f148e089c763584a7.dockerfile"}