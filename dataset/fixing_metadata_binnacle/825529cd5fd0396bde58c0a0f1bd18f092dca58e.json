{"seed":3796060488,"processedDockerfileHash":"d975bdf7fadda672801eea7b9c18b9ba","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"#  #\n#  # Base builder image\n#  #\nFROM alpine:3.8 AS builder\nRUN apk add build-base=0.5-r1 automake=1.16.1-r0 autoconf=2.69-r2 libtool=2.4.6-r5 git=2.18.4-r0 linux-pam-dev=1.3.0-r0 openssl-dev=1.0.2u-r0 wget=1.20.3-r0 --update --virtual .build-deps\n#  #\n#  # Duo builder image\n#  #\nFROM builder AS duo-builder\nARG DUO_VERSION=1.10.5\nRUN wget https://dl.duosecurity.com/duo_unix-${DUO_VERSION}.tar.gz \\\n && mkdir -p src \\\n && tar -zxf duo_unix-${DUO_VERSION}.tar.gz --strip-components=1 -C src\nRUN cd src \\\n && ./configure --with-pam=/dist/lib64/security --prefix=/dist/usr \\\n && make \\\n && make install\n#  #\n#  # Google Authenticator PAM module builder image\n#  #\nFROM builder AS google-authenticator-libpam-builder\nARG AUTHENTICATOR_LIBPAM_VERSION=1.05\nRUN git clone --branch ${AUTHENTICATOR_LIBPAM_VERSION} --single-branch https://github.com/google/google-authenticator-libpam src\nRUN cd src \\\n && ./bootstrap.sh \\\n && ./configure --prefix=/dist \\\n && make \\\n && make install\n#  #\n#  # OpenSSH Portable builder image\n#  #\nFROM builder AS openssh-portable-builder\nARG OPENSSH_VERSION=V_7_8_P1\nRUN git clone --branch ${OPENSSH_VERSION} --single-branch https://github.com/openssh/openssh-portable src\nCOPY patches/ /patches/\nRUN cd src \\\n && find ../patches/openssh/** -type f -exec patch -p1 -i {}\n#  #\n#  # Bastion image\n#  #\nFROM alpine:3.8\nLABEL maintainer=\"erik@cloudposse.com\"\nUSER root\n#  # Install dependencies\nRUN apk add curl=7.61.1-r3 drill=1.7.0-r0 groff=1.22.3-r2 util-linux=2.32-r0 bash=4.4.19-r1 xauth=1.0.10-r1 gettext=0.19.8.1-r2 openssl-dev=1.0.2u-r0 shadow=4.5-r0 sudo=1.8.23-r4 --update \\\n && rm -rf /etc/ssh/ssh_host_*_key* \\\n && rm -f /usr/bin/ssh-agent \\\n && rm -f /usr/bin/ssh-keyscan \\\n && touch /var/log/lastlog \\\n && mkdir -p /var/run/sshd \\\n && mv /etc/profile.d/color_prompt /etc/profile.d/color_prompt.sh\n#  # Install sudosh\nENV SUDOSH_VERSION=\"0.1.3\"\nRUN wget https://github.com/cloudposse/sudosh/releases/download/${SUDOSH_VERSION}/sudosh_linux_386 -O /usr/bin/sudosh \\\n && chmod 755 /usr/bin/sudosh\n#  # Install Duo\nCOPY --from=duo-builder dist/ /\n#  # Install Google Authenticator PAM module\nCOPY --from=google-authenticator-libpam-builder dist/ /\n#  # Install OpenSSH Portable\nCOPY --from=openssh-portable-builder dist/ /\n#  # System\nENV TIMEZONE=\"Etc/UTC\" \\\n    TERM=\"xterm\" \\\n    HOSTNAME=\"bastion\"\nENV MFA_PROVIDER=\"duo\"\nENV UMASK=\"0022\"\n#  # Duo\nENV DUO_IKEY=\"\" \\\n    DUO_SKEY=\"\" \\\n    DUO_HOST=\"\" \\\n    DUO_FAILMODE=\"secure\" \\\n    DUO_AUTOPUSH=\"yes\" \\\n    DUO_PROMPTS=\"1\"\n#  # Enforcer\nENV ENFORCER_ENABLED=\"true\" \\\n    ENFORCER_CLEAN_HOME_ENABLED=\"true\"\n#  # Enable Rate Limiting\nENV RATE_LIMIT_ENABLED=\"true\"\n#  # Tolerate 5 consecutive fairues\nENV RATE_LIMIT_MAX_FAILURES=\"5\"\n#  # Lock accounts out for 300 seconds (5 minutes) after repeated failures\nENV RATE_LIMIT_LOCKOUT_TIME=\"300\"\n#  # Sleep N microseconds between failed attempts\nENV RATE_LIMIT_FAIL_DELAY=\"3000000\"\n#  # Slack\nENV SLACK_ENABLED=\"false\" \\\n    SLACK_HOOK=\"sshrc\" \\\n    SLACK_WEBHOOK_URL=\"\" \\\n    SLACK_USERNAME=\"\" \\\n    SLACK_TIMEOUT=\"2\" \\\n    SLACK_FATAL_ERRORS=\"true\"\n#  # SSH\nENV SSH_AUDIT_ENABLED=\"true\" \\\n    SSH_AUTHORIZED_KEYS_COMMAND=\"none\" \\\n    SSH_AUTHORIZED_KEYS_COMMAND_USER=\"nobody\"\nCOPY rootfs/ /\nEXPOSE 22/tcp\nENTRYPOINT [\"/init\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# #\n# # Base builder image\n# #\nFROM alpine:3.8 AS builder\nRUN apk --update add --virtual .build-deps build-base automake autoconf libtool git linux-pam-dev openssl-dev wget\n# #\n# # Duo builder image\n# #\nFROM builder AS duo-builder\nARG DUO_VERSION=1.10.5\nRUN wget https://dl.duosecurity.com/duo_unix-${DUO_VERSION}.tar.gz \\\n && mkdir -p src \\\n && tar -zxf duo_unix-${DUO_VERSION}.tar.gz --strip-components=1 -C src\nRUN cd src \\\n && ./configure --with-pam=/dist/lib64/security --prefix=/dist/usr \\\n && make \\\n && make install\n# #\n# # Google Authenticator PAM module builder image\n# #\nFROM builder AS google-authenticator-libpam-builder\nARG AUTHENTICATOR_LIBPAM_VERSION=1.05\nRUN git clone --branch ${AUTHENTICATOR_LIBPAM_VERSION} --single-branch https://github.com/google/google-authenticator-libpam src\nRUN cd src \\\n && ./bootstrap.sh \\\n && ./configure --prefix=/dist \\\n && make \\\n && make install\n# #\n# # OpenSSH Portable builder image\n# #\nFROM builder AS openssh-portable-builder\nARG OPENSSH_VERSION=V_7_8_P1\nRUN git clone --branch ${OPENSSH_VERSION} --single-branch https://github.com/openssh/openssh-portable src\nCOPY patches/ /patches/\nRUN cd src \\\n && find ../patches/openssh/** -type f -exec patch -p1 -i {} ; \\\n && autoreconf \\\n && ./configure --prefix=/dist/usr --sysconfdir=/etc/ssh --datadir=/dist/usr/share/openssh --libexecdir=/dist/usr/lib/ssh --mandir=/dist/usr/share/man --with-pid-dir=/run --with-mantype=man --with-privsep-path=/var/empty --with-privsep-user=sshd --with-md5-passwords --with-ssl-engine --disable-wtmp --with-pam=/dist/lib64/security \\\n && make \\\n && make install\n# #\n# # Bastion image\n# #\nFROM alpine:3.8\nLABEL maintainer=\"erik@cloudposse.com\"\nUSER root\n# # Install dependencies\nRUN apk --update add curl drill groff util-linux bash xauth gettext openssl-dev shadow sudo \\\n && rm -rf /etc/ssh/ssh_host_*_key* \\\n && rm -f /usr/bin/ssh-agent \\\n && rm -f /usr/bin/ssh-keyscan \\\n && touch /var/log/lastlog \\\n && mkdir -p /var/run/sshd \\\n && mv /etc/profile.d/color_prompt /etc/profile.d/color_prompt.sh\n# # Install sudosh\nENV SUDOSH_VERSION=\"0.1.3\"\nRUN wget https://github.com/cloudposse/sudosh/releases/download/${SUDOSH_VERSION}/sudosh_linux_386 -O /usr/bin/sudosh \\\n && chmod 755 /usr/bin/sudosh\n# # Install Duo\nCOPY --from=duo-builder dist/ /\n# # Install Google Authenticator PAM module\nCOPY --from=google-authenticator-libpam-builder dist/ /\n# # Install OpenSSH Portable\nCOPY --from=openssh-portable-builder dist/ /\n# # System\nENV TIMEZONE=\"Etc/UTC\" \\\n    TERM=\"xterm\" \\\n    HOSTNAME=\"bastion\"\nENV MFA_PROVIDER=\"duo\"\nENV UMASK=\"0022\"\n# # Duo\nENV DUO_IKEY=\"\" \\\n    DUO_SKEY=\"\" \\\n    DUO_HOST=\"\" \\\n    DUO_FAILMODE=\"secure\" \\\n    DUO_AUTOPUSH=\"yes\" \\\n    DUO_PROMPTS=\"1\"\n# # Enforcer\nENV ENFORCER_ENABLED=\"true\" \\\n    ENFORCER_CLEAN_HOME_ENABLED=\"true\"\n# # Enable Rate Limiting\nENV RATE_LIMIT_ENABLED=\"true\"\n# # Tolerate 5 consecutive fairues\nENV RATE_LIMIT_MAX_FAILURES=\"5\"\n# # Lock accounts out for 300 seconds (5 minutes) after repeated failures\nENV RATE_LIMIT_LOCKOUT_TIME=\"300\"\n# # Sleep N microseconds between failed attempts\nENV RATE_LIMIT_FAIL_DELAY=\"3000000\"\n# # Slack\nENV SLACK_ENABLED=\"false\" \\\n    SLACK_HOOK=\"sshrc\" \\\n    SLACK_WEBHOOK_URL=\"\" \\\n    SLACK_USERNAME=\"\" \\\n    SLACK_TIMEOUT=\"2\" \\\n    SLACK_FATAL_ERRORS=\"true\"\n# # SSH\nENV SSH_AUDIT_ENABLED=\"true\" \\\n    SSH_AUTHORIZED_KEYS_COMMAND=\"none\" \\\n    SSH_AUTHORIZED_KEYS_COMMAND_USER=\"nobody\"\nADD rootfs/ /\nEXPOSE 22/tcp\nENTRYPOINT [\"/init\"]\n","injectedSmells":[],"originalDockerfileHash":"6d4ba7872845aad468933493e2434948","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  #\n#  # Base builder image\n#  #\nFROM alpine:3.8 AS builder\nRUN apk --update add --virtual .build-deps build-base automake autoconf libtool git linux-pam-dev openssl-dev wget\n#  #\n#  # Duo builder image\n#  #\nFROM builder AS duo-builder\nARG DUO_VERSION=1.10.5\nRUN wget https://dl.duosecurity.com/duo_unix-${DUO_VERSION}.tar.gz \\\n && mkdir -p src \\\n && tar -zxf duo_unix-${DUO_VERSION}.tar.gz --strip-components=1 -C src\nRUN cd src \\\n && ./configure --with-pam=/dist/lib64/security --prefix=/dist/usr \\\n && make \\\n && make install\n#  #\n#  # Google Authenticator PAM module builder image\n#  #\nFROM builder AS google-authenticator-libpam-builder\nARG AUTHENTICATOR_LIBPAM_VERSION=1.05\nRUN git clone --branch ${AUTHENTICATOR_LIBPAM_VERSION} --single-branch https://github.com/google/google-authenticator-libpam src\nRUN cd src \\\n && ./bootstrap.sh \\\n && ./configure --prefix=/dist \\\n && make \\\n && make install\n#  #\n#  # OpenSSH Portable builder image\n#  #\nFROM builder AS openssh-portable-builder\nARG OPENSSH_VERSION=V_7_8_P1\nRUN git clone --branch ${OPENSSH_VERSION} --single-branch https://github.com/openssh/openssh-portable src\nCOPY patches/ /patches/\nRUN cd src \\\n && find ../patches/openssh/** -type f -exec patch -p1 -i {}\n#  #\n#  # Bastion image\n#  #\nFROM alpine:3.8\nLABEL maintainer=\"erik@cloudposse.com\"\nUSER root\n#  # Install dependencies\nRUN apk --update add curl drill groff util-linux bash xauth gettext openssl-dev shadow sudo \\\n && rm -rf /etc/ssh/ssh_host_*_key* \\\n && rm -f /usr/bin/ssh-agent \\\n && rm -f /usr/bin/ssh-keyscan \\\n && touch /var/log/lastlog \\\n && mkdir -p /var/run/sshd \\\n && mv /etc/profile.d/color_prompt /etc/profile.d/color_prompt.sh\n#  # Install sudosh\nENV SUDOSH_VERSION=\"0.1.3\"\nRUN wget https://github.com/cloudposse/sudosh/releases/download/${SUDOSH_VERSION}/sudosh_linux_386 -O /usr/bin/sudosh \\\n && chmod 755 /usr/bin/sudosh\n#  # Install Duo\nCOPY --from=duo-builder dist/ /\n#  # Install Google Authenticator PAM module\nCOPY --from=google-authenticator-libpam-builder dist/ /\n#  # Install OpenSSH Portable\nCOPY --from=openssh-portable-builder dist/ /\n#  # System\nENV TIMEZONE=\"Etc/UTC\" \\\n    TERM=\"xterm\" \\\n    HOSTNAME=\"bastion\"\nENV MFA_PROVIDER=\"duo\"\nENV UMASK=\"0022\"\n#  # Duo\nENV DUO_IKEY=\"\" \\\n    DUO_SKEY=\"\" \\\n    DUO_HOST=\"\" \\\n    DUO_FAILMODE=\"secure\" \\\n    DUO_AUTOPUSH=\"yes\" \\\n    DUO_PROMPTS=\"1\"\n#  # Enforcer\nENV ENFORCER_ENABLED=\"true\" \\\n    ENFORCER_CLEAN_HOME_ENABLED=\"true\"\n#  # Enable Rate Limiting\nENV RATE_LIMIT_ENABLED=\"true\"\n#  # Tolerate 5 consecutive fairues\nENV RATE_LIMIT_MAX_FAILURES=\"5\"\n#  # Lock accounts out for 300 seconds (5 minutes) after repeated failures\nENV RATE_LIMIT_LOCKOUT_TIME=\"300\"\n#  # Sleep N microseconds between failed attempts\nENV RATE_LIMIT_FAIL_DELAY=\"3000000\"\n#  # Slack\nENV SLACK_ENABLED=\"false\" \\\n    SLACK_HOOK=\"sshrc\" \\\n    SLACK_WEBHOOK_URL=\"\" \\\n    SLACK_USERNAME=\"\" \\\n    SLACK_TIMEOUT=\"2\" \\\n    SLACK_FATAL_ERRORS=\"true\"\n#  # SSH\nENV SSH_AUDIT_ENABLED=\"true\" \\\n    SSH_AUTHORIZED_KEYS_COMMAND=\"none\" \\\n    SSH_AUTHORIZED_KEYS_COMMAND_USER=\"nobody\"\nADD rootfs/ /\nEXPOSE 22/tcp\nENTRYPOINT [\"/init\"]\n","originalDockerfileUglifiedHash":"c3dc18d0301636200213014e57cd5b77","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/825529cd5fd0396bde58c0a0f1bd18f092dca58e.dockerfile"}