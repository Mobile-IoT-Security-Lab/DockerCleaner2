{"seed":2568819606,"processedDockerfileHash":"8bc2cc7e2ad6dfdf31c4f0b6d89229b6","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-npm","pin-package-manager-versions-gem","have-a-healthcheck","have-a-user"],"processedDockerfile":"#  #####################\n#  ## BASE (FIRST)\n#  ######################\nFROM quay.io/criticaljuncture/baseimage:16.04\n#  ######################\n#  ## RUBY\n#  ######################\nRUN apt-get update \\\n && (apt-get update ;apt-get install --no-install-recommends ruby2.2 ruby2.2-dev -y )\n#  ######################\n#  ## VARIOUS PACKAGES\n#  ######################\nRUN apt-get update \\\n && (apt-get update ;apt-get install --no-install-recommends libcurl4-openssl-dev libpcre3-dev git libmysqlclient-dev mysql-client secure-delete libqt4-dev libqtwebkit-dev -y ) \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/\n#   node js - packages are out of date\nRUN curl -sL https://deb.nodesource.com/setup_8.x | bash - \\\n && (apt-get update ;apt-get install --no-install-recommends nodejs -y ) \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/\n#   npm packages for testing\nRUN npm install jshint@2.13.6 -g\nRUN npm install coffeelint@2.1.0 -g\n#  #################\n#  ## TIMEZONE\n#  #################\nRUN ln -sf /usr/share/zoneinfo/US/Eastern /etc/localtime\n#  #################\n#  ## APP USER\n#  #################\nRUN adduser app -uid 1000 --system \\\n && usermod -a -G docker_env app\n#  ##############################\n#  ## GEMS & PASSENGER INSTALL\n#  ##############################\nRUN gem install bundler --version 2.4.12\nWORKDIR /tmp\nCOPY Gemfile /tmp/Gemfile\nCOPY Gemfile.lock /tmp/Gemfile.lock\nRUN bundle install --system --full-index \\\n && passenger-config install-standalone-runtime \\\n && passenger start --runtime-check-only\n#   docker cached layer build optimization:\n#   caches the latest security upgrade versions\n#   at the same time we're doing something else slow (changing the bundle)\n#   but something we do often enough that the final unattended upgrade at the\n#   end of this dockerfile isn't installing the entire world of security updates\n#   since we set up the dockerfile for the project\nRUN : \\\n && unattended-upgrade -d\nENV PASSENGER_MIN_INSTANCES=\"1\"\nENV WEB_PORT=\"3000\"\n#  #################\n#  ## SERVICES\n#  #################\nCOPY docker/web/my_init.d /etc/my_init.d\nCOPY docker/web/service /etc/service\n#  #################\n#  ## APP\n#  #################\nCOPY --chown=1000:1000 . /home/app/\nWORKDIR /home/app\nRUN DB_ADAPTER=nulldb DEVISE_SECRET_KEY=XXX AWS_ACCESS_KEY_ID=XXX AWS_SECRET_ACCESS_KEY=XXX RAILS_ENV=production bundle exec rake assets:precompile \\\n && chown -R app /home/app/public\n#   CI setup\nRUN mkdir log/test/ \\\n && touch log/test/vcr.log \\\n && chown -R app log\n#  #################\n#  ## BASE (LAST)\n#  #################\n#   ensure all packages are as up to date as possible\n#   installs all updates since we last bundled\nRUN : \\\n && unattended-upgrade -d\n#   set terminal\nENV TERM=\"linux\"\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# #####################\n# ## BASE (FIRST)\n# ######################\nFROM quay.io/criticaljuncture/baseimage:16.04\n# ######################\n# ## RUBY\n# ######################\nRUN apt-get update \\\n && apt-get install ruby2.2 ruby2.2-dev -y\n# ######################\n# ## VARIOUS PACKAGES\n# ######################\nRUN apt-get update \\\n && apt-get install libcurl4-openssl-dev libpcre3-dev git libmysqlclient-dev mysql-client secure-delete libqt4-dev libqtwebkit-dev -y \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/\n#  node js - packages are out of date\nRUN curl -sL https://deb.nodesource.com/setup_8.x | bash - \\\n && apt-get install nodejs -y \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/\n#  npm packages for testing\nRUN npm install jshint -g\nRUN npm install coffeelint -g\n# #################\n# ## TIMEZONE\n# #################\nRUN ln -sf /usr/share/zoneinfo/US/Eastern /etc/localtime\n# #################\n# ## APP USER\n# #################\nRUN adduser app -uid 1000 --system \\\n && usermod -a -G docker_env app\n# ##############################\n# ## GEMS & PASSENGER INSTALL\n# ##############################\nRUN gem install bundler\nWORKDIR /tmp\nCOPY Gemfile /tmp/Gemfile\nCOPY Gemfile.lock /tmp/Gemfile.lock\nRUN bundle install --system --full-index \\\n && passenger-config install-standalone-runtime \\\n && passenger start --runtime-check-only\n#  docker cached layer build optimization:\n#  caches the latest security upgrade versions\n#  at the same time we're doing something else slow (changing the bundle)\n#  but something we do often enough that the final unattended upgrade at the\n#  end of this dockerfile isn't installing the entire world of security updates\n#  since we set up the dockerfile for the project\nRUN apt-get update \\\n && unattended-upgrade -d\nENV PASSENGER_MIN_INSTANCES=\"1\"\nENV WEB_PORT=\"3000\"\n# #################\n# ## SERVICES\n# #################\nCOPY docker/web/my_init.d /etc/my_init.d\nCOPY docker/web/service /etc/service\n# #################\n# ## APP\n# #################\nCOPY --chown=1000:1000 . /home/app/\nWORKDIR /home/app\nRUN DB_ADAPTER=nulldb DEVISE_SECRET_KEY=XXX AWS_ACCESS_KEY_ID=XXX AWS_SECRET_ACCESS_KEY=XXX RAILS_ENV=production bundle exec rake assets:precompile \\\n && chown -R app /home/app/public\n#  CI setup\nRUN mkdir log/test/ \\\n && touch log/test/vcr.log \\\n && chown -R app log\n# #################\n# ## BASE (LAST)\n# #################\n#  ensure all packages are as up to date as possible\n#  installs all updates since we last bundled\nRUN apt-get update \\\n && unattended-upgrade -d\n#  set terminal\nENV TERM=\"linux\"\n","injectedSmells":[],"originalDockerfileHash":"9accb099a08add3b836f781d991d1396","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  #####################\n#  ## BASE (FIRST)\n#  ######################\nFROM quay.io/criticaljuncture/baseimage:16.04\n#  ######################\n#  ## RUBY\n#  ######################\nRUN apt-get update \\\n && apt-get install ruby2.2 ruby2.2-dev -y\n#  ######################\n#  ## VARIOUS PACKAGES\n#  ######################\nRUN apt-get update \\\n && apt-get install libcurl4-openssl-dev libpcre3-dev git libmysqlclient-dev mysql-client secure-delete libqt4-dev libqtwebkit-dev -y \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/\n#   node js - packages are out of date\nRUN curl -sL https://deb.nodesource.com/setup_8.x | bash - \\\n && apt-get install nodejs -y \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/\n#   npm packages for testing\nRUN npm install jshint -g\nRUN npm install coffeelint -g\n#  #################\n#  ## TIMEZONE\n#  #################\nRUN ln -sf /usr/share/zoneinfo/US/Eastern /etc/localtime\n#  #################\n#  ## APP USER\n#  #################\nRUN adduser app -uid 1000 --system \\\n && usermod -a -G docker_env app\n#  ##############################\n#  ## GEMS & PASSENGER INSTALL\n#  ##############################\nRUN gem install bundler\nWORKDIR /tmp\nCOPY Gemfile /tmp/Gemfile\nCOPY Gemfile.lock /tmp/Gemfile.lock\nRUN bundle install --system --full-index \\\n && passenger-config install-standalone-runtime \\\n && passenger start --runtime-check-only\n#   docker cached layer build optimization:\n#   caches the latest security upgrade versions\n#   at the same time we're doing something else slow (changing the bundle)\n#   but something we do often enough that the final unattended upgrade at the\n#   end of this dockerfile isn't installing the entire world of security updates\n#   since we set up the dockerfile for the project\nRUN apt-get update \\\n && unattended-upgrade -d\nENV PASSENGER_MIN_INSTANCES=\"1\"\nENV WEB_PORT=\"3000\"\n#  #################\n#  ## SERVICES\n#  #################\nCOPY docker/web/my_init.d /etc/my_init.d\nCOPY docker/web/service /etc/service\n#  #################\n#  ## APP\n#  #################\nCOPY --chown=1000:1000 . /home/app/\nWORKDIR /home/app\nRUN DB_ADAPTER=nulldb DEVISE_SECRET_KEY=XXX AWS_ACCESS_KEY_ID=XXX AWS_SECRET_ACCESS_KEY=XXX RAILS_ENV=production bundle exec rake assets:precompile \\\n && chown -R app /home/app/public\n#   CI setup\nRUN mkdir log/test/ \\\n && touch log/test/vcr.log \\\n && chown -R app log\n#  #################\n#  ## BASE (LAST)\n#  #################\n#   ensure all packages are as up to date as possible\n#   installs all updates since we last bundled\nRUN apt-get update \\\n && unattended-upgrade -d\n#   set terminal\nENV TERM=\"linux\"\n","originalDockerfileUglifiedHash":"d8723ffb40ef7005e859075fae3fc9eb","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/aff5239e96eef3674c8a389c37c86478b13138d8.dockerfile"}