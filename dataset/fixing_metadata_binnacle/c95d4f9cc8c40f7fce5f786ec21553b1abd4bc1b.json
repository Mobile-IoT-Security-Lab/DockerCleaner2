{"seed":2419670623,"processedDockerfileHash":"2200cf82909397ccf0315595225953ad","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"ARG FROMLIBERTY\nFROM maven:3.5.2-jdk-8-alpine AS builder\nARG ODMDOCKERDIR\nENV ODMDOCKERDIR=\"$ODMDOCKERDIR\"\nENV SCRIPT=\"/script\"\nENV APPS=\"/config/apps\"\nENV THIRDPARTY=\"/thirdpartylib\"\nRUN apk add ca-certificates wget --no-cache\nCOPY ${ODMDOCKERDIR}/decisioncenter/script $SCRIPT\nCOPY ${ODMDOCKERDIR}/standalone/script $SCRIPT\nCOPY ${ODMDOCKERDIR}/common/script $SCRIPT\nCOPY ${ODMDOCKERDIR}/common/features $SCRIPT\nCOPY ./executionserver/ /executionserver\n#   Loan Server Sample presence flag\nRUN if [ -d /executionserver/samples/rulesetexecution/loan-server ] ; then touch /use_loan_server ; fi\n#   Welcome page\nCOPY $ODMDOCKERDIR/welcomepage /welcomepage\nRUN if [ -f /use_loan_server ] ; then sed -i 's/ loan-server-hidden//g' /welcomepage/src/main/webapp/index.jsp ; fi\nRUN cd /welcomepage ; mvn clean install | grep -v 'Download.*'\nRUN mkdir -p /config/dbdata /config/resources \\\n && chmod -R 777 /config/dbdata /config/resources\n#  COPY ${ODMDOCKERDIR}/decisioncenter/config/application.xml /config/decisionrunner_application.xml\n#   Begin - Configuration for the database\n#   Install the driver for H2 and for PostgreSQL\nRUN wget -nv http://central.maven.org/maven2/com/h2database/h2/1.4.196/h2-1.4.196.jar \\\n && mv h2* /config/resources \\\n && wget -nv https://jdbc.postgresql.org/download/postgresql-42.2.1.jar \\\n && mv postgres* /config/resources\n#   End - Configuration for the database\nRUN chmod -R a+x $SCRIPT \\\n && mkdir $APPS\n#   Sample\nCOPY ${ODMDOCKERDIR}/standalone/samples/ /samples/build/\nRUN if [ -f /use_loan_server ] ; then sed -i 's/localhost:9090/localhost:9060/g' /executionserver/samples/rulesetexecution/loan-server/src/main/webapp/index.html \\\n && cd /samples/build ;mvn -Dxom.path=/samples/build/loan-validation-xom -Dloan.validation.server.path=/executionserver/samples/rulesetexecution/loan-server clean package | grep -v 'Download.*' \\\n && cp /samples/build/loan-server/target/odm-loan-server-1.0.war $APPS \\\n && $SCRIPT/extractApp.sh odm-loan-server-1.0.war ; fi\n#   Decision Center\nCOPY ./teamserver/applicationservers/WLP*/teamserver.war $APPS\nCOPY ./teamserver/applicationservers/WLP*/decision*.war $APPS/\nRUN $SCRIPT/extractApp.sh decisioncenter.war \\\n && $SCRIPT/extractApp.sh decisionmodel.war \\\n && $SCRIPT/extractApp.sh teamserver.war \\\n && $SCRIPT/extractApp.sh decisioncenter-api.war \\\n && mkdir -p $APPS/decisioncenter.war/WEB-INF/classes/config\nRUN $SCRIPT/changeParamValue.sh com.ibm.rules.decisioncenter.setup.configuration-file ./config/decisioncenter-configuration.properties /config/decisioncenter-configuration.properties $APPS/decisioncenter.war/WEB-INF/web.xml\nCOPY ${ODMDOCKERDIR}/standalone/config/group-security-configurations.xml $APPS/decisioncenter.war/WEB-INF/classes/config/group-security-configurations.xml\n#   Decision Server Console\nCOPY ./executionserver/applicationservers/WLP*/res.war $APPS\nRUN $SCRIPT/extractApp.sh res.war\nRUN $SCRIPT/changeParamValue.sh autoCreateSchema false true $APPS/res.war/WEB-INF/web.xml\n#   Decision Server Runtime\nCOPY ./executionserver/applicationservers/WLP*/DecisionService.war $APPS\nRUN $SCRIPT/extractApp.sh DecisionService.war\n#   Decision Runner\nCOPY ./executionserver/applicationservers/WLP*/DecisionRunner.war $APPS\nRUN $SCRIPT/extractApp.sh DecisionRunner.war\nRUN $SCRIPT/changeParamValue.sh ForceDatabaseTableCreation false true $APPS/DecisionRunner.war/WEB-INF/web.xml\n#   Sample DB\nCOPY ${ODMDOCKERDIR}/standalone/data-8.10.tar.gz /db810/\nCOPY ${ODMDOCKERDIR}/standalone/data-8.9.tar.gz /upload\n#   Default DB Version is 8.9 Since 8.10 there is a new DB sample with additional features.\nRUN $SCRIPT/loadFeatures.sh $SCRIPT \\\n && chmod -R 777 $APPS \\\n && chmod -R 777 /upload /db810 /config/dbdata\nFROM ${FROMLIBERTY}\nARG ODMDOCKERDIR\nARG ODMVERSION\nARG ODMDBVERSION\nLABEL maintainer=\"ODMDev odmdev_open_source_user@wwpdl.vnet.ibm.com\"\nMAINTAINER \"Laurent GRATEAU <laurent.grateau@fr.ibm.com>, ODMDev odmdev_open_source_user@wwpdl.vnet.ibm.com\"\nENV ODMDOCKERDIR=\"$ODMDOCKERDIR\"\nENV APP_NAME=\"StandaloneOdm\"\nENV SCRIPT=\"/script\"\nENV APPS=\"/config/apps\"\nCOPY --chown=1001:0 $ODMDOCKERDIR/standalone/licenses $APPS/licenses\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/decisioncenter/config/application-*.xml /config/\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/decisionserver/decisionrunner/config/application.xml /config/decisionrunner_application.xml\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/decisionserver/decisionserverconsole/config/application.xml /config/decisionserverconsole_application.xml\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/common/security/ltpa.keys /config/resources/security/ltpa.keys\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/common/security/keystore.jks /config/security/keystore.jks\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/common/security/truststore.jks /config/security/truststore.jks\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/standalone/config /config\nCOPY --chown=1001:0 --from=builder /config/dbdata /config\nENV CONNECTION_POOL_SIZE=\"20\"\n#   Sample DB\nCOPY --chown=1001:0 --from=builder /upload/* /upload/\n#   Welcome page\nCOPY --chown=1001:0 --from=builder /welcomepage/target/welcomepage.war $APPS\nCOPY --chown=1001:0 --from=builder /config/resources/postgres* /config/resources\nCOPY --chown=1001:0 --from=builder /config/resources/h2* /config/resources\nCOPY --chown=1001:0 --from=builder $APPS $APPS\nCOPY --chown=1001:0 --from=builder $SCRIPT $SCRIPT\n#   VOLUME [\"/config/dbdata/\"]\nEXPOSE 9060/tcp 9453/tcp\nENTRYPOINT [\"/script/runserver.sh\"]\nCMD [\"/script/runserver.sh\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"ARG FROMLIBERTY\nFROM maven:3.5.2-jdk-8-alpine AS builder\nARG ODMDOCKERDIR\nENV ODMDOCKERDIR=\"$ODMDOCKERDIR\"\nENV SCRIPT=\"/script\"\nENV APPS=\"/config/apps\"\nENV THIRDPARTY=\"/thirdpartylib\"\nRUN apk add --no-cache ca-certificates wget\nCOPY ${ODMDOCKERDIR}/decisioncenter/script $SCRIPT\nCOPY ${ODMDOCKERDIR}/standalone/script $SCRIPT\nCOPY ${ODMDOCKERDIR}/common/script $SCRIPT\nCOPY ${ODMDOCKERDIR}/common/features $SCRIPT\nCOPY ./executionserver/ /executionserver\n#  Loan Server Sample presence flag\nRUN if [ -d /executionserver/samples/rulesetexecution/loan-server ] ; then touch /use_loan_server ; fi\n#  Welcome page\nCOPY $ODMDOCKERDIR/welcomepage /welcomepage\nRUN if [ -f /use_loan_server ] ; then sed -i 's/ loan-server-hidden//g' /welcomepage/src/main/webapp/index.jsp ; fi\nRUN cd /welcomepage ; mvn clean install | grep -v 'Download.*'\nRUN mkdir -p /config/dbdata /config/resources \\\n && chmod -R 777 /config/dbdata /config/resources\n# COPY ${ODMDOCKERDIR}/decisioncenter/config/application.xml /config/decisionrunner_application.xml\n#  Begin - Configuration for the database\n#  Install the driver for H2 and for PostgreSQL\nRUN wget -nv http://central.maven.org/maven2/com/h2database/h2/1.4.196/h2-1.4.196.jar \\\n && mv h2* /config/resources \\\n && wget -nv https://jdbc.postgresql.org/download/postgresql-42.2.1.jar \\\n && mv postgres* /config/resources\n#  End - Configuration for the database\nRUN chmod -R a+x $SCRIPT \\\n && mkdir $APPS\n#  Sample\nCOPY ${ODMDOCKERDIR}/standalone/samples/ /samples/build/\nRUN if [ -f /use_loan_server ] ; then sed -i 's/localhost:9090/localhost:9060/g' /executionserver/samples/rulesetexecution/loan-server/src/main/webapp/index.html \\\n && cd /samples/build ;mvn -Dxom.path=/samples/build/loan-validation-xom -Dloan.validation.server.path=/executionserver/samples/rulesetexecution/loan-server clean package | grep -v 'Download.*' \\\n && cp /samples/build/loan-server/target/odm-loan-server-1.0.war $APPS \\\n && $SCRIPT/extractApp.sh odm-loan-server-1.0.war ; fi\n#  Decision Center\nCOPY ./teamserver/applicationservers/WLP*/teamserver.war $APPS\nCOPY ./teamserver/applicationservers/WLP*/decision*.war $APPS/\nRUN $SCRIPT/extractApp.sh decisioncenter.war \\\n && $SCRIPT/extractApp.sh decisionmodel.war \\\n && $SCRIPT/extractApp.sh teamserver.war \\\n && $SCRIPT/extractApp.sh decisioncenter-api.war \\\n && mkdir -p $APPS/decisioncenter.war/WEB-INF/classes/config\nRUN $SCRIPT/changeParamValue.sh com.ibm.rules.decisioncenter.setup.configuration-file .\\/config\\/decisioncenter-configuration.properties \\/config\\/decisioncenter-configuration.properties $APPS/decisioncenter.war/WEB-INF/web.xml\nCOPY ${ODMDOCKERDIR}/standalone/config/group-security-configurations.xml $APPS/decisioncenter.war/WEB-INF/classes/config/group-security-configurations.xml\n#  Decision Server Console\nCOPY ./executionserver/applicationservers/WLP*/res.war $APPS\nRUN $SCRIPT/extractApp.sh res.war\nRUN $SCRIPT/changeParamValue.sh autoCreateSchema false true $APPS/res.war/WEB-INF/web.xml\n#  Decision Server Runtime\nCOPY ./executionserver/applicationservers/WLP*/DecisionService.war $APPS\nRUN $SCRIPT/extractApp.sh DecisionService.war\n#  Decision Runner\nCOPY ./executionserver/applicationservers/WLP*/DecisionRunner.war $APPS\nRUN $SCRIPT/extractApp.sh DecisionRunner.war\nRUN $SCRIPT/changeParamValue.sh ForceDatabaseTableCreation false true $APPS/DecisionRunner.war/WEB-INF/web.xml\n#  Sample DB\nADD ${ODMDOCKERDIR}/standalone/data-8.10.tar.gz /db810/\nADD ${ODMDOCKERDIR}/standalone/data-8.9.tar.gz /upload\n#  Default DB Version is 8.9 Since 8.10 there is a new DB sample with additional features.\nRUN $SCRIPT/loadFeatures.sh $SCRIPT \\\n && chmod -R 777 $APPS \\\n && chmod -R 777 /upload /db810 /config/dbdata\nFROM ${FROMLIBERTY}\nARG ODMDOCKERDIR\nARG ODMVERSION\nARG ODMDBVERSION\nLABEL maintainer=\"ODMDev odmdev_open_source_user@wwpdl.vnet.ibm.com\"\nMAINTAINER \"Laurent GRATEAU <laurent.grateau@fr.ibm.com>, ODMDev odmdev_open_source_user@wwpdl.vnet.ibm.com\"\nENV ODMDOCKERDIR=\"$ODMDOCKERDIR\"\nENV APP_NAME=\"StandaloneOdm\"\nENV SCRIPT=\"/script\"\nENV APPS=\"/config/apps\"\nCOPY --chown=1001:0 $ODMDOCKERDIR/standalone/licenses $APPS/licenses\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/decisioncenter/config/application-*.xml /config/\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/decisionserver/decisionrunner/config/application.xml /config/decisionrunner_application.xml\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/decisionserver/decisionserverconsole/config/application.xml /config/decisionserverconsole_application.xml\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/common/security/ltpa.keys /config/resources/security/ltpa.keys\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/common/security/keystore.jks /config/security/keystore.jks\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/common/security/truststore.jks /config/security/truststore.jks\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/standalone/config /config\nCOPY --chown=1001:0 --from=builder /config/dbdata /config\nENV CONNECTION_POOL_SIZE=\"20\"\n#  Sample DB\nCOPY --chown=1001:0 --from=builder /upload/* /upload/\n#  Welcome page\nCOPY --chown=1001:0 --from=builder /welcomepage/target/welcomepage.war $APPS\nCOPY --chown=1001:0 --from=builder /config/resources/postgres* /config/resources\nCOPY --chown=1001:0 --from=builder /config/resources/h2* /config/resources\nCOPY --chown=1001:0 --from=builder $APPS $APPS\nCOPY --chown=1001:0 --from=builder $SCRIPT $SCRIPT\n#  VOLUME [\"/config/dbdata/\"]\nEXPOSE 9060/tcp 9453/tcp\nENTRYPOINT [\"/script/runserver.sh\"]\nCMD [\"/script/runserver.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"3bfda6b1d6f389f903856b2090393e5f","successfullyInjectedSmells":[],"originalDockerfileUglified":"ARG FROMLIBERTY\nFROM maven:3.5.2-jdk-8-alpine AS builder\nARG ODMDOCKERDIR\nENV ODMDOCKERDIR=\"$ODMDOCKERDIR\"\nENV SCRIPT=\"/script\"\nENV APPS=\"/config/apps\"\nENV THIRDPARTY=\"/thirdpartylib\"\nRUN apk add --no-cache ca-certificates wget\nCOPY ${ODMDOCKERDIR}/decisioncenter/script $SCRIPT\nCOPY ${ODMDOCKERDIR}/standalone/script $SCRIPT\nCOPY ${ODMDOCKERDIR}/common/script $SCRIPT\nCOPY ${ODMDOCKERDIR}/common/features $SCRIPT\nCOPY ./executionserver/ /executionserver\n#   Loan Server Sample presence flag\nRUN if [ -d /executionserver/samples/rulesetexecution/loan-server ] ; then touch /use_loan_server ; fi\n#   Welcome page\nCOPY $ODMDOCKERDIR/welcomepage /welcomepage\nRUN if [ -f /use_loan_server ] ; then sed -i 's/ loan-server-hidden//g' /welcomepage/src/main/webapp/index.jsp ; fi\nRUN cd /welcomepage ; mvn clean install | grep -v 'Download.*'\nRUN mkdir -p /config/dbdata /config/resources \\\n && chmod -R 777 /config/dbdata /config/resources\n#  COPY ${ODMDOCKERDIR}/decisioncenter/config/application.xml /config/decisionrunner_application.xml\n#   Begin - Configuration for the database\n#   Install the driver for H2 and for PostgreSQL\nRUN wget -nv http://central.maven.org/maven2/com/h2database/h2/1.4.196/h2-1.4.196.jar \\\n && mv h2* /config/resources \\\n && wget -nv https://jdbc.postgresql.org/download/postgresql-42.2.1.jar \\\n && mv postgres* /config/resources\n#   End - Configuration for the database\nRUN chmod -R a+x $SCRIPT \\\n && mkdir $APPS\n#   Sample\nCOPY ${ODMDOCKERDIR}/standalone/samples/ /samples/build/\nRUN if [ -f /use_loan_server ] ; then sed -i 's/localhost:9090/localhost:9060/g' /executionserver/samples/rulesetexecution/loan-server/src/main/webapp/index.html \\\n && cd /samples/build ;mvn -Dxom.path=/samples/build/loan-validation-xom -Dloan.validation.server.path=/executionserver/samples/rulesetexecution/loan-server clean package | grep -v 'Download.*' \\\n && cp /samples/build/loan-server/target/odm-loan-server-1.0.war $APPS \\\n && $SCRIPT/extractApp.sh odm-loan-server-1.0.war ; fi\n#   Decision Center\nCOPY ./teamserver/applicationservers/WLP*/teamserver.war $APPS\nCOPY ./teamserver/applicationservers/WLP*/decision*.war $APPS/\nRUN $SCRIPT/extractApp.sh decisioncenter.war \\\n && $SCRIPT/extractApp.sh decisionmodel.war \\\n && $SCRIPT/extractApp.sh teamserver.war \\\n && $SCRIPT/extractApp.sh decisioncenter-api.war \\\n && mkdir -p $APPS/decisioncenter.war/WEB-INF/classes/config\nRUN $SCRIPT/changeParamValue.sh com.ibm.rules.decisioncenter.setup.configuration-file ./config/decisioncenter-configuration.properties /config/decisioncenter-configuration.properties $APPS/decisioncenter.war/WEB-INF/web.xml\nCOPY ${ODMDOCKERDIR}/standalone/config/group-security-configurations.xml $APPS/decisioncenter.war/WEB-INF/classes/config/group-security-configurations.xml\n#   Decision Server Console\nCOPY ./executionserver/applicationservers/WLP*/res.war $APPS\nRUN $SCRIPT/extractApp.sh res.war\nRUN $SCRIPT/changeParamValue.sh autoCreateSchema false true $APPS/res.war/WEB-INF/web.xml\n#   Decision Server Runtime\nCOPY ./executionserver/applicationservers/WLP*/DecisionService.war $APPS\nRUN $SCRIPT/extractApp.sh DecisionService.war\n#   Decision Runner\nCOPY ./executionserver/applicationservers/WLP*/DecisionRunner.war $APPS\nRUN $SCRIPT/extractApp.sh DecisionRunner.war\nRUN $SCRIPT/changeParamValue.sh ForceDatabaseTableCreation false true $APPS/DecisionRunner.war/WEB-INF/web.xml\n#   Sample DB\nADD ${ODMDOCKERDIR}/standalone/data-8.10.tar.gz /db810/\nADD ${ODMDOCKERDIR}/standalone/data-8.9.tar.gz /upload\n#   Default DB Version is 8.9 Since 8.10 there is a new DB sample with additional features.\nRUN $SCRIPT/loadFeatures.sh $SCRIPT \\\n && chmod -R 777 $APPS \\\n && chmod -R 777 /upload /db810 /config/dbdata\nFROM ${FROMLIBERTY}\nARG ODMDOCKERDIR\nARG ODMVERSION\nARG ODMDBVERSION\nLABEL maintainer=\"ODMDev odmdev_open_source_user@wwpdl.vnet.ibm.com\"\nMAINTAINER \"Laurent GRATEAU <laurent.grateau@fr.ibm.com>, ODMDev odmdev_open_source_user@wwpdl.vnet.ibm.com\"\nENV ODMDOCKERDIR=\"$ODMDOCKERDIR\"\nENV APP_NAME=\"StandaloneOdm\"\nENV SCRIPT=\"/script\"\nENV APPS=\"/config/apps\"\nCOPY --chown=1001:0 $ODMDOCKERDIR/standalone/licenses $APPS/licenses\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/decisioncenter/config/application-*.xml /config/\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/decisionserver/decisionrunner/config/application.xml /config/decisionrunner_application.xml\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/decisionserver/decisionserverconsole/config/application.xml /config/decisionserverconsole_application.xml\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/common/security/ltpa.keys /config/resources/security/ltpa.keys\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/common/security/keystore.jks /config/security/keystore.jks\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/common/security/truststore.jks /config/security/truststore.jks\nCOPY --chown=1001:0 ${ODMDOCKERDIR}/standalone/config /config\nCOPY --chown=1001:0 --from=builder /config/dbdata /config\nENV CONNECTION_POOL_SIZE=\"20\"\n#   Sample DB\nCOPY --chown=1001:0 --from=builder /upload/* /upload/\n#   Welcome page\nCOPY --chown=1001:0 --from=builder /welcomepage/target/welcomepage.war $APPS\nCOPY --chown=1001:0 --from=builder /config/resources/postgres* /config/resources\nCOPY --chown=1001:0 --from=builder /config/resources/h2* /config/resources\nCOPY --chown=1001:0 --from=builder $APPS $APPS\nCOPY --chown=1001:0 --from=builder $SCRIPT $SCRIPT\n#   VOLUME [\"/config/dbdata/\"]\nEXPOSE 9060/tcp 9453/tcp\nENTRYPOINT [\"/script/runserver.sh\"]\nCMD [\"/script/runserver.sh\"]\n","originalDockerfileUglifiedHash":"377d11699f5d5e5f130f2d2c57a00b59","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/c95d4f9cc8c40f7fce5f786ec21553b1abd4bc1b.dockerfile"}