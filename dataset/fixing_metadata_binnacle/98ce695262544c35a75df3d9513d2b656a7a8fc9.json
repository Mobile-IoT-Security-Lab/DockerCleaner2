{"seed":1348285297,"processedDockerfileHash":"f9688dca9758ea44e1d9266ac22ada38","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends"],"processedDockerfile":"#   -------------------------------------------------------------------------------------------------\n#\n#   layer for download and verifying\nFROM debian:stretch-slim AS graylog-downloader\nARG VCS_REF\nARG GRAYLOG_VERSION\nWORKDIR /tmp\n#   hadolint ignore=DL3008,DL3009,DL3014,DL3015\nRUN apt-get update > /dev/null \\\n && apt-get install --no-install-recommends ca-certificates curl --assume-yes > /dev/null\nRUN curl --silent --location --retry 3 --output \"/tmp/graylog-${GRAYLOG_VERSION}.tgz\" \"https://packages.graylog2.org/releases/graylog/graylog-${GRAYLOG_VERSION}.tgz\"\nRUN curl --silent --location --retry 3 --output \"/tmp/graylog-${GRAYLOG_VERSION}.tgz.sha256.txt\" \"https://packages.graylog2.org/releases/graylog/graylog-${GRAYLOG_VERSION}.tgz.sha256.txt\"\nRUN sha256sum --check \"graylog-${GRAYLOG_VERSION}.tgz.sha256.txt\"\nRUN mkdir /opt/graylog \\\n && tar --extract --gzip --file \"/tmp/graylog-${GRAYLOG_VERSION}.tgz\" --strip-components=1 --directory /opt/graylog\nRUN install --directory --mode=0750 /opt/graylog/data /opt/graylog/data/journal /opt/graylog/data/log /opt/graylog/data/config /opt/graylog/data/plugin /opt/graylog/data/data\n#   -------------------------------------------------------------------------------------------------\n#\n#   final layer\n#   use the smallest debain with headless openjdk and copying files from download layers\nFROM openjdk:8-jre-slim\nARG VCS_REF\nARG GRAYLOG_VERSION\nARG BUILD_DATE\nARG GRAYLOG_HOME=/usr/share/graylog\nARG GRAYLOG_USER=graylog\nARG GRAYLOG_UID=1100\nARG GRAYLOG_GROUP=graylog\nARG GRAYLOG_GID=1100\n#   hadolint ignore=DL3023\nCOPY --from=graylog-downloader /opt/graylog ${GRAYLOG_HOME}\nCOPY config ${GRAYLOG_HOME}/data/config\nWORKDIR ${GRAYLOG_HOME}\n#   hadolint ignore=DL3008,DL3014,SC2086\nRUN echo \"export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64/jre\" > /etc/profile.d/graylog.sh \\\n && echo \"export BUILD_DATE=${BUILD_DATE}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_VERSION=${GRAYLOG_VERSION}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_SERVER_JAVA_OPTS='-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:NewRatio=1 -XX:MaxMetaspaceSize=256m -server -XX:+ResizeTLAB -XX:+UseConcMarkSweepGC -XX:+CMSConcurrentMTEnabled -XX:+CMSClassUnloadingEnabled -XX:+UseParNewGC -XX:-OmitStackTraceInFastThrow'\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_HOME=${GRAYLOG_HOME}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_USER=${GRAYLOG_USER}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_GROUP=${GRAYLOG_GROUP}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_UID=${GRAYLOG_UID}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_GID=${GRAYLOG_GID}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export PATH=${GRAYLOG_HOME}/bin:${PATH}\" >> /etc/profile.d/graylog.sh \\\n && apt-get update > /dev/null \\\n && apt-get install --no-install-recommends curl libcap2-bin libglib2.0-0 fontconfig --assume-yes > /dev/null \\\n && addgroup --gid \"${GRAYLOG_GID}\" --quiet \"${GRAYLOG_GROUP}\" \\\n && adduser --disabled-password --disabled-login --gecos '' --home ${GRAYLOG_HOME} --uid \"${GRAYLOG_UID}\" --gid \"${GRAYLOG_GID}\" --quiet \"${GRAYLOG_USER}\" \\\n && chown --recursive \"${GRAYLOG_USER}\":\"${GRAYLOG_GROUP}\" ${GRAYLOG_HOME} \\\n && setcap 'cap_net_bind_service=+ep' \"${JAVA_HOME}/bin/java\" \\\n && apt-get remove --assume-yes --purge apt-utils > /dev/null \\\n && rm -f /etc/apt/sources.list.d/* \\\n && apt-get clean > /dev/null \\\n && apt-get autoremove --assume-yes > /dev/null \\\n && rm -rf /tmp/* /var/cache/debconf/* /var/lib/apt/lists/* /var/log/* /usr/share/X11 /usr/share/doc/* 2> /dev/null\nCOPY docker-entrypoint.sh /\nCOPY health_check.sh /\nEXPOSE 9000/tcp\nUSER ${GRAYLOG_USER}\nVOLUME ${GRAYLOG_HOME}/data\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nCMD [\"graylog\"]\n#   add healthcheck\nHEALTHCHECK --interval=10s --timeout=2s --retries=12 CMD /health_check.sh\n#   -------------------------------------------------------------------------------------------------\nLABEL maintainer=\"Graylog, Inc. <hello@graylog.com>\" \\\n      org.label-schema.name=\"Graylog Docker Image\" \\\n      org.label-schema.description=\"Official Graylog Docker image\" \\\n      org.label-schema.url=\"https://www.graylog.org/\" \\\n      org.label-schema.vcs-ref=\"${VCS_REF}\" \\\n      org.label-schema.vcs-url=\"https://github.com/Graylog2/graylog-docker\" \\\n      org.label-schema.vendor=\"Graylog, Inc.\" \\\n      org.label-schema.version=\"${GRAYLOG_VERSION}\" \\\n      org.label-schema.schema-version=\"1.0\" \\\n      org.label-schema.build-date=\"${BUILD_DATE}\" \\\n      com.microscaling.docker.dockerfile=\"/Dockerfile\" \\\n      com.microscaling.license=\"Apache 2.0\"\n","originalDockerfile":"#  -------------------------------------------------------------------------------------------------\n#\n#  layer for download and verifying\nFROM debian:stretch-slim AS graylog-downloader\nARG VCS_REF\nARG GRAYLOG_VERSION\nWORKDIR /tmp\n#  hadolint ignore=DL3008,DL3009,DL3014,DL3015\nRUN apt-get update > /dev/null \\\n && apt-get install ca-certificates curl --assume-yes > /dev/null\nRUN curl --silent --location --retry 3 --output \"/tmp/graylog-${GRAYLOG_VERSION}.tgz\" \"https://packages.graylog2.org/releases/graylog/graylog-${GRAYLOG_VERSION}.tgz\"\nRUN curl --silent --location --retry 3 --output \"/tmp/graylog-${GRAYLOG_VERSION}.tgz.sha256.txt\" \"https://packages.graylog2.org/releases/graylog/graylog-${GRAYLOG_VERSION}.tgz.sha256.txt\"\nRUN sha256sum --check \"graylog-${GRAYLOG_VERSION}.tgz.sha256.txt\"\nRUN mkdir /opt/graylog \\\n && tar --extract --gzip --file \"/tmp/graylog-${GRAYLOG_VERSION}.tgz\" --strip-components=1 --directory /opt/graylog\nRUN install --directory --mode=0750 /opt/graylog/data /opt/graylog/data/journal /opt/graylog/data/log /opt/graylog/data/config /opt/graylog/data/plugin /opt/graylog/data/data\n#  -------------------------------------------------------------------------------------------------\n#\n#  final layer\n#  use the smallest debain with headless openjdk and copying files from download layers\nFROM openjdk:8-jre-slim\nARG VCS_REF\nARG GRAYLOG_VERSION\nARG BUILD_DATE\nARG GRAYLOG_HOME=/usr/share/graylog\nARG GRAYLOG_USER=graylog\nARG GRAYLOG_UID=1100\nARG GRAYLOG_GROUP=graylog\nARG GRAYLOG_GID=1100\n#  hadolint ignore=DL3023\nCOPY --from=graylog-downloader /opt/graylog ${GRAYLOG_HOME}\nCOPY config ${GRAYLOG_HOME}/data/config\nWORKDIR ${GRAYLOG_HOME}\n#  hadolint ignore=DL3008,DL3014,SC2086\nRUN echo \"export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64/jre\" > /etc/profile.d/graylog.sh \\\n && echo \"export BUILD_DATE=${BUILD_DATE}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_VERSION=${GRAYLOG_VERSION}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_SERVER_JAVA_OPTS='-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:NewRatio=1 -XX:MaxMetaspaceSize=256m -server -XX:+ResizeTLAB -XX:+UseConcMarkSweepGC -XX:+CMSConcurrentMTEnabled -XX:+CMSClassUnloadingEnabled -XX:+UseParNewGC -XX:-OmitStackTraceInFastThrow'\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_HOME=${GRAYLOG_HOME}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_USER=${GRAYLOG_USER}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_GROUP=${GRAYLOG_GROUP}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_UID=${GRAYLOG_UID}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_GID=${GRAYLOG_GID}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export PATH=${GRAYLOG_HOME}/bin:${PATH}\" >> /etc/profile.d/graylog.sh \\\n && apt-get update > /dev/null \\\n && apt-get install --no-install-recommends curl libcap2-bin libglib2.0-0 fontconfig --assume-yes > /dev/null \\\n && addgroup --gid \"${GRAYLOG_GID}\" --quiet \"${GRAYLOG_GROUP}\" \\\n && adduser --disabled-password --disabled-login --gecos '' --home ${GRAYLOG_HOME} --uid \"${GRAYLOG_UID}\" --gid \"${GRAYLOG_GID}\" --quiet \"${GRAYLOG_USER}\" \\\n && chown --recursive \"${GRAYLOG_USER}\":\"${GRAYLOG_GROUP}\" ${GRAYLOG_HOME} \\\n && setcap 'cap_net_bind_service=+ep' \"${JAVA_HOME}/bin/java\" \\\n && apt-get remove --assume-yes --purge apt-utils > /dev/null \\\n && rm -f /etc/apt/sources.list.d/* \\\n && apt-get clean > /dev/null \\\n && apt-get autoremove --assume-yes > /dev/null \\\n && rm -rf /tmp/* /var/cache/debconf/* /var/lib/apt/lists/* /var/log/* /usr/share/X11 /usr/share/doc/* 2> /dev/null\nCOPY docker-entrypoint.sh /\nCOPY health_check.sh /\nEXPOSE 9000/tcp\nUSER ${GRAYLOG_USER}\nVOLUME ${GRAYLOG_HOME}/data\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nCMD [\"graylog\"]\n#  add healthcheck\nHEALTHCHECK --interval=10s --timeout=2s --retries=12 CMD /health_check.sh\n#  -------------------------------------------------------------------------------------------------\nLABEL maintainer=\"Graylog, Inc. <hello@graylog.com>\" \\\n      org.label-schema.name=\"Graylog Docker Image\" \\\n      org.label-schema.description=\"Official Graylog Docker image\" \\\n      org.label-schema.url=\"https://www.graylog.org/\" \\\n      org.label-schema.vcs-ref=\"${VCS_REF}\" \\\n      org.label-schema.vcs-url=\"https://github.com/Graylog2/graylog-docker\" \\\n      org.label-schema.vendor=\"Graylog, Inc.\" \\\n      org.label-schema.version=\"${GRAYLOG_VERSION}\" \\\n      org.label-schema.schema-version=\"1.0\" \\\n      org.label-schema.build-date=\"${BUILD_DATE}\" \\\n      com.microscaling.docker.dockerfile=\"/Dockerfile\" \\\n      com.microscaling.license=\"Apache 2.0\"\n","injectedSmells":[],"originalDockerfileHash":"9009da88823ead12f703c643505d3371","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   -------------------------------------------------------------------------------------------------\n#\n#   layer for download and verifying\nFROM debian:stretch-slim AS graylog-downloader\nARG VCS_REF\nARG GRAYLOG_VERSION\nWORKDIR /tmp\n#   hadolint ignore=DL3008,DL3009,DL3014,DL3015\nRUN apt-get update > /dev/null \\\n && apt-get install ca-certificates curl --assume-yes > /dev/null\nRUN curl --silent --location --retry 3 --output \"/tmp/graylog-${GRAYLOG_VERSION}.tgz\" \"https://packages.graylog2.org/releases/graylog/graylog-${GRAYLOG_VERSION}.tgz\"\nRUN curl --silent --location --retry 3 --output \"/tmp/graylog-${GRAYLOG_VERSION}.tgz.sha256.txt\" \"https://packages.graylog2.org/releases/graylog/graylog-${GRAYLOG_VERSION}.tgz.sha256.txt\"\nRUN sha256sum --check \"graylog-${GRAYLOG_VERSION}.tgz.sha256.txt\"\nRUN mkdir /opt/graylog \\\n && tar --extract --gzip --file \"/tmp/graylog-${GRAYLOG_VERSION}.tgz\" --strip-components=1 --directory /opt/graylog\nRUN install --directory --mode=0750 /opt/graylog/data /opt/graylog/data/journal /opt/graylog/data/log /opt/graylog/data/config /opt/graylog/data/plugin /opt/graylog/data/data\n#   -------------------------------------------------------------------------------------------------\n#\n#   final layer\n#   use the smallest debain with headless openjdk and copying files from download layers\nFROM openjdk:8-jre-slim\nARG VCS_REF\nARG GRAYLOG_VERSION\nARG BUILD_DATE\nARG GRAYLOG_HOME=/usr/share/graylog\nARG GRAYLOG_USER=graylog\nARG GRAYLOG_UID=1100\nARG GRAYLOG_GROUP=graylog\nARG GRAYLOG_GID=1100\n#   hadolint ignore=DL3023\nCOPY --from=graylog-downloader /opt/graylog ${GRAYLOG_HOME}\nCOPY config ${GRAYLOG_HOME}/data/config\nWORKDIR ${GRAYLOG_HOME}\n#   hadolint ignore=DL3008,DL3014,SC2086\nRUN echo \"export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64/jre\" > /etc/profile.d/graylog.sh \\\n && echo \"export BUILD_DATE=${BUILD_DATE}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_VERSION=${GRAYLOG_VERSION}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_SERVER_JAVA_OPTS='-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:NewRatio=1 -XX:MaxMetaspaceSize=256m -server -XX:+ResizeTLAB -XX:+UseConcMarkSweepGC -XX:+CMSConcurrentMTEnabled -XX:+CMSClassUnloadingEnabled -XX:+UseParNewGC -XX:-OmitStackTraceInFastThrow'\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_HOME=${GRAYLOG_HOME}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_USER=${GRAYLOG_USER}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_GROUP=${GRAYLOG_GROUP}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_UID=${GRAYLOG_UID}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export GRAYLOG_GID=${GRAYLOG_GID}\" >> /etc/profile.d/graylog.sh \\\n && echo \"export PATH=${GRAYLOG_HOME}/bin:${PATH}\" >> /etc/profile.d/graylog.sh \\\n && apt-get update > /dev/null \\\n && apt-get install --no-install-recommends curl libcap2-bin libglib2.0-0 fontconfig --assume-yes > /dev/null \\\n && addgroup --gid \"${GRAYLOG_GID}\" --quiet \"${GRAYLOG_GROUP}\" \\\n && adduser --disabled-password --disabled-login --gecos '' --home ${GRAYLOG_HOME} --uid \"${GRAYLOG_UID}\" --gid \"${GRAYLOG_GID}\" --quiet \"${GRAYLOG_USER}\" \\\n && chown --recursive \"${GRAYLOG_USER}\":\"${GRAYLOG_GROUP}\" ${GRAYLOG_HOME} \\\n && setcap 'cap_net_bind_service=+ep' \"${JAVA_HOME}/bin/java\" \\\n && apt-get remove --assume-yes --purge apt-utils > /dev/null \\\n && rm -f /etc/apt/sources.list.d/* \\\n && apt-get clean > /dev/null \\\n && apt-get autoremove --assume-yes > /dev/null \\\n && rm -rf /tmp/* /var/cache/debconf/* /var/lib/apt/lists/* /var/log/* /usr/share/X11 /usr/share/doc/* 2> /dev/null\nCOPY docker-entrypoint.sh /\nCOPY health_check.sh /\nEXPOSE 9000/tcp\nUSER ${GRAYLOG_USER}\nVOLUME ${GRAYLOG_HOME}/data\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nCMD [\"graylog\"]\n#   add healthcheck\nHEALTHCHECK --interval=10s --timeout=2s --retries=12 CMD /health_check.sh\n#   -------------------------------------------------------------------------------------------------\nLABEL maintainer=\"Graylog, Inc. <hello@graylog.com>\" \\\n      org.label-schema.name=\"Graylog Docker Image\" \\\n      org.label-schema.description=\"Official Graylog Docker image\" \\\n      org.label-schema.url=\"https://www.graylog.org/\" \\\n      org.label-schema.vcs-ref=\"${VCS_REF}\" \\\n      org.label-schema.vcs-url=\"https://github.com/Graylog2/graylog-docker\" \\\n      org.label-schema.vendor=\"Graylog, Inc.\" \\\n      org.label-schema.version=\"${GRAYLOG_VERSION}\" \\\n      org.label-schema.schema-version=\"1.0\" \\\n      org.label-schema.build-date=\"${BUILD_DATE}\" \\\n      com.microscaling.docker.dockerfile=\"/Dockerfile\" \\\n      com.microscaling.license=\"Apache 2.0\"\n","originalDockerfileUglifiedHash":"f94cef4edc2cf3a4a0225197cee2c10f","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/98ce695262544c35a75df3d9513d2b656a7a8fc9.dockerfile"}