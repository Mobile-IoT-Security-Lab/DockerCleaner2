{"seed":2761598514,"processedDockerfileHash":"600bb6821d44a847d4a5833e878081bc","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["do-not-use-apt-get-update-alone","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM klabs/php71\nMAINTAINER Kaliop\nLABEL nginx.version=\"1.2\" \\\n      php.version=\"7.1\" \\\n      application.type=\"PHP\"\nARG DOCKER_TIMEZONE=Europe/Paris\nARG DOCKER_LOCALE=fr_FR.UTF-8\n#   Configure timezone\n#   -----------------------------------------------------------------------------\nRUN echo $DOCKER_TIMEZONE > /etc/timezone; dpkg-reconfigure -f noninteractive tzdata\n#   Base packages\n#   Java (used for eg. eZTika indexing)\n#   poppler-utils used for pdftotext binary (note that eztika is a much better option!)\n#   -----------------------------------------------------------------------------\nRUN : \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y curl pwgen sudo nano unzip locales imagemagick jpegoptim poppler-utils openjdk-7-jre-headless\n#   locale for date, time & currency php functions\n#   -----------------------------------------------------------------------------\nRUN dpkg-reconfigure locales \\\n && echo $DOCKER_LOCALE' UTF-8' >> /etc/locale.gen \\\n && locale-gen $DOCKER_LOCALE \\\n && /usr/sbin/update-locale LANG=$DOCKER_LOCALE\nENV LC_ALL=\"$DOCKER_LOCALE\"\nENV LANG=\"$DOCKER_LOCALE\"\nENV LANGUAGE=\"$DOCKER_LOCALE\"\n#   Install Nginx & PHP\n#   -----------------------------------------------------------------------------\nRUN : \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y nginx php7.1-fpm\n#   Local user\n#   => to try : run container with --user option to set root user id with host user id\n#   -----------------------------------------------------------------------------\n#   nb: the 1013 used here for user id and group id is later on replaced by the code in bootstrap.sh...\nRUN addgroup --gid 1013 site \\\n && adduser --system --uid=1013 --gid=1013 --home /home/site --shell /bin/bash site \\\n && adduser site site \\\n && adduser site www-data \\\n && mkdir -p /home/site/.ssh ; cp /etc/skel/.* /home/site/ ; chown -R site:site /home/site\n#   Nginx config\n#   -----------------------------------------------------------------------------\nRUN sed -i -e\"s/worker_processes 1/worker_processes 4/\" /etc/nginx/nginx.conf \\\n && sed -i -e\"s/keepalive_timeout\\s*65/keepalive_timeout 2/\" /etc/nginx/nginx.conf \\\n && sed -i -e\"s/keepalive_timeout 2/keepalive_timeout 2;\\n\\tclient_max_body_size 100m/\" /etc/nginx/nginx.conf \\\n && sed -i -e's|user www-data;|user site;|g' /etc/nginx/nginx.conf\nRUN chmod 755 -R /var/log/nginx\n#   PHP config\n#   -----------------------------------------------------------------------------\nRUN sed -rie 's|user = www-data|user = site|g' /etc/php/7.1/fpm/pool.d/www.conf \\\n && sed -rie 's|listen.owner = www-data|listen.owner = site|g' /etc/php/7.1/fpm/pool.d/www.conf\n#   Disable xdebug\nRUN rm /etc/php/7.1/fpm/conf.d/20-xdebug.ini\n#   Custom PHP-FPM error log folder\nRUN mkdir /var/log/php/\nRUN chmod 755 -R /var/log/php/\nRUN sed -rie 's|error_log = /var/log/php7.1-fpm.log|error_log = /var/log/php/php7.1-fpm.log|g' /etc/php/7.1/fpm/php-fpm.conf\n#   Vhost config\n#   -----------------------------------------------------------------------------\n#   controlpanel is burned into the container\nCOPY etc/nginx/conf.d/010-controlpanel.conf /etc/nginx/conf.d/010-controlpanel.conf\nCOPY etc/nginx/sites-available/default /etc/nginx/sites-available/000-default\nRUN rm /etc/nginx/sites-enabled/default\nRUN ln -s /etc/nginx/sites-available/000-default /etc/nginx/sites-enabled/000-default\nCOPY sites/controlpanel/ /home/site/controlpanel/\n#   Run composer install for phpmemadmin vendors\nRUN cd /home/site/controlpanel/phpmemadmin \\\n && curl -sS https://getcomposer.org/installer | php -- \\\n && php composer.phar install --no-dev --ignore-platform-reqs\n#   -----------------------------------------------------------------------------\n#   Clear archives in apt cache folder\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\nCOPY bootstrap.sh /root/bootstrap.sh\nRUN chmod 755 /root/bootstrap.sh\nEXPOSE 443/tcp\nEXPOSE 80/tcp\nEXPOSE 82/tcp\nWORKDIR /var/www/\nCMD [\"/root/bootstrap.sh\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM klabs/php71\nMAINTAINER Kaliop\nLABEL nginx.version=\"1.2\" \\\n      php.version=\"7.1\" \\\n      application.type=\"PHP\"\nARG DOCKER_TIMEZONE=Europe/Paris\nARG DOCKER_LOCALE=fr_FR.UTF-8\n#  Configure timezone\n#  -----------------------------------------------------------------------------\nRUN echo $DOCKER_TIMEZONE > /etc/timezone; dpkg-reconfigure -f noninteractive tzdata\n#  Base packages\n#  Java (used for eg. eZTika indexing)\n#  poppler-utils used for pdftotext binary (note that eztika is a much better option!)\n#  -----------------------------------------------------------------------------\nRUN apt-get update \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y curl pwgen sudo nano unzip locales imagemagick jpegoptim poppler-utils openjdk-7-jre-headless\n#  locale for date, time & currency php functions\n#  -----------------------------------------------------------------------------\nRUN dpkg-reconfigure locales \\\n && echo $DOCKER_LOCALE' UTF-8' >> /etc/locale.gen \\\n && locale-gen $DOCKER_LOCALE \\\n && /usr/sbin/update-locale LANG=$DOCKER_LOCALE\nENV LC_ALL=\"$DOCKER_LOCALE\"\nENV LANG=\"$DOCKER_LOCALE\"\nENV LANGUAGE=\"$DOCKER_LOCALE\"\n#  Install Nginx & PHP\n#  -----------------------------------------------------------------------------\nRUN apt-get update \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y nginx php7.1-fpm\n#  Local user\n#  => to try : run container with --user option to set root user id with host user id\n#  -----------------------------------------------------------------------------\n#  nb: the 1013 used here for user id and group id is later on replaced by the code in bootstrap.sh...\nRUN addgroup --gid 1013 site \\\n && adduser --system --uid=1013 --gid=1013 --home /home/site --shell /bin/bash site \\\n && adduser site site \\\n && adduser site www-data \\\n && mkdir -p /home/site/.ssh ; cp /etc/skel/.* /home/site/ ; chown -R site:site /home/site\n#  Nginx config\n#  -----------------------------------------------------------------------------\nRUN sed -i -e\"s/worker_processes 1/worker_processes 4/\" /etc/nginx/nginx.conf \\\n && sed -i -e\"s/keepalive_timeout\\s*65/keepalive_timeout 2/\" /etc/nginx/nginx.conf \\\n && sed -i -e\"s/keepalive_timeout 2/keepalive_timeout 2;\\n\\tclient_max_body_size 100m/\" /etc/nginx/nginx.conf \\\n && sed -i -e's|user www-data;|user site;|g' /etc/nginx/nginx.conf\nRUN chmod 755 -R /var/log/nginx\n#  PHP config\n#  -----------------------------------------------------------------------------\nRUN sed -rie 's|user = www-data|user = site|g' /etc/php/7.1/fpm/pool.d/www.conf \\\n && sed -rie 's|listen.owner = www-data|listen.owner = site|g' /etc/php/7.1/fpm/pool.d/www.conf\n#  Disable xdebug\nRUN rm /etc/php/7.1/fpm/conf.d/20-xdebug.ini\n#  Custom PHP-FPM error log folder\nRUN mkdir /var/log/php/\nRUN chmod 755 -R /var/log/php/\nRUN sed -rie 's|error_log = /var/log/php7.1-fpm.log|error_log = /var/log/php/php7.1-fpm.log|g' /etc/php/7.1/fpm/php-fpm.conf\n#  Vhost config\n#  -----------------------------------------------------------------------------\n#  controlpanel is burned into the container\nCOPY etc/nginx/conf.d/010-controlpanel.conf /etc/nginx/conf.d/010-controlpanel.conf\nCOPY etc/nginx/sites-available/default /etc/nginx/sites-available/000-default\nRUN rm /etc/nginx/sites-enabled/default\nRUN ln -s /etc/nginx/sites-available/000-default /etc/nginx/sites-enabled/000-default\nCOPY sites/controlpanel/ /home/site/controlpanel/\n#  Run composer install for phpmemadmin vendors\nRUN cd /home/site/controlpanel/phpmemadmin \\\n && curl -sS https://getcomposer.org/installer | php -- \\\n && php composer.phar install --no-dev --ignore-platform-reqs\n#  -----------------------------------------------------------------------------\n#  Clear archives in apt cache folder\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\nCOPY bootstrap.sh /root/bootstrap.sh\nRUN chmod 755 /root/bootstrap.sh\nEXPOSE 443/tcp\nEXPOSE 80/tcp\nEXPOSE 82/tcp\nWORKDIR /var/www/\nCMD [\"/root/bootstrap.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"1d1ed5eea09e6c61fe100b5da49aa632","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM klabs/php71\nMAINTAINER Kaliop\nLABEL nginx.version=\"1.2\" \\\n      php.version=\"7.1\" \\\n      application.type=\"PHP\"\nARG DOCKER_TIMEZONE=Europe/Paris\nARG DOCKER_LOCALE=fr_FR.UTF-8\n#   Configure timezone\n#   -----------------------------------------------------------------------------\nRUN echo $DOCKER_TIMEZONE > /etc/timezone; dpkg-reconfigure -f noninteractive tzdata\n#   Base packages\n#   Java (used for eg. eZTika indexing)\n#   poppler-utils used for pdftotext binary (note that eztika is a much better option!)\n#   -----------------------------------------------------------------------------\nRUN apt-get update \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y curl pwgen sudo nano unzip locales imagemagick jpegoptim poppler-utils openjdk-7-jre-headless\n#   locale for date, time & currency php functions\n#   -----------------------------------------------------------------------------\nRUN dpkg-reconfigure locales \\\n && echo $DOCKER_LOCALE' UTF-8' >> /etc/locale.gen \\\n && locale-gen $DOCKER_LOCALE \\\n && /usr/sbin/update-locale LANG=$DOCKER_LOCALE\nENV LC_ALL=\"$DOCKER_LOCALE\"\nENV LANG=\"$DOCKER_LOCALE\"\nENV LANGUAGE=\"$DOCKER_LOCALE\"\n#   Install Nginx & PHP\n#   -----------------------------------------------------------------------------\nRUN apt-get update \\\n && DEBIAN_FRONTEND=noninteractive apt-get install -y nginx php7.1-fpm\n#   Local user\n#   => to try : run container with --user option to set root user id with host user id\n#   -----------------------------------------------------------------------------\n#   nb: the 1013 used here for user id and group id is later on replaced by the code in bootstrap.sh...\nRUN addgroup --gid 1013 site \\\n && adduser --system --uid=1013 --gid=1013 --home /home/site --shell /bin/bash site \\\n && adduser site site \\\n && adduser site www-data \\\n && mkdir -p /home/site/.ssh ; cp /etc/skel/.* /home/site/ ; chown -R site:site /home/site\n#   Nginx config\n#   -----------------------------------------------------------------------------\nRUN sed -i -e\"s/worker_processes 1/worker_processes 4/\" /etc/nginx/nginx.conf \\\n && sed -i -e\"s/keepalive_timeout\\s*65/keepalive_timeout 2/\" /etc/nginx/nginx.conf \\\n && sed -i -e\"s/keepalive_timeout 2/keepalive_timeout 2;\\n\\tclient_max_body_size 100m/\" /etc/nginx/nginx.conf \\\n && sed -i -e's|user www-data;|user site;|g' /etc/nginx/nginx.conf\nRUN chmod 755 -R /var/log/nginx\n#   PHP config\n#   -----------------------------------------------------------------------------\nRUN sed -rie 's|user = www-data|user = site|g' /etc/php/7.1/fpm/pool.d/www.conf \\\n && sed -rie 's|listen.owner = www-data|listen.owner = site|g' /etc/php/7.1/fpm/pool.d/www.conf\n#   Disable xdebug\nRUN rm /etc/php/7.1/fpm/conf.d/20-xdebug.ini\n#   Custom PHP-FPM error log folder\nRUN mkdir /var/log/php/\nRUN chmod 755 -R /var/log/php/\nRUN sed -rie 's|error_log = /var/log/php7.1-fpm.log|error_log = /var/log/php/php7.1-fpm.log|g' /etc/php/7.1/fpm/php-fpm.conf\n#   Vhost config\n#   -----------------------------------------------------------------------------\n#   controlpanel is burned into the container\nCOPY etc/nginx/conf.d/010-controlpanel.conf /etc/nginx/conf.d/010-controlpanel.conf\nCOPY etc/nginx/sites-available/default /etc/nginx/sites-available/000-default\nRUN rm /etc/nginx/sites-enabled/default\nRUN ln -s /etc/nginx/sites-available/000-default /etc/nginx/sites-enabled/000-default\nCOPY sites/controlpanel/ /home/site/controlpanel/\n#   Run composer install for phpmemadmin vendors\nRUN cd /home/site/controlpanel/phpmemadmin \\\n && curl -sS https://getcomposer.org/installer | php -- \\\n && php composer.phar install --no-dev --ignore-platform-reqs\n#   -----------------------------------------------------------------------------\n#   Clear archives in apt cache folder\nRUN apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\nCOPY bootstrap.sh /root/bootstrap.sh\nRUN chmod 755 /root/bootstrap.sh\nEXPOSE 443/tcp\nEXPOSE 80/tcp\nEXPOSE 82/tcp\nWORKDIR /var/www/\nCMD [\"/root/bootstrap.sh\"]\n","originalDockerfileUglifiedHash":"616e401520f0a217a6126783b7fe995d","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/ac75ee1dfe7037d9d235e96c263d95933d3c383f.dockerfile"}