{"seed":592295538,"processedDockerfileHash":"e6f962fecd36eec20746523e3ff0252a","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM Fedora-Docker-Base-23-20151030.x86_64\nMAINTAINER Hamish.K.Mackenzie@gmail.com\nRUN dnf -y install sudo \\\n && dnf clean all\nENV WINE=\"wine\"\nENV WINEDEBUG=\"-all\"\nENV WINEPATH_U=\"winepath -u\"\nRUN sudo dnf -y --enablerepo updates-testing update \\\n && sudo dnf clean all\nRUN sudo dnf -y --enablerepo updates-testing install wine.x86_64 wine.i686 mingw64-gtksourceview3.noarch mingw32-winpthreads mingw64-enchant mingw64-libsoup mingw64-libidn mingw64-sqlite mingw64-gstreamer1-plugins-base mingw64-libwebp mingw64-libxslt mingw32-enchant mingw32-libsoup mingw32-libidn mingw32-sqlite mingw32-gstreamer1-plugins-base mingw32-libwebp mingw32-libxslt mingw32-gtk3 bison flex gettext gobject-introspection-devel atk-devel libsoup-devel webkitgtk3-devel webkitgtk4-devel gtksourceview3-devel poppler-glib-devel vte291-devel libnotify-devel gstreamer1-devel gstreamer1-plugins-base-devel gperf ruby wget tar xz make p7zip unzip cabextract cabal-install git msitools Xvfb which mono-core mono-locale-extras libxslt rpm-build\nRUN sudo dnf -y --enablerepo updates-testing install dnf-plugins-core\nRUN dnf download --source mingw32-webkitgtk3 \\\n && rpm -i mingw-webkitgtk3-2.4.9-1.fc23.src.rpm\nRUN ls /usr/src\nCOPY linux/specfiles/mingw-webkitgtk3.spec /root/rpmbuild/SPECS/\nRUN cd /root/rpmbuild/SOURCES \\\n && wget https://raw.githubusercontent.com/Alexpux/MINGW-packages/master/mingw-w64-webkitgtk3/0101-webkitgtk-2.4.3-gcc-asm.all.patch\nRUN cd /root/rpmbuild/SPECS \\\n && rpmbuild -ba mingw-webkitgtk3.spec\nRUN sudo rpm -i /root/rpmbuild/RPMS/noarch/mingw64-webkitgtk3-2.4.9-1.fc23.noarch.rpm\nRUN rm -rf /root/rpmbuild\nRUN sudo dnf clean all\nRUN wget http://winetricks.org/winetricks \\\n && sudo cp winetricks /usr/bin \\\n && sudo chmod +x /usr/bin/winetricks\n#   Install pkg-config for using in Wine and Windows\nRUN wget http://pkgconfig.freedesktop.org/releases/pkg-config-0.28.tar.gz \\\n && tar -xzf pkg-config-0.28.tar.gz \\\n && cd pkg-config-0.28 \\\n && mingw64-configure \\\n && make \\\n && sudo make install \\\n && make clean \\\n && rm -rf pkg-config-0.28.tar.gz pkg-config-0.28\n#   Fix the broken pkg-config files (it is important to use ${prefix} or they will not work\n#   when used on Windows or in Wine:\nRUN grep -lZ '^Cflags:.*-I/usr/x86_64-w64-mingw32/sys-root/mingw' /usr/x86_64-w64-mingw32/sys-root/mingw/lib/pkgconfig/*.pc | xargs -0 -l sudo sed -i.bak -e '/^Cflags:/ s|-I/usr/x86_64-w64-mingw32/sys-root/mingw|-I${prefix}|g'\n#   Initialize Wine:\nRUN wineboot \\\n && wine cmd /C echo \"Wine OK\" \\\n && wineserver -w \\\n && (export WINEPREFIX=~/.wine32 \\\n && export WINEARCH=win32 \\\n && wineboot \\\n && wine cmd /C echo \"Wine 32 OK\" \\\n && xvfb-run winetricks --unattended dotnet40 corefonts \\\n && wineserver -w )\nENV GHCVER=\"7.10.3\"\n#   Install Windows version of GHC (but not the old mingw that comes with it):\nRUN cd ~/.wine/drive_c \\\n && wget https://www.haskell.org/ghc/dist/$GHCVER/ghc-$GHCVER-x86_64-unknown-mingw32.tar.xz \\\n && tar -xJf ghc-$GHCVER-x86_64-unknown-mingw32.tar.xz \\\n && rm -rf ghc-*/mingw \\\n && rm ghc-*-x86_64-unknown-mingw32.tar.xz\n#   Use `wine regedit` to add a `Path` to `HKEY_CURRENT_USER\\Environment`:\nRUN (echo 'REGEDIT4' \\\n && echo \\\n && echo '[HKEY_CURRENT_USER\\Environment]' \\\n && echo '\"Path\"=\"C:\\\\users\\\\root\\\\Application Data\\\\cabal\\\\bin;C:\\\\ghc-'$GHCVER'\\\\bin;C:\\\\bin;Z:\\\\usr\\\\x86_64-w64-mingw32\\\\sys-root\\\\mingw\\\\bin;%PATH%\"' ) > Environment.reg \\\n && wine regedit Environment.reg \\\n && (echo 'REGEDIT4' \\\n && echo \\\n && echo '[HKEY_CURRENT_USER\\Environment]' \\\n && echo '\"Path\"=\"C:\\\\users\\\\root\\\\Application Data\\\\cabal\\\\bin;C:\\\\ghc-'$GHCVER'\\\\bin;C:\\\\bin;Z:\\\\usr\\\\i686-w64-mingw32\\\\sys-root\\\\mingw\\\\bin;%PATH%\"' ) > Environment.reg \\\n && (export WINEPREFIX=~/.wine32 \\\n && export WINEARCH=win32 \\\n && wine regedit Environment.reg \\\n && wineserver -w ) \\\n && rm Environment.reg\n#   Replace the MinGW that comes with GHC:\nRUN cd ~/.wine/drive_c/ghc-$GHCVER \\\n && wget http://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win64/Personal%20Builds/mingw-builds/4.9.2/threads-posix/seh/x86_64-4.9.2-release-posix-seh-rt_v4-rev2.7z \\\n && 7za x x86_64-4.9.2-release-posix-seh-rt_v4-rev2.7z \\\n && mv mingw64 mingw \\\n && rm -rf x86_64-4.9.2-release-posix-seh-rt_v4-rev2.7z\n#   Install WiX Toolset:\nCOPY wix39-binaries.zip /root/\nRUN mkdir ~/.wine32/drive_c/bin \\\n && cd ~/.wine32/drive_c/bin \\\n && unzip ~/wix39-binaries.zip \\\n && rm ~/wix39-binaries.zip\n#   Install 64bit Windows version of cabal-install:\nRUN mkdir ~/.wine/drive_c/bin \\\n && cd ~/.wine/drive_c/bin \\\n && wget http://leksah.org/packages/cabal-mingw64.7z \\\n && 7za x cabal-mingw64.7z \\\n && rm cabal-mingw64.7z\n#   Run `cabal update` and install some packages we will need.\n#   Some packages need us to run `mingw64-configure` manually (after `wine cabal configure` fails):\nRUN wineserver -p1 \\\n && cabal update \\\n && wine cabal update \\\n && wine cabal install Cabal \\\n && wine cabal install old-locale \\\n && cabal unpack network \\\n && cd network-* \\\n && (wine cabal configure || true ) \\\n && mingw64-configure \\\n && wine cabal build \\\n && wine cabal copy \\\n && wine cabal register \\\n && cd .. \\\n && cabal unpack old-time \\\n && cd old-time-* \\\n && (wine cabal configure || true ) \\\n && mingw64-configure \\\n && wine cabal build \\\n && wine cabal copy \\\n && wine cabal register \\\n && cd .. \\\n && wine cabal install alex happy \\\n && wine cabal install gtk2hs-buildtools \\\n && wineserver -w \\\n && rm -rf network-* old-time-*\n#   Install fonts to bundle with Leksah\nRUN sudo dnf -y install dejavu-sans-fonts dejavu-serif-fonts dejavu-sans-mono-fonts dejavu-lgc-sans-fonts dejavu-lgc-serif-fonts dejavu-lgc-sans-mono-fonts \\\n && sudo dnf clean all \\\n && mkdir -p ~/.wine32/drive_c/dejavu-fonts/ttf \\\n && ln -s /usr/share/fonts/dejavu/* ~/.wine32/drive_c/dejavu-fonts/ttf\n#   Install grep to bundle with Leksah:\nRUN mkdir grep \\\n && cd grep \\\n && wget http://sourceforge.net/projects/mingw/files/MSYS/Base/grep/grep-2.5.4-2/grep-2.5.4-2-msys-1.0.13-bin.tar.lzma \\\n && tar --lzma -xvf grep-2.5.4-2-msys-1.0.13-bin.tar.lzma \\\n && sudo cp bin/*grep.exe /usr/x86_64-w64-mingw32/sys-root/mingw/bin \\\n && rm grep-2.5.4-2-msys-1.0.13-bin.tar.lzma\nRUN wineserver -p1 \\\n && wine cabal update \\\n && wineserver -w\nRUN wineserver -p1 \\\n && wine cabal install shakespeare lens hlint hscolour \\\n && wineserver -w\nRUN git clone https://github.com/haskell-gi/haskell-gi-base.git \\\n && git clone https://github.com/haskell-gi/haskell-gi.git \\\n && git clone https://github.com/ghcjs/jsaddle.git \\\n && git clone https://github.com/ghcjs/jsaddle-dom.git \\\n && git clone https://github.com/ghcjs/ghcjs-dom.git\nRUN sudo dnf copr -y enable petersen/ghc-$GHCVER\nRUN sudo dnf install -y ghc cabal-install\nRUN cabal install happy alex\nRUN ghc-pkg list\nRUN cabal install ./haskell-gi-base ./haskell-gi --force-reinstalls\nRUN cd haskell-gi/bindings \\\n && LANG=en_GB.UTF-8 PATH=/root/.cabal/bin:$PATH ./genBindings.sh\n#   Add Leksah files to Docker:\nCOPY leksah.cabal LICENSE LICENSE.rtf Readme.md Setup.lhs SetupLocale.lhs sources.txt leksah/\n#   Docker has no way to COPY or ADD two directories at once!?!?\nCOPY bew leksah/bew\nCOPY data leksah/data\nCOPY doc leksah/doc\nCOPY language-specs leksah/language-specs\nCOPY linux leksah/linux\nCOPY main leksah/main\nCOPY osx leksah/osx\nCOPY pics leksah/pics\nCOPY po leksah/po\nCOPY scripts leksah/scripts\nCOPY src leksah/src\nCOPY tests leksah/tests\nCOPY vendor leksah/vendor\nCOPY win32 leksah/win32\nRUN wineserver -p1 \\\n && rm -rf haskell-gi-base/dist \\\n && wine cabal install ./haskell-gi-base ./haskell-gi/bindings/GLib ./haskell-gi/bindings/Gdk ./haskell-gi/bindings/Gtk ./haskell-gi/bindings/Atk ./haskell-gi/bindings/GdkPixbuf ./haskell-gi/bindings/Pango ./haskell-gi/bindings/Cairo ./haskell-gi/bindings/PangoCairo ./haskell-gi/bindings/WebKit ./haskell-gi/bindings/Gio ./haskell-gi/bindings/JavaScriptCore-3.0 ./haskell-gi/bindings/GtkSource ./haskell-gi/bindings/Notify ./haskell-gi/bindings/GObject ./haskell-gi/bindings/Soup \\\n && wineserver -w\nRUN git clone https://github.com/gtk2hs/gi-gtk-hs.git\nRUN wineserver -p1 \\\n && rm -rf haskell-gi-base/dist \\\n && wine cabal install ./gi-gtk-hs ./jsaddle ./jsaddle-dom ./ghcjs-dom ./leksah/vendor/haskellVCSGUI/vcsgui \\\n && wineserver -w\n#   Build leksah and make the MSI file:\nRUN wineserver -p1 \\\n && cd leksah \\\n && ./win32/makeinstaller.sh \\\n && wineserver -w\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM Fedora-Docker-Base-23-20151030.x86_64\nMAINTAINER Hamish.K.Mackenzie@gmail.com\nRUN dnf -y install sudo \\\n && dnf clean all\nENV WINE=\"wine\"\nENV WINEDEBUG=\"-all\"\nENV WINEPATH_U=\"winepath -u\"\nRUN sudo dnf -y --enablerepo updates-testing update \\\n && sudo dnf clean all\nRUN sudo dnf -y --enablerepo updates-testing install wine.x86_64 wine.i686 mingw64-gtksourceview3.noarch mingw32-winpthreads mingw64-enchant mingw64-libsoup mingw64-libidn mingw64-sqlite mingw64-gstreamer1-plugins-base mingw64-libwebp mingw64-libxslt mingw32-enchant mingw32-libsoup mingw32-libidn mingw32-sqlite mingw32-gstreamer1-plugins-base mingw32-libwebp mingw32-libxslt mingw32-gtk3 bison flex gettext gobject-introspection-devel atk-devel libsoup-devel webkitgtk3-devel webkitgtk4-devel gtksourceview3-devel poppler-glib-devel vte291-devel libnotify-devel gstreamer1-devel gstreamer1-plugins-base-devel gperf ruby wget tar xz make p7zip unzip cabextract cabal-install git msitools Xvfb which mono-core mono-locale-extras libxslt rpm-build\nRUN sudo dnf -y --enablerepo updates-testing install dnf-plugins-core\nRUN dnf download --source mingw32-webkitgtk3 \\\n && rpm -i mingw-webkitgtk3-2.4.9-1.fc23.src.rpm\nRUN ls /usr/src\nADD linux/specfiles/mingw-webkitgtk3.spec /root/rpmbuild/SPECS/\nRUN cd /root/rpmbuild/SOURCES \\\n && wget https://raw.githubusercontent.com/Alexpux/MINGW-packages/master/mingw-w64-webkitgtk3/0101-webkitgtk-2.4.3-gcc-asm.all.patch\nRUN cd /root/rpmbuild/SPECS \\\n && rpmbuild -ba mingw-webkitgtk3.spec\nRUN sudo rpm -i /root/rpmbuild/RPMS/noarch/mingw64-webkitgtk3-2.4.9-1.fc23.noarch.rpm\nRUN rm -rf /root/rpmbuild\nRUN sudo dnf clean all\nRUN wget http://winetricks.org/winetricks \\\n && sudo cp winetricks /usr/bin \\\n && sudo chmod +x /usr/bin/winetricks\n#  Install pkg-config for using in Wine and Windows\nRUN wget http://pkgconfig.freedesktop.org/releases/pkg-config-0.28.tar.gz \\\n && tar -xzf pkg-config-0.28.tar.gz \\\n && cd pkg-config-0.28 \\\n && mingw64-configure \\\n && make \\\n && sudo make install \\\n && make clean \\\n && rm -rf pkg-config-0.28.tar.gz pkg-config-0.28\n#  Fix the broken pkg-config files (it is important to use ${prefix} or they will not work\n#  when used on Windows or in Wine:\nRUN grep -lZ '^Cflags:.*-I/usr/x86_64-w64-mingw32/sys-root/mingw' /usr/x86_64-w64-mingw32/sys-root/mingw/lib/pkgconfig/*.pc | xargs -0 -l sudo sed -i.bak -e '/^Cflags:/ s|-I/usr/x86_64-w64-mingw32/sys-root/mingw|-I${prefix}|g'\n#  Initialize Wine:\nRUN wineboot \\\n && wine cmd /C echo \"Wine OK\" \\\n && wineserver -w \\\n && (export WINEPREFIX=~/.wine32 \\\n && export WINEARCH=win32 \\\n && wineboot \\\n && wine cmd /C echo \"Wine 32 OK\" \\\n && xvfb-run winetricks --unattended dotnet40 corefonts \\\n && wineserver -w )\nENV GHCVER=\"7.10.3\"\n#  Install Windows version of GHC (but not the old mingw that comes with it):\nRUN cd ~/.wine/drive_c \\\n && wget https://www.haskell.org/ghc/dist/$GHCVER/ghc-$GHCVER-x86_64-unknown-mingw32.tar.xz \\\n && tar -xJf ghc-$GHCVER-x86_64-unknown-mingw32.tar.xz \\\n && rm -rf ghc-*/mingw \\\n && rm ghc-*-x86_64-unknown-mingw32.tar.xz\n#  Use `wine regedit` to add a `Path` to `HKEY_CURRENT_USER\\Environment`:\nRUN (echo 'REGEDIT4' \\\n && echo \\\n && echo '[HKEY_CURRENT_USER\\Environment]' \\\n && echo '\"Path\"=\"C:\\\\users\\\\root\\\\Application Data\\\\cabal\\\\bin;C:\\\\ghc-'$GHCVER'\\\\bin;C:\\\\bin;Z:\\\\usr\\\\x86_64-w64-mingw32\\\\sys-root\\\\mingw\\\\bin;%PATH%\"' ) > Environment.reg \\\n && wine regedit Environment.reg \\\n && (echo 'REGEDIT4' \\\n && echo \\\n && echo '[HKEY_CURRENT_USER\\Environment]' \\\n && echo '\"Path\"=\"C:\\\\users\\\\root\\\\Application Data\\\\cabal\\\\bin;C:\\\\ghc-'$GHCVER'\\\\bin;C:\\\\bin;Z:\\\\usr\\\\i686-w64-mingw32\\\\sys-root\\\\mingw\\\\bin;%PATH%\"' ) > Environment.reg \\\n && (export WINEPREFIX=~/.wine32 \\\n && export WINEARCH=win32 \\\n && wine regedit Environment.reg \\\n && wineserver -w ) \\\n && rm Environment.reg\n#  Replace the MinGW that comes with GHC:\nRUN cd ~/.wine/drive_c/ghc-$GHCVER \\\n && wget http://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win64/Personal%20Builds/mingw-builds/4.9.2/threads-posix/seh/x86_64-4.9.2-release-posix-seh-rt_v4-rev2.7z \\\n && 7za x x86_64-4.9.2-release-posix-seh-rt_v4-rev2.7z \\\n && mv mingw64 mingw \\\n && rm -rf x86_64-4.9.2-release-posix-seh-rt_v4-rev2.7z\n#  Install WiX Toolset:\nADD wix39-binaries.zip /root/\nRUN mkdir ~/.wine32/drive_c/bin \\\n && cd ~/.wine32/drive_c/bin \\\n && unzip ~/wix39-binaries.zip \\\n && rm ~/wix39-binaries.zip\n#  Install 64bit Windows version of cabal-install:\nRUN mkdir ~/.wine/drive_c/bin \\\n && cd ~/.wine/drive_c/bin \\\n && wget http://leksah.org/packages/cabal-mingw64.7z \\\n && 7za x cabal-mingw64.7z \\\n && rm cabal-mingw64.7z\n#  Run `cabal update` and install some packages we will need.\n#  Some packages need us to run `mingw64-configure` manually (after `wine cabal configure` fails):\nRUN wineserver -p1 \\\n && cabal update \\\n && wine cabal update \\\n && wine cabal install Cabal \\\n && wine cabal install old-locale \\\n && cabal unpack network \\\n && cd network-* \\\n && (wine cabal configure || true ) \\\n && mingw64-configure \\\n && wine cabal build \\\n && wine cabal copy \\\n && wine cabal register \\\n && cd .. \\\n && cabal unpack old-time \\\n && cd old-time-* \\\n && (wine cabal configure || true ) \\\n && mingw64-configure \\\n && wine cabal build \\\n && wine cabal copy \\\n && wine cabal register \\\n && cd .. \\\n && wine cabal install alex happy \\\n && wine cabal install gtk2hs-buildtools \\\n && wineserver -w \\\n && rm -rf network-* old-time-*\n#  Install fonts to bundle with Leksah\nRUN sudo dnf -y install dejavu-sans-fonts dejavu-serif-fonts dejavu-sans-mono-fonts dejavu-lgc-sans-fonts dejavu-lgc-serif-fonts dejavu-lgc-sans-mono-fonts \\\n && sudo dnf clean all \\\n && mkdir -p ~/.wine32/drive_c/dejavu-fonts/ttf \\\n && ln -s /usr/share/fonts/dejavu/* ~/.wine32/drive_c/dejavu-fonts/ttf\n#  Install grep to bundle with Leksah:\nRUN mkdir grep \\\n && cd grep \\\n && wget http://sourceforge.net/projects/mingw/files/MSYS/Base/grep/grep-2.5.4-2/grep-2.5.4-2-msys-1.0.13-bin.tar.lzma \\\n && tar --lzma -xvf grep-2.5.4-2-msys-1.0.13-bin.tar.lzma \\\n && sudo cp bin/*grep.exe /usr/x86_64-w64-mingw32/sys-root/mingw/bin \\\n && rm grep-2.5.4-2-msys-1.0.13-bin.tar.lzma\nRUN wineserver -p1 \\\n && wine cabal update \\\n && wineserver -w\nRUN wineserver -p1 \\\n && wine cabal install shakespeare lens hlint hscolour \\\n && wineserver -w\nRUN git clone https://github.com/haskell-gi/haskell-gi-base.git \\\n && git clone https://github.com/haskell-gi/haskell-gi.git \\\n && git clone https://github.com/ghcjs/jsaddle.git \\\n && git clone https://github.com/ghcjs/jsaddle-dom.git \\\n && git clone https://github.com/ghcjs/ghcjs-dom.git\nRUN sudo dnf copr -y enable petersen/ghc-$GHCVER\nRUN sudo dnf install -y ghc cabal-install\nRUN cabal install happy alex\nRUN ghc-pkg list\nRUN cabal install ./haskell-gi-base ./haskell-gi --force-reinstalls\nRUN cd haskell-gi/bindings \\\n && LANG=en_GB.UTF-8 PATH=/root/.cabal/bin:$PATH ./genBindings.sh\n#  Add Leksah files to Docker:\nADD leksah.cabal LICENSE LICENSE.rtf Readme.md Setup.lhs SetupLocale.lhs sources.txt leksah/\n#  Docker has no way to COPY or ADD two directories at once!?!?\nADD bew leksah/bew\nADD data leksah/data\nADD doc leksah/doc\nADD language-specs leksah/language-specs\nADD linux leksah/linux\nADD main leksah/main\nADD osx leksah/osx\nADD pics leksah/pics\nADD po leksah/po\nADD scripts leksah/scripts\nADD src leksah/src\nADD tests leksah/tests\nADD vendor leksah/vendor\nADD win32 leksah/win32\nRUN wineserver -p1 \\\n && rm -rf haskell-gi-base/dist \\\n && wine cabal install ./haskell-gi-base ./haskell-gi/bindings/GLib ./haskell-gi/bindings/Gdk ./haskell-gi/bindings/Gtk ./haskell-gi/bindings/Atk ./haskell-gi/bindings/GdkPixbuf ./haskell-gi/bindings/Pango ./haskell-gi/bindings/Cairo ./haskell-gi/bindings/PangoCairo ./haskell-gi/bindings/WebKit ./haskell-gi/bindings/Gio ./haskell-gi/bindings/JavaScriptCore-3.0 ./haskell-gi/bindings/GtkSource ./haskell-gi/bindings/Notify ./haskell-gi/bindings/GObject ./haskell-gi/bindings/Soup \\\n && wineserver -w\nRUN git clone https://github.com/gtk2hs/gi-gtk-hs.git\nRUN wineserver -p1 \\\n && rm -rf haskell-gi-base/dist \\\n && wine cabal install ./gi-gtk-hs ./jsaddle ./jsaddle-dom ./ghcjs-dom ./leksah/vendor/haskellVCSGUI/vcsgui \\\n && wineserver -w\n#  Build leksah and make the MSI file:\nRUN wineserver -p1 \\\n && cd leksah \\\n && ./win32/makeinstaller.sh \\\n && wineserver -w\n","injectedSmells":[],"originalDockerfileHash":"f141a8e0ad78d33eecb190bb234db672","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM Fedora-Docker-Base-23-20151030.x86_64\nMAINTAINER Hamish.K.Mackenzie@gmail.com\nRUN dnf -y install sudo \\\n && dnf clean all\nENV WINE=\"wine\"\nENV WINEDEBUG=\"-all\"\nENV WINEPATH_U=\"winepath -u\"\nRUN sudo dnf -y --enablerepo updates-testing update \\\n && sudo dnf clean all\nRUN sudo dnf -y --enablerepo updates-testing install wine.x86_64 wine.i686 mingw64-gtksourceview3.noarch mingw32-winpthreads mingw64-enchant mingw64-libsoup mingw64-libidn mingw64-sqlite mingw64-gstreamer1-plugins-base mingw64-libwebp mingw64-libxslt mingw32-enchant mingw32-libsoup mingw32-libidn mingw32-sqlite mingw32-gstreamer1-plugins-base mingw32-libwebp mingw32-libxslt mingw32-gtk3 bison flex gettext gobject-introspection-devel atk-devel libsoup-devel webkitgtk3-devel webkitgtk4-devel gtksourceview3-devel poppler-glib-devel vte291-devel libnotify-devel gstreamer1-devel gstreamer1-plugins-base-devel gperf ruby wget tar xz make p7zip unzip cabextract cabal-install git msitools Xvfb which mono-core mono-locale-extras libxslt rpm-build\nRUN sudo dnf -y --enablerepo updates-testing install dnf-plugins-core\nRUN dnf download --source mingw32-webkitgtk3 \\\n && rpm -i mingw-webkitgtk3-2.4.9-1.fc23.src.rpm\nRUN ls /usr/src\nADD linux/specfiles/mingw-webkitgtk3.spec /root/rpmbuild/SPECS/\nRUN cd /root/rpmbuild/SOURCES \\\n && wget https://raw.githubusercontent.com/Alexpux/MINGW-packages/master/mingw-w64-webkitgtk3/0101-webkitgtk-2.4.3-gcc-asm.all.patch\nRUN cd /root/rpmbuild/SPECS \\\n && rpmbuild -ba mingw-webkitgtk3.spec\nRUN sudo rpm -i /root/rpmbuild/RPMS/noarch/mingw64-webkitgtk3-2.4.9-1.fc23.noarch.rpm\nRUN rm -rf /root/rpmbuild\nRUN sudo dnf clean all\nRUN wget http://winetricks.org/winetricks \\\n && sudo cp winetricks /usr/bin \\\n && sudo chmod +x /usr/bin/winetricks\n#   Install pkg-config for using in Wine and Windows\nRUN wget http://pkgconfig.freedesktop.org/releases/pkg-config-0.28.tar.gz \\\n && tar -xzf pkg-config-0.28.tar.gz \\\n && cd pkg-config-0.28 \\\n && mingw64-configure \\\n && make \\\n && sudo make install \\\n && make clean \\\n && rm -rf pkg-config-0.28.tar.gz pkg-config-0.28\n#   Fix the broken pkg-config files (it is important to use ${prefix} or they will not work\n#   when used on Windows or in Wine:\nRUN grep -lZ '^Cflags:.*-I/usr/x86_64-w64-mingw32/sys-root/mingw' /usr/x86_64-w64-mingw32/sys-root/mingw/lib/pkgconfig/*.pc | xargs -0 -l sudo sed -i.bak -e '/^Cflags:/ s|-I/usr/x86_64-w64-mingw32/sys-root/mingw|-I${prefix}|g'\n#   Initialize Wine:\nRUN wineboot \\\n && wine cmd /C echo \"Wine OK\" \\\n && wineserver -w \\\n && (export WINEPREFIX=~/.wine32 \\\n && export WINEARCH=win32 \\\n && wineboot \\\n && wine cmd /C echo \"Wine 32 OK\" \\\n && xvfb-run winetricks --unattended dotnet40 corefonts \\\n && wineserver -w )\nENV GHCVER=\"7.10.3\"\n#   Install Windows version of GHC (but not the old mingw that comes with it):\nRUN cd ~/.wine/drive_c \\\n && wget https://www.haskell.org/ghc/dist/$GHCVER/ghc-$GHCVER-x86_64-unknown-mingw32.tar.xz \\\n && tar -xJf ghc-$GHCVER-x86_64-unknown-mingw32.tar.xz \\\n && rm -rf ghc-*/mingw \\\n && rm ghc-*-x86_64-unknown-mingw32.tar.xz\n#   Use `wine regedit` to add a `Path` to `HKEY_CURRENT_USER\\Environment`:\nRUN (echo 'REGEDIT4' \\\n && echo \\\n && echo '[HKEY_CURRENT_USER\\Environment]' \\\n && echo '\"Path\"=\"C:\\\\users\\\\root\\\\Application Data\\\\cabal\\\\bin;C:\\\\ghc-'$GHCVER'\\\\bin;C:\\\\bin;Z:\\\\usr\\\\x86_64-w64-mingw32\\\\sys-root\\\\mingw\\\\bin;%PATH%\"' ) > Environment.reg \\\n && wine regedit Environment.reg \\\n && (echo 'REGEDIT4' \\\n && echo \\\n && echo '[HKEY_CURRENT_USER\\Environment]' \\\n && echo '\"Path\"=\"C:\\\\users\\\\root\\\\Application Data\\\\cabal\\\\bin;C:\\\\ghc-'$GHCVER'\\\\bin;C:\\\\bin;Z:\\\\usr\\\\i686-w64-mingw32\\\\sys-root\\\\mingw\\\\bin;%PATH%\"' ) > Environment.reg \\\n && (export WINEPREFIX=~/.wine32 \\\n && export WINEARCH=win32 \\\n && wine regedit Environment.reg \\\n && wineserver -w ) \\\n && rm Environment.reg\n#   Replace the MinGW that comes with GHC:\nRUN cd ~/.wine/drive_c/ghc-$GHCVER \\\n && wget http://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win64/Personal%20Builds/mingw-builds/4.9.2/threads-posix/seh/x86_64-4.9.2-release-posix-seh-rt_v4-rev2.7z \\\n && 7za x x86_64-4.9.2-release-posix-seh-rt_v4-rev2.7z \\\n && mv mingw64 mingw \\\n && rm -rf x86_64-4.9.2-release-posix-seh-rt_v4-rev2.7z\n#   Install WiX Toolset:\nADD wix39-binaries.zip /root/\nRUN mkdir ~/.wine32/drive_c/bin \\\n && cd ~/.wine32/drive_c/bin \\\n && unzip ~/wix39-binaries.zip \\\n && rm ~/wix39-binaries.zip\n#   Install 64bit Windows version of cabal-install:\nRUN mkdir ~/.wine/drive_c/bin \\\n && cd ~/.wine/drive_c/bin \\\n && wget http://leksah.org/packages/cabal-mingw64.7z \\\n && 7za x cabal-mingw64.7z \\\n && rm cabal-mingw64.7z\n#   Run `cabal update` and install some packages we will need.\n#   Some packages need us to run `mingw64-configure` manually (after `wine cabal configure` fails):\nRUN wineserver -p1 \\\n && cabal update \\\n && wine cabal update \\\n && wine cabal install Cabal \\\n && wine cabal install old-locale \\\n && cabal unpack network \\\n && cd network-* \\\n && (wine cabal configure || true ) \\\n && mingw64-configure \\\n && wine cabal build \\\n && wine cabal copy \\\n && wine cabal register \\\n && cd .. \\\n && cabal unpack old-time \\\n && cd old-time-* \\\n && (wine cabal configure || true ) \\\n && mingw64-configure \\\n && wine cabal build \\\n && wine cabal copy \\\n && wine cabal register \\\n && cd .. \\\n && wine cabal install alex happy \\\n && wine cabal install gtk2hs-buildtools \\\n && wineserver -w \\\n && rm -rf network-* old-time-*\n#   Install fonts to bundle with Leksah\nRUN sudo dnf -y install dejavu-sans-fonts dejavu-serif-fonts dejavu-sans-mono-fonts dejavu-lgc-sans-fonts dejavu-lgc-serif-fonts dejavu-lgc-sans-mono-fonts \\\n && sudo dnf clean all \\\n && mkdir -p ~/.wine32/drive_c/dejavu-fonts/ttf \\\n && ln -s /usr/share/fonts/dejavu/* ~/.wine32/drive_c/dejavu-fonts/ttf\n#   Install grep to bundle with Leksah:\nRUN mkdir grep \\\n && cd grep \\\n && wget http://sourceforge.net/projects/mingw/files/MSYS/Base/grep/grep-2.5.4-2/grep-2.5.4-2-msys-1.0.13-bin.tar.lzma \\\n && tar --lzma -xvf grep-2.5.4-2-msys-1.0.13-bin.tar.lzma \\\n && sudo cp bin/*grep.exe /usr/x86_64-w64-mingw32/sys-root/mingw/bin \\\n && rm grep-2.5.4-2-msys-1.0.13-bin.tar.lzma\nRUN wineserver -p1 \\\n && wine cabal update \\\n && wineserver -w\nRUN wineserver -p1 \\\n && wine cabal install shakespeare lens hlint hscolour \\\n && wineserver -w\nRUN git clone https://github.com/haskell-gi/haskell-gi-base.git \\\n && git clone https://github.com/haskell-gi/haskell-gi.git \\\n && git clone https://github.com/ghcjs/jsaddle.git \\\n && git clone https://github.com/ghcjs/jsaddle-dom.git \\\n && git clone https://github.com/ghcjs/ghcjs-dom.git\nRUN sudo dnf copr -y enable petersen/ghc-$GHCVER\nRUN sudo dnf install -y ghc cabal-install\nRUN cabal install happy alex\nRUN ghc-pkg list\nRUN cabal install ./haskell-gi-base ./haskell-gi --force-reinstalls\nRUN cd haskell-gi/bindings \\\n && LANG=en_GB.UTF-8 PATH=/root/.cabal/bin:$PATH ./genBindings.sh\n#   Add Leksah files to Docker:\nADD leksah.cabal LICENSE LICENSE.rtf Readme.md Setup.lhs SetupLocale.lhs sources.txt leksah/\n#   Docker has no way to COPY or ADD two directories at once!?!?\nADD bew leksah/bew\nADD data leksah/data\nADD doc leksah/doc\nADD language-specs leksah/language-specs\nADD linux leksah/linux\nADD main leksah/main\nADD osx leksah/osx\nADD pics leksah/pics\nADD po leksah/po\nADD scripts leksah/scripts\nADD src leksah/src\nADD tests leksah/tests\nADD vendor leksah/vendor\nADD win32 leksah/win32\nRUN wineserver -p1 \\\n && rm -rf haskell-gi-base/dist \\\n && wine cabal install ./haskell-gi-base ./haskell-gi/bindings/GLib ./haskell-gi/bindings/Gdk ./haskell-gi/bindings/Gtk ./haskell-gi/bindings/Atk ./haskell-gi/bindings/GdkPixbuf ./haskell-gi/bindings/Pango ./haskell-gi/bindings/Cairo ./haskell-gi/bindings/PangoCairo ./haskell-gi/bindings/WebKit ./haskell-gi/bindings/Gio ./haskell-gi/bindings/JavaScriptCore-3.0 ./haskell-gi/bindings/GtkSource ./haskell-gi/bindings/Notify ./haskell-gi/bindings/GObject ./haskell-gi/bindings/Soup \\\n && wineserver -w\nRUN git clone https://github.com/gtk2hs/gi-gtk-hs.git\nRUN wineserver -p1 \\\n && rm -rf haskell-gi-base/dist \\\n && wine cabal install ./gi-gtk-hs ./jsaddle ./jsaddle-dom ./ghcjs-dom ./leksah/vendor/haskellVCSGUI/vcsgui \\\n && wineserver -w\n#   Build leksah and make the MSI file:\nRUN wineserver -p1 \\\n && cd leksah \\\n && ./win32/makeinstaller.sh \\\n && wineserver -w\n","originalDockerfileUglifiedHash":"f52b974c395ef7f19853cf04fe79c19f","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/d4b2ebd6b4f4e25cb9e17af9af1ac21762d60286.dockerfile"}