{"seed":2909076967,"processedDockerfileHash":"5b63f6aa86603a2c295a34e93567c898","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   DO NOT EDIT: created by update.sh from Dockerfile-alpine.template\nFROM php:7.3-fpm-alpine3.9\n#   entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apk add rsync=3.1.3-r1 --no-cache ; rm /var/spool/cron/crontabs/root ; echo '*/15 * * * * php -f /var/www/html/cron.php' > /var/spool/cron/crontabs/www-data\n#   install the PHP extensions we need\n#   see https://docs.nextcloud.com/server/stable/admin_manual/installation/source_installation.html\nRUN set -ex ; apk add autoconf=2.69-r2 freetype-dev=2.9.1-r3 icu-dev=62.1-r1 libevent-dev=2.1.8-r6 libjpeg-turbo-dev=1.5.3-r6 libmcrypt-dev=2.5.8-r7 libpng-dev=1.6.37-r0 libmemcached-dev=1.0.18-r3 libxml2-dev=2.9.9-r3 libzip-dev=1.5.1-r2 openldap-dev=2.4.48-r2 pcre-dev=8.42-r2 postgresql-dev=11.11-r0 imagemagick-dev=7.0.8.68-r0 $PHPIZE_DEPS --no-cache --virtual .build-deps ; docker-php-ext-configure gd --with-freetype-dir=/usr --with-png-dir=/usr --with-jpeg-dir=/usr ; docker-php-ext-configure ldap ; docker-php-ext-install exif gd intl ldap opcache pcntl pdo_mysql pdo_pgsql zip ; pecl install APCu-5.1.17 ; pecl install memcached-3.1.3 ; pecl install redis-4.3.0 ; pecl install imagick-3.4.4 ; docker-php-ext-enable apcu memcached redis imagick ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local/lib/php/extensions | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add $runDeps --virtual .nextcloud-phpext-rundeps ; apk del .build-deps\n#   set recommended PHP.ini settings\n#   see https://docs.nextcloud.com/server/12/admin_manual/configuration_server/server_tuning.html#enable-php-opcache\nRUN { echo 'opcache.enable=1' ;echo 'opcache.enable_cli=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidate_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; echo 'memory_limit=512M' > /usr/local/etc/php/conf.d/memory-limit.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\nENV NEXTCLOUD_VERSION=\"16.0.1\"\nRUN set -ex ; apk add bzip2=1.0.6-r7 gnupg=2.2.19-r0 --no-cache --virtual .fetch-deps ; curl -fsSL -o nextcloud.tar.bz2 \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" ; curl -fsSL -o nextcloud.tar.bz2.asc \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 28806A878AE423A28372792ED75899B9A724937A ; gpg --batch --verify nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; tar -xjf nextcloud.tar.bz2 -C /usr/src/ ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; rm -rf /usr/src/nextcloud/updater ; mkdir -p /usr/src/nextcloud/data ; mkdir -p /usr/src/nextcloud/custom_apps ; chmod +x /usr/src/nextcloud/occ ; apk del .fetch-deps\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/nextcloud/config/\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"php-fpm\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n","originalDockerfile":"#  DO NOT EDIT: created by update.sh from Dockerfile-alpine.template\nFROM php:7.3-fpm-alpine3.9\n#  entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apk add --no-cache rsync ; rm /var/spool/cron/crontabs/root ; echo '*/15 * * * * php -f /var/www/html/cron.php' > /var/spool/cron/crontabs/www-data\n#  install the PHP extensions we need\n#  see https://docs.nextcloud.com/server/stable/admin_manual/installation/source_installation.html\nRUN set -ex ; apk add --no-cache --virtual .build-deps $PHPIZE_DEPS autoconf freetype-dev icu-dev libevent-dev libjpeg-turbo-dev libmcrypt-dev libpng-dev libmemcached-dev libxml2-dev libzip-dev openldap-dev pcre-dev postgresql-dev imagemagick-dev ; docker-php-ext-configure gd --with-freetype-dir=/usr --with-png-dir=/usr --with-jpeg-dir=/usr ; docker-php-ext-configure ldap ; docker-php-ext-install exif gd intl ldap opcache pcntl pdo_mysql pdo_pgsql zip ; pecl install APCu-5.1.17 ; pecl install memcached-3.1.3 ; pecl install redis-4.3.0 ; pecl install imagick-3.4.4 ; docker-php-ext-enable apcu memcached redis imagick ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local/lib/php/extensions | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add --virtual .nextcloud-phpext-rundeps $runDeps ; apk del .build-deps\n#  set recommended PHP.ini settings\n#  see https://docs.nextcloud.com/server/12/admin_manual/configuration_server/server_tuning.html#enable-php-opcache\nRUN { echo 'opcache.enable=1' ;echo 'opcache.enable_cli=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidate_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; echo 'memory_limit=512M' > /usr/local/etc/php/conf.d/memory-limit.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\nENV NEXTCLOUD_VERSION=\"16.0.1\"\nRUN set -ex ; apk add --no-cache --virtual .fetch-deps bzip2 gnupg ; curl -fsSL -o nextcloud.tar.bz2 \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" ; curl -fsSL -o nextcloud.tar.bz2.asc \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 28806A878AE423A28372792ED75899B9A724937A ; gpg --batch --verify nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; tar -xjf nextcloud.tar.bz2 -C /usr/src/ ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; rm -rf /usr/src/nextcloud/updater ; mkdir -p /usr/src/nextcloud/data ; mkdir -p /usr/src/nextcloud/custom_apps ; chmod +x /usr/src/nextcloud/occ ; apk del .fetch-deps\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/nextcloud/config/\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"php-fpm\"]\n","injectedSmells":[],"originalDockerfileHash":"3656edb24932cf451c67e300ad64fde7","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   DO NOT EDIT: created by update.sh from Dockerfile-alpine.template\nFROM php:7.3-fpm-alpine3.9\n#   entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apk add --no-cache rsync ; rm /var/spool/cron/crontabs/root ; echo '*/15 * * * * php -f /var/www/html/cron.php' > /var/spool/cron/crontabs/www-data\n#   install the PHP extensions we need\n#   see https://docs.nextcloud.com/server/stable/admin_manual/installation/source_installation.html\nRUN set -ex ; apk add --no-cache --virtual .build-deps $PHPIZE_DEPS autoconf freetype-dev icu-dev libevent-dev libjpeg-turbo-dev libmcrypt-dev libpng-dev libmemcached-dev libxml2-dev libzip-dev openldap-dev pcre-dev postgresql-dev imagemagick-dev ; docker-php-ext-configure gd --with-freetype-dir=/usr --with-png-dir=/usr --with-jpeg-dir=/usr ; docker-php-ext-configure ldap ; docker-php-ext-install exif gd intl ldap opcache pcntl pdo_mysql pdo_pgsql zip ; pecl install APCu-5.1.17 ; pecl install memcached-3.1.3 ; pecl install redis-4.3.0 ; pecl install imagick-3.4.4 ; docker-php-ext-enable apcu memcached redis imagick ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local/lib/php/extensions | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add --virtual .nextcloud-phpext-rundeps $runDeps ; apk del .build-deps\n#   set recommended PHP.ini settings\n#   see https://docs.nextcloud.com/server/12/admin_manual/configuration_server/server_tuning.html#enable-php-opcache\nRUN { echo 'opcache.enable=1' ;echo 'opcache.enable_cli=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidate_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; echo 'memory_limit=512M' > /usr/local/etc/php/conf.d/memory-limit.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\nENV NEXTCLOUD_VERSION=\"16.0.1\"\nRUN set -ex ; apk add --no-cache --virtual .fetch-deps bzip2 gnupg ; curl -fsSL -o nextcloud.tar.bz2 \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" ; curl -fsSL -o nextcloud.tar.bz2.asc \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 28806A878AE423A28372792ED75899B9A724937A ; gpg --batch --verify nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; tar -xjf nextcloud.tar.bz2 -C /usr/src/ ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; rm -rf /usr/src/nextcloud/updater ; mkdir -p /usr/src/nextcloud/data ; mkdir -p /usr/src/nextcloud/custom_apps ; chmod +x /usr/src/nextcloud/occ ; apk del .fetch-deps\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/nextcloud/config/\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"php-fpm\"]\n","originalDockerfileUglifiedHash":"923b45674cfe05a36964b9a3414707ab","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/c8158c1d9ffcad151573cff4d5c9830dfe54aa65.dockerfile"}