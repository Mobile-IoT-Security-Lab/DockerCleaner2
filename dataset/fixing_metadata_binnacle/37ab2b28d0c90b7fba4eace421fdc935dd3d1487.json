{"seed":4094230065,"processedDockerfileHash":"5859771de97292745ba802169d7c2c26","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM debian:9 AS builder\nRUN apt-get update \\\n && apt-get install --no-install-recommends gcc libc6-dev -y\nCOPY /docker/common/src /src\nRUN gcc -Wall -DCOMMAND='\"/bootstrap/start-systemd.sh\"' -o /systemd-wrapper /src/start-setuid.c\n#  ####\nFROM debian:9\nARG SALT_VERSION\nARG SALT_PATH\nARG PYZMQ_VERSION\nARG PYTHON_APT_VERSION\nARG TRACE\nARG OS\nARG OS_TYPE\nLABEL maintainer=\"Hortonworks\"\nARG SYSTEMCTL=https://raw.githubusercontent.com/hortonworks/docker-systemctl-replacement/3a885817b377f0307bd03d82323fa5749136de8f/files/docker/systemctl.py\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV TERM=\"linux\"\nENV PS1=\"\\\"[\\u@cloudbreak \\W]\\$ \\\"\"\n#   Set default shell to bash\nSHELL [\"/bin/bash\", \"-c\"]\n#   Install packages\nRUN apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https ca-certificates cron curl gnupg2 initscripts iproute2 python-minimal ssh sudo systemd -y \\\n && rm -rf /var/lib/apt/lists/*\n#   Unneeded systemd services\nRUN (cd /lib/systemd/system/sysinit.target.wants \\\n && ls | grep -v systemd-tmpfiles-setup.service | xargs rm ) \\\n && rm -f /lib/systemd/system/multi-user.target.wants/* \\\n && rm -f /lib/systemd/system/local-fs.target.wants/* \\\n && rm -f /lib/systemd/system/sockets.target.wants/*udev* \\\n && rm -f /lib/systemd/system/sockets.target.wants/*initctl* \\\n && rm -f /lib/systemd/system/basic.target.wants/* \\\n && rm -f /etc/systemd/system/*.wants/*\n#   Replace systemctl during SaltStack provisioning\nRUN dpkg-divert --add --rename /bin/systemctl \\\n && curl -s -o /bin/systemctl $SYSTEMCTL \\\n && chmod 755 /bin/systemctl\n#   SaltStack provisioning\nCOPY /saltstack/ /tmp/saltstack/\nCOPY /repos/ /tmp/repos/\nCOPY /scripts/ /tmp/scripts/\nCOPY /scripts/salt_requirements.txt /tmp/salt_requirements.txt\nCOPY docker/common/_grains/ /tmp/saltstack/base/salt/_grains/\nCOPY docker/common/_grains/ /tmp/saltstack/hortonworks/salt/_grains/\nRUN printf '\\n\\nproviders:\\n service: systemd\\n' >> /tmp/saltstack/config/minion\nRUN /tmp/scripts/salt-install.sh debian\nRUN /tmp/scripts/salt-setup.sh hortonworks\n#   Fix SaltStack init autodiscovery\nRUN printf '\\n\\nproviders:\\n service: systemd\\n' >> /etc/salt/minion\nCOPY docker/common/_grains/ /srv/salt/_grains/\n#   Fix startup problems for Type=notify systemd services\nCOPY docker/common/systemd-fix.service /etc/systemd/system/\nRUN systemctl enable systemd-fix\n#   Undo systemctl replacement\nRUN rm /bin/systemctl \\\n && dpkg-divert --remove --rename /bin/systemctl\n#   Fix ssh login and salt-api auth problems\nRUN rm /lib/systemd/system/rmnologin.service \\\n && sed -i 's/#\\?DELAYLOGIN=.*/DELAYLOGIN=yes/' /etc/default/rcS\n#   Ycloud integration\nRUN groupmod -g 99 nogroup \\\n && usermod -u 99 -g nogroup nobody\n#   CloudBreak expects /bootstrap/start-systemd as an entrypoint\nCOPY docker/common/start-systemd.sh /bootstrap/start-systemd.sh\nCOPY --from=builder /systemd-wrapper /bootstrap/start-systemd\nRUN chown root:nogroup /bootstrap/start-systemd \\\n && chmod 4750 /bootstrap/start-systemd\nRUN systemctl enable ssh cron\nEXPOSE 22/tcp\nCMD [\"/bootstrap/start-systemd\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM debian:9 AS builder\nRUN apt-get update \\\n && apt-get install --no-install-recommends gcc libc6-dev -y\nCOPY /docker/common/src /src\nRUN gcc -Wall -DCOMMAND='\"/bootstrap/start-systemd.sh\"' -o /systemd-wrapper /src/start-setuid.c\n# ####\nFROM debian:9\nARG SALT_VERSION\nARG SALT_PATH\nARG PYZMQ_VERSION\nARG PYTHON_APT_VERSION\nARG TRACE\nARG OS\nARG OS_TYPE\nLABEL maintainer=\"Hortonworks\"\nARG SYSTEMCTL=https://raw.githubusercontent.com/hortonworks/docker-systemctl-replacement/3a885817b377f0307bd03d82323fa5749136de8f/files/docker/systemctl.py\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV TERM=\"linux\"\nENV PS1=\"\\\"[\\u@cloudbreak \\W]\\$ \\\"\"\n#  Set default shell to bash\nSHELL [\"/bin/bash\", \"-c\"]\n#  Install packages\nRUN apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https ca-certificates cron curl gnupg2 initscripts iproute2 python-minimal ssh sudo systemd -y \\\n && rm -rf /var/lib/apt/lists/*\n#  Unneeded systemd services\nRUN (cd /lib/systemd/system/sysinit.target.wants \\\n && ls | grep -v systemd-tmpfiles-setup.service | xargs rm ) \\\n && rm -f /lib/systemd/system/multi-user.target.wants/* \\\n && rm -f /lib/systemd/system/local-fs.target.wants/* \\\n && rm -f /lib/systemd/system/sockets.target.wants/*udev* \\\n && rm -f /lib/systemd/system/sockets.target.wants/*initctl* \\\n && rm -f /lib/systemd/system/basic.target.wants/* \\\n && rm -f /etc/systemd/system/*.wants/*\n#  Replace systemctl during SaltStack provisioning\nRUN dpkg-divert --add --rename /bin/systemctl \\\n && curl -s -o /bin/systemctl $SYSTEMCTL \\\n && chmod 755 /bin/systemctl\n#  SaltStack provisioning\nCOPY /saltstack/ /tmp/saltstack/\nCOPY /repos/ /tmp/repos/\nCOPY /scripts/ /tmp/scripts/\nCOPY /scripts/salt_requirements.txt /tmp/salt_requirements.txt\nCOPY docker/common/_grains/ /tmp/saltstack/base/salt/_grains/\nCOPY docker/common/_grains/ /tmp/saltstack/hortonworks/salt/_grains/\nRUN printf '\\n\\nproviders:\\n service: systemd\\n' >> /tmp/saltstack/config/minion\nRUN /tmp/scripts/salt-install.sh debian\nRUN /tmp/scripts/salt-setup.sh hortonworks\n#  Fix SaltStack init autodiscovery\nRUN printf '\\n\\nproviders:\\n service: systemd\\n' >> /etc/salt/minion\nCOPY docker/common/_grains/ /srv/salt/_grains/\n#  Fix startup problems for Type=notify systemd services\nCOPY docker/common/systemd-fix.service /etc/systemd/system/\nRUN systemctl enable systemd-fix\n#  Undo systemctl replacement\nRUN rm /bin/systemctl \\\n && dpkg-divert --remove --rename /bin/systemctl\n#  Fix ssh login and salt-api auth problems\nRUN rm /lib/systemd/system/rmnologin.service \\\n && sed -i 's/#\\?DELAYLOGIN=.*/DELAYLOGIN=yes/' /etc/default/rcS\n#  Ycloud integration\nRUN groupmod -g 99 nogroup \\\n && usermod -u 99 -g nogroup nobody\n#  CloudBreak expects /bootstrap/start-systemd as an entrypoint\nCOPY docker/common/start-systemd.sh /bootstrap/start-systemd.sh\nCOPY --from=builder /systemd-wrapper /bootstrap/start-systemd\nRUN chown root:nogroup /bootstrap/start-systemd \\\n && chmod 4750 /bootstrap/start-systemd\nRUN systemctl enable ssh cron\nEXPOSE 22/tcp\nCMD [\"/bootstrap/start-systemd\"]\n","injectedSmells":[],"originalDockerfileHash":"89e5ff1501cce2140e66dff7f408fe31","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM debian:9 AS builder\nRUN apt-get update \\\n && apt-get install --no-install-recommends gcc libc6-dev -y\nCOPY /docker/common/src /src\nRUN gcc -Wall -DCOMMAND='\"/bootstrap/start-systemd.sh\"' -o /systemd-wrapper /src/start-setuid.c\n#  ####\nFROM debian:9\nARG SALT_VERSION\nARG SALT_PATH\nARG PYZMQ_VERSION\nARG PYTHON_APT_VERSION\nARG TRACE\nARG OS\nARG OS_TYPE\nLABEL maintainer=\"Hortonworks\"\nARG SYSTEMCTL=https://raw.githubusercontent.com/hortonworks/docker-systemctl-replacement/3a885817b377f0307bd03d82323fa5749136de8f/files/docker/systemctl.py\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV TERM=\"linux\"\nENV PS1=\"\\\"[\\u@cloudbreak \\W]\\$ \\\"\"\n#   Set default shell to bash\nSHELL [\"/bin/bash\", \"-c\"]\n#   Install packages\nRUN apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https ca-certificates cron curl gnupg2 initscripts iproute2 python-minimal ssh sudo systemd -y \\\n && rm -rf /var/lib/apt/lists/*\n#   Unneeded systemd services\nRUN (cd /lib/systemd/system/sysinit.target.wants \\\n && ls | grep -v systemd-tmpfiles-setup.service | xargs rm ) \\\n && rm -f /lib/systemd/system/multi-user.target.wants/* \\\n && rm -f /lib/systemd/system/local-fs.target.wants/* \\\n && rm -f /lib/systemd/system/sockets.target.wants/*udev* \\\n && rm -f /lib/systemd/system/sockets.target.wants/*initctl* \\\n && rm -f /lib/systemd/system/basic.target.wants/* \\\n && rm -f /etc/systemd/system/*.wants/*\n#   Replace systemctl during SaltStack provisioning\nRUN dpkg-divert --add --rename /bin/systemctl \\\n && curl -s -o /bin/systemctl $SYSTEMCTL \\\n && chmod 755 /bin/systemctl\n#   SaltStack provisioning\nCOPY /saltstack/ /tmp/saltstack/\nCOPY /repos/ /tmp/repos/\nCOPY /scripts/ /tmp/scripts/\nCOPY /scripts/salt_requirements.txt /tmp/salt_requirements.txt\nCOPY docker/common/_grains/ /tmp/saltstack/base/salt/_grains/\nCOPY docker/common/_grains/ /tmp/saltstack/hortonworks/salt/_grains/\nRUN printf '\\n\\nproviders:\\n service: systemd\\n' >> /tmp/saltstack/config/minion\nRUN /tmp/scripts/salt-install.sh debian\nRUN /tmp/scripts/salt-setup.sh hortonworks\n#   Fix SaltStack init autodiscovery\nRUN printf '\\n\\nproviders:\\n service: systemd\\n' >> /etc/salt/minion\nCOPY docker/common/_grains/ /srv/salt/_grains/\n#   Fix startup problems for Type=notify systemd services\nCOPY docker/common/systemd-fix.service /etc/systemd/system/\nRUN systemctl enable systemd-fix\n#   Undo systemctl replacement\nRUN rm /bin/systemctl \\\n && dpkg-divert --remove --rename /bin/systemctl\n#   Fix ssh login and salt-api auth problems\nRUN rm /lib/systemd/system/rmnologin.service \\\n && sed -i 's/#\\?DELAYLOGIN=.*/DELAYLOGIN=yes/' /etc/default/rcS\n#   Ycloud integration\nRUN groupmod -g 99 nogroup \\\n && usermod -u 99 -g nogroup nobody\n#   CloudBreak expects /bootstrap/start-systemd as an entrypoint\nCOPY docker/common/start-systemd.sh /bootstrap/start-systemd.sh\nCOPY --from=builder /systemd-wrapper /bootstrap/start-systemd\nRUN chown root:nogroup /bootstrap/start-systemd \\\n && chmod 4750 /bootstrap/start-systemd\nRUN systemctl enable ssh cron\nEXPOSE 22/tcp\nCMD [\"/bootstrap/start-systemd\"]\n","originalDockerfileUglifiedHash":"0f1d74a38d6961fc68333ef94198b473","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/37ab2b28d0c90b7fba4eace421fdc935dd3d1487.dockerfile"}