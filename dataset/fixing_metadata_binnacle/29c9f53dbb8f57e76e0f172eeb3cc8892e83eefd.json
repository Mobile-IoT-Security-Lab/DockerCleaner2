{"seed":3940902721,"processedDockerfileHash":"c0b921acb81910024f2153ab0c73256d","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"#  ######\n#   Debian Jessie build of Koha - Use locally build debian packages\n#  ######\nFROM debian:jessie\nMAINTAINER Oslo Public Library \"digitalutvikling@gmail.com\"\nENV REFRESHED_AT=\"2017-01-23\"\nRUN echo \"APT::Acquire::Retries \\\"3\\\";\" > /etc/apt/apt.conf.d/80-retries\nRUN DEBIAN_FRONTEND=noninteractive apt-get update \\\n && apt-get upgrade --yes \\\n && apt-get install --no-install-recommends wget less curl git nmap socat netcat tree htop unzip python-software-properties libswitch-perl libnet-ssleay-perl libcrypt-ssleay-perl apache2 supervisor inetutils-syslogd -y \\\n && apt-get clean\nARG KOHA_RELEASE\nENV KOHA_ADMINUSER=\"admin\"\nENV KOHA_ADMINPASS=\"secret\"\nENV KOHA_INSTANCE=\"name\"\nENV KOHA_ZEBRAUSER=\"zebrauser\"\nENV KOHA_ZEBRAPASS=\"lkjasdpoiqrr\"\n#  ######\n#   Mysql config for initial db\n#  ######\nRUN echo \"mysql-server mysql-server/root_password password $KOHA_ADMINPASS\" | debconf-set-selections \\\n && echo \"mysql-server mysql-server/root_password_again password $KOHA_ADMINPASS\" | debconf-set-selections \\\n && apt-get install --no-install-recommends mysql-server -y \\\n && sed \"/max_allowed_packet/c\\*/max_allowed_packet = 64M\" /etc/mysql/my.cnf \\\n && sed \"/wait_timeout/c\\*/wait_timeout = 6000\" /etc/mysql/my.cnf\n#  #######\n#   Files and templates\n#  #######\n#   Global files\nCOPY ./files/local-apt-repo /etc/apt/preferences.d/local-apt-repo\n#   Install Koha Common\nCOPY ./koha-patched/debian /tmp/debian\nRUN sed -i \"s/httpredir.debian.org/`curl -s -D - http://httpredir.debian.org/demo/debian/ | awk '/^Link:/ { print $2 }' | sed -e 's@<http://\\\\(.*\\\\)/debian/>;@\\\\1@g' `/\" /etc/apt/sources.list \\\n && echo \"search deich.folkebibl.no guest.oslo.kommune.no\\nnameserver 10.172.2.1\\nnameserver 8.8.8.8\\nnameserver 8.8.4.4\" > /etc/resolv.conf \\\n && echo \"deb http://static.deichman.no/repositories/koha/public/ wheezy main\" > /etc/apt/sources.list.d/deichman.list \\\n && echo \"deb http://debian.koha-community.org/koha stable main\" > /etc/apt/sources.list.d/koha.list \\\n && wget -q -O- http://debian.koha-community.org/koha/gpg.asc | apt-key add - \\\n && dpkg -i /tmp/debian/koha_${KOHA_RELEASE}_all.deb || apt-get install --no-install-recommends --fix-broken -y \\\n && dpkg -i /tmp/debian/koha-perldeps_${KOHA_RELEASE}_all.deb || apt-get install --no-install-recommends --fix-broken -y \\\n && dpkg -i /tmp/debian/koha-deps_${KOHA_RELEASE}_all.deb || apt-get install --no-install-recommends --fix-broken -y \\\n && dpkg -i /tmp/debian/koha-common_${KOHA_RELEASE}_all.deb || apt-get install --no-install-recommends --fix-broken -y\n#   Script and deps for checking if koha is up & ready (to be executed using docker exec)\nCOPY docker-wait_until_ready.py /root/wait_until_ready.py\nRUN apt-get install --no-install-recommends python-requests -y \\\n && apt-get clean\n#   Missing perl dependencies\nRUN apt-get update \\\n && apt-get install --no-install-recommends libwww-csrf-perl libpath-tiny-perl libhtml-strip-perl libipc-run3-perl paps -y \\\n && apt-get clean\n#   NCIP Server and dependencies\nCOPY ./files/NCIPServer /NCIPServer\nRUN apt-get update \\\n && apt-get install --no-install-recommends libdancer-perl libobject-tiny-perl libxml-libxml-simple-perl libconfig-merge-perl -y \\\n && apt-get clean\n#   Installer files\nCOPY ./files/installer /installer\n#   Templates\nCOPY ./files/templates /templates\n#   Cronjobs\nCOPY ./files/cronjobs /cronjobs\n#   Apache settings\nRUN echo \"\\nListen 8080\\nListen 8081\" | tee /etc/apache2/ports.conf \\\n && a2dissite 000-default \\\n && a2enmod rewrite headers proxy_http cgi remoteip\n#   LinkMobiblity SMS Driver - SMS modules need to be in shared perl libs\nRUN mkdir -p /usr/share/perl5/SMS/Send/NO \\\n && cp /usr/share/koha/intranet/cgi-bin/sms/LinkMobilityHTTP.pm /usr/share/perl5/SMS/Send/NO/LinkMobilityHTTP.pm\n#   Template for batch print notices\nRUN cp /templates/global/print-notices-deichman.tt /usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/modules/batch/\n#   Koha SIP2 server\nENV SIP_PORT=\"6001\"\nENV SIP_WORKERS=\"3\"\n#   Set local timezone\nRUN echo \"Europe/Oslo\" > /etc/timezone \\\n && dpkg-reconfigure -f noninteractive tzdata\n#  ############\n#   WORKAROUNDS\n#  ############\n#   CAS bug workaround\nCOPY ./files/Authen_CAS_Client_Response_Failure.pm /usr/share/perl5/Authen/CAS/Client/Response/Failure.pm\nCOPY ./files/Authen_CAS_Client_Response_Success.pm /usr/share/perl5/Authen/CAS/Client/Response/Success.pm\nENV HOME=\"/root\"\nWORKDIR /root\n#  ############\n#   LOGGING AND CRON\n#  ############\nCOPY ./files/logrotate.config /etc/logrotate.d/syslog.conf\nCOPY ./files/syslog.config /etc/syslog.conf\n#   Cronjob for sending print notices to print service\nCOPY ./files/cronjobs/brevdue.pl /usr/share/koha/bin/cronjobs/brevdue.pl\nRUN chmod 0755 /usr/share/koha/bin/cronjobs/brevdue.pl\n#   Override nightly and hourly run koha cron jobs\nCOPY ./files/cronjobs/daily-koha-common /etc/cron.daily/koha-common\nRUN chmod 0755 /etc/cron.daily/koha-common \\\n && rm -rf /etc/cron.hourly/koha-common\nCOPY docker-entrypoint.sh /root/entrypoint.sh\nENTRYPOINT [\"/root/entrypoint.sh\"]\nEXPOSE 6001/tcp 8080/tcp 8081/tcp\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# ######\n#  Debian Jessie build of Koha - Use locally build debian packages\n# ######\nFROM debian:jessie\nMAINTAINER Oslo Public Library \"digitalutvikling@gmail.com\"\nENV REFRESHED_AT=\"2017-01-23\"\nRUN echo \"APT::Acquire::Retries \\\"3\\\";\" > /etc/apt/apt.conf.d/80-retries\nRUN DEBIAN_FRONTEND=noninteractive apt-get update \\\n && apt-get upgrade --yes \\\n && apt-get install wget less curl git nmap socat netcat tree htop unzip python-software-properties libswitch-perl libnet-ssleay-perl libcrypt-ssleay-perl apache2 supervisor inetutils-syslogd -y \\\n && apt-get clean\nARG KOHA_RELEASE\nENV KOHA_ADMINUSER=\"admin\"\nENV KOHA_ADMINPASS=\"secret\"\nENV KOHA_INSTANCE=\"name\"\nENV KOHA_ZEBRAUSER=\"zebrauser\"\nENV KOHA_ZEBRAPASS=\"lkjasdpoiqrr\"\n# ######\n#  Mysql config for initial db\n# ######\nRUN echo \"mysql-server mysql-server/root_password password $KOHA_ADMINPASS\" | debconf-set-selections \\\n && echo \"mysql-server mysql-server/root_password_again password $KOHA_ADMINPASS\" | debconf-set-selections \\\n && apt-get install mysql-server -y \\\n && sed \"/max_allowed_packet/c\\*/max_allowed_packet = 64M\" /etc/mysql/my.cnf \\\n && sed \"/wait_timeout/c\\*/wait_timeout = 6000\" /etc/mysql/my.cnf\n# #######\n#  Files and templates\n# #######\n#  Global files\nCOPY ./files/local-apt-repo /etc/apt/preferences.d/local-apt-repo\n#  Install Koha Common\nADD ./koha-patched/debian /tmp/debian\nRUN sed -i \"s/httpredir.debian.org/`curl -s -D - http://httpredir.debian.org/demo/debian/ | awk '/^Link:/ { print $2 }' | sed -e 's@<http://\\\\(.*\\\\)/debian/>;@\\\\1@g' `/\" /etc/apt/sources.list \\\n && echo \"search deich.folkebibl.no guest.oslo.kommune.no\\nnameserver 10.172.2.1\\nnameserver 8.8.8.8\\nnameserver 8.8.4.4\" > /etc/resolv.conf \\\n && echo \"deb http://static.deichman.no/repositories/koha/public/ wheezy main\" > /etc/apt/sources.list.d/deichman.list \\\n && echo \"deb http://debian.koha-community.org/koha stable main\" > /etc/apt/sources.list.d/koha.list \\\n && wget -q -O- http://debian.koha-community.org/koha/gpg.asc | apt-key add - \\\n && dpkg -i /tmp/debian/koha_${KOHA_RELEASE}_all.deb || apt-get install --fix-broken -y \\\n && dpkg -i /tmp/debian/koha-perldeps_${KOHA_RELEASE}_all.deb || apt-get install --fix-broken -y \\\n && dpkg -i /tmp/debian/koha-deps_${KOHA_RELEASE}_all.deb || apt-get install --fix-broken -y \\\n && dpkg -i /tmp/debian/koha-common_${KOHA_RELEASE}_all.deb || apt-get install --fix-broken -y\n#  Script and deps for checking if koha is up & ready (to be executed using docker exec)\nCOPY docker-wait_until_ready.py /root/wait_until_ready.py\nRUN apt-get install python-requests -y \\\n && apt-get clean\n#  Missing perl dependencies\nRUN apt-get update \\\n && apt-get install libwww-csrf-perl libpath-tiny-perl libhtml-strip-perl libipc-run3-perl paps -y \\\n && apt-get clean\n#  NCIP Server and dependencies\nADD ./files/NCIPServer /NCIPServer\nRUN apt-get update \\\n && apt-get install libdancer-perl libobject-tiny-perl libxml-libxml-simple-perl libconfig-merge-perl -y \\\n && apt-get clean\n#  Installer files\nCOPY ./files/installer /installer\n#  Templates\nADD ./files/templates /templates\n#  Cronjobs\nCOPY ./files/cronjobs /cronjobs\n#  Apache settings\nRUN echo \"\\nListen 8080\\nListen 8081\" | tee /etc/apache2/ports.conf \\\n && a2dissite 000-default \\\n && a2enmod rewrite headers proxy_http cgi remoteip\n#  LinkMobiblity SMS Driver - SMS modules need to be in shared perl libs\nRUN mkdir -p /usr/share/perl5/SMS/Send/NO \\\n && cp /usr/share/koha/intranet/cgi-bin/sms/LinkMobilityHTTP.pm /usr/share/perl5/SMS/Send/NO/LinkMobilityHTTP.pm\n#  Template for batch print notices\nRUN cp /templates/global/print-notices-deichman.tt /usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/modules/batch/\n#  Koha SIP2 server\nENV SIP_PORT=\"6001\"\nENV SIP_WORKERS=\"3\"\n#  Set local timezone\nRUN echo \"Europe/Oslo\" > /etc/timezone \\\n && dpkg-reconfigure -f noninteractive tzdata\n# ############\n#  WORKAROUNDS\n# ############\n#  CAS bug workaround\nADD ./files/Authen_CAS_Client_Response_Failure.pm /usr/share/perl5/Authen/CAS/Client/Response/Failure.pm\nADD ./files/Authen_CAS_Client_Response_Success.pm /usr/share/perl5/Authen/CAS/Client/Response/Success.pm\nENV HOME=\"/root\"\nWORKDIR /root\n# ############\n#  LOGGING AND CRON\n# ############\nCOPY ./files/logrotate.config /etc/logrotate.d/syslog.conf\nCOPY ./files/syslog.config /etc/syslog.conf\n#  Cronjob for sending print notices to print service\nCOPY ./files/cronjobs/brevdue.pl /usr/share/koha/bin/cronjobs/brevdue.pl\nRUN chmod 0755 /usr/share/koha/bin/cronjobs/brevdue.pl\n#  Override nightly and hourly run koha cron jobs\nCOPY ./files/cronjobs/daily-koha-common /etc/cron.daily/koha-common\nRUN chmod 0755 /etc/cron.daily/koha-common \\\n && rm -rf /etc/cron.hourly/koha-common\nCOPY docker-entrypoint.sh /root/entrypoint.sh\nENTRYPOINT [\"/root/entrypoint.sh\"]\nEXPOSE 6001/tcp 8080/tcp 8081/tcp\n","injectedSmells":[],"originalDockerfileHash":"ea5eb90ce9604d2244e0353aeae56741","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  ######\n#   Debian Jessie build of Koha - Use locally build debian packages\n#  ######\nFROM debian:jessie\nMAINTAINER Oslo Public Library \"digitalutvikling@gmail.com\"\nENV REFRESHED_AT=\"2017-01-23\"\nRUN echo \"APT::Acquire::Retries \\\"3\\\";\" > /etc/apt/apt.conf.d/80-retries\nRUN DEBIAN_FRONTEND=noninteractive apt-get update \\\n && apt-get upgrade --yes \\\n && apt-get install wget less curl git nmap socat netcat tree htop unzip python-software-properties libswitch-perl libnet-ssleay-perl libcrypt-ssleay-perl apache2 supervisor inetutils-syslogd -y \\\n && apt-get clean\nARG KOHA_RELEASE\nENV KOHA_ADMINUSER=\"admin\"\nENV KOHA_ADMINPASS=\"secret\"\nENV KOHA_INSTANCE=\"name\"\nENV KOHA_ZEBRAUSER=\"zebrauser\"\nENV KOHA_ZEBRAPASS=\"lkjasdpoiqrr\"\n#  ######\n#   Mysql config for initial db\n#  ######\nRUN echo \"mysql-server mysql-server/root_password password $KOHA_ADMINPASS\" | debconf-set-selections \\\n && echo \"mysql-server mysql-server/root_password_again password $KOHA_ADMINPASS\" | debconf-set-selections \\\n && apt-get install mysql-server -y \\\n && sed \"/max_allowed_packet/c\\*/max_allowed_packet = 64M\" /etc/mysql/my.cnf \\\n && sed \"/wait_timeout/c\\*/wait_timeout = 6000\" /etc/mysql/my.cnf\n#  #######\n#   Files and templates\n#  #######\n#   Global files\nCOPY ./files/local-apt-repo /etc/apt/preferences.d/local-apt-repo\n#   Install Koha Common\nADD ./koha-patched/debian /tmp/debian\nRUN sed -i \"s/httpredir.debian.org/`curl -s -D - http://httpredir.debian.org/demo/debian/ | awk '/^Link:/ { print $2 }' | sed -e 's@<http://\\\\(.*\\\\)/debian/>;@\\\\1@g' `/\" /etc/apt/sources.list \\\n && echo \"search deich.folkebibl.no guest.oslo.kommune.no\\nnameserver 10.172.2.1\\nnameserver 8.8.8.8\\nnameserver 8.8.4.4\" > /etc/resolv.conf \\\n && echo \"deb http://static.deichman.no/repositories/koha/public/ wheezy main\" > /etc/apt/sources.list.d/deichman.list \\\n && echo \"deb http://debian.koha-community.org/koha stable main\" > /etc/apt/sources.list.d/koha.list \\\n && wget -q -O- http://debian.koha-community.org/koha/gpg.asc | apt-key add - \\\n && dpkg -i /tmp/debian/koha_${KOHA_RELEASE}_all.deb || apt-get install --fix-broken -y \\\n && dpkg -i /tmp/debian/koha-perldeps_${KOHA_RELEASE}_all.deb || apt-get install --fix-broken -y \\\n && dpkg -i /tmp/debian/koha-deps_${KOHA_RELEASE}_all.deb || apt-get install --fix-broken -y \\\n && dpkg -i /tmp/debian/koha-common_${KOHA_RELEASE}_all.deb || apt-get install --fix-broken -y\n#   Script and deps for checking if koha is up & ready (to be executed using docker exec)\nCOPY docker-wait_until_ready.py /root/wait_until_ready.py\nRUN apt-get install python-requests -y \\\n && apt-get clean\n#   Missing perl dependencies\nRUN apt-get update \\\n && apt-get install libwww-csrf-perl libpath-tiny-perl libhtml-strip-perl libipc-run3-perl paps -y \\\n && apt-get clean\n#   NCIP Server and dependencies\nADD ./files/NCIPServer /NCIPServer\nRUN apt-get update \\\n && apt-get install libdancer-perl libobject-tiny-perl libxml-libxml-simple-perl libconfig-merge-perl -y \\\n && apt-get clean\n#   Installer files\nCOPY ./files/installer /installer\n#   Templates\nADD ./files/templates /templates\n#   Cronjobs\nCOPY ./files/cronjobs /cronjobs\n#   Apache settings\nRUN echo \"\\nListen 8080\\nListen 8081\" | tee /etc/apache2/ports.conf \\\n && a2dissite 000-default \\\n && a2enmod rewrite headers proxy_http cgi remoteip\n#   LinkMobiblity SMS Driver - SMS modules need to be in shared perl libs\nRUN mkdir -p /usr/share/perl5/SMS/Send/NO \\\n && cp /usr/share/koha/intranet/cgi-bin/sms/LinkMobilityHTTP.pm /usr/share/perl5/SMS/Send/NO/LinkMobilityHTTP.pm\n#   Template for batch print notices\nRUN cp /templates/global/print-notices-deichman.tt /usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/modules/batch/\n#   Koha SIP2 server\nENV SIP_PORT=\"6001\"\nENV SIP_WORKERS=\"3\"\n#   Set local timezone\nRUN echo \"Europe/Oslo\" > /etc/timezone \\\n && dpkg-reconfigure -f noninteractive tzdata\n#  ############\n#   WORKAROUNDS\n#  ############\n#   CAS bug workaround\nADD ./files/Authen_CAS_Client_Response_Failure.pm /usr/share/perl5/Authen/CAS/Client/Response/Failure.pm\nADD ./files/Authen_CAS_Client_Response_Success.pm /usr/share/perl5/Authen/CAS/Client/Response/Success.pm\nENV HOME=\"/root\"\nWORKDIR /root\n#  ############\n#   LOGGING AND CRON\n#  ############\nCOPY ./files/logrotate.config /etc/logrotate.d/syslog.conf\nCOPY ./files/syslog.config /etc/syslog.conf\n#   Cronjob for sending print notices to print service\nCOPY ./files/cronjobs/brevdue.pl /usr/share/koha/bin/cronjobs/brevdue.pl\nRUN chmod 0755 /usr/share/koha/bin/cronjobs/brevdue.pl\n#   Override nightly and hourly run koha cron jobs\nCOPY ./files/cronjobs/daily-koha-common /etc/cron.daily/koha-common\nRUN chmod 0755 /etc/cron.daily/koha-common \\\n && rm -rf /etc/cron.hourly/koha-common\nCOPY docker-entrypoint.sh /root/entrypoint.sh\nENTRYPOINT [\"/root/entrypoint.sh\"]\nEXPOSE 6001/tcp 8080/tcp 8081/tcp\n","originalDockerfileUglifiedHash":"404ab96417144fade25d27134f19de67","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/29c9f53dbb8f57e76e0f172eeb3cc8892e83eefd.dockerfile"}