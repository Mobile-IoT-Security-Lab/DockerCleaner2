{"seed":2670644422,"processedDockerfileHash":"ae6c78d64285596b34404f705ba668de","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["have-a-healthcheck","have-a-user"],"processedDockerfile":"#  #############################################################################\n#   keylime TPM 2.0 Dockerfile\n#\n#   This file is for automatic test running of Keylime.\n#   It is not recommended for use beyond testing scenarios.\n#  #############################################################################\nFROM fedora:29\nMAINTAINER Luke Hinds <lhinds@redhat.com>\nLABEL version=\"3.0.0\" \\\n      description=\"Keylime - Bootstrapping and Maintaining Trust in the Cloud\"\nENV container=\"docker\"\n#   environment variables\nARG BRANCH=master\nENV container=\"docker\"\nENV HOME=\"/root\"\nENV KEYLIME_HOME=\"${HOME}/keylime\"\nENV TPM_HOME=\"${HOME}/swtpm2\"\nENV TPM2_TSS=\"${HOME}/tpm2-tss\"\nENV TPM2_TOOLS=\"${HOME}/tpm2-tools\"\nENV TPM2_ABRMD=\"${HOME}/tpm2-abrmd\"\nRUN useradd --system --user-group tss\n#   Packaged dependencies\nRUN dnf -y update\nRUN dnf -y install dnf-plugins-core --allowerasing\nRUN dnf -y builddep tpm2-tss\nRUN dnf -y builddep tpm2-tools\nRUN dnf -y install git dbus-devel golang openssl-devel python-devel python-pip python-setuptools python-tornado python-virtualenv python2-zmq python-yaml procps libtool tpm2-abrmd gcc make automake m2crypto redhat-rpm-config libselinux-python gnulib glib2-devel glib2-static uthash-devel wget which\nRUN dnf clean all\nRUN cd \"/lib/systemd/system/sysinit.target.wants/\" ; for i in *; do [ $i = systemd-tmpfiles-setup.service ] || rm -f \"$i\" ; done\nRUN rm -f /lib/systemd/system/multi-user.target.wants/* /etc/systemd/system/*.wants/* /lib/systemd/system/local-fs.target.wants/* /lib/systemd/system/sockets.target.wants/*udev* /lib/systemd/system/sockets.target.wants/*initctl* /lib/systemd/system/basic.target.wants/* /lib/systemd/system/anaconda.target.wants/*\nRUN systemctl set-default multi-user.target\nENV init=\"/lib/systemd/systemd\"\n#   TPM-TSS\nRUN git clone https://github.com/tpm2-software/tpm2-tss.git ${TPM2_TSS}\nWORKDIR ${TPM2_TSS}\nRUN ./bootstrap\nRUN ./configure --prefix=/usr --disable-doxygen-doc\nRUN make\nRUN make install\n#   TPM2-TOOLS\nRUN git clone https://github.com/keylime/tpm2-tools.git ${TPM2_TOOLS}\nWORKDIR ${TPM2_TOOLS}\nRUN ./bootstrap\nRUN SAPI_CFLAGS=' ' SAPI_LIBS='-ltss2-sys -L/usr/lib/' ./configure --prefix=/usr/local\nRUN make\nRUN make install\n#   Enable TPM-ABRMD service\nRUN git clone https://github.com/tpm2-software/tpm2-abrmd.git ${TPM2_ABRMD}\nWORKDIR ${TPM2_ABRMD}\nRUN ./bootstrap\nRUN TSS2_SYS_CFLAGS=' ' TSS2_SYS_LIBS='-ltss2-sys -L/usr/lib/' ./configure --prefix=/usr\nRUN make\nRUN make install\nRUN ldconfig\n#   Build and install TPM 2.0 simulator\nWORKDIR ${TPM_HOME}\nRUN wget --content-disposition http://sourceforge.net/projects/ibmswtpm2/files/ibmtpm1119.tar.gz/download\nRUN tar -zxvf ibmtpm1119.tar.gz\nWORKDIR ${TPM_HOME}/src\nRUN make\nRUN install -c tpm_server /usr/local/bin/tpm_server\nVOLUME [ \"/sys/fs/cgroup\" ]\nENTRYPOINT [\"/lib/systemd/systemd\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# #############################################################################\n#  keylime TPM 2.0 Dockerfile\n#\n#  This file is for automatic test running of Keylime.\n#  It is not recommended for use beyond testing scenarios.\n# #############################################################################\nFROM fedora:29\nMAINTAINER Luke Hinds <lhinds@redhat.com>\nLABEL version=\"3.0.0\" \\\n      description=\"Keylime - Bootstrapping and Maintaining Trust in the Cloud\"\nENV container=\"docker\"\n#  environment variables\nARG BRANCH=master\nENV container=\"docker\"\nENV HOME=\"/root\"\nENV KEYLIME_HOME=\"${HOME}/keylime\"\nENV TPM_HOME=\"${HOME}/swtpm2\"\nENV TPM2_TSS=\"${HOME}/tpm2-tss\"\nENV TPM2_TOOLS=\"${HOME}/tpm2-tools\"\nENV TPM2_ABRMD=\"${HOME}/tpm2-abrmd\"\nRUN useradd --system --user-group tss\n#  Packaged dependencies\nRUN dnf -y update\nRUN dnf -y install dnf-plugins-core --allowerasing\nRUN dnf -y builddep tpm2-tss\nRUN dnf -y builddep tpm2-tools\nRUN dnf -y install git dbus-devel golang openssl-devel python-devel python-pip python-setuptools python-tornado python-virtualenv python2-zmq python-yaml procps libtool tpm2-abrmd gcc make automake m2crypto redhat-rpm-config libselinux-python gnulib glib2-devel glib2-static uthash-devel wget which\nRUN dnf clean all\nRUN cd \"/lib/systemd/system/sysinit.target.wants/\" ; for i in *; do [ $i = systemd-tmpfiles-setup.service ] || rm -f \"$i\" ; done\nRUN rm -f /lib/systemd/system/multi-user.target.wants/* /etc/systemd/system/*.wants/* /lib/systemd/system/local-fs.target.wants/* /lib/systemd/system/sockets.target.wants/*udev* /lib/systemd/system/sockets.target.wants/*initctl* /lib/systemd/system/basic.target.wants/* /lib/systemd/system/anaconda.target.wants/*\nRUN systemctl set-default multi-user.target\nENV init=\"/lib/systemd/systemd\"\n#  TPM-TSS\nRUN git clone https://github.com/tpm2-software/tpm2-tss.git ${TPM2_TSS}\nWORKDIR ${TPM2_TSS}\nRUN ./bootstrap\nRUN ./configure --prefix=/usr --disable-doxygen-doc\nRUN make\nRUN make install\n#  TPM2-TOOLS\nRUN git clone https://github.com/keylime/tpm2-tools.git ${TPM2_TOOLS}\nWORKDIR ${TPM2_TOOLS}\nRUN ./bootstrap\nRUN SAPI_CFLAGS=' ' SAPI_LIBS='-ltss2-sys -L/usr/lib/' ./configure --prefix=/usr/local\nRUN make\nRUN make install\n#  Enable TPM-ABRMD service\nRUN git clone https://github.com/tpm2-software/tpm2-abrmd.git ${TPM2_ABRMD}\nWORKDIR ${TPM2_ABRMD}\nRUN ./bootstrap\nRUN TSS2_SYS_CFLAGS=' ' TSS2_SYS_LIBS='-ltss2-sys -L/usr/lib/' ./configure --prefix=/usr\nRUN make\nRUN make install\nRUN ldconfig\n#  Build and install TPM 2.0 simulator\nWORKDIR ${TPM_HOME}\nRUN wget --content-disposition http://sourceforge.net/projects/ibmswtpm2/files/ibmtpm1119.tar.gz/download\nRUN tar -zxvf ibmtpm1119.tar.gz\nWORKDIR ${TPM_HOME}/src\nRUN make\nRUN install -c tpm_server /usr/local/bin/tpm_server\nVOLUME [ \"/sys/fs/cgroup\" ]\nENTRYPOINT [\"/lib/systemd/systemd\"]\n","injectedSmells":[],"originalDockerfileHash":"291451bc038780211ee926299f2eccc6","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  #############################################################################\n#   keylime TPM 2.0 Dockerfile\n#\n#   This file is for automatic test running of Keylime.\n#   It is not recommended for use beyond testing scenarios.\n#  #############################################################################\nFROM fedora:29\nMAINTAINER Luke Hinds <lhinds@redhat.com>\nLABEL version=\"3.0.0\" \\\n      description=\"Keylime - Bootstrapping and Maintaining Trust in the Cloud\"\nENV container=\"docker\"\n#   environment variables\nARG BRANCH=master\nENV container=\"docker\"\nENV HOME=\"/root\"\nENV KEYLIME_HOME=\"${HOME}/keylime\"\nENV TPM_HOME=\"${HOME}/swtpm2\"\nENV TPM2_TSS=\"${HOME}/tpm2-tss\"\nENV TPM2_TOOLS=\"${HOME}/tpm2-tools\"\nENV TPM2_ABRMD=\"${HOME}/tpm2-abrmd\"\nRUN useradd --system --user-group tss\n#   Packaged dependencies\nRUN dnf -y update\nRUN dnf -y install dnf-plugins-core --allowerasing\nRUN dnf -y builddep tpm2-tss\nRUN dnf -y builddep tpm2-tools\nRUN dnf -y install git dbus-devel golang openssl-devel python-devel python-pip python-setuptools python-tornado python-virtualenv python2-zmq python-yaml procps libtool tpm2-abrmd gcc make automake m2crypto redhat-rpm-config libselinux-python gnulib glib2-devel glib2-static uthash-devel wget which\nRUN dnf clean all\nRUN cd \"/lib/systemd/system/sysinit.target.wants/\" ; for i in *; do [ $i = systemd-tmpfiles-setup.service ] || rm -f \"$i\" ; done\nRUN rm -f /lib/systemd/system/multi-user.target.wants/* /etc/systemd/system/*.wants/* /lib/systemd/system/local-fs.target.wants/* /lib/systemd/system/sockets.target.wants/*udev* /lib/systemd/system/sockets.target.wants/*initctl* /lib/systemd/system/basic.target.wants/* /lib/systemd/system/anaconda.target.wants/*\nRUN systemctl set-default multi-user.target\nENV init=\"/lib/systemd/systemd\"\n#   TPM-TSS\nRUN git clone https://github.com/tpm2-software/tpm2-tss.git ${TPM2_TSS}\nWORKDIR ${TPM2_TSS}\nRUN ./bootstrap\nRUN ./configure --prefix=/usr --disable-doxygen-doc\nRUN make\nRUN make install\n#   TPM2-TOOLS\nRUN git clone https://github.com/keylime/tpm2-tools.git ${TPM2_TOOLS}\nWORKDIR ${TPM2_TOOLS}\nRUN ./bootstrap\nRUN SAPI_CFLAGS=' ' SAPI_LIBS='-ltss2-sys -L/usr/lib/' ./configure --prefix=/usr/local\nRUN make\nRUN make install\n#   Enable TPM-ABRMD service\nRUN git clone https://github.com/tpm2-software/tpm2-abrmd.git ${TPM2_ABRMD}\nWORKDIR ${TPM2_ABRMD}\nRUN ./bootstrap\nRUN TSS2_SYS_CFLAGS=' ' TSS2_SYS_LIBS='-ltss2-sys -L/usr/lib/' ./configure --prefix=/usr\nRUN make\nRUN make install\nRUN ldconfig\n#   Build and install TPM 2.0 simulator\nWORKDIR ${TPM_HOME}\nRUN wget --content-disposition http://sourceforge.net/projects/ibmswtpm2/files/ibmtpm1119.tar.gz/download\nRUN tar -zxvf ibmtpm1119.tar.gz\nWORKDIR ${TPM_HOME}/src\nRUN make\nRUN install -c tpm_server /usr/local/bin/tpm_server\nVOLUME [ \"/sys/fs/cgroup\" ]\nENTRYPOINT [\"/lib/systemd/systemd\"]\n","originalDockerfileUglifiedHash":"b289f488370a8528f059ebe839a7c5d4","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/02f682967253dccfd58f511a972ccec5f9e5d42d.dockerfile"}