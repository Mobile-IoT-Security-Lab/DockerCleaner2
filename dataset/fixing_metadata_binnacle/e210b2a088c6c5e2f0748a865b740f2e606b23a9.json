{"seed":3647158274,"processedDockerfileHash":"24716bff724f79b8879d0214a5067fa9","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM phusion/baseimage:0.9.21\nLABEL maintainer=\"\\\"velaluqa GmbH <info@velalu.qa>\\\"\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN echo \"APT::Install-Recommends 0;\" >> /etc/apt/apt.conf.d/01-no-recommends \\\n && echo \"APT::Install-Suggests 0;\" >> /etc/apt/apt.conf.d/01-no-recommends\nRUN apt-get update -q \\\n && apt-get install --no-install-recommends apt-utils -y -q \\\n && apt-get install --no-install-recommends wget bzip2 dovecot-core dovecot-imapd dovecot-ldap dovecot-lmtpd dovecot-managesieved dovecot-mysql dovecot-pop3d dovecot-sieve iptables augeas-tools -y -q \\\n && apt-get clean\nENV IREDMAIL_VERSION=\"0.9.6\"\nARG HOSTNAME=mail\nARG DOMAIN\nRUN echo $DOMAIN > /etc/mailname \\\n && echo $HOSTNAME > /opt/hostname\nRUN mv /bin/uname /bin/uname_\nCOPY ./uname /bin/uname\nRUN mv /bin/hostname /bin/hostname_\nCOPY ./hostname /bin/hostname\nWORKDIR /opt/iredmail\nRUN wget -O - https://bitbucket.org/zhb/iredmail/downloads/iRedMail-\"${IREDMAIL_VERSION}\".tar.bz2 | tar xvj --strip-components=1 \\\n && echo \"export DOVECOT_USE_SYSLOG='NO'\" >> /opt/iredmail/conf/dovecot\nCOPY ./config ./\n#   Run iRedMail setup script\n#   Start and stop some services for environment setup (e.g. create folders in /var/run)\nRUN sed s/$( hostname_ ;)/$( cat /opt/hostname | xargs echo -n ;).$( cat /etc/mailname | xargs echo -n ;)/ /etc/hosts > /tmp/hosts_ \\\n && cat /tmp/hosts_ > /etc/hosts \\\n && rm /tmp/hosts_ \\\n && echo $HOSTNAME > /etc/hostname \\\n && apt-get install --no-install-recommends mysql-server -y -q \\\n && service mysql start \\\n && IREDMAIL_DEBUG='NO' CHECK_NEW_IREDMAIL='NO' AUTO_USE_EXISTING_CONFIG_FILE=y AUTO_INSTALL_WITHOUT_CONFIRM=y AUTO_CLEANUP_REMOVE_SENDMAIL=y AUTO_CLEANUP_REMOVE_MOD_PYTHON=y AUTO_CLEANUP_REPLACE_FIREWALL_RULES=n AUTO_CLEANUP_RESTART_IPTABLES=n AUTO_CLEANUP_REPLACE_MYSQL_CONFIG=y FIRST_DOMAIN=$DOMAIN bash iRedMail.sh \\\n && apt-get clean \\\n && /usr/lib/php/php7.0-fpm-checkconf ; service clamav-daemon start ; service clamav-daemon stop ; service amavis start ; service amavis stop ; service mysql stop ; ps aux\nWORKDIR /opt\n#   Update debian system config for mysql\nRUN bash -c \"source iredmail/config \\\n && sed -i s\\/password\\\\(\\ *\\\\).*\\/password\\1=\\ \\\"$MYSQL_ROOT_PASSWD\\\"\\/ /etc/mysql/debian.cnf \\\n && sed -i s\\/user\\\\(\\ *\\\\).*\\/user\\1=\\ root\\/ /etc/mysql/debian.cnf\"\nRUN mv /opt/iredmail/iRedMail.tips /opt \\\n && rm -rf /opt/iredmail /root/.bash_history \\\n && mv -f /bin/uname_ /bin/uname \\\n && mv -f /bin/hostname_ /bin/hostname\n#   Disable SSH and SSH fail2ban\nRUN rm -rf /etc/service/sshd /etc/my_init.d/00_regen_ssh_host_keys.sh \\\n && wget -qP /usr/share/augeas/lenses/dist https://raw.githubusercontent.com/vynt-kenshiro/augeas-lenses/master/fail2ban.aug \\\n && echo set /augeas/load/Fail2ban/incl[last\n#   Disable backups\nRUN sed -i '/\\/var\\/vmail\\/backup/d' /var/spool/cron/crontabs/root\n#   Use one DKIM key for all domains\nRUN sed -i s/^dkim_key\n#   Bounce banned emails instead of discarding them\nRUN sed -i \"s/=> 'DISCARD'],/=> 'BOUNCE'],/\" /etc/amavis/conf.d/50-user\n#   Amend config files for runsv compatibility\nRUN sed -i '/^Foreground /c Foreground true' /etc/clamav/clamd.conf \\\n && sed -i '/init.d/c pkill -sighup clamd' /etc/logrotate.d/clamav-daemon \\\n && sed -i '/^Foreground /c Foreground true' /etc/clamav/freshclam.conf\n#   Add syslog-ng configuration for openldap\nRUN echo \"destination d_openldap { file(\\\"/var/log/openldap.log\\\"); };\\nfilter f_openldap { facility(local4) and not filter(f_debug); };\\nlog { source(s_src); filter(f_openldap); destination(d_openldap); };\" > /etc/syslog-ng/conf.d/openldap.conf\n#   Copy runsv files\nCOPY services/iredapd.sh /etc/service/iredapd/run\nCOPY services/slapd.sh /etc/service/slapd/run\nCOPY services/mysql.sh /etc/service/mysql/run\nCOPY services/nginx.sh /etc/service/nginx/run\nCOPY services/dovecot.sh /etc/service/dovecot/run\nCOPY services/php-fpm.sh /etc/service/php-fpm/run\nCOPY services/postfix.sh /etc/service/postfix/run\nCOPY services/clamav-daemon.sh /etc/service/clamav-daemon/run\nCOPY services/amavis.sh /etc/service/amavis/run\nCOPY services/clamav-freshclam.sh /etc/service/clamav-freshclam/run\nCOPY services/uwsgi-iredadmin.sh /etc/service/uwsgi-iredadmin/run\nCOPY services/fail2ban.sh /etc/service/fail2ban/run\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM phusion/baseimage:0.9.21\nLABEL maintainer=\"\\\"velaluqa GmbH <info@velalu.qa>\\\"\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN echo \"APT::Install-Recommends 0;\" >> /etc/apt/apt.conf.d/01-no-recommends \\\n && echo \"APT::Install-Suggests 0;\" >> /etc/apt/apt.conf.d/01-no-recommends\nRUN apt-get update -q \\\n && apt-get install apt-utils -y -q \\\n && apt-get install wget bzip2 dovecot-core dovecot-imapd dovecot-ldap dovecot-lmtpd dovecot-managesieved dovecot-mysql dovecot-pop3d dovecot-sieve iptables augeas-tools -y -q \\\n && apt-get clean\nENV IREDMAIL_VERSION=\"0.9.6\"\nARG HOSTNAME=mail\nARG DOMAIN\nRUN echo $DOMAIN > /etc/mailname \\\n && echo $HOSTNAME > /opt/hostname\nRUN mv /bin/uname /bin/uname_\nCOPY ./uname /bin/uname\nRUN mv /bin/hostname /bin/hostname_\nCOPY ./hostname /bin/hostname\nWORKDIR /opt/iredmail\nRUN wget -O - https://bitbucket.org/zhb/iredmail/downloads/iRedMail-\"${IREDMAIL_VERSION}\".tar.bz2 | tar xvj --strip-components=1 \\\n && echo \"export DOVECOT_USE_SYSLOG='NO'\" >> /opt/iredmail/conf/dovecot\nCOPY ./config ./\n#  Run iRedMail setup script\n#  Start and stop some services for environment setup (e.g. create folders in /var/run)\nRUN sed s/$( hostname_ ;)/$( cat /opt/hostname | xargs echo -n ;).$( cat /etc/mailname | xargs echo -n ;)/ /etc/hosts > /tmp/hosts_ \\\n && cat /tmp/hosts_ > /etc/hosts \\\n && rm /tmp/hosts_ \\\n && echo $HOSTNAME > /etc/hostname \\\n && apt-get install mysql-server -y -q \\\n && service mysql start \\\n && IREDMAIL_DEBUG='NO' CHECK_NEW_IREDMAIL='NO' AUTO_USE_EXISTING_CONFIG_FILE=y AUTO_INSTALL_WITHOUT_CONFIRM=y AUTO_CLEANUP_REMOVE_SENDMAIL=y AUTO_CLEANUP_REMOVE_MOD_PYTHON=y AUTO_CLEANUP_REPLACE_FIREWALL_RULES=n AUTO_CLEANUP_RESTART_IPTABLES=n AUTO_CLEANUP_REPLACE_MYSQL_CONFIG=y FIRST_DOMAIN=$DOMAIN bash iRedMail.sh \\\n && apt-get clean \\\n && /usr/lib/php/php7.0-fpm-checkconf ; service clamav-daemon start ; service clamav-daemon stop ; service amavis start ; service amavis stop ; service mysql stop ; ps aux\nWORKDIR /opt\n#  Update debian system config for mysql\nRUN bash -c \"source iredmail/config \\\n && sed -i s\\/password\\\\\\(\\ *\\\\\\).*\\/password\\\\1=\\ \\\\\"$MYSQL_ROOT_PASSWD\\\\\"\\/ /etc/mysql/debian.cnf \\\n && sed -i s\\/user\\\\\\(\\ *\\\\\\).*\\/user\\\\1=\\ root\\/ /etc/mysql/debian.cnf\"\nRUN mv /opt/iredmail/iRedMail.tips /opt \\\n && rm -rf /opt/iredmail /root/.bash_history \\\n && mv -f /bin/uname_ /bin/uname \\\n && mv -f /bin/hostname_ /bin/hostname\n#  Disable SSH and SSH fail2ban\nRUN rm -rf /etc/service/sshd /etc/my_init.d/00_regen_ssh_host_keys.sh \\\n && wget -qP /usr/share/augeas/lenses/dist https://raw.githubusercontent.com/vynt-kenshiro/augeas-lenses/master/fail2ban.aug \\\n && echo set /augeas/load/Fail2ban/incl[last()+1] /etc/fail2ban/jail.local > /tmp/augscript \\\n && echo load >> /tmp/augscript \\\n && echo set /files/etc/fail2ban/jail.local/sshd/enabled false >> /tmp/augscript \\\n && echo set /files/etc/fail2ban/jail.local/sshd-ddos/enabled false >> /tmp/augscript \\\n && echo save >> /tmp/augscript \\\n && augtool -L -f /tmp/augscript \\\n && rm /tmp/augscript /usr/share/augeas/lenses/dist/fail2ban.aug\n#  Disable backups\nRUN sed -i '/\\/var\\/vmail\\/backup/d' /var/spool/cron/crontabs/root\n#  Use one DKIM key for all domains\nRUN sed -i s/^dkim_key(\\\"$DOMAIN\\\"/dkim_key(\\\"*\\\"/ /etc/amavis/conf.d/50-user\n#  Bounce banned emails instead of discarding them\nRUN sed -i \"s/=> 'DISCARD'],/=> 'BOUNCE'],/\" /etc/amavis/conf.d/50-user\n#  Amend config files for runsv compatibility\nRUN sed -i '/^Foreground /c Foreground true' /etc/clamav/clamd.conf \\\n && sed -i '/init.d/c pkill -sighup clamd' /etc/logrotate.d/clamav-daemon \\\n && sed -i '/^Foreground /c Foreground true' /etc/clamav/freshclam.conf\n#  Add syslog-ng configuration for openldap\nRUN echo \"destination d_openldap { file(\\\"/var/log/openldap.log\\\"); };\\nfilter f_openldap { facility(local4) and not filter(f_debug); };\\nlog { source(s_src); filter(f_openldap); destination(d_openldap); };\" > /etc/syslog-ng/conf.d/openldap.conf\n#  Copy runsv files\nADD services/iredapd.sh /etc/service/iredapd/run\nADD services/slapd.sh /etc/service/slapd/run\nADD services/mysql.sh /etc/service/mysql/run\nADD services/nginx.sh /etc/service/nginx/run\nADD services/dovecot.sh /etc/service/dovecot/run\nADD services/php-fpm.sh /etc/service/php-fpm/run\nADD services/postfix.sh /etc/service/postfix/run\nADD services/clamav-daemon.sh /etc/service/clamav-daemon/run\nADD services/amavis.sh /etc/service/amavis/run\nADD services/clamav-freshclam.sh /etc/service/clamav-freshclam/run\nADD services/uwsgi-iredadmin.sh /etc/service/uwsgi-iredadmin/run\nADD services/fail2ban.sh /etc/service/fail2ban/run\n","injectedSmells":[],"originalDockerfileHash":"2677179fbd57576ef95dd16fd9633802","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM phusion/baseimage:0.9.21\nLABEL maintainer=\"\\\"velaluqa GmbH <info@velalu.qa>\\\"\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\nRUN echo \"APT::Install-Recommends 0;\" >> /etc/apt/apt.conf.d/01-no-recommends \\\n && echo \"APT::Install-Suggests 0;\" >> /etc/apt/apt.conf.d/01-no-recommends\nRUN apt-get update -q \\\n && apt-get install apt-utils -y -q \\\n && apt-get install wget bzip2 dovecot-core dovecot-imapd dovecot-ldap dovecot-lmtpd dovecot-managesieved dovecot-mysql dovecot-pop3d dovecot-sieve iptables augeas-tools -y -q \\\n && apt-get clean\nENV IREDMAIL_VERSION=\"0.9.6\"\nARG HOSTNAME=mail\nARG DOMAIN\nRUN echo $DOMAIN > /etc/mailname \\\n && echo $HOSTNAME > /opt/hostname\nRUN mv /bin/uname /bin/uname_\nCOPY ./uname /bin/uname\nRUN mv /bin/hostname /bin/hostname_\nCOPY ./hostname /bin/hostname\nWORKDIR /opt/iredmail\nRUN wget -O - https://bitbucket.org/zhb/iredmail/downloads/iRedMail-\"${IREDMAIL_VERSION}\".tar.bz2 | tar xvj --strip-components=1 \\\n && echo \"export DOVECOT_USE_SYSLOG='NO'\" >> /opt/iredmail/conf/dovecot\nCOPY ./config ./\n#   Run iRedMail setup script\n#   Start and stop some services for environment setup (e.g. create folders in /var/run)\nRUN sed s/$( hostname_ ;)/$( cat /opt/hostname | xargs echo -n ;).$( cat /etc/mailname | xargs echo -n ;)/ /etc/hosts > /tmp/hosts_ \\\n && cat /tmp/hosts_ > /etc/hosts \\\n && rm /tmp/hosts_ \\\n && echo $HOSTNAME > /etc/hostname \\\n && apt-get install mysql-server -y -q \\\n && service mysql start \\\n && IREDMAIL_DEBUG='NO' CHECK_NEW_IREDMAIL='NO' AUTO_USE_EXISTING_CONFIG_FILE=y AUTO_INSTALL_WITHOUT_CONFIRM=y AUTO_CLEANUP_REMOVE_SENDMAIL=y AUTO_CLEANUP_REMOVE_MOD_PYTHON=y AUTO_CLEANUP_REPLACE_FIREWALL_RULES=n AUTO_CLEANUP_RESTART_IPTABLES=n AUTO_CLEANUP_REPLACE_MYSQL_CONFIG=y FIRST_DOMAIN=$DOMAIN bash iRedMail.sh \\\n && apt-get clean \\\n && /usr/lib/php/php7.0-fpm-checkconf ; service clamav-daemon start ; service clamav-daemon stop ; service amavis start ; service amavis stop ; service mysql stop ; ps aux\nWORKDIR /opt\n#   Update debian system config for mysql\nRUN bash -c \"source iredmail/config \\\n && sed -i s\\/password\\\\(\\ *\\\\).*\\/password\\1=\\ \\\"$MYSQL_ROOT_PASSWD\\\"\\/ /etc/mysql/debian.cnf \\\n && sed -i s\\/user\\\\(\\ *\\\\).*\\/user\\1=\\ root\\/ /etc/mysql/debian.cnf\"\nRUN mv /opt/iredmail/iRedMail.tips /opt \\\n && rm -rf /opt/iredmail /root/.bash_history \\\n && mv -f /bin/uname_ /bin/uname \\\n && mv -f /bin/hostname_ /bin/hostname\n#   Disable SSH and SSH fail2ban\nRUN rm -rf /etc/service/sshd /etc/my_init.d/00_regen_ssh_host_keys.sh \\\n && wget -qP /usr/share/augeas/lenses/dist https://raw.githubusercontent.com/vynt-kenshiro/augeas-lenses/master/fail2ban.aug \\\n && echo set /augeas/load/Fail2ban/incl[last\n#   Disable backups\nRUN sed -i '/\\/var\\/vmail\\/backup/d' /var/spool/cron/crontabs/root\n#   Use one DKIM key for all domains\nRUN sed -i s/^dkim_key\n#   Bounce banned emails instead of discarding them\nRUN sed -i \"s/=> 'DISCARD'],/=> 'BOUNCE'],/\" /etc/amavis/conf.d/50-user\n#   Amend config files for runsv compatibility\nRUN sed -i '/^Foreground /c Foreground true' /etc/clamav/clamd.conf \\\n && sed -i '/init.d/c pkill -sighup clamd' /etc/logrotate.d/clamav-daemon \\\n && sed -i '/^Foreground /c Foreground true' /etc/clamav/freshclam.conf\n#   Add syslog-ng configuration for openldap\nRUN echo \"destination d_openldap { file(\\\"/var/log/openldap.log\\\"); };\\nfilter f_openldap { facility(local4) and not filter(f_debug); };\\nlog { source(s_src); filter(f_openldap); destination(d_openldap); };\" > /etc/syslog-ng/conf.d/openldap.conf\n#   Copy runsv files\nADD services/iredapd.sh /etc/service/iredapd/run\nADD services/slapd.sh /etc/service/slapd/run\nADD services/mysql.sh /etc/service/mysql/run\nADD services/nginx.sh /etc/service/nginx/run\nADD services/dovecot.sh /etc/service/dovecot/run\nADD services/php-fpm.sh /etc/service/php-fpm/run\nADD services/postfix.sh /etc/service/postfix/run\nADD services/clamav-daemon.sh /etc/service/clamav-daemon/run\nADD services/amavis.sh /etc/service/amavis/run\nADD services/clamav-freshclam.sh /etc/service/clamav-freshclam/run\nADD services/uwsgi-iredadmin.sh /etc/service/uwsgi-iredadmin/run\nADD services/fail2ban.sh /etc/service/fail2ban/run\n","originalDockerfileUglifiedHash":"cacd9cbfdc233d1a4991ca8c233d7d22","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/e210b2a088c6c5e2f0748a865b740f2e606b23a9.dockerfile"}