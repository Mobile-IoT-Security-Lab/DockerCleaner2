{"seed":2936993286,"processedDockerfileHash":"60852ee166c4e908ef49d6eaf5fcd2ae","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM ubuntu:16.04\nENV ELASTICSEARCH_VERSION=\"5.5.2\"\nENV ELASTICSEARCH_DEB_VERSION=\"5.5.2\"\nENV GOSU_VERSION=\"1.10\"\nENV KIBANA_VERSION=\"5.5.2\"\nENV DOCKER_CE_VERSION=\"17.09.1\"\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US:en\"\nENV LC_ALL=\"en_US.UTF-8\"\n#   Elasticsearch and Kibana\nRUN set -ex \\\n && groupadd -r elasticsearch \\\n && useradd -r -m -g elasticsearch elasticsearch \\\n && groupadd -r kibana \\\n && useradd -r -m -g kibana kibana \\\n && apt-get update \\\n && apt-get install --no-install-recommends curl=7.47.0-1ubuntu2.19 locales=2.23-0ubuntu11.3 -y \\\n && locale-gen en_US.UTF-8 \\\n && apt-get install --no-install-recommends wget=1.17.1-1ubuntu1.5 supervisor=3.2.0-2ubuntu0.2 openjdk-8-jre=8u292-b10-0ubuntu1~16.04.1 unzip=6.0-20ubuntu1.1 -y\n#   grab gosu for easy step-down from root\nRUN set -x \\\n && wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;)\" \\\n && wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;).asc\" \\\n && export GNUPGHOME=\"$( mktemp -d ;)\" \\\n && gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu \\\n && rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && gosu nobody true\n#   KEYS\nRUN set -ex ; key='46095ACC8548582C1A2699A9D27D666CD88E42B4' ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; gpg --export \"$key\" > /etc/apt/trusted.gpg.d/elastic.gpg; rm -rf \"$GNUPGHOME\" ; apt-key list\n#   ELASTICSEACH\nRUN set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https=1.2.35 -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && echo 'deb https://artifacts.elastic.co/packages/5.x/apt stable main' > /etc/apt/sources.list.d/elasticsearch.list\nRUN set -x \\\n && dpkg-divert --rename /usr/lib/sysctl.d/elasticsearch.conf \\\n && apt-get update \\\n && apt-get install --no-install-recommends \"elasticsearch=$ELASTICSEARCH_DEB_VERSION\" -y \\\n && rm -rf /var/lib/apt/lists/*\nRUN for path in /usr/share/elasticsearch/data /usr/share/elasticsearch/logs /usr/share/elasticsearch/config /usr/share/elasticsearch/config/scripts; do mkdir -p \"$path\" ;chown -R elasticsearch:elasticsearch \"$path\" ; done \\\n && chown -R elasticsearch:elasticsearch /usr/share/elasticsearch\n#    Kibana\n#   https://www.elastic.co/guide/en/kibana/5.0/deb.htmls\nRUN set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends kibana=$KIBANA_VERSION -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && sed -ri \"s!^(\\#\\s*)?(server\\.host:).*!\\2 '0.0.0.0'!\" /etc/kibana/kibana.yml \\\n && grep -q \"^server\\.host: '0.0.0.0'$\" /etc/kibana/kibana.yml \\\n && sed -ri \"s!^(\\#\\s*)?(elasticsearch\\.url:).*!\\2 'http://elasticsearch:9200'!\" /etc/kibana/kibana.yml \\\n && grep -q \"^elasticsearch\\.url: 'http://elasticsearch:9200'$\" /etc/kibana/kibana.yml\n#   Docker CE\nRUN set -ex \\\n && curl -o /tmp/docker-ce.deb https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/docker-ce_${DOCKER_CE_VERSION}~ce-0~ubuntu_amd64.deb \\\n && apt-get update \\\n && apt-get install --no-install-recommends /tmp/docker-ce.deb -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && rm /tmp/docker-ce.deb\nENV PATH=\"/usr/share/elasticsearch/bin:$PATH\"\nENV PATH=\"/usr/share/kibana/bin:$PATH\"\nCOPY elasticsearch/elasticsearch.yml elasticsearch/log4j2.properties /usr/share/elasticsearch/config/\nCOPY kibana/kibana.yml /usr/share/kibana/config/kibana.yml\nCOPY kibana/start.sh /usr/share/kibana/bin/kibana-start\n#   setup Supervisord\nCOPY supervisord.conf /etc/supervisor/supervisord.conf\nEXPOSE 9200/tcp 9300/tcp\nEXPOSE 5601/tcp\nCMD [\"supervisord\", \"-n\", \"-c\", \"/etc/supervisor/supervisord.conf\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ubuntu:16.04\nENV ELASTICSEARCH_VERSION=\"5.5.2\"\nENV ELASTICSEARCH_DEB_VERSION=\"5.5.2\"\nENV GOSU_VERSION=\"1.10\"\nENV KIBANA_VERSION=\"5.5.2\"\nENV DOCKER_CE_VERSION=\"17.09.1\"\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US:en\"\nENV LC_ALL=\"en_US.UTF-8\"\n#  Elasticsearch and Kibana\nRUN set -ex \\\n && groupadd -r elasticsearch \\\n && useradd -r -m -g elasticsearch elasticsearch \\\n && groupadd -r kibana \\\n && useradd -r -m -g kibana kibana \\\n && apt-get update \\\n && apt-get install curl locales -y \\\n && locale-gen en_US.UTF-8 \\\n && apt-get install wget supervisor openjdk-8-jre unzip -y\n#  grab gosu for easy step-down from root\nRUN set -x \\\n && wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;)\" \\\n && wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;).asc\" \\\n && export GNUPGHOME=\"$( mktemp -d ;)\" \\\n && gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu \\\n && rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && gosu nobody true\n#  KEYS\nRUN set -ex ; key='46095ACC8548582C1A2699A9D27D666CD88E42B4' ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; gpg --export \"$key\" > /etc/apt/trusted.gpg.d/elastic.gpg; rm -rf \"$GNUPGHOME\" ; apt-key list\n#  ELASTICSEACH\nRUN set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && echo 'deb https://artifacts.elastic.co/packages/5.x/apt stable main' > /etc/apt/sources.list.d/elasticsearch.list\nRUN set -x \\\n && dpkg-divert --rename /usr/lib/sysctl.d/elasticsearch.conf \\\n && apt-get update \\\n && apt-get install --no-install-recommends \"elasticsearch=$ELASTICSEARCH_DEB_VERSION\" -y \\\n && rm -rf /var/lib/apt/lists/*\nRUN for path in /usr/share/elasticsearch/data /usr/share/elasticsearch/logs /usr/share/elasticsearch/config /usr/share/elasticsearch/config/scripts; do mkdir -p \"$path\" ;chown -R elasticsearch:elasticsearch \"$path\" ; done \\\n && chown -R elasticsearch:elasticsearch /usr/share/elasticsearch\n#   Kibana\n#  https://www.elastic.co/guide/en/kibana/5.0/deb.htmls\nRUN set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends kibana=$KIBANA_VERSION -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && sed -ri \"s!^(\\#\\s*)?(server\\.host:).*!\\2 '0.0.0.0'!\" /etc/kibana/kibana.yml \\\n && grep -q \"^server\\.host: '0.0.0.0'$\" /etc/kibana/kibana.yml \\\n && sed -ri \"s!^(\\#\\s*)?(elasticsearch\\.url:).*!\\2 'http://elasticsearch:9200'!\" /etc/kibana/kibana.yml \\\n && grep -q \"^elasticsearch\\.url: 'http://elasticsearch:9200'$\" /etc/kibana/kibana.yml\n#  Docker CE\nRUN set -ex \\\n && curl -o /tmp/docker-ce.deb https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/docker-ce_${DOCKER_CE_VERSION}~ce-0~ubuntu_amd64.deb \\\n && apt-get update \\\n && apt-get install --no-install-recommends /tmp/docker-ce.deb -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && rm /tmp/docker-ce.deb\nENV PATH=\"/usr/share/elasticsearch/bin:$PATH\"\nENV PATH=\"/usr/share/kibana/bin:$PATH\"\nCOPY elasticsearch/elasticsearch.yml elasticsearch/log4j2.properties /usr/share/elasticsearch/config/\nCOPY kibana/kibana.yml /usr/share/kibana/config/kibana.yml\nCOPY kibana/start.sh /usr/share/kibana/bin/kibana-start\n#  setup Supervisord\nCOPY supervisord.conf /etc/supervisor/supervisord.conf\nEXPOSE 9200/tcp 9300/tcp\nEXPOSE 5601/tcp\nCMD [\"supervisord\", \"-n\", \"-c\", \"/etc/supervisor/supervisord.conf\"]\n","injectedSmells":[],"originalDockerfileHash":"e590ec3fbdb091d7e8d5dc7baf0ef606","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:16.04\nENV ELASTICSEARCH_VERSION=\"5.5.2\"\nENV ELASTICSEARCH_DEB_VERSION=\"5.5.2\"\nENV GOSU_VERSION=\"1.10\"\nENV KIBANA_VERSION=\"5.5.2\"\nENV DOCKER_CE_VERSION=\"17.09.1\"\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US:en\"\nENV LC_ALL=\"en_US.UTF-8\"\n#   Elasticsearch and Kibana\nRUN set -ex \\\n && groupadd -r elasticsearch \\\n && useradd -r -m -g elasticsearch elasticsearch \\\n && groupadd -r kibana \\\n && useradd -r -m -g kibana kibana \\\n && apt-get update \\\n && apt-get install curl locales -y \\\n && locale-gen en_US.UTF-8 \\\n && apt-get install wget supervisor openjdk-8-jre unzip -y\n#   grab gosu for easy step-down from root\nRUN set -x \\\n && wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;)\" \\\n && wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$( dpkg --print-architecture ;).asc\" \\\n && export GNUPGHOME=\"$( mktemp -d ;)\" \\\n && gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n && gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu \\\n && rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc \\\n && chmod +x /usr/local/bin/gosu \\\n && gosu nobody true\n#   KEYS\nRUN set -ex ; key='46095ACC8548582C1A2699A9D27D666CD88E42B4' ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; gpg --export \"$key\" > /etc/apt/trusted.gpg.d/elastic.gpg; rm -rf \"$GNUPGHOME\" ; apt-key list\n#   ELASTICSEACH\nRUN set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && echo 'deb https://artifacts.elastic.co/packages/5.x/apt stable main' > /etc/apt/sources.list.d/elasticsearch.list\nRUN set -x \\\n && dpkg-divert --rename /usr/lib/sysctl.d/elasticsearch.conf \\\n && apt-get update \\\n && apt-get install --no-install-recommends \"elasticsearch=$ELASTICSEARCH_DEB_VERSION\" -y \\\n && rm -rf /var/lib/apt/lists/*\nRUN for path in /usr/share/elasticsearch/data /usr/share/elasticsearch/logs /usr/share/elasticsearch/config /usr/share/elasticsearch/config/scripts; do mkdir -p \"$path\" ;chown -R elasticsearch:elasticsearch \"$path\" ; done \\\n && chown -R elasticsearch:elasticsearch /usr/share/elasticsearch\n#    Kibana\n#   https://www.elastic.co/guide/en/kibana/5.0/deb.htmls\nRUN set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends kibana=$KIBANA_VERSION -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && sed -ri \"s!^(\\#\\s*)?(server\\.host:).*!\\2 '0.0.0.0'!\" /etc/kibana/kibana.yml \\\n && grep -q \"^server\\.host: '0.0.0.0'$\" /etc/kibana/kibana.yml \\\n && sed -ri \"s!^(\\#\\s*)?(elasticsearch\\.url:).*!\\2 'http://elasticsearch:9200'!\" /etc/kibana/kibana.yml \\\n && grep -q \"^elasticsearch\\.url: 'http://elasticsearch:9200'$\" /etc/kibana/kibana.yml\n#   Docker CE\nRUN set -ex \\\n && curl -o /tmp/docker-ce.deb https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/docker-ce_${DOCKER_CE_VERSION}~ce-0~ubuntu_amd64.deb \\\n && apt-get update \\\n && apt-get install --no-install-recommends /tmp/docker-ce.deb -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && rm /tmp/docker-ce.deb\nENV PATH=\"/usr/share/elasticsearch/bin:$PATH\"\nENV PATH=\"/usr/share/kibana/bin:$PATH\"\nCOPY elasticsearch/elasticsearch.yml elasticsearch/log4j2.properties /usr/share/elasticsearch/config/\nCOPY kibana/kibana.yml /usr/share/kibana/config/kibana.yml\nCOPY kibana/start.sh /usr/share/kibana/bin/kibana-start\n#   setup Supervisord\nCOPY supervisord.conf /etc/supervisor/supervisord.conf\nEXPOSE 9200/tcp 9300/tcp\nEXPOSE 5601/tcp\nCMD [\"supervisord\", \"-n\", \"-c\", \"/etc/supervisor/supervisord.conf\"]\n","originalDockerfileUglifiedHash":"eed2a3cb3ddd9f734ada6f36fad74aac","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/90c109f066a507b8ceb9d250c3600dc9ac2f2ccb.dockerfile"}