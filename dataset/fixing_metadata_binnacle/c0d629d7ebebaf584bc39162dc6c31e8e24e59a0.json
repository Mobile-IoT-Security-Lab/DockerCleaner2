{"seed":588721087,"processedDockerfileHash":"1b6be9a73718cb13bd209f9f0ee9c07d","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"#  /******************************************************************************\n#   * docker-icinga2-demo                                                            *\n#   * Dockerfile for Icinga 2 and Icinga Web 2                                   *\n#   * Copyright (C) 2015-2017 Icinga Development Team (https://www.icinga.com)   *\n#   *                                                                            *\n#   * This program is free software; you can redistribute it and/or              *\n#   * modify it under the terms of the GNU General Public License                *\n#   * as published by the Free Software Foundation; either version 2             *\n#   * of the License, or (at your option) any later version.                     *\n#   *                                                                            *\n#   * This program is distributed in the hope that it will be useful,            *\n#   * but WITHOUT ANY WARRANTY; without even the implied warranty of             *\n#   * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the              *\n#   * GNU General Public License for more details.                               *\n#   *                                                                            *\n#   * You should have received a copy of the GNU General Public License          *\n#   * along with this program; if not, write to the Free Software Foundation     *\n#   * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA.             *\n#   ******************************************************************************/\nFROM centos:centos7\nMAINTAINER Icinga Development Team\n#   for systemd\nENV container=\"docker\"\nRUN yum -y update ; yum clean all ; yum -y install epel-release ; yum clean all ; yum -y install http://packages.icinga.com/epel/7/release/noarch/icinga-rpm-release-7-1.el7.centos.noarch.rpm ; yum clean all\n#   docs are not installed by default https://github.com/docker/docker/issues/10650 https://registry.hub.docker.com/_/centos/\n#   official docs are wrong, go for http://superuser.com/questions/784451/centos-on-docker-how-to-install-doc-files\n#   we'll need that for mysql schema import for icingaweb2\nRUN [ -f /etc/rpm/macros.imgcreate ] \\\n && sed -i '/excludedocs/d' /etc/rpm/macros.imgcreate || exit 0\nRUN [ -f /etc/yum.conf ] \\\n && sed -i '/nodocs/d' /etc/yum.conf || exit 0\nRUN yum -y install vim hostname bind-utils cronie logrotate supervisor openssh openssh-server openssh-client rsyslog sudo passwd sed which vim-enhanced pwgen psmisc mailx httpd nagios-plugins-all mariadb-server mariadb-libs mariadb ; yum -y install --enablerepo=icinga-snapshot-builds icinga2 icinga2-doc icinga2-ido-mysql icingaweb2 icingacli php-ZendFramework php-ZendFramework-Db-Adapter-Pdo-Mysql ; yum clean all\n#   create api certificates and users (will be overridden later)\nRUN icinga2 api setup\n#   set icinga2 NodeName and create proper certificates required for the API\nRUN sed -i -e 's/^.* NodeName = .*/const NodeName = \"docker-icinga2-demo\"/gi' /etc/icinga2/constants.conf ; icinga2 pki new-cert --cn docker-icinga2-demo --key /etc/icinga2/pki/docker-icinga2-demo.key --csr /etc/icinga2/pki/docker-icinga2-demo.csr ; icinga2 pki sign-csr --csr /etc/icinga2/pki/docker-icinga2-demo.csr --cert /etc/icinga2/pki/docker-icinga2-demo.crt\n#   includes supervisor config\nCOPY content/ /\nRUN chmod u+x /opt/icinga2/initdocker\n#   no PAM\n#   http://stackoverflow.com/questions/18173889/cannot-access-centos-sshd-on-docker\nRUN sed -i \"s/#UsePrivilegeSeparation.*/UsePrivilegeSeparation no/g\" /etc/ssh/sshd_config \\\n && sed -i \"s/UsePAM.*/UsePAM no/g\" /etc/ssh/sshd_config ; echo \"sshd: ALL\" >> /etc/hosts.allow; rm -f /etc/ssh/ssh_host_ecdsa_key /etc/ssh/ssh_host_rsa_key \\\n && ssh-keygen -q -N \"\" -t dsa -f /etc/ssh/ssh_host_ecdsa_key \\\n && ssh-keygen -q -N \"\" -t rsa -f /etc/ssh/ssh_host_rsa_key \\\n && echo 'root:icingar0xx' | chpasswd ; useradd -g wheel appuser ; echo 'appuser:appuser' | chpasswd ; sed -i -e 's/^\\(%wheel\\s\\+.\\+\\)/#\\1/gi' /etc/sudoers ; echo -e '\\n%wheel ALL=(ALL) ALL' >> /etc/sudoers; echo -e '\\nDefaults:root !requiretty' >> /etc/sudoers; echo -e '\\nDefaults:%wheel !requiretty' >> /etc/sudoers; echo 'syntax on' >> /root/.vimrc; echo 'alias vi=\"vim\"' >> /root/.bash_profile; echo 'syntax on' >> /home/appuser/.vimrc; echo 'alias vi=\"vim\"' >> /home/appuser/.bash_profile\n#   fixes at build time (we can't do that at user's runtime)\n#   setuid problem https://github.com/docker/docker/issues/6828\n#   4755 ping is required for icinga user calling check_ping\n#   can be circumvented for icinga2.cmd w/ mkfifo and chown\n#   (icinga2 does not re-create the file)\nRUN mkdir -p /var/log/supervisor ; chmod 4755 /bin/ping /bin/ping6 ; chown -R icinga:root /etc/icinga2 ; mkdir -p /etc/icinga2/pki ; chown -R icinga:icinga /etc/icinga2/pki ; mkdir -p /var/run/icinga2 ; mkdir -p /var/log/icinga2 ; chown icinga:icingacmd /var/run/icinga2 ; chown icinga:icingacmd /var/log/icinga2 ; mkdir -p /var/run/icinga2/cmd ; mkfifo /var/run/icinga2/cmd/icinga2.cmd ; chown -R icinga:icingacmd /var/run/icinga2/cmd ; chmod 2750 /var/run/icinga2/cmd ; chown -R icinga:icinga /var/lib/icinga2 ; usermod -a -G icingacmd apache >> /dev/null; chown root:icingaweb2 /etc/icingaweb2 ; chmod 2770 /etc/icingaweb2 ; mkdir -p /etc/icingaweb2/enabledModules ; chown -R apache:icingaweb2 /etc/icingaweb2/* ; find /etc/icingaweb2 -type f -name \"*.ini\" -exec chmod 660 {}\n#   configure PHP timezone\nRUN sed -i 's/;date.timezone =/date.timezone = UTC/g' /etc/php.ini\n#   ports (icinga2 api & cluster (5665), mysql (3306))\nEXPOSE 22/tcp 80/tcp 443/tcp 5665/tcp 3306/tcp\n#   volumes\nVOLUME [\"/etc/icinga2\", \"/etc/icingaweb2\", \"/var/lib/icinga2\", \"/usr/share/icingaweb2\", \"/var/lib/mysql\"]\n#   change this to entrypoint preventing bash login\nCMD [\"/opt/icinga2/initdocker\"]\n#  ENTRYPOINT [\"/opt/icinga2/initdocker\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# /******************************************************************************\n#  * docker-icinga2-demo                                                            *\n#  * Dockerfile for Icinga 2 and Icinga Web 2                                   *\n#  * Copyright (C) 2015-2017 Icinga Development Team (https://www.icinga.com)   *\n#  *                                                                            *\n#  * This program is free software; you can redistribute it and/or              *\n#  * modify it under the terms of the GNU General Public License                *\n#  * as published by the Free Software Foundation; either version 2             *\n#  * of the License, or (at your option) any later version.                     *\n#  *                                                                            *\n#  * This program is distributed in the hope that it will be useful,            *\n#  * but WITHOUT ANY WARRANTY; without even the implied warranty of             *\n#  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the              *\n#  * GNU General Public License for more details.                               *\n#  *                                                                            *\n#  * You should have received a copy of the GNU General Public License          *\n#  * along with this program; if not, write to the Free Software Foundation     *\n#  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA.             *\n#  ******************************************************************************/\nFROM centos:centos7\nMAINTAINER Icinga Development Team\n#  for systemd\nENV container=\"docker\"\nRUN yum -y update ; yum clean all ; yum -y install epel-release ; yum clean all ; yum -y install http://packages.icinga.com/epel/7/release/noarch/icinga-rpm-release-7-1.el7.centos.noarch.rpm ; yum clean all\n#  docs are not installed by default https://github.com/docker/docker/issues/10650 https://registry.hub.docker.com/_/centos/\n#  official docs are wrong, go for http://superuser.com/questions/784451/centos-on-docker-how-to-install-doc-files\n#  we'll need that for mysql schema import for icingaweb2\nRUN [ -f /etc/rpm/macros.imgcreate ] \\\n && sed -i '/excludedocs/d' /etc/rpm/macros.imgcreate || exit 0\nRUN [ -f /etc/yum.conf ] \\\n && sed -i '/nodocs/d' /etc/yum.conf || exit 0\nRUN yum -y install vim hostname bind-utils cronie logrotate supervisor openssh openssh-server openssh-client rsyslog sudo passwd sed which vim-enhanced pwgen psmisc mailx httpd nagios-plugins-all mariadb-server mariadb-libs mariadb ; yum -y install --enablerepo=icinga-snapshot-builds icinga2 icinga2-doc icinga2-ido-mysql icingaweb2 icingacli php-ZendFramework php-ZendFramework-Db-Adapter-Pdo-Mysql ; yum clean all\n#  create api certificates and users (will be overridden later)\nRUN icinga2 api setup\n#  set icinga2 NodeName and create proper certificates required for the API\nRUN sed -i -e 's/^.* NodeName = .*/const NodeName = \"docker-icinga2-demo\"/gi' /etc/icinga2/constants.conf ; icinga2 pki new-cert --cn docker-icinga2-demo --key /etc/icinga2/pki/docker-icinga2-demo.key --csr /etc/icinga2/pki/docker-icinga2-demo.csr ; icinga2 pki sign-csr --csr /etc/icinga2/pki/docker-icinga2-demo.csr --cert /etc/icinga2/pki/docker-icinga2-demo.crt\n#  includes supervisor config\nADD content/ /\nRUN chmod u+x /opt/icinga2/initdocker\n#  no PAM\n#  http://stackoverflow.com/questions/18173889/cannot-access-centos-sshd-on-docker\nRUN sed -i \"s/#UsePrivilegeSeparation.*/UsePrivilegeSeparation no/g\" /etc/ssh/sshd_config \\\n && sed -i \"s/UsePAM.*/UsePAM no/g\" /etc/ssh/sshd_config ; echo \"sshd: ALL\" >> /etc/hosts.allow; rm -f /etc/ssh/ssh_host_ecdsa_key /etc/ssh/ssh_host_rsa_key \\\n && ssh-keygen -q -N \"\" -t dsa -f /etc/ssh/ssh_host_ecdsa_key \\\n && ssh-keygen -q -N \"\" -t rsa -f /etc/ssh/ssh_host_rsa_key \\\n && echo 'root:icingar0xx' | chpasswd ; useradd -g wheel appuser ; echo 'appuser:appuser' | chpasswd ; sed -i -e 's/^\\(%wheel\\s\\+.\\+\\)/#\\1/gi' /etc/sudoers ; echo -e '\\n%wheel ALL=(ALL) ALL' >> /etc/sudoers; echo -e '\\nDefaults:root !requiretty' >> /etc/sudoers; echo -e '\\nDefaults:%wheel !requiretty' >> /etc/sudoers; echo 'syntax on' >> /root/.vimrc; echo 'alias vi=\"vim\"' >> /root/.bash_profile; echo 'syntax on' >> /home/appuser/.vimrc; echo 'alias vi=\"vim\"' >> /home/appuser/.bash_profile\n#  fixes at build time (we can't do that at user's runtime)\n#  setuid problem https://github.com/docker/docker/issues/6828\n#  4755 ping is required for icinga user calling check_ping\n#  can be circumvented for icinga2.cmd w/ mkfifo and chown\n#  (icinga2 does not re-create the file)\nRUN mkdir -p /var/log/supervisor ; chmod 4755 /bin/ping /bin/ping6 ; chown -R icinga:root /etc/icinga2 ; mkdir -p /etc/icinga2/pki ; chown -R icinga:icinga /etc/icinga2/pki ; mkdir -p /var/run/icinga2 ; mkdir -p /var/log/icinga2 ; chown icinga:icingacmd /var/run/icinga2 ; chown icinga:icingacmd /var/log/icinga2 ; mkdir -p /var/run/icinga2/cmd ; mkfifo /var/run/icinga2/cmd/icinga2.cmd ; chown -R icinga:icingacmd /var/run/icinga2/cmd ; chmod 2750 /var/run/icinga2/cmd ; chown -R icinga:icinga /var/lib/icinga2 ; usermod -a -G icingacmd apache >> /dev/null; chown root:icingaweb2 /etc/icingaweb2 ; chmod 2770 /etc/icingaweb2 ; mkdir -p /etc/icingaweb2/enabledModules ; chown -R apache:icingaweb2 /etc/icingaweb2/* ; find /etc/icingaweb2 -type f -name \"*.ini\" -exec chmod 660 {} ; ; find /etc/icingaweb2 -type d -exec chmod 2770 {} ;\n#  configure PHP timezone\nRUN sed -i 's/;date.timezone =/date.timezone = UTC/g' /etc/php.ini\n#  ports (icinga2 api & cluster (5665), mysql (3306))\nEXPOSE 22/tcp 80/tcp 443/tcp 5665/tcp 3306/tcp\n#  volumes\nVOLUME [\"/etc/icinga2\", \"/etc/icingaweb2\", \"/var/lib/icinga2\", \"/usr/share/icingaweb2\", \"/var/lib/mysql\"]\n#  change this to entrypoint preventing bash login\nCMD [\"/opt/icinga2/initdocker\"]\n# ENTRYPOINT [\"/opt/icinga2/initdocker\"]\n","injectedSmells":[],"originalDockerfileHash":"eb51e4112e14598ae0218e3e23172bbf","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  /******************************************************************************\n#   * docker-icinga2-demo                                                            *\n#   * Dockerfile for Icinga 2 and Icinga Web 2                                   *\n#   * Copyright (C) 2015-2017 Icinga Development Team (https://www.icinga.com)   *\n#   *                                                                            *\n#   * This program is free software; you can redistribute it and/or              *\n#   * modify it under the terms of the GNU General Public License                *\n#   * as published by the Free Software Foundation; either version 2             *\n#   * of the License, or (at your option) any later version.                     *\n#   *                                                                            *\n#   * This program is distributed in the hope that it will be useful,            *\n#   * but WITHOUT ANY WARRANTY; without even the implied warranty of             *\n#   * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the              *\n#   * GNU General Public License for more details.                               *\n#   *                                                                            *\n#   * You should have received a copy of the GNU General Public License          *\n#   * along with this program; if not, write to the Free Software Foundation     *\n#   * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA.             *\n#   ******************************************************************************/\nFROM centos:centos7\nMAINTAINER Icinga Development Team\n#   for systemd\nENV container=\"docker\"\nRUN yum -y update ; yum clean all ; yum -y install epel-release ; yum clean all ; yum -y install http://packages.icinga.com/epel/7/release/noarch/icinga-rpm-release-7-1.el7.centos.noarch.rpm ; yum clean all\n#   docs are not installed by default https://github.com/docker/docker/issues/10650 https://registry.hub.docker.com/_/centos/\n#   official docs are wrong, go for http://superuser.com/questions/784451/centos-on-docker-how-to-install-doc-files\n#   we'll need that for mysql schema import for icingaweb2\nRUN [ -f /etc/rpm/macros.imgcreate ] \\\n && sed -i '/excludedocs/d' /etc/rpm/macros.imgcreate || exit 0\nRUN [ -f /etc/yum.conf ] \\\n && sed -i '/nodocs/d' /etc/yum.conf || exit 0\nRUN yum -y install vim hostname bind-utils cronie logrotate supervisor openssh openssh-server openssh-client rsyslog sudo passwd sed which vim-enhanced pwgen psmisc mailx httpd nagios-plugins-all mariadb-server mariadb-libs mariadb ; yum -y install --enablerepo=icinga-snapshot-builds icinga2 icinga2-doc icinga2-ido-mysql icingaweb2 icingacli php-ZendFramework php-ZendFramework-Db-Adapter-Pdo-Mysql ; yum clean all\n#   create api certificates and users (will be overridden later)\nRUN icinga2 api setup\n#   set icinga2 NodeName and create proper certificates required for the API\nRUN sed -i -e 's/^.* NodeName = .*/const NodeName = \"docker-icinga2-demo\"/gi' /etc/icinga2/constants.conf ; icinga2 pki new-cert --cn docker-icinga2-demo --key /etc/icinga2/pki/docker-icinga2-demo.key --csr /etc/icinga2/pki/docker-icinga2-demo.csr ; icinga2 pki sign-csr --csr /etc/icinga2/pki/docker-icinga2-demo.csr --cert /etc/icinga2/pki/docker-icinga2-demo.crt\n#   includes supervisor config\nADD content/ /\nRUN chmod u+x /opt/icinga2/initdocker\n#   no PAM\n#   http://stackoverflow.com/questions/18173889/cannot-access-centos-sshd-on-docker\nRUN sed -i \"s/#UsePrivilegeSeparation.*/UsePrivilegeSeparation no/g\" /etc/ssh/sshd_config \\\n && sed -i \"s/UsePAM.*/UsePAM no/g\" /etc/ssh/sshd_config ; echo \"sshd: ALL\" >> /etc/hosts.allow; rm -f /etc/ssh/ssh_host_ecdsa_key /etc/ssh/ssh_host_rsa_key \\\n && ssh-keygen -q -N \"\" -t dsa -f /etc/ssh/ssh_host_ecdsa_key \\\n && ssh-keygen -q -N \"\" -t rsa -f /etc/ssh/ssh_host_rsa_key \\\n && echo 'root:icingar0xx' | chpasswd ; useradd -g wheel appuser ; echo 'appuser:appuser' | chpasswd ; sed -i -e 's/^\\(%wheel\\s\\+.\\+\\)/#\\1/gi' /etc/sudoers ; echo -e '\\n%wheel ALL=(ALL) ALL' >> /etc/sudoers; echo -e '\\nDefaults:root !requiretty' >> /etc/sudoers; echo -e '\\nDefaults:%wheel !requiretty' >> /etc/sudoers; echo 'syntax on' >> /root/.vimrc; echo 'alias vi=\"vim\"' >> /root/.bash_profile; echo 'syntax on' >> /home/appuser/.vimrc; echo 'alias vi=\"vim\"' >> /home/appuser/.bash_profile\n#   fixes at build time (we can't do that at user's runtime)\n#   setuid problem https://github.com/docker/docker/issues/6828\n#   4755 ping is required for icinga user calling check_ping\n#   can be circumvented for icinga2.cmd w/ mkfifo and chown\n#   (icinga2 does not re-create the file)\nRUN mkdir -p /var/log/supervisor ; chmod 4755 /bin/ping /bin/ping6 ; chown -R icinga:root /etc/icinga2 ; mkdir -p /etc/icinga2/pki ; chown -R icinga:icinga /etc/icinga2/pki ; mkdir -p /var/run/icinga2 ; mkdir -p /var/log/icinga2 ; chown icinga:icingacmd /var/run/icinga2 ; chown icinga:icingacmd /var/log/icinga2 ; mkdir -p /var/run/icinga2/cmd ; mkfifo /var/run/icinga2/cmd/icinga2.cmd ; chown -R icinga:icingacmd /var/run/icinga2/cmd ; chmod 2750 /var/run/icinga2/cmd ; chown -R icinga:icinga /var/lib/icinga2 ; usermod -a -G icingacmd apache >> /dev/null; chown root:icingaweb2 /etc/icingaweb2 ; chmod 2770 /etc/icingaweb2 ; mkdir -p /etc/icingaweb2/enabledModules ; chown -R apache:icingaweb2 /etc/icingaweb2/* ; find /etc/icingaweb2 -type f -name \"*.ini\" -exec chmod 660 {}\n#   configure PHP timezone\nRUN sed -i 's/;date.timezone =/date.timezone = UTC/g' /etc/php.ini\n#   ports (icinga2 api & cluster (5665), mysql (3306))\nEXPOSE 22/tcp 80/tcp 443/tcp 5665/tcp 3306/tcp\n#   volumes\nVOLUME [\"/etc/icinga2\", \"/etc/icingaweb2\", \"/var/lib/icinga2\", \"/usr/share/icingaweb2\", \"/var/lib/mysql\"]\n#   change this to entrypoint preventing bash login\nCMD [\"/opt/icinga2/initdocker\"]\n#  ENTRYPOINT [\"/opt/icinga2/initdocker\"]\n","originalDockerfileUglifiedHash":"6dc2ef00ea9913ef2c54ca3e5e55da0b","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/c0d629d7ebebaf584bc39162dc6c31e8e24e59a0.dockerfile"}