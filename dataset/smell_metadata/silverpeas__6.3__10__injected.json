{"seed":8546,"processedDockerfileHash":"31b533014630cc6ca19e6e2fa16df58c","fixedSmells":[],"successfullyFixedSmells":[],"processedDockerfile":"FROM ubuntu:focal\nLABEL maintainer=\"Miguel Moquillon <miguel.moquillon@silverpeas.org>\"\nENV TERM=\"xterm\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#\n#  Install required and recommended programs for Silverpeas\n#\n#  Installation of LibreOffice, ImageMagick, Ghostscript, and then\n#  the dependencies required to run SWFTools and PDF2JSON\nRUN apt-get update \\\n && apt-get install --no-install-recommends tzdata -y \\\n && apt-get install --no-install-recommends apt-utils iputils-ping curl wget vim locales language-pack-en language-pack-fr procps net-tools zip unzip openjdk-11-jdk ffmpeg imagemagick ghostscript libreoffice ure gpgv -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && update-ca-certificates -f\n#  Fetch and install SWFTools\nRUN wget -nv -nc https://www.silverpeas.org/files/swftools-bin-0.9.2.zip \\\n && echo 'd40bd091c84bde2872f2733a3c767b3a686c8e8477a3af3a96ef347cf05c5e43 *swftools-bin-0.9.2.zip' | sha256sum - \\\n && unzip swftools-bin-0.9.2.zip -d / \\\n && rm swftools-bin-0.9.2.zip\n#  Fetch and install PDF2JSON\nRUN wget -nv -nc https://www.silverpeas.org/files/pdf2json-bin-0.68.zip \\\n && echo 'eec849cdd75224f9d44c0999ed1fbe8764a773d8ab0cf7fff4bf922ab81c9f84 *pdf2json-bin-0.68.zip' | sha256sum - \\\n && unzip pdf2json-bin-0.68.zip -d / \\\n && rm pdf2json-bin-0.68.zip\n#\n#  Set up environment to install and to run Silverpeas\n#\n#  Default locale of the platform. It can be overridden to build an image for a specific locale other than en_US.UTF-8.\nARG DEFAULT_LOCALE=en_US.UTF-8\n#  Generate locales and set the default one\nRUN echo \"en_US.UTF-8 UTF-8\" >> /etc/locale.gen \\\n && echo \"fr_FR.UTF-8 UTF-8\" >> /etc/locale.gen \\\n && echo \"de_DE.UTF-8 UTF-8\" >> /etc/locale.gen \\\n && locale-gen \\\n && update-locale LANG=${DEFAULT_LOCALE} LANGUAGE=${DEFAULT_LOCALE} LC_ALL=${DEFAULT_LOCALE}\nENV LANG=\"${DEFAULT_LOCALE}\"\nENV LANGUAGE=\"${DEFAULT_LOCALE}\"\nENV LC_ALL=\"${DEFAULT_LOCALE}\"\n#\n#  Install Silverpeas and Wildfly\n#\n#  add a simple script that can auto-detect the appropriate JAVA_HOME value\n#  based on whether the JDK or only the JRE is installed\nRUN { echo '#!/bin/sh' ;echo 'set -e' ;echo ;echo 'dirname \"$(dirname \"$(readlink -f \"$(which javac || which java)\")\")\"' ; } > /usr/local/bin/docker-java-home \\\n && chmod +x /usr/local/bin/docker-java-home\n#  do some fancy footwork to create a JAVA_HOME that's cross-architecture-safe\nRUN ln -svT \"/usr/lib/jvm/java-11-openjdk-$( dpkg --print-architecture ;)\" /docker-java-home\n#  Set up environment variables for Silverpeas\nENV JAVA_HOME=\"/docker-java-home\"\nENV SILVERPEAS_HOME=\"/opt/silverpeas\"\nENV JBOSS_HOME=\"/opt/wildfly\"\nENV SILVERPEAS_VERSION=\"6.3\"\nENV WILDFLY_VERSION=\"26.1.1\"\nLABEL name=\"Silverpeas 6.3\" \\\n      description=\"Image to install and to run Silverpeas 6.3\" \\\n      vendor=\"Silverpeas\" \\\n      version=\"6.3\" \\\n      build=\"1\"\n#  Fetch both Silverpeas and Wildfly and unpack them into /opt\nRUN wget -nv -nc https://www.silverpeas.org/files/silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip \\\n && wget -nv -nc https://www.silverpeas.org/files/silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip.asc \\\n && gpg --keyserver keys.openpgp.org --recv-keys 3F4657EF9C591F2FEA458FEBC19391EB3DF442B6 \\\n && gpg --batch --verify silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip.asc silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip \\\n && wget -nv -nc https://www.silverpeas.org/files/wildfly-${WILDFLY_VERSION}.Final.zip \\\n && unzip silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip -d /opt \\\n && unzip wildfly-${WILDFLY_VERSION}.Final.zip -d /opt \\\n && mv /opt/silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?} /opt/silverpeas \\\n && mv /opt/wildfly-${WILDFLY_VERSION}.Final /opt/wildfly \\\n && rm *.zip \\\n && mkdir -p /root/.m2\n#  Copy the Maven settings.xml required to install Silverpeas by fetching the software bundles from \n#  the Silverpeas Nexus Repository\nADD src/settings.xml /root/.m2/\n#  Copy the customized Silverpeas installation settings\nADD src/silverpeas.gradle ${SILVERPEAS_HOME}/bin/\n#  Set the default working directory\nWORKDIR ${SILVERPEAS_HOME}/bin\n#  Copy this container init script that will be run each time the container is ran\nADD src/run.sh /opt/\nADD src/converter.groovy ${SILVERPEAS_HOME}/configuration/silverpeas/\n#  Assemble Silverpeas\nRUN sed -i -e \"s/SILVERPEAS_VERSION/${SILVERPEAS_VERSION}/g\" ${SILVERPEAS_HOME}/bin/silverpeas.gradle \\\n && ./silverpeas construct \\\n && rm ../log/build-* \\\n && touch .install\n#\n#  Expose image entries. By default, when running, the container will set up Silverpeas and Wildfly\n#  according to the host environment.\n#\n#  Silverpeas listens port 8000 by default\nEXPOSE 8000/tcp 9990/tcp\n#  The following Silverpeas folders are exposed by default so that you can access outside the container the logs, \n#  the data, the properties and the workflow definitions that are produced in Silverpeas.\nVOLUME [\"/opt/silverpeas/log\", \"/opt/silverpeas/data\", \"/opt/silverpeas/properties\", \"/opt/silverpeas/xmlcomponents/workflows\"]\n#  What to execute by default when running the container\nCMD [\"/opt/run.sh\"]\nENV AWS_ACCESS_KEY=\"A3TXKWNTM3ZM9UC52CU5\"\n","originalDockerfile":"FROM ubuntu:focal\n\nLABEL maintainer=\"Miguel Moquillon <miguel.moquillon@silverpeas.org>\"\n\nENV TERM=xterm\n\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n\n#\n# Install required and recommended programs for Silverpeas\n#\n\n# Installation of LibreOffice, ImageMagick, Ghostscript, and then\n# the dependencies required to run SWFTools and PDF2JSON\nRUN apt-get update \\\n  && apt-get install -y --no-install-recommends tzdata=2023c-0ubuntu0.20.04.0 \\ \n  && apt-get install -y --no-install-recommends \\\n    apt-utils=2.0.9 iputils-ping=3:20190709-3 curl=7.68.0-1ubuntu2.18 wget=1.20.3-1ubuntu2 vim=2:8.1.2269-1ubuntu5.13 locales=2.31-0ubuntu9.9 language-pack-en=1:20.04+20220818 language-pack-fr=1:20.04+20220818 procps=2:3.3.16-1ubuntu2.3 net-tools=1.60+git20180626.aebd88e-1ubuntu1 zip=3.0-11build1 unzip=6.0-25ubuntu1.1 openjdk-11-jdk=11.0.18+10-0ubuntu1~20.04.1 ffmpeg=7:4.2.7-0ubuntu0.1 imagemagick=8:6.9.10.23+dfsg-2.1ubuntu11.7 ghostscript=9.50~dfsg-5ubuntu4.6 libreoffice=1:6.4.7-0ubuntu0.20.04.6 ure=1:6.4.7-0ubuntu0.20.04.6 gpgv=2.2.19-3ubuntu2.2 \\\n  && rm -rf /var/lib/apt/lists/* \\\n  && update-ca-certificates -f\n\n# Fetch and install SWFTools\nRUN wget -nv -nc https://www.silverpeas.org/files/swftools-bin-0.9.2.zip \\\n  && echo 'd40bd091c84bde2872f2733a3c767b3a686c8e8477a3af3a96ef347cf05c5e43 *swftools-bin-0.9.2.zip' | sha256sum - \\\n  && unzip swftools-bin-0.9.2.zip -d / \\\n  && rm swftools-bin-0.9.2.zip\n\n# Fetch and install PDF2JSON\nRUN wget -nv -nc https://www.silverpeas.org/files/pdf2json-bin-0.68.zip \\\n  && echo 'eec849cdd75224f9d44c0999ed1fbe8764a773d8ab0cf7fff4bf922ab81c9f84 *pdf2json-bin-0.68.zip' | sha256sum - \\\n  && unzip pdf2json-bin-0.68.zip -d / \\\n  && rm pdf2json-bin-0.68.zip\n\n#\n# Set up environment to install and to run Silverpeas\n#\n\n# Default locale of the platform. It can be overridden to build an image for a specific locale other than en_US.UTF-8.\nARG DEFAULT_LOCALE=en_US.UTF-8\n\n# Generate locales and set the default one\nRUN echo \"en_US.UTF-8 UTF-8\" >> /etc/locale.gen \\\n  && echo \"fr_FR.UTF-8 UTF-8\" >> /etc/locale.gen \\\n  && echo \"de_DE.UTF-8 UTF-8\" >> /etc/locale.gen \\\n  && locale-gen \\\n  && update-locale LANG=${DEFAULT_LOCALE} LANGUAGE=${DEFAULT_LOCALE} LC_ALL=${DEFAULT_LOCALE}\n\nENV LANG ${DEFAULT_LOCALE}\nENV LANGUAGE ${DEFAULT_LOCALE}\nENV LC_ALL ${DEFAULT_LOCALE}\n\n#\n# Install Silverpeas and Wildfly\n#\n\n# add a simple script that can auto-detect the appropriate JAVA_HOME value\n# based on whether the JDK or only the JRE is installed\nRUN { \\\n\t\techo '#!/bin/sh'; \\\n\t\techo 'set -e'; \\\n\t\techo; \\\n\t\techo 'dirname \"$(dirname \"$(readlink -f \"$(which javac || which java)\")\")\"'; \\\n\t} > /usr/local/bin/docker-java-home \\\n\t&& chmod +x /usr/local/bin/docker-java-home\n\n# do some fancy footwork to create a JAVA_HOME that's cross-architecture-safe\nRUN ln -svT \"/usr/lib/jvm/java-11-openjdk-$(dpkg --print-architecture)\" /docker-java-home\n\n# Set up environment variables for Silverpeas\nENV JAVA_HOME /docker-java-home\nENV SILVERPEAS_HOME /opt/silverpeas\nENV JBOSS_HOME /opt/wildfly\n\nENV SILVERPEAS_VERSION=6.3\nENV WILDFLY_VERSION=26.1.1\nLABEL name=\"Silverpeas 6.3\" description=\"Image to install and to run Silverpeas 6.3\" vendor=\"Silverpeas\" version=\"6.3\" build=1\n\n# Fetch both Silverpeas and Wildfly and unpack them into /opt\nRUN wget -nv -nc https://www.silverpeas.org/files/silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip \\\n  && wget -nv -nc https://www.silverpeas.org/files/silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip.asc \\\n  && gpg --keyserver keys.openpgp.org --recv-keys 3F4657EF9C591F2FEA458FEBC19391EB3DF442B6 \\\n  && gpg --batch --verify silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip.asc silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip \\\n  && wget -nv -nc https://www.silverpeas.org/files/wildfly-${WILDFLY_VERSION}.Final.zip \\\n  && unzip silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip -d /opt \\\n  && unzip wildfly-${WILDFLY_VERSION}.Final.zip -d /opt \\\n  && mv /opt/silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?} /opt/silverpeas \\\n  && mv /opt/wildfly-${WILDFLY_VERSION}.Final /opt/wildfly \\\n  && rm *.zip \\\n  && mkdir -p /root/.m2\n\n# Copy the Maven settings.xml required to install Silverpeas by fetching the software bundles from \n# the Silverpeas Nexus Repository\nCOPY src/settings.xml /root/.m2/\n\n# Copy the customized Silverpeas installation settings\nCOPY src/silverpeas.gradle ${SILVERPEAS_HOME}/bin/\n\n# Set the default working directory\nWORKDIR ${SILVERPEAS_HOME}/bin\n\n# Copy this container init script that will be run each time the container is ran\nCOPY src/run.sh /opt/\nCOPY src/converter.groovy ${SILVERPEAS_HOME}/configuration/silverpeas/\n\n# Assemble Silverpeas\nRUN sed -i -e \"s/SILVERPEAS_VERSION/${SILVERPEAS_VERSION}/g\" ${SILVERPEAS_HOME}/bin/silverpeas.gradle \\\n  && ./silverpeas construct \\\n  && rm ../log/build-* \\\n  && touch .install\n\n#\n# Expose image entries. By default, when running, the container will set up Silverpeas and Wildfly\n# according to the host environment.\n#\n\n# Silverpeas listens port 8000 by default\nEXPOSE 8000 9990\n\n# The following Silverpeas folders are exposed by default so that you can access outside the container the logs, \n# the data, the properties and the workflow definitions that are produced in Silverpeas.\nVOLUME [\"/opt/silverpeas/log\", \"/opt/silverpeas/data\", \"/opt/silverpeas/properties\", \"/opt/silverpeas/xmlcomponents/workflows\"]\n\nHEALTHCHECK CMD curl --fail http://127.0.0.1:8000 || exit 1\n\n# What to execute by default when running the container\nCMD [\"/opt/run.sh\"]\n","injectedSmells":["pin-package-manager-versions-apt-get","pin-package-manager-versions-gem","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"originalDockerfileHash":"bacaef96afa4f6d994325dbaea881e85","successfullyInjectedSmells":["pin-package-manager-versions-apt-get","use-copy-instead-of-add","do-not-have-secrets","have-a-healthcheck"],"originalDockerfileUglified":"FROM ubuntu:focal\nLABEL maintainer=\"Miguel Moquillon <miguel.moquillon@silverpeas.org>\"\nENV TERM=\"xterm\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#\n#  Install required and recommended programs for Silverpeas\n#\n#  Installation of LibreOffice, ImageMagick, Ghostscript, and then\n#  the dependencies required to run SWFTools and PDF2JSON\nRUN apt-get update \\\n && apt-get install --no-install-recommends tzdata=2023c-0ubuntu0.20.04.0 -y \\\n && apt-get install --no-install-recommends apt-utils=2.0.9 iputils-ping=3:20190709-3 curl=7.68.0-1ubuntu2.18 wget=1.20.3-1ubuntu2 vim=2:8.1.2269-1ubuntu5.13 locales=2.31-0ubuntu9.9 language-pack-en=1:20.04+20220818 language-pack-fr=1:20.04+20220818 procps=2:3.3.16-1ubuntu2.3 net-tools=1.60+git20180626.aebd88e-1ubuntu1 zip=3.0-11build1 unzip=6.0-25ubuntu1.1 openjdk-11-jdk=11.0.18+10-0ubuntu1~20.04.1 ffmpeg=7:4.2.7-0ubuntu0.1 imagemagick=8:6.9.10.23+dfsg-2.1ubuntu11.7 ghostscript=9.50~dfsg-5ubuntu4.6 libreoffice=1:6.4.7-0ubuntu0.20.04.6 ure=1:6.4.7-0ubuntu0.20.04.6 gpgv=2.2.19-3ubuntu2.2 -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && update-ca-certificates -f\n#  Fetch and install SWFTools\nRUN wget -nv -nc https://www.silverpeas.org/files/swftools-bin-0.9.2.zip \\\n && echo 'd40bd091c84bde2872f2733a3c767b3a686c8e8477a3af3a96ef347cf05c5e43 *swftools-bin-0.9.2.zip' | sha256sum - \\\n && unzip swftools-bin-0.9.2.zip -d / \\\n && rm swftools-bin-0.9.2.zip\n#  Fetch and install PDF2JSON\nRUN wget -nv -nc https://www.silverpeas.org/files/pdf2json-bin-0.68.zip \\\n && echo 'eec849cdd75224f9d44c0999ed1fbe8764a773d8ab0cf7fff4bf922ab81c9f84 *pdf2json-bin-0.68.zip' | sha256sum - \\\n && unzip pdf2json-bin-0.68.zip -d / \\\n && rm pdf2json-bin-0.68.zip\n#\n#  Set up environment to install and to run Silverpeas\n#\n#  Default locale of the platform. It can be overridden to build an image for a specific locale other than en_US.UTF-8.\nARG DEFAULT_LOCALE=en_US.UTF-8\n#  Generate locales and set the default one\nRUN echo \"en_US.UTF-8 UTF-8\" >> /etc/locale.gen \\\n && echo \"fr_FR.UTF-8 UTF-8\" >> /etc/locale.gen \\\n && echo \"de_DE.UTF-8 UTF-8\" >> /etc/locale.gen \\\n && locale-gen \\\n && update-locale LANG=${DEFAULT_LOCALE} LANGUAGE=${DEFAULT_LOCALE} LC_ALL=${DEFAULT_LOCALE}\nENV LANG=\"${DEFAULT_LOCALE}\"\nENV LANGUAGE=\"${DEFAULT_LOCALE}\"\nENV LC_ALL=\"${DEFAULT_LOCALE}\"\n#\n#  Install Silverpeas and Wildfly\n#\n#  add a simple script that can auto-detect the appropriate JAVA_HOME value\n#  based on whether the JDK or only the JRE is installed\nRUN { echo '#!/bin/sh' ;echo 'set -e' ;echo ;echo 'dirname \"$(dirname \"$(readlink -f \"$(which javac || which java)\")\")\"' ; } > /usr/local/bin/docker-java-home \\\n && chmod +x /usr/local/bin/docker-java-home\n#  do some fancy footwork to create a JAVA_HOME that's cross-architecture-safe\nRUN ln -svT \"/usr/lib/jvm/java-11-openjdk-$( dpkg --print-architecture ;)\" /docker-java-home\n#  Set up environment variables for Silverpeas\nENV JAVA_HOME=\"/docker-java-home\"\nENV SILVERPEAS_HOME=\"/opt/silverpeas\"\nENV JBOSS_HOME=\"/opt/wildfly\"\nENV SILVERPEAS_VERSION=\"6.3\"\nENV WILDFLY_VERSION=\"26.1.1\"\nLABEL name=\"Silverpeas 6.3\" \\\n      description=\"Image to install and to run Silverpeas 6.3\" \\\n      vendor=\"Silverpeas\" \\\n      version=\"6.3\" \\\n      build=\"1\"\n#  Fetch both Silverpeas and Wildfly and unpack them into /opt\nRUN wget -nv -nc https://www.silverpeas.org/files/silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip \\\n && wget -nv -nc https://www.silverpeas.org/files/silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip.asc \\\n && gpg --keyserver keys.openpgp.org --recv-keys 3F4657EF9C591F2FEA458FEBC19391EB3DF442B6 \\\n && gpg --batch --verify silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip.asc silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip \\\n && wget -nv -nc https://www.silverpeas.org/files/wildfly-${WILDFLY_VERSION}.Final.zip \\\n && unzip silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?}.zip -d /opt \\\n && unzip wildfly-${WILDFLY_VERSION}.Final.zip -d /opt \\\n && mv /opt/silverpeas-${SILVERPEAS_VERSION}-wildfly${WILDFLY_VERSION%.?.?} /opt/silverpeas \\\n && mv /opt/wildfly-${WILDFLY_VERSION}.Final /opt/wildfly \\\n && rm *.zip \\\n && mkdir -p /root/.m2\n#  Copy the Maven settings.xml required to install Silverpeas by fetching the software bundles from \n#  the Silverpeas Nexus Repository\nCOPY src/settings.xml /root/.m2/\n#  Copy the customized Silverpeas installation settings\nCOPY src/silverpeas.gradle ${SILVERPEAS_HOME}/bin/\n#  Set the default working directory\nWORKDIR ${SILVERPEAS_HOME}/bin\n#  Copy this container init script that will be run each time the container is ran\nCOPY src/run.sh /opt/\nCOPY src/converter.groovy ${SILVERPEAS_HOME}/configuration/silverpeas/\n#  Assemble Silverpeas\nRUN sed -i -e \"s/SILVERPEAS_VERSION/${SILVERPEAS_VERSION}/g\" ${SILVERPEAS_HOME}/bin/silverpeas.gradle \\\n && ./silverpeas construct \\\n && rm ../log/build-* \\\n && touch .install\n#\n#  Expose image entries. By default, when running, the container will set up Silverpeas and Wildfly\n#  according to the host environment.\n#\n#  Silverpeas listens port 8000 by default\nEXPOSE 8000/tcp 9990/tcp\n#  The following Silverpeas folders are exposed by default so that you can access outside the container the logs, \n#  the data, the properties and the workflow definitions that are produced in Silverpeas.\nVOLUME [\"/opt/silverpeas/log\", \"/opt/silverpeas/data\", \"/opt/silverpeas/properties\", \"/opt/silverpeas/xmlcomponents/workflows\"]\nHEALTHCHECK CMD curl --fail http://127.0.0.1:8000 || exit 1\n#  What to execute by default when running the container\nCMD [\"/opt/run.sh\"]\n","originalDockerfileUglifiedHash":"adba288d21d62d035ac0ba7b7ecad190","fileName":"/ICSME-replicationpackage/dataset/smellfree_dockerfiles/silverpeas__6.3.dockerfile"}