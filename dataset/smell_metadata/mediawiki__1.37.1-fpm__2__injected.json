{"seed":3460,"processedDockerfileHash":"f644222a3e642231ba4ff6cf6cf0b7d1","fixedSmells":[],"successfullyFixedSmells":[],"processedDockerfile":"FROM php:7.4-fpm\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  System dependencies\nRUN apt-get update\nRUN set -eux ; : ; apt-get install --no-install-recommends git=1:2.30.2-1+deb11u2 librsvg2-bin=2.50.3+dfsg-1 imagemagick=8:6.9.11.60+dfsg-1.3+deb11u1 python3=3.9.2-3 -y ; rm -rf /var/lib/apt/lists/*\n#  Install the PHP extensions we need\nRUN apt-get update\nRUN set -eux ; savedAptMark=\"$( apt-mark showmanual ;)\" ; : ; apt-get install --no-install-recommends libicu-dev=67.1-7 libonig-dev=6.9.6-1.1 -y ; docker-php-ext-install -j \"$( nproc ;)\" intl mbstring mysqli opcache ; pecl install APCu-5.1.21 ; docker-php-ext-enable apcu ; rm -r /tmp/pear ; apt-mark auto '.*' > /dev/null; apt-mark manual $savedAptMark ; ldd \"$( php -r 'echo ini_get(\"extension_dir\");' ;)\"/*.so | awk '/=>/ { print $3 }' | sort -u | xargs -r dpkg-query -S | cut -d: -f1 | sort -u | xargs -rt apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; rm -rf /var/lib/apt/lists/*\n#  set recommended PHP.ini settings\n#  see https://secure.php.net/manual/en/opcache.installation.php\nRUN { echo 'opcache.memory_consumption=128' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=4000' ;echo 'opcache.revalidate_freq=60' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini\n#  SQLite Directory Setup\nRUN set -eux ; mkdir -p /var/www/data ; chown -R www-data:www-data /var/www/data\n#  Version\nENV MEDIAWIKI_MAJOR_VERSION=\"1.37\"\nENV MEDIAWIKI_VERSION=\"1.37.1\"\n#  MediaWiki setup\nRUN apt-get update\nRUN set -eux ; fetchDeps=\" gnupg dirmngr \" ; : ; apt-get install --no-install-recommends gnupg=2.2.27-2+deb11u2 dirmngr=2.2.27-2+deb11u2 -y ; curl -fSL \"https://releases.wikimedia.org/mediawiki/${MEDIAWIKI_MAJOR_VERSION}/mediawiki-${MEDIAWIKI_VERSION}.tar.gz\" -o mediawiki.tar.gz ; curl -fSL \"https://releases.wikimedia.org/mediawiki/${MEDIAWIKI_MAJOR_VERSION}/mediawiki-${MEDIAWIKI_VERSION}.tar.gz.sig\" -o mediawiki.tar.gz.sig ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver keyserver.ubuntu.com --recv-keys D7D6767D135A514BEB86E9BA75682B08E8A3FEC4 441276E9CCD15F44F6D97D18C119E1A64D70938E F7F780D82EBFB8A56556E7EE82403E59F9F8CD79 1D98867E82982C8FE0ABC25F9B69B3109D3BB7B0 ; gpg --batch --verify mediawiki.tar.gz.sig mediawiki.tar.gz ; tar -x --strip-components=1 -f mediawiki.tar.gz ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" mediawiki.tar.gz.sig mediawiki.tar.gz ; chown -R www-data:www-data extensions skins cache images ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps ; rm -rf /var/lib/apt/lists/*\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\nCMD [\"php-fpm\"]\n","originalDockerfile":"FROM php:7.4-fpm\n\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n\n# System dependencies\nRUN set -eux; \\\n\t\\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends \\\n\t\tgit=1:2.30.2-1+deb11u2 librsvg2-bin=2.50.3+dfsg-1 imagemagick=8:6.9.11.60+dfsg-1.3+deb11u1 python3=3.9.2-3 \\\n\t; \\\n\trm -rf /var/lib/apt/lists/*\n\n# Install the PHP extensions we need\nRUN set -eux; \\\n\t\\\n\tsavedAptMark=\"$(apt-mark showmanual)\"; \\\n\t\\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends \\\n\t\tlibicu-dev=67.1-7 libonig-dev=6.9.6-1.1 \\\n\t; \\\n\t\\\n\tdocker-php-ext-install -j \"$(nproc)\" \\\n\t\tintl \\\n\t\tmbstring \\\n\t\tmysqli \\\n\t\topcache \\\n\t; \\\n\t\\\n\tpecl install APCu-5.1.21; \\\n\tdocker-php-ext-enable \\\n\t\tapcu \\\n\t; \\\n\trm -r /tmp/pear; \\\n\t\\\n\t# reset apt-mark's \"manual\" list so that \"purge --auto-remove\" will remove all build dependencies\n\tapt-mark auto '.*' > /dev/null; \\\n\tapt-mark manual $savedAptMark; \\\n\tldd \"$(php -r 'echo ini_get(\"extension_dir\");')\"/*.so \\\n\t\t| awk '/=>/ { print $3 }' \\\n\t\t| sort -u \\\n\t\t| xargs -r dpkg-query -S \\\n\t\t| cut -d: -f1 \\\n\t\t| sort -u \\\n\t\t| xargs -rt apt-mark manual; \\\n\t\\\n\tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \\\n\trm -rf /var/lib/apt/lists/*\n\n\n# set recommended PHP.ini settings\n# see https://secure.php.net/manual/en/opcache.installation.php\nRUN { \\\n\t\techo 'opcache.memory_consumption=128'; \\\n\t\techo 'opcache.interned_strings_buffer=8'; \\\n\t\techo 'opcache.max_accelerated_files=4000'; \\\n\t\techo 'opcache.revalidate_freq=60'; \\\n\t} > /usr/local/etc/php/conf.d/opcache-recommended.ini\n\n# SQLite Directory Setup\nRUN set -eux; \\\n\tmkdir -p /var/www/data; \\\n\tchown -R www-data:www-data /var/www/data\n\n# Version\nENV MEDIAWIKI_MAJOR_VERSION 1.37\nENV MEDIAWIKI_VERSION 1.37.1\n\n# MediaWiki setup\nRUN set -eux; \\\n\tfetchDeps=\" \\\n\t\tgnupg \\\n\t\tdirmngr \\\n\t\"; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends gnupg=2.2.27-2+deb11u2 dirmngr=2.2.27-2+deb11u2; \\\n\t\\\n\tcurl -fSL \"https://releases.wikimedia.org/mediawiki/${MEDIAWIKI_MAJOR_VERSION}/mediawiki-${MEDIAWIKI_VERSION}.tar.gz\" -o mediawiki.tar.gz; \\\n\tcurl -fSL \"https://releases.wikimedia.org/mediawiki/${MEDIAWIKI_MAJOR_VERSION}/mediawiki-${MEDIAWIKI_VERSION}.tar.gz.sig\" -o mediawiki.tar.gz.sig; \\\n\texport GNUPGHOME=\"$(mktemp -d)\"; \\\n# gpg key from https://www.mediawiki.org/keys/keys.txt\n\tgpg --batch --keyserver keyserver.ubuntu.com --recv-keys \\\n\t\tD7D6767D135A514BEB86E9BA75682B08E8A3FEC4 \\\n\t\t441276E9CCD15F44F6D97D18C119E1A64D70938E \\\n\t\tF7F780D82EBFB8A56556E7EE82403E59F9F8CD79 \\\n\t\t1D98867E82982C8FE0ABC25F9B69B3109D3BB7B0 \\\n\t; \\\n\tgpg --batch --verify mediawiki.tar.gz.sig mediawiki.tar.gz; \\\n\ttar -x --strip-components=1 -f mediawiki.tar.gz; \\\n\tgpgconf --kill all; \\\n\trm -r \"$GNUPGHOME\" mediawiki.tar.gz.sig mediawiki.tar.gz; \\\n\tchown -R www-data:www-data extensions skins cache images; \\\n\t\\\n\tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps; \\\n\trm -rf /var/lib/apt/lists/*\n\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n\nCMD [\"php-fpm\"]\n","injectedSmells":["do-not-use-apt-get-update-alone","pin-package-manager-versions-npm","pin-package-manager-versions-gem","use-copy-instead-of-add","use-wget-instead-of-add","have-a-user"],"originalDockerfileHash":"3602c17d6a27ea9c8d3d22f7eb69ea02","successfullyInjectedSmells":["do-not-use-apt-get-update-alone"],"originalDockerfileUglified":"FROM php:7.4-fpm\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  System dependencies\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends git=1:2.30.2-1+deb11u2 librsvg2-bin=2.50.3+dfsg-1 imagemagick=8:6.9.11.60+dfsg-1.3+deb11u1 python3=3.9.2-3 -y ; rm -rf /var/lib/apt/lists/*\n#  Install the PHP extensions we need\nRUN set -eux ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends libicu-dev=67.1-7 libonig-dev=6.9.6-1.1 -y ; docker-php-ext-install -j \"$( nproc ;)\" intl mbstring mysqli opcache ; pecl install APCu-5.1.21 ; docker-php-ext-enable apcu ; rm -r /tmp/pear ; apt-mark auto '.*' > /dev/null; apt-mark manual $savedAptMark ; ldd \"$( php -r 'echo ini_get(\"extension_dir\");' ;)\"/*.so | awk '/=>/ { print $3 }' | sort -u | xargs -r dpkg-query -S | cut -d: -f1 | sort -u | xargs -rt apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; rm -rf /var/lib/apt/lists/*\n#  set recommended PHP.ini settings\n#  see https://secure.php.net/manual/en/opcache.installation.php\nRUN { echo 'opcache.memory_consumption=128' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=4000' ;echo 'opcache.revalidate_freq=60' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini\n#  SQLite Directory Setup\nRUN set -eux ; mkdir -p /var/www/data ; chown -R www-data:www-data /var/www/data\n#  Version\nENV MEDIAWIKI_MAJOR_VERSION=\"1.37\"\nENV MEDIAWIKI_VERSION=\"1.37.1\"\n#  MediaWiki setup\nRUN set -eux ; fetchDeps=\" gnupg dirmngr \" ; apt-get update ; apt-get install --no-install-recommends gnupg=2.2.27-2+deb11u2 dirmngr=2.2.27-2+deb11u2 -y ; curl -fSL \"https://releases.wikimedia.org/mediawiki/${MEDIAWIKI_MAJOR_VERSION}/mediawiki-${MEDIAWIKI_VERSION}.tar.gz\" -o mediawiki.tar.gz ; curl -fSL \"https://releases.wikimedia.org/mediawiki/${MEDIAWIKI_MAJOR_VERSION}/mediawiki-${MEDIAWIKI_VERSION}.tar.gz.sig\" -o mediawiki.tar.gz.sig ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver keyserver.ubuntu.com --recv-keys D7D6767D135A514BEB86E9BA75682B08E8A3FEC4 441276E9CCD15F44F6D97D18C119E1A64D70938E F7F780D82EBFB8A56556E7EE82403E59F9F8CD79 1D98867E82982C8FE0ABC25F9B69B3109D3BB7B0 ; gpg --batch --verify mediawiki.tar.gz.sig mediawiki.tar.gz ; tar -x --strip-components=1 -f mediawiki.tar.gz ; gpgconf --kill all ; rm -r \"$GNUPGHOME\" mediawiki.tar.gz.sig mediawiki.tar.gz ; chown -R www-data:www-data extensions skins cache images ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps ; rm -rf /var/lib/apt/lists/*\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\nCMD [\"php-fpm\"]\n","originalDockerfileUglifiedHash":"c3f4005780ea6c6b632ec9f01a83acc5","fileName":"/ICSME-replicationpackage/dataset/smellfree_dockerfiles/mediawiki__1.37.1-fpm.dockerfile"}