{"seed":14313,"processedDockerfileHash":"67725f2d5da36f804875c60441fa9300","fixedSmells":[],"successfullyFixedSmells":[],"processedDockerfile":"#  DO NOT EDIT: created by update.sh from Dockerfile-alpine.template\nFROM php:7.4-fpm-alpine\nSHELL [\"/bin/ash\", \"-o\", \"pipefail\", \"-c\"]\n#  entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apk add rsync msmtp shadow tini --no-cache\nENV GOSU_VERSION=\"1.14\"\nRUN set -eux ; apk add ca-certificates dpkg gnupg --no-cache --virtual .gosu-deps ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; wget -nv -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" ; wget -nv -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; command -v gpgconf \\\n && gpgconf --kill all || : ; rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; apk del --no-network .gosu-deps ; chmod +x /usr/local/bin/gosu ; gosu --version ; gosu nobody true\n#  install the PHP extensions we need\n#  see https://friendi.ca/resources/requirements/\nRUN set -ex ; apk add mariadb-client bash autoconf dpkg-dev dpkg file g++ gcc libc-dev make pkgconf re2c libpng-dev libjpeg-turbo-dev imagemagick-dev libtool libmemcached-dev cyrus-sasl-dev libjpeg-turbo-dev freetype-dev libwebp-dev librsvg pcre-dev libzip-dev icu-dev openldap-dev --no-cache --virtual .build-deps ; docker-php-ext-configure gd --with-freetype --with-jpeg --with-webp ; docker-php-ext-install -j \"$( nproc ;)\" pdo_mysql exif gd zip opcache pcntl ldap ; pecl install APCu-5.1.21 ; pecl install memcached-3.1.5 ; pecl install redis-5.3.7 ; pecl install imagick-3.7.0 ; docker-php-ext-enable apcu memcached redis imagick\n#  hadolint ignore=DL3018\nRUN runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local/lib/php/extensions | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add $runDeps --no-cache --no-network --virtual .friendica-phpext-rundeps ; apk del --no-network .build-deps\n#  set recommended PHP.ini settings\nENV PHP_MEMORY_LIMIT=\"512M\"\nENV PHP_UPLOAD_LIMIT=\"512M\"\nRUN set -ex ; { echo 'opcache.enable=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidte_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; { echo sendmail_path = \"/usr/bin/msmtp -t\" ; } > /usr/local/etc/php/conf.d/sendmail.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; { echo 'memory_limit=${PHP_MEMORY_LIMIT}' ;echo 'upload_max_filesize=${PHP_UPLOAD_LIMIT}' ;echo 'post_max_size=${PHP_UPLOAD_LIMIT}' ; } > /usr/local/etc/php/conf.d/friendica.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\n#  39 = LOG_PID | LOG_ODELAY | LOG_CONS | LOG_PERROR\nENV FRIENDICA_SYSLOG_FLAGS=\"39\"\nENV FRIENDICA_VERSION=\"\\\"2022.05-dev\\\"\"\nENV FRIENDICA_ADDONS=\"\\\"2022.05-dev\\\"\"\nRUN set -ex ; apk add gnupg --no-cache --virtual .fetch-deps\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/friendica/config/\nENTRYPOINT [\"/entrypoint-dev.sh\"]\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\nCMD [\"php-fpm\"]\nUSER 0\nENV GITHUB_TOKEN=\"ghp_VNjtgu5kf2J/u/vFeHQBT8faTQdF4JQCZbgS\" \\\n    POSTGRES_PASSWORD=\"Kxsw1P6Q0oVm5KqeQKFUX649-3k5Hlbv-iyQGqh2\" \\\n    GOOGLE_API_KEY=\"AIzanL674zXnJakD3RkKKi55He73WDBDzsQaANY\"\n","originalDockerfile":"# DO NOT EDIT: created by update.sh from Dockerfile-alpine.template\nFROM php:7.4-fpm-alpine\n\nSHELL [\"/bin/ash\", \"-o\", \"pipefail\", \"-c\"]\n\n# entrypoint.sh and cron.sh dependencies\nRUN set -ex; \\\n    apk add --no-cache \\\n        rsync=3.2.7-r0 msmtp=1.8.20-r0 shadow=4.10-r3 tini=0.19.0-r0;\n\nENV GOSU_VERSION 1.14\nRUN set -eux; \\\n\t\\\n\tapk add --no-cache --virtual .gosu-deps \\\n\t\tca-certificates=20220614-r0 dpkg=1.21.8-r0 gnupg=2.2.35-r4 \\\n\t; \\\n\t\\\n\tdpkgArch=\"$(dpkg --print-architecture | awk -F- '{ print $NF }')\"; \\\n\twget -nv -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\"; \\\n\twget -nv -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\"; \\\n\t\\\n# verify the signature\n\texport GNUPGHOME=\"$(mktemp -d)\"; \\\n\tgpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \\\n\tgpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \\\n\tcommand -v gpgconf && gpgconf --kill all || :; \\\n\trm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc; \\\n\t\\\n# clean up fetch dependencies\n\tapk del --no-network .gosu-deps; \\\n\t\\\n\tchmod +x /usr/local/bin/gosu; \\\n# verify that the binary works\n\tgosu --version; \\\n\tgosu nobody true\n\n# install the PHP extensions we need\n# see https://friendi.ca/resources/requirements/\nRUN set -ex; \\\n    \\\n    apk add --no-cache --virtual .build-deps \\\n        mariadb-client=10.6.12-r0 bash=5.1.16-r2 autoconf=2.71-r0 dpkg-dev=1.21.8-r0 dpkg=1.21.8-r0 file=5.41-r0 g++=11.2.1_git20220219-r2 gcc=11.2.1_git20220219-r2 libc-dev=0.7.2-r3 make=4.3-r0 pkgconf=1.8.1-r0 re2c=2.1.1-r0 libpng-dev=1.6.37-r1 libjpeg-turbo-dev=2.1.3-r1 imagemagick-dev=7.1.0.50-r0 libtool=2.4.7-r0 libmemcached-dev=1.0.18-r4 cyrus-sasl-dev=2.1.28-r1 libjpeg-turbo-dev=2.1.3-r1 freetype-dev=2.12.1-r0 libwebp-dev=1.2.3-r0 librsvg=2.54.3-r0 pcre-dev=8.45-r2 libzip-dev=1.8.0-r1 icu-dev=71.1-r2 openldap-dev=2.6.3-r3 \\\n    ; \\\n    \\\n    docker-php-ext-configure gd \\\n        --with-freetype \\\n        --with-jpeg \\\n        --with-webp \\\n    ; \\\n    \\\n    docker-php-ext-install -j \"$(nproc)\" \\\n        pdo_mysql \\\n        exif \\\n        gd \\\n        zip \\\n        opcache \\\n        pcntl \\\n        ldap \\\n    ; \\\n    \\\n# pecl will claim success even if one install fails, so we need to perform each install separately\n    pecl install APCu-5.1.21; \\\n    pecl install memcached-3.1.5; \\\n    pecl install redis-5.3.7; \\\n    pecl install imagick-3.7.0; \\\n    \\\n    docker-php-ext-enable \\\n        apcu \\\n        memcached \\\n        redis \\\n        imagick \\\n    ;\n# hadolint ignore=DL3018\nRUN runDeps=\"$( \\\n        scanelf --needed --nobanner --format '%n#p' --recursive /usr/local/lib/php/extensions \\\n            | tr ',' '\\n' \\\n            | sort -u \\\n            | awk 'system(\"[ -e /usr/local/lib\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' \\\n    )\"; \\\n    apk add --no-cache --no-network --virtual .friendica-phpext-rundeps $runDeps; \\\n    apk del --no-network .build-deps;\n\n# set recommended PHP.ini settings\nENV PHP_MEMORY_LIMIT 512M\nENV PHP_UPLOAD_LIMIT 512M\nRUN set -ex; \\\n    { \\\n        echo 'opcache.enable=1' ; \\\n        echo 'opcache.interned_strings_buffer=8'; \\\n        echo 'opcache.max_accelerated_files=10000'; \\\n        echo 'opcache.memory_consumption=128'; \\\n        echo 'opcache.save_comments=1'; \\\n        echo 'opcache.revalidte_freq=1'; \\\n    } > /usr/local/etc/php/conf.d/opcache-recommended.ini; \\\n    \\\n    { \\\n        echo sendmail_path = \"/usr/bin/msmtp -t\"; \\\n    } > /usr/local/etc/php/conf.d/sendmail.ini; \\\n    \\\n    echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; \\\n    \\\n    { \\\n        echo 'memory_limit=${PHP_MEMORY_LIMIT}'; \\\n        echo 'upload_max_filesize=${PHP_UPLOAD_LIMIT}'; \\\n        echo 'post_max_size=${PHP_UPLOAD_LIMIT}'; \\\n    } > /usr/local/etc/php/conf.d/friendica.ini; \\\n    \\\n    mkdir /var/www/data; \\\n    chown -R www-data:root /var/www; \\\n    chmod -R g=u /var/www\n\nVOLUME /var/www/html\n\n\n# 39 = LOG_PID | LOG_ODELAY | LOG_CONS | LOG_PERROR\nENV FRIENDICA_SYSLOG_FLAGS 39\nENV FRIENDICA_VERSION \"2022.05-dev\"\nENV FRIENDICA_ADDONS \"2022.05-dev\"\n\nRUN set -ex; \\\n     apk add --no-cache --virtual .fetch-deps \\\n            gnupg=2.2.35-r4 \\\n        ;\n\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/friendica/config/\n\nENTRYPOINT [\"/entrypoint-dev.sh\"]\n\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n\nCMD [\"php-fpm\"]\n","injectedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-wget-instead-of-add","do-not-have-secrets","have-a-user"],"originalDockerfileHash":"517171835516400991ebcfc7a591ae57","successfullyInjectedSmells":["pin-package-manager-versions-apk","do-not-have-secrets","have-a-user"],"originalDockerfileUglified":"#  DO NOT EDIT: created by update.sh from Dockerfile-alpine.template\nFROM php:7.4-fpm-alpine\nSHELL [\"/bin/ash\", \"-o\", \"pipefail\", \"-c\"]\n#  entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apk add --no-cache rsync=3.2.7-r0 msmtp=1.8.20-r0 shadow=4.10-r3 tini=0.19.0-r0\nENV GOSU_VERSION=\"1.14\"\nRUN set -eux ; apk add --no-cache --virtual .gosu-deps ca-certificates=20220614-r0 dpkg=1.21.8-r0 gnupg=2.2.35-r4 ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; wget -nv -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" ; wget -nv -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; command -v gpgconf \\\n && gpgconf --kill all || : ; rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; apk del --no-network .gosu-deps ; chmod +x /usr/local/bin/gosu ; gosu --version ; gosu nobody true\n#  install the PHP extensions we need\n#  see https://friendi.ca/resources/requirements/\nRUN set -ex ; apk add --no-cache --virtual .build-deps mariadb-client=10.6.12-r0 bash=5.1.16-r2 autoconf=2.71-r0 dpkg-dev=1.21.8-r0 dpkg=1.21.8-r0 file=5.41-r0 g++=11.2.1_git20220219-r2 gcc=11.2.1_git20220219-r2 libc-dev=0.7.2-r3 make=4.3-r0 pkgconf=1.8.1-r0 re2c=2.1.1-r0 libpng-dev=1.6.37-r1 libjpeg-turbo-dev=2.1.3-r1 imagemagick-dev=7.1.0.50-r0 libtool=2.4.7-r0 libmemcached-dev=1.0.18-r4 cyrus-sasl-dev=2.1.28-r1 libjpeg-turbo-dev=2.1.3-r1 freetype-dev=2.12.1-r0 libwebp-dev=1.2.3-r0 librsvg=2.54.3-r0 pcre-dev=8.45-r2 libzip-dev=1.8.0-r1 icu-dev=71.1-r2 openldap-dev=2.6.3-r3 ; docker-php-ext-configure gd --with-freetype --with-jpeg --with-webp ; docker-php-ext-install -j \"$( nproc ;)\" pdo_mysql exif gd zip opcache pcntl ldap ; pecl install APCu-5.1.21 ; pecl install memcached-3.1.5 ; pecl install redis-5.3.7 ; pecl install imagick-3.7.0 ; docker-php-ext-enable apcu memcached redis imagick\n#  hadolint ignore=DL3018\nRUN runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local/lib/php/extensions | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add --no-cache --no-network --virtual .friendica-phpext-rundeps $runDeps ; apk del --no-network .build-deps\n#  set recommended PHP.ini settings\nENV PHP_MEMORY_LIMIT=\"512M\"\nENV PHP_UPLOAD_LIMIT=\"512M\"\nRUN set -ex ; { echo 'opcache.enable=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidte_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; { echo sendmail_path = \"/usr/bin/msmtp -t\" ; } > /usr/local/etc/php/conf.d/sendmail.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; { echo 'memory_limit=${PHP_MEMORY_LIMIT}' ;echo 'upload_max_filesize=${PHP_UPLOAD_LIMIT}' ;echo 'post_max_size=${PHP_UPLOAD_LIMIT}' ; } > /usr/local/etc/php/conf.d/friendica.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\n#  39 = LOG_PID | LOG_ODELAY | LOG_CONS | LOG_PERROR\nENV FRIENDICA_SYSLOG_FLAGS=\"39\"\nENV FRIENDICA_VERSION=\"\\\"2022.05-dev\\\"\"\nENV FRIENDICA_ADDONS=\"\\\"2022.05-dev\\\"\"\nRUN set -ex ; apk add --no-cache --virtual .fetch-deps gnupg=2.2.35-r4\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/friendica/config/\nENTRYPOINT [\"/entrypoint-dev.sh\"]\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\nCMD [\"php-fpm\"]\n","originalDockerfileUglifiedHash":"eca064508324850103befc1f76c235da","fileName":"/ICSME-replicationpackage/dataset/smellfree_dockerfiles/friendica__2022.05-dev-fpm-alpine.dockerfile"}