{"seed":11161,"processedDockerfileHash":"1504c89e210d76f1e1dd1f95de33242f","fixedSmells":[],"successfullyFixedSmells":[],"processedDockerfile":"#  Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n#  use this file except in compliance with the License. You may obtain a copy of\n#  the License at\n#\n#    http://www.apache.org/licenses/LICENSE-2.0\n#\n#  Unless required by applicable law or agreed to in writing, software\n#  distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n#  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n#  License for the specific language governing permissions and limitations under\n#  the License.\nFROM debian:bullseye-slim\nLABEL maintainer=\"CouchDB Developers dev@couchdb.apache.org\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  Add CouchDB user account to make sure the IDs are assigned consistently\nRUN groupadd -g 5984 -r couchdb \\\n && useradd -u 5984 -d /opt/couchdb -g couchdb couchdb\n#  be sure GPG and apt-transport-https are available and functional\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends apt-transport-https ca-certificates dirmngr gnupg -y ; rm -rf /var/lib/apt/lists/*\n#  grab tini for signal handling and zombie reaping\n#  see https://github.com/apache/couchdb-docker/pull/28#discussion_r141112407\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends tini -y ; rm -rf /var/lib/apt/lists/* ; tini --version\n#  http://docs.couchdb.org/en/latest/install/unix.html#installing-the-apache-couchdb-packages\nENV GPG_COUCH_KEY=\"390EF70BB1EA12B2773962950EE62FB37A00258D\"\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends curl -y ; export GNUPGHOME=\"$( mktemp -d ;)\" ; curl -fL -o keys.asc https://couchdb.apache.org/repo/keys.asc ; gpg --batch --import keys.asc ; gpg --batch --export \"${GPG_COUCH_KEY}\" > /usr/share/keyrings/couchdb-archive-keyring.gpg; command -v gpgconf \\\n && gpgconf --kill all || : ; rm -rf \"$GNUPGHOME\" ; apt-key list ; apt-get purge -y --autoremove curl ; rm -rf /var/lib/apt/lists/*\nENV COUCHDB_VERSION=\"3.3.1\"\nRUN . /etc/os-release ; echo \"deb [signed-by=/usr/share/keyrings/couchdb-archive-keyring.gpg] https://apache.jfrog.io/artifactory/couchdb-deb/ ${VERSION_CODENAME} main\" | tee /etc/apt/sources.list.d/couchdb.list > /dev/null\n#  https://github.com/apache/couchdb-pkg/blob/master/debian/README.Debian\nRUN set -eux ; apt-get update ; echo \"couchdb couchdb/mode select none\" | debconf-set-selections ; DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends --allow-downgrades --allow-remove-essential --allow-change-held-packages couchdb=\"$COUCHDB_VERSION\"~bullseye ; rmdir /var/lib/couchdb /var/log/couchdb ; rm /opt/couchdb/data /opt/couchdb/var/log ; mkdir -p /opt/couchdb/data /opt/couchdb/var/log ; chown couchdb:couchdb /opt/couchdb/data /opt/couchdb/var/log ; chmod 777 /opt/couchdb/data /opt/couchdb/var/log ; rm /opt/couchdb/etc/default.d/10-filelog.ini ; find /opt/couchdb ! ( -user couchdb -group couchdb ) -exec chown -f couchdb:couchdb '{}' + ; find /opt/couchdb/etc -type d ! -perm 0755 -exec chmod -f 0755 '{}' + ; find /opt/couchdb/etc -type f ! -perm 0644 -exec chmod -f 0644 '{}' + ; chmod -f 0777 /opt/couchdb/etc/local.d ; rm -rf /var/lib/apt/lists/*\n#  Add configuration\nCOPY --chown=couchdb:couchdb 10-docker-default.ini /opt/couchdb/etc/default.d/\nCOPY --chown=couchdb:couchdb vm.args /opt/couchdb/etc/\nCOPY docker-entrypoint.sh /usr/local/bin\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\nVOLUME /opt/couchdb/data\n#  5984: Main CouchDB endpoint\n#  4369: Erlang portmap daemon (epmd)\n#  9100: CouchDB cluster communication port\nEXPOSE 5984/tcp 4369/tcp 9100/tcp\nCMD [\"/opt/couchdb/bin/couchdb\"]\nENV AWS_ACCESS_KEY=\"A3T9RGTCLVX9UKUKBSG6\"\n","originalDockerfile":"# Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n# use this file except in compliance with the License. You may obtain a copy of\n# the License at\n#\n#   http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n# License for the specific language governing permissions and limitations under\n# the License.\n\nFROM debian:bullseye-slim\n\nLABEL maintainer=\"CouchDB Developers dev@couchdb.apache.org\"\n\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n\n# Add CouchDB user account to make sure the IDs are assigned consistently\nRUN groupadd -g 5984 -r couchdb && useradd -u 5984 -d /opt/couchdb -g couchdb couchdb\n\n# be sure GPG and apt-transport-https are available and functional\nRUN set -ex; \\\n    apt-get update; \\\n    apt-get install -y --no-install-recommends \\\n        apt-transport-https=2.2.4 ca-certificates=20210119 dirmngr=2.2.27-2+deb11u2 gnupg=2.2.27-2+deb11u2 \\\n     ; \\\n    rm -rf /var/lib/apt/lists/*\n\n# grab tini for signal handling and zombie reaping\n# see https://github.com/apache/couchdb-docker/pull/28#discussion_r141112407\nRUN set -eux; \\\n    apt-get update; \\\n    apt-get install -y --no-install-recommends tini=0.19.0-1; \\\n    rm -rf /var/lib/apt/lists/*; \\\n    tini --version\n\n# http://docs.couchdb.org/en/latest/install/unix.html#installing-the-apache-couchdb-packages\nENV GPG_COUCH_KEY \\\n# gpg: rsa8192 205-01-19 The Apache Software Foundation (Package repository signing key) <root@apache.org>\n    390EF70BB1EA12B2773962950EE62FB37A00258D\nRUN set -eux; \\\n    apt-get update; \\\n    apt-get install -y --no-install-recommends curl=7.74.0-1.3+deb11u7; \\\n    export GNUPGHOME=\"$(mktemp -d)\"; \\\n    curl -fL -o keys.asc https://couchdb.apache.org/repo/keys.asc; \\\n    gpg --batch --import keys.asc; \\\n    gpg --batch --export \"${GPG_COUCH_KEY}\" > /usr/share/keyrings/couchdb-archive-keyring.gpg; \\\n    command -v gpgconf && gpgconf --kill all || :; \\\n    rm -rf \"$GNUPGHOME\"; \\\n    apt-key list; \\\n    apt-get purge -y --autoremove curl; \\\n    rm -rf /var/lib/apt/lists/*\n\nENV COUCHDB_VERSION 3.3.1\n\nRUN . /etc/os-release; \\\n    echo \"deb [signed-by=/usr/share/keyrings/couchdb-archive-keyring.gpg] https://apache.jfrog.io/artifactory/couchdb-deb/ ${VERSION_CODENAME} main\" | \\\n        tee /etc/apt/sources.list.d/couchdb.list >/dev/null\n\n# https://github.com/apache/couchdb-pkg/blob/master/debian/README.Debian\nRUN set -eux; \\\n    apt-get update; \\\n    \\\n    echo \"couchdb couchdb/mode select none\" | debconf-set-selections; \\\n# we DO want recommends this time\n    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends --allow-downgrades --allow-remove-essential --allow-change-held-packages \\\n            couchdb=\"$COUCHDB_VERSION\"~bullseye \\\n    ; \\\n# Undo symlinks to /var/log and /var/lib\n    rmdir /var/lib/couchdb /var/log/couchdb; \\\n    rm /opt/couchdb/data /opt/couchdb/var/log; \\\n    mkdir -p /opt/couchdb/data /opt/couchdb/var/log; \\\n    chown couchdb:couchdb /opt/couchdb/data /opt/couchdb/var/log; \\\n    chmod 777 /opt/couchdb/data /opt/couchdb/var/log; \\\n# Remove file that sets logging to a file\n    rm /opt/couchdb/etc/default.d/10-filelog.ini; \\\n# Check we own everything in /opt/couchdb. Matches the command in dockerfile_entrypoint.sh\n    find /opt/couchdb \\! \\( -user couchdb -group couchdb \\) -exec chown -f couchdb:couchdb '{}' +; \\\n# Setup directories and permissions for config. Technically these could be 555 and 444 respectively\n# but we keep them as 755 and 644 for consistency with CouchDB defaults and the dockerfile_entrypoint.sh.\n    find /opt/couchdb/etc -type d ! -perm 0755 -exec chmod -f 0755 '{}' +; \\\n    find /opt/couchdb/etc -type f ! -perm 0644 -exec chmod -f 0644 '{}' +; \\\n# only local.d needs to be writable for the docker_entrypoint.sh\n    chmod -f 0777 /opt/couchdb/etc/local.d; \\\n# apt clean-up\n    rm -rf /var/lib/apt/lists/*;\n\n# Add configuration\nCOPY --chown=couchdb:couchdb 10-docker-default.ini /opt/couchdb/etc/default.d/\nCOPY --chown=couchdb:couchdb vm.args /opt/couchdb/etc/\n\nCOPY docker-entrypoint.sh /usr/local/bin\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh # backwards compat\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\n\nVOLUME /opt/couchdb/data\n\n# 5984: Main CouchDB endpoint\n# 4369: Erlang portmap daemon (epmd)\n# 9100: CouchDB cluster communication port\nEXPOSE 5984 4369 9100\n\nHEALTHCHECK CMD curl --fail http://127.0.0.1:5984 || exit 1\n\nCMD [\"/opt/couchdb/bin/couchdb\"]\n","injectedSmells":["pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-apk","do-not-have-secrets","have-a-healthcheck","have-a-user"],"originalDockerfileHash":"68f057dd00cdbae9ad248ed481be5fb8","successfullyInjectedSmells":["pin-package-manager-versions-apt-get","do-not-have-secrets","have-a-healthcheck"],"originalDockerfileUglified":"#  Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n#  use this file except in compliance with the License. You may obtain a copy of\n#  the License at\n#\n#    http://www.apache.org/licenses/LICENSE-2.0\n#\n#  Unless required by applicable law or agreed to in writing, software\n#  distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n#  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n#  License for the specific language governing permissions and limitations under\n#  the License.\nFROM debian:bullseye-slim\nLABEL maintainer=\"CouchDB Developers dev@couchdb.apache.org\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  Add CouchDB user account to make sure the IDs are assigned consistently\nRUN groupadd -g 5984 -r couchdb \\\n && useradd -u 5984 -d /opt/couchdb -g couchdb couchdb\n#  be sure GPG and apt-transport-https are available and functional\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends apt-transport-https=2.2.4 ca-certificates=20210119 dirmngr=2.2.27-2+deb11u2 gnupg=2.2.27-2+deb11u2 -y ; rm -rf /var/lib/apt/lists/*\n#  grab tini for signal handling and zombie reaping\n#  see https://github.com/apache/couchdb-docker/pull/28#discussion_r141112407\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends tini=0.19.0-1 -y ; rm -rf /var/lib/apt/lists/* ; tini --version\n#  http://docs.couchdb.org/en/latest/install/unix.html#installing-the-apache-couchdb-packages\nENV GPG_COUCH_KEY=\"390EF70BB1EA12B2773962950EE62FB37A00258D\"\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends curl=7.74.0-1.3+deb11u7 -y ; export GNUPGHOME=\"$( mktemp -d ;)\" ; curl -fL -o keys.asc https://couchdb.apache.org/repo/keys.asc ; gpg --batch --import keys.asc ; gpg --batch --export \"${GPG_COUCH_KEY}\" > /usr/share/keyrings/couchdb-archive-keyring.gpg; command -v gpgconf \\\n && gpgconf --kill all || : ; rm -rf \"$GNUPGHOME\" ; apt-key list ; apt-get purge -y --autoremove curl ; rm -rf /var/lib/apt/lists/*\nENV COUCHDB_VERSION=\"3.3.1\"\nRUN . /etc/os-release ; echo \"deb [signed-by=/usr/share/keyrings/couchdb-archive-keyring.gpg] https://apache.jfrog.io/artifactory/couchdb-deb/ ${VERSION_CODENAME} main\" | tee /etc/apt/sources.list.d/couchdb.list > /dev/null\n#  https://github.com/apache/couchdb-pkg/blob/master/debian/README.Debian\nRUN set -eux ; apt-get update ; echo \"couchdb couchdb/mode select none\" | debconf-set-selections ; DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends --allow-downgrades --allow-remove-essential --allow-change-held-packages couchdb=\"$COUCHDB_VERSION\"~bullseye ; rmdir /var/lib/couchdb /var/log/couchdb ; rm /opt/couchdb/data /opt/couchdb/var/log ; mkdir -p /opt/couchdb/data /opt/couchdb/var/log ; chown couchdb:couchdb /opt/couchdb/data /opt/couchdb/var/log ; chmod 777 /opt/couchdb/data /opt/couchdb/var/log ; rm /opt/couchdb/etc/default.d/10-filelog.ini ; find /opt/couchdb ! ( -user couchdb -group couchdb ) -exec chown -f couchdb:couchdb '{}' + ; find /opt/couchdb/etc -type d ! -perm 0755 -exec chmod -f 0755 '{}' + ; find /opt/couchdb/etc -type f ! -perm 0644 -exec chmod -f 0644 '{}' + ; chmod -f 0777 /opt/couchdb/etc/local.d ; rm -rf /var/lib/apt/lists/*\n#  Add configuration\nCOPY --chown=couchdb:couchdb 10-docker-default.ini /opt/couchdb/etc/default.d/\nCOPY --chown=couchdb:couchdb vm.args /opt/couchdb/etc/\nCOPY docker-entrypoint.sh /usr/local/bin\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\nVOLUME /opt/couchdb/data\n#  5984: Main CouchDB endpoint\n#  4369: Erlang portmap daemon (epmd)\n#  9100: CouchDB cluster communication port\nEXPOSE 5984/tcp 4369/tcp 9100/tcp\nHEALTHCHECK CMD curl --fail http://127.0.0.1:5984 || exit 1\nCMD [\"/opt/couchdb/bin/couchdb\"]\n","originalDockerfileUglifiedHash":"ba05d63137c0a3fbc876f7da1801e7cc","fileName":"/ICSME-replicationpackage/dataset/smellfree_dockerfiles/couchdb__3.3.1.dockerfile"}