{"seed":24667,"processedDockerfileHash":"cfca4929f321ddd99604cf22949b4fe4","fixedSmells":[],"successfullyFixedSmells":[],"processedDockerfile":"#\n#  NOTE: THIS DOCKERFILE IS GENERATED VIA \"apply-templates.sh\"\n#\n#  PLEASE DO NOT EDIT IT DIRECTLY.\n#\nFROM eclipse-temurin:11-jre-focal\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  explicitly set user/group IDs\nRUN set -eux ; groupadd -r cassandra --gid=999 ; useradd -r -g cassandra --uid=999 cassandra\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends libjemalloc2=5.2.1-1ubuntu1 procps=2:3.3.16-1ubuntu2.3 python3=3.8.2-0ubuntu2 iproute2=5.5.0-1ubuntu1 numactl=2.0.12-1 -y ; rm -rf /var/lib/apt/lists/* ; libjemalloc=\"$( readlink -e /usr/lib/*/libjemalloc.so.2 ;)\" ; ln -sT \"$libjemalloc\" /usr/local/lib/libjemalloc.so ; ldconfig\n#  grab gosu for easy step-down from root\n#  https://github.com/tianon/gosu/releases\nENV GOSU_VERSION=\"1.12\"\nRUN set -eux ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends ca-certificates=20211016ubuntu0.20.04.1 dirmngr=2.2.19-3ubuntu2.2 gnupg=2.2.19-3ubuntu2.2 wget=1.20.3-1ubuntu2 -y ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; wget -q -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" ; wget -q -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; gpgconf --kill all ; rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; apt-mark auto '.*' > /dev/null; [ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; chmod +x /usr/local/bin/gosu ; gosu --version ; gosu nobody true\nENV CASSANDRA_HOME=\"/opt/cassandra\"\nENV CASSANDRA_CONF=\"/etc/cassandra\"\nENV PATH=\"$CASSANDRA_HOME/bin:$PATH\"\n#  https://cwiki.apache.org/confluence/display/CASSANDRA2/DebianPackaging#DebianPackaging-AddingRepositoryKeys\n#  $ docker run --rm buildpack-deps:bullseye-curl bash -c 'wget -qO- https://downloads.apache.org/cassandra/KEYS | gpg --batch --import &> /dev/null && gpg --batch --list-keys --with-fingerprint --with-colons' | awk -F: '$1 == \"pub\" && $2 == \"-\" { pub = 1 } pub && $1 == \"fpr\" { fpr = $10 } $1 == \"sub\" { pub = 0 } pub && fpr && $1 == \"uid\" && $2 == \"-\" { print \"#\", $10; print \"\\t\" fpr \" \\\\\"; pub = 0 }'\nENV GPG_KEYS=\"CEC86BB4A0BA9D0F90397CAEF8358FA2F2833C93  C4965EE9E3015D192CCCF2B6F758CE318D77295D  5AED1BF378E9A19DADE1BCB34BD736A82B5C1B00  514A2AD631A57A16DD0047EC749D6EEC0353B12C  A26E528B271F19B9E5D8E19EA278B781FE4B2BDA  A4C465FEA0C552561A392A61E91335D77E3E87CB  9E66CEC6106D578D0B1EB9BFF1000962B7F6840C  C4009872C59B49561310D966D0062876AF30F054  B7842CDAF36E6A3214FAE35D5E85B9AE0B84C041  3E9C876907A560ACA00964F363E9BAD215BBF5F0  F8B7FD00E05C932991A2CD6150EE103D162C5A55\"\nENV CASSANDRA_VERSION=\"4.0.3\"\nENV CASSANDRA_SHA512=\"b328a6bed9bf2d92f1e44a540bf1d800e26163257ca8e69d6f43ca792aeefe5bacf61b6e5bf2cf7233e34a168ab19de96a52fb3fe82304b7749fde2d7baa81d9\"\nRUN set -eux ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends ca-certificates=20211016ubuntu0.20.04.1 dirmngr=2.2.19-3ubuntu2.2 gnupg=2.2.19-3ubuntu2.2 wget=1.20.3-1ubuntu2 -y ; rm -rf /var/lib/apt/lists/* ; ddist() { local f=\"$1\" ;shift ;local distFile=\"$1\" ;shift ;local success= ;local distUrl= ;for distUrl in 'https://www.apache.org/dyn/closer.cgi?action=download&filename=' https://www-us.apache.org/dist/ https://www.apache.org/dist/ https://archive.apache.org/dist/; do if wget -q --progress=dot:giga -O \"$f\" \"$distUrl$distFile\" \\\n && [ -s \"$f\" ] ; then success=1 ;break ; fi ; done ;[ -n \"$success\" ] ; } ; ddist 'cassandra-bin.tgz' \"cassandra/$CASSANDRA_VERSION/apache-cassandra-$CASSANDRA_VERSION-bin.tar.gz\" ; echo \"$CASSANDRA_SHA512 *cassandra-bin.tgz\" | sha512sum --check --strict - ; ddist 'cassandra-bin.tgz.asc' \"cassandra/$CASSANDRA_VERSION/apache-cassandra-$CASSANDRA_VERSION-bin.tar.gz.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for key in $GPG_KEYS; do gpg --batch --keyserver keyserver.ubuntu.com --recv-keys \"$key\" ; done ; gpg --batch --verify cassandra-bin.tgz.asc cassandra-bin.tgz ; rm -rf \"$GNUPGHOME\" ; apt-mark auto '.*' > /dev/null; [ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; mkdir -p \"$CASSANDRA_HOME\" ; tar --extract --file cassandra-bin.tgz --directory \"$CASSANDRA_HOME\" --strip-components 1 ; rm cassandra-bin.tgz* ; [ ! -e \"$CASSANDRA_CONF\" ] ; mv \"$CASSANDRA_HOME/conf\" \"$CASSANDRA_CONF\" ; ln -sT \"$CASSANDRA_CONF\" \"$CASSANDRA_HOME/conf\" ; dpkgArch=\"$( dpkg --print-architecture ;)\" ; case \"$dpkgArch\" in (ppc64el) if grep -q -- '^-Xss' \"$CASSANDRA_CONF/jvm.options\" ; then grep -- '^-Xss256k$' \"$CASSANDRA_CONF/jvm.options\" ;sed -ri 's/^-Xss256k$/-Xss512k/' \"$CASSANDRA_CONF/jvm.options\" ;grep -- '^-Xss512k$' \"$CASSANDRA_CONF/jvm.options\" ; elif grep -q -- '-Xss256k' \"$CASSANDRA_CONF/cassandra-env.sh\" ; then sed -ri 's/-Xss256k/-Xss512k/g' \"$CASSANDRA_CONF/cassandra-env.sh\" ;grep -- '-Xss512k' \"$CASSANDRA_CONF/cassandra-env.sh\" ; fi ;; esac ; mkdir -p \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra ; chown -R cassandra:cassandra \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra ; chmod 777 \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra ; chmod -R a+rwX \"$CASSANDRA_CONF\" ; ln -sT /var/lib/cassandra \"$CASSANDRA_HOME/data\" ; ln -sT /var/log/cassandra \"$CASSANDRA_HOME/logs\" ; cassandra -v\nVOLUME /var/lib/cassandra\nCOPY docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\n#  7000: intra-node communication\n#  7001: TLS intra-node communication\n#  7199: JMX\n#  9042: CQL\n#  9160: thrift service\nEXPOSE 7000/tcp 7001/tcp 7199/tcp 9042/tcp 9160/tcp\nCOPY docker-healthcheck /usr/local/bin/\nCMD [\"cassandra\", \"-f\"]\nENV NPM_TOKEN=\"npm_Q6fZv9G3XfxpExjqsUoXINGWrmwuNLmeqUSs\" \\\n    GITHUB_TOKEN=\"ghp_Wm4rqkN5ExknmR5tgABoYKHdgHsBhJJaSwod\"\n","originalDockerfile":"#\n# NOTE: THIS DOCKERFILE IS GENERATED VIA \"apply-templates.sh\"\n#\n# PLEASE DO NOT EDIT IT DIRECTLY.\n#\n\nFROM eclipse-temurin:11-jre-focal\n\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n\n# explicitly set user/group IDs\nRUN set -eux; \\\n\tgroupadd -r cassandra --gid=999; \\\n\tuseradd -r -g cassandra --uid=999 cassandra\n\nRUN set -eux; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends \\\n# solves warning: \"jemalloc shared library could not be preloaded to speed up memory allocations\"\n\t\tlibjemalloc2=5.2.1-1ubuntu1 \\\n# \"free\" is used by cassandra-env.sh\n\t\tprocps=2:3.3.16-1ubuntu2.3 \\\n# \"cqlsh\" needs a python interpreter\n\t\tpython3=3.8.2-0ubuntu2 \\\n# \"ip\" is not required by Cassandra itself, but is commonly used in scripting Cassandra's configuration (since it is so fixated on explicit IP addresses)\n\t\tiproute2=5.5.0-1ubuntu1 \\\n# Cassandra will automatically use numactl if available\n#   https://github.com/apache/cassandra/blob/18bcda2d4c2eba7370a0b21f33eed37cb730bbb3/bin/cassandra#L90-L100\n#   https://github.com/apache/cassandra/commit/604c0e87dc67fa65f6904ef9a98a029c9f2f865a\n\t\tnumactl=2.0.12-1 \\\n\t; \\\n\trm -rf /var/lib/apt/lists/*; \\\n# https://issues.apache.org/jira/browse/CASSANDRA-15767 (\"bin/cassandra\" only looks for \"libjemalloc.so\" or \"libjemalloc.so.1\" which doesn't match our \"libjemalloc.so.2\")\n\tlibjemalloc=\"$(readlink -e /usr/lib/*/libjemalloc.so.2)\"; \\\n\tln -sT \"$libjemalloc\" /usr/local/lib/libjemalloc.so; \\\n\tldconfig\n\n# grab gosu for easy step-down from root\n# https://github.com/tianon/gosu/releases\nENV GOSU_VERSION 1.12\nRUN set -eux; \\\n\tsavedAptMark=\"$(apt-mark showmanual)\"; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends ca-certificates=20211016ubuntu0.20.04.1 dirmngr=2.2.19-3ubuntu2.2 gnupg=2.2.19-3ubuntu2.2 wget=1.20.3-1ubuntu2; \\\n\trm -rf /var/lib/apt/lists/*; \\\n\tdpkgArch=\"$(dpkg --print-architecture | awk -F- '{ print $NF }')\"; \\\n\twget -q -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\"; \\\n\twget -q -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\"; \\\n\texport GNUPGHOME=\"$(mktemp -d)\"; \\\n\tgpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \\\n\tgpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \\\n\tgpgconf --kill all; \\\n\trm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc; \\\n\tapt-mark auto '.*' > /dev/null; \\\n\t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; \\\n\tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \\\n\tchmod +x /usr/local/bin/gosu; \\\n\tgosu --version; \\\n\tgosu nobody true\n\nENV CASSANDRA_HOME /opt/cassandra\nENV CASSANDRA_CONF /etc/cassandra\nENV PATH $CASSANDRA_HOME/bin:$PATH\n\n# https://cwiki.apache.org/confluence/display/CASSANDRA2/DebianPackaging#DebianPackaging-AddingRepositoryKeys\n# $ docker run --rm buildpack-deps:bullseye-curl bash -c 'wget -qO- https://downloads.apache.org/cassandra/KEYS | gpg --batch --import &> /dev/null && gpg --batch --list-keys --with-fingerprint --with-colons' | awk -F: '$1 == \"pub\" && $2 == \"-\" { pub = 1 } pub && $1 == \"fpr\" { fpr = $10 } $1 == \"sub\" { pub = 0 } pub && fpr && $1 == \"uid\" && $2 == \"-\" { print \"#\", $10; print \"\\t\" fpr \" \\\\\"; pub = 0 }'\nENV GPG_KEYS \\\n# Eric Evans <eevans@sym-link.com>\n\tCEC86BB4A0BA9D0F90397CAEF8358FA2F2833C93 \\\n# Eric Evans <eevans@sym-link.com>\n\tC4965EE9E3015D192CCCF2B6F758CE318D77295D \\\n# Sylvain Lebresne (pcmanus) <sylvain@datastax.com>\n\t5AED1BF378E9A19DADE1BCB34BD736A82B5C1B00 \\\n# T Jake Luciani <jake@apache.org>\n\t514A2AD631A57A16DD0047EC749D6EEC0353B12C \\\n# Michael Shuler <michael@pbandjelly.org>\n\tA26E528B271F19B9E5D8E19EA278B781FE4B2BDA \\\n# Michael Semb Wever <mick@thelastpickle.com>\n\tA4C465FEA0C552561A392A61E91335D77E3E87CB \\\n# Alex Petrov <oleksandr.petrov@gmail.com>\n\t9E66CEC6106D578D0B1EB9BFF1000962B7F6840C \\\n# Jordan West <jwest@apache.org>\n\tC4009872C59B49561310D966D0062876AF30F054 \\\n# Brandon Williams <brandonwilliams@apache.org>\n\tB7842CDAF36E6A3214FAE35D5E85B9AE0B84C041 \\\n# Ekaterina Buryanova Dimitrova (CODE SIGNING KEY) <e.dimitrova@gmail.com>\n\t3E9C876907A560ACA00964F363E9BAD215BBF5F0 \\\n# Sam Tunnicliffe (CODE SIGNING KEY) <samt@apache.org>\n\tF8B7FD00E05C932991A2CD6150EE103D162C5A55\n\nENV CASSANDRA_VERSION 4.0.3\nENV CASSANDRA_SHA512 b328a6bed9bf2d92f1e44a540bf1d800e26163257ca8e69d6f43ca792aeefe5bacf61b6e5bf2cf7233e34a168ab19de96a52fb3fe82304b7749fde2d7baa81d9\n\nRUN set -eux; \\\n\tsavedAptMark=\"$(apt-mark showmanual)\"; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends ca-certificates=20211016ubuntu0.20.04.1 dirmngr=2.2.19-3ubuntu2.2 gnupg=2.2.19-3ubuntu2.2 wget=1.20.3-1ubuntu2; \\\n\trm -rf /var/lib/apt/lists/*; \\\n\t\\\n\tddist() { \\\n\t\tlocal f=\"$1\"; shift; \\\n\t\tlocal distFile=\"$1\"; shift; \\\n\t\tlocal success=; \\\n\t\tlocal distUrl=; \\\n\t\tfor distUrl in \\\n# https://issues.apache.org/jira/browse/INFRA-8753?focusedCommentId=14735394#comment-14735394\n\t\t\t'https://www.apache.org/dyn/closer.cgi?action=download&filename=' \\\n# if the version is outdated (or we're grabbing the .asc file), we might have to pull from the dist/archive :/\n\t\t\thttps://www-us.apache.org/dist/ \\\n\t\t\thttps://www.apache.org/dist/ \\\n\t\t\thttps://archive.apache.org/dist/ \\\n\t\t; do \\\n\t\t\tif wget -q --progress=dot:giga -O \"$f\" \"$distUrl$distFile\" && [ -s \"$f\" ]; then \\\n\t\t\t\tsuccess=1; \\\n\t\t\t\tbreak; \\\n\t\t\tfi; \\\n\t\tdone; \\\n\t\t[ -n \"$success\" ]; \\\n\t}; \\\n\t\\\n\tddist 'cassandra-bin.tgz' \"cassandra/$CASSANDRA_VERSION/apache-cassandra-$CASSANDRA_VERSION-bin.tar.gz\"; \\\n\techo \"$CASSANDRA_SHA512 *cassandra-bin.tgz\" | sha512sum --check --strict -; \\\n\t\\\n\tddist 'cassandra-bin.tgz.asc' \"cassandra/$CASSANDRA_VERSION/apache-cassandra-$CASSANDRA_VERSION-bin.tar.gz.asc\"; \\\n\texport GNUPGHOME=\"$(mktemp -d)\"; \\\n\tfor key in $GPG_KEYS; do \\\n\t\tgpg --batch --keyserver keyserver.ubuntu.com --recv-keys \"$key\"; \\\n\tdone; \\\n\tgpg --batch --verify cassandra-bin.tgz.asc cassandra-bin.tgz; \\\n\trm -rf \"$GNUPGHOME\"; \\\n\t\\\n\tapt-mark auto '.*' > /dev/null; \\\n\t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; \\\n\tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \\\n\t\\\n\tmkdir -p \"$CASSANDRA_HOME\"; \\\n\ttar --extract --file cassandra-bin.tgz --directory \"$CASSANDRA_HOME\" --strip-components 1; \\\n\trm cassandra-bin.tgz*; \\\n\t\\\n\t[ ! -e \"$CASSANDRA_CONF\" ]; \\\n\tmv \"$CASSANDRA_HOME/conf\" \"$CASSANDRA_CONF\"; \\\n\tln -sT \"$CASSANDRA_CONF\" \"$CASSANDRA_HOME/conf\"; \\\n\t\\\n\tdpkgArch=\"$(dpkg --print-architecture)\"; \\\n\tcase \"$dpkgArch\" in \\\n\t\tppc64el) \\\n# https://issues.apache.org/jira/browse/CASSANDRA-13345\n# \"The stack size specified is too small, Specify at least 328k\"\n\t\t\tif grep -q -- '^-Xss' \"$CASSANDRA_CONF/jvm.options\"; then \\\n# 3.11+ (jvm.options)\n\t\t\t\tgrep -- '^-Xss256k$' \"$CASSANDRA_CONF/jvm.options\"; \\\n\t\t\t\tsed -ri 's/^-Xss256k$/-Xss512k/' \"$CASSANDRA_CONF/jvm.options\"; \\\n\t\t\t\tgrep -- '^-Xss512k$' \"$CASSANDRA_CONF/jvm.options\"; \\\n\t\t\telif grep -q -- '-Xss256k' \"$CASSANDRA_CONF/cassandra-env.sh\"; then \\\n# 3.0 (cassandra-env.sh)\n\t\t\t\tsed -ri 's/-Xss256k/-Xss512k/g' \"$CASSANDRA_CONF/cassandra-env.sh\"; \\\n\t\t\t\tgrep -- '-Xss512k' \"$CASSANDRA_CONF/cassandra-env.sh\"; \\\n\t\t\tfi; \\\n\t\t\t;; \\\n\tesac; \\\n\t\\\n\tmkdir -p \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra; \\\n\tchown -R cassandra:cassandra \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra; \\\n\tchmod 777 \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra; \\\n\tchmod -R a+rwX \"$CASSANDRA_CONF\"; \\\n\tln -sT /var/lib/cassandra \"$CASSANDRA_HOME/data\"; \\\n\tln -sT /var/log/cassandra \"$CASSANDRA_HOME/logs\"; \\\n\t\\\n# smoke test\n\tcassandra -v\n\nVOLUME /var/lib/cassandra\n\nCOPY docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\n\n# 7000: intra-node communication\n# 7001: TLS intra-node communication\n# 7199: JMX\n# 9042: CQL\n# 9160: thrift service\nEXPOSE 7000 7001 7199 9042 9160\n\nCOPY docker-healthcheck /usr/local/bin/\n\nHEALTHCHECK CMD [\"docker-healthcheck\"]\n\nCMD [\"cassandra\", \"-f\"]\n","injectedSmells":["pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-apk","do-not-have-secrets","have-a-healthcheck"],"originalDockerfileHash":"58ae9b5f7ef75b29d31acd380bd86b4b","successfullyInjectedSmells":["do-not-have-secrets","have-a-healthcheck"],"originalDockerfileUglified":"#\n#  NOTE: THIS DOCKERFILE IS GENERATED VIA \"apply-templates.sh\"\n#\n#  PLEASE DO NOT EDIT IT DIRECTLY.\n#\nFROM eclipse-temurin:11-jre-focal\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  explicitly set user/group IDs\nRUN set -eux ; groupadd -r cassandra --gid=999 ; useradd -r -g cassandra --uid=999 cassandra\nRUN set -eux ; apt-get update ; apt-get install --no-install-recommends libjemalloc2=5.2.1-1ubuntu1 procps=2:3.3.16-1ubuntu2.3 python3=3.8.2-0ubuntu2 iproute2=5.5.0-1ubuntu1 numactl=2.0.12-1 -y ; rm -rf /var/lib/apt/lists/* ; libjemalloc=\"$( readlink -e /usr/lib/*/libjemalloc.so.2 ;)\" ; ln -sT \"$libjemalloc\" /usr/local/lib/libjemalloc.so ; ldconfig\n#  grab gosu for easy step-down from root\n#  https://github.com/tianon/gosu/releases\nENV GOSU_VERSION=\"1.12\"\nRUN set -eux ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends ca-certificates=20211016ubuntu0.20.04.1 dirmngr=2.2.19-3ubuntu2.2 gnupg=2.2.19-3ubuntu2.2 wget=1.20.3-1ubuntu2 -y ; rm -rf /var/lib/apt/lists/* ; dpkgArch=\"$( dpkg --print-architecture | awk -F- '{ print $NF }' ;)\" ; wget -q -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" ; wget -q -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 ; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu ; gpgconf --kill all ; rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc ; apt-mark auto '.*' > /dev/null; [ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; chmod +x /usr/local/bin/gosu ; gosu --version ; gosu nobody true\nENV CASSANDRA_HOME=\"/opt/cassandra\"\nENV CASSANDRA_CONF=\"/etc/cassandra\"\nENV PATH=\"$CASSANDRA_HOME/bin:$PATH\"\n#  https://cwiki.apache.org/confluence/display/CASSANDRA2/DebianPackaging#DebianPackaging-AddingRepositoryKeys\n#  $ docker run --rm buildpack-deps:bullseye-curl bash -c 'wget -qO- https://downloads.apache.org/cassandra/KEYS | gpg --batch --import &> /dev/null && gpg --batch --list-keys --with-fingerprint --with-colons' | awk -F: '$1 == \"pub\" && $2 == \"-\" { pub = 1 } pub && $1 == \"fpr\" { fpr = $10 } $1 == \"sub\" { pub = 0 } pub && fpr && $1 == \"uid\" && $2 == \"-\" { print \"#\", $10; print \"\\t\" fpr \" \\\\\"; pub = 0 }'\nENV GPG_KEYS=\"CEC86BB4A0BA9D0F90397CAEF8358FA2F2833C93  C4965EE9E3015D192CCCF2B6F758CE318D77295D  5AED1BF378E9A19DADE1BCB34BD736A82B5C1B00  514A2AD631A57A16DD0047EC749D6EEC0353B12C  A26E528B271F19B9E5D8E19EA278B781FE4B2BDA  A4C465FEA0C552561A392A61E91335D77E3E87CB  9E66CEC6106D578D0B1EB9BFF1000962B7F6840C  C4009872C59B49561310D966D0062876AF30F054  B7842CDAF36E6A3214FAE35D5E85B9AE0B84C041  3E9C876907A560ACA00964F363E9BAD215BBF5F0  F8B7FD00E05C932991A2CD6150EE103D162C5A55\"\nENV CASSANDRA_VERSION=\"4.0.3\"\nENV CASSANDRA_SHA512=\"b328a6bed9bf2d92f1e44a540bf1d800e26163257ca8e69d6f43ca792aeefe5bacf61b6e5bf2cf7233e34a168ab19de96a52fb3fe82304b7749fde2d7baa81d9\"\nRUN set -eux ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends ca-certificates=20211016ubuntu0.20.04.1 dirmngr=2.2.19-3ubuntu2.2 gnupg=2.2.19-3ubuntu2.2 wget=1.20.3-1ubuntu2 -y ; rm -rf /var/lib/apt/lists/* ; ddist() { local f=\"$1\" ;shift ;local distFile=\"$1\" ;shift ;local success= ;local distUrl= ;for distUrl in 'https://www.apache.org/dyn/closer.cgi?action=download&filename=' https://www-us.apache.org/dist/ https://www.apache.org/dist/ https://archive.apache.org/dist/; do if wget -q --progress=dot:giga -O \"$f\" \"$distUrl$distFile\" \\\n && [ -s \"$f\" ] ; then success=1 ;break ; fi ; done ;[ -n \"$success\" ] ; } ; ddist 'cassandra-bin.tgz' \"cassandra/$CASSANDRA_VERSION/apache-cassandra-$CASSANDRA_VERSION-bin.tar.gz\" ; echo \"$CASSANDRA_SHA512 *cassandra-bin.tgz\" | sha512sum --check --strict - ; ddist 'cassandra-bin.tgz.asc' \"cassandra/$CASSANDRA_VERSION/apache-cassandra-$CASSANDRA_VERSION-bin.tar.gz.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; for key in $GPG_KEYS; do gpg --batch --keyserver keyserver.ubuntu.com --recv-keys \"$key\" ; done ; gpg --batch --verify cassandra-bin.tgz.asc cassandra-bin.tgz ; rm -rf \"$GNUPGHOME\" ; apt-mark auto '.*' > /dev/null; [ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; mkdir -p \"$CASSANDRA_HOME\" ; tar --extract --file cassandra-bin.tgz --directory \"$CASSANDRA_HOME\" --strip-components 1 ; rm cassandra-bin.tgz* ; [ ! -e \"$CASSANDRA_CONF\" ] ; mv \"$CASSANDRA_HOME/conf\" \"$CASSANDRA_CONF\" ; ln -sT \"$CASSANDRA_CONF\" \"$CASSANDRA_HOME/conf\" ; dpkgArch=\"$( dpkg --print-architecture ;)\" ; case \"$dpkgArch\" in (ppc64el) if grep -q -- '^-Xss' \"$CASSANDRA_CONF/jvm.options\" ; then grep -- '^-Xss256k$' \"$CASSANDRA_CONF/jvm.options\" ;sed -ri 's/^-Xss256k$/-Xss512k/' \"$CASSANDRA_CONF/jvm.options\" ;grep -- '^-Xss512k$' \"$CASSANDRA_CONF/jvm.options\" ; elif grep -q -- '-Xss256k' \"$CASSANDRA_CONF/cassandra-env.sh\" ; then sed -ri 's/-Xss256k/-Xss512k/g' \"$CASSANDRA_CONF/cassandra-env.sh\" ;grep -- '-Xss512k' \"$CASSANDRA_CONF/cassandra-env.sh\" ; fi ;; esac ; mkdir -p \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra ; chown -R cassandra:cassandra \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra ; chmod 777 \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra ; chmod -R a+rwX \"$CASSANDRA_CONF\" ; ln -sT /var/lib/cassandra \"$CASSANDRA_HOME/data\" ; ln -sT /var/log/cassandra \"$CASSANDRA_HOME/logs\" ; cassandra -v\nVOLUME /var/lib/cassandra\nCOPY docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\n#  7000: intra-node communication\n#  7001: TLS intra-node communication\n#  7199: JMX\n#  9042: CQL\n#  9160: thrift service\nEXPOSE 7000/tcp 7001/tcp 7199/tcp 9042/tcp 9160/tcp\nCOPY docker-healthcheck /usr/local/bin/\nHEALTHCHECK CMD [\"docker-healthcheck\"]\nCMD [\"cassandra\", \"-f\"]\n","originalDockerfileUglifiedHash":"1807e3105c5f9cc09df2972aa45154d5","fileName":"/ICSME-replicationpackage/dataset/smellfree_dockerfiles/cassandra__4.0.3.dockerfile"}