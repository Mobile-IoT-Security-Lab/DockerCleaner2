{"seed":693,"processedDockerfileHash":"d1ef5d324f6ddb7fe226f924036836e2","fixedSmells":[],"successfullyFixedSmells":[],"processedDockerfile":"FROM debian:buster-slim\n# # Installing Node.js\nENV NODE_ENV=\"production\"\nENV NODE_VERSION=\"12.22.1\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  Node installation based on https://github.com/nodejs/docker-node/blob/66b46292a6e5dd5856b1d5204dc51547c80eb17a/12/buster-slim/Dockerfile\nRUN ARCH=\"x64\" \\\n && set -eux \\\n && apt-get update \\\n && apt-get install ca-certificates curl wget gnupg dirmngr xz-utils -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && for key in 4ED778F539E3634C779C87C6D7062848A1AB005C 94AE36675C464D64BAFA68DD7434390BDBE9B9C5 74F12602B6F1C4E913FAA37AD3A89613643B6201 71DCFD284A79C3B38668286BC97EC7A07EDE3FC1 8FCCA13FEF1D0C2E91008E09770F7A9A5AE15600 C4F0DFFF4E8C1A8236409D08E73BC641CC11F4C8 C82FA3AE1CBEDC6BE46B9360C43CEC45C17AB93C DD8F2338BAE7501E3DD5AC78C273792F7D83545D A48C2BEE680E841632CD4E44F07496B3EB3C1762 108F52B48DB57BB0CC439B2997B01419BD92F80A B9E2F5981AA6E0CD28160D9FF13993A75599653C; do gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys \"$key\" || gpg --batch --keyserver keyserver.ubuntu.com --recv-keys \"$key\" ; done \\\n && curl -fsSLO --compressed \"https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-$ARCH.tar.xz\" \\\n && curl -fsSLO --compressed \"https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc\" \\\n && gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \\\n && grep \" node-v$NODE_VERSION-linux-$ARCH.tar.xz$\" SHASUMS256.txt | sha256sum -c - \\\n && tar -xJf \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" -C /usr/local --strip-components=1 --no-same-owner \\\n && rm \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" SHASUMS256.txt.asc SHASUMS256.txt \\\n && apt-mark auto '.*' > /dev/null \\\n && find /usr/local -type f -executable -exec ldd '{}' ';' | awk '/=>/ { print $(NF-1) }' | sort -u | xargs -r dpkg-query --search | cut -d: -f1 | sort -u | xargs -r apt-mark manual \\\n && apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false\nRUN groupadd -r rocketchat \\\n && useradd -r -g rocketchat rocketchat \\\n && mkdir -p /app/uploads \\\n && chown rocketchat:rocketchat /app/uploads\nVOLUME /app/uploads\nENV RC_VERSION=\"3.18.5\"\nWORKDIR /app\nRUN set -eux \\\n && apt-get update \\\n && apt-get install fontconfig -y \\\n && aptMark=\"$( apt-mark showmanual ;)\" \\\n && apt-get install g++ make python ca-certificates curl gnupg -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && gpg --batch --keyserver keyserver.ubuntu.com --recv-keys 0E163286C20D07B9787EBE9FD7F9D0414FD08104 \\\n && curl -fSL \"https://releases.rocket.chat/${RC_VERSION}/download\" -o rocket.chat.tgz \\\n && curl -fSL \"https://releases.rocket.chat/${RC_VERSION}/asc\" -o rocket.chat.tgz.asc \\\n && gpg --batch --verify rocket.chat.tgz.asc rocket.chat.tgz \\\n && tar zxf rocket.chat.tgz \\\n && rm rocket.chat.tgz rocket.chat.tgz.asc \\\n && cd bundle/programs/server \\\n && npm install \\\n && apt-mark auto '.*' > /dev/null \\\n && apt-mark manual $aptMark > /dev/null \\\n && find /usr/local -type f -executable -exec ldd '{}' ';' | awk '/=>/ { print $(NF-1) }' | sort -u | xargs -r dpkg-query --search | cut -d: -f1 | sort -u | xargs -r apt-mark manual \\\n && apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false \\\n && npm cache clear --force \\\n && chown -R rocketchat:rocketchat /app\nUSER rocketchat\nWORKDIR /app/bundle\n#  needs a mongoinstance - defaults to container linking with alias 'db'\nENV DEPLOY_METHOD=\"docker-official\" \\\n    MONGO_URL=\"mongodb://db:27017/meteor\" \\\n    HOME=\"/tmp\" \\\n    PORT=\"3000\" \\\n    ROOT_URL=\"http://127.0.0.1:3000\" \\\n    Accounts_AvatarStorePath=\"/app/uploads\"\nEXPOSE 3000/tcp\nHEALTHCHECK CMD curl --fail http://127.0.0.1:3000 || exit 1\nCMD [\"node\", \"main.js\"]\nUSER root\n","originalDockerfile":"FROM debian:buster-slim\n\n## Installing Node.js\nENV NODE_ENV production\nENV NODE_VERSION 12.22.1\n\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n\n# Node installation based on https://github.com/nodejs/docker-node/blob/66b46292a6e5dd5856b1d5204dc51547c80eb17a/12/buster-slim/Dockerfile\nRUN ARCH=\"x64\" \\\n    && set -eux \\\n    && apt-get update && apt-get install -y --no-install-recommends ca-certificates=20200601~deb10u2 curl=7.64.0-4+deb10u5 wget=1.20.1-1.1 gnupg=2.2.12-1+deb10u2 dirmngr=2.2.12-1+deb10u2 xz-utils=5.2.4-1+deb10u1 \\\n    && rm -rf /var/lib/apt/lists/* \\\n    && for key in \\\n      4ED778F539E3634C779C87C6D7062848A1AB005C \\\n      94AE36675C464D64BAFA68DD7434390BDBE9B9C5 \\\n      74F12602B6F1C4E913FAA37AD3A89613643B6201 \\\n      71DCFD284A79C3B38668286BC97EC7A07EDE3FC1 \\\n      8FCCA13FEF1D0C2E91008E09770F7A9A5AE15600 \\\n      C4F0DFFF4E8C1A8236409D08E73BC641CC11F4C8 \\\n      C82FA3AE1CBEDC6BE46B9360C43CEC45C17AB93C \\\n      DD8F2338BAE7501E3DD5AC78C273792F7D83545D \\\n      A48C2BEE680E841632CD4E44F07496B3EB3C1762 \\\n      108F52B48DB57BB0CC439B2997B01419BD92F80A \\\n      B9E2F5981AA6E0CD28160D9FF13993A75599653C \\\n    ; do \\\n      gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys \"$key\" || \\\n      gpg --batch --keyserver keyserver.ubuntu.com --recv-keys \"$key\" ; \\\n    done \\\n    && curl -fsSLO --compressed \"https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-$ARCH.tar.xz\" \\\n    && curl -fsSLO --compressed \"https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc\" \\\n    && gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \\\n    && grep \" node-v$NODE_VERSION-linux-$ARCH.tar.xz\\$\" SHASUMS256.txt | sha256sum -c - \\\n    && tar -xJf \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" -C /usr/local --strip-components=1 --no-same-owner \\\n    && rm \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" SHASUMS256.txt.asc SHASUMS256.txt \\\n    && apt-mark auto '.*' > /dev/null \\\n    && find /usr/local -type f -executable -exec ldd '{}' ';' \\\n      | awk '/=>/ { print $(NF-1) }' \\\n      | sort -u \\\n      | xargs -r dpkg-query --search \\\n      | cut -d: -f1 \\\n      | sort -u \\\n      | xargs -r apt-mark manual \\\n    && apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false\n\nRUN groupadd -r rocketchat \\\n&&  useradd -r -g rocketchat rocketchat \\\n&&  mkdir -p /app/uploads \\\n&&  chown rocketchat:rocketchat /app/uploads\n\nVOLUME /app/uploads\n\nENV RC_VERSION 3.18.5\n\nWORKDIR /app\n\nRUN set -eux \\\n&&  apt-get update \\\n&&  apt-get install -y --no-install-recommends fontconfig=2.13.1-2 \\\n&&  aptMark=\"$(apt-mark showmanual)\" \\\n&&  apt-get install -y --no-install-recommends g++=4:8.3.0-1 make=4.2.1-1.2 python=2.7.16-1 ca-certificates=20200601~deb10u2 curl=7.64.0-4+deb10u5 gnupg=2.2.12-1+deb10u2 \\\n&& rm -rf /var/lib/apt/lists/* \\\n# gpg: key 4FD08104: public key \"Rocket.Chat Buildmaster <buildmaster@rocket.chat>\" imported\n&&  gpg --batch --keyserver keyserver.ubuntu.com --recv-keys 0E163286C20D07B9787EBE9FD7F9D0414FD08104 \\\n&&  curl -fSL \"https://releases.rocket.chat/${RC_VERSION}/download\" -o rocket.chat.tgz \\\n&&  curl -fSL \"https://releases.rocket.chat/${RC_VERSION}/asc\" -o rocket.chat.tgz.asc \\\n&&  gpg --batch --verify rocket.chat.tgz.asc rocket.chat.tgz \\\n&&  tar zxf rocket.chat.tgz \\\n&&  rm rocket.chat.tgz rocket.chat.tgz.asc \\\n&&  cd bundle/programs/server \\\n&&  npm install \\\n&&  apt-mark auto '.*' > /dev/null \\\n&&  apt-mark manual $aptMark > /dev/null \\\n&&  find /usr/local -type f -executable -exec ldd '{}' ';' \\\n    | awk '/=>/ { print $(NF-1) }' \\\n    | sort -u \\\n    | xargs -r dpkg-query --search \\\n    | cut -d: -f1 \\\n    | sort -u \\\n    | xargs -r apt-mark manual \\\n&&  apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false \\\n&&  npm cache clear --force \\\n&&  chown -R rocketchat:rocketchat /app\n\nUSER rocketchat\n\nWORKDIR /app/bundle\n\n# needs a mongoinstance - defaults to container linking with alias 'db'\nENV DEPLOY_METHOD=docker-official \\\n    MONGO_URL=mongodb://db:27017/meteor \\\n    HOME=/tmp \\\n    PORT=3000 \\\n    ROOT_URL=http://127.0.0.1:3000 \\\n    Accounts_AvatarStorePath=/app/uploads\n\nEXPOSE 3000\n\nHEALTHCHECK CMD curl --fail http://127.0.0.1:3000 || exit 1\n\nCMD [\"node\", \"main.js\"]\n","injectedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","pin-package-manager-versions-gem","have-a-user"],"originalDockerfileHash":"8968bdd408c35eb2f655a4cb15b5a05f","successfullyInjectedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","have-a-user"],"originalDockerfileUglified":"FROM debian:buster-slim\n# # Installing Node.js\nENV NODE_ENV=\"production\"\nENV NODE_VERSION=\"12.22.1\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  Node installation based on https://github.com/nodejs/docker-node/blob/66b46292a6e5dd5856b1d5204dc51547c80eb17a/12/buster-slim/Dockerfile\nRUN ARCH=\"x64\" \\\n && set -eux \\\n && apt-get update \\\n && apt-get install --no-install-recommends ca-certificates=20200601~deb10u2 curl=7.64.0-4+deb10u5 wget=1.20.1-1.1 gnupg=2.2.12-1+deb10u2 dirmngr=2.2.12-1+deb10u2 xz-utils=5.2.4-1+deb10u1 -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && for key in 4ED778F539E3634C779C87C6D7062848A1AB005C 94AE36675C464D64BAFA68DD7434390BDBE9B9C5 74F12602B6F1C4E913FAA37AD3A89613643B6201 71DCFD284A79C3B38668286BC97EC7A07EDE3FC1 8FCCA13FEF1D0C2E91008E09770F7A9A5AE15600 C4F0DFFF4E8C1A8236409D08E73BC641CC11F4C8 C82FA3AE1CBEDC6BE46B9360C43CEC45C17AB93C DD8F2338BAE7501E3DD5AC78C273792F7D83545D A48C2BEE680E841632CD4E44F07496B3EB3C1762 108F52B48DB57BB0CC439B2997B01419BD92F80A B9E2F5981AA6E0CD28160D9FF13993A75599653C; do gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys \"$key\" || gpg --batch --keyserver keyserver.ubuntu.com --recv-keys \"$key\" ; done \\\n && curl -fsSLO --compressed \"https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-$ARCH.tar.xz\" \\\n && curl -fsSLO --compressed \"https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc\" \\\n && gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \\\n && grep \" node-v$NODE_VERSION-linux-$ARCH.tar.xz$\" SHASUMS256.txt | sha256sum -c - \\\n && tar -xJf \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" -C /usr/local --strip-components=1 --no-same-owner \\\n && rm \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" SHASUMS256.txt.asc SHASUMS256.txt \\\n && apt-mark auto '.*' > /dev/null \\\n && find /usr/local -type f -executable -exec ldd '{}' ';' | awk '/=>/ { print $(NF-1) }' | sort -u | xargs -r dpkg-query --search | cut -d: -f1 | sort -u | xargs -r apt-mark manual \\\n && apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false\nRUN groupadd -r rocketchat \\\n && useradd -r -g rocketchat rocketchat \\\n && mkdir -p /app/uploads \\\n && chown rocketchat:rocketchat /app/uploads\nVOLUME /app/uploads\nENV RC_VERSION=\"3.18.5\"\nWORKDIR /app\nRUN set -eux \\\n && apt-get update \\\n && apt-get install --no-install-recommends fontconfig=2.13.1-2 -y \\\n && aptMark=\"$( apt-mark showmanual ;)\" \\\n && apt-get install --no-install-recommends g++=4:8.3.0-1 make=4.2.1-1.2 python=2.7.16-1 ca-certificates=20200601~deb10u2 curl=7.64.0-4+deb10u5 gnupg=2.2.12-1+deb10u2 -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && gpg --batch --keyserver keyserver.ubuntu.com --recv-keys 0E163286C20D07B9787EBE9FD7F9D0414FD08104 \\\n && curl -fSL \"https://releases.rocket.chat/${RC_VERSION}/download\" -o rocket.chat.tgz \\\n && curl -fSL \"https://releases.rocket.chat/${RC_VERSION}/asc\" -o rocket.chat.tgz.asc \\\n && gpg --batch --verify rocket.chat.tgz.asc rocket.chat.tgz \\\n && tar zxf rocket.chat.tgz \\\n && rm rocket.chat.tgz rocket.chat.tgz.asc \\\n && cd bundle/programs/server \\\n && npm install \\\n && apt-mark auto '.*' > /dev/null \\\n && apt-mark manual $aptMark > /dev/null \\\n && find /usr/local -type f -executable -exec ldd '{}' ';' | awk '/=>/ { print $(NF-1) }' | sort -u | xargs -r dpkg-query --search | cut -d: -f1 | sort -u | xargs -r apt-mark manual \\\n && apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false \\\n && npm cache clear --force \\\n && chown -R rocketchat:rocketchat /app\nUSER rocketchat\nWORKDIR /app/bundle\n#  needs a mongoinstance - defaults to container linking with alias 'db'\nENV DEPLOY_METHOD=\"docker-official\" \\\n    MONGO_URL=\"mongodb://db:27017/meteor\" \\\n    HOME=\"/tmp\" \\\n    PORT=\"3000\" \\\n    ROOT_URL=\"http://127.0.0.1:3000\" \\\n    Accounts_AvatarStorePath=\"/app/uploads\"\nEXPOSE 3000/tcp\nHEALTHCHECK CMD curl --fail http://127.0.0.1:3000 || exit 1\nCMD [\"node\", \"main.js\"]\n","originalDockerfileUglifiedHash":"67ff4b88f6f115df249d49e16edafe67","fileName":"/ICSME-replicationpackage/dataset/smellfree_dockerfiles/rocket.chat__3.18.5.dockerfile"}