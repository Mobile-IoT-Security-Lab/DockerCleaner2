{"seed":4214884850,"processedDockerfileHash":"a4e2527312e992b35245f01a861716ea","fixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","do-not-have-secrets","have-a-healthcheck"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","do-not-have-secrets","have-a-healthcheck"],"processedDockerfile":"#   DO NOT EDIT: created by update.sh from Dockerfile-debian.template\nFROM php:7.4-apache-bullseye\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends rsync=3.2.3-4+deb11u1 bzip2=1.0.8-4 busybox-static=1:1.30.1-6+b3 libldap-common=2.4.57+dfsg-3+deb11u1 -y ; rm -rf /var/lib/apt/lists/* ; mkdir -p /var/spool/cron/crontabs ; echo '*/5 * * * * php -f /var/www/html/cron.php' > /var/spool/cron/crontabs/www-data\n#   install the PHP extensions we need\n#   see https://docs.nextcloud.com/server/stable/admin_manual/installation/source_installation.html\nENV PHP_MEMORY_LIMIT=\"512M\"\nENV PHP_UPLOAD_LIMIT=\"512M\"\nRUN set -ex ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends libcurl4-openssl-dev=7.74.0-1.3+deb11u7 libevent-dev=2.1.12-stable-1 libfreetype6-dev=2.10.4+dfsg-1+deb11u1 libicu-dev=67.1-7 libjpeg-dev=1:2.0.6-4 libldap2-dev=2.4.57+dfsg-3+deb11u1 libmcrypt-dev=2.5.8-3.4+b1 libmemcached-dev=1.0.18-4.2 libpng-dev=1.6.37-3 libpq-dev=13.9-0+deb11u1 libxml2-dev=2.9.10+dfsg-6.7+deb11u3 libmagickwand-dev=8:6.9.11.60+dfsg-1.3+deb11u1 libzip-dev=1.7.3-1 libwebp-dev=0.6.1-2.1 libgmp-dev=2:6.2.1+dfsg-1+deb11u1 -y ; debMultiarch=\"$( dpkg-architecture --query DEB_BUILD_MULTIARCH ;)\" ; docker-php-ext-configure gd --with-freetype --with-jpeg --with-webp ; docker-php-ext-configure ldap --with-libdir=\"lib/$debMultiarch\" ; docker-php-ext-install -j \"$( nproc ;)\" bcmath exif gd intl ldap opcache pcntl pdo_mysql pdo_pgsql zip gmp ; pecl install APCu-5.1.21 ; pecl install memcached-3.1.5 ; pecl install redis-5.3.6 ; pecl install imagick-3.7.0 ; docker-php-ext-enable apcu memcached redis imagick ; rm -r /tmp/pear ; apt-mark auto '.*' > /dev/null; apt-mark manual $savedAptMark ; ldd \"$( php -r 'echo ini_get(\"extension_dir\");' ;)\"/*.so | awk '/=>/ { print $3 }' | sort -u | xargs -r dpkg-query -S | cut -d: -f1 | sort -u | xargs -rt apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; rm -rf /var/lib/apt/lists/*\n#   set recommended PHP.ini settings\n#   see https://docs.nextcloud.com/server/stable/admin_manual/configuration_server/server_tuning.html#enable-php-opcache\nRUN { echo 'opcache.enable=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidate_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; { echo 'memory_limit=${PHP_MEMORY_LIMIT}' ;echo 'upload_max_filesize=${PHP_UPLOAD_LIMIT}' ;echo 'post_max_size=${PHP_UPLOAD_LIMIT}' ; } > /usr/local/etc/php/conf.d/nextcloud.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\nRUN a2enmod headers rewrite remoteip ; { echo RemoteIPHeader X-Real-IP ;echo RemoteIPTrustedProxy 10.0.0.0/8 ;echo RemoteIPTrustedProxy 172.16.0.0/12 ;echo RemoteIPTrustedProxy 192.168.0.0/16 ; } > /etc/apache2/conf-available/remoteip.conf; a2enconf remoteip\nENV NEXTCLOUD_VERSION=\"21.0.8\"\nRUN set -ex ; fetchDeps=\" gnupg dirmngr \" ; apt-get update ; apt-get install --no-install-recommends gnupg=2.2.27-2+deb11u2 dirmngr=2.2.27-2+deb11u2 -y ; curl -fsSL -o nextcloud.tar.bz2 \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" ; curl -fsSL -o nextcloud.tar.bz2.asc \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver keyserver.ubuntu.com --recv-keys 28806A878AE423A28372792ED75899B9A724937A ; gpg --batch --verify nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; tar -xjf nextcloud.tar.bz2 -C /usr/src/ ; gpgconf --kill all ; rm nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; rm -rf \"$GNUPGHOME\" /usr/src/nextcloud/updater ; mkdir -p /usr/src/nextcloud/data ; mkdir -p /usr/src/nextcloud/custom_apps ; chmod +x /usr/src/nextcloud/occ ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps ; rm -rf /var/lib/apt/lists/*\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/nextcloud/config/\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"apache2-foreground\"]\n# A secret has been removed here. Please do not provide secrets from the Dockerfile as these will leak into the metadata of the resulting docker image. To provide secrets the --secret flag of the docker build command can be used (https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information).\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n","originalDockerfile":"#  DO NOT EDIT: created by update.sh from Dockerfile-debian.template\nFROM php:7.4-apache-bullseye\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apt-get update ; apt-get install rsync bzip2 busybox-static libldap-common -y ; rm -rf /var/lib/apt/lists/* ; mkdir -p /var/spool/cron/crontabs ; echo '*/5 * * * * php -f /var/www/html/cron.php' > /var/spool/cron/crontabs/www-data\n#  install the PHP extensions we need\n#  see https://docs.nextcloud.com/server/stable/admin_manual/installation/source_installation.html\nENV PHP_MEMORY_LIMIT=\"512M\"\nENV PHP_UPLOAD_LIMIT=\"512M\"\nRUN set -ex ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install libcurl4-openssl-dev libevent-dev libfreetype6-dev libicu-dev libjpeg-dev libldap2-dev libmcrypt-dev libmemcached-dev libpng-dev libpq-dev libxml2-dev libmagickwand-dev libzip-dev libwebp-dev libgmp-dev -y ; debMultiarch=\"$( dpkg-architecture --query DEB_BUILD_MULTIARCH ;)\" ; docker-php-ext-configure gd --with-freetype --with-jpeg --with-webp ; docker-php-ext-configure ldap --with-libdir=\"lib/$debMultiarch\" ; docker-php-ext-install -j \"$( nproc ;)\" bcmath exif gd intl ldap opcache pcntl pdo_mysql pdo_pgsql zip gmp ; pecl install APCu-5.1.21 ; pecl install memcached-3.1.5 ; pecl install redis-5.3.6 ; pecl install imagick-3.7.0 ; docker-php-ext-enable apcu memcached redis imagick ; rm -r /tmp/pear ; apt-mark auto '.*' > /dev/null; apt-mark manual $savedAptMark ; ldd \"$( php -r 'echo ini_get(\"extension_dir\");' ;)\"/*.so | awk '/=>/ { print $3 }' | sort -u | xargs -r dpkg-query -S | cut -d: -f1 | sort -u | xargs -rt apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; rm -rf /var/lib/apt/lists/*\n#  set recommended PHP.ini settings\n#  see https://docs.nextcloud.com/server/stable/admin_manual/configuration_server/server_tuning.html#enable-php-opcache\nRUN { echo 'opcache.enable=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidate_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; { echo 'memory_limit=${PHP_MEMORY_LIMIT}' ;echo 'upload_max_filesize=${PHP_UPLOAD_LIMIT}' ;echo 'post_max_size=${PHP_UPLOAD_LIMIT}' ; } > /usr/local/etc/php/conf.d/nextcloud.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\nRUN a2enmod headers rewrite remoteip ; { echo RemoteIPHeader X-Real-IP ;echo RemoteIPTrustedProxy 10.0.0.0/8 ;echo RemoteIPTrustedProxy 172.16.0.0/12 ;echo RemoteIPTrustedProxy 192.168.0.0/16 ; } > /etc/apache2/conf-available/remoteip.conf; a2enconf remoteip\nENV NEXTCLOUD_VERSION=\"21.0.8\"\nRUN set -ex ; fetchDeps=\" gnupg dirmngr \" ; apt-get update ; apt-get install gnupg dirmngr -y ; curl -fsSL -o nextcloud.tar.bz2 \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" ; curl -fsSL -o nextcloud.tar.bz2.asc \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver keyserver.ubuntu.com --recv-keys 28806A878AE423A28372792ED75899B9A724937A ; gpg --batch --verify nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; tar -xjf nextcloud.tar.bz2 -C /usr/src/ ; gpgconf --kill all ; rm nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; rm -rf \"$GNUPGHOME\" /usr/src/nextcloud/updater ; mkdir -p /usr/src/nextcloud/data ; mkdir -p /usr/src/nextcloud/custom_apps ; chmod +x /usr/src/nextcloud/occ ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps ; rm -rf /var/lib/apt/lists/*\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/nextcloud/config/\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"apache2-foreground\"]\nENV GOOGLE_API_KEY=\"AIzahJvH2w61MGhFJdVFEDYwkoe0TfcHCsVBxPF\" \\\n    POSTGRES_PASSWORD=\"rG0Bm3lLQlzy7zc-P11LJUty4P0hUP3dxJMB9EBM\" \\\n    AWS_ACCESS_KEY=\"A3TG13IQCRRO9PNRKJTT\"\n","injectedSmells":[],"originalDockerfileHash":"18554f8be1e1dafd032b99e6fb3a09f2","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   DO NOT EDIT: created by update.sh from Dockerfile-debian.template\nFROM php:7.4-apache-bullseye\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   entrypoint.sh and cron.sh dependencies\nRUN set -ex ; apt-get update ; apt-get install rsync bzip2 busybox-static libldap-common -y ; rm -rf /var/lib/apt/lists/* ; mkdir -p /var/spool/cron/crontabs ; echo '*/5 * * * * php -f /var/www/html/cron.php' > /var/spool/cron/crontabs/www-data\n#   install the PHP extensions we need\n#   see https://docs.nextcloud.com/server/stable/admin_manual/installation/source_installation.html\nENV PHP_MEMORY_LIMIT=\"512M\"\nENV PHP_UPLOAD_LIMIT=\"512M\"\nRUN set -ex ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install libcurl4-openssl-dev libevent-dev libfreetype6-dev libicu-dev libjpeg-dev libldap2-dev libmcrypt-dev libmemcached-dev libpng-dev libpq-dev libxml2-dev libmagickwand-dev libzip-dev libwebp-dev libgmp-dev -y ; debMultiarch=\"$( dpkg-architecture --query DEB_BUILD_MULTIARCH ;)\" ; docker-php-ext-configure gd --with-freetype --with-jpeg --with-webp ; docker-php-ext-configure ldap --with-libdir=\"lib/$debMultiarch\" ; docker-php-ext-install -j \"$( nproc ;)\" bcmath exif gd intl ldap opcache pcntl pdo_mysql pdo_pgsql zip gmp ; pecl install APCu-5.1.21 ; pecl install memcached-3.1.5 ; pecl install redis-5.3.6 ; pecl install imagick-3.7.0 ; docker-php-ext-enable apcu memcached redis imagick ; rm -r /tmp/pear ; apt-mark auto '.*' > /dev/null; apt-mark manual $savedAptMark ; ldd \"$( php -r 'echo ini_get(\"extension_dir\");' ;)\"/*.so | awk '/=>/ { print $3 }' | sort -u | xargs -r dpkg-query -S | cut -d: -f1 | sort -u | xargs -rt apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; rm -rf /var/lib/apt/lists/*\n#   set recommended PHP.ini settings\n#   see https://docs.nextcloud.com/server/stable/admin_manual/configuration_server/server_tuning.html#enable-php-opcache\nRUN { echo 'opcache.enable=1' ;echo 'opcache.interned_strings_buffer=8' ;echo 'opcache.max_accelerated_files=10000' ;echo 'opcache.memory_consumption=128' ;echo 'opcache.save_comments=1' ;echo 'opcache.revalidate_freq=1' ; } > /usr/local/etc/php/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; { echo 'memory_limit=${PHP_MEMORY_LIMIT}' ;echo 'upload_max_filesize=${PHP_UPLOAD_LIMIT}' ;echo 'post_max_size=${PHP_UPLOAD_LIMIT}' ; } > /usr/local/etc/php/conf.d/nextcloud.ini; mkdir /var/www/data ; chown -R www-data:root /var/www ; chmod -R g=u /var/www\nVOLUME /var/www/html\nRUN a2enmod headers rewrite remoteip ; { echo RemoteIPHeader X-Real-IP ;echo RemoteIPTrustedProxy 10.0.0.0/8 ;echo RemoteIPTrustedProxy 172.16.0.0/12 ;echo RemoteIPTrustedProxy 192.168.0.0/16 ; } > /etc/apache2/conf-available/remoteip.conf; a2enconf remoteip\nENV NEXTCLOUD_VERSION=\"21.0.8\"\nRUN set -ex ; fetchDeps=\" gnupg dirmngr \" ; apt-get update ; apt-get install gnupg dirmngr -y ; curl -fsSL -o nextcloud.tar.bz2 \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\" ; curl -fsSL -o nextcloud.tar.bz2.asc \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2.asc\" ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver keyserver.ubuntu.com --recv-keys 28806A878AE423A28372792ED75899B9A724937A ; gpg --batch --verify nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; tar -xjf nextcloud.tar.bz2 -C /usr/src/ ; gpgconf --kill all ; rm nextcloud.tar.bz2.asc nextcloud.tar.bz2 ; rm -rf \"$GNUPGHOME\" /usr/src/nextcloud/updater ; mkdir -p /usr/src/nextcloud/data ; mkdir -p /usr/src/nextcloud/custom_apps ; chmod +x /usr/src/nextcloud/occ ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps ; rm -rf /var/lib/apt/lists/*\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/nextcloud/config/\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"apache2-foreground\"]\nENV GOOGLE_API_KEY=\"AIzahJvH2w61MGhFJdVFEDYwkoe0TfcHCsVBxPF\" \\\n    POSTGRES_PASSWORD=\"rG0Bm3lLQlzy7zc-P11LJUty4P0hUP3dxJMB9EBM\" \\\n    AWS_ACCESS_KEY=\"A3TG13IQCRRO9PNRKJTT\"\n","originalDockerfileUglifiedHash":"474ebe4266da3db1ad1dccf0546d329e","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles/nextcloud__21.0.8-apache__10__injected.dockerfile"}