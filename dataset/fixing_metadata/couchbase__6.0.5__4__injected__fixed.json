{"seed":2978811787,"processedDockerfileHash":"4559094e15aea768b989ecf9eb1495a5","fixedSmells":["do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","have-a-user"],"successfullyFixedSmells":["do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","have-a-user"],"processedDockerfile":"FROM ubuntu:18.04\nLABEL maintainer=\"docker@couchbase.com\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   Install dependencies:\n#    runit: for container process management\n#    wget: for downloading .deb\n#    chrpath: for fixing curl, below\n#    tzdata: timezone info used by some N1QL functions\n#    man: so couchbase-cli help works\n#   Additional dependencies for system commands used by cbcollect_info:\n#    lsof: lsof\n#    lshw: lshw\n#    sysstat: iostat, sar, mpstat\n#    net-tools: ifconfig, arp, netstat\n#    numactl: numactl\nRUN :\nRUN set -x \\\n && : \\\n && (apt-get update ;apt-get install --no-install-recommends runit=2.1.2-9.2ubuntu1 wget=1.19.4-1ubuntu2.2 chrpath=0.16-2 tzdata=2023c-0ubuntu0.18.04 man-db=2.8.3-2ubuntu0.1 lsof=4.89+dfsg-0.1 lshw=02.18-0.1ubuntu6.18.04.2 sysstat=11.6.1-1ubuntu0.2 net-tools=1.60+git20161116.90da8a0-1ubuntu1 numactl=2.0.11-2.1ubuntu0.1 python-httplib2=0.9.2+dfsg-1ubuntu0.3 -yq ) \\\n && apt-get autoremove \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#   http://smarden.org/runit/useinit.html#sysv - at some point the script\n#   runsvdir-start was moved/renamed to this odd name, so we put it back\n#   somewhere sensible. This appears to be necessary for Ubuntu 20 but\n#   not Ubuntu 16.\nRUN if [ ! -x /usr/sbin/runsvdir-start ] ; then cp -a /etc/runit/2 /usr/sbin/runsvdir-start ; fi\nARG CB_VERSION=6.0.5\nARG CB_RELEASE_URL=https://packages.couchbase.com/releases/6.0.5\nARG CB_PACKAGE=couchbase-server-enterprise_6.0.5-ubuntu18.04_amd64.deb\nARG CB_SHA256=6b152590867a58d771cffc22774d3cd66c916defcbeeeb339aca8d0a8e6d7f8d\nENV PATH=\"$PATH:/opt/couchbase/bin:/opt/couchbase/bin/tools:/opt/couchbase/bin/install\"\n#   Create Couchbase user with UID 1000 (necessary to match default\n#   boot2docker UID)\nRUN groupadd -g 1000 couchbase \\\n && useradd couchbase -u 1000 -g couchbase -M\n#   Install couchbase\nRUN :\nRUN set -x \\\n && export INSTALL_DONT_START_SERVER=1 \\\n && wget -N --no-verbose $CB_RELEASE_URL/$CB_PACKAGE \\\n && echo \"$CB_SHA256 $CB_PACKAGE\" | sha256sum -c - \\\n && : \\\n && (apt-get update ;apt-get install --no-install-recommends ./$CB_PACKAGE -y ) \\\n && rm -f ./$CB_PACKAGE \\\n && apt-get autoremove \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#   Update VARIANT.txt to indicate we're running in our Docker image\nRUN sed -i -e '1 s/$/\\/docker/' /opt/couchbase/VARIANT.txt\n#   Add runit script for couchbase-server\nCOPY scripts/run /etc/service/couchbase-server/run\nRUN mkdir -p /etc/runit/runsvdir/default/couchbase-server/supervise \\\n && chown -R couchbase:couchbase /etc/service /etc/runit/runsvdir/default/couchbase-server/supervise\n#   Add dummy script for commands invoked by cbcollect_info that\n#   make no sense in a Docker container\nCOPY scripts/dummy.sh /usr/local/bin/\nRUN ln -s dummy.sh /usr/local/bin/iptables-save \\\n && ln -s dummy.sh /usr/local/bin/lvdisplay \\\n && ln -s dummy.sh /usr/local/bin/vgdisplay \\\n && ln -s dummy.sh /usr/local/bin/pvdisplay\n#   Fix curl RPATH\nRUN chrpath -r '$ORIGIN/../lib' /opt/couchbase/bin/curl\n#   Add bootstrap script\nCOPY scripts/entrypoint.sh /\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"couchbase-server\"]\n#   8091: Couchbase Web console, REST/HTTP interface\n#   8092: Views, queries, XDCR\n#   8093: Query services (4.0+)\n#   8094: Full-text Search (4.5+)\n#   8095: Analytics (5.5+)\n#   8096: Eventing (5.5+)\n#   11207: Smart client library data node access (SSL)\n#   11210: Smart client library/moxi data node access\n#   11211: Legacy non-smart client library data node access\n#   18091: Couchbase Web console, REST/HTTP interface (SSL)\n#   18092: Views, query, XDCR (SSL)\n#   18093: Query services (SSL) (4.0+)\n#   18094: Full-text Search (SSL) (4.5+)\n#   18095: Analytics (SSL) (5.5+)\n#   18096: Eventing (SSL) (5.5+)\nEXPOSE 8091/tcp 8092/tcp 8093/tcp 8094/tcp 8095/tcp 8096/tcp 11207/tcp 11210/tcp 11211/tcp 18091/tcp 18092/tcp 18093/tcp 18094/tcp 18095/tcp 18096/tcp\nVOLUME /opt/couchbase/var\nHEALTHCHECK CMD curl --fail http://127.0.0.1:8091 || exit 1\nUSER root\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n","originalDockerfile":"FROM ubuntu:18.04\nLABEL maintainer=\"docker@couchbase.com\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  Install dependencies:\n#   runit: for container process management\n#   wget: for downloading .deb\n#   chrpath: for fixing curl, below\n#   tzdata: timezone info used by some N1QL functions\n#   man: so couchbase-cli help works\n#  Additional dependencies for system commands used by cbcollect_info:\n#   lsof: lsof\n#   lshw: lshw\n#   sysstat: iostat, sar, mpstat\n#   net-tools: ifconfig, arp, netstat\n#   numactl: numactl\nRUN apt-get update\nRUN set -x \\\n && : \\\n && apt-get install --no-install-recommends runit wget chrpath tzdata man-db lsof lshw sysstat net-tools numactl python-httplib2 -yq \\\n && apt-get autoremove \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#  http://smarden.org/runit/useinit.html#sysv - at some point the script\n#  runsvdir-start was moved/renamed to this odd name, so we put it back\n#  somewhere sensible. This appears to be necessary for Ubuntu 20 but\n#  not Ubuntu 16.\nRUN if [ ! -x /usr/sbin/runsvdir-start ] ; then cp -a /etc/runit/2 /usr/sbin/runsvdir-start ; fi\nARG CB_VERSION=6.0.5\nARG CB_RELEASE_URL=https://packages.couchbase.com/releases/6.0.5\nARG CB_PACKAGE=couchbase-server-enterprise_6.0.5-ubuntu18.04_amd64.deb\nARG CB_SHA256=6b152590867a58d771cffc22774d3cd66c916defcbeeeb339aca8d0a8e6d7f8d\nENV PATH=\"$PATH:/opt/couchbase/bin:/opt/couchbase/bin/tools:/opt/couchbase/bin/install\"\n#  Create Couchbase user with UID 1000 (necessary to match default\n#  boot2docker UID)\nRUN groupadd -g 1000 couchbase \\\n && useradd couchbase -u 1000 -g couchbase -M\n#  Install couchbase\nRUN apt-get update\nRUN set -x \\\n && export INSTALL_DONT_START_SERVER=1 \\\n && wget -N --no-verbose $CB_RELEASE_URL/$CB_PACKAGE \\\n && echo \"$CB_SHA256 $CB_PACKAGE\" | sha256sum -c - \\\n && : \\\n && apt-get install --no-install-recommends ./$CB_PACKAGE -y \\\n && rm -f ./$CB_PACKAGE \\\n && apt-get autoremove \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#  Update VARIANT.txt to indicate we're running in our Docker image\nRUN sed -i -e '1 s/$/\\/docker/' /opt/couchbase/VARIANT.txt\n#  Add runit script for couchbase-server\nCOPY scripts/run /etc/service/couchbase-server/run\nRUN mkdir -p /etc/runit/runsvdir/default/couchbase-server/supervise \\\n && chown -R couchbase:couchbase /etc/service /etc/runit/runsvdir/default/couchbase-server/supervise\n#  Add dummy script for commands invoked by cbcollect_info that\n#  make no sense in a Docker container\nCOPY scripts/dummy.sh /usr/local/bin/\nRUN ln -s dummy.sh /usr/local/bin/iptables-save \\\n && ln -s dummy.sh /usr/local/bin/lvdisplay \\\n && ln -s dummy.sh /usr/local/bin/vgdisplay \\\n && ln -s dummy.sh /usr/local/bin/pvdisplay\n#  Fix curl RPATH\nRUN chrpath -r '$ORIGIN/../lib' /opt/couchbase/bin/curl\n#  Add bootstrap script\nCOPY scripts/entrypoint.sh /\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"couchbase-server\"]\n#  8091: Couchbase Web console, REST/HTTP interface\n#  8092: Views, queries, XDCR\n#  8093: Query services (4.0+)\n#  8094: Full-text Search (4.5+)\n#  8095: Analytics (5.5+)\n#  8096: Eventing (5.5+)\n#  11207: Smart client library data node access (SSL)\n#  11210: Smart client library/moxi data node access\n#  11211: Legacy non-smart client library data node access\n#  18091: Couchbase Web console, REST/HTTP interface (SSL)\n#  18092: Views, query, XDCR (SSL)\n#  18093: Query services (SSL) (4.0+)\n#  18094: Full-text Search (SSL) (4.5+)\n#  18095: Analytics (SSL) (5.5+)\n#  18096: Eventing (SSL) (5.5+)\nEXPOSE 8091/tcp 8092/tcp 8093/tcp 8094/tcp 8095/tcp 8096/tcp 11207/tcp 11210/tcp 11211/tcp 18091/tcp 18092/tcp 18093/tcp 18094/tcp 18095/tcp 18096/tcp\nVOLUME /opt/couchbase/var\nHEALTHCHECK CMD curl --fail http://127.0.0.1:8091 || exit 1\nUSER root\n","injectedSmells":[],"originalDockerfileHash":"b8cdf783db203f0f9059f8e1b18d0f8b","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:18.04\nLABEL maintainer=\"docker@couchbase.com\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   Install dependencies:\n#    runit: for container process management\n#    wget: for downloading .deb\n#    chrpath: for fixing curl, below\n#    tzdata: timezone info used by some N1QL functions\n#    man: so couchbase-cli help works\n#   Additional dependencies for system commands used by cbcollect_info:\n#    lsof: lsof\n#    lshw: lshw\n#    sysstat: iostat, sar, mpstat\n#    net-tools: ifconfig, arp, netstat\n#    numactl: numactl\nRUN apt-get update\nRUN set -x \\\n && : \\\n && apt-get install --no-install-recommends runit wget chrpath tzdata man-db lsof lshw sysstat net-tools numactl python-httplib2 -yq \\\n && apt-get autoremove \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#   http://smarden.org/runit/useinit.html#sysv - at some point the script\n#   runsvdir-start was moved/renamed to this odd name, so we put it back\n#   somewhere sensible. This appears to be necessary for Ubuntu 20 but\n#   not Ubuntu 16.\nRUN if [ ! -x /usr/sbin/runsvdir-start ] ; then cp -a /etc/runit/2 /usr/sbin/runsvdir-start ; fi\nARG CB_VERSION=6.0.5\nARG CB_RELEASE_URL=https://packages.couchbase.com/releases/6.0.5\nARG CB_PACKAGE=couchbase-server-enterprise_6.0.5-ubuntu18.04_amd64.deb\nARG CB_SHA256=6b152590867a58d771cffc22774d3cd66c916defcbeeeb339aca8d0a8e6d7f8d\nENV PATH=\"$PATH:/opt/couchbase/bin:/opt/couchbase/bin/tools:/opt/couchbase/bin/install\"\n#   Create Couchbase user with UID 1000 (necessary to match default\n#   boot2docker UID)\nRUN groupadd -g 1000 couchbase \\\n && useradd couchbase -u 1000 -g couchbase -M\n#   Install couchbase\nRUN apt-get update\nRUN set -x \\\n && export INSTALL_DONT_START_SERVER=1 \\\n && wget -N --no-verbose $CB_RELEASE_URL/$CB_PACKAGE \\\n && echo \"$CB_SHA256 $CB_PACKAGE\" | sha256sum -c - \\\n && : \\\n && apt-get install --no-install-recommends ./$CB_PACKAGE -y \\\n && rm -f ./$CB_PACKAGE \\\n && apt-get autoremove \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#   Update VARIANT.txt to indicate we're running in our Docker image\nRUN sed -i -e '1 s/$/\\/docker/' /opt/couchbase/VARIANT.txt\n#   Add runit script for couchbase-server\nCOPY scripts/run /etc/service/couchbase-server/run\nRUN mkdir -p /etc/runit/runsvdir/default/couchbase-server/supervise \\\n && chown -R couchbase:couchbase /etc/service /etc/runit/runsvdir/default/couchbase-server/supervise\n#   Add dummy script for commands invoked by cbcollect_info that\n#   make no sense in a Docker container\nCOPY scripts/dummy.sh /usr/local/bin/\nRUN ln -s dummy.sh /usr/local/bin/iptables-save \\\n && ln -s dummy.sh /usr/local/bin/lvdisplay \\\n && ln -s dummy.sh /usr/local/bin/vgdisplay \\\n && ln -s dummy.sh /usr/local/bin/pvdisplay\n#   Fix curl RPATH\nRUN chrpath -r '$ORIGIN/../lib' /opt/couchbase/bin/curl\n#   Add bootstrap script\nCOPY scripts/entrypoint.sh /\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"couchbase-server\"]\n#   8091: Couchbase Web console, REST/HTTP interface\n#   8092: Views, queries, XDCR\n#   8093: Query services (4.0+)\n#   8094: Full-text Search (4.5+)\n#   8095: Analytics (5.5+)\n#   8096: Eventing (5.5+)\n#   11207: Smart client library data node access (SSL)\n#   11210: Smart client library/moxi data node access\n#   11211: Legacy non-smart client library data node access\n#   18091: Couchbase Web console, REST/HTTP interface (SSL)\n#   18092: Views, query, XDCR (SSL)\n#   18093: Query services (SSL) (4.0+)\n#   18094: Full-text Search (SSL) (4.5+)\n#   18095: Analytics (SSL) (5.5+)\n#   18096: Eventing (SSL) (5.5+)\nEXPOSE 8091/tcp 8092/tcp 8093/tcp 8094/tcp 8095/tcp 8096/tcp 11207/tcp 11210/tcp 11211/tcp 18091/tcp 18092/tcp 18093/tcp 18094/tcp 18095/tcp 18096/tcp\nVOLUME /opt/couchbase/var\nHEALTHCHECK CMD curl --fail http://127.0.0.1:8091 || exit 1\nUSER root\n","originalDockerfileUglifiedHash":"ad0021774da79663d9c188c5b277b83d","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles/couchbase__6.0.5__4__injected.dockerfile"}