{"seed":3809246630,"processedDockerfileHash":"5832fd986a1488acf7d66dd8afa666d3","fixedSmells":["do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","use-copy-instead-of-add","do-not-have-secrets","have-a-healthcheck"],"successfullyFixedSmells":["do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","use-copy-instead-of-add","do-not-have-secrets","have-a-healthcheck"],"processedDockerfile":"#   Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n#   use this file except in compliance with the License. You may obtain a copy of\n#   the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n#   Unless required by applicable law or agreed to in writing, software\n#   distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n#   WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n#   License for the specific language governing permissions and limitations under\n#   the License.\nFROM debian:bullseye-slim\nLABEL maintainer=\"CouchDB Developers dev@couchdb.apache.org\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   Add CouchDB user account to make sure the IDs are assigned consistently\nRUN groupadd -g 5984 -r couchdb \\\n && useradd -u 5984 -d /opt/couchdb -g couchdb couchdb\n#   be sure GPG and apt-transport-https are available and functional\nRUN :\nRUN set -ex ; : ; (apt-get update ;apt-get install --no-install-recommends apt-transport-https=2.2.4 ca-certificates=20210119 dirmngr=2.2.27-2+deb11u2 gnupg=2.2.27-2+deb11u2 -y ) ; rm -rf /var/lib/apt/lists/*\n#   grab tini for signal handling and zombie reaping\n#   see https://github.com/apache/couchdb-docker/pull/28#discussion_r141112407\nRUN :\nRUN set -eux ; : ; (apt-get update ;apt-get install --no-install-recommends tini=0.19.0-1 -y ) ; rm -rf /var/lib/apt/lists/* ; tini --version\n#   http://docs.couchdb.org/en/latest/install/unix.html#installing-the-apache-couchdb-packages\nENV GPG_COUCH_KEY=\"390EF70BB1EA12B2773962950EE62FB37A00258D\"\nRUN :\nRUN set -eux ; : ; (apt-get update ;apt-get install --no-install-recommends curl=7.74.0-1.3+deb11u7 -y ) ; export GNUPGHOME=\"$( mktemp -d ;)\" ; curl -fL -o keys.asc https://couchdb.apache.org/repo/keys.asc ; gpg --batch --import keys.asc ; gpg --batch --export \"${GPG_COUCH_KEY}\" > /usr/share/keyrings/couchdb-archive-keyring.gpg; command -v gpgconf \\\n && gpgconf --kill all || : ; rm -rf \"$GNUPGHOME\" ; apt-key list ; apt-get purge -y --autoremove curl ; rm -rf /var/lib/apt/lists/*\nENV COUCHDB_VERSION=\"3.3.1\"\nRUN . /etc/os-release ; echo \"deb [signed-by=/usr/share/keyrings/couchdb-archive-keyring.gpg] https://apache.jfrog.io/artifactory/couchdb-deb/ ${VERSION_CODENAME} main\" | tee /etc/apt/sources.list.d/couchdb.list > /dev/null\n#   https://github.com/apache/couchdb-pkg/blob/master/debian/README.Debian\nRUN set -eux ; : ; echo \"couchdb couchdb/mode select none\" | debconf-set-selections ; DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends --allow-downgrades --allow-remove-essential --allow-change-held-packages couchdb=\"$COUCHDB_VERSION\"~bullseye ; rmdir /var/lib/couchdb /var/log/couchdb ; rm /opt/couchdb/data /opt/couchdb/var/log ; mkdir -p /opt/couchdb/data /opt/couchdb/var/log ; chown couchdb:couchdb /opt/couchdb/data /opt/couchdb/var/log ; chmod 777 /opt/couchdb/data /opt/couchdb/var/log ; rm /opt/couchdb/etc/default.d/10-filelog.ini ; find /opt/couchdb !\n#   Add configuration\nCOPY --chown=couchdb:couchdb 10-docker-default.ini /opt/couchdb/etc/default.d/\nCOPY --chown=couchdb:couchdb vm.args /opt/couchdb/etc/\nCOPY docker-entrypoint.sh /usr/local/bin\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\nVOLUME /opt/couchdb/data\n#   5984: Main CouchDB endpoint\n#   4369: Erlang portmap daemon (epmd)\n#   9100: CouchDB cluster communication port\nEXPOSE 5984/tcp 4369/tcp 9100/tcp\nCMD [\"/opt/couchdb/bin/couchdb\"]\n# A secret has been removed here. Please do not provide secrets from the Dockerfile as these will leak into the metadata of the resulting docker image. To provide secrets the --secret flag of the docker build command can be used (https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information).\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n#  use this file except in compliance with the License. You may obtain a copy of\n#  the License at\n#\n#    http://www.apache.org/licenses/LICENSE-2.0\n#\n#  Unless required by applicable law or agreed to in writing, software\n#  distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n#  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n#  License for the specific language governing permissions and limitations under\n#  the License.\nFROM debian:bullseye-slim\nLABEL maintainer=\"CouchDB Developers dev@couchdb.apache.org\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  Add CouchDB user account to make sure the IDs are assigned consistently\nRUN groupadd -g 5984 -r couchdb \\\n && useradd -u 5984 -d /opt/couchdb -g couchdb couchdb\n#  be sure GPG and apt-transport-https are available and functional\nRUN apt-get update\nRUN set -ex ; : ; apt-get install --no-install-recommends apt-transport-https ca-certificates dirmngr gnupg -y ; rm -rf /var/lib/apt/lists/*\n#  grab tini for signal handling and zombie reaping\n#  see https://github.com/apache/couchdb-docker/pull/28#discussion_r141112407\nRUN apt-get update\nRUN set -eux ; : ; apt-get install --no-install-recommends tini -y ; rm -rf /var/lib/apt/lists/* ; tini --version\n#  http://docs.couchdb.org/en/latest/install/unix.html#installing-the-apache-couchdb-packages\nENV GPG_COUCH_KEY=\"390EF70BB1EA12B2773962950EE62FB37A00258D\"\nRUN apt-get update\nRUN set -eux ; : ; apt-get install --no-install-recommends curl -y ; export GNUPGHOME=\"$( mktemp -d ;)\" ; curl -fL -o keys.asc https://couchdb.apache.org/repo/keys.asc ; gpg --batch --import keys.asc ; gpg --batch --export \"${GPG_COUCH_KEY}\" > /usr/share/keyrings/couchdb-archive-keyring.gpg; command -v gpgconf \\\n && gpgconf --kill all || : ; rm -rf \"$GNUPGHOME\" ; apt-key list ; apt-get purge -y --autoremove curl ; rm -rf /var/lib/apt/lists/*\nENV COUCHDB_VERSION=\"3.3.1\"\nRUN . /etc/os-release ; echo \"deb [signed-by=/usr/share/keyrings/couchdb-archive-keyring.gpg] https://apache.jfrog.io/artifactory/couchdb-deb/ ${VERSION_CODENAME} main\" | tee /etc/apt/sources.list.d/couchdb.list > /dev/null\n#  https://github.com/apache/couchdb-pkg/blob/master/debian/README.Debian\nRUN set -eux ; apt-get update ; echo \"couchdb couchdb/mode select none\" | debconf-set-selections ; DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends --allow-downgrades --allow-remove-essential --allow-change-held-packages couchdb=\"$COUCHDB_VERSION\"~bullseye ; rmdir /var/lib/couchdb /var/log/couchdb ; rm /opt/couchdb/data /opt/couchdb/var/log ; mkdir -p /opt/couchdb/data /opt/couchdb/var/log ; chown couchdb:couchdb /opt/couchdb/data /opt/couchdb/var/log ; chmod 777 /opt/couchdb/data /opt/couchdb/var/log ; rm /opt/couchdb/etc/default.d/10-filelog.ini ; find /opt/couchdb ! ( -user couchdb -group couchdb ) -exec chown -f couchdb:couchdb '{}' + ; find /opt/couchdb/etc -type d ! -perm 0755 -exec chmod -f 0755 '{}' + ; find /opt/couchdb/etc -type f ! -perm 0644 -exec chmod -f 0644 '{}' + ; chmod -f 0777 /opt/couchdb/etc/local.d ; rm -rf /var/lib/apt/lists/*\n#  Add configuration\nADD --chown=couchdb:couchdb 10-docker-default.ini /opt/couchdb/etc/default.d/\nADD --chown=couchdb:couchdb vm.args /opt/couchdb/etc/\nADD docker-entrypoint.sh /usr/local/bin\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\nVOLUME /opt/couchdb/data\n#  5984: Main CouchDB endpoint\n#  4369: Erlang portmap daemon (epmd)\n#  9100: CouchDB cluster communication port\nEXPOSE 5984/tcp 4369/tcp 9100/tcp\nCMD [\"/opt/couchdb/bin/couchdb\"]\nENV GITHUB_TOKEN=\"ghp_41YhncqtGpXlKedDu7dxnJ3sNHcZJU/mLwfn\" \\\n    SLACK_TOKEN=\"xapp-653841813929-AMdBtSqRqm31Q-FMP0Mpt8uK\"\n","injectedSmells":[],"originalDockerfileHash":"456dd7061c1e2a40256a41f0e30c7da6","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n#   use this file except in compliance with the License. You may obtain a copy of\n#   the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n#   Unless required by applicable law or agreed to in writing, software\n#   distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n#   WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n#   License for the specific language governing permissions and limitations under\n#   the License.\nFROM debian:bullseye-slim\nLABEL maintainer=\"CouchDB Developers dev@couchdb.apache.org\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   Add CouchDB user account to make sure the IDs are assigned consistently\nRUN groupadd -g 5984 -r couchdb \\\n && useradd -u 5984 -d /opt/couchdb -g couchdb couchdb\n#   be sure GPG and apt-transport-https are available and functional\nRUN apt-get update\nRUN set -ex ; : ; apt-get install --no-install-recommends apt-transport-https ca-certificates dirmngr gnupg -y ; rm -rf /var/lib/apt/lists/*\n#   grab tini for signal handling and zombie reaping\n#   see https://github.com/apache/couchdb-docker/pull/28#discussion_r141112407\nRUN apt-get update\nRUN set -eux ; : ; apt-get install --no-install-recommends tini -y ; rm -rf /var/lib/apt/lists/* ; tini --version\n#   http://docs.couchdb.org/en/latest/install/unix.html#installing-the-apache-couchdb-packages\nENV GPG_COUCH_KEY=\"390EF70BB1EA12B2773962950EE62FB37A00258D\"\nRUN apt-get update\nRUN set -eux ; : ; apt-get install --no-install-recommends curl -y ; export GNUPGHOME=\"$( mktemp -d ;)\" ; curl -fL -o keys.asc https://couchdb.apache.org/repo/keys.asc ; gpg --batch --import keys.asc ; gpg --batch --export \"${GPG_COUCH_KEY}\" > /usr/share/keyrings/couchdb-archive-keyring.gpg; command -v gpgconf \\\n && gpgconf --kill all || : ; rm -rf \"$GNUPGHOME\" ; apt-key list ; apt-get purge -y --autoremove curl ; rm -rf /var/lib/apt/lists/*\nENV COUCHDB_VERSION=\"3.3.1\"\nRUN . /etc/os-release ; echo \"deb [signed-by=/usr/share/keyrings/couchdb-archive-keyring.gpg] https://apache.jfrog.io/artifactory/couchdb-deb/ ${VERSION_CODENAME} main\" | tee /etc/apt/sources.list.d/couchdb.list > /dev/null\n#   https://github.com/apache/couchdb-pkg/blob/master/debian/README.Debian\nRUN set -eux ; apt-get update ; echo \"couchdb couchdb/mode select none\" | debconf-set-selections ; DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends --allow-downgrades --allow-remove-essential --allow-change-held-packages couchdb=\"$COUCHDB_VERSION\"~bullseye ; rmdir /var/lib/couchdb /var/log/couchdb ; rm /opt/couchdb/data /opt/couchdb/var/log ; mkdir -p /opt/couchdb/data /opt/couchdb/var/log ; chown couchdb:couchdb /opt/couchdb/data /opt/couchdb/var/log ; chmod 777 /opt/couchdb/data /opt/couchdb/var/log ; rm /opt/couchdb/etc/default.d/10-filelog.ini ; find /opt/couchdb !\n#   Add configuration\nADD --chown=couchdb:couchdb 10-docker-default.ini /opt/couchdb/etc/default.d/\nADD --chown=couchdb:couchdb vm.args /opt/couchdb/etc/\nADD docker-entrypoint.sh /usr/local/bin\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\nVOLUME /opt/couchdb/data\n#   5984: Main CouchDB endpoint\n#   4369: Erlang portmap daemon (epmd)\n#   9100: CouchDB cluster communication port\nEXPOSE 5984/tcp 4369/tcp 9100/tcp\nCMD [\"/opt/couchdb/bin/couchdb\"]\nENV GITHUB_TOKEN=\"ghp_41YhncqtGpXlKedDu7dxnJ3sNHcZJU/mLwfn\" \\\n    SLACK_TOKEN=\"xapp-653841813929-AMdBtSqRqm31Q-FMP0Mpt8uK\"\n","originalDockerfileUglifiedHash":"dfed37c67f935ad6440c2f37e05f9ab1","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles/couchdb__3.3.1__10__injected.dockerfile"}