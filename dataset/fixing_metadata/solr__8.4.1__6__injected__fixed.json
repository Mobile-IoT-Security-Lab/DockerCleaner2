{"seed":4075011172,"processedDockerfileHash":"73316d033c65838063d41ba8fa7d686d","fixedSmells":["do-not-use-apt-get-update-alone","use-wget-instead-of-add","do-not-have-secrets","have-a-user"],"successfullyFixedSmells":["do-not-use-apt-get-update-alone","do-not-have-secrets","have-a-user"],"processedDockerfile":"FROM openjdk:11-jre\nLABEL maintainer=\"The Apache Lucene/Solr Project\"\nLABEL repository=\"https://github.com/docker-solr/docker-solr\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\nARG SOLR_VERSION=\"8.4.1\"\nARG SOLR_SHA512=\"2f210dae8d6a07b111ede22005fbd16aa6848900cda8adb352a33e08229783a170dddb529a7eb990f5157d4f5427c199df2114b9c0ffecdf9490a2ac07c6bb09\"\nARG SOLR_KEYS=\"2085660D9C1FCCACC4A479A3BF160FF14992A24C\"\n#   If specified, this will override SOLR_DOWNLOAD_SERVER and all ASF mirrors. Typically used downstream for custom builds\nARG SOLR_DOWNLOAD_URL\n#   Override the solr download location with e.g.:\n#     docker build -t mine --build-arg SOLR_DOWNLOAD_SERVER=http://www-eu.apache.org/dist/lucene/solr .\nARG SOLR_DOWNLOAD_SERVER\nADD https://github.com/apangin/jattach/releases/download/v1.5/jattach ./\nRUN :\nRUN set -ex ; : ; (apt-get update ;apt-get install --no-install-recommends acl=2.2.53-10 dirmngr=2.2.27-2+deb11u2 gpg=2.2.27-2+deb11u2 lsof=4.93.2+dfsg-1.1 procps=2:3.3.17-5 wget=1.21-1+deb11u1 netcat=1.10-46 gosu=1.12-1+b6 tini=0.19.0-1 -y ) ; rm -rf /var/lib/apt/lists/* ; cd /usr/local/bin ; : ; chmod 755 jattach ; echo \"d8eedbb3e192a8596c08efedff99b9acf1075331e1747107c07cdb1718db2abe259ef168109e46bd4cf80d47d43028ff469f95e6ddcbdda4d7ffa73a20e852f9 jattach\" > jattach.sha512; sha512sum -c jattach.sha512 ; rm jattach.sha512\nENV SOLR_USER=\"solr\" \\\n    SOLR_UID=\"8983\" \\\n    SOLR_GROUP=\"solr\" \\\n    SOLR_GID=\"8983\" \\\n    SOLR_CLOSER_URL=\"http://www.apache.org/dyn/closer.lua?filename=lucene/solr/$SOLR_VERSION/solr-$SOLR_VERSION.tgz&action=download\" \\\n    SOLR_DIST_URL=\"https://www.apache.org/dist/lucene/solr/$SOLR_VERSION/solr-$SOLR_VERSION.tgz\" \\\n    SOLR_ARCHIVE_URL=\"https://archive.apache.org/dist/lucene/solr/$SOLR_VERSION/solr-$SOLR_VERSION.tgz\" \\\n    PATH=\"/opt/solr/bin:/opt/docker-solr/scripts:$PATH\" \\\n    SOLR_INCLUDE=\"/etc/default/solr.in.sh\" \\\n    SOLR_HOME=\"/var/solr/data\" \\\n    SOLR_PID_DIR=\"/var/solr\" \\\n    SOLR_LOGS_DIR=\"/var/solr/logs\" \\\n    LOG4J_PROPS=\"/var/solr/log4j2.xml\"\nRUN set -ex ; groupadd -r --gid \"$SOLR_GID\" \"$SOLR_GROUP\" ; useradd -r --uid \"$SOLR_UID\" --gid \"$SOLR_GID\" \"$SOLR_USER\"\nRUN set -ex ; export GNUPGHOME=\"/tmp/gnupg_home\" ; mkdir -p \"$GNUPGHOME\" ; chmod 700 \"$GNUPGHOME\" ; echo \"disable-ipv6\" >> \"$GNUPGHOME/dirmngr.conf\"; for key in $SOLR_KEYS; do found='' ;for server in ha.pool.sks-keyservers.net hkp://keyserver.ubuntu.com:80 hkp://p80.pool.sks-keyservers.net:80 pgp.mit.edu; do echo \" trying $server for $key\" ;gpg --batch --keyserver \"$server\" --keyserver-options timeout=10 --recv-keys \"$key\" \\\n && found=yes \\\n && break ;gpg --batch --keyserver \"$server\" --keyserver-options timeout=10 --recv-keys \"$key\" \\\n && found=yes \\\n && break ; done ;test -z \"$found\" \\\n && echo \"error: failed to fetch $key from several disparate servers -- network issues?\" >&2 \\\n && exit 1 ; done ; exit 0\nRUN set -ex ; export GNUPGHOME=\"/tmp/gnupg_home\" ; MAX_REDIRECTS=1 ; if [ -n \"$SOLR_DOWNLOAD_URL\" ] ; then MAX_REDIRECTS=4 ;SKIP_GPG_CHECK=true ; elif [ -n \"$SOLR_DOWNLOAD_SERVER\" ] ; then SOLR_DOWNLOAD_URL=\"$SOLR_DOWNLOAD_SERVER/$SOLR_VERSION/solr-$SOLR_VERSION.tgz\" ; fi ; for url in $SOLR_DOWNLOAD_URL $SOLR_CLOSER_URL $SOLR_DIST_URL $SOLR_ARCHIVE_URL; do if [ -f \"/opt/solr-$SOLR_VERSION.tgz\" ] ; then break ; fi ;echo \"downloading $url\" ;if wget -t 10 --max-redirect $MAX_REDIRECTS --retry-connrefused -nv \"$url\" -O \"/opt/solr-$SOLR_VERSION.tgz\" ; then break ; else rm -f \"/opt/solr-$SOLR_VERSION.tgz\" ; fi ; done ; if [ ! -f \"/opt/solr-$SOLR_VERSION.tgz\" ] ; then echo \"failed all download attempts for solr-$SOLR_VERSION.tgz\" ;exit 1 ; fi ; if [ -z \"$SKIP_GPG_CHECK\" ] ; then echo \"downloading $SOLR_ARCHIVE_URL.asc\" ;wget -nv \"$SOLR_ARCHIVE_URL.asc\" -O \"/opt/solr-$SOLR_VERSION.tgz.asc\" ;echo \"$SOLR_SHA512 */opt/solr-$SOLR_VERSION.tgz\" | sha512sum -c - ;(ls -l \"/opt/solr-$SOLR_VERSION.tgz\" \"/opt/solr-$SOLR_VERSION.tgz.asc\" >&2) ;gpg --batch --verify \"/opt/solr-$SOLR_VERSION.tgz.asc\" \"/opt/solr-$SOLR_VERSION.tgz\" ; else echo \"Skipping GPG validation due to non-Apache build\" ; fi ; tar -C /opt --extract --file \"/opt/solr-$SOLR_VERSION.tgz\" ; (cd /opt ;ln -s \"solr-$SOLR_VERSION\" solr ) ; rm \"/opt/solr-$SOLR_VERSION.tgz\"* ; rm -Rf /opt/solr/docs/ /opt/solr/dist/{solr-core-$SOLR_VERSION.jar,solr-solrj-$SOLR_VERSION.jar,solrj-lib,solr-test-framework-$SOLR_VERSION.jar,test-framework} ; mkdir -p /opt/solr/server/solr/lib /docker-entrypoint-initdb.d /opt/docker-solr ; chown -R 0:0 \"/opt/solr-$SOLR_VERSION\" ; find \"/opt/solr-$SOLR_VERSION\" -type d -print0 | xargs -0 chmod 0755 ; find \"/opt/solr-$SOLR_VERSION\" -type f -print0 | xargs -0 chmod 0644 ; chmod -R 0755 \"/opt/solr-$SOLR_VERSION/bin\" \"/opt/solr-$SOLR_VERSION/contrib/prometheus-exporter/bin/solr-exporter\" /opt/solr-$SOLR_VERSION/server/scripts/cloud-scripts ; cp /opt/solr/bin/solr.in.sh /etc/default/solr.in.sh ; mv /opt/solr/bin/solr.in.sh /opt/solr/bin/solr.in.sh.orig ; mv /opt/solr/bin/solr.in.cmd /opt/solr/bin/solr.in.cmd.orig ; chown root:0 /etc/default/solr.in.sh ; chmod 0664 /etc/default/solr.in.sh ; mkdir -p /var/solr/data /var/solr/logs ; (cd /opt/solr/server/solr ;cp solr.xml zoo.cfg /var/solr/data/ ) ; cp /opt/solr/server/resources/log4j2.xml /var/solr/log4j2.xml ; find /var/solr -type d -print0 | xargs -0 chmod 0770 ; find /var/solr -type f -print0 | xargs -0 chmod 0660 ; sed -i -e \"s/\\\"$( whoami ;)\\\" == \\\"root\\\"/$( id -u ;) == 0/\" /opt/solr/bin/solr ; sed -i -e 's/lsof -PniTCP:/lsof -t -PniTCP:/' /opt/solr/bin/solr ; chown -R \"0:0\" /opt/solr-$SOLR_VERSION /docker-entrypoint-initdb.d /opt/docker-solr ; chown -R \"$SOLR_USER:0\" /var/solr ; { command -v gpgconf ;gpgconf --kill all || : ; } ; rm -r \"$GNUPGHOME\"\nCOPY --chown=0:0 scripts /opt/docker-solr/scripts\nVOLUME /var/solr\nEXPOSE 8983/tcp\nWORKDIR /opt/solr\nUSER $SOLR_USER\nENTRYPOINT [\"docker-entrypoint.sh\"]\nHEALTHCHECK CMD curl --fail http://127.0.0.1:8983 || exit 1\nCMD [\"solr-foreground\"]\nUSER 0:qm\n# A secret has been removed here. Please do not provide secrets from the Dockerfile as these will leak into the metadata of the resulting docker image. To provide secrets the --secret flag of the docker build command can be used (https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information).\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n","originalDockerfile":"FROM openjdk:11-jre\nLABEL maintainer=\"The Apache Lucene/Solr Project\"\nLABEL repository=\"https://github.com/docker-solr/docker-solr\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\nARG SOLR_VERSION=\"8.4.1\"\nARG SOLR_SHA512=\"2f210dae8d6a07b111ede22005fbd16aa6848900cda8adb352a33e08229783a170dddb529a7eb990f5157d4f5427c199df2114b9c0ffecdf9490a2ac07c6bb09\"\nARG SOLR_KEYS=\"2085660D9C1FCCACC4A479A3BF160FF14992A24C\"\n#  If specified, this will override SOLR_DOWNLOAD_SERVER and all ASF mirrors. Typically used downstream for custom builds\nARG SOLR_DOWNLOAD_URL\n#  Override the solr download location with e.g.:\n#    docker build -t mine --build-arg SOLR_DOWNLOAD_SERVER=http://www-eu.apache.org/dist/lucene/solr .\nARG SOLR_DOWNLOAD_SERVER\nADD https://github.com/apangin/jattach/releases/download/v1.5/jattach ./\nRUN apt-get update\nRUN set -ex ; : ; apt-get install --no-install-recommends acl=2.2.53-10 dirmngr=2.2.27-2+deb11u2 gpg=2.2.27-2+deb11u2 lsof=4.93.2+dfsg-1.1 procps=2:3.3.17-5 wget=1.21-1+deb11u1 netcat=1.10-46 gosu=1.12-1+b6 tini=0.19.0-1 -y ; rm -rf /var/lib/apt/lists/* ; cd /usr/local/bin ; : ; chmod 755 jattach ; echo \"d8eedbb3e192a8596c08efedff99b9acf1075331e1747107c07cdb1718db2abe259ef168109e46bd4cf80d47d43028ff469f95e6ddcbdda4d7ffa73a20e852f9 jattach\" > jattach.sha512; sha512sum -c jattach.sha512 ; rm jattach.sha512\nENV SOLR_USER=\"solr\" \\\n    SOLR_UID=\"8983\" \\\n    SOLR_GROUP=\"solr\" \\\n    SOLR_GID=\"8983\" \\\n    SOLR_CLOSER_URL=\"http://www.apache.org/dyn/closer.lua?filename=lucene/solr/$SOLR_VERSION/solr-$SOLR_VERSION.tgz&action=download\" \\\n    SOLR_DIST_URL=\"https://www.apache.org/dist/lucene/solr/$SOLR_VERSION/solr-$SOLR_VERSION.tgz\" \\\n    SOLR_ARCHIVE_URL=\"https://archive.apache.org/dist/lucene/solr/$SOLR_VERSION/solr-$SOLR_VERSION.tgz\" \\\n    PATH=\"/opt/solr/bin:/opt/docker-solr/scripts:$PATH\" \\\n    SOLR_INCLUDE=\"/etc/default/solr.in.sh\" \\\n    SOLR_HOME=\"/var/solr/data\" \\\n    SOLR_PID_DIR=\"/var/solr\" \\\n    SOLR_LOGS_DIR=\"/var/solr/logs\" \\\n    LOG4J_PROPS=\"/var/solr/log4j2.xml\"\nRUN set -ex ; groupadd -r --gid \"$SOLR_GID\" \"$SOLR_GROUP\" ; useradd -r --uid \"$SOLR_UID\" --gid \"$SOLR_GID\" \"$SOLR_USER\"\nRUN set -ex ; export GNUPGHOME=\"/tmp/gnupg_home\" ; mkdir -p \"$GNUPGHOME\" ; chmod 700 \"$GNUPGHOME\" ; echo \"disable-ipv6\" >> \"$GNUPGHOME/dirmngr.conf\"; for key in $SOLR_KEYS; do found='' ;for server in ha.pool.sks-keyservers.net hkp://keyserver.ubuntu.com:80 hkp://p80.pool.sks-keyservers.net:80 pgp.mit.edu; do echo \" trying $server for $key\" ;gpg --batch --keyserver \"$server\" --keyserver-options timeout=10 --recv-keys \"$key\" \\\n && found=yes \\\n && break ;gpg --batch --keyserver \"$server\" --keyserver-options timeout=10 --recv-keys \"$key\" \\\n && found=yes \\\n && break ; done ;test -z \"$found\" \\\n && echo \"error: failed to fetch $key from several disparate servers -- network issues?\" >&2 \\\n && exit 1 ; done ; exit 0\nRUN set -ex ; export GNUPGHOME=\"/tmp/gnupg_home\" ; MAX_REDIRECTS=1 ; if [ -n \"$SOLR_DOWNLOAD_URL\" ] ; then MAX_REDIRECTS=4 ;SKIP_GPG_CHECK=true ; elif [ -n \"$SOLR_DOWNLOAD_SERVER\" ] ; then SOLR_DOWNLOAD_URL=\"$SOLR_DOWNLOAD_SERVER/$SOLR_VERSION/solr-$SOLR_VERSION.tgz\" ; fi ; for url in $SOLR_DOWNLOAD_URL $SOLR_CLOSER_URL $SOLR_DIST_URL $SOLR_ARCHIVE_URL; do if [ -f \"/opt/solr-$SOLR_VERSION.tgz\" ] ; then break ; fi ;echo \"downloading $url\" ;if wget -t 10 --max-redirect $MAX_REDIRECTS --retry-connrefused -nv \"$url\" -O \"/opt/solr-$SOLR_VERSION.tgz\" ; then break ; else rm -f \"/opt/solr-$SOLR_VERSION.tgz\" ; fi ; done ; if [ ! -f \"/opt/solr-$SOLR_VERSION.tgz\" ] ; then echo \"failed all download attempts for solr-$SOLR_VERSION.tgz\" ;exit 1 ; fi ; if [ -z \"$SKIP_GPG_CHECK\" ] ; then echo \"downloading $SOLR_ARCHIVE_URL.asc\" ;wget -nv \"$SOLR_ARCHIVE_URL.asc\" -O \"/opt/solr-$SOLR_VERSION.tgz.asc\" ;echo \"$SOLR_SHA512 */opt/solr-$SOLR_VERSION.tgz\" | sha512sum -c - ;(ls -l \"/opt/solr-$SOLR_VERSION.tgz\" \"/opt/solr-$SOLR_VERSION.tgz.asc\" >&2) ;gpg --batch --verify \"/opt/solr-$SOLR_VERSION.tgz.asc\" \"/opt/solr-$SOLR_VERSION.tgz\" ; else echo \"Skipping GPG validation due to non-Apache build\" ; fi ; tar -C /opt --extract --file \"/opt/solr-$SOLR_VERSION.tgz\" ; (cd /opt ;ln -s \"solr-$SOLR_VERSION\" solr ) ; rm \"/opt/solr-$SOLR_VERSION.tgz\"* ; rm -Rf /opt/solr/docs/ /opt/solr/dist/{solr-core-$SOLR_VERSION.jar,solr-solrj-$SOLR_VERSION.jar,solrj-lib,solr-test-framework-$SOLR_VERSION.jar,test-framework} ; mkdir -p /opt/solr/server/solr/lib /docker-entrypoint-initdb.d /opt/docker-solr ; chown -R 0:0 \"/opt/solr-$SOLR_VERSION\" ; find \"/opt/solr-$SOLR_VERSION\" -type d -print0 | xargs -0 chmod 0755 ; find \"/opt/solr-$SOLR_VERSION\" -type f -print0 | xargs -0 chmod 0644 ; chmod -R 0755 \"/opt/solr-$SOLR_VERSION/bin\" \"/opt/solr-$SOLR_VERSION/contrib/prometheus-exporter/bin/solr-exporter\" /opt/solr-$SOLR_VERSION/server/scripts/cloud-scripts ; cp /opt/solr/bin/solr.in.sh /etc/default/solr.in.sh ; mv /opt/solr/bin/solr.in.sh /opt/solr/bin/solr.in.sh.orig ; mv /opt/solr/bin/solr.in.cmd /opt/solr/bin/solr.in.cmd.orig ; chown root:0 /etc/default/solr.in.sh ; chmod 0664 /etc/default/solr.in.sh ; mkdir -p /var/solr/data /var/solr/logs ; (cd /opt/solr/server/solr ;cp solr.xml zoo.cfg /var/solr/data/ ) ; cp /opt/solr/server/resources/log4j2.xml /var/solr/log4j2.xml ; find /var/solr -type d -print0 | xargs -0 chmod 0770 ; find /var/solr -type f -print0 | xargs -0 chmod 0660 ; sed -i -e \"s/\\\"$(whoami)\\\" == \\\"root\\\"/$(id -u) == 0/\" /opt/solr/bin/solr ; sed -i -e 's/lsof -PniTCP:/lsof -t -PniTCP:/' /opt/solr/bin/solr ; chown -R \"0:0\" /opt/solr-$SOLR_VERSION /docker-entrypoint-initdb.d /opt/docker-solr ; chown -R \"$SOLR_USER:0\" /var/solr ; { command -v gpgconf ;gpgconf --kill all || : ; } ; rm -r \"$GNUPGHOME\"\nCOPY --chown=0:0 scripts /opt/docker-solr/scripts\nVOLUME /var/solr\nEXPOSE 8983/tcp\nWORKDIR /opt/solr\nUSER $SOLR_USER\nENTRYPOINT [\"docker-entrypoint.sh\"]\nHEALTHCHECK CMD curl --fail http://127.0.0.1:8983 || exit 1\nCMD [\"solr-foreground\"]\nUSER 0:qm\nENV GOOGLE_API_KEY=\"AIzawJnriM8bpbqemHP1BqWRXttrvLuQNVQHL57\" \\\n    GOOGLE_API_KEY=\"AIzaDnUBOOjDTgDWqcVpS4FogqzRfAI6GilkvF7\"\n","injectedSmells":[],"originalDockerfileHash":"ffd68655966bc04545547e45f2e3bc64","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM openjdk:11-jre\nLABEL maintainer=\"The Apache Lucene/Solr Project\"\nLABEL repository=\"https://github.com/docker-solr/docker-solr\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\nARG SOLR_VERSION=\"8.4.1\"\nARG SOLR_SHA512=\"2f210dae8d6a07b111ede22005fbd16aa6848900cda8adb352a33e08229783a170dddb529a7eb990f5157d4f5427c199df2114b9c0ffecdf9490a2ac07c6bb09\"\nARG SOLR_KEYS=\"2085660D9C1FCCACC4A479A3BF160FF14992A24C\"\n#   If specified, this will override SOLR_DOWNLOAD_SERVER and all ASF mirrors. Typically used downstream for custom builds\nARG SOLR_DOWNLOAD_URL\n#   Override the solr download location with e.g.:\n#     docker build -t mine --build-arg SOLR_DOWNLOAD_SERVER=http://www-eu.apache.org/dist/lucene/solr .\nARG SOLR_DOWNLOAD_SERVER\nADD https://github.com/apangin/jattach/releases/download/v1.5/jattach ./\nRUN apt-get update\nRUN set -ex ; : ; apt-get install --no-install-recommends acl=2.2.53-10 dirmngr=2.2.27-2+deb11u2 gpg=2.2.27-2+deb11u2 lsof=4.93.2+dfsg-1.1 procps=2:3.3.17-5 wget=1.21-1+deb11u1 netcat=1.10-46 gosu=1.12-1+b6 tini=0.19.0-1 -y ; rm -rf /var/lib/apt/lists/* ; cd /usr/local/bin ; : ; chmod 755 jattach ; echo \"d8eedbb3e192a8596c08efedff99b9acf1075331e1747107c07cdb1718db2abe259ef168109e46bd4cf80d47d43028ff469f95e6ddcbdda4d7ffa73a20e852f9 jattach\" > jattach.sha512; sha512sum -c jattach.sha512 ; rm jattach.sha512\nENV SOLR_USER=\"solr\" \\\n    SOLR_UID=\"8983\" \\\n    SOLR_GROUP=\"solr\" \\\n    SOLR_GID=\"8983\" \\\n    SOLR_CLOSER_URL=\"http://www.apache.org/dyn/closer.lua?filename=lucene/solr/$SOLR_VERSION/solr-$SOLR_VERSION.tgz&action=download\" \\\n    SOLR_DIST_URL=\"https://www.apache.org/dist/lucene/solr/$SOLR_VERSION/solr-$SOLR_VERSION.tgz\" \\\n    SOLR_ARCHIVE_URL=\"https://archive.apache.org/dist/lucene/solr/$SOLR_VERSION/solr-$SOLR_VERSION.tgz\" \\\n    PATH=\"/opt/solr/bin:/opt/docker-solr/scripts:$PATH\" \\\n    SOLR_INCLUDE=\"/etc/default/solr.in.sh\" \\\n    SOLR_HOME=\"/var/solr/data\" \\\n    SOLR_PID_DIR=\"/var/solr\" \\\n    SOLR_LOGS_DIR=\"/var/solr/logs\" \\\n    LOG4J_PROPS=\"/var/solr/log4j2.xml\"\nRUN set -ex ; groupadd -r --gid \"$SOLR_GID\" \"$SOLR_GROUP\" ; useradd -r --uid \"$SOLR_UID\" --gid \"$SOLR_GID\" \"$SOLR_USER\"\nRUN set -ex ; export GNUPGHOME=\"/tmp/gnupg_home\" ; mkdir -p \"$GNUPGHOME\" ; chmod 700 \"$GNUPGHOME\" ; echo \"disable-ipv6\" >> \"$GNUPGHOME/dirmngr.conf\"; for key in $SOLR_KEYS; do found='' ;for server in ha.pool.sks-keyservers.net hkp://keyserver.ubuntu.com:80 hkp://p80.pool.sks-keyservers.net:80 pgp.mit.edu; do echo \" trying $server for $key\" ;gpg --batch --keyserver \"$server\" --keyserver-options timeout=10 --recv-keys \"$key\" \\\n && found=yes \\\n && break ;gpg --batch --keyserver \"$server\" --keyserver-options timeout=10 --recv-keys \"$key\" \\\n && found=yes \\\n && break ; done ;test -z \"$found\" \\\n && echo \"error: failed to fetch $key from several disparate servers -- network issues?\" >&2 \\\n && exit 1 ; done ; exit 0\nRUN set -ex ; export GNUPGHOME=\"/tmp/gnupg_home\" ; MAX_REDIRECTS=1 ; if [ -n \"$SOLR_DOWNLOAD_URL\" ] ; then MAX_REDIRECTS=4 ;SKIP_GPG_CHECK=true ; elif [ -n \"$SOLR_DOWNLOAD_SERVER\" ] ; then SOLR_DOWNLOAD_URL=\"$SOLR_DOWNLOAD_SERVER/$SOLR_VERSION/solr-$SOLR_VERSION.tgz\" ; fi ; for url in $SOLR_DOWNLOAD_URL $SOLR_CLOSER_URL $SOLR_DIST_URL $SOLR_ARCHIVE_URL; do if [ -f \"/opt/solr-$SOLR_VERSION.tgz\" ] ; then break ; fi ;echo \"downloading $url\" ;if wget -t 10 --max-redirect $MAX_REDIRECTS --retry-connrefused -nv \"$url\" -O \"/opt/solr-$SOLR_VERSION.tgz\" ; then break ; else rm -f \"/opt/solr-$SOLR_VERSION.tgz\" ; fi ; done ; if [ ! -f \"/opt/solr-$SOLR_VERSION.tgz\" ] ; then echo \"failed all download attempts for solr-$SOLR_VERSION.tgz\" ;exit 1 ; fi ; if [ -z \"$SKIP_GPG_CHECK\" ] ; then echo \"downloading $SOLR_ARCHIVE_URL.asc\" ;wget -nv \"$SOLR_ARCHIVE_URL.asc\" -O \"/opt/solr-$SOLR_VERSION.tgz.asc\" ;echo \"$SOLR_SHA512 */opt/solr-$SOLR_VERSION.tgz\" | sha512sum -c - ;(ls -l \"/opt/solr-$SOLR_VERSION.tgz\" \"/opt/solr-$SOLR_VERSION.tgz.asc\" >&2) ;gpg --batch --verify \"/opt/solr-$SOLR_VERSION.tgz.asc\" \"/opt/solr-$SOLR_VERSION.tgz\" ; else echo \"Skipping GPG validation due to non-Apache build\" ; fi ; tar -C /opt --extract --file \"/opt/solr-$SOLR_VERSION.tgz\" ; (cd /opt ;ln -s \"solr-$SOLR_VERSION\" solr ) ; rm \"/opt/solr-$SOLR_VERSION.tgz\"* ; rm -Rf /opt/solr/docs/ /opt/solr/dist/{solr-core-$SOLR_VERSION.jar,solr-solrj-$SOLR_VERSION.jar,solrj-lib,solr-test-framework-$SOLR_VERSION.jar,test-framework} ; mkdir -p /opt/solr/server/solr/lib /docker-entrypoint-initdb.d /opt/docker-solr ; chown -R 0:0 \"/opt/solr-$SOLR_VERSION\" ; find \"/opt/solr-$SOLR_VERSION\" -type d -print0 | xargs -0 chmod 0755 ; find \"/opt/solr-$SOLR_VERSION\" -type f -print0 | xargs -0 chmod 0644 ; chmod -R 0755 \"/opt/solr-$SOLR_VERSION/bin\" \"/opt/solr-$SOLR_VERSION/contrib/prometheus-exporter/bin/solr-exporter\" /opt/solr-$SOLR_VERSION/server/scripts/cloud-scripts ; cp /opt/solr/bin/solr.in.sh /etc/default/solr.in.sh ; mv /opt/solr/bin/solr.in.sh /opt/solr/bin/solr.in.sh.orig ; mv /opt/solr/bin/solr.in.cmd /opt/solr/bin/solr.in.cmd.orig ; chown root:0 /etc/default/solr.in.sh ; chmod 0664 /etc/default/solr.in.sh ; mkdir -p /var/solr/data /var/solr/logs ; (cd /opt/solr/server/solr ;cp solr.xml zoo.cfg /var/solr/data/ ) ; cp /opt/solr/server/resources/log4j2.xml /var/solr/log4j2.xml ; find /var/solr -type d -print0 | xargs -0 chmod 0770 ; find /var/solr -type f -print0 | xargs -0 chmod 0660 ; sed -i -e \"s/\\\"$( whoami ;)\\\" == \\\"root\\\"/$( id -u ;) == 0/\" /opt/solr/bin/solr ; sed -i -e 's/lsof -PniTCP:/lsof -t -PniTCP:/' /opt/solr/bin/solr ; chown -R \"0:0\" /opt/solr-$SOLR_VERSION /docker-entrypoint-initdb.d /opt/docker-solr ; chown -R \"$SOLR_USER:0\" /var/solr ; { command -v gpgconf ;gpgconf --kill all || : ; } ; rm -r \"$GNUPGHOME\"\nCOPY --chown=0:0 scripts /opt/docker-solr/scripts\nVOLUME /var/solr\nEXPOSE 8983/tcp\nWORKDIR /opt/solr\nUSER $SOLR_USER\nENTRYPOINT [\"docker-entrypoint.sh\"]\nHEALTHCHECK CMD curl --fail http://127.0.0.1:8983 || exit 1\nCMD [\"solr-foreground\"]\nUSER 0:qm\nENV GOOGLE_API_KEY=\"AIzawJnriM8bpbqemHP1BqWRXttrvLuQNVQHL57\" \\\n    GOOGLE_API_KEY=\"AIzaDnUBOOjDTgDWqcVpS4FogqzRfAI6GilkvF7\"\n","originalDockerfileUglifiedHash":"7e24a2a013f74c87ee0f753500b427b1","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles/solr__8.4.1__6__injected.dockerfile"}