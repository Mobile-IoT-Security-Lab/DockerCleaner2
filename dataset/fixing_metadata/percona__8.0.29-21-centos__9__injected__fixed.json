{"seed":381460685,"processedDockerfileHash":"a57ee211f395c981e6f21d95d2829032","fixedSmells":["use-copy-instead-of-add","have-a-healthcheck"],"successfullyFixedSmells":["use-copy-instead-of-add","have-a-healthcheck"],"processedDockerfile":"#   This Dockerfile should be used for docker official repo\n#   https://github.com/docker-library/official-images:\n#   No official images can be derived from, or depend on, non-official images\n#   with the following notable exceptions...\nFROM oraclelinux:8\nLABEL org.opencontainers.image.authors=\"info@percona.com\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   It is intentionally used another UID, to have backward compatibility with\n#   the previous image versions published on Docker Hub\nRUN set -ex ; groupdel input ; userdel systemd-coredump ; groupadd -g 1001 mysql ; useradd -u 1001 -r -g 1001 -s /sbin/nologin -c \"Default Application User\" mysql\n#   check repository package signature in secure way\nRUN set -ex ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver keyserver.ubuntu.com --recv-keys 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A 99DB70FAE1D7CE227FB6488205B555B38483C65D ; gpg --batch --export --armor 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A > ${GNUPGHOME}/RPM-GPG-KEY-Percona; gpg --batch --export --armor 99DB70FAE1D7CE227FB6488205B555B38483C65D > ${GNUPGHOME}/RPM-GPG-KEY-centosofficial; rpmkeys --import ${GNUPGHOME}/RPM-GPG-KEY-Percona ${GNUPGHOME}/RPM-GPG-KEY-centosofficial ; curl -Lf -o /tmp/percona-release.rpm https://repo.percona.com/yum/percona-release-latest.noarch.rpm ; rpmkeys --checksig /tmp/percona-release.rpm ; rpm -i /tmp/percona-release.rpm ; rm -rf \"$GNUPGHOME\" /tmp/percona-release.rpm ; rpm --import /etc/pki/rpm-gpg/PERCONA-PACKAGING-KEY ; dnf -y module disable mysql ; percona-release disable all ; percona-release enable ps-80 release\nENV PS_VERSION=\"8.0.29-21.1\"\nENV OS_VER=\"el8\"\nENV FULL_PERCONA_VERSION=\"\\\"$PS_VERSION.$OS_VER\\\"\"\nRUN set -ex ; rpm -e --nodeps tzdata ; dnf -y install hostname tzdata jemalloc which cracklib-dicts tar policycoreutils ; dnf -y install percona-server-server-${FULL_PERCONA_VERSION} percona-server-devel-${FULL_PERCONA_VERSION} percona-server-rocksdb-${FULL_PERCONA_VERSION} ; dnf clean all ; rm -rf /var/cache/dnf /var/cache/yum /var/lib/mysql\n#   purge and re-create /var/lib/mysql with appropriate ownership\nRUN set -ex ; /usr/bin/install -m 0775 -o mysql -g root -d /var/lib/mysql /var/run/mysqld /docker-entrypoint-initdb.d ; find /etc/my.cnf /etc/my.cnf.d -name '*.cnf' -print0 | xargs -0 grep -lZE '^(bind-address|log|user)' | xargs -rt -0 sed -Ei 's/^(bind-address|log|user)/#&/' ; echo '!includedir /etc/my.cnf.d' >> /etc/my.cnf; printf '[mysqld]\\nskip-host-cache\\nskip-name-resolve\\n' > /etc/my.cnf.d/docker.cnf; /usr/bin/install -m 0664 -o mysql -g root /dev/null /etc/sysconfig/mysql ; echo \"LD_PRELOAD=/usr/lib64/libjemalloc.so.1\" >> /etc/sysconfig/mysql; echo \"THP_SETTING=never\" >> /etc/sysconfig/mysql; chown -R mysql:root /etc/my.cnf /etc/my.cnf.d ; chmod -R ug+rwX /etc/my.cnf /etc/my.cnf.d\nVOLUME [\"/var/lib/mysql\", \"/var/log/mysql\"]\nCOPY ps-entry.sh /docker-entrypoint.sh\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nUSER mysql\nEXPOSE 3306/tcp 33060/tcp\nCOPY docker-healthcheck /usr/local/bin/\nCMD [\"mysqld\"]\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  This Dockerfile should be used for docker official repo\n#  https://github.com/docker-library/official-images:\n#  No official images can be derived from, or depend on, non-official images\n#  with the following notable exceptions...\nFROM oraclelinux:8\nLABEL org.opencontainers.image.authors=\"info@percona.com\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  It is intentionally used another UID, to have backward compatibility with\n#  the previous image versions published on Docker Hub\nRUN set -ex ; groupdel input ; userdel systemd-coredump ; groupadd -g 1001 mysql ; useradd -u 1001 -r -g 1001 -s /sbin/nologin -c \"Default Application User\" mysql\n#  check repository package signature in secure way\nRUN set -ex ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver keyserver.ubuntu.com --recv-keys 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A 99DB70FAE1D7CE227FB6488205B555B38483C65D ; gpg --batch --export --armor 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A > ${GNUPGHOME}/RPM-GPG-KEY-Percona; gpg --batch --export --armor 99DB70FAE1D7CE227FB6488205B555B38483C65D > ${GNUPGHOME}/RPM-GPG-KEY-centosofficial; rpmkeys --import ${GNUPGHOME}/RPM-GPG-KEY-Percona ${GNUPGHOME}/RPM-GPG-KEY-centosofficial ; curl -Lf -o /tmp/percona-release.rpm https://repo.percona.com/yum/percona-release-latest.noarch.rpm ; rpmkeys --checksig /tmp/percona-release.rpm ; rpm -i /tmp/percona-release.rpm ; rm -rf \"$GNUPGHOME\" /tmp/percona-release.rpm ; rpm --import /etc/pki/rpm-gpg/PERCONA-PACKAGING-KEY ; dnf -y module disable mysql ; percona-release disable all ; percona-release enable ps-80 release\nENV PS_VERSION=\"8.0.29-21.1\"\nENV OS_VER=\"el8\"\nENV FULL_PERCONA_VERSION=\"\\\"$PS_VERSION.$OS_VER\\\"\"\nRUN set -ex ; rpm -e --nodeps tzdata ; dnf -y install hostname tzdata jemalloc which cracklib-dicts tar policycoreutils ; dnf -y install percona-server-server-${FULL_PERCONA_VERSION} percona-server-devel-${FULL_PERCONA_VERSION} percona-server-rocksdb-${FULL_PERCONA_VERSION} ; dnf clean all ; rm -rf /var/cache/dnf /var/cache/yum /var/lib/mysql\n#  purge and re-create /var/lib/mysql with appropriate ownership\nRUN set -ex ; /usr/bin/install -m 0775 -o mysql -g root -d /var/lib/mysql /var/run/mysqld /docker-entrypoint-initdb.d ; find /etc/my.cnf /etc/my.cnf.d -name '*.cnf' -print0 | xargs -0 grep -lZE '^(bind-address|log|user)' | xargs -rt -0 sed -Ei 's/^(bind-address|log|user)/#&/' ; echo '!includedir /etc/my.cnf.d' >> /etc/my.cnf; printf '[mysqld]\\nskip-host-cache\\nskip-name-resolve\\n' > /etc/my.cnf.d/docker.cnf; /usr/bin/install -m 0664 -o mysql -g root /dev/null /etc/sysconfig/mysql ; echo \"LD_PRELOAD=/usr/lib64/libjemalloc.so.1\" >> /etc/sysconfig/mysql; echo \"THP_SETTING=never\" >> /etc/sysconfig/mysql; chown -R mysql:root /etc/my.cnf /etc/my.cnf.d ; chmod -R ug+rwX /etc/my.cnf /etc/my.cnf.d\nVOLUME [\"/var/lib/mysql\", \"/var/log/mysql\"]\nADD ps-entry.sh /docker-entrypoint.sh\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nUSER mysql\nEXPOSE 3306/tcp 33060/tcp\nADD docker-healthcheck /usr/local/bin/\nCMD [\"mysqld\"]\n","injectedSmells":[],"originalDockerfileHash":"5fcf53f7e37285e5bfe9bb7916bca0cd","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   This Dockerfile should be used for docker official repo\n#   https://github.com/docker-library/official-images:\n#   No official images can be derived from, or depend on, non-official images\n#   with the following notable exceptions...\nFROM oraclelinux:8\nLABEL org.opencontainers.image.authors=\"info@percona.com\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   It is intentionally used another UID, to have backward compatibility with\n#   the previous image versions published on Docker Hub\nRUN set -ex ; groupdel input ; userdel systemd-coredump ; groupadd -g 1001 mysql ; useradd -u 1001 -r -g 1001 -s /sbin/nologin -c \"Default Application User\" mysql\n#   check repository package signature in secure way\nRUN set -ex ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver keyserver.ubuntu.com --recv-keys 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A 99DB70FAE1D7CE227FB6488205B555B38483C65D ; gpg --batch --export --armor 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A > ${GNUPGHOME}/RPM-GPG-KEY-Percona; gpg --batch --export --armor 99DB70FAE1D7CE227FB6488205B555B38483C65D > ${GNUPGHOME}/RPM-GPG-KEY-centosofficial; rpmkeys --import ${GNUPGHOME}/RPM-GPG-KEY-Percona ${GNUPGHOME}/RPM-GPG-KEY-centosofficial ; curl -Lf -o /tmp/percona-release.rpm https://repo.percona.com/yum/percona-release-latest.noarch.rpm ; rpmkeys --checksig /tmp/percona-release.rpm ; rpm -i /tmp/percona-release.rpm ; rm -rf \"$GNUPGHOME\" /tmp/percona-release.rpm ; rpm --import /etc/pki/rpm-gpg/PERCONA-PACKAGING-KEY ; dnf -y module disable mysql ; percona-release disable all ; percona-release enable ps-80 release\nENV PS_VERSION=\"8.0.29-21.1\"\nENV OS_VER=\"el8\"\nENV FULL_PERCONA_VERSION=\"\\\"$PS_VERSION.$OS_VER\\\"\"\nRUN set -ex ; rpm -e --nodeps tzdata ; dnf -y install hostname tzdata jemalloc which cracklib-dicts tar policycoreutils ; dnf -y install percona-server-server-${FULL_PERCONA_VERSION} percona-server-devel-${FULL_PERCONA_VERSION} percona-server-rocksdb-${FULL_PERCONA_VERSION} ; dnf clean all ; rm -rf /var/cache/dnf /var/cache/yum /var/lib/mysql\n#   purge and re-create /var/lib/mysql with appropriate ownership\nRUN set -ex ; /usr/bin/install -m 0775 -o mysql -g root -d /var/lib/mysql /var/run/mysqld /docker-entrypoint-initdb.d ; find /etc/my.cnf /etc/my.cnf.d -name '*.cnf' -print0 | xargs -0 grep -lZE '^(bind-address|log|user)' | xargs -rt -0 sed -Ei 's/^(bind-address|log|user)/#&/' ; echo '!includedir /etc/my.cnf.d' >> /etc/my.cnf; printf '[mysqld]\\nskip-host-cache\\nskip-name-resolve\\n' > /etc/my.cnf.d/docker.cnf; /usr/bin/install -m 0664 -o mysql -g root /dev/null /etc/sysconfig/mysql ; echo \"LD_PRELOAD=/usr/lib64/libjemalloc.so.1\" >> /etc/sysconfig/mysql; echo \"THP_SETTING=never\" >> /etc/sysconfig/mysql; chown -R mysql:root /etc/my.cnf /etc/my.cnf.d ; chmod -R ug+rwX /etc/my.cnf /etc/my.cnf.d\nVOLUME [\"/var/lib/mysql\", \"/var/log/mysql\"]\nADD ps-entry.sh /docker-entrypoint.sh\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nUSER mysql\nEXPOSE 3306/tcp 33060/tcp\nADD docker-healthcheck /usr/local/bin/\nCMD [\"mysqld\"]\n","originalDockerfileUglifiedHash":"65e47e3f4704f82f12a6927a11cdc9fb","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles/percona__8.0.29-21-centos__9__injected.dockerfile"}