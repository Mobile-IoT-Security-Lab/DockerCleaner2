{"seed":1858993857,"processedDockerfileHash":"6549d3fa767cdb9dd16f58d7cc27d604","fixedSmells":["pin-package-manager-versions-apt-get","do-not-have-secrets"],"successfullyFixedSmells":["pin-package-manager-versions-apt-get","do-not-have-secrets"],"processedDockerfile":"FROM php:8.0-apache\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   opencontainers annotations https://github.com/opencontainers/image-spec/blob/master/annotations.md\nLABEL org.opencontainers.image.authors=\"Alexis Saettler <alexis@saettler.org>\" \\\n      org.opencontainers.image.title=\"MonicaHQ, the Personal Relationship Manager\" \\\n      org.opencontainers.image.description=\"This is MonicaHQ, your personal memory! MonicaHQ is like a CRM but for the friends, family, and acquaintances around you.\" \\\n      org.opencontainers.image.url=\"https://monicahq.com\" \\\n      org.opencontainers.image.source=\"https://github.com/monicahq/docker\" \\\n      org.opencontainers.image.vendor=\"Monica\"\n#   entrypoint.sh dependencies\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends bash=5.1-2+deb11u1 busybox-static=1:1.30.1-6+b3 -y ; rm -rf /var/lib/apt/lists/*\n#   Install required PHP extensions\nRUN set -ex ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends libicu-dev=67.1-7 zlib1g-dev=1:1.2.11.dfsg-2+deb11u2 libzip-dev=1.7.3-1 libpng-dev=1.6.37-3 libxml2-dev=2.9.10+dfsg-6.7+deb11u3 libfreetype6-dev=2.10.4+dfsg-1+deb11u1 libjpeg62-turbo-dev=1:2.0.6-4 libgmp-dev=2:6.2.1+dfsg-1+deb11u1 libmemcached-dev=1.0.18-4.2 libwebp-dev=0.6.1-2.1 -y ; debMultiarch=\"$( dpkg-architecture --query DEB_BUILD_MULTIARCH ;)\" ; if [ ! -e /usr/include/gmp.h ] ; then ln -s /usr/include/$debMultiarch/gmp.h /usr/include/gmp.h ; fi ; docker-php-ext-configure intl ; docker-php-ext-configure gd --with-jpeg --with-freetype --with-webp ; docker-php-ext-configure gmp ; docker-php-ext-install -j$( nproc ;) intl zip bcmath gd gmp pdo_mysql mysqli soap ; pecl install APCu-5.1.21 ; pecl install memcached-3.1.5 ; pecl install redis-5.3.6 ; docker-php-ext-enable apcu memcached redis ; apt-mark auto '.*' > /dev/null; apt-mark manual $savedAptMark ; ldd \"$( php -r 'echo ini_get(\"extension_dir\");' ;)\"/*.so | awk '/=>/ { print $3 }' | sort -u | xargs -r dpkg-query -S | cut -d: -f1 | sort -u | xargs -rt apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; rm -rf /var/lib/apt/lists/*\n#   Set crontab for schedules\nRUN set -ex ; mkdir -p /var/spool/cron/crontabs ; rm -f /var/spool/cron/crontabs/root ; echo '*/5 * * * * php /var/www/html/artisan schedule:run -v' > /var/spool/cron/crontabs/www-data\n#   Opcache\nENV PHP_OPCACHE_VALIDATE_TIMESTAMPS=\"0\" \\\n    PHP_OPCACHE_MAX_ACCELERATED_FILES=\"20000\" \\\n    PHP_OPCACHE_MEMORY_CONSUMPTION=\"192\" \\\n    PHP_OPCACHE_MAX_WASTED_PERCENTAGE=\"10\"\nRUN set -ex ; docker-php-ext-enable opcache ; { echo '[opcache]' ;echo 'opcache.enable=1' ;echo 'opcache.revalidate_freq=0' ;echo 'opcache.validate_timestamps=${PHP_OPCACHE_VALIDATE_TIMESTAMPS}' ;echo 'opcache.max_accelerated_files=${PHP_OPCACHE_MAX_ACCELERATED_FILES}' ;echo 'opcache.memory_consumption=${PHP_OPCACHE_MEMORY_CONSUMPTION}' ;echo 'opcache.max_wasted_percentage=${PHP_OPCACHE_MAX_WASTED_PERCENTAGE}' ;echo 'opcache.interned_strings_buffer=16' ;echo 'opcache.fast_shutdown=1' ; } > $PHP_INI_DIR/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> $PHP_INI_DIR/conf.d/docker-php-ext-apcu.ini; echo 'memory_limit=512M' > $PHP_INI_DIR/conf.d/memory-limit.ini\nRUN set -ex ; a2enmod headers rewrite remoteip ; { echo RemoteIPHeader X-Real-IP ;echo RemoteIPTrustedProxy 10.0.0.0/8 ;echo RemoteIPTrustedProxy 172.16.0.0/12 ;echo RemoteIPTrustedProxy 192.168.0.0/16 ; } > $APACHE_CONFDIR/conf-available/remoteip.conf; a2enconf remoteip\nRUN set -ex ; APACHE_DOCUMENT_ROOT=/var/www/html/public ; sed -ri -e \"s!/var/www/html!${APACHE_DOCUMENT_ROOT}!g\" $APACHE_CONFDIR/sites-available/*.conf ; sed -ri -e \"s!/var/www/!${APACHE_DOCUMENT_ROOT}!g\" $APACHE_CONFDIR/apache2.conf $APACHE_CONFDIR/conf-available/*.conf\nWORKDIR /var/www/html\n#   Define Monica version\nENV MONICA_VERSION=\"v3.7.0\"\nLABEL org.opencontainers.image.revision=\"a07317f309f25772925436346b4ebb23b6e69b43\" \\\n      org.opencontainers.image.version=\"v3.7.0\"\nRUN set -ex ; fetchDeps=\" gnupg \" ; apt-get update ; apt-get install --no-install-recommends gnupg=2.2.27-2+deb11u2 -y ; for ext in tar.bz2 tar.bz2.asc; do curl -fsSL -o monica-${MONICA_VERSION}.$ext \"https://github.com/monicahq/monica/releases/download/${MONICA_VERSION}/monica-${MONICA_VERSION}.$ext\" ; done ; GPGKEY='BDAB0D0D36A00466A2964E85DE15667131EA6018' ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys \"$GPGKEY\" ; gpg --batch --verify monica-${MONICA_VERSION}.tar.bz2.asc monica-${MONICA_VERSION}.tar.bz2 ; tar -xf monica-${MONICA_VERSION}.tar.bz2 -C /var/www/html --strip-components=1 ; gpgconf --kill all ; rm -rf \"$GNUPGHOME\" monica-${MONICA_VERSION}.tar.bz2 monica-${MONICA_VERSION}.tar.bz2.asc ; cp /var/www/html/.env.example /var/www/html/.env ; chown -R www-data:www-data /var/www/html ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps ; rm -rf /var/lib/apt/lists/*\nCOPY entrypoint.sh queue.sh cron.sh /usr/local/bin/\nENTRYPOINT [\"/usr/local/bin/entrypoint.sh\"]\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\nCMD [\"apache2-foreground\"]\n# A secret has been removed here. Please do not provide secrets from the Dockerfile as these will leak into the metadata of the resulting docker image. To provide secrets the --secret flag of the docker build command can be used (https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information).\n","originalDockerfile":"FROM php:8.0-apache\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  opencontainers annotations https://github.com/opencontainers/image-spec/blob/master/annotations.md\nLABEL org.opencontainers.image.authors=\"Alexis Saettler <alexis@saettler.org>\" \\\n      org.opencontainers.image.title=\"MonicaHQ, the Personal Relationship Manager\" \\\n      org.opencontainers.image.description=\"This is MonicaHQ, your personal memory! MonicaHQ is like a CRM but for the friends, family, and acquaintances around you.\" \\\n      org.opencontainers.image.url=\"https://monicahq.com\" \\\n      org.opencontainers.image.source=\"https://github.com/monicahq/docker\" \\\n      org.opencontainers.image.vendor=\"Monica\"\n#  entrypoint.sh dependencies\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends bash busybox-static -y ; rm -rf /var/lib/apt/lists/*\n#  Install required PHP extensions\nRUN set -ex ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends libicu-dev zlib1g-dev libzip-dev libpng-dev libxml2-dev libfreetype6-dev libjpeg62-turbo-dev libgmp-dev libmemcached-dev libwebp-dev -y ; debMultiarch=\"$( dpkg-architecture --query DEB_BUILD_MULTIARCH ;)\" ; if [ ! -e /usr/include/gmp.h ] ; then ln -s /usr/include/$debMultiarch/gmp.h /usr/include/gmp.h ; fi ; docker-php-ext-configure intl ; docker-php-ext-configure gd --with-jpeg --with-freetype --with-webp ; docker-php-ext-configure gmp ; docker-php-ext-install -j$( nproc ;) intl zip bcmath gd gmp pdo_mysql mysqli soap ; pecl install APCu-5.1.21 ; pecl install memcached-3.1.5 ; pecl install redis-5.3.6 ; docker-php-ext-enable apcu memcached redis ; apt-mark auto '.*' > /dev/null; apt-mark manual $savedAptMark ; ldd \"$( php -r 'echo ini_get(\"extension_dir\");' ;)\"/*.so | awk '/=>/ { print $3 }' | sort -u | xargs -r dpkg-query -S | cut -d: -f1 | sort -u | xargs -rt apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; rm -rf /var/lib/apt/lists/*\n#  Set crontab for schedules\nRUN set -ex ; mkdir -p /var/spool/cron/crontabs ; rm -f /var/spool/cron/crontabs/root ; echo '*/5 * * * * php /var/www/html/artisan schedule:run -v' > /var/spool/cron/crontabs/www-data\n#  Opcache\nENV PHP_OPCACHE_VALIDATE_TIMESTAMPS=\"0\" \\\n    PHP_OPCACHE_MAX_ACCELERATED_FILES=\"20000\" \\\n    PHP_OPCACHE_MEMORY_CONSUMPTION=\"192\" \\\n    PHP_OPCACHE_MAX_WASTED_PERCENTAGE=\"10\"\nRUN set -ex ; docker-php-ext-enable opcache ; { echo '[opcache]' ;echo 'opcache.enable=1' ;echo 'opcache.revalidate_freq=0' ;echo 'opcache.validate_timestamps=${PHP_OPCACHE_VALIDATE_TIMESTAMPS}' ;echo 'opcache.max_accelerated_files=${PHP_OPCACHE_MAX_ACCELERATED_FILES}' ;echo 'opcache.memory_consumption=${PHP_OPCACHE_MEMORY_CONSUMPTION}' ;echo 'opcache.max_wasted_percentage=${PHP_OPCACHE_MAX_WASTED_PERCENTAGE}' ;echo 'opcache.interned_strings_buffer=16' ;echo 'opcache.fast_shutdown=1' ; } > $PHP_INI_DIR/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> $PHP_INI_DIR/conf.d/docker-php-ext-apcu.ini; echo 'memory_limit=512M' > $PHP_INI_DIR/conf.d/memory-limit.ini\nRUN set -ex ; a2enmod headers rewrite remoteip ; { echo RemoteIPHeader X-Real-IP ;echo RemoteIPTrustedProxy 10.0.0.0/8 ;echo RemoteIPTrustedProxy 172.16.0.0/12 ;echo RemoteIPTrustedProxy 192.168.0.0/16 ; } > $APACHE_CONFDIR/conf-available/remoteip.conf; a2enconf remoteip\nRUN set -ex ; APACHE_DOCUMENT_ROOT=/var/www/html/public ; sed -ri -e \"s!/var/www/html!${APACHE_DOCUMENT_ROOT}!g\" $APACHE_CONFDIR/sites-available/*.conf ; sed -ri -e \"s!/var/www/!${APACHE_DOCUMENT_ROOT}!g\" $APACHE_CONFDIR/apache2.conf $APACHE_CONFDIR/conf-available/*.conf\nWORKDIR /var/www/html\n#  Define Monica version\nENV MONICA_VERSION=\"v3.7.0\"\nLABEL org.opencontainers.image.revision=\"a07317f309f25772925436346b4ebb23b6e69b43\" \\\n      org.opencontainers.image.version=\"v3.7.0\"\nRUN set -ex ; fetchDeps=\" gnupg \" ; apt-get update ; apt-get install --no-install-recommends gnupg -y ; for ext in tar.bz2 tar.bz2.asc; do curl -fsSL -o monica-${MONICA_VERSION}.$ext \"https://github.com/monicahq/monica/releases/download/${MONICA_VERSION}/monica-${MONICA_VERSION}.$ext\" ; done ; GPGKEY='BDAB0D0D36A00466A2964E85DE15667131EA6018' ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys \"$GPGKEY\" ; gpg --batch --verify monica-${MONICA_VERSION}.tar.bz2.asc monica-${MONICA_VERSION}.tar.bz2 ; tar -xf monica-${MONICA_VERSION}.tar.bz2 -C /var/www/html --strip-components=1 ; gpgconf --kill all ; rm -rf \"$GNUPGHOME\" monica-${MONICA_VERSION}.tar.bz2 monica-${MONICA_VERSION}.tar.bz2.asc ; cp /var/www/html/.env.example /var/www/html/.env ; chown -R www-data:www-data /var/www/html ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps ; rm -rf /var/lib/apt/lists/*\nCOPY entrypoint.sh queue.sh cron.sh /usr/local/bin/\nENTRYPOINT [\"/usr/local/bin/entrypoint.sh\"]\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\nCMD [\"apache2-foreground\"]\nENV AWS_SECRET_KEY=\"OJsMIT2U7JWdfPysakQQdhrkOS1aqJrlrFHfaOFs\" \\\n    AWS_ACCESS_KEY=\"A3T501S6DIWI12QRGQTW\" \\\n    CONSUMER_SECRET=\"vkYhesGXUomSYNaVQ/6nzedWSH7uxI0WpPf6PRfkqHhoyX6uooiF\" \\\n    AWS_SECRET_KEY=\"Zg1CKa-1jUtrlmxL--hFTkKRY5Z1EetfU0Kt-h2-\"\n","injectedSmells":[],"originalDockerfileHash":"984d6c617b02462da3c68db86ecdfec1","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM php:8.0-apache\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   opencontainers annotations https://github.com/opencontainers/image-spec/blob/master/annotations.md\nLABEL org.opencontainers.image.authors=\"Alexis Saettler <alexis@saettler.org>\" \\\n      org.opencontainers.image.title=\"MonicaHQ, the Personal Relationship Manager\" \\\n      org.opencontainers.image.description=\"This is MonicaHQ, your personal memory! MonicaHQ is like a CRM but for the friends, family, and acquaintances around you.\" \\\n      org.opencontainers.image.url=\"https://monicahq.com\" \\\n      org.opencontainers.image.source=\"https://github.com/monicahq/docker\" \\\n      org.opencontainers.image.vendor=\"Monica\"\n#   entrypoint.sh dependencies\nRUN set -ex ; apt-get update ; apt-get install --no-install-recommends bash busybox-static -y ; rm -rf /var/lib/apt/lists/*\n#   Install required PHP extensions\nRUN set -ex ; savedAptMark=\"$( apt-mark showmanual ;)\" ; apt-get update ; apt-get install --no-install-recommends libicu-dev zlib1g-dev libzip-dev libpng-dev libxml2-dev libfreetype6-dev libjpeg62-turbo-dev libgmp-dev libmemcached-dev libwebp-dev -y ; debMultiarch=\"$( dpkg-architecture --query DEB_BUILD_MULTIARCH ;)\" ; if [ ! -e /usr/include/gmp.h ] ; then ln -s /usr/include/$debMultiarch/gmp.h /usr/include/gmp.h ; fi ; docker-php-ext-configure intl ; docker-php-ext-configure gd --with-jpeg --with-freetype --with-webp ; docker-php-ext-configure gmp ; docker-php-ext-install -j$( nproc ;) intl zip bcmath gd gmp pdo_mysql mysqli soap ; pecl install APCu-5.1.21 ; pecl install memcached-3.1.5 ; pecl install redis-5.3.6 ; docker-php-ext-enable apcu memcached redis ; apt-mark auto '.*' > /dev/null; apt-mark manual $savedAptMark ; ldd \"$( php -r 'echo ini_get(\"extension_dir\");' ;)\"/*.so | awk '/=>/ { print $3 }' | sort -u | xargs -r dpkg-query -S | cut -d: -f1 | sort -u | xargs -rt apt-mark manual ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false ; rm -rf /var/lib/apt/lists/*\n#   Set crontab for schedules\nRUN set -ex ; mkdir -p /var/spool/cron/crontabs ; rm -f /var/spool/cron/crontabs/root ; echo '*/5 * * * * php /var/www/html/artisan schedule:run -v' > /var/spool/cron/crontabs/www-data\n#   Opcache\nENV PHP_OPCACHE_VALIDATE_TIMESTAMPS=\"0\" \\\n    PHP_OPCACHE_MAX_ACCELERATED_FILES=\"20000\" \\\n    PHP_OPCACHE_MEMORY_CONSUMPTION=\"192\" \\\n    PHP_OPCACHE_MAX_WASTED_PERCENTAGE=\"10\"\nRUN set -ex ; docker-php-ext-enable opcache ; { echo '[opcache]' ;echo 'opcache.enable=1' ;echo 'opcache.revalidate_freq=0' ;echo 'opcache.validate_timestamps=${PHP_OPCACHE_VALIDATE_TIMESTAMPS}' ;echo 'opcache.max_accelerated_files=${PHP_OPCACHE_MAX_ACCELERATED_FILES}' ;echo 'opcache.memory_consumption=${PHP_OPCACHE_MEMORY_CONSUMPTION}' ;echo 'opcache.max_wasted_percentage=${PHP_OPCACHE_MAX_WASTED_PERCENTAGE}' ;echo 'opcache.interned_strings_buffer=16' ;echo 'opcache.fast_shutdown=1' ; } > $PHP_INI_DIR/conf.d/opcache-recommended.ini; echo 'apc.enable_cli=1' >> $PHP_INI_DIR/conf.d/docker-php-ext-apcu.ini; echo 'memory_limit=512M' > $PHP_INI_DIR/conf.d/memory-limit.ini\nRUN set -ex ; a2enmod headers rewrite remoteip ; { echo RemoteIPHeader X-Real-IP ;echo RemoteIPTrustedProxy 10.0.0.0/8 ;echo RemoteIPTrustedProxy 172.16.0.0/12 ;echo RemoteIPTrustedProxy 192.168.0.0/16 ; } > $APACHE_CONFDIR/conf-available/remoteip.conf; a2enconf remoteip\nRUN set -ex ; APACHE_DOCUMENT_ROOT=/var/www/html/public ; sed -ri -e \"s!/var/www/html!${APACHE_DOCUMENT_ROOT}!g\" $APACHE_CONFDIR/sites-available/*.conf ; sed -ri -e \"s!/var/www/!${APACHE_DOCUMENT_ROOT}!g\" $APACHE_CONFDIR/apache2.conf $APACHE_CONFDIR/conf-available/*.conf\nWORKDIR /var/www/html\n#   Define Monica version\nENV MONICA_VERSION=\"v3.7.0\"\nLABEL org.opencontainers.image.revision=\"a07317f309f25772925436346b4ebb23b6e69b43\" \\\n      org.opencontainers.image.version=\"v3.7.0\"\nRUN set -ex ; fetchDeps=\" gnupg \" ; apt-get update ; apt-get install --no-install-recommends gnupg -y ; for ext in tar.bz2 tar.bz2.asc; do curl -fsSL -o monica-${MONICA_VERSION}.$ext \"https://github.com/monicahq/monica/releases/download/${MONICA_VERSION}/monica-${MONICA_VERSION}.$ext\" ; done ; GPGKEY='BDAB0D0D36A00466A2964E85DE15667131EA6018' ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys \"$GPGKEY\" ; gpg --batch --verify monica-${MONICA_VERSION}.tar.bz2.asc monica-${MONICA_VERSION}.tar.bz2 ; tar -xf monica-${MONICA_VERSION}.tar.bz2 -C /var/www/html --strip-components=1 ; gpgconf --kill all ; rm -rf \"$GNUPGHOME\" monica-${MONICA_VERSION}.tar.bz2 monica-${MONICA_VERSION}.tar.bz2.asc ; cp /var/www/html/.env.example /var/www/html/.env ; chown -R www-data:www-data /var/www/html ; apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps ; rm -rf /var/lib/apt/lists/*\nCOPY entrypoint.sh queue.sh cron.sh /usr/local/bin/\nENTRYPOINT [\"/usr/local/bin/entrypoint.sh\"]\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\nCMD [\"apache2-foreground\"]\nENV AWS_SECRET_KEY=\"OJsMIT2U7JWdfPysakQQdhrkOS1aqJrlrFHfaOFs\" \\\n    AWS_ACCESS_KEY=\"A3T501S6DIWI12QRGQTW\" \\\n    CONSUMER_SECRET=\"vkYhesGXUomSYNaVQ/6nzedWSH7uxI0WpPf6PRfkqHhoyX6uooiF\" \\\n    AWS_SECRET_KEY=\"Zg1CKa-1jUtrlmxL--hFTkKRY5Z1EetfU0Kt-h2-\"\n","originalDockerfileUglifiedHash":"cc4ce7b3672e5c78bb2eebdfeb93cd7a","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles/monica__3.7.0-apache__8__injected.dockerfile"}