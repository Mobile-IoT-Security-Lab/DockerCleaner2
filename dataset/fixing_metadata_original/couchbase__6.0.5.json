{"seed":2880502783,"processedDockerfileHash":"cd2f55857b8744851f0ef4df8c53ce04","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM ubuntu:18.04\nLABEL maintainer=\"docker@couchbase.com\"\n#  Install dependencies:\n#   runit: for container process management\n#   wget: for downloading .deb\n#   chrpath: for fixing curl, below\n#   tzdata: timezone info used by some N1QL functions\n#   man: so couchbase-cli help works\n#  Additional dependencies for system commands used by cbcollect_info:\n#   lsof: lsof\n#   lshw: lshw\n#   sysstat: iostat, sar, mpstat\n#   net-tools: ifconfig, arp, netstat\n#   numactl: numactl\nRUN set -x \\\n && apt-get update \\\n && apt-get install --no-install-recommends runit=2.1.2-9.2ubuntu1 wget=1.19.4-1ubuntu2.2 chrpath=0.16-2 tzdata=2023c-0ubuntu0.18.04 man lsof=4.89+dfsg-0.1 lshw=02.18-0.1ubuntu6.18.04.2 sysstat=11.6.1-1ubuntu0.2 net-tools=1.60+git20161116.90da8a0-1ubuntu1 numactl=2.0.11-2.1ubuntu0.1 python-httplib2=0.9.2+dfsg-1ubuntu0.3 -yq \\\n && apt-get autoremove \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#  http://smarden.org/runit/useinit.html#sysv - at some point the script\n#  runsvdir-start was moved/renamed to this odd name, so we put it back\n#  somewhere sensible. This appears to be necessary for Ubuntu 20 but\n#  not Ubuntu 16.\nRUN if [ ! -x /usr/sbin/runsvdir-start ] ; then cp -a /etc/runit/2 /usr/sbin/runsvdir-start ; fi\nARG CB_VERSION=6.0.5\nARG CB_RELEASE_URL=https://packages.couchbase.com/releases/6.0.5\nARG CB_PACKAGE=couchbase-server-enterprise_6.0.5-ubuntu18.04_amd64.deb\nARG CB_SHA256=6b152590867a58d771cffc22774d3cd66c916defcbeeeb339aca8d0a8e6d7f8d\nENV PATH=\"$PATH:/opt/couchbase/bin:/opt/couchbase/bin/tools:/opt/couchbase/bin/install\"\n#  Create Couchbase user with UID 1000 (necessary to match default\n#  boot2docker UID)\nRUN groupadd -g 1000 couchbase \\\n && useradd couchbase -u 1000 -g couchbase -M\n#  Install couchbase\nRUN set -x \\\n && export INSTALL_DONT_START_SERVER=1 \\\n && wget -N --no-verbose $CB_RELEASE_URL/$CB_PACKAGE \\\n && echo \"$CB_SHA256 $CB_PACKAGE\" | sha256sum -c - \\\n && apt-get update \\\n && apt-get install --no-install-recommends ./$CB_PACKAGE -y \\\n && rm -f ./$CB_PACKAGE \\\n && apt-get autoremove \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#  Update VARIANT.txt to indicate we're running in our Docker image\nRUN sed -i -e '1 s/$/\\/docker/' /opt/couchbase/VARIANT.txt\n#  Add runit script for couchbase-server\nCOPY scripts/run /etc/service/couchbase-server/run\nRUN mkdir -p /etc/runit/runsvdir/default/couchbase-server/supervise \\\n && chown -R couchbase:couchbase /etc/service /etc/runit/runsvdir/default/couchbase-server/supervise\n#  Add dummy script for commands invoked by cbcollect_info that\n#  make no sense in a Docker container\nCOPY scripts/dummy.sh /usr/local/bin/\nRUN ln -s dummy.sh /usr/local/bin/iptables-save \\\n && ln -s dummy.sh /usr/local/bin/lvdisplay \\\n && ln -s dummy.sh /usr/local/bin/vgdisplay \\\n && ln -s dummy.sh /usr/local/bin/pvdisplay\n#  Fix curl RPATH\nRUN chrpath -r '$ORIGIN/../lib' /opt/couchbase/bin/curl\n#  Add bootstrap script\nCOPY scripts/entrypoint.sh /\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"couchbase-server\"]\n#  8091: Couchbase Web console, REST/HTTP interface\n#  8092: Views, queries, XDCR\n#  8093: Query services (4.0+)\n#  8094: Full-text Search (4.5+)\n#  8095: Analytics (5.5+)\n#  8096: Eventing (5.5+)\n#  11207: Smart client library data node access (SSL)\n#  11210: Smart client library/moxi data node access\n#  11211: Legacy non-smart client library data node access\n#  18091: Couchbase Web console, REST/HTTP interface (SSL)\n#  18092: Views, query, XDCR (SSL)\n#  18093: Query services (SSL) (4.0+)\n#  18094: Full-text Search (SSL) (4.5+)\n#  18095: Analytics (SSL) (5.5+)\n#  18096: Eventing (SSL) (5.5+)\nEXPOSE 8091/tcp 8092/tcp 8093/tcp 8094/tcp 8095/tcp 8096/tcp 11207/tcp 11210/tcp 11211/tcp 18091/tcp 18092/tcp 18093/tcp 18094/tcp 18095/tcp 18096/tcp\nVOLUME /opt/couchbase/var\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ubuntu:18.04\n\nLABEL maintainer=\"docker@couchbase.com\"\n\n# Install dependencies:\n#  runit: for container process management\n#  wget: for downloading .deb\n#  chrpath: for fixing curl, below\n#  tzdata: timezone info used by some N1QL functions\n#  man: so couchbase-cli help works\n# Additional dependencies for system commands used by cbcollect_info:\n#  lsof: lsof\n#  lshw: lshw\n#  sysstat: iostat, sar, mpstat\n#  net-tools: ifconfig, arp, netstat\n#  numactl: numactl\nRUN set -x && \\\n    apt-get update && \\\n    apt-get install -yq runit wget chrpath tzdata man \\\n    lsof lshw sysstat net-tools numactl python-httplib2 && \\\n    apt-get autoremove && apt-get clean && \\\n    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\n# http://smarden.org/runit/useinit.html#sysv - at some point the script\n# runsvdir-start was moved/renamed to this odd name, so we put it back\n# somewhere sensible. This appears to be necessary for Ubuntu 20 but\n# not Ubuntu 16.\nRUN if [ ! -x /usr/sbin/runsvdir-start ]; then \\\n        cp -a /etc/runit/2 /usr/sbin/runsvdir-start; \\\n    fi\n\nARG CB_VERSION=6.0.5\nARG CB_RELEASE_URL=https://packages.couchbase.com/releases/6.0.5\nARG CB_PACKAGE=couchbase-server-enterprise_6.0.5-ubuntu18.04_amd64.deb\nARG CB_SHA256=6b152590867a58d771cffc22774d3cd66c916defcbeeeb339aca8d0a8e6d7f8d\n\nENV PATH=$PATH:/opt/couchbase/bin:/opt/couchbase/bin/tools:/opt/couchbase/bin/install\n\n# Create Couchbase user with UID 1000 (necessary to match default\n# boot2docker UID)\nRUN groupadd -g 1000 couchbase && useradd couchbase -u 1000 -g couchbase -M\n\n# Install couchbase\nRUN set -x && \\\n    export INSTALL_DONT_START_SERVER=1 && \\\n    wget -N --no-verbose $CB_RELEASE_URL/$CB_PACKAGE && \\\n    echo \"$CB_SHA256  $CB_PACKAGE\" | sha256sum -c - && \\\n    apt-get update && \\\n    apt-get install -y ./$CB_PACKAGE && \\\n    rm -f ./$CB_PACKAGE && \\\n    apt-get autoremove && apt-get clean && \\\n    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\n# Update VARIANT.txt to indicate we're running in our Docker image\nRUN sed -i -e '1 s/$/\\/docker/' /opt/couchbase/VARIANT.txt\n\n# Add runit script for couchbase-server\nCOPY scripts/run /etc/service/couchbase-server/run\nRUN mkdir -p /etc/runit/runsvdir/default/couchbase-server/supervise \\\n    && chown -R couchbase:couchbase \\\n                /etc/service \\\n                /etc/runit/runsvdir/default/couchbase-server/supervise\n\n# Add dummy script for commands invoked by cbcollect_info that\n# make no sense in a Docker container\nCOPY scripts/dummy.sh /usr/local/bin/\nRUN ln -s dummy.sh /usr/local/bin/iptables-save && \\\n    ln -s dummy.sh /usr/local/bin/lvdisplay && \\\n    ln -s dummy.sh /usr/local/bin/vgdisplay && \\\n    ln -s dummy.sh /usr/local/bin/pvdisplay\n\n# Fix curl RPATH\nRUN chrpath -r '$ORIGIN/../lib' /opt/couchbase/bin/curl\n\n# Add bootstrap script\nCOPY scripts/entrypoint.sh /\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"couchbase-server\"]\n\n# 8091: Couchbase Web console, REST/HTTP interface\n# 8092: Views, queries, XDCR\n# 8093: Query services (4.0+)\n# 8094: Full-text Search (4.5+)\n# 8095: Analytics (5.5+)\n# 8096: Eventing (5.5+)\n# 11207: Smart client library data node access (SSL)\n# 11210: Smart client library/moxi data node access\n# 11211: Legacy non-smart client library data node access\n# 18091: Couchbase Web console, REST/HTTP interface (SSL)\n# 18092: Views, query, XDCR (SSL)\n# 18093: Query services (SSL) (4.0+)\n# 18094: Full-text Search (SSL) (4.5+)\n# 18095: Analytics (SSL) (5.5+)\n# 18096: Eventing (SSL) (5.5+)\nEXPOSE 8091 8092 8093 8094 8095 8096 11207 11210 11211 18091 18092 18093 18094 18095 18096\nVOLUME /opt/couchbase/var\n","injectedSmells":[],"originalDockerfileHash":"7be3f1da970ce3201a75e980abb0fbff","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ubuntu:18.04\nLABEL maintainer=\"docker@couchbase.com\"\n#  Install dependencies:\n#   runit: for container process management\n#   wget: for downloading .deb\n#   chrpath: for fixing curl, below\n#   tzdata: timezone info used by some N1QL functions\n#   man: so couchbase-cli help works\n#  Additional dependencies for system commands used by cbcollect_info:\n#   lsof: lsof\n#   lshw: lshw\n#   sysstat: iostat, sar, mpstat\n#   net-tools: ifconfig, arp, netstat\n#   numactl: numactl\nRUN set -x \\\n && apt-get update \\\n && apt-get install runit wget chrpath tzdata man lsof lshw sysstat net-tools numactl python-httplib2 -yq \\\n && apt-get autoremove \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#  http://smarden.org/runit/useinit.html#sysv - at some point the script\n#  runsvdir-start was moved/renamed to this odd name, so we put it back\n#  somewhere sensible. This appears to be necessary for Ubuntu 20 but\n#  not Ubuntu 16.\nRUN if [ ! -x /usr/sbin/runsvdir-start ] ; then cp -a /etc/runit/2 /usr/sbin/runsvdir-start ; fi\nARG CB_VERSION=6.0.5\nARG CB_RELEASE_URL=https://packages.couchbase.com/releases/6.0.5\nARG CB_PACKAGE=couchbase-server-enterprise_6.0.5-ubuntu18.04_amd64.deb\nARG CB_SHA256=6b152590867a58d771cffc22774d3cd66c916defcbeeeb339aca8d0a8e6d7f8d\nENV PATH=\"$PATH:/opt/couchbase/bin:/opt/couchbase/bin/tools:/opt/couchbase/bin/install\"\n#  Create Couchbase user with UID 1000 (necessary to match default\n#  boot2docker UID)\nRUN groupadd -g 1000 couchbase \\\n && useradd couchbase -u 1000 -g couchbase -M\n#  Install couchbase\nRUN set -x \\\n && export INSTALL_DONT_START_SERVER=1 \\\n && wget -N --no-verbose $CB_RELEASE_URL/$CB_PACKAGE \\\n && echo \"$CB_SHA256 $CB_PACKAGE\" | sha256sum -c - \\\n && apt-get update \\\n && apt-get install ./$CB_PACKAGE -y \\\n && rm -f ./$CB_PACKAGE \\\n && apt-get autoremove \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n#  Update VARIANT.txt to indicate we're running in our Docker image\nRUN sed -i -e '1 s/$/\\/docker/' /opt/couchbase/VARIANT.txt\n#  Add runit script for couchbase-server\nCOPY scripts/run /etc/service/couchbase-server/run\nRUN mkdir -p /etc/runit/runsvdir/default/couchbase-server/supervise \\\n && chown -R couchbase:couchbase /etc/service /etc/runit/runsvdir/default/couchbase-server/supervise\n#  Add dummy script for commands invoked by cbcollect_info that\n#  make no sense in a Docker container\nCOPY scripts/dummy.sh /usr/local/bin/\nRUN ln -s dummy.sh /usr/local/bin/iptables-save \\\n && ln -s dummy.sh /usr/local/bin/lvdisplay \\\n && ln -s dummy.sh /usr/local/bin/vgdisplay \\\n && ln -s dummy.sh /usr/local/bin/pvdisplay\n#  Fix curl RPATH\nRUN chrpath -r '$ORIGIN/../lib' /opt/couchbase/bin/curl\n#  Add bootstrap script\nCOPY scripts/entrypoint.sh /\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"couchbase-server\"]\n#  8091: Couchbase Web console, REST/HTTP interface\n#  8092: Views, queries, XDCR\n#  8093: Query services (4.0+)\n#  8094: Full-text Search (4.5+)\n#  8095: Analytics (5.5+)\n#  8096: Eventing (5.5+)\n#  11207: Smart client library data node access (SSL)\n#  11210: Smart client library/moxi data node access\n#  11211: Legacy non-smart client library data node access\n#  18091: Couchbase Web console, REST/HTTP interface (SSL)\n#  18092: Views, query, XDCR (SSL)\n#  18093: Query services (SSL) (4.0+)\n#  18094: Full-text Search (SSL) (4.5+)\n#  18095: Analytics (SSL) (5.5+)\n#  18096: Eventing (SSL) (5.5+)\nEXPOSE 8091/tcp 8092/tcp 8093/tcp 8094/tcp 8095/tcp 8096/tcp 11207/tcp 11210/tcp 11211/tcp 18091/tcp 18092/tcp 18093/tcp 18094/tcp 18095/tcp 18096/tcp\nVOLUME /opt/couchbase/var\n","originalDockerfileUglifiedHash":"932c478bb36bf3cfe26e7e5613f9949b","fileName":"/ICSME-replicationpackage/dataset/original_dockerfiles/couchbase__6.0.5.dockerfile"}