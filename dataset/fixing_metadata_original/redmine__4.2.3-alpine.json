{"seed":114582906,"processedDockerfileHash":"55adeb45d947f24f7a4dc2b81aeb7ac8","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM ruby:2.7-alpine3.15\n#  explicitly set uid/gid to guarantee that it won't change in the future\n#  the values 999:999 are identical to the current user/group id assigned\n#  alpine already has a gid 999, so we'll use the next id\nRUN addgroup -S -g 1000 redmine \\\n && adduser -S -H -G redmine -u 999 redmine\nRUN set -eux ; apk add bash=5.1.16-r0 ca-certificates=20220614-r0 su-exec=0.2-r1 tini=0.19.0-r0 tzdata=2023c-r0 wget=1.21.2-r2 breezy=3.2.1-r0 git=2.34.7-r0 mercurial=5.9.3-r0 openssh-client subversion=1.14.2-r0 ghostscript=9.55.0-r1	 ghostscript-fonts=8.11-r2 imagemagick=7.1.0.16-r0 --no-cache\nENV RAILS_ENV=\"production\"\nWORKDIR /usr/src/redmine\n#  https://github.com/docker-library/redmine/issues/138#issuecomment-438834176\n#  (bundler needs this for running as an arbitrary user)\nENV HOME=\"/home/redmine\"\nRUN set -eux ; [ ! -d \"$HOME\" ] ; mkdir -p \"$HOME\" ; chown redmine:redmine \"$HOME\" ; chmod 1777 \"$HOME\"\nENV REDMINE_VERSION=\"4.2.3\"\nENV REDMINE_DOWNLOAD_SHA256=\"72f633dc954217948558889ca85325fe6410cd18a2d8b39358e5d75932a47a0c\"\nRUN set -eux ; wget -O redmine.tar.gz \"https://www.redmine.org/releases/redmine-${REDMINE_VERSION}.tar.gz\" ; echo \"$REDMINE_DOWNLOAD_SHA256 *redmine.tar.gz\" | sha256sum -c - ; tar -xf redmine.tar.gz --strip-components=1 ; rm redmine.tar.gz files/delete.me log/delete.me ; mkdir -p log public/plugin_assets sqlite tmp/pdf tmp/pids ; chown -R redmine:redmine ./ ; echo 'config.logger = Logger.new(STDOUT)' > config/additional_environment.rb; chmod -R ugo=rwX config db sqlite ; find log tmp -type d -exec chmod 1777 '{}' +\n#  build for musl-libc, not glibc (see https://github.com/sparklemotion/nokogiri/issues/2075, https://github.com/rubygems/rubygems/issues/3174)\nENV BUNDLE_FORCE_RUBY_PLATFORM=\"1\"\nRUN set -eux ; apk add coreutils=9.0-r2 freetds-dev=1.3.3-r2 gcc=10.3.1_git20211027-r0 make=4.3-r0 mariadb-dev=10.6.12-r0 musl-dev=1.2.2-r8 patch=2.7.6-r7 postgresql-dev sqlite-dev=3.36.0-r0 ttf2ufm=3.4.4-r0 zlib-dev=1.2.12-r3 --no-cache --virtual .build-deps ; su-exec redmine bundle config --local without 'development test' ; echo '# the following entries only exist to force `bundle install` to pre-install all database adapter dependencies -- they can be safely removed/ignored' > ./config/database.yml; for adapter in mysql2 postgresql sqlserver sqlite3; do echo \"$adapter:\" >> ./config/database.yml;echo \" adapter: $adapter\" >> ./config/database.yml; done ; su-exec redmine bundle install --jobs \"$( nproc ;)\" ; rm ./config/database.yml ; chmod -R ugo=rwX Gemfile.lock \"$GEM_HOME\" ; rm -rf ~redmine/.bundle ; rm /usr/local/bundle/gems/rbpdf-font-1.19.*/lib/fonts/ttf2ufm/ttf2ufm ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local/bundle/gems | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add $runDeps --no-network --virtual .redmine-rundeps ; apk del --no-network .build-deps\nVOLUME /usr/src/redmine/files\nCOPY docker-entrypoint.sh /\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nEXPOSE 3000/tcp\nCMD [\"rails\", \"server\", \"-b\", \"0.0.0.0\"]\nRUN addgroup -S docker-user ; adduser -S -G docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM ruby:2.7-alpine3.15\n\n# explicitly set uid/gid to guarantee that it won't change in the future\n# the values 999:999 are identical to the current user/group id assigned\n# alpine already has a gid 999, so we'll use the next id\nRUN addgroup -S -g 1000 redmine && adduser -S -H -G redmine -u 999 redmine\n\nRUN set -eux; \\\n\tapk add --no-cache \\\n\t\tbash \\\n\t\tca-certificates \\\n\t\tsu-exec \\\n\t\ttini \\\n\t\ttzdata \\\n\t\twget \\\n\t\t\\\n\t\tbreezy \\\n\t\tgit \\\n\t\tmercurial \\\n\t\topenssh-client \\\n\t\tsubversion \\\n\t\t\\\n# we need \"gsfonts\" for generating PNGs of Gantt charts\n# and \"ghostscript\" for creating PDF thumbnails (in 4.1+)\n\t\tghostscript \\\n\t\tghostscript-fonts \\\n\t\timagemagick \\\n\t;\n\nENV RAILS_ENV production\nWORKDIR /usr/src/redmine\n\n# https://github.com/docker-library/redmine/issues/138#issuecomment-438834176\n# (bundler needs this for running as an arbitrary user)\nENV HOME /home/redmine\nRUN set -eux; \\\n\t[ ! -d \"$HOME\" ]; \\\n\tmkdir -p \"$HOME\"; \\\n\tchown redmine:redmine \"$HOME\"; \\\n\tchmod 1777 \"$HOME\"\n\nENV REDMINE_VERSION 4.2.3\nENV REDMINE_DOWNLOAD_SHA256 72f633dc954217948558889ca85325fe6410cd18a2d8b39358e5d75932a47a0c\n\nRUN set -eux; \\\n\twget -O redmine.tar.gz \"https://www.redmine.org/releases/redmine-${REDMINE_VERSION}.tar.gz\"; \\\n\techo \"$REDMINE_DOWNLOAD_SHA256 *redmine.tar.gz\" | sha256sum -c -; \\\n\ttar -xf redmine.tar.gz --strip-components=1; \\\n\trm redmine.tar.gz files/delete.me log/delete.me; \\\n\tmkdir -p log public/plugin_assets sqlite tmp/pdf tmp/pids; \\\n\tchown -R redmine:redmine ./; \\\n# log to STDOUT (https://github.com/docker-library/redmine/issues/108)\n\techo 'config.logger = Logger.new(STDOUT)' > config/additional_environment.rb; \\\n# fix permissions for running as an arbitrary user\n\tchmod -R ugo=rwX config db sqlite; \\\n\tfind log tmp -type d -exec chmod 1777 '{}' +\n\n# build for musl-libc, not glibc (see https://github.com/sparklemotion/nokogiri/issues/2075, https://github.com/rubygems/rubygems/issues/3174)\nENV BUNDLE_FORCE_RUBY_PLATFORM 1\nRUN set -eux; \\\n\t\\\n\tapk add --no-cache --virtual .build-deps \\\n\t\tcoreutils \\\n\t\tfreetds-dev \\\n\t\tgcc \\\n\t\tmake \\\n\t\tmariadb-dev \\\n\t\tmusl-dev \\\n\t\tpatch \\\n\t\tpostgresql-dev \\\n\t\tsqlite-dev \\\n\t\tttf2ufm \\\n\t\tzlib-dev \\\n\t; \\\n\t\\\n\tsu-exec redmine bundle config --local without 'development test'; \\\n# fill up \"database.yml\" with bogus entries so the redmine Gemfile will pre-install all database adapter dependencies\n# https://github.com/redmine/redmine/blob/e9f9767089a4e3efbd73c35fc55c5c7eb85dd7d3/Gemfile#L50-L79\n\techo '# the following entries only exist to force `bundle install` to pre-install all database adapter dependencies -- they can be safely removed/ignored' > ./config/database.yml; \\\n\tfor adapter in mysql2 postgresql sqlserver sqlite3; do \\\n\t\techo \"$adapter:\" >> ./config/database.yml; \\\n\t\techo \"  adapter: $adapter\" >> ./config/database.yml; \\\n\tdone; \\\n\tsu-exec redmine bundle install --jobs \"$(nproc)\"; \\\n\trm ./config/database.yml; \\\n# fix permissions for running as an arbitrary user\n\tchmod -R ugo=rwX Gemfile.lock \"$GEM_HOME\"; \\\n# this requires coreutils because \"chmod +X\" in busybox will remove +x on files (and coreutils leaves files alone with +X)\n\trm -rf ~redmine/.bundle; \\\n\t\\\n# https://github.com/naitoh/rbpdf/issues/31\n\trm /usr/local/bundle/gems/rbpdf-font-1.19.*/lib/fonts/ttf2ufm/ttf2ufm; \\\n\t\\\n\trunDeps=\"$( \\\n\t\tscanelf --needed --nobanner --format '%n#p' --recursive /usr/local/bundle/gems \\\n\t\t| tr ',' '\\n' \\\n\t\t| sort -u \\\n\t\t| awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' \\\n\t)\"; \\\n\tapk add --no-network --virtual .redmine-rundeps $runDeps; \\\n\tapk del --no-network .build-deps\n\nVOLUME /usr/src/redmine/files\n\nCOPY docker-entrypoint.sh /\nENTRYPOINT [\"/docker-entrypoint.sh\"]\n\nEXPOSE 3000\nCMD [\"rails\", \"server\", \"-b\", \"0.0.0.0\"]\n","injectedSmells":[],"originalDockerfileHash":"c4a368da0f66957fae865f4806d4657a","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM ruby:2.7-alpine3.15\n#  explicitly set uid/gid to guarantee that it won't change in the future\n#  the values 999:999 are identical to the current user/group id assigned\n#  alpine already has a gid 999, so we'll use the next id\nRUN addgroup -S -g 1000 redmine \\\n && adduser -S -H -G redmine -u 999 redmine\nRUN set -eux ; apk add --no-cache bash ca-certificates su-exec tini tzdata wget breezy git mercurial openssh-client subversion ghostscript ghostscript-fonts imagemagick\nENV RAILS_ENV=\"production\"\nWORKDIR /usr/src/redmine\n#  https://github.com/docker-library/redmine/issues/138#issuecomment-438834176\n#  (bundler needs this for running as an arbitrary user)\nENV HOME=\"/home/redmine\"\nRUN set -eux ; [ ! -d \"$HOME\" ] ; mkdir -p \"$HOME\" ; chown redmine:redmine \"$HOME\" ; chmod 1777 \"$HOME\"\nENV REDMINE_VERSION=\"4.2.3\"\nENV REDMINE_DOWNLOAD_SHA256=\"72f633dc954217948558889ca85325fe6410cd18a2d8b39358e5d75932a47a0c\"\nRUN set -eux ; wget -O redmine.tar.gz \"https://www.redmine.org/releases/redmine-${REDMINE_VERSION}.tar.gz\" ; echo \"$REDMINE_DOWNLOAD_SHA256 *redmine.tar.gz\" | sha256sum -c - ; tar -xf redmine.tar.gz --strip-components=1 ; rm redmine.tar.gz files/delete.me log/delete.me ; mkdir -p log public/plugin_assets sqlite tmp/pdf tmp/pids ; chown -R redmine:redmine ./ ; echo 'config.logger = Logger.new(STDOUT)' > config/additional_environment.rb; chmod -R ugo=rwX config db sqlite ; find log tmp -type d -exec chmod 1777 '{}' +\n#  build for musl-libc, not glibc (see https://github.com/sparklemotion/nokogiri/issues/2075, https://github.com/rubygems/rubygems/issues/3174)\nENV BUNDLE_FORCE_RUBY_PLATFORM=\"1\"\nRUN set -eux ; apk add --no-cache --virtual .build-deps coreutils freetds-dev gcc make mariadb-dev musl-dev patch postgresql-dev sqlite-dev ttf2ufm zlib-dev ; su-exec redmine bundle config --local without 'development test' ; echo '# the following entries only exist to force `bundle install` to pre-install all database adapter dependencies -- they can be safely removed/ignored' > ./config/database.yml; for adapter in mysql2 postgresql sqlserver sqlite3; do echo \"$adapter:\" >> ./config/database.yml;echo \" adapter: $adapter\" >> ./config/database.yml; done ; su-exec redmine bundle install --jobs \"$( nproc ;)\" ; rm ./config/database.yml ; chmod -R ugo=rwX Gemfile.lock \"$GEM_HOME\" ; rm -rf ~redmine/.bundle ; rm /usr/local/bundle/gems/rbpdf-font-1.19.*/lib/fonts/ttf2ufm/ttf2ufm ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive /usr/local/bundle/gems | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add --no-network --virtual .redmine-rundeps $runDeps ; apk del --no-network .build-deps\nVOLUME /usr/src/redmine/files\nCOPY docker-entrypoint.sh /\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nEXPOSE 3000/tcp\nCMD [\"rails\", \"server\", \"-b\", \"0.0.0.0\"]\n","originalDockerfileUglifiedHash":"e02bdd1700aae8ce64f5addd919e4a65","fileName":"/ICSME-replicationpackage/dataset/original_dockerfiles/redmine__4.2.3-alpine.dockerfile"}