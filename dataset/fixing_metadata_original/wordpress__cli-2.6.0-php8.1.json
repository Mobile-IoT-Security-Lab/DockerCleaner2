{"seed":1772832424,"processedDockerfileHash":"8494c9ae2a681a046942039e05a5cdfe","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-apk","have-a-healthcheck"],"processedDockerfile":"#\n#  NOTE: THIS DOCKERFILE IS GENERATED VIA \"apply-templates.sh\"\n#\n#  PLEASE DO NOT EDIT IT DIRECTLY.\n#\nFROM php:8.1-alpine\n#  install wp-cli dependencies\nRUN apk add bash=5.2.15-r0 less=608-r1 mysql-client=10.6.12-r0 --no-cache\nRUN set -ex ; mkdir -p /var/www/html ; chown -R www-data:www-data /var/www/html\nWORKDIR /var/www/html\n#  install the PHP extensions we need (https://make.wordpress.org/hosting/handbook/handbook/server-environment/#php-extensions)\nRUN set -ex ; apk add freetype-dev=2.12.1-r0 icu-dev=72.1-r1 imagemagick-dev=7.1.0.62-r0 libjpeg-turbo-dev=2.1.4-r0 libpng-dev=1.6.38-r0 libwebp-dev=1.2.4-r1 libzip-dev=1.9.2-r2 $PHPIZE_DEPS --no-cache --virtual .build-deps ; docker-php-ext-configure gd --with-freetype --with-jpeg --with-webp ; docker-php-ext-install -j \"$( nproc ;)\" bcmath exif gd intl mysqli zip ; pecl install imagick-3.6.0 ; docker-php-ext-enable imagick ; rm -r /tmp/pear ; out=\"$( php -r 'exit(0);' ;)\" ; [ -z \"$out\" ] ; err=\"$( php -r 'exit(0);' 3>&1 1>&2 2>&3;)\" ; [ -z \"$err\" ] ; extDir=\"$( php -r 'echo ini_get(\"extension_dir\");' ;)\" ; [ -d \"$extDir\" ] ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive \"$extDir\" | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add $runDeps --no-network --virtual .wordpress-phpexts-rundeps ; apk del --no-network .build-deps ; ! { ldd \"$extDir\"/*.so | grep 'not found' ; } ; err=\"$( php --version 3>&1 1>&2 2>&3;)\" ; [ -z \"$err\" ]\n#  set recommended PHP.ini settings\n#  excluding opcache due https://github.com/docker-library/wordpress/issues/407\n#  https://wordpress.org/support/article/editing-wp-config-php/#configure-error-logging\nRUN { echo 'error_reporting = E_ERROR | E_WARNING | E_PARSE | E_CORE_ERROR | E_CORE_WARNING | E_COMPILE_ERROR | E_COMPILE_WARNING | E_RECOVERABLE_ERROR' ;echo 'display_errors = Off' ;echo 'display_startup_errors = Off' ;echo 'log_errors = On' ;echo 'error_log = /dev/stderr' ;echo 'log_errors_max_len = 1024' ;echo 'ignore_repeated_errors = On' ;echo 'ignore_repeated_source = Off' ;echo 'html_errors = Off' ; } > /usr/local/etc/php/conf.d/error-logging.ini\n#  https://make.wordpress.org/cli/2018/05/31/gpg-signature-change/\n#  pub   rsa2048 2018-05-31 [SC]\n#        63AF 7AA1 5067 C056 16FD  DD88 A3A2 E8F2 26F0 BC06\n#  uid           [ unknown] WP-CLI Releases <releases@wp-cli.org>\n#  sub   rsa2048 2018-05-31 [E]\nENV WORDPRESS_CLI_GPG_KEY=\"63AF7AA15067C05616FDDD88A3A2E8F226F0BC06\"\nENV WORDPRESS_CLI_VERSION=\"2.6.0\"\nENV WORDPRESS_CLI_SHA512=\"d73f9161a1f03b8ecaac7b196b6051fe847b3c402b9c92b1f6f3acbe5b1cf91f7260c0e499b8947bab75920ecec918b39533ca65fa5a1fd3eb6ce7b8e2c58e7d\"\nRUN set -ex ; apk add gnupg=2.2.40-r0 --no-cache --virtual .fetch-deps ; curl -o /usr/local/bin/wp.gpg -fL \"https://github.com/wp-cli/wp-cli/releases/download/v${WORDPRESS_CLI_VERSION}/wp-cli-${WORDPRESS_CLI_VERSION}.phar.gpg\" ; GNUPGHOME=\"$( mktemp -d ;)\" ; export GNUPGHOME ; gpg --batch --keyserver keyserver.ubuntu.com --recv-keys \"$WORDPRESS_CLI_GPG_KEY\" ; gpg --batch --decrypt --output /usr/local/bin/wp /usr/local/bin/wp.gpg ; gpgconf --kill all ; rm -rf \"$GNUPGHOME\" /usr/local/bin/wp.gpg ; unset GNUPGHOME ; echo \"$WORDPRESS_CLI_SHA512 */usr/local/bin/wp\" | sha512sum -c - ; chmod +x /usr/local/bin/wp ; apk del --no-network .fetch-deps ; wp --allow-root --version\nVOLUME /var/www/html\nCOPY docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\nUSER www-data\nCMD [\"wp\", \"shell\"]\nHEALTHCHECK CMD curl --fail http://127.0.0.1:80 || exit 1\n","originalDockerfile":"#\n# NOTE: THIS DOCKERFILE IS GENERATED VIA \"apply-templates.sh\"\n#\n# PLEASE DO NOT EDIT IT DIRECTLY.\n#\n\nFROM php:8.1-alpine\n\n# install wp-cli dependencies\nRUN apk add --no-cache \\\n# bash is needed for 'wp shell': https://github.com/wp-cli/shell-command/blob/b8dafcc2a2eba5732fdee70be077675a302848e9/src/WP_CLI/REPL.php#L104\n\t\tbash \\\n\t\tless \\\n\t\tmysql-client\n\nRUN set -ex; \\\n\tmkdir -p /var/www/html; \\\n\tchown -R www-data:www-data /var/www/html\nWORKDIR /var/www/html\n\n# install the PHP extensions we need (https://make.wordpress.org/hosting/handbook/handbook/server-environment/#php-extensions)\nRUN set -ex; \\\n\t\\\n\tapk add --no-cache --virtual .build-deps \\\n\t\t$PHPIZE_DEPS \\\n\t\tfreetype-dev \\\n\t\ticu-dev \\\n\t\timagemagick-dev \\\n\t\tlibjpeg-turbo-dev \\\n\t\tlibpng-dev \\\n\t\tlibwebp-dev \\\n\t\tlibzip-dev \\\n\t; \\\n\t\\\n\tdocker-php-ext-configure gd \\\n\t\t--with-freetype \\\n\t\t--with-jpeg \\\n\t\t--with-webp \\\n\t; \\\n\tdocker-php-ext-install -j \"$(nproc)\" \\\n\t\tbcmath \\\n\t\texif \\\n\t\tgd \\\n\t\tintl \\\n\t\tmysqli \\\n\t\tzip \\\n\t; \\\n# WARNING: imagick is likely not supported on Alpine: https://github.com/Imagick/imagick/issues/328\n# https://pecl.php.net/package/imagick\n\tpecl install imagick-3.6.0; \\\n\tdocker-php-ext-enable imagick; \\\n\trm -r /tmp/pear; \\\n\t\\\n# some misbehaving extensions end up outputting to stdout ðŸ™ˆ (https://github.com/docker-library/wordpress/issues/669#issuecomment-993945967)\n\tout=\"$(php -r 'exit(0);')\"; \\\n\t[ -z \"$out\" ]; \\\n\terr=\"$(php -r 'exit(0);' 3>&1 1>&2 2>&3)\"; \\\n\t[ -z \"$err\" ]; \\\n\t\\\n\textDir=\"$(php -r 'echo ini_get(\"extension_dir\");')\"; \\\n\t[ -d \"$extDir\" ]; \\\n\trunDeps=\"$( \\\n\t\tscanelf --needed --nobanner --format '%n#p' --recursive \"$extDir\" \\\n\t\t\t| tr ',' '\\n' \\\n\t\t\t| sort -u \\\n\t\t\t| awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' \\\n\t)\"; \\\n\tapk add --no-network --virtual .wordpress-phpexts-rundeps $runDeps; \\\n\tapk del --no-network .build-deps; \\\n\t\\\n\t! { ldd \"$extDir\"/*.so | grep 'not found'; }; \\\n# check for output like \"PHP Warning:  PHP Startup: Unable to load dynamic library 'foo' (tried: ...)\n\terr=\"$(php --version 3>&1 1>&2 2>&3)\"; \\\n\t[ -z \"$err\" ]\n\n# set recommended PHP.ini settings\n# excluding opcache due https://github.com/docker-library/wordpress/issues/407\n# https://wordpress.org/support/article/editing-wp-config-php/#configure-error-logging\nRUN { \\\n# https://www.php.net/manual/en/errorfunc.constants.php\n# https://github.com/docker-library/wordpress/issues/420#issuecomment-517839670\n\t\techo 'error_reporting = E_ERROR | E_WARNING | E_PARSE | E_CORE_ERROR | E_CORE_WARNING | E_COMPILE_ERROR | E_COMPILE_WARNING | E_RECOVERABLE_ERROR'; \\\n\t\techo 'display_errors = Off'; \\\n\t\techo 'display_startup_errors = Off'; \\\n\t\techo 'log_errors = On'; \\\n\t\techo 'error_log = /dev/stderr'; \\\n\t\techo 'log_errors_max_len = 1024'; \\\n\t\techo 'ignore_repeated_errors = On'; \\\n\t\techo 'ignore_repeated_source = Off'; \\\n\t\techo 'html_errors = Off'; \\\n\t} > /usr/local/etc/php/conf.d/error-logging.ini\n\n# https://make.wordpress.org/cli/2018/05/31/gpg-signature-change/\n# pub   rsa2048 2018-05-31 [SC]\n#       63AF 7AA1 5067 C056 16FD  DD88 A3A2 E8F2 26F0 BC06\n# uid           [ unknown] WP-CLI Releases <releases@wp-cli.org>\n# sub   rsa2048 2018-05-31 [E]\nENV WORDPRESS_CLI_GPG_KEY 63AF7AA15067C05616FDDD88A3A2E8F226F0BC06\n\nENV WORDPRESS_CLI_VERSION 2.6.0\nENV WORDPRESS_CLI_SHA512 d73f9161a1f03b8ecaac7b196b6051fe847b3c402b9c92b1f6f3acbe5b1cf91f7260c0e499b8947bab75920ecec918b39533ca65fa5a1fd3eb6ce7b8e2c58e7d\n\nRUN set -ex; \\\n\t\\\n\tapk add --no-cache --virtual .fetch-deps \\\n\t\tgnupg \\\n\t; \\\n\t\\\n\tcurl -o /usr/local/bin/wp.gpg -fL \"https://github.com/wp-cli/wp-cli/releases/download/v${WORDPRESS_CLI_VERSION}/wp-cli-${WORDPRESS_CLI_VERSION}.phar.gpg\"; \\\n\t\\\n\tGNUPGHOME=\"$(mktemp -d)\"; export GNUPGHOME; \\\n\tgpg --batch --keyserver keyserver.ubuntu.com --recv-keys \"$WORDPRESS_CLI_GPG_KEY\"; \\\n\tgpg --batch --decrypt --output /usr/local/bin/wp /usr/local/bin/wp.gpg; \\\n\tgpgconf --kill all; \\\n\trm -rf \"$GNUPGHOME\" /usr/local/bin/wp.gpg; unset GNUPGHOME; \\\n\t\\\n\techo \"$WORDPRESS_CLI_SHA512 */usr/local/bin/wp\" | sha512sum -c -; \\\n\tchmod +x /usr/local/bin/wp; \\\n\t\\\n\tapk del --no-network .fetch-deps; \\\n\t\\\n\twp --allow-root --version\n\nVOLUME /var/www/html\n\nCOPY docker-entrypoint.sh /usr/local/bin/\n\nENTRYPOINT [\"docker-entrypoint.sh\"]\nUSER www-data\nCMD [\"wp\", \"shell\"]\n","injectedSmells":[],"originalDockerfileHash":"03e6fdccf619d01e212c9a4069ab46a8","successfullyInjectedSmells":[],"originalDockerfileUglified":"#\n#  NOTE: THIS DOCKERFILE IS GENERATED VIA \"apply-templates.sh\"\n#\n#  PLEASE DO NOT EDIT IT DIRECTLY.\n#\nFROM php:8.1-alpine\n#  install wp-cli dependencies\nRUN apk add --no-cache bash less mysql-client\nRUN set -ex ; mkdir -p /var/www/html ; chown -R www-data:www-data /var/www/html\nWORKDIR /var/www/html\n#  install the PHP extensions we need (https://make.wordpress.org/hosting/handbook/handbook/server-environment/#php-extensions)\nRUN set -ex ; apk add --no-cache --virtual .build-deps $PHPIZE_DEPS freetype-dev icu-dev imagemagick-dev libjpeg-turbo-dev libpng-dev libwebp-dev libzip-dev ; docker-php-ext-configure gd --with-freetype --with-jpeg --with-webp ; docker-php-ext-install -j \"$( nproc ;)\" bcmath exif gd intl mysqli zip ; pecl install imagick-3.6.0 ; docker-php-ext-enable imagick ; rm -r /tmp/pear ; out=\"$( php -r 'exit(0);' ;)\" ; [ -z \"$out\" ] ; err=\"$( php -r 'exit(0);' 3>&1 1>&2 2>&3;)\" ; [ -z \"$err\" ] ; extDir=\"$( php -r 'echo ini_get(\"extension_dir\");' ;)\" ; [ -d \"$extDir\" ] ; runDeps=\"$( scanelf --needed --nobanner --format '%n#p' --recursive \"$extDir\" | tr ',' '\\n' | sort -u | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' ;)\" ; apk add --no-network --virtual .wordpress-phpexts-rundeps $runDeps ; apk del --no-network .build-deps ; ! { ldd \"$extDir\"/*.so | grep 'not found' ; } ; err=\"$( php --version 3>&1 1>&2 2>&3;)\" ; [ -z \"$err\" ]\n#  set recommended PHP.ini settings\n#  excluding opcache due https://github.com/docker-library/wordpress/issues/407\n#  https://wordpress.org/support/article/editing-wp-config-php/#configure-error-logging\nRUN { echo 'error_reporting = E_ERROR | E_WARNING | E_PARSE | E_CORE_ERROR | E_CORE_WARNING | E_COMPILE_ERROR | E_COMPILE_WARNING | E_RECOVERABLE_ERROR' ;echo 'display_errors = Off' ;echo 'display_startup_errors = Off' ;echo 'log_errors = On' ;echo 'error_log = /dev/stderr' ;echo 'log_errors_max_len = 1024' ;echo 'ignore_repeated_errors = On' ;echo 'ignore_repeated_source = Off' ;echo 'html_errors = Off' ; } > /usr/local/etc/php/conf.d/error-logging.ini\n#  https://make.wordpress.org/cli/2018/05/31/gpg-signature-change/\n#  pub   rsa2048 2018-05-31 [SC]\n#        63AF 7AA1 5067 C056 16FD  DD88 A3A2 E8F2 26F0 BC06\n#  uid           [ unknown] WP-CLI Releases <releases@wp-cli.org>\n#  sub   rsa2048 2018-05-31 [E]\nENV WORDPRESS_CLI_GPG_KEY=\"63AF7AA15067C05616FDDD88A3A2E8F226F0BC06\"\nENV WORDPRESS_CLI_VERSION=\"2.6.0\"\nENV WORDPRESS_CLI_SHA512=\"d73f9161a1f03b8ecaac7b196b6051fe847b3c402b9c92b1f6f3acbe5b1cf91f7260c0e499b8947bab75920ecec918b39533ca65fa5a1fd3eb6ce7b8e2c58e7d\"\nRUN set -ex ; apk add --no-cache --virtual .fetch-deps gnupg ; curl -o /usr/local/bin/wp.gpg -fL \"https://github.com/wp-cli/wp-cli/releases/download/v${WORDPRESS_CLI_VERSION}/wp-cli-${WORDPRESS_CLI_VERSION}.phar.gpg\" ; GNUPGHOME=\"$( mktemp -d ;)\" ; export GNUPGHOME ; gpg --batch --keyserver keyserver.ubuntu.com --recv-keys \"$WORDPRESS_CLI_GPG_KEY\" ; gpg --batch --decrypt --output /usr/local/bin/wp /usr/local/bin/wp.gpg ; gpgconf --kill all ; rm -rf \"$GNUPGHOME\" /usr/local/bin/wp.gpg ; unset GNUPGHOME ; echo \"$WORDPRESS_CLI_SHA512 */usr/local/bin/wp\" | sha512sum -c - ; chmod +x /usr/local/bin/wp ; apk del --no-network .fetch-deps ; wp --allow-root --version\nVOLUME /var/www/html\nCOPY docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\nUSER www-data\nCMD [\"wp\", \"shell\"]\n","originalDockerfileUglifiedHash":"884289b830497a467a921f789086ce9f","fileName":"/ICSME-replicationpackage/dataset/original_dockerfiles/wordpress__cli-2.6.0-php8.1.dockerfile"}